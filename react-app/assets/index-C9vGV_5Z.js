var sae=Object.defineProperty;var aae=(a,n,i)=>n in a?sae(a,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[n]=i;var zt=(a,n,i)=>aae(a,typeof n!="symbol"?n+"":n,i);function oae(a,n){for(var i=0;i<n.length;i++){const s=n[i];if(typeof s!="string"&&!Array.isArray(s)){for(const l in s)if(l!=="default"&&!(l in a)){const p=Object.getOwnPropertyDescriptor(s,l);p&&Object.defineProperty(a,l,p.get?p:{enumerable:!0,get:()=>s[l]})}}}return Object.freeze(Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const p of l)if(p.type==="childList")for(const _ of p.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&s(_)}).observe(document,{childList:!0,subtree:!0});function i(l){const p={};return l.integrity&&(p.integrity=l.integrity),l.referrerPolicy&&(p.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?p.credentials="include":l.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function s(l){if(l.ep)return;l.ep=!0;const p=i(l);fetch(l.href,p)}})();var mL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fR(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var gL={exports:{}},Ew={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SW;function cae(){if(SW)return Ew;SW=1;var a=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function i(s,l,p){var _=null;if(p!==void 0&&(_=""+p),l.key!==void 0&&(_=""+l.key),"key"in l){p={};for(var T in l)T!=="key"&&(p[T]=l[T])}else p=l;return l=p.ref,{$$typeof:a,type:s,key:_,ref:l!==void 0?l:null,props:p}}return Ew.Fragment=n,Ew.jsx=i,Ew.jsxs=i,Ew}var TW;function lae(){return TW||(TW=1,gL.exports=cae()),gL.exports}var m=lae(),_L={exports:{}},ar={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bW;function dae(){if(bW)return ar;bW=1;var a=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),p=Symbol.for("react.consumer"),_=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),C=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),k=Symbol.iterator;function U(he){return he===null||typeof he!="object"?null:(he=k&&he[k]||he["@@iterator"],typeof he=="function"?he:null)}var Y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},W=Object.assign,ee={};function K(he,De,qe){this.props=he,this.context=De,this.refs=ee,this.updater=qe||Y}K.prototype.isReactComponent={},K.prototype.setState=function(he,De){if(typeof he!="object"&&typeof he!="function"&&he!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,he,De,"setState")},K.prototype.forceUpdate=function(he){this.updater.enqueueForceUpdate(this,he,"forceUpdate")};function ie(){}ie.prototype=K.prototype;function se(he,De,qe){this.props=he,this.context=De,this.refs=ee,this.updater=qe||Y}var ue=se.prototype=new ie;ue.constructor=se,W(ue,K.prototype),ue.isPureReactComponent=!0;var ye=Array.isArray,ae={H:null,A:null,T:null,S:null,V:null},ve=Object.prototype.hasOwnProperty;function $(he,De,qe,We,Be,bt){return qe=bt.ref,{$$typeof:a,type:he,key:De,ref:qe!==void 0?qe:null,props:bt}}function Q(he,De){return $(he.type,De,void 0,void 0,void 0,he.props)}function te(he){return typeof he=="object"&&he!==null&&he.$$typeof===a}function oe(he){var De={"=":"=0",":":"=2"};return"$"+he.replace(/[=:]/g,function(qe){return De[qe]})}var re=/\/+/g;function fe(he,De){return typeof he=="object"&&he!==null&&he.key!=null?oe(""+he.key):De.toString(36)}function pe(){}function Ne(he){switch(he.status){case"fulfilled":return he.value;case"rejected":throw he.reason;default:switch(typeof he.status=="string"?he.then(pe,pe):(he.status="pending",he.then(function(De){he.status==="pending"&&(he.status="fulfilled",he.value=De)},function(De){he.status==="pending"&&(he.status="rejected",he.reason=De)})),he.status){case"fulfilled":return he.value;case"rejected":throw he.reason}}throw he}function Je(he,De,qe,We,Be){var bt=typeof he;(bt==="undefined"||bt==="boolean")&&(he=null);var St=!1;if(he===null)St=!0;else switch(bt){case"bigint":case"string":case"number":St=!0;break;case"object":switch(he.$$typeof){case a:case n:St=!0;break;case O:return St=he._init,Je(St(he._payload),De,qe,We,Be)}}if(St)return Be=Be(he),St=We===""?"."+fe(he,0):We,ye(Be)?(qe="",St!=null&&(qe=St.replace(re,"$&/")+"/"),Je(Be,De,qe,"",function(tn){return tn})):Be!=null&&(te(Be)&&(Be=Q(Be,qe+(Be.key==null||he&&he.key===Be.key?"":(""+Be.key).replace(re,"$&/")+"/")+St)),De.push(Be)),1;St=0;var Tt=We===""?".":We+":";if(ye(he))for(var ut=0;ut<he.length;ut++)We=he[ut],bt=Tt+fe(We,ut),St+=Je(We,De,qe,bt,Be);else if(ut=U(he),typeof ut=="function")for(he=ut.call(he),ut=0;!(We=he.next()).done;)We=We.value,bt=Tt+fe(We,ut++),St+=Je(We,De,qe,bt,Be);else if(bt==="object"){if(typeof he.then=="function")return Je(Ne(he),De,qe,We,Be);throw De=String(he),Error("Objects are not valid as a React child (found: "+(De==="[object Object]"?"object with keys {"+Object.keys(he).join(", ")+"}":De)+"). If you meant to render a collection of children, use an array instead.")}return St}function be(he,De,qe){if(he==null)return he;var We=[],Be=0;return Je(he,We,"","",function(bt){return De.call(qe,bt,Be++)}),We}function Ie(he){if(he._status===-1){var De=he._result;De=De(),De.then(function(qe){(he._status===0||he._status===-1)&&(he._status=1,he._result=qe)},function(qe){(he._status===0||he._status===-1)&&(he._status=2,he._result=qe)}),he._status===-1&&(he._status=0,he._result=De)}if(he._status===1)return he._result.default;throw he._result}var Re=typeof reportError=="function"?reportError:function(he){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var De=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof he=="object"&&he!==null&&typeof he.message=="string"?String(he.message):String(he),error:he});if(!window.dispatchEvent(De))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",he);return}console.error(he)};function Me(){}return ar.Children={map:be,forEach:function(he,De,qe){be(he,function(){De.apply(this,arguments)},qe)},count:function(he){var De=0;return be(he,function(){De++}),De},toArray:function(he){return be(he,function(De){return De})||[]},only:function(he){if(!te(he))throw Error("React.Children.only expected to receive a single React element child.");return he}},ar.Component=K,ar.Fragment=i,ar.Profiler=l,ar.PureComponent=se,ar.StrictMode=s,ar.Suspense=w,ar.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ae,ar.__COMPILER_RUNTIME={__proto__:null,c:function(he){return ae.H.useMemoCache(he)}},ar.cache=function(he){return function(){return he.apply(null,arguments)}},ar.cloneElement=function(he,De,qe){if(he==null)throw Error("The argument must be a React element, but you passed "+he+".");var We=W({},he.props),Be=he.key,bt=void 0;if(De!=null)for(St in De.ref!==void 0&&(bt=void 0),De.key!==void 0&&(Be=""+De.key),De)!ve.call(De,St)||St==="key"||St==="__self"||St==="__source"||St==="ref"&&De.ref===void 0||(We[St]=De[St]);var St=arguments.length-2;if(St===1)We.children=qe;else if(1<St){for(var Tt=Array(St),ut=0;ut<St;ut++)Tt[ut]=arguments[ut+2];We.children=Tt}return $(he.type,Be,void 0,void 0,bt,We)},ar.createContext=function(he){return he={$$typeof:_,_currentValue:he,_currentValue2:he,_threadCount:0,Provider:null,Consumer:null},he.Provider=he,he.Consumer={$$typeof:p,_context:he},he},ar.createElement=function(he,De,qe){var We,Be={},bt=null;if(De!=null)for(We in De.key!==void 0&&(bt=""+De.key),De)ve.call(De,We)&&We!=="key"&&We!=="__self"&&We!=="__source"&&(Be[We]=De[We]);var St=arguments.length-2;if(St===1)Be.children=qe;else if(1<St){for(var Tt=Array(St),ut=0;ut<St;ut++)Tt[ut]=arguments[ut+2];Be.children=Tt}if(he&&he.defaultProps)for(We in St=he.defaultProps,St)Be[We]===void 0&&(Be[We]=St[We]);return $(he,bt,void 0,void 0,null,Be)},ar.createRef=function(){return{current:null}},ar.forwardRef=function(he){return{$$typeof:T,render:he}},ar.isValidElement=te,ar.lazy=function(he){return{$$typeof:O,_payload:{_status:-1,_result:he},_init:Ie}},ar.memo=function(he,De){return{$$typeof:C,type:he,compare:De===void 0?null:De}},ar.startTransition=function(he){var De=ae.T,qe={};ae.T=qe;try{var We=he(),Be=ae.S;Be!==null&&Be(qe,We),typeof We=="object"&&We!==null&&typeof We.then=="function"&&We.then(Me,Re)}catch(bt){Re(bt)}finally{ae.T=De}},ar.unstable_useCacheRefresh=function(){return ae.H.useCacheRefresh()},ar.use=function(he){return ae.H.use(he)},ar.useActionState=function(he,De,qe){return ae.H.useActionState(he,De,qe)},ar.useCallback=function(he,De){return ae.H.useCallback(he,De)},ar.useContext=function(he){return ae.H.useContext(he)},ar.useDebugValue=function(){},ar.useDeferredValue=function(he,De){return ae.H.useDeferredValue(he,De)},ar.useEffect=function(he,De,qe){var We=ae.H;if(typeof qe=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return We.useEffect(he,De)},ar.useId=function(){return ae.H.useId()},ar.useImperativeHandle=function(he,De,qe){return ae.H.useImperativeHandle(he,De,qe)},ar.useInsertionEffect=function(he,De){return ae.H.useInsertionEffect(he,De)},ar.useLayoutEffect=function(he,De){return ae.H.useLayoutEffect(he,De)},ar.useMemo=function(he,De){return ae.H.useMemo(he,De)},ar.useOptimistic=function(he,De){return ae.H.useOptimistic(he,De)},ar.useReducer=function(he,De,qe){return ae.H.useReducer(he,De,qe)},ar.useRef=function(he){return ae.H.useRef(he)},ar.useState=function(he){return ae.H.useState(he)},ar.useSyncExternalStore=function(he,De,qe){return ae.H.useSyncExternalStore(he,De,qe)},ar.useTransition=function(){return ae.H.useTransition()},ar.version="19.1.0",ar}var wW;function XO(){return wW||(wW=1,_L.exports=dae()),_L.exports}var F=XO();const Ge=fR(F),kY=oae({__proto__:null,default:Ge},[F]);var EL={exports:{}},yw={},yL={exports:{}},vL={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RW;function uae(){return RW||(RW=1,function(a){function n(be,Ie){var Re=be.length;be.push(Ie);e:for(;0<Re;){var Me=Re-1>>>1,he=be[Me];if(0<l(he,Ie))be[Me]=Ie,be[Re]=he,Re=Me;else break e}}function i(be){return be.length===0?null:be[0]}function s(be){if(be.length===0)return null;var Ie=be[0],Re=be.pop();if(Re!==Ie){be[0]=Re;e:for(var Me=0,he=be.length,De=he>>>1;Me<De;){var qe=2*(Me+1)-1,We=be[qe],Be=qe+1,bt=be[Be];if(0>l(We,Re))Be<he&&0>l(bt,We)?(be[Me]=bt,be[Be]=Re,Me=Be):(be[Me]=We,be[qe]=Re,Me=qe);else if(Be<he&&0>l(bt,Re))be[Me]=bt,be[Be]=Re,Me=Be;else break e}}return Ie}function l(be,Ie){var Re=be.sortIndex-Ie.sortIndex;return Re!==0?Re:be.id-Ie.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var p=performance;a.unstable_now=function(){return p.now()}}else{var _=Date,T=_.now();a.unstable_now=function(){return _.now()-T}}var w=[],C=[],O=1,k=null,U=3,Y=!1,W=!1,ee=!1,K=!1,ie=typeof setTimeout=="function"?setTimeout:null,se=typeof clearTimeout=="function"?clearTimeout:null,ue=typeof setImmediate<"u"?setImmediate:null;function ye(be){for(var Ie=i(C);Ie!==null;){if(Ie.callback===null)s(C);else if(Ie.startTime<=be)s(C),Ie.sortIndex=Ie.expirationTime,n(w,Ie);else break;Ie=i(C)}}function ae(be){if(ee=!1,ye(be),!W)if(i(w)!==null)W=!0,ve||(ve=!0,fe());else{var Ie=i(C);Ie!==null&&Je(ae,Ie.startTime-be)}}var ve=!1,$=-1,Q=5,te=-1;function oe(){return K?!0:!(a.unstable_now()-te<Q)}function re(){if(K=!1,ve){var be=a.unstable_now();te=be;var Ie=!0;try{e:{W=!1,ee&&(ee=!1,se($),$=-1),Y=!0;var Re=U;try{t:{for(ye(be),k=i(w);k!==null&&!(k.expirationTime>be&&oe());){var Me=k.callback;if(typeof Me=="function"){k.callback=null,U=k.priorityLevel;var he=Me(k.expirationTime<=be);if(be=a.unstable_now(),typeof he=="function"){k.callback=he,ye(be),Ie=!0;break t}k===i(w)&&s(w),ye(be)}else s(w);k=i(w)}if(k!==null)Ie=!0;else{var De=i(C);De!==null&&Je(ae,De.startTime-be),Ie=!1}}break e}finally{k=null,U=Re,Y=!1}Ie=void 0}}finally{Ie?fe():ve=!1}}}var fe;if(typeof ue=="function")fe=function(){ue(re)};else if(typeof MessageChannel<"u"){var pe=new MessageChannel,Ne=pe.port2;pe.port1.onmessage=re,fe=function(){Ne.postMessage(null)}}else fe=function(){ie(re,0)};function Je(be,Ie){$=ie(function(){be(a.unstable_now())},Ie)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(be){be.callback=null},a.unstable_forceFrameRate=function(be){0>be||125<be?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<be?Math.floor(1e3/be):5},a.unstable_getCurrentPriorityLevel=function(){return U},a.unstable_next=function(be){switch(U){case 1:case 2:case 3:var Ie=3;break;default:Ie=U}var Re=U;U=Ie;try{return be()}finally{U=Re}},a.unstable_requestPaint=function(){K=!0},a.unstable_runWithPriority=function(be,Ie){switch(be){case 1:case 2:case 3:case 4:case 5:break;default:be=3}var Re=U;U=be;try{return Ie()}finally{U=Re}},a.unstable_scheduleCallback=function(be,Ie,Re){var Me=a.unstable_now();switch(typeof Re=="object"&&Re!==null?(Re=Re.delay,Re=typeof Re=="number"&&0<Re?Me+Re:Me):Re=Me,be){case 1:var he=-1;break;case 2:he=250;break;case 5:he=1073741823;break;case 4:he=1e4;break;default:he=5e3}return he=Re+he,be={id:O++,callback:Ie,priorityLevel:be,startTime:Re,expirationTime:he,sortIndex:-1},Re>Me?(be.sortIndex=Re,n(C,be),i(w)===null&&be===i(C)&&(ee?(se($),$=-1):ee=!0,Je(ae,Re-Me))):(be.sortIndex=he,n(w,be),W||Y||(W=!0,ve||(ve=!0,fe()))),be},a.unstable_shouldYield=oe,a.unstable_wrapCallback=function(be){var Ie=U;return function(){var Re=U;U=Ie;try{return be.apply(this,arguments)}finally{U=Re}}}}(vL)),vL}var CW;function hae(){return CW||(CW=1,yL.exports=uae()),yL.exports}var SL={exports:{}},ao={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AW;function pae(){if(AW)return ao;AW=1;var a=XO();function n(w){var C="https://react.dev/errors/"+w;if(1<arguments.length){C+="?args[]="+encodeURIComponent(arguments[1]);for(var O=2;O<arguments.length;O++)C+="&args[]="+encodeURIComponent(arguments[O])}return"Minified React error #"+w+"; visit "+C+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var s={d:{f:i,r:function(){throw Error(n(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},l=Symbol.for("react.portal");function p(w,C,O){var k=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:k==null?null:""+k,children:w,containerInfo:C,implementation:O}}var _=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function T(w,C){if(w==="font")return"";if(typeof C=="string")return C==="use-credentials"?C:""}return ao.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,ao.createPortal=function(w,C){var O=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!C||C.nodeType!==1&&C.nodeType!==9&&C.nodeType!==11)throw Error(n(299));return p(w,C,null,O)},ao.flushSync=function(w){var C=_.T,O=s.p;try{if(_.T=null,s.p=2,w)return w()}finally{_.T=C,s.p=O,s.d.f()}},ao.preconnect=function(w,C){typeof w=="string"&&(C?(C=C.crossOrigin,C=typeof C=="string"?C==="use-credentials"?C:"":void 0):C=null,s.d.C(w,C))},ao.prefetchDNS=function(w){typeof w=="string"&&s.d.D(w)},ao.preinit=function(w,C){if(typeof w=="string"&&C&&typeof C.as=="string"){var O=C.as,k=T(O,C.crossOrigin),U=typeof C.integrity=="string"?C.integrity:void 0,Y=typeof C.fetchPriority=="string"?C.fetchPriority:void 0;O==="style"?s.d.S(w,typeof C.precedence=="string"?C.precedence:void 0,{crossOrigin:k,integrity:U,fetchPriority:Y}):O==="script"&&s.d.X(w,{crossOrigin:k,integrity:U,fetchPriority:Y,nonce:typeof C.nonce=="string"?C.nonce:void 0})}},ao.preinitModule=function(w,C){if(typeof w=="string")if(typeof C=="object"&&C!==null){if(C.as==null||C.as==="script"){var O=T(C.as,C.crossOrigin);s.d.M(w,{crossOrigin:O,integrity:typeof C.integrity=="string"?C.integrity:void 0,nonce:typeof C.nonce=="string"?C.nonce:void 0})}}else C==null&&s.d.M(w)},ao.preload=function(w,C){if(typeof w=="string"&&typeof C=="object"&&C!==null&&typeof C.as=="string"){var O=C.as,k=T(O,C.crossOrigin);s.d.L(w,O,{crossOrigin:k,integrity:typeof C.integrity=="string"?C.integrity:void 0,nonce:typeof C.nonce=="string"?C.nonce:void 0,type:typeof C.type=="string"?C.type:void 0,fetchPriority:typeof C.fetchPriority=="string"?C.fetchPriority:void 0,referrerPolicy:typeof C.referrerPolicy=="string"?C.referrerPolicy:void 0,imageSrcSet:typeof C.imageSrcSet=="string"?C.imageSrcSet:void 0,imageSizes:typeof C.imageSizes=="string"?C.imageSizes:void 0,media:typeof C.media=="string"?C.media:void 0})}},ao.preloadModule=function(w,C){if(typeof w=="string")if(C){var O=T(C.as,C.crossOrigin);s.d.m(w,{as:typeof C.as=="string"&&C.as!=="script"?C.as:void 0,crossOrigin:O,integrity:typeof C.integrity=="string"?C.integrity:void 0})}else s.d.m(w)},ao.requestFormReset=function(w){s.d.r(w)},ao.unstable_batchedUpdates=function(w,C){return w(C)},ao.useFormState=function(w,C,O){return _.H.useFormState(w,C,O)},ao.useFormStatus=function(){return _.H.useHostTransitionStatus()},ao.version="19.1.0",ao}var IW;function LY(){if(IW)return SL.exports;IW=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(n){console.error(n)}}return a(),SL.exports=pae(),SL.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NW;function fae(){if(NW)return yw;NW=1;var a=hae(),n=XO(),i=LY();function s(d){var h="https://react.dev/errors/"+d;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)h+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+d+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function p(d){var h=d,y=d;if(d.alternate)for(;h.return;)h=h.return;else{d=h;do h=d,(h.flags&4098)!==0&&(y=h.return),d=h.return;while(d)}return h.tag===3?y:null}function _(d){if(d.tag===13){var h=d.memoizedState;if(h===null&&(d=d.alternate,d!==null&&(h=d.memoizedState)),h!==null)return h.dehydrated}return null}function T(d){if(p(d)!==d)throw Error(s(188))}function w(d){var h=d.alternate;if(!h){if(h=p(d),h===null)throw Error(s(188));return h!==d?null:d}for(var y=d,b=h;;){var N=y.return;if(N===null)break;var P=N.alternate;if(P===null){if(b=N.return,b!==null){y=b;continue}break}if(N.child===P.child){for(P=N.child;P;){if(P===y)return T(N),d;if(P===b)return T(N),h;P=P.sibling}throw Error(s(188))}if(y.return!==b.return)y=N,b=P;else{for(var J=!1,le=N.child;le;){if(le===y){J=!0,y=N,b=P;break}if(le===b){J=!0,b=N,y=P;break}le=le.sibling}if(!J){for(le=P.child;le;){if(le===y){J=!0,y=P,b=N;break}if(le===b){J=!0,b=P,y=N;break}le=le.sibling}if(!J)throw Error(s(189))}}if(y.alternate!==b)throw Error(s(190))}if(y.tag!==3)throw Error(s(188));return y.stateNode.current===y?d:h}function C(d){var h=d.tag;if(h===5||h===26||h===27||h===6)return d;for(d=d.child;d!==null;){if(h=C(d),h!==null)return h;d=d.sibling}return null}var O=Object.assign,k=Symbol.for("react.element"),U=Symbol.for("react.transitional.element"),Y=Symbol.for("react.portal"),W=Symbol.for("react.fragment"),ee=Symbol.for("react.strict_mode"),K=Symbol.for("react.profiler"),ie=Symbol.for("react.provider"),se=Symbol.for("react.consumer"),ue=Symbol.for("react.context"),ye=Symbol.for("react.forward_ref"),ae=Symbol.for("react.suspense"),ve=Symbol.for("react.suspense_list"),$=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),te=Symbol.for("react.activity"),oe=Symbol.for("react.memo_cache_sentinel"),re=Symbol.iterator;function fe(d){return d===null||typeof d!="object"?null:(d=re&&d[re]||d["@@iterator"],typeof d=="function"?d:null)}var pe=Symbol.for("react.client.reference");function Ne(d){if(d==null)return null;if(typeof d=="function")return d.$$typeof===pe?null:d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case W:return"Fragment";case K:return"Profiler";case ee:return"StrictMode";case ae:return"Suspense";case ve:return"SuspenseList";case te:return"Activity"}if(typeof d=="object")switch(d.$$typeof){case Y:return"Portal";case ue:return(d.displayName||"Context")+".Provider";case se:return(d._context.displayName||"Context")+".Consumer";case ye:var h=d.render;return d=d.displayName,d||(d=h.displayName||h.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case $:return h=d.displayName||null,h!==null?h:Ne(d.type)||"Memo";case Q:h=d._payload,d=d._init;try{return Ne(d(h))}catch{}}return null}var Je=Array.isArray,be=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ie=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Re={pending:!1,data:null,method:null,action:null},Me=[],he=-1;function De(d){return{current:d}}function qe(d){0>he||(d.current=Me[he],Me[he]=null,he--)}function We(d,h){he++,Me[he]=d.current,d.current=h}var Be=De(null),bt=De(null),St=De(null),Tt=De(null);function ut(d,h){switch(We(St,h),We(bt,d),We(Be,null),h.nodeType){case 9:case 11:d=(d=h.documentElement)&&(d=d.namespaceURI)?rC(d):0;break;default:if(d=h.tagName,h=h.namespaceURI)h=rC(h),d=iC(h,d);else switch(d){case"svg":d=1;break;case"math":d=2;break;default:d=0}}qe(Be),We(Be,d)}function tn(){qe(Be),qe(bt),qe(St)}function Mt(d){d.memoizedState!==null&&We(Tt,d);var h=Be.current,y=iC(h,d.type);h!==y&&(We(bt,d),We(Be,y))}function wn(d){bt.current===d&&(qe(Be),qe(bt)),Tt.current===d&&(qe(Tt),gg._currentValue=Re)}var Yt=Object.prototype.hasOwnProperty,Xn=a.unstable_scheduleCallback,Ot=a.unstable_cancelCallback,en=a.unstable_shouldYield,Dt=a.unstable_requestPaint,mt=a.unstable_now,kt=a.unstable_getCurrentPriorityLevel,Gt=a.unstable_ImmediatePriority,Mn=a.unstable_UserBlockingPriority,Ci=a.unstable_NormalPriority,bs=a.unstable_LowPriority,Rr=a.unstable_IdlePriority,kn=a.log,Mi=a.unstable_setDisableYieldValue,Ht=null,sn=null;function wt(d){if(typeof kn=="function"&&Mi(d),sn&&typeof sn.setStrictMode=="function")try{sn.setStrictMode(Ht,d)}catch{}}var mn=Math.clz32?Math.clz32:ai,jn=Math.log,Ei=Math.LN2;function ai(d){return d>>>=0,d===0?32:31-(jn(d)/Ei|0)|0}var Cr=256,ji=4194304;function zi(d){var h=d&42;if(h!==0)return h;switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return d&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return d}}function ws(d,h,y){var b=d.pendingLanes;if(b===0)return 0;var N=0,P=d.suspendedLanes,J=d.pingedLanes;d=d.warmLanes;var le=b&134217727;return le!==0?(b=le&~P,b!==0?N=zi(b):(J&=le,J!==0?N=zi(J):y||(y=le&~d,y!==0&&(N=zi(y))))):(le=b&~P,le!==0?N=zi(le):J!==0?N=zi(J):y||(y=b&~d,y!==0&&(N=zi(y)))),N===0?0:h!==0&&h!==N&&(h&P)===0&&(P=N&-N,y=h&-h,P>=y||P===32&&(y&4194048)!==0)?h:N}function ua(d,h){return(d.pendingLanes&~(d.suspendedLanes&~d.pingedLanes)&h)===0}function Fs(d,h){switch(d){case 1:case 2:case 4:case 8:case 64:return h+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Wa(){var d=Cr;return Cr<<=1,(Cr&4194048)===0&&(Cr=256),d}function je(){var d=ji;return ji<<=1,(ji&62914560)===0&&(ji=4194304),d}function nn(d){for(var h=[],y=0;31>y;y++)h.push(d);return h}function yn(d,h){d.pendingLanes|=h,h!==268435456&&(d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0)}function nr(d,h,y,b,N,P){var J=d.pendingLanes;d.pendingLanes=y,d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0,d.expiredLanes&=y,d.entangledLanes&=y,d.errorRecoveryDisabledLanes&=y,d.shellSuspendCounter=0;var le=d.entanglements,we=d.expirationTimes,Fe=d.hiddenUpdates;for(y=J&~y;0<y;){var it=31-mn(y),gt=1<<it;le[it]=0,we[it]=-1;var Ke=Fe[it];if(Ke!==null)for(Fe[it]=null,it=0;it<Ke.length;it++){var Xe=Ke[it];Xe!==null&&(Xe.lane&=-536870913)}y&=~gt}b!==0&&Qe(d,b,0),P!==0&&N===0&&d.tag!==0&&(d.suspendedLanes|=P&~(J&~h))}function Qe(d,h,y){d.pendingLanes|=h,d.suspendedLanes&=~h;var b=31-mn(h);d.entangledLanes|=h,d.entanglements[b]=d.entanglements[b]|1073741824|y&4194090}function Kt(d,h){var y=d.entangledLanes|=h;for(d=d.entanglements;y;){var b=31-mn(y),N=1<<b;N&h|d[b]&h&&(d[b]|=h),y&=~N}}function un(d){switch(d){case 2:d=1;break;case 8:d=4;break;case 32:d=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:d=128;break;case 268435456:d=134217728;break;default:d=0}return d}function rn(d){return d&=-d,2<d?8<d?(d&134217727)!==0?32:268435456:8:2}function Dn(){var d=Ie.p;return d!==0?d:(d=window.event,d===void 0?32:TC(d.type))}function Ai(d,h){var y=Ie.p;try{return Ie.p=d,h()}finally{Ie.p=y}}var ln=Math.random().toString(36).slice(2),mr="__reactFiber$"+ln,yr="__reactProps$"+ln,oi="__reactContainer$"+ln,Bs="__reactEvents$"+ln,fo="__reactListeners$"+ln,Hs="__reactHandles$"+ln,Gc="__reactResources$"+ln,za="__reactMarker$"+ln;function Ra(d){delete d[mr],delete d[yr],delete d[Bs],delete d[fo],delete d[Hs]}function Uo(d){var h=d[mr];if(h)return h;for(var y=d.parentNode;y;){if(h=y[oi]||y[mr]){if(y=h.alternate,h.child!==null||y!==null&&y.child!==null)for(d=cC(d);d!==null;){if(y=d[mr])return y;d=cC(d)}return h}d=y,y=d.parentNode}return null}function mo(d){if(d=d[mr]||d[oi]){var h=d.tag;if(h===5||h===6||h===13||h===26||h===27||h===3)return d}return null}function go(d){var h=d.tag;if(h===5||h===26||h===27||h===6)return d.stateNode;throw Error(s(33))}function Rs(d){var h=d[Gc];return h||(h=d[Gc]={hoistableStyles:new Map,hoistableScripts:new Map}),h}function Ui(d){d[za]=!0}var Wu=new Set,zu={};function ha(d,h){Ll(d,h),Ll(d+"Capture",h)}function Ll(d,h){for(zu[d]=h,d=0;d<h.length;d++)Wu.add(h[d])}var B_=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),_o={},Yu={};function H_(d){return Yt.call(Yu,d)?!0:Yt.call(_o,d)?!1:B_.test(d)?Yu[d]=!0:(_o[d]=!0,!1)}function ci(d,h,y){if(H_(h))if(y===null)d.removeAttribute(h);else{switch(typeof y){case"undefined":case"function":case"symbol":d.removeAttribute(h);return;case"boolean":var b=h.toLowerCase().slice(0,5);if(b!=="data-"&&b!=="aria-"){d.removeAttribute(h);return}}d.setAttribute(h,""+y)}}function Wc(d,h,y){if(y===null)d.removeAttribute(h);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":d.removeAttribute(h);return}d.setAttribute(h,""+y)}}function ta(d,h,y,b){if(b===null)d.removeAttribute(y);else{switch(typeof b){case"undefined":case"function":case"symbol":case"boolean":d.removeAttribute(y);return}d.setAttributeNS(h,y,""+b)}}var qu,G_;function hc(d){if(qu===void 0)try{throw Error()}catch(y){var h=y.stack.trim().match(/\n( *(at )?)/);qu=h&&h[1]||"",G_=-1<y.stack.indexOf(`
    at`)?" (<anonymous>)":-1<y.stack.indexOf("@")?"@unknown:0:0":""}return`
`+qu+d+G_}var _p=!1;function Ku(d,h){if(!d||_p)return"";_p=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var b={DetermineComponentFrameRoot:function(){try{if(h){var gt=function(){throw Error()};if(Object.defineProperty(gt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(gt,[])}catch(Xe){var Ke=Xe}Reflect.construct(d,[],gt)}else{try{gt.call()}catch(Xe){Ke=Xe}d.call(gt.prototype)}}else{try{throw Error()}catch(Xe){Ke=Xe}(gt=d())&&typeof gt.catch=="function"&&gt.catch(function(){})}}catch(Xe){if(Xe&&Ke&&typeof Xe.stack=="string")return[Xe.stack,Ke.stack]}return[null,null]}};b.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var N=Object.getOwnPropertyDescriptor(b.DetermineComponentFrameRoot,"name");N&&N.configurable&&Object.defineProperty(b.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var P=b.DetermineComponentFrameRoot(),J=P[0],le=P[1];if(J&&le){var we=J.split(`
`),Fe=le.split(`
`);for(N=b=0;b<we.length&&!we[b].includes("DetermineComponentFrameRoot");)b++;for(;N<Fe.length&&!Fe[N].includes("DetermineComponentFrameRoot");)N++;if(b===we.length||N===Fe.length)for(b=we.length-1,N=Fe.length-1;1<=b&&0<=N&&we[b]!==Fe[N];)N--;for(;1<=b&&0<=N;b--,N--)if(we[b]!==Fe[N]){if(b!==1||N!==1)do if(b--,N--,0>N||we[b]!==Fe[N]){var it=`
`+we[b].replace(" at new "," at ");return d.displayName&&it.includes("<anonymous>")&&(it=it.replace("<anonymous>",d.displayName)),it}while(1<=b&&0<=N);break}}}finally{_p=!1,Error.prepareStackTrace=y}return(y=d?d.displayName||d.name:"")?hc(y):""}function cm(d){switch(d.tag){case 26:case 27:case 5:return hc(d.type);case 16:return hc("Lazy");case 13:return hc("Suspense");case 19:return hc("SuspenseList");case 0:case 15:return Ku(d.type,!1);case 11:return Ku(d.type.render,!1);case 1:return Ku(d.type,!0);case 31:return hc("Activity");default:return""}}function Ep(d){try{var h="";do h+=cm(d),d=d.return;while(d);return h}catch(y){return`
Error generating stack: `+y.message+`
`+y.stack}}function Ca(d){switch(typeof d){case"bigint":case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function zc(d){var h=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function lm(d){var h=zc(d)?"checked":"value",y=Object.getOwnPropertyDescriptor(d.constructor.prototype,h),b=""+d[h];if(!d.hasOwnProperty(h)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var N=y.get,P=y.set;return Object.defineProperty(d,h,{configurable:!0,get:function(){return N.call(this)},set:function(J){b=""+J,P.call(this,J)}}),Object.defineProperty(d,h,{enumerable:y.enumerable}),{getValue:function(){return b},setValue:function(J){b=""+J},stopTracking:function(){d._valueTracker=null,delete d[h]}}}}function yp(d){d._valueTracker||(d._valueTracker=lm(d))}function Mr(d){if(!d)return!1;var h=d._valueTracker;if(!h)return!0;var y=h.getValue(),b="";return d&&(b=zc(d)?d.checked?"true":"false":d.value),d=b,d!==y?(h.setValue(d),!0):!1}function Xu(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}var W_=/[\n"\\]/g;function es(d){return d.replace(W_,function(h){return"\\"+h.charCodeAt(0).toString(16)+" "})}function Eo(d,h,y,b,N,P,J,le){d.name="",J!=null&&typeof J!="function"&&typeof J!="symbol"&&typeof J!="boolean"?d.type=J:d.removeAttribute("type"),h!=null?J==="number"?(h===0&&d.value===""||d.value!=h)&&(d.value=""+Ca(h)):d.value!==""+Ca(h)&&(d.value=""+Ca(h)):J!=="submit"&&J!=="reset"||d.removeAttribute("value"),h!=null?Ad(d,J,Ca(h)):y!=null?Ad(d,J,Ca(y)):b!=null&&d.removeAttribute("value"),N==null&&P!=null&&(d.defaultChecked=!!P),N!=null&&(d.checked=N&&typeof N!="function"&&typeof N!="symbol"),le!=null&&typeof le!="function"&&typeof le!="symbol"&&typeof le!="boolean"?d.name=""+Ca(le):d.removeAttribute("name")}function Qu(d,h,y,b,N,P,J,le){if(P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(d.type=P),h!=null||y!=null){if(!(P!=="submit"&&P!=="reset"||h!=null))return;y=y!=null?""+Ca(y):"",h=h!=null?""+Ca(h):y,le||h===d.value||(d.value=h),d.defaultValue=h}b=b??N,b=typeof b!="function"&&typeof b!="symbol"&&!!b,d.checked=le?d.checked:!!b,d.defaultChecked=!!b,J!=null&&typeof J!="function"&&typeof J!="symbol"&&typeof J!="boolean"&&(d.name=J)}function Ad(d,h,y){h==="number"&&Xu(d.ownerDocument)===d||d.defaultValue===""+y||(d.defaultValue=""+y)}function Ml(d,h,y,b){if(d=d.options,h){h={};for(var N=0;N<y.length;N++)h["$"+y[N]]=!0;for(y=0;y<d.length;y++)N=h.hasOwnProperty("$"+d[y].value),d[y].selected!==N&&(d[y].selected=N),N&&b&&(d[y].defaultSelected=!0)}else{for(y=""+Ca(y),h=null,N=0;N<d.length;N++){if(d[N].value===y){d[N].selected=!0,b&&(d[N].defaultSelected=!0);return}h!==null||d[N].disabled||(h=d[N])}h!==null&&(h.selected=!0)}}function Zr(d,h,y){if(h!=null&&(h=""+Ca(h),h!==d.value&&(d.value=h),y==null)){d.defaultValue!==h&&(d.defaultValue=h);return}d.defaultValue=y!=null?""+Ca(y):""}function $u(d,h,y,b){if(h==null){if(b!=null){if(y!=null)throw Error(s(92));if(Je(b)){if(1<b.length)throw Error(s(93));b=b[0]}y=b}y==null&&(y=""),h=y}y=Ca(h),d.defaultValue=y,b=d.textContent,b===y&&b!==""&&b!==null&&(d.value=b)}function Ya(d,h){if(h){var y=d.firstChild;if(y&&y===d.lastChild&&y.nodeType===3){y.nodeValue=h;return}}d.textContent=h}var Id=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function vp(d,h,y){var b=h.indexOf("--")===0;y==null||typeof y=="boolean"||y===""?b?d.setProperty(h,""):h==="float"?d.cssFloat="":d[h]="":b?d.setProperty(h,y):typeof y!="number"||y===0||Id.has(h)?h==="float"?d.cssFloat=y:d[h]=(""+y).trim():d[h]=y+"px"}function dm(d,h,y){if(h!=null&&typeof h!="object")throw Error(s(62));if(d=d.style,y!=null){for(var b in y)!y.hasOwnProperty(b)||h!=null&&h.hasOwnProperty(b)||(b.indexOf("--")===0?d.setProperty(b,""):b==="float"?d.cssFloat="":d[b]="");for(var N in h)b=h[N],h.hasOwnProperty(N)&&y[N]!==b&&vp(d,N,b)}else for(var P in h)h.hasOwnProperty(P)&&vp(d,P,h[P])}function Ju(d){if(d.indexOf("-")===-1)return!1;switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dS=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),z_=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Sp(d){return z_.test(""+d)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":d}var jl=null;function Vo(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var Ul=null,Vl=null;function um(d){var h=mo(d);if(h&&(d=h.stateNode)){var y=d[yr]||null;e:switch(d=h.stateNode,h.type){case"input":if(Eo(d,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name),h=y.name,y.type==="radio"&&h!=null){for(y=d;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll('input[name="'+es(""+h)+'"][type="radio"]'),h=0;h<y.length;h++){var b=y[h];if(b!==d&&b.form===d.form){var N=b[yr]||null;if(!N)throw Error(s(90));Eo(b,N.value,N.defaultValue,N.defaultValue,N.checked,N.defaultChecked,N.type,N.name)}}for(h=0;h<y.length;h++)b=y[h],b.form===d.form&&Mr(b)}break e;case"textarea":Zr(d,y.value,y.defaultValue);break e;case"select":h=y.value,h!=null&&Ml(d,!!y.multiple,h,!1)}}}var Yc=!1;function Y_(d,h,y){if(Yc)return d(h,y);Yc=!0;try{var b=d(h);return b}finally{if(Yc=!1,(Ul!==null||Vl!==null)&&(Ch(),Ul&&(h=Ul,d=Vl,Vl=Ul=null,um(h),d)))for(h=0;h<d.length;h++)um(d[h])}}function Nd(d,h){var y=d.stateNode;if(y===null)return null;var b=y[yr]||null;if(b===null)return null;y=b[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(b=!b.disabled)||(d=d.type,b=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!b;break e;default:d=!1}if(d)return null;if(y&&typeof y!="function")throw Error(s(231,h,typeof y));return y}var pc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fo=!1;if(pc)try{var Zu={};Object.defineProperty(Zu,"passive",{get:function(){Fo=!0}}),window.addEventListener("test",Zu,Zu),window.removeEventListener("test",Zu,Zu)}catch{Fo=!1}var qa=null,Od=null,Fl=null;function hm(){if(Fl)return Fl;var d,h=Od,y=h.length,b,N="value"in qa?qa.value:qa.textContent,P=N.length;for(d=0;d<y&&h[d]===N[d];d++);var J=y-d;for(b=1;b<=J&&h[y-b]===N[P-b];b++);return Fl=N.slice(d,1<b?1-b:void 0)}function qc(d){var h=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&h===13&&(d=13)):d=h,d===10&&(d=13),32<=d||d===13?d:0}function fc(){return!0}function pm(){return!1}function Gs(d){function h(y,b,N,P,J){this._reactName=y,this._targetInst=N,this.type=b,this.nativeEvent=P,this.target=J,this.currentTarget=null;for(var le in d)d.hasOwnProperty(le)&&(y=d[le],this[le]=y?y(P):P[le]);return this.isDefaultPrevented=(P.defaultPrevented!=null?P.defaultPrevented:P.returnValue===!1)?fc:pm,this.isPropagationStopped=pm,this}return O(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=fc)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=fc)},persist:function(){},isPersistent:fc}),h}var Yr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yo=Gs(Yr),Ws=O({},Yr,{view:0,detail:0}),fm=Gs(Ws),Tp,bp,Kc,ts=O({},Ws,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:rh,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==Kc&&(Kc&&d.type==="mousemove"?(Tp=d.screenX-Kc.screenX,bp=d.screenY-Kc.screenY):bp=Tp=0,Kc=d),Tp)},movementY:function(d){return"movementY"in d?d.movementY:bp}}),Bo=Gs(ts),q_=O({},ts,{dataTransfer:0}),uS=Gs(q_),Xc=O({},Ws,{relatedTarget:0}),eh=Gs(Xc),mm=O({},Yr,{animationName:0,elapsedTime:0,pseudoElement:0}),Dd=Gs(mm),K_=O({},Yr,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),xd=Gs(K_),gm=O({},Yr,{data:0}),th=Gs(gm),nh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},X_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Qc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Bl(d){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(d):(d=Qc[d])?!!h[d]:!1}function rh(){return Bl}var Q_=O({},Ws,{key:function(d){if(d.key){var h=nh[d.key]||d.key;if(h!=="Unidentified")return h}return d.type==="keypress"?(d=qc(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?X_[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:rh,charCode:function(d){return d.type==="keypress"?qc(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?qc(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),wp=Gs(Q_),$_=O({},ts,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_m=Gs($_),Ka=O({},Ws,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:rh}),J_=Gs(Ka),Hl=O({},Yr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Em=Gs(Hl),Z_=O({},ts,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),xn=Gs(Z_),Aa=O({},Yr,{newState:0,oldState:0}),eE=Gs(Aa),tE=[9,13,27,32],$c=pc&&"CompositionEvent"in window,A=null;pc&&"documentMode"in document&&(A=document.documentMode);var B=pc&&"TextEvent"in window&&!A,X=pc&&(!$c||A&&8<A&&11>=A),ge=" ",Ue=!1;function Ze(d,h){switch(d){case"keyup":return tE.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function It(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var vr=!1;function Cs(d,h){switch(d){case"compositionend":return It(h);case"keypress":return h.which!==32?null:(Ue=!0,ge);case"textInput":return d=h.data,d===ge&&Ue?null:d;default:return null}}function Yn(d,h){if(vr)return d==="compositionend"||!$c&&Ze(d,h)?(d=hm(),Fl=Od=qa=null,vr=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return X&&h.locale!=="ko"?null:h.data;default:return null}}var zs={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function As(d){var h=d&&d.nodeName&&d.nodeName.toLowerCase();return h==="input"?!!zs[d.type]:h==="textarea"}function Gl(d,h,y,b){Ul?Vl?Vl.push(b):Vl=[b]:Ul=b,h=lg(h,"onChange"),0<h.length&&(y=new yo("onChange","change",null,y,b),d.push({event:y,listeners:h}))}var Ys=null,Ho=null;function ym(d){JE(d,0)}function nE(d){var h=go(d);if(Mr(h))return d}function DR(d,h){if(d==="change")return h}var vo=!1;if(pc){var hS;if(pc){var pS="oninput"in document;if(!pS){var xR=document.createElement("div");xR.setAttribute("oninput","return;"),pS=typeof xR.oninput=="function"}hS=pS}else hS=!1;vo=hS&&(!document.documentMode||9<document.documentMode)}function PR(){Ys&&(Ys.detachEvent("onpropertychange",fS),Ho=Ys=null)}function fS(d){if(d.propertyName==="value"&&nE(Ho)){var h=[];Gl(h,Ho,d,Vo(d)),Y_(ym,h)}}function BD(d,h,y){d==="focusin"?(PR(),Ys=h,Ho=y,Ys.attachEvent("onpropertychange",fS)):d==="focusout"&&PR()}function HD(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return nE(Ho)}function kR(d,h){if(d==="click")return nE(h)}function mS(d,h){if(d==="input"||d==="change")return nE(h)}function GD(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var So=typeof Object.is=="function"?Object.is:GD;function Pd(d,h){if(So(d,h))return!0;if(typeof d!="object"||d===null||typeof h!="object"||h===null)return!1;var y=Object.keys(d),b=Object.keys(h);if(y.length!==b.length)return!1;for(b=0;b<y.length;b++){var N=y[b];if(!Yt.call(h,N)||!So(d[N],h[N]))return!1}return!0}function LR(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function MR(d,h){var y=LR(d);d=0;for(var b;y;){if(y.nodeType===3){if(b=d+y.textContent.length,d<=h&&b>=h)return{node:y,offset:h-d};d=b}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=LR(y)}}function jR(d,h){return d&&h?d===h?!0:d&&d.nodeType===3?!1:h&&h.nodeType===3?jR(d,h.parentNode):"contains"in d?d.contains(h):d.compareDocumentPosition?!!(d.compareDocumentPosition(h)&16):!1:!1}function Wl(d){d=d!=null&&d.ownerDocument!=null&&d.ownerDocument.defaultView!=null?d.ownerDocument.defaultView:window;for(var h=Xu(d.document);h instanceof d.HTMLIFrameElement;){try{var y=typeof h.contentWindow.location.href=="string"}catch{y=!1}if(y)d=h.contentWindow;else break;h=Xu(d.document)}return h}function gS(d){var h=d&&d.nodeName&&d.nodeName.toLowerCase();return h&&(h==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||h==="textarea"||d.contentEditable==="true")}var WD=pc&&"documentMode"in document&&11>=document.documentMode,Is=null,_S=null,vm=null,ES=!1;function UR(d,h,y){var b=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;ES||Is==null||Is!==Xu(b)||(b=Is,"selectionStart"in b&&gS(b)?b={start:b.selectionStart,end:b.selectionEnd}:(b=(b.ownerDocument&&b.ownerDocument.defaultView||window).getSelection(),b={anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}),vm&&Pd(vm,b)||(vm=b,b=lg(_S,"onSelect"),0<b.length&&(h=new yo("onSelect","select",null,h,y),d.push({event:h,listeners:b}),h.target=Is)))}function kd(d,h){var y={};return y[d.toLowerCase()]=h.toLowerCase(),y["Webkit"+d]="webkit"+h,y["Moz"+d]="moz"+h,y}var Rp={animationend:kd("Animation","AnimationEnd"),animationiteration:kd("Animation","AnimationIteration"),animationstart:kd("Animation","AnimationStart"),transitionrun:kd("Transition","TransitionRun"),transitionstart:kd("Transition","TransitionStart"),transitioncancel:kd("Transition","TransitionCancel"),transitionend:kd("Transition","TransitionEnd")},yS={},VR={};pc&&(VR=document.createElement("div").style,"AnimationEvent"in window||(delete Rp.animationend.animation,delete Rp.animationiteration.animation,delete Rp.animationstart.animation),"TransitionEvent"in window||delete Rp.transitionend.transition);function Ld(d){if(yS[d])return yS[d];if(!Rp[d])return d;var h=Rp[d],y;for(y in h)if(h.hasOwnProperty(y)&&y in VR)return yS[d]=h[y];return d}var FR=Ld("animationend"),BR=Ld("animationiteration"),rE=Ld("animationstart"),vS=Ld("transitionrun"),zD=Ld("transitionstart"),et=Ld("transitioncancel"),HR=Ld("transitionend"),GR=new Map,SS="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");SS.push("scrollEnd");function mc(d,h){GR.set(d,h),ha(h,[d])}var TS=new WeakMap;function To(d,h){if(typeof d=="object"&&d!==null){var y=TS.get(d);return y!==void 0?y:(h={value:d,source:h,stack:Ep(h)},TS.set(d,h),h)}return{value:d,source:h,stack:Ep(h)}}var Go=[],Cp=0,bS=0;function ih(){for(var d=Cp,h=bS=Cp=0;h<d;){var y=Go[h];Go[h++]=null;var b=Go[h];Go[h++]=null;var N=Go[h];Go[h++]=null;var P=Go[h];if(Go[h++]=null,b!==null&&N!==null){var J=b.pending;J===null?N.next=N:(N.next=J.next,J.next=N),b.pending=N}P!==0&&Sm(y,N,P)}}function Md(d,h,y,b){Go[Cp++]=d,Go[Cp++]=h,Go[Cp++]=y,Go[Cp++]=b,bS|=b,d.lanes|=b,d=d.alternate,d!==null&&(d.lanes|=b)}function wS(d,h,y,b){return Md(d,h,y,b),Ip(d)}function Ap(d,h){return Md(d,null,null,h),Ip(d)}function Sm(d,h,y){d.lanes|=y;var b=d.alternate;b!==null&&(b.lanes|=y);for(var N=!1,P=d.return;P!==null;)P.childLanes|=y,b=P.alternate,b!==null&&(b.childLanes|=y),P.tag===22&&(d=P.stateNode,d===null||d._visibility&1||(N=!0)),d=P,P=P.return;return d.tag===3?(P=d.stateNode,N&&h!==null&&(N=31-mn(y),d=P.hiddenUpdates,b=d[N],b===null?d[N]=[h]:b.push(h),h.lane=y|536870912),P):null}function Ip(d){if(50<ag)throw ag=0,ST=null,Error(s(185));for(var h=d.return;h!==null;)d=h,h=d.return;return d.tag===3?d.stateNode:null}var zl={};function YD(d,h,y,b){this.tag=d,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function bo(d,h,y,b){return new YD(d,h,y,b)}function RS(d){return d=d.prototype,!(!d||!d.isReactComponent)}function Yl(d,h){var y=d.alternate;return y===null?(y=bo(d.tag,h,d.key,d.mode),y.elementType=d.elementType,y.type=d.type,y.stateNode=d.stateNode,y.alternate=d,d.alternate=y):(y.pendingProps=h,y.type=d.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=d.flags&65011712,y.childLanes=d.childLanes,y.lanes=d.lanes,y.child=d.child,y.memoizedProps=d.memoizedProps,y.memoizedState=d.memoizedState,y.updateQueue=d.updateQueue,h=d.dependencies,y.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},y.sibling=d.sibling,y.index=d.index,y.ref=d.ref,y.refCleanup=d.refCleanup,y}function iE(d,h){d.flags&=65011714;var y=d.alternate;return y===null?(d.childLanes=0,d.lanes=h,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=y.childLanes,d.lanes=y.lanes,d.child=y.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=y.memoizedProps,d.memoizedState=y.memoizedState,d.updateQueue=y.updateQueue,d.type=y.type,h=y.dependencies,d.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),d}function sE(d,h,y,b,N,P){var J=0;if(b=d,typeof d=="function")RS(d)&&(J=1);else if(typeof d=="string")J=$T(d,y,Be.current)?26:d==="html"||d==="head"||d==="body"?27:5;else e:switch(d){case te:return d=bo(31,y,h,N),d.elementType=te,d.lanes=P,d;case W:return jd(y.children,N,P,h);case ee:J=8,N|=24;break;case K:return d=bo(12,y,h,N|2),d.elementType=K,d.lanes=P,d;case ae:return d=bo(13,y,h,N),d.elementType=ae,d.lanes=P,d;case ve:return d=bo(19,y,h,N),d.elementType=ve,d.lanes=P,d;default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case ie:case ue:J=10;break e;case se:J=9;break e;case ye:J=11;break e;case $:J=14;break e;case Q:J=16,b=null;break e}J=29,y=Error(s(130,d===null?"null":typeof d,"")),b=null}return h=bo(J,y,h,N),h.elementType=d,h.type=b,h.lanes=P,h}function jd(d,h,y,b){return d=bo(7,d,b,h),d.lanes=y,d}function Xa(d,h,y){return d=bo(6,d,null,h),d.lanes=y,d}function CS(d,h,y){return h=bo(4,d.children!==null?d.children:[],d.key,h),h.lanes=y,h.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},h}var Jc=[],Np=0,aE=null,oE=0,wo=[],Wo=0,sh=null,ql=1,gc="";function ah(d,h){Jc[Np++]=oE,Jc[Np++]=aE,aE=d,oE=h}function AS(d,h,y){wo[Wo++]=ql,wo[Wo++]=gc,wo[Wo++]=sh,sh=d;var b=ql;d=gc;var N=32-mn(b)-1;b&=~(1<<N),y+=1;var P=32-mn(h)+N;if(30<P){var J=N-N%5;P=(b&(1<<J)-1).toString(32),b>>=J,N-=J,ql=1<<32-mn(h)+N|y<<N|b,gc=P+d}else ql=1<<P|y<<N|b,gc=d}function cE(d){d.return!==null&&(ah(d,1),AS(d,1,0))}function IS(d){for(;d===aE;)aE=Jc[--Np],Jc[Np]=null,oE=Jc[--Np],Jc[Np]=null;for(;d===sh;)sh=wo[--Wo],wo[Wo]=null,gc=wo[--Wo],wo[Wo]=null,ql=wo[--Wo],wo[Wo]=null}var pa=null,Ii=null,jr=!1,oh=null,Zc=!1,NS=Error(s(519));function ch(d){var h=Error(s(418,""));throw bm(To(h,d)),NS}function OS(d){var h=d.stateNode,y=d.type,b=d.memoizedProps;switch(h[mr]=d,h[yr]=b,y){case"dialog":rr("cancel",h),rr("close",h);break;case"iframe":case"object":case"embed":rr("load",h);break;case"video":case"audio":for(y=0;y<rf.length;y++)rr(rf[y],h);break;case"source":rr("error",h);break;case"img":case"image":case"link":rr("error",h),rr("load",h);break;case"details":rr("toggle",h);break;case"input":rr("invalid",h),Qu(h,b.value,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name,!0),yp(h);break;case"select":rr("invalid",h);break;case"textarea":rr("invalid",h),$u(h,b.value,b.defaultValue,b.children),yp(h)}y=b.children,typeof y!="string"&&typeof y!="number"&&typeof y!="bigint"||h.textContent===""+y||b.suppressHydrationWarning===!0||ny(h.textContent,y)?(b.popover!=null&&(rr("beforetoggle",h),rr("toggle",h)),b.onScroll!=null&&rr("scroll",h),b.onScrollEnd!=null&&rr("scrollend",h),b.onClick!=null&&(h.onclick=dg),h=!0):h=!1,h||ch(d)}function lE(d){for(pa=d.return;pa;)switch(pa.tag){case 5:case 13:Zc=!1;return;case 27:case 3:Zc=!0;return;default:pa=pa.return}}function Tm(d){if(d!==pa)return!1;if(!jr)return lE(d),jr=!0,!1;var h=d.tag,y;if((y=h!==3&&h!==27)&&((y=h===5)&&(y=d.type,y=!(y!=="form"&&y!=="button")||WT(d.type,d.memoizedProps)),y=!y),y&&Ii&&ch(d),lE(d),h===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(s(317));e:{for(d=d.nextSibling,h=0;d;){if(d.nodeType===8)if(y=d.data,y==="/$"){if(h===0){Ii=Rc(d.nextSibling);break e}h--}else y!=="$"&&y!=="$!"&&y!=="$?"||h++;d=d.nextSibling}Ii=null}}else h===27?(h=Ii,tu(d.type)?(d=qT,qT=null,Ii=d):Ii=h):Ii=pa?Rc(d.stateNode.nextSibling):null;return!0}function lh(){Ii=pa=null,jr=!1}function WR(){var d=oh;return d!==null&&(xs===null?xs=d:xs.push.apply(xs,d),oh=null),d}function bm(d){oh===null?oh=[d]:oh.push(d)}var DS=De(null),dh=null,Kl=null;function Ud(d,h,y){We(DS,h._currentValue),h._currentValue=y}function Xl(d){d._currentValue=DS.current,qe(DS)}function xS(d,h,y){for(;d!==null;){var b=d.alternate;if((d.childLanes&h)!==h?(d.childLanes|=h,b!==null&&(b.childLanes|=h)):b!==null&&(b.childLanes&h)!==h&&(b.childLanes|=h),d===y)break;d=d.return}}function PS(d,h,y,b){var N=d.child;for(N!==null&&(N.return=d);N!==null;){var P=N.dependencies;if(P!==null){var J=N.child;P=P.firstContext;e:for(;P!==null;){var le=P;P=N;for(var we=0;we<h.length;we++)if(le.context===h[we]){P.lanes|=y,le=P.alternate,le!==null&&(le.lanes|=y),xS(P.return,y,d),b||(J=null);break e}P=le.next}}else if(N.tag===18){if(J=N.return,J===null)throw Error(s(341));J.lanes|=y,P=J.alternate,P!==null&&(P.lanes|=y),xS(J,y,d),J=null}else J=N.child;if(J!==null)J.return=N;else for(J=N;J!==null;){if(J===d){J=null;break}if(N=J.sibling,N!==null){N.return=J.return,J=N;break}J=J.return}N=J}}function wm(d,h,y,b){d=null;for(var N=h,P=!1;N!==null;){if(!P){if((N.flags&524288)!==0)P=!0;else if((N.flags&262144)!==0)break}if(N.tag===10){var J=N.alternate;if(J===null)throw Error(s(387));if(J=J.memoizedProps,J!==null){var le=N.type;So(N.pendingProps.value,J.value)||(d!==null?d.push(le):d=[le])}}else if(N===Tt.current){if(J=N.alternate,J===null)throw Error(s(387));J.memoizedState.memoizedState!==N.memoizedState.memoizedState&&(d!==null?d.push(gg):d=[gg])}N=N.return}d!==null&&PS(h,d,y,b),h.flags|=262144}function dE(d){for(d=d.firstContext;d!==null;){if(!So(d.context._currentValue,d.memoizedValue))return!0;d=d.next}return!1}function el(d){dh=d,Kl=null,d=d.dependencies,d!==null&&(d.firstContext=null)}function Ns(d){return zR(dh,d)}function Op(d,h){return dh===null&&el(d),zR(d,h)}function zR(d,h){var y=h._currentValue;if(h={context:h,memoizedValue:y,next:null},Kl===null){if(d===null)throw Error(s(308));Kl=h,d.dependencies={lanes:0,firstContext:h},d.flags|=524288}else Kl=Kl.next=h;return y}var qD=typeof AbortController<"u"?AbortController:function(){var d=[],h=this.signal={aborted:!1,addEventListener:function(y,b){d.push(b)}};this.abort=function(){h.aborted=!0,d.forEach(function(y){return y()})}},KD=a.unstable_scheduleCallback,YR=a.unstable_NormalPriority,us={$$typeof:ue,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Rm(){return{controller:new qD,data:new Map,refCount:0}}function Cm(d){d.refCount--,d.refCount===0&&KD(YR,function(){d.controller.abort()})}var Am=null,uh=0,Dp=0,xp=null;function XD(d,h){if(Am===null){var y=Am=[];uh=0,Dp=nf(),xp={status:"pending",value:void 0,then:function(b){y.push(b)}}}return uh++,h.then(qR,qR),h}function qR(){if(--uh===0&&Am!==null){xp!==null&&(xp.status="fulfilled");var d=Am;Am=null,Dp=0,xp=null;for(var h=0;h<d.length;h++)(0,d[h])()}}function QD(d,h){var y=[],b={status:"pending",value:null,reason:null,then:function(N){y.push(N)}};return d.then(function(){b.status="fulfilled",b.value=h;for(var N=0;N<y.length;N++)(0,y[N])(h)},function(N){for(b.status="rejected",b.reason=N,N=0;N<y.length;N++)(0,y[N])(void 0)}),b}var KR=be.S;be.S=function(d,h){typeof h=="object"&&h!==null&&typeof h.then=="function"&&XD(d,h),KR!==null&&KR(d,h)};var Vd=De(null);function kS(){var d=Vd.current;return d!==null?d:vi.pooledCache}function uE(d,h){h===null?We(Vd,Vd.current):We(Vd,h.pool)}function XR(){var d=kS();return d===null?null:{parent:us._currentValue,pool:d}}var hh=Error(s(460)),QR=Error(s(474)),hE=Error(s(542)),Pp={then:function(){}};function $R(d){return d=d.status,d==="fulfilled"||d==="rejected"}function pE(){}function JR(d,h,y){switch(y=d[y],y===void 0?d.push(h):y!==h&&(h.then(pE,pE),h=y),h.status){case"fulfilled":return h.value;case"rejected":throw d=h.reason,e0(d),d;default:if(typeof h.status=="string")h.then(pE,pE);else{if(d=vi,d!==null&&100<d.shellSuspendCounter)throw Error(s(482));d=h,d.status="pending",d.then(function(b){if(h.status==="pending"){var N=h;N.status="fulfilled",N.value=b}},function(b){if(h.status==="pending"){var N=h;N.status="rejected",N.reason=b}})}switch(h.status){case"fulfilled":return h.value;case"rejected":throw d=h.reason,e0(d),d}throw Im=h,hh}}var Im=null;function ZR(){if(Im===null)throw Error(s(459));var d=Im;return Im=null,d}function e0(d){if(d===hh||d===hE)throw Error(s(483))}var _c=!1;function fE(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function LS(d,h){d=d.updateQueue,h.updateQueue===d&&(h.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,callbacks:null})}function Fd(d){return{lane:d,tag:0,payload:null,callback:null,next:null}}function Ql(d,h,y){var b=d.updateQueue;if(b===null)return null;if(b=b.shared,(Ur&2)!==0){var N=b.pending;return N===null?h.next=h:(h.next=N.next,N.next=h),b.pending=h,h=Ip(d),Sm(d,null,y),h}return Md(d,b,h,y),Ip(d)}function Nm(d,h,y){if(h=h.updateQueue,h!==null&&(h=h.shared,(y&4194048)!==0)){var b=h.lanes;b&=d.pendingLanes,y|=b,h.lanes=y,Kt(d,y)}}function MS(d,h){var y=d.updateQueue,b=d.alternate;if(b!==null&&(b=b.updateQueue,y===b)){var N=null,P=null;if(y=y.firstBaseUpdate,y!==null){do{var J={lane:y.lane,tag:y.tag,payload:y.payload,callback:null,next:null};P===null?N=P=J:P=P.next=J,y=y.next}while(y!==null);P===null?N=P=h:P=P.next=h}else N=P=h;y={baseState:b.baseState,firstBaseUpdate:N,lastBaseUpdate:P,shared:b.shared,callbacks:b.callbacks},d.updateQueue=y;return}d=y.lastBaseUpdate,d===null?y.firstBaseUpdate=h:d.next=h,y.lastBaseUpdate=h}var jS=!1;function ph(){if(jS){var d=xp;if(d!==null)throw d}}function fh(d,h,y,b){jS=!1;var N=d.updateQueue;_c=!1;var P=N.firstBaseUpdate,J=N.lastBaseUpdate,le=N.shared.pending;if(le!==null){N.shared.pending=null;var we=le,Fe=we.next;we.next=null,J===null?P=Fe:J.next=Fe,J=we;var it=d.alternate;it!==null&&(it=it.updateQueue,le=it.lastBaseUpdate,le!==J&&(le===null?it.firstBaseUpdate=Fe:le.next=Fe,it.lastBaseUpdate=we))}if(P!==null){var gt=N.baseState;J=0,it=Fe=we=null,le=P;do{var Ke=le.lane&-536870913,Xe=Ke!==le.lane;if(Xe?(br&Ke)===Ke:(b&Ke)===Ke){Ke!==0&&Ke===Dp&&(jS=!0),it!==null&&(it=it.next={lane:0,tag:le.tag,payload:le.payload,callback:null,next:null});e:{var Pn=d,gn=le;Ke=h;var ti=y;switch(gn.tag){case 1:if(Pn=gn.payload,typeof Pn=="function"){gt=Pn.call(ti,gt,Ke);break e}gt=Pn;break e;case 3:Pn.flags=Pn.flags&-65537|128;case 0:if(Pn=gn.payload,Ke=typeof Pn=="function"?Pn.call(ti,gt,Ke):Pn,Ke==null)break e;gt=O({},gt,Ke);break e;case 2:_c=!0}}Ke=le.callback,Ke!==null&&(d.flags|=64,Xe&&(d.flags|=8192),Xe=N.callbacks,Xe===null?N.callbacks=[Ke]:Xe.push(Ke))}else Xe={lane:Ke,tag:le.tag,payload:le.payload,callback:le.callback,next:null},it===null?(Fe=it=Xe,we=gt):it=it.next=Xe,J|=Ke;if(le=le.next,le===null){if(le=N.shared.pending,le===null)break;Xe=le,le=Xe.next,Xe.next=null,N.lastBaseUpdate=Xe,N.shared.pending=null}}while(!0);it===null&&(we=gt),N.baseState=we,N.firstBaseUpdate=Fe,N.lastBaseUpdate=it,P===null&&(N.shared.lanes=0),Tc|=J,d.lanes=J,d.memoizedState=gt}}function US(d,h){if(typeof d!="function")throw Error(s(191,d));d.call(h)}function mE(d,h){var y=d.callbacks;if(y!==null)for(d.callbacks=null,d=0;d<y.length;d++)US(y[d],h)}var mh=De(null),Om=De(0);function Dm(d,h){d=ol,We(Om,d),We(mh,h),ol=d|h.baseLanes}function gh(){We(Om,ol),We(mh,mh.current)}function VS(){ol=Om.current,qe(mh),qe(Om)}var Bd=0,Qn=null,ei=null,hs=null,xm=!1,kp=!1,_h=!1,gE=0,Pm=0,Lp=null,$D=0;function Yi(){throw Error(s(321))}function Hd(d,h){if(h===null)return!1;for(var y=0;y<h.length&&y<d.length;y++)if(!So(d[y],h[y]))return!1;return!0}function FS(d,h,y,b,N,P){return Bd=P,Qn=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,be.H=d===null||d.memoizedState===null?Eh:Wd,_h=!1,P=y(b,N),_h=!1,kp&&(P=n0(h,y,b,N)),t0(d),P}function t0(d){be.H=Ro;var h=ei!==null&&ei.next!==null;if(Bd=0,hs=ei=Qn=null,xm=!1,Pm=0,Lp=null,h)throw Error(s(300));d===null||qs||(d=d.dependencies,d!==null&&dE(d)&&(qs=!0))}function n0(d,h,y,b){Qn=d;var N=0;do{if(kp&&(Lp=null),Pm=0,kp=!1,25<=N)throw Error(s(301));if(N+=1,hs=ei=null,d.updateQueue!=null){var P=d.updateQueue;P.lastEffect=null,P.events=null,P.stores=null,P.memoCache!=null&&(P.memoCache.index=0)}be.H=S0,P=h(y,b)}while(kp);return P}function r0(){var d=be.H,h=d.useState()[0];return h=typeof h.then=="function"?km(h):h,d=d.useState()[0],(ei!==null?ei.memoizedState:null)!==d&&(Qn.flags|=1024),h}function BS(){var d=gE!==0;return gE=0,d}function _E(d,h,y){h.updateQueue=d.updateQueue,h.flags&=-2053,d.lanes&=~y}function HS(d){if(xm){for(d=d.memoizedState;d!==null;){var h=d.queue;h!==null&&(h.pending=null),d=d.next}xm=!1}Bd=0,hs=ei=Qn=null,kp=!1,Pm=gE=0,Lp=null}function Qa(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return hs===null?Qn.memoizedState=hs=d:hs=hs.next=d,hs}function ps(){if(ei===null){var d=Qn.alternate;d=d!==null?d.memoizedState:null}else d=ei.next;var h=hs===null?Qn.memoizedState:hs.next;if(h!==null)hs=h,ei=d;else{if(d===null)throw Qn.alternate===null?Error(s(467)):Error(s(310));ei=d,d={memoizedState:ei.memoizedState,baseState:ei.baseState,baseQueue:ei.baseQueue,queue:ei.queue,next:null},hs===null?Qn.memoizedState=hs=d:hs=hs.next=d}return hs}function Mp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function km(d){var h=Pm;return Pm+=1,Lp===null&&(Lp=[]),d=JR(Lp,d,h),h=Qn,(hs===null?h.memoizedState:hs.next)===null&&(h=h.alternate,be.H=h===null||h.memoizedState===null?Eh:Wd),d}function EE(d){if(d!==null&&typeof d=="object"){if(typeof d.then=="function")return km(d);if(d.$$typeof===ue)return Ns(d)}throw Error(s(438,String(d)))}function GS(d){var h=null,y=Qn.updateQueue;if(y!==null&&(h=y.memoCache),h==null){var b=Qn.alternate;b!==null&&(b=b.updateQueue,b!==null&&(b=b.memoCache,b!=null&&(h={data:b.data.map(function(N){return N.slice()}),index:0})))}if(h==null&&(h={data:[],index:0}),y===null&&(y=Mp(),Qn.updateQueue=y),y.memoCache=h,y=h.data[h.index],y===void 0)for(y=h.data[h.index]=Array(d),b=0;b<d;b++)y[b]=oe;return h.index++,y}function $l(d,h){return typeof h=="function"?h(d):h}function yE(d){var h=ps();return WS(h,ei,d)}function WS(d,h,y){var b=d.queue;if(b===null)throw Error(s(311));b.lastRenderedReducer=y;var N=d.baseQueue,P=b.pending;if(P!==null){if(N!==null){var J=N.next;N.next=P.next,P.next=J}h.baseQueue=N=P,b.pending=null}if(P=d.baseState,N===null)d.memoizedState=P;else{h=N.next;var le=J=null,we=null,Fe=h,it=!1;do{var gt=Fe.lane&-536870913;if(gt!==Fe.lane?(br&gt)===gt:(Bd&gt)===gt){var Ke=Fe.revertLane;if(Ke===0)we!==null&&(we=we.next={lane:0,revertLane:0,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null}),gt===Dp&&(it=!0);else if((Bd&Ke)===Ke){Fe=Fe.next,Ke===Dp&&(it=!0);continue}else gt={lane:0,revertLane:Fe.revertLane,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null},we===null?(le=we=gt,J=P):we=we.next=gt,Qn.lanes|=Ke,Tc|=Ke;gt=Fe.action,_h&&y(P,gt),P=Fe.hasEagerState?Fe.eagerState:y(P,gt)}else Ke={lane:gt,revertLane:Fe.revertLane,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null},we===null?(le=we=Ke,J=P):we=we.next=Ke,Qn.lanes|=gt,Tc|=gt;Fe=Fe.next}while(Fe!==null&&Fe!==h);if(we===null?J=P:we.next=le,!So(P,d.memoizedState)&&(qs=!0,it&&(y=xp,y!==null)))throw y;d.memoizedState=P,d.baseState=J,d.baseQueue=we,b.lastRenderedState=P}return N===null&&(b.lanes=0),[d.memoizedState,b.dispatch]}function Lm(d){var h=ps(),y=h.queue;if(y===null)throw Error(s(311));y.lastRenderedReducer=d;var b=y.dispatch,N=y.pending,P=h.memoizedState;if(N!==null){y.pending=null;var J=N=N.next;do P=d(P,J.action),J=J.next;while(J!==N);So(P,h.memoizedState)||(qs=!0),h.memoizedState=P,h.baseQueue===null&&(h.baseState=P),y.lastRenderedState=P}return[P,b]}function i0(d,h,y){var b=Qn,N=ps(),P=jr;if(P){if(y===void 0)throw Error(s(407));y=y()}else y=h();var J=!So((ei||N).memoizedState,y);J&&(N.memoizedState=y,qs=!0),N=N.queue;var le=YS.bind(null,b,N,d);if(Vp(2048,8,le,[d]),N.getSnapshot!==h||J||hs!==null&&hs.memoizedState.tag&1){if(b.flags|=2048,Up(9,vE(),s0.bind(null,b,N,y,h),null),vi===null)throw Error(s(349));P||(Bd&124)!==0||zS(b,h,y)}return y}function zS(d,h,y){d.flags|=16384,d={getSnapshot:h,value:y},h=Qn.updateQueue,h===null?(h=Mp(),Qn.updateQueue=h,h.stores=[d]):(y=h.stores,y===null?h.stores=[d]:y.push(d))}function s0(d,h,y,b){h.value=y,h.getSnapshot=b,a0(h)&&o0(d)}function YS(d,h,y){return y(function(){a0(h)&&o0(d)})}function a0(d){var h=d.getSnapshot;d=d.value;try{var y=h();return!So(d,y)}catch{return!0}}function o0(d){var h=Ap(d,2);h!==null&&Za(h,d,2)}function qS(d){var h=Qa();if(typeof d=="function"){var y=d;if(d=y(),_h){wt(!0);try{y()}finally{wt(!1)}}}return h.memoizedState=h.baseState=d,h.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$l,lastRenderedState:d},h}function c0(d,h,y,b){return d.baseState=y,WS(d,ei,typeof b=="function"?b:$l)}function JD(d,h,y,b,N){if(Hm(d))throw Error(s(485));if(d=h.action,d!==null){var P={payload:N,action:d,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(J){P.listeners.push(J)}};be.T!==null?y(!0):P.isTransition=!1,b(P),y=h.pending,y===null?(P.next=h.pending=P,l0(h,P)):(P.next=y.next,h.pending=y.next=P)}}function l0(d,h){var y=h.action,b=h.payload,N=d.state;if(h.isTransition){var P=be.T,J={};be.T=J;try{var le=y(N,b),we=be.S;we!==null&&we(J,le),KS(d,h,le)}catch(Fe){XS(d,h,Fe)}finally{be.T=P}}else try{P=y(N,b),KS(d,h,P)}catch(Fe){XS(d,h,Fe)}}function KS(d,h,y){y!==null&&typeof y=="object"&&typeof y.then=="function"?y.then(function(b){d0(d,h,b)},function(b){return XS(d,h,b)}):d0(d,h,y)}function d0(d,h,y){h.status="fulfilled",h.value=y,QS(h),d.state=y,h=d.pending,h!==null&&(y=h.next,y===h?d.pending=null:(y=y.next,h.next=y,l0(d,y)))}function XS(d,h,y){var b=d.pending;if(d.pending=null,b!==null){b=b.next;do h.status="rejected",h.reason=y,QS(h),h=h.next;while(h!==b)}d.action=null}function QS(d){d=d.listeners;for(var h=0;h<d.length;h++)(0,d[h])()}function u0(d,h){return h}function Mm(d,h){if(jr){var y=vi.formState;if(y!==null){e:{var b=Qn;if(jr){if(Ii){t:{for(var N=Ii,P=Zc;N.nodeType!==8;){if(!P){N=null;break t}if(N=Rc(N.nextSibling),N===null){N=null;break t}}P=N.data,N=P==="F!"||P==="F"?N:null}if(N){Ii=Rc(N.nextSibling),b=N.data==="F!";break e}}ch(b)}b=!1}b&&(h=y[0])}}return y=Qa(),y.memoizedState=y.baseState=h,b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u0,lastRenderedState:h},y.queue=b,y=RE.bind(null,Qn,b),b.dispatch=y,b=qS(!1),P=rT.bind(null,Qn,!1,b.queue),b=Qa(),N={state:h,dispatch:null,action:d,pending:null},b.queue=N,y=JD.bind(null,Qn,N,P,y),N.dispatch=y,b.memoizedState=d,[h,y,!1]}function $S(d){var h=ps();return jp(h,ei,d)}function jp(d,h,y){if(h=WS(d,h,u0)[0],d=yE($l)[0],typeof h=="object"&&h!==null&&typeof h.then=="function")try{var b=km(h)}catch(J){throw J===hh?hE:J}else b=h;h=ps();var N=h.queue,P=N.dispatch;return y!==h.memoizedState&&(Qn.flags|=2048,Up(9,vE(),ZD.bind(null,N,y),null)),[b,P,d]}function ZD(d,h){d.action=h}function h0(d){var h=ps(),y=ei;if(y!==null)return jp(h,y,d);ps(),h=h.memoizedState,y=ps();var b=y.queue.dispatch;return y.memoizedState=d,[h,b,!1]}function Up(d,h,y,b){return d={tag:d,create:y,deps:b,inst:h,next:null},h=Qn.updateQueue,h===null&&(h=Mp(),Qn.updateQueue=h),y=h.lastEffect,y===null?h.lastEffect=d.next=d:(b=y.next,y.next=d,d.next=b,h.lastEffect=d),d}function vE(){return{destroy:void 0,resource:void 0}}function jm(){return ps().memoizedState}function SE(d,h,y,b){var N=Qa();b=b===void 0?null:b,Qn.flags|=d,N.memoizedState=Up(1|h,vE(),y,b)}function Vp(d,h,y,b){var N=ps();b=b===void 0?null:b;var P=N.memoizedState.inst;ei!==null&&b!==null&&Hd(b,ei.memoizedState.deps)?N.memoizedState=Up(h,P,y,b):(Qn.flags|=d,N.memoizedState=Up(1|h,P,y,b))}function TE(d,h){SE(8390656,8,d,h)}function bE(d,h){Vp(2048,8,d,h)}function p0(d,h){return Vp(4,2,d,h)}function f0(d,h){return Vp(4,4,d,h)}function m0(d,h){if(typeof h=="function"){d=d();var y=h(d);return function(){typeof y=="function"?y():h(null)}}if(h!=null)return d=d(),h.current=d,function(){h.current=null}}function g0(d,h,y){y=y!=null?y.concat([d]):null,Vp(4,4,m0.bind(null,h,d),y)}function JS(){}function Um(d,h){var y=ps();h=h===void 0?null:h;var b=y.memoizedState;return h!==null&&Hd(h,b[1])?b[0]:(y.memoizedState=[d,h],d)}function _0(d,h){var y=ps();h=h===void 0?null:h;var b=y.memoizedState;if(h!==null&&Hd(h,b[1]))return b[0];if(b=d(),_h){wt(!0);try{d()}finally{wt(!1)}}return y.memoizedState=[b,h],b}function Gd(d,h,y){return y===void 0||(Bd&1073741824)!==0?d.memoizedState=h:(d.memoizedState=y,d=GE(),Qn.lanes|=d,Tc|=d,y)}function wE(d,h,y,b){return So(y,h)?y:mh.current!==null?(d=Gd(d,y,b),So(d,h)||(qs=!0),d):(Bd&42)===0?(qs=!0,d.memoizedState=y):(d=GE(),Qn.lanes|=d,Tc|=d,h)}function Vm(d,h,y,b,N){var P=Ie.p;Ie.p=P!==0&&8>P?P:8;var J=be.T,le={};be.T=le,rT(d,!1,h,y);try{var we=N(),Fe=be.S;if(Fe!==null&&Fe(le,we),we!==null&&typeof we=="object"&&typeof we.then=="function"){var it=QD(we,b);Bm(d,h,it,Ao(d))}else Bm(d,h,b,Ao(d))}catch(gt){Bm(d,h,{then:function(){},status:"rejected",reason:gt},Ao())}finally{Ie.p=P,be.T=J}}function Fm(){}function Fp(d,h,y,b){if(d.tag!==5)throw Error(s(476));var N=E0(d).queue;Vm(d,N,h,Re,y===null?Fm:function(){return ZS(d),y(b)})}function E0(d){var h=d.memoizedState;if(h!==null)return h;h={memoizedState:Re,baseState:Re,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$l,lastRenderedState:Re},next:null};var y={};return h.next={memoizedState:y,baseState:y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$l,lastRenderedState:y},next:null},d.memoizedState=h,d=d.alternate,d!==null&&(d.memoizedState=h),h}function ZS(d){var h=E0(d).next.queue;Bm(d,h,{},Ao())}function eT(){return Ns(gg)}function tT(){return ps().memoizedState}function y0(){return ps().memoizedState}function ex(d){for(var h=d.return;h!==null;){switch(h.tag){case 24:case 3:var y=Ao();d=Fd(y);var b=Ql(h,d,y);b!==null&&(Za(b,h,y),Nm(b,h,y)),h={cache:Rm()},d.payload=h;return}h=h.return}}function nT(d,h,y){var b=Ao();y={lane:b,revertLane:0,action:y,hasEagerState:!1,eagerState:null,next:null},Hm(d)?CE(h,y):(y=wS(d,h,y,b),y!==null&&(Za(y,d,b),v0(y,h,b)))}function RE(d,h,y){var b=Ao();Bm(d,h,y,b)}function Bm(d,h,y,b){var N={lane:b,revertLane:0,action:y,hasEagerState:!1,eagerState:null,next:null};if(Hm(d))CE(h,N);else{var P=d.alternate;if(d.lanes===0&&(P===null||P.lanes===0)&&(P=h.lastRenderedReducer,P!==null))try{var J=h.lastRenderedState,le=P(J,y);if(N.hasEagerState=!0,N.eagerState=le,So(le,J))return Md(d,h,N,0),vi===null&&ih(),!1}catch{}finally{}if(y=wS(d,h,N,b),y!==null)return Za(y,d,b),v0(y,h,b),!0}return!1}function rT(d,h,y,b){if(b={lane:2,revertLane:nf(),action:b,hasEagerState:!1,eagerState:null,next:null},Hm(d)){if(h)throw Error(s(479))}else h=wS(d,y,b,2),h!==null&&Za(h,d,2)}function Hm(d){var h=d.alternate;return d===Qn||h!==null&&h===Qn}function CE(d,h){kp=xm=!0;var y=d.pending;y===null?h.next=h:(h.next=y.next,y.next=h),d.pending=h}function v0(d,h,y){if((y&4194048)!==0){var b=h.lanes;b&=d.pendingLanes,y|=b,h.lanes=y,Kt(d,y)}}var Ro={readContext:Ns,use:EE,useCallback:Yi,useContext:Yi,useEffect:Yi,useImperativeHandle:Yi,useLayoutEffect:Yi,useInsertionEffect:Yi,useMemo:Yi,useReducer:Yi,useRef:Yi,useState:Yi,useDebugValue:Yi,useDeferredValue:Yi,useTransition:Yi,useSyncExternalStore:Yi,useId:Yi,useHostTransitionStatus:Yi,useFormState:Yi,useActionState:Yi,useOptimistic:Yi,useMemoCache:Yi,useCacheRefresh:Yi},Eh={readContext:Ns,use:EE,useCallback:function(d,h){return Qa().memoizedState=[d,h===void 0?null:h],d},useContext:Ns,useEffect:TE,useImperativeHandle:function(d,h,y){y=y!=null?y.concat([d]):null,SE(4194308,4,m0.bind(null,h,d),y)},useLayoutEffect:function(d,h){return SE(4194308,4,d,h)},useInsertionEffect:function(d,h){SE(4,2,d,h)},useMemo:function(d,h){var y=Qa();h=h===void 0?null:h;var b=d();if(_h){wt(!0);try{d()}finally{wt(!1)}}return y.memoizedState=[b,h],b},useReducer:function(d,h,y){var b=Qa();if(y!==void 0){var N=y(h);if(_h){wt(!0);try{y(h)}finally{wt(!1)}}}else N=h;return b.memoizedState=b.baseState=N,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:N},b.queue=d,d=d.dispatch=nT.bind(null,Qn,d),[b.memoizedState,d]},useRef:function(d){var h=Qa();return d={current:d},h.memoizedState=d},useState:function(d){d=qS(d);var h=d.queue,y=RE.bind(null,Qn,h);return h.dispatch=y,[d.memoizedState,y]},useDebugValue:JS,useDeferredValue:function(d,h){var y=Qa();return Gd(y,d,h)},useTransition:function(){var d=qS(!1);return d=Vm.bind(null,Qn,d.queue,!0,!1),Qa().memoizedState=d,[!1,d]},useSyncExternalStore:function(d,h,y){var b=Qn,N=Qa();if(jr){if(y===void 0)throw Error(s(407));y=y()}else{if(y=h(),vi===null)throw Error(s(349));(br&124)!==0||zS(b,h,y)}N.memoizedState=y;var P={value:y,getSnapshot:h};return N.queue=P,TE(YS.bind(null,b,P,d),[d]),b.flags|=2048,Up(9,vE(),s0.bind(null,b,P,y,h),null),y},useId:function(){var d=Qa(),h=vi.identifierPrefix;if(jr){var y=gc,b=ql;y=(b&~(1<<32-mn(b)-1)).toString(32)+y,h=""+h+"R"+y,y=gE++,0<y&&(h+="H"+y.toString(32)),h+=""}else y=$D++,h=""+h+"r"+y.toString(32)+"";return d.memoizedState=h},useHostTransitionStatus:eT,useFormState:Mm,useActionState:Mm,useOptimistic:function(d){var h=Qa();h.memoizedState=h.baseState=d;var y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return h.queue=y,h=rT.bind(null,Qn,!0,y),y.dispatch=h,[d,h]},useMemoCache:GS,useCacheRefresh:function(){return Qa().memoizedState=ex.bind(null,Qn)}},Wd={readContext:Ns,use:EE,useCallback:Um,useContext:Ns,useEffect:bE,useImperativeHandle:g0,useInsertionEffect:p0,useLayoutEffect:f0,useMemo:_0,useReducer:yE,useRef:jm,useState:function(){return yE($l)},useDebugValue:JS,useDeferredValue:function(d,h){var y=ps();return wE(y,ei.memoizedState,d,h)},useTransition:function(){var d=yE($l)[0],h=ps().memoizedState;return[typeof d=="boolean"?d:km(d),h]},useSyncExternalStore:i0,useId:tT,useHostTransitionStatus:eT,useFormState:$S,useActionState:$S,useOptimistic:function(d,h){var y=ps();return c0(y,ei,d,h)},useMemoCache:GS,useCacheRefresh:y0},S0={readContext:Ns,use:EE,useCallback:Um,useContext:Ns,useEffect:bE,useImperativeHandle:g0,useInsertionEffect:p0,useLayoutEffect:f0,useMemo:_0,useReducer:Lm,useRef:jm,useState:function(){return Lm($l)},useDebugValue:JS,useDeferredValue:function(d,h){var y=ps();return ei===null?Gd(y,d,h):wE(y,ei.memoizedState,d,h)},useTransition:function(){var d=Lm($l)[0],h=ps().memoizedState;return[typeof d=="boolean"?d:km(d),h]},useSyncExternalStore:i0,useId:tT,useHostTransitionStatus:eT,useFormState:h0,useActionState:h0,useOptimistic:function(d,h){var y=ps();return ei!==null?c0(y,ei,d,h):(y.baseState=d,[d,y.queue.dispatch])},useMemoCache:GS,useCacheRefresh:y0},yh=null,Ec=0;function Bp(d){var h=Ec;return Ec+=1,yh===null&&(yh=[]),JR(yh,d,h)}function Gm(d,h){h=h.props.ref,d.ref=h!==void 0?h:null}function Wm(d,h){throw h.$$typeof===k?Error(s(525)):(d=Object.prototype.toString.call(h),Error(s(31,d==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":d)))}function T0(d){var h=d._init;return h(d._payload)}function iT(d){function h(Le,Oe){if(d){var He=Le.deletions;He===null?(Le.deletions=[Oe],Le.flags|=16):He.push(Oe)}}function y(Le,Oe){if(!d)return null;for(;Oe!==null;)h(Le,Oe),Oe=Oe.sibling;return null}function b(Le){for(var Oe=new Map;Le!==null;)Le.key!==null?Oe.set(Le.key,Le):Oe.set(Le.index,Le),Le=Le.sibling;return Oe}function N(Le,Oe){return Le=Yl(Le,Oe),Le.index=0,Le.sibling=null,Le}function P(Le,Oe,He){return Le.index=He,d?(He=Le.alternate,He!==null?(He=He.index,He<Oe?(Le.flags|=67108866,Oe):He):(Le.flags|=67108866,Oe)):(Le.flags|=1048576,Oe)}function J(Le){return d&&Le.alternate===null&&(Le.flags|=67108866),Le}function le(Le,Oe,He,ht){return Oe===null||Oe.tag!==6?(Oe=Xa(He,Le.mode,ht),Oe.return=Le,Oe):(Oe=N(Oe,He),Oe.return=Le,Oe)}function we(Le,Oe,He,ht){var Ft=He.type;return Ft===W?it(Le,Oe,He.props.children,ht,He.key):Oe!==null&&(Oe.elementType===Ft||typeof Ft=="object"&&Ft!==null&&Ft.$$typeof===Q&&T0(Ft)===Oe.type)?(Oe=N(Oe,He.props),Gm(Oe,He),Oe.return=Le,Oe):(Oe=sE(He.type,He.key,He.props,null,Le.mode,ht),Gm(Oe,He),Oe.return=Le,Oe)}function Fe(Le,Oe,He,ht){return Oe===null||Oe.tag!==4||Oe.stateNode.containerInfo!==He.containerInfo||Oe.stateNode.implementation!==He.implementation?(Oe=CS(He,Le.mode,ht),Oe.return=Le,Oe):(Oe=N(Oe,He.children||[]),Oe.return=Le,Oe)}function it(Le,Oe,He,ht,Ft){return Oe===null||Oe.tag!==7?(Oe=jd(He,Le.mode,ht,Ft),Oe.return=Le,Oe):(Oe=N(Oe,He),Oe.return=Le,Oe)}function gt(Le,Oe,He){if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number"||typeof Oe=="bigint")return Oe=Xa(""+Oe,Le.mode,He),Oe.return=Le,Oe;if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case U:return He=sE(Oe.type,Oe.key,Oe.props,null,Le.mode,He),Gm(He,Oe),He.return=Le,He;case Y:return Oe=CS(Oe,Le.mode,He),Oe.return=Le,Oe;case Q:var ht=Oe._init;return Oe=ht(Oe._payload),gt(Le,Oe,He)}if(Je(Oe)||fe(Oe))return Oe=jd(Oe,Le.mode,He,null),Oe.return=Le,Oe;if(typeof Oe.then=="function")return gt(Le,Bp(Oe),He);if(Oe.$$typeof===ue)return gt(Le,Op(Le,Oe),He);Wm(Le,Oe)}return null}function Ke(Le,Oe,He,ht){var Ft=Oe!==null?Oe.key:null;if(typeof He=="string"&&He!==""||typeof He=="number"||typeof He=="bigint")return Ft!==null?null:le(Le,Oe,""+He,ht);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case U:return He.key===Ft?we(Le,Oe,He,ht):null;case Y:return He.key===Ft?Fe(Le,Oe,He,ht):null;case Q:return Ft=He._init,He=Ft(He._payload),Ke(Le,Oe,He,ht)}if(Je(He)||fe(He))return Ft!==null?null:it(Le,Oe,He,ht,null);if(typeof He.then=="function")return Ke(Le,Oe,Bp(He),ht);if(He.$$typeof===ue)return Ke(Le,Oe,Op(Le,He),ht);Wm(Le,He)}return null}function Xe(Le,Oe,He,ht,Ft){if(typeof ht=="string"&&ht!==""||typeof ht=="number"||typeof ht=="bigint")return Le=Le.get(He)||null,le(Oe,Le,""+ht,Ft);if(typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case U:return Le=Le.get(ht.key===null?He:ht.key)||null,we(Oe,Le,ht,Ft);case Y:return Le=Le.get(ht.key===null?He:ht.key)||null,Fe(Oe,Le,ht,Ft);case Q:var cr=ht._init;return ht=cr(ht._payload),Xe(Le,Oe,He,ht,Ft)}if(Je(ht)||fe(ht))return Le=Le.get(He)||null,it(Oe,Le,ht,Ft,null);if(typeof ht.then=="function")return Xe(Le,Oe,He,Bp(ht),Ft);if(ht.$$typeof===ue)return Xe(Le,Oe,He,Op(Oe,ht),Ft);Wm(Oe,ht)}return null}function Pn(Le,Oe,He,ht){for(var Ft=null,cr=null,on=Oe,Rn=Oe=0,Qs=null;on!==null&&Rn<He.length;Rn++){on.index>Rn?(Qs=on,on=null):Qs=on.sibling;var Ar=Ke(Le,on,He[Rn],ht);if(Ar===null){on===null&&(on=Qs);break}d&&on&&Ar.alternate===null&&h(Le,on),Oe=P(Ar,Oe,Rn),cr===null?Ft=Ar:cr.sibling=Ar,cr=Ar,on=Qs}if(Rn===He.length)return y(Le,on),jr&&ah(Le,Rn),Ft;if(on===null){for(;Rn<He.length;Rn++)on=gt(Le,He[Rn],ht),on!==null&&(Oe=P(on,Oe,Rn),cr===null?Ft=on:cr.sibling=on,cr=on);return jr&&ah(Le,Rn),Ft}for(on=b(on);Rn<He.length;Rn++)Qs=Xe(on,Le,Rn,He[Rn],ht),Qs!==null&&(d&&Qs.alternate!==null&&on.delete(Qs.key===null?Rn:Qs.key),Oe=P(Qs,Oe,Rn),cr===null?Ft=Qs:cr.sibling=Qs,cr=Qs);return d&&on.forEach(function(td){return h(Le,td)}),jr&&ah(Le,Rn),Ft}function gn(Le,Oe,He,ht){if(He==null)throw Error(s(151));for(var Ft=null,cr=null,on=Oe,Rn=Oe=0,Qs=null,Ar=He.next();on!==null&&!Ar.done;Rn++,Ar=He.next()){on.index>Rn?(Qs=on,on=null):Qs=on.sibling;var td=Ke(Le,on,Ar.value,ht);if(td===null){on===null&&(on=Qs);break}d&&on&&td.alternate===null&&h(Le,on),Oe=P(td,Oe,Rn),cr===null?Ft=td:cr.sibling=td,cr=td,on=Qs}if(Ar.done)return y(Le,on),jr&&ah(Le,Rn),Ft;if(on===null){for(;!Ar.done;Rn++,Ar=He.next())Ar=gt(Le,Ar.value,ht),Ar!==null&&(Oe=P(Ar,Oe,Rn),cr===null?Ft=Ar:cr.sibling=Ar,cr=Ar);return jr&&ah(Le,Rn),Ft}for(on=b(on);!Ar.done;Rn++,Ar=He.next())Ar=Xe(on,Le,Rn,Ar.value,ht),Ar!==null&&(d&&Ar.alternate!==null&&on.delete(Ar.key===null?Rn:Ar.key),Oe=P(Ar,Oe,Rn),cr===null?Ft=Ar:cr.sibling=Ar,cr=Ar);return d&&on.forEach(function(jx){return h(Le,jx)}),jr&&ah(Le,Rn),Ft}function ti(Le,Oe,He,ht){if(typeof He=="object"&&He!==null&&He.type===W&&He.key===null&&(He=He.props.children),typeof He=="object"&&He!==null){switch(He.$$typeof){case U:e:{for(var Ft=He.key;Oe!==null;){if(Oe.key===Ft){if(Ft=He.type,Ft===W){if(Oe.tag===7){y(Le,Oe.sibling),ht=N(Oe,He.props.children),ht.return=Le,Le=ht;break e}}else if(Oe.elementType===Ft||typeof Ft=="object"&&Ft!==null&&Ft.$$typeof===Q&&T0(Ft)===Oe.type){y(Le,Oe.sibling),ht=N(Oe,He.props),Gm(ht,He),ht.return=Le,Le=ht;break e}y(Le,Oe);break}else h(Le,Oe);Oe=Oe.sibling}He.type===W?(ht=jd(He.props.children,Le.mode,ht,He.key),ht.return=Le,Le=ht):(ht=sE(He.type,He.key,He.props,null,Le.mode,ht),Gm(ht,He),ht.return=Le,Le=ht)}return J(Le);case Y:e:{for(Ft=He.key;Oe!==null;){if(Oe.key===Ft)if(Oe.tag===4&&Oe.stateNode.containerInfo===He.containerInfo&&Oe.stateNode.implementation===He.implementation){y(Le,Oe.sibling),ht=N(Oe,He.children||[]),ht.return=Le,Le=ht;break e}else{y(Le,Oe);break}else h(Le,Oe);Oe=Oe.sibling}ht=CS(He,Le.mode,ht),ht.return=Le,Le=ht}return J(Le);case Q:return Ft=He._init,He=Ft(He._payload),ti(Le,Oe,He,ht)}if(Je(He))return Pn(Le,Oe,He,ht);if(fe(He)){if(Ft=fe(He),typeof Ft!="function")throw Error(s(150));return He=Ft.call(He),gn(Le,Oe,He,ht)}if(typeof He.then=="function")return ti(Le,Oe,Bp(He),ht);if(He.$$typeof===ue)return ti(Le,Oe,Op(Le,He),ht);Wm(Le,He)}return typeof He=="string"&&He!==""||typeof He=="number"||typeof He=="bigint"?(He=""+He,Oe!==null&&Oe.tag===6?(y(Le,Oe.sibling),ht=N(Oe,He),ht.return=Le,Le=ht):(y(Le,Oe),ht=Xa(He,Le.mode,ht),ht.return=Le,Le=ht),J(Le)):y(Le,Oe)}return function(Le,Oe,He,ht){try{Ec=0;var Ft=ti(Le,Oe,He,ht);return yh=null,Ft}catch(on){if(on===hh||on===hE)throw on;var cr=bo(29,on,null,Le.mode);return cr.lanes=ht,cr.return=Le,cr}finally{}}}var vh=iT(!0),b0=iT(!1),Os=De(null),tl=null;function zd(d){var h=d.alternate;We(Ds,Ds.current&1),We(Os,d),tl===null&&(h===null||mh.current!==null||h.memoizedState!==null)&&(tl=d)}function w0(d){if(d.tag===22){if(We(Ds,Ds.current),We(Os,d),tl===null){var h=d.alternate;h!==null&&h.memoizedState!==null&&(tl=d)}}else Yd()}function Yd(){We(Ds,Ds.current),We(Os,Os.current)}function nl(d){qe(Os),tl===d&&(tl=null),qe(Ds)}var Ds=De(0);function Hp(d){for(var h=d;h!==null;){if(h.tag===13){var y=h.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||iy(y)))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===d)break;for(;h.sibling===null;){if(h.return===null||h.return===d)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}function AE(d,h,y,b){h=d.memoizedState,y=y(b,h),y=y==null?h:O({},h,y),d.memoizedState=y,d.lanes===0&&(d.updateQueue.baseState=y)}var sT={enqueueSetState:function(d,h,y){d=d._reactInternals;var b=Ao(),N=Fd(b);N.payload=h,y!=null&&(N.callback=y),h=Ql(d,N,b),h!==null&&(Za(h,d,b),Nm(h,d,b))},enqueueReplaceState:function(d,h,y){d=d._reactInternals;var b=Ao(),N=Fd(b);N.tag=1,N.payload=h,y!=null&&(N.callback=y),h=Ql(d,N,b),h!==null&&(Za(h,d,b),Nm(h,d,b))},enqueueForceUpdate:function(d,h){d=d._reactInternals;var y=Ao(),b=Fd(y);b.tag=2,h!=null&&(b.callback=h),h=Ql(d,b,y),h!==null&&(Za(h,d,y),Nm(h,d,y))}};function aT(d,h,y,b,N,P,J){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(b,P,J):h.prototype&&h.prototype.isPureReactComponent?!Pd(y,b)||!Pd(N,P):!0}function R0(d,h,y,b){d=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(y,b),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(y,b),h.state!==d&&sT.enqueueReplaceState(h,h.state,null)}function Sh(d,h){var y=h;if("ref"in h){y={};for(var b in h)b!=="ref"&&(y[b]=h[b])}if(d=d.defaultProps){y===h&&(y=O({},y));for(var N in d)y[N]===void 0&&(y[N]=d[N])}return y}var IE=typeof reportError=="function"?reportError:function(d){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var h=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof d=="object"&&d!==null&&typeof d.message=="string"?String(d.message):String(d),error:d});if(!window.dispatchEvent(h))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",d);return}console.error(d)};function C0(d){IE(d)}function A0(d){console.error(d)}function I0(d){IE(d)}function NE(d,h){try{var y=d.onUncaughtError;y(h.value,{componentStack:h.stack})}catch(b){setTimeout(function(){throw b})}}function oT(d,h,y){try{var b=d.onCaughtError;b(y.value,{componentStack:y.stack,errorBoundary:h.tag===1?h.stateNode:null})}catch(N){setTimeout(function(){throw N})}}function yc(d,h,y){return y=Fd(y),y.tag=3,y.payload={element:null},y.callback=function(){NE(d,h)},y}function N0(d){return d=Fd(d),d.tag=3,d}function O0(d,h,y,b){var N=y.type.getDerivedStateFromError;if(typeof N=="function"){var P=b.value;d.payload=function(){return N(P)},d.callback=function(){oT(h,y,b)}}var J=y.stateNode;J!==null&&typeof J.componentDidCatch=="function"&&(d.callback=function(){oT(h,y,b),typeof N!="function"&&(Zl===null?Zl=new Set([this]):Zl.add(this));var le=b.stack;this.componentDidCatch(b.value,{componentStack:le!==null?le:""})})}function tx(d,h,y,b,N){if(y.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){if(h=y.alternate,h!==null&&wm(h,y,N,!0),y=Os.current,y!==null){switch(y.tag){case 13:return tl===null?Nh():y.alternate===null&&Vi===0&&(Vi=3),y.flags&=-257,y.flags|=65536,y.lanes=N,b===Pp?y.flags|=16384:(h=y.updateQueue,h===null?y.updateQueue=new Set([b]):h.add(b),ef(d,b,N)),!1;case 22:return y.flags|=65536,b===Pp?y.flags|=16384:(h=y.updateQueue,h===null?(h={transitions:null,markerInstances:null,retryQueue:new Set([b])},y.updateQueue=h):(y=h.retryQueue,y===null?h.retryQueue=new Set([b]):y.add(b)),ef(d,b,N)),!1}throw Error(s(435,y.tag))}return ef(d,b,N),Nh(),!1}if(jr)return h=Os.current,h!==null?((h.flags&65536)===0&&(h.flags|=256),h.flags|=65536,h.lanes=N,b!==NS&&(d=Error(s(422),{cause:b}),bm(To(d,y)))):(b!==NS&&(h=Error(s(423),{cause:b}),bm(To(h,y))),d=d.current.alternate,d.flags|=65536,N&=-N,d.lanes|=N,b=To(b,y),N=yc(d.stateNode,b,N),MS(d,N),Vi!==4&&(Vi=2)),!1;var P=Error(s(520),{cause:b});if(P=To(P,y),Xp===null?Xp=[P]:Xp.push(P),Vi!==4&&(Vi=2),h===null)return!0;b=To(b,y),y=h;do{switch(y.tag){case 3:return y.flags|=65536,d=N&-N,y.lanes|=d,d=yc(y.stateNode,b,d),MS(y,d),!1;case 1:if(h=y.type,P=y.stateNode,(y.flags&128)===0&&(typeof h.getDerivedStateFromError=="function"||P!==null&&typeof P.componentDidCatch=="function"&&(Zl===null||!Zl.has(P))))return y.flags|=65536,N&=-N,y.lanes|=N,N=N0(N),O0(N,d,y,b),MS(y,N),!1}y=y.return}while(y!==null);return!1}var D0=Error(s(461)),qs=!1;function na(d,h,y,b){h.child=d===null?b0(h,null,y,b):vh(h,d.child,y,b)}function OE(d,h,y,b,N){y=y.render;var P=h.ref;if("ref"in b){var J={};for(var le in b)le!=="ref"&&(J[le]=b[le])}else J=b;return el(h),b=FS(d,h,y,J,P,N),le=BS(),d!==null&&!qs?(_E(d,h,N),rl(d,h,N)):(jr&&le&&cE(h),h.flags|=1,na(d,h,b,N),h.child)}function x0(d,h,y,b,N){if(d===null){var P=y.type;return typeof P=="function"&&!RS(P)&&P.defaultProps===void 0&&y.compare===null?(h.tag=15,h.type=P,P0(d,h,P,b,N)):(d=sE(y.type,null,b,h,h.mode,N),d.ref=h.ref,d.return=h,h.child=d)}if(P=d.child,!xE(d,N)){var J=P.memoizedProps;if(y=y.compare,y=y!==null?y:Pd,y(J,b)&&d.ref===h.ref)return rl(d,h,N)}return h.flags|=1,d=Yl(P,b),d.ref=h.ref,d.return=h,h.child=d}function P0(d,h,y,b,N){if(d!==null){var P=d.memoizedProps;if(Pd(P,b)&&d.ref===h.ref)if(qs=!1,h.pendingProps=b=P,xE(d,N))(d.flags&131072)!==0&&(qs=!0);else return h.lanes=d.lanes,rl(d,h,N)}return cT(d,h,y,b,N)}function k0(d,h,y){var b=h.pendingProps,N=b.children,P=d!==null?d.memoizedState:null;if(b.mode==="hidden"){if((h.flags&128)!==0){if(b=P!==null?P.baseLanes|y:y,d!==null){for(N=h.child=d.child,P=0;N!==null;)P=P|N.lanes|N.childLanes,N=N.sibling;h.childLanes=P&~b}else h.childLanes=0,h.child=null;return L0(d,h,b,y)}if((y&536870912)!==0)h.memoizedState={baseLanes:0,cachePool:null},d!==null&&uE(h,P!==null?P.cachePool:null),P!==null?Dm(h,P):gh(),w0(h);else return h.lanes=h.childLanes=536870912,L0(d,h,P!==null?P.baseLanes|y:y,y)}else P!==null?(uE(h,P.cachePool),Dm(h,P),Yd(),h.memoizedState=null):(d!==null&&uE(h,null),gh(),Yd());return na(d,h,N,y),h.child}function L0(d,h,y,b){var N=kS();return N=N===null?null:{parent:us._currentValue,pool:N},h.memoizedState={baseLanes:y,cachePool:N},d!==null&&uE(h,null),gh(),w0(h),d!==null&&wm(d,h,b,!0),null}function DE(d,h){var y=h.ref;if(y===null)d!==null&&d.ref!==null&&(h.flags|=4194816);else{if(typeof y!="function"&&typeof y!="object")throw Error(s(284));(d===null||d.ref!==y)&&(h.flags|=4194816)}}function cT(d,h,y,b,N){return el(h),y=FS(d,h,y,b,void 0,N),b=BS(),d!==null&&!qs?(_E(d,h,N),rl(d,h,N)):(jr&&b&&cE(h),h.flags|=1,na(d,h,y,N),h.child)}function lT(d,h,y,b,N,P){return el(h),h.updateQueue=null,y=n0(h,b,y,N),t0(d),b=BS(),d!==null&&!qs?(_E(d,h,P),rl(d,h,P)):(jr&&b&&cE(h),h.flags|=1,na(d,h,y,P),h.child)}function dT(d,h,y,b,N){if(el(h),h.stateNode===null){var P=zl,J=y.contextType;typeof J=="object"&&J!==null&&(P=Ns(J)),P=new y(b,P),h.memoizedState=P.state!==null&&P.state!==void 0?P.state:null,P.updater=sT,h.stateNode=P,P._reactInternals=h,P=h.stateNode,P.props=b,P.state=h.memoizedState,P.refs={},fE(h),J=y.contextType,P.context=typeof J=="object"&&J!==null?Ns(J):zl,P.state=h.memoizedState,J=y.getDerivedStateFromProps,typeof J=="function"&&(AE(h,y,J,b),P.state=h.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof P.getSnapshotBeforeUpdate=="function"||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(J=P.state,typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount(),J!==P.state&&sT.enqueueReplaceState(P,P.state,null),fh(h,b,P,N),ph(),P.state=h.memoizedState),typeof P.componentDidMount=="function"&&(h.flags|=4194308),b=!0}else if(d===null){P=h.stateNode;var le=h.memoizedProps,we=Sh(y,le);P.props=we;var Fe=P.context,it=y.contextType;J=zl,typeof it=="object"&&it!==null&&(J=Ns(it));var gt=y.getDerivedStateFromProps;it=typeof gt=="function"||typeof P.getSnapshotBeforeUpdate=="function",le=h.pendingProps!==le,it||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(le||Fe!==J)&&R0(h,P,b,J),_c=!1;var Ke=h.memoizedState;P.state=Ke,fh(h,b,P,N),ph(),Fe=h.memoizedState,le||Ke!==Fe||_c?(typeof gt=="function"&&(AE(h,y,gt,b),Fe=h.memoizedState),(we=_c||aT(h,y,we,b,Ke,Fe,J))?(it||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount()),typeof P.componentDidMount=="function"&&(h.flags|=4194308)):(typeof P.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=b,h.memoizedState=Fe),P.props=b,P.state=Fe,P.context=J,b=we):(typeof P.componentDidMount=="function"&&(h.flags|=4194308),b=!1)}else{P=h.stateNode,LS(d,h),J=h.memoizedProps,it=Sh(y,J),P.props=it,gt=h.pendingProps,Ke=P.context,Fe=y.contextType,we=zl,typeof Fe=="object"&&Fe!==null&&(we=Ns(Fe)),le=y.getDerivedStateFromProps,(Fe=typeof le=="function"||typeof P.getSnapshotBeforeUpdate=="function")||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(J!==gt||Ke!==we)&&R0(h,P,b,we),_c=!1,Ke=h.memoizedState,P.state=Ke,fh(h,b,P,N),ph();var Xe=h.memoizedState;J!==gt||Ke!==Xe||_c||d!==null&&d.dependencies!==null&&dE(d.dependencies)?(typeof le=="function"&&(AE(h,y,le,b),Xe=h.memoizedState),(it=_c||aT(h,y,it,b,Ke,Xe,we)||d!==null&&d.dependencies!==null&&dE(d.dependencies))?(Fe||typeof P.UNSAFE_componentWillUpdate!="function"&&typeof P.componentWillUpdate!="function"||(typeof P.componentWillUpdate=="function"&&P.componentWillUpdate(b,Xe,we),typeof P.UNSAFE_componentWillUpdate=="function"&&P.UNSAFE_componentWillUpdate(b,Xe,we)),typeof P.componentDidUpdate=="function"&&(h.flags|=4),typeof P.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof P.componentDidUpdate!="function"||J===d.memoizedProps&&Ke===d.memoizedState||(h.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||J===d.memoizedProps&&Ke===d.memoizedState||(h.flags|=1024),h.memoizedProps=b,h.memoizedState=Xe),P.props=b,P.state=Xe,P.context=we,b=it):(typeof P.componentDidUpdate!="function"||J===d.memoizedProps&&Ke===d.memoizedState||(h.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||J===d.memoizedProps&&Ke===d.memoizedState||(h.flags|=1024),b=!1)}return P=b,DE(d,h),b=(h.flags&128)!==0,P||b?(P=h.stateNode,y=b&&typeof y.getDerivedStateFromError!="function"?null:P.render(),h.flags|=1,d!==null&&b?(h.child=vh(h,d.child,null,N),h.child=vh(h,null,y,N)):na(d,h,y,N),h.memoizedState=P.state,d=h.child):d=rl(d,h,N),d}function M0(d,h,y,b){return lh(),h.flags|=256,na(d,h,y,b),h.child}var uT={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Gp(d){return{baseLanes:d,cachePool:XR()}}function zm(d,h,y){return d=d!==null?d.childLanes&~y:0,h&&(d|=Yo),d}function hT(d,h,y){var b=h.pendingProps,N=!1,P=(h.flags&128)!==0,J;if((J=P)||(J=d!==null&&d.memoizedState===null?!1:(Ds.current&2)!==0),J&&(N=!0,h.flags&=-129),J=(h.flags&32)!==0,h.flags&=-33,d===null){if(jr){if(N?zd(h):Yd(),jr){var le=Ii,we;if(we=le){e:{for(we=le,le=Zc;we.nodeType!==8;){if(!le){le=null;break e}if(we=Rc(we.nextSibling),we===null){le=null;break e}}le=we}le!==null?(h.memoizedState={dehydrated:le,treeContext:sh!==null?{id:ql,overflow:gc}:null,retryLane:536870912,hydrationErrors:null},we=bo(18,null,null,0),we.stateNode=le,we.return=h,h.child=we,pa=h,Ii=null,we=!0):we=!1}we||ch(h)}if(le=h.memoizedState,le!==null&&(le=le.dehydrated,le!==null))return iy(le)?h.lanes=32:h.lanes=536870912,null;nl(h)}return le=b.children,b=b.fallback,N?(Yd(),N=h.mode,le=Ym({mode:"hidden",children:le},N),b=jd(b,N,y,null),le.return=h,b.return=h,le.sibling=b,h.child=le,N=h.child,N.memoizedState=Gp(y),N.childLanes=zm(d,J,y),h.memoizedState=uT,b):(zd(h),Wp(h,le))}if(we=d.memoizedState,we!==null&&(le=we.dehydrated,le!==null)){if(P)h.flags&256?(zd(h),h.flags&=-257,h=pT(d,h,y)):h.memoizedState!==null?(Yd(),h.child=d.child,h.flags|=128,h=null):(Yd(),N=b.fallback,le=h.mode,b=Ym({mode:"visible",children:b.children},le),N=jd(N,le,y,null),N.flags|=2,b.return=h,N.return=h,b.sibling=N,h.child=b,vh(h,d.child,null,y),b=h.child,b.memoizedState=Gp(y),b.childLanes=zm(d,J,y),h.memoizedState=uT,h=N);else if(zd(h),iy(le)){if(J=le.nextSibling&&le.nextSibling.dataset,J)var Fe=J.dgst;J=Fe,b=Error(s(419)),b.stack="",b.digest=J,bm({value:b,source:null,stack:null}),h=pT(d,h,y)}else if(qs||wm(d,h,y,!1),J=(y&d.childLanes)!==0,qs||J){if(J=vi,J!==null&&(b=y&-y,b=(b&42)!==0?1:un(b),b=(b&(J.suspendedLanes|y))!==0?0:b,b!==0&&b!==we.retryLane))throw we.retryLane=b,Ap(d,b),Za(J,d,b),D0;le.data==="$?"||Nh(),h=pT(d,h,y)}else le.data==="$?"?(h.flags|=192,h.child=d.child,h=null):(d=we.treeContext,Ii=Rc(le.nextSibling),pa=h,jr=!0,oh=null,Zc=!1,d!==null&&(wo[Wo++]=ql,wo[Wo++]=gc,wo[Wo++]=sh,ql=d.id,gc=d.overflow,sh=h),h=Wp(h,b.children),h.flags|=4096);return h}return N?(Yd(),N=b.fallback,le=h.mode,we=d.child,Fe=we.sibling,b=Yl(we,{mode:"hidden",children:b.children}),b.subtreeFlags=we.subtreeFlags&65011712,Fe!==null?N=Yl(Fe,N):(N=jd(N,le,y,null),N.flags|=2),N.return=h,b.return=h,b.sibling=N,h.child=b,b=N,N=h.child,le=d.child.memoizedState,le===null?le=Gp(y):(we=le.cachePool,we!==null?(Fe=us._currentValue,we=we.parent!==Fe?{parent:Fe,pool:Fe}:we):we=XR(),le={baseLanes:le.baseLanes|y,cachePool:we}),N.memoizedState=le,N.childLanes=zm(d,J,y),h.memoizedState=uT,b):(zd(h),y=d.child,d=y.sibling,y=Yl(y,{mode:"visible",children:b.children}),y.return=h,y.sibling=null,d!==null&&(J=h.deletions,J===null?(h.deletions=[d],h.flags|=16):J.push(d)),h.child=y,h.memoizedState=null,y)}function Wp(d,h){return h=Ym({mode:"visible",children:h},d.mode),h.return=d,d.child=h}function Ym(d,h){return d=bo(22,d,null,h),d.lanes=0,d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},d}function pT(d,h,y){return vh(h,d.child,null,y),d=Wp(h,h.pendingProps.children),d.flags|=2,h.memoizedState=null,d}function fT(d,h,y){d.lanes|=h;var b=d.alternate;b!==null&&(b.lanes|=h),xS(d.return,h,y)}function zp(d,h,y,b,N){var P=d.memoizedState;P===null?d.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:b,tail:y,tailMode:N}:(P.isBackwards=h,P.rendering=null,P.renderingStartTime=0,P.last=b,P.tail=y,P.tailMode=N)}function j0(d,h,y){var b=h.pendingProps,N=b.revealOrder,P=b.tail;if(na(d,h,b.children,y),b=Ds.current,(b&2)!==0)b=b&1|2,h.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=h.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&fT(d,y,h);else if(d.tag===19)fT(d,y,h);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===h)break e;for(;d.sibling===null;){if(d.return===null||d.return===h)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}b&=1}switch(We(Ds,b),N){case"forwards":for(y=h.child,N=null;y!==null;)d=y.alternate,d!==null&&Hp(d)===null&&(N=y),y=y.sibling;y=N,y===null?(N=h.child,h.child=null):(N=y.sibling,y.sibling=null),zp(h,!1,N,y,P);break;case"backwards":for(y=null,N=h.child,h.child=null;N!==null;){if(d=N.alternate,d!==null&&Hp(d)===null){h.child=N;break}d=N.sibling,N.sibling=y,y=N,N=d}zp(h,!0,y,null,P);break;case"together":zp(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function rl(d,h,y){if(d!==null&&(h.dependencies=d.dependencies),Tc|=h.lanes,(y&h.childLanes)===0)if(d!==null){if(wm(d,h,y,!1),(y&h.childLanes)===0)return null}else return null;if(d!==null&&h.child!==d.child)throw Error(s(153));if(h.child!==null){for(d=h.child,y=Yl(d,d.pendingProps),h.child=y,y.return=h;d.sibling!==null;)d=d.sibling,y=y.sibling=Yl(d,d.pendingProps),y.return=h;y.sibling=null}return h.child}function xE(d,h){return(d.lanes&h)!==0?!0:(d=d.dependencies,!!(d!==null&&dE(d)))}function nx(d,h,y){switch(h.tag){case 3:ut(h,h.stateNode.containerInfo),Ud(h,us,d.memoizedState.cache),lh();break;case 27:case 5:Mt(h);break;case 4:ut(h,h.stateNode.containerInfo);break;case 10:Ud(h,h.type,h.memoizedProps.value);break;case 13:var b=h.memoizedState;if(b!==null)return b.dehydrated!==null?(zd(h),h.flags|=128,null):(y&h.child.childLanes)!==0?hT(d,h,y):(zd(h),d=rl(d,h,y),d!==null?d.sibling:null);zd(h);break;case 19:var N=(d.flags&128)!==0;if(b=(y&h.childLanes)!==0,b||(wm(d,h,y,!1),b=(y&h.childLanes)!==0),N){if(b)return j0(d,h,y);h.flags|=128}if(N=h.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),We(Ds,Ds.current),b)break;return null;case 22:case 23:return h.lanes=0,k0(d,h,y);case 24:Ud(h,us,d.memoizedState.cache)}return rl(d,h,y)}function qm(d,h,y){if(d!==null)if(d.memoizedProps!==h.pendingProps)qs=!0;else{if(!xE(d,y)&&(h.flags&128)===0)return qs=!1,nx(d,h,y);qs=(d.flags&131072)!==0}else qs=!1,jr&&(h.flags&1048576)!==0&&AS(h,oE,h.index);switch(h.lanes=0,h.tag){case 16:e:{d=h.pendingProps;var b=h.elementType,N=b._init;if(b=N(b._payload),h.type=b,typeof b=="function")RS(b)?(d=Sh(b,d),h.tag=1,h=dT(null,h,b,d,y)):(h.tag=0,h=cT(null,h,b,d,y));else{if(b!=null){if(N=b.$$typeof,N===ye){h.tag=11,h=OE(null,h,b,d,y);break e}else if(N===$){h.tag=14,h=x0(null,h,b,d,y);break e}}throw h=Ne(b)||b,Error(s(306,h,""))}}return h;case 0:return cT(d,h,h.type,h.pendingProps,y);case 1:return b=h.type,N=Sh(b,h.pendingProps),dT(d,h,b,N,y);case 3:e:{if(ut(h,h.stateNode.containerInfo),d===null)throw Error(s(387));b=h.pendingProps;var P=h.memoizedState;N=P.element,LS(d,h),fh(h,b,null,y);var J=h.memoizedState;if(b=J.cache,Ud(h,us,b),b!==P.cache&&PS(h,[us],y,!0),ph(),b=J.element,P.isDehydrated)if(P={element:b,isDehydrated:!1,cache:J.cache},h.updateQueue.baseState=P,h.memoizedState=P,h.flags&256){h=M0(d,h,b,y);break e}else if(b!==N){N=To(Error(s(424)),h),bm(N),h=M0(d,h,b,y);break e}else{switch(d=h.stateNode.containerInfo,d.nodeType){case 9:d=d.body;break;default:d=d.nodeName==="HTML"?d.ownerDocument.body:d}for(Ii=Rc(d.firstChild),pa=h,jr=!0,oh=null,Zc=!0,y=b0(h,null,b,y),h.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling}else{if(lh(),b===N){h=rl(d,h,y);break e}na(d,h,b,y)}h=h.child}return h;case 26:return DE(d,h),d===null?(y=pC(h.type,null,h.pendingProps,null))?h.memoizedState=y:jr||(y=h.type,d=h.pendingProps,b=ry(St.current).createElement(y),b[mr]=h,b[yr]=d,Xs(b,y,d),Ui(b),h.stateNode=b):h.memoizedState=pC(h.type,d.memoizedProps,h.pendingProps,d.memoizedState),null;case 27:return Mt(h),d===null&&jr&&(b=h.stateNode=lC(h.type,h.pendingProps,St.current),pa=h,Zc=!0,N=Ii,tu(h.type)?(qT=N,Ii=Rc(b.firstChild)):Ii=N),na(d,h,h.pendingProps.children,y),DE(d,h),d===null&&(h.flags|=4194304),h.child;case 5:return d===null&&jr&&((N=b=Ii)&&(b=vx(b,h.type,h.pendingProps,Zc),b!==null?(h.stateNode=b,pa=h,Ii=Rc(b.firstChild),Zc=!1,N=!0):N=!1),N||ch(h)),Mt(h),N=h.type,P=h.pendingProps,J=d!==null?d.memoizedProps:null,b=P.children,WT(N,P)?b=null:J!==null&&WT(N,J)&&(h.flags|=32),h.memoizedState!==null&&(N=FS(d,h,r0,null,null,y),gg._currentValue=N),DE(d,h),na(d,h,b,y),h.child;case 6:return d===null&&jr&&((d=y=Ii)&&(y=Sx(y,h.pendingProps,Zc),y!==null?(h.stateNode=y,pa=h,Ii=null,d=!0):d=!1),d||ch(h)),null;case 13:return hT(d,h,y);case 4:return ut(h,h.stateNode.containerInfo),b=h.pendingProps,d===null?h.child=vh(h,null,b,y):na(d,h,b,y),h.child;case 11:return OE(d,h,h.type,h.pendingProps,y);case 7:return na(d,h,h.pendingProps,y),h.child;case 8:return na(d,h,h.pendingProps.children,y),h.child;case 12:return na(d,h,h.pendingProps.children,y),h.child;case 10:return b=h.pendingProps,Ud(h,h.type,b.value),na(d,h,b.children,y),h.child;case 9:return N=h.type._context,b=h.pendingProps.children,el(h),N=Ns(N),b=b(N),h.flags|=1,na(d,h,b,y),h.child;case 14:return x0(d,h,h.type,h.pendingProps,y);case 15:return P0(d,h,h.type,h.pendingProps,y);case 19:return j0(d,h,y);case 31:return b=h.pendingProps,y=h.mode,b={mode:b.mode,children:b.children},d===null?(y=Ym(b,y),y.ref=h.ref,h.child=y,y.return=h,h=y):(y=Yl(d.child,b),y.ref=h.ref,h.child=y,y.return=h,h=y),h;case 22:return k0(d,h,y);case 24:return el(h),b=Ns(us),d===null?(N=kS(),N===null&&(N=vi,P=Rm(),N.pooledCache=P,P.refCount++,P!==null&&(N.pooledCacheLanes|=y),N=P),h.memoizedState={parent:b,cache:N},fE(h),Ud(h,us,N)):((d.lanes&y)!==0&&(LS(d,h),fh(h,null,null,y),ph()),N=d.memoizedState,P=h.memoizedState,N.parent!==b?(N={parent:b,cache:b},h.memoizedState=N,h.lanes===0&&(h.memoizedState=h.updateQueue.baseState=N),Ud(h,us,b)):(b=P.cache,Ud(h,us,b),b!==N.cache&&PS(h,[us],y,!0))),na(d,h,h.pendingProps.children,y),h.child;case 29:throw h.pendingProps}throw Error(s(156,h.tag))}function il(d){d.flags|=4}function U0(d,h){if(h.type!=="stylesheet"||(h.state.loading&4)!==0)d.flags&=-16777217;else if(d.flags|=16777216,!gC(h)){if(h=Os.current,h!==null&&((br&4194048)===br?tl!==null:(br&62914560)!==br&&(br&536870912)===0||h!==tl))throw Im=Pp,QR;d.flags|=8192}}function PE(d,h){h!==null&&(d.flags|=4),d.flags&16384&&(h=d.tag!==22?je():536870912,d.lanes|=h,Rh|=h)}function Km(d,h){if(!jr)switch(d.tailMode){case"hidden":h=d.tail;for(var y=null;h!==null;)h.alternate!==null&&(y=h),h=h.sibling;y===null?d.tail=null:y.sibling=null;break;case"collapsed":y=d.tail;for(var b=null;y!==null;)y.alternate!==null&&(b=y),y=y.sibling;b===null?h||d.tail===null?d.tail=null:d.tail.sibling=null:b.sibling=null}}function yi(d){var h=d.alternate!==null&&d.alternate.child===d.child,y=0,b=0;if(h)for(var N=d.child;N!==null;)y|=N.lanes|N.childLanes,b|=N.subtreeFlags&65011712,b|=N.flags&65011712,N.return=d,N=N.sibling;else for(N=d.child;N!==null;)y|=N.lanes|N.childLanes,b|=N.subtreeFlags,b|=N.flags,N.return=d,N=N.sibling;return d.subtreeFlags|=b,d.childLanes=y,h}function rx(d,h,y){var b=h.pendingProps;switch(IS(h),h.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yi(h),null;case 1:return yi(h),null;case 3:return y=h.stateNode,b=null,d!==null&&(b=d.memoizedState.cache),h.memoizedState.cache!==b&&(h.flags|=2048),Xl(us),tn(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(d===null||d.child===null)&&(Tm(h)?il(h):d===null||d.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,WR())),yi(h),null;case 26:return y=h.memoizedState,d===null?(il(h),y!==null?(yi(h),U0(h,y)):(yi(h),h.flags&=-16777217)):y?y!==d.memoizedState?(il(h),yi(h),U0(h,y)):(yi(h),h.flags&=-16777217):(d.memoizedProps!==b&&il(h),yi(h),h.flags&=-16777217),null;case 27:wn(h),y=St.current;var N=h.type;if(d!==null&&h.stateNode!=null)d.memoizedProps!==b&&il(h);else{if(!b){if(h.stateNode===null)throw Error(s(166));return yi(h),null}d=Be.current,Tm(h)?OS(h):(d=lC(N,b,y),h.stateNode=d,il(h))}return yi(h),null;case 5:if(wn(h),y=h.type,d!==null&&h.stateNode!=null)d.memoizedProps!==b&&il(h);else{if(!b){if(h.stateNode===null)throw Error(s(166));return yi(h),null}if(d=Be.current,Tm(h))OS(h);else{switch(N=ry(St.current),d){case 1:d=N.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:d=N.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":d=N.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":d=N.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":d=N.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild);break;case"select":d=typeof b.is=="string"?N.createElement("select",{is:b.is}):N.createElement("select"),b.multiple?d.multiple=!0:b.size&&(d.size=b.size);break;default:d=typeof b.is=="string"?N.createElement(y,{is:b.is}):N.createElement(y)}}d[mr]=h,d[yr]=b;e:for(N=h.child;N!==null;){if(N.tag===5||N.tag===6)d.appendChild(N.stateNode);else if(N.tag!==4&&N.tag!==27&&N.child!==null){N.child.return=N,N=N.child;continue}if(N===h)break e;for(;N.sibling===null;){if(N.return===null||N.return===h)break e;N=N.return}N.sibling.return=N.return,N=N.sibling}h.stateNode=d;e:switch(Xs(d,y,b),y){case"button":case"input":case"select":case"textarea":d=!!b.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&il(h)}}return yi(h),h.flags&=-16777217,null;case 6:if(d&&h.stateNode!=null)d.memoizedProps!==b&&il(h);else{if(typeof b!="string"&&h.stateNode===null)throw Error(s(166));if(d=St.current,Tm(h)){if(d=h.stateNode,y=h.memoizedProps,b=null,N=pa,N!==null)switch(N.tag){case 27:case 5:b=N.memoizedProps}d[mr]=h,d=!!(d.nodeValue===y||b!==null&&b.suppressHydrationWarning===!0||ny(d.nodeValue,y)),d||ch(h)}else d=ry(d).createTextNode(b),d[mr]=h,h.stateNode=d}return yi(h),null;case 13:if(b=h.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(N=Tm(h),b!==null&&b.dehydrated!==null){if(d===null){if(!N)throw Error(s(318));if(N=h.memoizedState,N=N!==null?N.dehydrated:null,!N)throw Error(s(317));N[mr]=h}else lh(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;yi(h),N=!1}else N=WR(),d!==null&&d.memoizedState!==null&&(d.memoizedState.hydrationErrors=N),N=!0;if(!N)return h.flags&256?(nl(h),h):(nl(h),null)}if(nl(h),(h.flags&128)!==0)return h.lanes=y,h;if(y=b!==null,d=d!==null&&d.memoizedState!==null,y){b=h.child,N=null,b.alternate!==null&&b.alternate.memoizedState!==null&&b.alternate.memoizedState.cachePool!==null&&(N=b.alternate.memoizedState.cachePool.pool);var P=null;b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(P=b.memoizedState.cachePool.pool),P!==N&&(b.flags|=2048)}return y!==d&&y&&(h.child.flags|=8192),PE(h,h.updateQueue),yi(h),null;case 4:return tn(),d===null&&ey(h.stateNode.containerInfo),yi(h),null;case 10:return Xl(h.type),yi(h),null;case 19:if(qe(Ds),N=h.memoizedState,N===null)return yi(h),null;if(b=(h.flags&128)!==0,P=N.rendering,P===null)if(b)Km(N,!1);else{if(Vi!==0||d!==null&&(d.flags&128)!==0)for(d=h.child;d!==null;){if(P=Hp(d),P!==null){for(h.flags|=128,Km(N,!1),d=P.updateQueue,h.updateQueue=d,PE(h,d),h.subtreeFlags=0,d=y,y=h.child;y!==null;)iE(y,d),y=y.sibling;return We(Ds,Ds.current&1|2),h.child}d=d.sibling}N.tail!==null&&mt()>Qp&&(h.flags|=128,b=!0,Km(N,!1),h.lanes=4194304)}else{if(!b)if(d=Hp(P),d!==null){if(h.flags|=128,b=!0,d=d.updateQueue,h.updateQueue=d,PE(h,d),Km(N,!0),N.tail===null&&N.tailMode==="hidden"&&!P.alternate&&!jr)return yi(h),null}else 2*mt()-N.renderingStartTime>Qp&&y!==536870912&&(h.flags|=128,b=!0,Km(N,!1),h.lanes=4194304);N.isBackwards?(P.sibling=h.child,h.child=P):(d=N.last,d!==null?d.sibling=P:h.child=P,N.last=P)}return N.tail!==null?(h=N.tail,N.rendering=h,N.tail=h.sibling,N.renderingStartTime=mt(),h.sibling=null,d=Ds.current,We(Ds,b?d&1|2:d&1),h):(yi(h),null);case 22:case 23:return nl(h),VS(),b=h.memoizedState!==null,d!==null?d.memoizedState!==null!==b&&(h.flags|=8192):b&&(h.flags|=8192),b?(y&536870912)!==0&&(h.flags&128)===0&&(yi(h),h.subtreeFlags&6&&(h.flags|=8192)):yi(h),y=h.updateQueue,y!==null&&PE(h,y.retryQueue),y=null,d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(y=d.memoizedState.cachePool.pool),b=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(b=h.memoizedState.cachePool.pool),b!==y&&(h.flags|=2048),d!==null&&qe(Vd),null;case 24:return y=null,d!==null&&(y=d.memoizedState.cache),h.memoizedState.cache!==y&&(h.flags|=2048),Xl(us),yi(h),null;case 25:return null;case 30:return null}throw Error(s(156,h.tag))}function ix(d,h){switch(IS(h),h.tag){case 1:return d=h.flags,d&65536?(h.flags=d&-65537|128,h):null;case 3:return Xl(us),tn(),d=h.flags,(d&65536)!==0&&(d&128)===0?(h.flags=d&-65537|128,h):null;case 26:case 27:case 5:return wn(h),null;case 13:if(nl(h),d=h.memoizedState,d!==null&&d.dehydrated!==null){if(h.alternate===null)throw Error(s(340));lh()}return d=h.flags,d&65536?(h.flags=d&-65537|128,h):null;case 19:return qe(Ds),null;case 4:return tn(),null;case 10:return Xl(h.type),null;case 22:case 23:return nl(h),VS(),d!==null&&qe(Vd),d=h.flags,d&65536?(h.flags=d&-65537|128,h):null;case 24:return Xl(us),null;case 25:return null;default:return null}}function V0(d,h){switch(IS(h),h.tag){case 3:Xl(us),tn();break;case 26:case 27:case 5:wn(h);break;case 4:tn();break;case 13:nl(h);break;case 19:qe(Ds);break;case 10:Xl(h.type);break;case 22:case 23:nl(h),VS(),d!==null&&qe(Vd);break;case 24:Xl(us)}}function Yp(d,h){try{var y=h.updateQueue,b=y!==null?y.lastEffect:null;if(b!==null){var N=b.next;y=N;do{if((y.tag&d)===d){b=void 0;var P=y.create,J=y.inst;b=P(),J.destroy=b}y=y.next}while(y!==N)}}catch(le){li(h,h.return,le)}}function qd(d,h,y){try{var b=h.updateQueue,N=b!==null?b.lastEffect:null;if(N!==null){var P=N.next;b=P;do{if((b.tag&d)===d){var J=b.inst,le=J.destroy;if(le!==void 0){J.destroy=void 0,N=h;var we=y,Fe=le;try{Fe()}catch(it){li(N,we,it)}}}b=b.next}while(b!==P)}}catch(it){li(h,h.return,it)}}function F0(d){var h=d.updateQueue;if(h!==null){var y=d.stateNode;try{mE(h,y)}catch(b){li(d,d.return,b)}}}function kE(d,h,y){y.props=Sh(d.type,d.memoizedProps),y.state=d.memoizedState;try{y.componentWillUnmount()}catch(b){li(d,h,b)}}function Xm(d,h){try{var y=d.ref;if(y!==null){switch(d.tag){case 26:case 27:case 5:var b=d.stateNode;break;case 30:b=d.stateNode;break;default:b=d.stateNode}typeof y=="function"?d.refCleanup=y(b):y.current=b}}catch(N){li(d,h,N)}}function zo(d,h){var y=d.ref,b=d.refCleanup;if(y!==null)if(typeof b=="function")try{b()}catch(N){li(d,h,N)}finally{d.refCleanup=null,d=d.alternate,d!=null&&(d.refCleanup=null)}else if(typeof y=="function")try{y(null)}catch(N){li(d,h,N)}else y.current=null}function B0(d){var h=d.type,y=d.memoizedProps,b=d.stateNode;try{e:switch(h){case"button":case"input":case"select":case"textarea":y.autoFocus&&b.focus();break e;case"img":y.src?b.src=y.src:y.srcSet&&(b.srcset=y.srcSet)}}catch(N){li(d,d.return,N)}}function LE(d,h,y){try{var b=d.stateNode;mx(b,d.type,y,h),b[yr]=h}catch(N){li(d,d.return,N)}}function H0(d){return d.tag===5||d.tag===3||d.tag===26||d.tag===27&&tu(d.type)||d.tag===4}function mT(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||H0(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.tag===27&&tu(d.type)||d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function ME(d,h,y){var b=d.tag;if(b===5||b===6)d=d.stateNode,h?(y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y).insertBefore(d,h):(h=y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y,h.appendChild(d),y=y._reactRootContainer,y!=null||h.onclick!==null||(h.onclick=dg));else if(b!==4&&(b===27&&tu(d.type)&&(y=d.stateNode,h=null),d=d.child,d!==null))for(ME(d,h,y),d=d.sibling;d!==null;)ME(d,h,y),d=d.sibling}function jE(d,h,y){var b=d.tag;if(b===5||b===6)d=d.stateNode,h?y.insertBefore(d,h):y.appendChild(d);else if(b!==4&&(b===27&&tu(d.type)&&(y=d.stateNode),d=d.child,d!==null))for(jE(d,h,y),d=d.sibling;d!==null;)jE(d,h,y),d=d.sibling}function G0(d){var h=d.stateNode,y=d.memoizedProps;try{for(var b=d.type,N=h.attributes;N.length;)h.removeAttributeNode(N[0]);Xs(h,b,y),h[mr]=d,h[yr]=y}catch(P){li(d,d.return,P)}}var sl=!1,qi=!1,Qm=!1,W0=typeof WeakSet=="function"?WeakSet:Set,Ks=null;function $m(d,h){if(d=d.containerInfo,GT=uy,d=Wl(d),gS(d)){if("selectionStart"in d)var y={start:d.selectionStart,end:d.selectionEnd};else e:{y=(y=d.ownerDocument)&&y.defaultView||window;var b=y.getSelection&&y.getSelection();if(b&&b.rangeCount!==0){y=b.anchorNode;var N=b.anchorOffset,P=b.focusNode;b=b.focusOffset;try{y.nodeType,P.nodeType}catch{y=null;break e}var J=0,le=-1,we=-1,Fe=0,it=0,gt=d,Ke=null;t:for(;;){for(var Xe;gt!==y||N!==0&&gt.nodeType!==3||(le=J+N),gt!==P||b!==0&&gt.nodeType!==3||(we=J+b),gt.nodeType===3&&(J+=gt.nodeValue.length),(Xe=gt.firstChild)!==null;)Ke=gt,gt=Xe;for(;;){if(gt===d)break t;if(Ke===y&&++Fe===N&&(le=J),Ke===P&&++it===b&&(we=J),(Xe=gt.nextSibling)!==null)break;gt=Ke,Ke=gt.parentNode}gt=Xe}y=le===-1||we===-1?null:{start:le,end:we}}else y=null}y=y||{start:0,end:0}}else y=null;for(cf={focusedElem:d,selectionRange:y},uy=!1,Ks=h;Ks!==null;)if(h=Ks,d=h.child,(h.subtreeFlags&1024)!==0&&d!==null)d.return=h,Ks=d;else for(;Ks!==null;){switch(h=Ks,P=h.alternate,d=h.flags,h.tag){case 0:break;case 11:case 15:break;case 1:if((d&1024)!==0&&P!==null){d=void 0,y=h,N=P.memoizedProps,P=P.memoizedState,b=y.stateNode;try{var Pn=Sh(y.type,N,y.elementType===y.type);d=b.getSnapshotBeforeUpdate(Pn,P),b.__reactInternalSnapshotBeforeUpdate=d}catch(gn){li(y,y.return,gn)}}break;case 3:if((d&1024)!==0){if(d=h.stateNode.containerInfo,y=d.nodeType,y===9)YT(d);else if(y===1)switch(d.nodeName){case"HEAD":case"HTML":case"BODY":YT(d);break;default:d.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((d&1024)!==0)throw Error(s(163))}if(d=h.sibling,d!==null){d.return=h.return,Ks=d;break}Ks=h.return}}function gT(d,h,y){var b=y.flags;switch(y.tag){case 0:case 11:case 15:Na(d,y),b&4&&Yp(5,y);break;case 1:if(Na(d,y),b&4)if(d=y.stateNode,h===null)try{d.componentDidMount()}catch(J){li(y,y.return,J)}else{var N=Sh(y.type,h.memoizedProps);h=h.memoizedState;try{d.componentDidUpdate(N,h,d.__reactInternalSnapshotBeforeUpdate)}catch(J){li(y,y.return,J)}}b&64&&F0(y),b&512&&Xm(y,y.return);break;case 3:if(Na(d,y),b&64&&(d=y.updateQueue,d!==null)){if(h=null,y.child!==null)switch(y.child.tag){case 27:case 5:h=y.child.stateNode;break;case 1:h=y.child.stateNode}try{mE(d,h)}catch(J){li(y,y.return,J)}}break;case 27:h===null&&b&4&&G0(y);case 26:case 5:Na(d,y),h===null&&b&4&&B0(y),b&512&&Xm(y,y.return);break;case 12:Na(d,y);break;case 13:Na(d,y),b&4&&z0(d,y),b&64&&(d=y.memoizedState,d!==null&&(d=d.dehydrated,d!==null&&(y=dx.bind(null,y),Tx(d,y))));break;case 22:if(b=y.memoizedState!==null||sl,!b){h=h!==null&&h.memoizedState!==null||qi,N=sl;var P=qi;sl=b,(qi=h)&&!P?Ja(d,y,(y.subtreeFlags&8772)!==0):Na(d,y),sl=N,qi=P}break;case 30:break;default:Na(d,y)}}function qp(d){var h=d.alternate;h!==null&&(d.alternate=null,qp(h)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(h=d.stateNode,h!==null&&Ra(h)),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}var Kr=null,Ia=!1;function vc(d,h,y){for(y=y.child;y!==null;)Jm(d,h,y),y=y.sibling}function Jm(d,h,y){if(sn&&typeof sn.onCommitFiberUnmount=="function")try{sn.onCommitFiberUnmount(Ht,y)}catch{}switch(y.tag){case 26:qi||zo(y,h),vc(d,h,y),y.memoizedState?y.memoizedState.count--:y.stateNode&&(y=y.stateNode,y.parentNode.removeChild(y));break;case 27:qi||zo(y,h);var b=Kr,N=Ia;tu(y.type)&&(Kr=y.stateNode,Ia=!1),vc(d,h,y),ug(y.stateNode),Kr=b,Ia=N;break;case 5:qi||zo(y,h);case 6:if(b=Kr,N=Ia,Kr=null,vc(d,h,y),Kr=b,Ia=N,Kr!==null)if(Ia)try{(Kr.nodeType===9?Kr.body:Kr.nodeName==="HTML"?Kr.ownerDocument.body:Kr).removeChild(y.stateNode)}catch(P){li(y,h,P)}else try{Kr.removeChild(y.stateNode)}catch(P){li(y,h,P)}break;case 18:Kr!==null&&(Ia?(d=Kr,oC(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,y.stateNode),Sg(d)):oC(Kr,y.stateNode));break;case 4:b=Kr,N=Ia,Kr=y.stateNode.containerInfo,Ia=!0,vc(d,h,y),Kr=b,Ia=N;break;case 0:case 11:case 14:case 15:qi||qd(2,y,h),qi||qd(4,y,h),vc(d,h,y);break;case 1:qi||(zo(y,h),b=y.stateNode,typeof b.componentWillUnmount=="function"&&kE(y,h,b)),vc(d,h,y);break;case 21:vc(d,h,y);break;case 22:qi=(b=qi)||y.memoizedState!==null,vc(d,h,y),qi=b;break;default:vc(d,h,y)}}function z0(d,h){if(h.memoizedState===null&&(d=h.alternate,d!==null&&(d=d.memoizedState,d!==null&&(d=d.dehydrated,d!==null))))try{Sg(d)}catch(y){li(h,h.return,y)}}function sx(d){switch(d.tag){case 13:case 19:var h=d.stateNode;return h===null&&(h=d.stateNode=new W0),h;case 22:return d=d.stateNode,h=d._retryCache,h===null&&(h=d._retryCache=new W0),h;default:throw Error(s(435,d.tag))}}function _T(d,h){var y=sx(d);h.forEach(function(b){var N=ux.bind(null,d,b);y.has(b)||(y.add(b),b.then(N,N))})}function $a(d,h){var y=h.deletions;if(y!==null)for(var b=0;b<y.length;b++){var N=y[b],P=d,J=h,le=J;e:for(;le!==null;){switch(le.tag){case 27:if(tu(le.type)){Kr=le.stateNode,Ia=!1;break e}break;case 5:Kr=le.stateNode,Ia=!1;break e;case 3:case 4:Kr=le.stateNode.containerInfo,Ia=!0;break e}le=le.return}if(Kr===null)throw Error(s(160));Jm(P,J,N),Kr=null,Ia=!1,P=N.alternate,P!==null&&(P.return=null),N.return=null}if(h.subtreeFlags&13878)for(h=h.child;h!==null;)Y0(h,d),h=h.sibling}var Sc=null;function Y0(d,h){var y=d.alternate,b=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:$a(h,d),Co(d),b&4&&(qd(3,d,d.return),Yp(3,d),qd(5,d,d.return));break;case 1:$a(h,d),Co(d),b&512&&(qi||y===null||zo(y,y.return)),b&64&&sl&&(d=d.updateQueue,d!==null&&(b=d.callbacks,b!==null&&(y=d.shared.hiddenCallbacks,d.shared.hiddenCallbacks=y===null?b:y.concat(b))));break;case 26:var N=Sc;if($a(h,d),Co(d),b&512&&(qi||y===null||zo(y,y.return)),b&4){var P=y!==null?y.memoizedState:null;if(b=d.memoizedState,y===null)if(b===null)if(d.stateNode===null){e:{b=d.type,y=d.memoizedProps,N=N.ownerDocument||N;t:switch(b){case"title":P=N.getElementsByTagName("title")[0],(!P||P[za]||P[mr]||P.namespaceURI==="http://www.w3.org/2000/svg"||P.hasAttribute("itemprop"))&&(P=N.createElement(b),N.head.insertBefore(P,N.querySelector("head > title"))),Xs(P,b,y),P[mr]=d,Ui(P),b=P;break e;case"link":var J=QT("link","href",N).get(b+(y.href||""));if(J){for(var le=0;le<J.length;le++)if(P=J[le],P.getAttribute("href")===(y.href==null||y.href===""?null:y.href)&&P.getAttribute("rel")===(y.rel==null?null:y.rel)&&P.getAttribute("title")===(y.title==null?null:y.title)&&P.getAttribute("crossorigin")===(y.crossOrigin==null?null:y.crossOrigin)){J.splice(le,1);break t}}P=N.createElement(b),Xs(P,b,y),N.head.appendChild(P);break;case"meta":if(J=QT("meta","content",N).get(b+(y.content||""))){for(le=0;le<J.length;le++)if(P=J[le],P.getAttribute("content")===(y.content==null?null:""+y.content)&&P.getAttribute("name")===(y.name==null?null:y.name)&&P.getAttribute("property")===(y.property==null?null:y.property)&&P.getAttribute("http-equiv")===(y.httpEquiv==null?null:y.httpEquiv)&&P.getAttribute("charset")===(y.charSet==null?null:y.charSet)){J.splice(le,1);break t}}P=N.createElement(b),Xs(P,b,y),N.head.appendChild(P);break;default:throw Error(s(468,b))}P[mr]=d,Ui(P),b=P}d.stateNode=b}else mC(N,d.type,d.stateNode);else d.stateNode=oy(N,b,d.memoizedProps);else P!==b?(P===null?y.stateNode!==null&&(y=y.stateNode,y.parentNode.removeChild(y)):P.count--,b===null?mC(N,d.type,d.stateNode):oy(N,b,d.memoizedProps)):b===null&&d.stateNode!==null&&LE(d,d.memoizedProps,y.memoizedProps)}break;case 27:$a(h,d),Co(d),b&512&&(qi||y===null||zo(y,y.return)),y!==null&&b&4&&LE(d,d.memoizedProps,y.memoizedProps);break;case 5:if($a(h,d),Co(d),b&512&&(qi||y===null||zo(y,y.return)),d.flags&32){N=d.stateNode;try{Ya(N,"")}catch(Xe){li(d,d.return,Xe)}}b&4&&d.stateNode!=null&&(N=d.memoizedProps,LE(d,N,y!==null?y.memoizedProps:N)),b&1024&&(Qm=!0);break;case 6:if($a(h,d),Co(d),b&4){if(d.stateNode===null)throw Error(s(162));b=d.memoizedProps,y=d.stateNode;try{y.nodeValue=b}catch(Xe){li(d,d.return,Xe)}}break;case 3:if(ly=null,N=Sc,Sc=sy(h.containerInfo),$a(h,d),Sc=N,Co(d),b&4&&y!==null&&y.memoizedState.isDehydrated)try{Sg(h.containerInfo)}catch(Xe){li(d,d.return,Xe)}Qm&&(Qm=!1,UE(d));break;case 4:b=Sc,Sc=sy(d.stateNode.containerInfo),$a(h,d),Co(d),Sc=b;break;case 12:$a(h,d),Co(d);break;case 13:$a(h,d),Co(d),d.child.flags&8192&&d.memoizedState!==null!=(y!==null&&y.memoizedState!==null)&&(rg=mt()),b&4&&(b=d.updateQueue,b!==null&&(d.updateQueue=null,_T(d,b)));break;case 22:N=d.memoizedState!==null;var we=y!==null&&y.memoizedState!==null,Fe=sl,it=qi;if(sl=Fe||N,qi=it||we,$a(h,d),qi=it,sl=Fe,Co(d),b&8192)e:for(h=d.stateNode,h._visibility=N?h._visibility&-2:h._visibility|1,N&&(y===null||we||sl||qi||Th(d)),y=null,h=d;;){if(h.tag===5||h.tag===26){if(y===null){we=y=h;try{if(P=we.stateNode,N)J=P.style,typeof J.setProperty=="function"?J.setProperty("display","none","important"):J.display="none";else{le=we.stateNode;var gt=we.memoizedProps.style,Ke=gt!=null&&gt.hasOwnProperty("display")?gt.display:null;le.style.display=Ke==null||typeof Ke=="boolean"?"":(""+Ke).trim()}}catch(Xe){li(we,we.return,Xe)}}}else if(h.tag===6){if(y===null){we=h;try{we.stateNode.nodeValue=N?"":we.memoizedProps}catch(Xe){li(we,we.return,Xe)}}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===d)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===d)break e;for(;h.sibling===null;){if(h.return===null||h.return===d)break e;y===h&&(y=null),h=h.return}y===h&&(y=null),h.sibling.return=h.return,h=h.sibling}b&4&&(b=d.updateQueue,b!==null&&(y=b.retryQueue,y!==null&&(b.retryQueue=null,_T(d,y))));break;case 19:$a(h,d),Co(d),b&4&&(b=d.updateQueue,b!==null&&(d.updateQueue=null,_T(d,b)));break;case 30:break;case 21:break;default:$a(h,d),Co(d)}}function Co(d){var h=d.flags;if(h&2){try{for(var y,b=d.return;b!==null;){if(H0(b)){y=b;break}b=b.return}if(y==null)throw Error(s(160));switch(y.tag){case 27:var N=y.stateNode,P=mT(d);jE(d,P,N);break;case 5:var J=y.stateNode;y.flags&32&&(Ya(J,""),y.flags&=-33);var le=mT(d);jE(d,le,J);break;case 3:case 4:var we=y.stateNode.containerInfo,Fe=mT(d);ME(d,Fe,we);break;default:throw Error(s(161))}}catch(it){li(d,d.return,it)}d.flags&=-3}h&4096&&(d.flags&=-4097)}function UE(d){if(d.subtreeFlags&1024)for(d=d.child;d!==null;){var h=d;UE(h),h.tag===5&&h.flags&1024&&h.stateNode.reset(),d=d.sibling}}function Na(d,h){if(h.subtreeFlags&8772)for(h=h.child;h!==null;)gT(d,h.alternate,h),h=h.sibling}function Th(d){for(d=d.child;d!==null;){var h=d;switch(h.tag){case 0:case 11:case 14:case 15:qd(4,h,h.return),Th(h);break;case 1:zo(h,h.return);var y=h.stateNode;typeof y.componentWillUnmount=="function"&&kE(h,h.return,y),Th(h);break;case 27:ug(h.stateNode);case 26:case 5:zo(h,h.return),Th(h);break;case 22:h.memoizedState===null&&Th(h);break;case 30:Th(h);break;default:Th(h)}d=d.sibling}}function Ja(d,h,y){for(y=y&&(h.subtreeFlags&8772)!==0,h=h.child;h!==null;){var b=h.alternate,N=d,P=h,J=P.flags;switch(P.tag){case 0:case 11:case 15:Ja(N,P,y),Yp(4,P);break;case 1:if(Ja(N,P,y),b=P,N=b.stateNode,typeof N.componentDidMount=="function")try{N.componentDidMount()}catch(Fe){li(b,b.return,Fe)}if(b=P,N=b.updateQueue,N!==null){var le=b.stateNode;try{var we=N.shared.hiddenCallbacks;if(we!==null)for(N.shared.hiddenCallbacks=null,N=0;N<we.length;N++)US(we[N],le)}catch(Fe){li(b,b.return,Fe)}}y&&J&64&&F0(P),Xm(P,P.return);break;case 27:G0(P);case 26:case 5:Ja(N,P,y),y&&b===null&&J&4&&B0(P),Xm(P,P.return);break;case 12:Ja(N,P,y);break;case 13:Ja(N,P,y),y&&J&4&&z0(N,P);break;case 22:P.memoizedState===null&&Ja(N,P,y),Xm(P,P.return);break;case 30:break;default:Ja(N,P,y)}h=h.sibling}}function VE(d,h){var y=null;d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(y=d.memoizedState.cachePool.pool),d=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(d=h.memoizedState.cachePool.pool),d!==y&&(d!=null&&d.refCount++,y!=null&&Cm(y))}function Oa(d,h){d=null,h.alternate!==null&&(d=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==d&&(h.refCount++,d!=null&&Cm(d))}function al(d,h,y,b){if(h.subtreeFlags&10256)for(h=h.child;h!==null;)q0(d,h,y,b),h=h.sibling}function q0(d,h,y,b){var N=h.flags;switch(h.tag){case 0:case 11:case 15:al(d,h,y,b),N&2048&&Yp(9,h);break;case 1:al(d,h,y,b);break;case 3:al(d,h,y,b),N&2048&&(d=null,h.alternate!==null&&(d=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==d&&(h.refCount++,d!=null&&Cm(d)));break;case 12:if(N&2048){al(d,h,y,b),d=h.stateNode;try{var P=h.memoizedProps,J=P.id,le=P.onPostCommit;typeof le=="function"&&le(J,h.alternate===null?"mount":"update",d.passiveEffectDuration,-0)}catch(we){li(h,h.return,we)}}else al(d,h,y,b);break;case 13:al(d,h,y,b);break;case 23:break;case 22:P=h.stateNode,J=h.alternate,h.memoizedState!==null?P._visibility&2?al(d,h,y,b):Zm(d,h):P._visibility&2?al(d,h,y,b):(P._visibility|=2,bh(d,h,y,b,(h.subtreeFlags&10256)!==0)),N&2048&&VE(J,h);break;case 24:al(d,h,y,b),N&2048&&Oa(h.alternate,h);break;default:al(d,h,y,b)}}function bh(d,h,y,b,N){for(N=N&&(h.subtreeFlags&10256)!==0,h=h.child;h!==null;){var P=d,J=h,le=y,we=b,Fe=J.flags;switch(J.tag){case 0:case 11:case 15:bh(P,J,le,we,N),Yp(8,J);break;case 23:break;case 22:var it=J.stateNode;J.memoizedState!==null?it._visibility&2?bh(P,J,le,we,N):Zm(P,J):(it._visibility|=2,bh(P,J,le,we,N)),N&&Fe&2048&&VE(J.alternate,J);break;case 24:bh(P,J,le,we,N),N&&Fe&2048&&Oa(J.alternate,J);break;default:bh(P,J,le,we,N)}h=h.sibling}}function Zm(d,h){if(h.subtreeFlags&10256)for(h=h.child;h!==null;){var y=d,b=h,N=b.flags;switch(b.tag){case 22:Zm(y,b),N&2048&&VE(b.alternate,b);break;case 24:Zm(y,b),N&2048&&Oa(b.alternate,b);break;default:Zm(y,b)}h=h.sibling}}var Kp=8192;function wh(d){if(d.subtreeFlags&Kp)for(d=d.child;d!==null;)K0(d),d=d.sibling}function K0(d){switch(d.tag){case 26:wh(d),d.flags&Kp&&d.memoizedState!==null&&xx(Sc,d.memoizedState,d.memoizedProps);break;case 5:wh(d);break;case 3:case 4:var h=Sc;Sc=sy(d.stateNode.containerInfo),wh(d),Sc=h;break;case 22:d.memoizedState===null&&(h=d.alternate,h!==null&&h.memoizedState!==null?(h=Kp,Kp=16777216,wh(d),Kp=h):wh(d));break;default:wh(d)}}function ET(d){var h=d.alternate;if(h!==null&&(d=h.child,d!==null)){h.child=null;do h=d.sibling,d.sibling=null,d=h;while(d!==null)}}function eg(d){var h=d.deletions;if((d.flags&16)!==0){if(h!==null)for(var y=0;y<h.length;y++){var b=h[y];Ks=b,BE(b,d)}ET(d)}if(d.subtreeFlags&10256)for(d=d.child;d!==null;)X0(d),d=d.sibling}function X0(d){switch(d.tag){case 0:case 11:case 15:eg(d),d.flags&2048&&qd(9,d,d.return);break;case 3:eg(d);break;case 12:eg(d);break;case 22:var h=d.stateNode;d.memoizedState!==null&&h._visibility&2&&(d.return===null||d.return.tag!==13)?(h._visibility&=-3,FE(d)):eg(d);break;default:eg(d)}}function FE(d){var h=d.deletions;if((d.flags&16)!==0){if(h!==null)for(var y=0;y<h.length;y++){var b=h[y];Ks=b,BE(b,d)}ET(d)}for(d=d.child;d!==null;){switch(h=d,h.tag){case 0:case 11:case 15:qd(8,h,h.return),FE(h);break;case 22:y=h.stateNode,y._visibility&2&&(y._visibility&=-3,FE(h));break;default:FE(h)}d=d.sibling}}function BE(d,h){for(;Ks!==null;){var y=Ks;switch(y.tag){case 0:case 11:case 15:qd(8,y,h);break;case 23:case 22:if(y.memoizedState!==null&&y.memoizedState.cachePool!==null){var b=y.memoizedState.cachePool.pool;b!=null&&b.refCount++}break;case 24:Cm(y.memoizedState.cache)}if(b=y.child,b!==null)b.return=y,Ks=b;else e:for(y=d;Ks!==null;){b=Ks;var N=b.sibling,P=b.return;if(qp(b),b===y){Ks=null;break e}if(N!==null){N.return=P,Ks=N;break e}Ks=P}}}var yT={getCacheForType:function(d){var h=Ns(us),y=h.data.get(d);return y===void 0&&(y=d(),h.data.set(d,y)),y}},ax=typeof WeakMap=="function"?WeakMap:Map,Ur=0,vi=null,or=null,br=0,Vr=0,ra=null,Jl=!1,Kd=!1,tg=!1,ol=0,Vi=0,Tc=0,Xd=0,vT=0,Yo=0,Rh=0,Xp=null,xs=null,ng=!1,rg=0,Qp=1/0,ig=null,Zl=null,ia=0,Qd=null,bc=null,$p=0,HE=0,sg=null,Q0=null,ag=0,ST=null;function Ao(){if((Ur&2)!==0&&br!==0)return br&-br;if(be.T!==null){var d=Dp;return d!==0?d:nf()}return Dn()}function GE(){Yo===0&&(Yo=(br&536870912)===0||jr?Wa():536870912);var d=Os.current;return d!==null&&(d.flags|=32),Yo}function Za(d,h,y){(d===vi&&(Vr===2||Vr===9)||d.cancelPendingCommit!==null)&&(Ah(d,0),cl(d,br,Yo,!1)),yn(d,y),((Ur&2)===0||d!==vi)&&(d===vi&&((Ur&2)===0&&(Xd|=y),Vi===4&&cl(d,br,Yo,!1)),qo(d))}function TT(d,h,y){if((Ur&6)!==0)throw Error(s(327));var b=!y&&(h&124)===0&&(h&d.expiredLanes)===0||ua(d,h),N=b?cx(d,h):wT(d,h,!0),P=b;do{if(N===0){Kd&&!b&&cl(d,h,0,!1);break}else{if(y=d.current.alternate,P&&!WE(y)){N=wT(d,h,!1),P=!1;continue}if(N===2){if(P=h,d.errorRecoveryDisabledLanes&P)var J=0;else J=d.pendingLanes&-536870913,J=J!==0?J:J&536870912?536870912:0;if(J!==0){h=J;e:{var le=d;N=Xp;var we=le.current.memoizedState.isDehydrated;if(we&&(Ah(le,J).flags|=256),J=wT(le,J,!1),J!==2){if(tg&&!we){le.errorRecoveryDisabledLanes|=P,Xd|=P,N=4;break e}P=xs,xs=N,P!==null&&(xs===null?xs=P:xs.push.apply(xs,P))}N=J}if(P=!1,N!==2)continue}}if(N===1){Ah(d,0),cl(d,h,0,!0);break}e:{switch(b=d,P=N,P){case 0:case 1:throw Error(s(345));case 4:if((h&4194048)!==h)break;case 6:cl(b,h,Yo,!Jl);break e;case 2:xs=null;break;case 3:case 5:break;default:throw Error(s(329))}if((h&62914560)===h&&(N=rg+300-mt(),10<N)){if(cl(b,h,Yo,!Jl),ws(b,0,!0)!==0)break e;b.timeoutHandle=sC(bT.bind(null,b,y,xs,ig,ng,h,Yo,Xd,Rh,Jl,P,2,-0,0),N);break e}bT(b,y,xs,ig,ng,h,Yo,Xd,Rh,Jl,P,0,-0,0)}}break}while(!0);qo(d)}function bT(d,h,y,b,N,P,J,le,we,Fe,it,gt,Ke,Xe){if(d.timeoutHandle=-1,gt=h.subtreeFlags,(gt&8192||(gt&16785408)===16785408)&&(pg={stylesheets:null,count:0,unsuspend:Dx},K0(h),gt=_C(),gt!==null)){d.cancelPendingCommit=gt(J0.bind(null,d,h,P,y,b,N,J,le,we,it,1,Ke,Xe)),cl(d,P,J,!Fe);return}J0(d,h,P,y,b,N,J,le,we)}function WE(d){for(var h=d;;){var y=h.tag;if((y===0||y===11||y===15)&&h.flags&16384&&(y=h.updateQueue,y!==null&&(y=y.stores,y!==null)))for(var b=0;b<y.length;b++){var N=y[b],P=N.getSnapshot;N=N.value;try{if(!So(P(),N))return!1}catch{return!1}}if(y=h.child,h.subtreeFlags&16384&&y!==null)y.return=h,h=y;else{if(h===d)break;for(;h.sibling===null;){if(h.return===null||h.return===d)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function cl(d,h,y,b){h&=~vT,h&=~Xd,d.suspendedLanes|=h,d.pingedLanes&=~h,b&&(d.warmLanes|=h),b=d.expirationTimes;for(var N=h;0<N;){var P=31-mn(N),J=1<<P;b[P]=-1,N&=~J}y!==0&&Qe(d,y,h)}function Ch(){return(Ur&6)===0?(og(0),!1):!0}function Jp(){if(or!==null){if(Vr===0)var d=or.return;else d=or,Kl=dh=null,HS(d),yh=null,Ec=0,d=or;for(;d!==null;)V0(d.alternate,d),d=d.return;or=null}}function Ah(d,h){var y=d.timeoutHandle;y!==-1&&(d.timeoutHandle=-1,_x(y)),y=d.cancelPendingCommit,y!==null&&(d.cancelPendingCommit=null,y()),Jp(),vi=d,or=y=Yl(d.current,null),br=h,Vr=0,ra=null,Jl=!1,Kd=ua(d,h),tg=!1,Rh=Yo=vT=Xd=Tc=Vi=0,xs=Xp=null,ng=!1,(h&8)!==0&&(h|=h&32);var b=d.entangledLanes;if(b!==0)for(d=d.entanglements,b&=h;0<b;){var N=31-mn(b),P=1<<N;h|=d[N],b&=~P}return ol=h,ih(),y}function Ih(d,h){Qn=null,be.H=Ro,h===hh||h===hE?(h=ZR(),Vr=3):h===QR?(h=ZR(),Vr=4):Vr=h===D0?8:h!==null&&typeof h=="object"&&typeof h.then=="function"?6:1,ra=h,or===null&&(Vi=1,NE(d,To(h,d.current)))}function $d(){var d=be.H;return be.H=Ro,d===null?Ro:d}function $0(){var d=be.A;return be.A=yT,d}function Nh(){Vi=4,Jl||(br&4194048)!==br&&Os.current!==null||(Kd=!0),(Tc&134217727)===0&&(Xd&134217727)===0||vi===null||cl(vi,br,Yo,!1)}function wT(d,h,y){var b=Ur;Ur|=2;var N=$d(),P=$0();(vi!==d||br!==h)&&(ig=null,Ah(d,h)),h=!1;var J=Vi;e:do try{if(Vr!==0&&or!==null){var le=or,we=ra;switch(Vr){case 8:Jp(),J=6;break e;case 3:case 2:case 9:case 6:Os.current===null&&(h=!0);var Fe=Vr;if(Vr=0,ra=null,Oh(d,le,we,Fe),y&&Kd){J=0;break e}break;default:Fe=Vr,Vr=0,ra=null,Oh(d,le,we,Fe)}}ox(),J=Vi;break}catch(it){Ih(d,it)}while(!0);return h&&d.shellSuspendCounter++,Kl=dh=null,Ur=b,be.H=N,be.A=P,or===null&&(vi=null,br=0,ih()),J}function ox(){for(;or!==null;)RT(or)}function cx(d,h){var y=Ur;Ur|=2;var b=$d(),N=$0();vi!==d||br!==h?(ig=null,Qp=mt()+500,Ah(d,h)):Kd=ua(d,h);e:do try{if(Vr!==0&&or!==null){h=or;var P=ra;t:switch(Vr){case 1:Vr=0,ra=null,Oh(d,h,P,1);break;case 2:case 9:if($R(P)){Vr=0,ra=null,zE(h);break}h=function(){Vr!==2&&Vr!==9||vi!==d||(Vr=7),qo(d)},P.then(h,h);break e;case 3:Vr=7;break e;case 4:Vr=5;break e;case 7:$R(P)?(Vr=0,ra=null,zE(h)):(Vr=0,ra=null,Oh(d,h,P,7));break;case 5:var J=null;switch(or.tag){case 26:J=or.memoizedState;case 5:case 27:var le=or;if(!J||gC(J)){Vr=0,ra=null;var we=le.sibling;if(we!==null)or=we;else{var Fe=le.return;Fe!==null?(or=Fe,YE(Fe)):or=null}break t}}Vr=0,ra=null,Oh(d,h,P,5);break;case 6:Vr=0,ra=null,Oh(d,h,P,6);break;case 8:Jp(),Vi=6;break e;default:throw Error(s(462))}}lx();break}catch(it){Ih(d,it)}while(!0);return Kl=dh=null,be.H=b,be.A=N,Ur=y,or!==null?0:(vi=null,br=0,ih(),Vi)}function lx(){for(;or!==null&&!en();)RT(or)}function RT(d){var h=qm(d.alternate,d,ol);d.memoizedProps=d.pendingProps,h===null?YE(d):or=h}function zE(d){var h=d,y=h.alternate;switch(h.tag){case 15:case 0:h=lT(y,h,h.pendingProps,h.type,void 0,br);break;case 11:h=lT(y,h,h.pendingProps,h.type.render,h.ref,br);break;case 5:HS(h);default:V0(y,h),h=or=iE(h,ol),h=qm(y,h,ol)}d.memoizedProps=d.pendingProps,h===null?YE(d):or=h}function Oh(d,h,y,b){Kl=dh=null,HS(h),yh=null,Ec=0;var N=h.return;try{if(tx(d,N,h,y,br)){Vi=1,NE(d,To(y,d.current)),or=null;return}}catch(P){if(N!==null)throw or=N,P;Vi=1,NE(d,To(y,d.current)),or=null;return}h.flags&32768?(jr||b===1?d=!0:Kd||(br&536870912)!==0?d=!1:(Jl=d=!0,(b===2||b===9||b===3||b===6)&&(b=Os.current,b!==null&&b.tag===13&&(b.flags|=16384))),CT(h,d)):YE(h)}function YE(d){var h=d;do{if((h.flags&32768)!==0){CT(h,Jl);return}d=h.return;var y=rx(h.alternate,h,ol);if(y!==null){or=y;return}if(h=h.sibling,h!==null){or=h;return}or=h=d}while(h!==null);Vi===0&&(Vi=5)}function CT(d,h){do{var y=ix(d.alternate,d);if(y!==null){y.flags&=32767,or=y;return}if(y=d.return,y!==null&&(y.flags|=32768,y.subtreeFlags=0,y.deletions=null),!h&&(d=d.sibling,d!==null)){or=d;return}or=d=y}while(d!==null);Vi=6,or=null}function J0(d,h,y,b,N,P,J,le,we){d.cancelPendingCommit=null;do qE();while(ia!==0);if((Ur&6)!==0)throw Error(s(327));if(h!==null){if(h===d.current)throw Error(s(177));if(P=h.lanes|h.childLanes,P|=bS,nr(d,y,P,J,le,we),d===vi&&(or=vi=null,br=0),bc=h,Qd=d,$p=y,HE=P,sg=N,Q0=b,(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?(d.callbackNode=null,d.callbackPriority=0,hx(Ci,function(){return KE(),null})):(d.callbackNode=null,d.callbackPriority=0),b=(h.flags&13878)!==0,(h.subtreeFlags&13878)!==0||b){b=be.T,be.T=null,N=Ie.p,Ie.p=2,J=Ur,Ur|=4;try{$m(d,h,y)}finally{Ur=J,Ie.p=N,be.T=b}}ia=1,Zp(),wc(),AT()}}function Zp(){if(ia===1){ia=0;var d=Qd,h=bc,y=(h.flags&13878)!==0;if((h.subtreeFlags&13878)!==0||y){y=be.T,be.T=null;var b=Ie.p;Ie.p=2;var N=Ur;Ur|=4;try{Y0(h,d);var P=cf,J=Wl(d.containerInfo),le=P.focusedElem,we=P.selectionRange;if(J!==le&&le&&le.ownerDocument&&jR(le.ownerDocument.documentElement,le)){if(we!==null&&gS(le)){var Fe=we.start,it=we.end;if(it===void 0&&(it=Fe),"selectionStart"in le)le.selectionStart=Fe,le.selectionEnd=Math.min(it,le.value.length);else{var gt=le.ownerDocument||document,Ke=gt&&gt.defaultView||window;if(Ke.getSelection){var Xe=Ke.getSelection(),Pn=le.textContent.length,gn=Math.min(we.start,Pn),ti=we.end===void 0?gn:Math.min(we.end,Pn);!Xe.extend&&gn>ti&&(J=ti,ti=gn,gn=J);var Le=MR(le,gn),Oe=MR(le,ti);if(Le&&Oe&&(Xe.rangeCount!==1||Xe.anchorNode!==Le.node||Xe.anchorOffset!==Le.offset||Xe.focusNode!==Oe.node||Xe.focusOffset!==Oe.offset)){var He=gt.createRange();He.setStart(Le.node,Le.offset),Xe.removeAllRanges(),gn>ti?(Xe.addRange(He),Xe.extend(Oe.node,Oe.offset)):(He.setEnd(Oe.node,Oe.offset),Xe.addRange(He))}}}}for(gt=[],Xe=le;Xe=Xe.parentNode;)Xe.nodeType===1&&gt.push({element:Xe,left:Xe.scrollLeft,top:Xe.scrollTop});for(typeof le.focus=="function"&&le.focus(),le=0;le<gt.length;le++){var ht=gt[le];ht.element.scrollLeft=ht.left,ht.element.scrollTop=ht.top}}uy=!!GT,cf=GT=null}finally{Ur=N,Ie.p=b,be.T=y}}d.current=h,ia=2}}function wc(){if(ia===2){ia=0;var d=Qd,h=bc,y=(h.flags&8772)!==0;if((h.subtreeFlags&8772)!==0||y){y=be.T,be.T=null;var b=Ie.p;Ie.p=2;var N=Ur;Ur|=4;try{gT(d,h.alternate,h)}finally{Ur=N,Ie.p=b,be.T=y}}ia=3}}function AT(){if(ia===4||ia===3){ia=0,Dt();var d=Qd,h=bc,y=$p,b=Q0;(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?ia=5:(ia=0,bc=Qd=null,Z0(d,d.pendingLanes));var N=d.pendingLanes;if(N===0&&(Zl=null),rn(y),h=h.stateNode,sn&&typeof sn.onCommitFiberRoot=="function")try{sn.onCommitFiberRoot(Ht,h,void 0,(h.current.flags&128)===128)}catch{}if(b!==null){h=be.T,N=Ie.p,Ie.p=2,be.T=null;try{for(var P=d.onRecoverableError,J=0;J<b.length;J++){var le=b[J];P(le.value,{componentStack:le.stack})}}finally{be.T=h,Ie.p=N}}($p&3)!==0&&qE(),qo(d),N=d.pendingLanes,(y&4194090)!==0&&(N&42)!==0?d===ST?ag++:(ag=0,ST=d):ag=0,og(0)}}function Z0(d,h){(d.pooledCacheLanes&=h)===0&&(h=d.pooledCache,h!=null&&(d.pooledCache=null,Cm(h)))}function qE(d){return Zp(),wc(),AT(),KE()}function KE(){if(ia!==5)return!1;var d=Qd,h=HE;HE=0;var y=rn($p),b=be.T,N=Ie.p;try{Ie.p=32>y?32:y,be.T=null,y=sg,sg=null;var P=Qd,J=$p;if(ia=0,bc=Qd=null,$p=0,(Ur&6)!==0)throw Error(s(331));var le=Ur;if(Ur|=4,X0(P.current),q0(P,P.current,J,y),Ur=le,og(0,!1),sn&&typeof sn.onPostCommitFiberRoot=="function")try{sn.onPostCommitFiberRoot(Ht,P)}catch{}return!0}finally{Ie.p=N,be.T=b,Z0(d,h)}}function IT(d,h,y){h=To(y,h),h=yc(d.stateNode,h,2),d=Ql(d,h,2),d!==null&&(yn(d,2),qo(d))}function li(d,h,y){if(d.tag===3)IT(d,d,y);else for(;h!==null;){if(h.tag===3){IT(h,d,y);break}else if(h.tag===1){var b=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(Zl===null||!Zl.has(b))){d=To(y,d),y=N0(2),b=Ql(h,y,2),b!==null&&(O0(y,b,h,d),yn(b,2),qo(b));break}}h=h.return}}function ef(d,h,y){var b=d.pingCache;if(b===null){b=d.pingCache=new ax;var N=new Set;b.set(h,N)}else N=b.get(h),N===void 0&&(N=new Set,b.set(h,N));N.has(y)||(tg=!0,N.add(y),d=Jd.bind(null,d,h,y),h.then(d,d))}function Jd(d,h,y){var b=d.pingCache;b!==null&&b.delete(h),d.pingedLanes|=d.suspendedLanes&y,d.warmLanes&=~y,vi===d&&(br&y)===y&&(Vi===4||Vi===3&&(br&62914560)===br&&300>mt()-rg?(Ur&2)===0&&Ah(d,0):vT|=y,Rh===br&&(Rh=0)),qo(d)}function tf(d,h){h===0&&(h=je()),d=Ap(d,h),d!==null&&(yn(d,h),qo(d))}function dx(d){var h=d.memoizedState,y=0;h!==null&&(y=h.retryLane),tf(d,y)}function ux(d,h){var y=0;switch(d.tag){case 13:var b=d.stateNode,N=d.memoizedState;N!==null&&(y=N.retryLane);break;case 19:b=d.stateNode;break;case 22:b=d.stateNode._retryCache;break;default:throw Error(s(314))}b!==null&&b.delete(h),tf(d,y)}function hx(d,h){return Xn(d,h)}var XE=null,Zd=null,NT=!1,QE=!1,OT=!1,eu=0;function qo(d){d!==Zd&&d.next===null&&(Zd===null?XE=Zd=d:Zd=Zd.next=d),QE=!0,NT||(NT=!0,tC())}function og(d,h){if(!OT&&QE){OT=!0;do for(var y=!1,b=XE;b!==null;){if(d!==0){var N=b.pendingLanes;if(N===0)var P=0;else{var J=b.suspendedLanes,le=b.pingedLanes;P=(1<<31-mn(42|d)+1)-1,P&=N&~(J&~le),P=P&201326741?P&201326741|1:P?P|2:0}P!==0&&(y=!0,xT(b,P))}else P=br,P=ws(b,b===vi?P:0,b.cancelPendingCommit!==null||b.timeoutHandle!==-1),(P&3)===0||ua(b,P)||(y=!0,xT(b,P));b=b.next}while(y);OT=!1}}function px(){eC()}function eC(){QE=NT=!1;var d=0;eu!==0&&(gx()&&(d=eu),eu=0);for(var h=mt(),y=null,b=XE;b!==null;){var N=b.next,P=DT(b,h);P===0?(b.next=null,y===null?XE=N:y.next=N,N===null&&(Zd=y)):(y=b,(d!==0||(P&3)!==0)&&(QE=!0)),b=N}og(d)}function DT(d,h){for(var y=d.suspendedLanes,b=d.pingedLanes,N=d.expirationTimes,P=d.pendingLanes&-62914561;0<P;){var J=31-mn(P),le=1<<J,we=N[J];we===-1?((le&y)===0||(le&b)!==0)&&(N[J]=Fs(le,h)):we<=h&&(d.expiredLanes|=le),P&=~le}if(h=vi,y=br,y=ws(d,d===h?y:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),b=d.callbackNode,y===0||d===h&&(Vr===2||Vr===9)||d.cancelPendingCommit!==null)return b!==null&&b!==null&&Ot(b),d.callbackNode=null,d.callbackPriority=0;if((y&3)===0||ua(d,y)){if(h=y&-y,h===d.callbackPriority)return h;switch(b!==null&&Ot(b),rn(y)){case 2:case 8:y=Mn;break;case 32:y=Ci;break;case 268435456:y=Rr;break;default:y=Ci}return b=$E.bind(null,d),y=Xn(y,b),d.callbackPriority=h,d.callbackNode=y,h}return b!==null&&b!==null&&Ot(b),d.callbackPriority=2,d.callbackNode=null,2}function $E(d,h){if(ia!==0&&ia!==5)return d.callbackNode=null,d.callbackPriority=0,null;var y=d.callbackNode;if(qE()&&d.callbackNode!==y)return null;var b=br;return b=ws(d,d===vi?b:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),b===0?null:(TT(d,b,h),DT(d,mt()),d.callbackNode!=null&&d.callbackNode===y?$E.bind(null,d):null)}function xT(d,h){if(qE())return null;TT(d,h,!0)}function tC(){Ex(function(){(Ur&6)!==0?Xn(Gt,px):eC()})}function nf(){return eu===0&&(eu=Wa()),eu}function PT(d){return d==null||typeof d=="symbol"||typeof d=="boolean"?null:typeof d=="function"?d:Sp(""+d)}function nC(d,h){var y=h.ownerDocument.createElement("input");return y.name=h.name,y.value=h.value,d.id&&y.setAttribute("form",d.id),h.parentNode.insertBefore(y,h),d=new FormData(d),y.parentNode.removeChild(y),d}function kT(d,h,y,b,N){if(h==="submit"&&y&&y.stateNode===N){var P=PT((N[yr]||null).action),J=b.submitter;J&&(h=(h=J[yr]||null)?PT(h.formAction):J.getAttribute("formAction"),h!==null&&(P=h,J=null));var le=new yo("action","action",null,b,N);d.push({event:le,listeners:[{instance:null,listener:function(){if(b.defaultPrevented){if(eu!==0){var we=J?nC(N,J):new FormData(N);Fp(y,{pending:!0,data:we,method:N.method,action:P},null,we)}}else typeof P=="function"&&(le.preventDefault(),we=J?nC(N,J):new FormData(N),Fp(y,{pending:!0,data:we,method:N.method,action:P},P,we))},currentTarget:N}]})}}for(var LT=0;LT<SS.length;LT++){var MT=SS[LT],cg=MT.toLowerCase(),jT=MT[0].toUpperCase()+MT.slice(1);mc(cg,"on"+jT)}mc(FR,"onAnimationEnd"),mc(BR,"onAnimationIteration"),mc(rE,"onAnimationStart"),mc("dblclick","onDoubleClick"),mc("focusin","onFocus"),mc("focusout","onBlur"),mc(vS,"onTransitionRun"),mc(zD,"onTransitionStart"),mc(et,"onTransitionCancel"),mc(HR,"onTransitionEnd"),Ll("onMouseEnter",["mouseout","mouseover"]),Ll("onMouseLeave",["mouseout","mouseover"]),Ll("onPointerEnter",["pointerout","pointerover"]),Ll("onPointerLeave",["pointerout","pointerover"]),ha("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ha("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ha("onBeforeInput",["compositionend","keypress","textInput","paste"]),ha("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ha("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ha("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var rf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),UT=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(rf));function JE(d,h){h=(h&4)!==0;for(var y=0;y<d.length;y++){var b=d[y],N=b.event;b=b.listeners;e:{var P=void 0;if(h)for(var J=b.length-1;0<=J;J--){var le=b[J],we=le.instance,Fe=le.currentTarget;if(le=le.listener,we!==P&&N.isPropagationStopped())break e;P=le,N.currentTarget=Fe;try{P(N)}catch(it){IE(it)}N.currentTarget=null,P=we}else for(J=0;J<b.length;J++){if(le=b[J],we=le.instance,Fe=le.currentTarget,le=le.listener,we!==P&&N.isPropagationStopped())break e;P=le,N.currentTarget=Fe;try{P(N)}catch(it){IE(it)}N.currentTarget=null,P=we}}}}function rr(d,h){var y=h[Bs];y===void 0&&(y=h[Bs]=new Set);var b=d+"__bubble";y.has(b)||(FT(h,d,2,!1),y.add(b))}function VT(d,h,y){var b=0;h&&(b|=4),FT(y,d,b,h)}var ZE="_reactListening"+Math.random().toString(36).slice(2);function ey(d){if(!d[ZE]){d[ZE]=!0,Wu.forEach(function(y){y!=="selectionchange"&&(UT.has(y)||VT(y,!1,d),VT(y,!0,d))});var h=d.nodeType===9?d:d.ownerDocument;h===null||h[ZE]||(h[ZE]=!0,VT("selectionchange",!1,h))}}function FT(d,h,y,b){switch(TC(h)){case 2:var N=kx;break;case 8:N=Lx;break;default:N=hy}y=N.bind(null,h,y,d),N=void 0,!Fo||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(N=!0),b?N!==void 0?d.addEventListener(h,y,{capture:!0,passive:N}):d.addEventListener(h,y,!0):N!==void 0?d.addEventListener(h,y,{passive:N}):d.addEventListener(h,y,!1)}function ty(d,h,y,b,N){var P=b;if((h&1)===0&&(h&2)===0&&b!==null)e:for(;;){if(b===null)return;var J=b.tag;if(J===3||J===4){var le=b.stateNode.containerInfo;if(le===N)break;if(J===4)for(J=b.return;J!==null;){var we=J.tag;if((we===3||we===4)&&J.stateNode.containerInfo===N)return;J=J.return}for(;le!==null;){if(J=Uo(le),J===null)return;if(we=J.tag,we===5||we===6||we===26||we===27){b=P=J;continue e}le=le.parentNode}}b=b.return}Y_(function(){var Fe=P,it=Vo(y),gt=[];e:{var Ke=GR.get(d);if(Ke!==void 0){var Xe=yo,Pn=d;switch(d){case"keypress":if(qc(y)===0)break e;case"keydown":case"keyup":Xe=wp;break;case"focusin":Pn="focus",Xe=eh;break;case"focusout":Pn="blur",Xe=eh;break;case"beforeblur":case"afterblur":Xe=eh;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Xe=Bo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Xe=uS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Xe=J_;break;case FR:case BR:case rE:Xe=Dd;break;case HR:Xe=Em;break;case"scroll":case"scrollend":Xe=fm;break;case"wheel":Xe=xn;break;case"copy":case"cut":case"paste":Xe=xd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Xe=_m;break;case"toggle":case"beforetoggle":Xe=eE}var gn=(h&4)!==0,ti=!gn&&(d==="scroll"||d==="scrollend"),Le=gn?Ke!==null?Ke+"Capture":null:Ke;gn=[];for(var Oe=Fe,He;Oe!==null;){var ht=Oe;if(He=ht.stateNode,ht=ht.tag,ht!==5&&ht!==26&&ht!==27||He===null||Le===null||(ht=Nd(Oe,Le),ht!=null&&gn.push(sf(Oe,ht,He))),ti)break;Oe=Oe.return}0<gn.length&&(Ke=new Xe(Ke,Pn,null,y,it),gt.push({event:Ke,listeners:gn}))}}if((h&7)===0){e:{if(Ke=d==="mouseover"||d==="pointerover",Xe=d==="mouseout"||d==="pointerout",Ke&&y!==jl&&(Pn=y.relatedTarget||y.fromElement)&&(Uo(Pn)||Pn[oi]))break e;if((Xe||Ke)&&(Ke=it.window===it?it:(Ke=it.ownerDocument)?Ke.defaultView||Ke.parentWindow:window,Xe?(Pn=y.relatedTarget||y.toElement,Xe=Fe,Pn=Pn?Uo(Pn):null,Pn!==null&&(ti=p(Pn),gn=Pn.tag,Pn!==ti||gn!==5&&gn!==27&&gn!==6)&&(Pn=null)):(Xe=null,Pn=Fe),Xe!==Pn)){if(gn=Bo,ht="onMouseLeave",Le="onMouseEnter",Oe="mouse",(d==="pointerout"||d==="pointerover")&&(gn=_m,ht="onPointerLeave",Le="onPointerEnter",Oe="pointer"),ti=Xe==null?Ke:go(Xe),He=Pn==null?Ke:go(Pn),Ke=new gn(ht,Oe+"leave",Xe,y,it),Ke.target=ti,Ke.relatedTarget=He,ht=null,Uo(it)===Fe&&(gn=new gn(Le,Oe+"enter",Pn,y,it),gn.target=He,gn.relatedTarget=ti,ht=gn),ti=ht,Xe&&Pn)t:{for(gn=Xe,Le=Pn,Oe=0,He=gn;He;He=af(He))Oe++;for(He=0,ht=Le;ht;ht=af(ht))He++;for(;0<Oe-He;)gn=af(gn),Oe--;for(;0<He-Oe;)Le=af(Le),He--;for(;Oe--;){if(gn===Le||Le!==null&&gn===Le.alternate)break t;gn=af(gn),Le=af(Le)}gn=null}else gn=null;Xe!==null&&BT(gt,Ke,Xe,gn,!1),Pn!==null&&ti!==null&&BT(gt,ti,Pn,gn,!0)}}e:{if(Ke=Fe?go(Fe):window,Xe=Ke.nodeName&&Ke.nodeName.toLowerCase(),Xe==="select"||Xe==="input"&&Ke.type==="file")var Ft=DR;else if(As(Ke))if(vo)Ft=mS;else{Ft=HD;var cr=BD}else Xe=Ke.nodeName,!Xe||Xe.toLowerCase()!=="input"||Ke.type!=="checkbox"&&Ke.type!=="radio"?Fe&&Ju(Fe.elementType)&&(Ft=DR):Ft=kR;if(Ft&&(Ft=Ft(d,Fe))){Gl(gt,Ft,y,it);break e}cr&&cr(d,Ke,Fe),d==="focusout"&&Fe&&Ke.type==="number"&&Fe.memoizedProps.value!=null&&Ad(Ke,"number",Ke.value)}switch(cr=Fe?go(Fe):window,d){case"focusin":(As(cr)||cr.contentEditable==="true")&&(Is=cr,_S=Fe,vm=null);break;case"focusout":vm=_S=Is=null;break;case"mousedown":ES=!0;break;case"contextmenu":case"mouseup":case"dragend":ES=!1,UR(gt,y,it);break;case"selectionchange":if(WD)break;case"keydown":case"keyup":UR(gt,y,it)}var on;if($c)e:{switch(d){case"compositionstart":var Rn="onCompositionStart";break e;case"compositionend":Rn="onCompositionEnd";break e;case"compositionupdate":Rn="onCompositionUpdate";break e}Rn=void 0}else vr?Ze(d,y)&&(Rn="onCompositionEnd"):d==="keydown"&&y.keyCode===229&&(Rn="onCompositionStart");Rn&&(X&&y.locale!=="ko"&&(vr||Rn!=="onCompositionStart"?Rn==="onCompositionEnd"&&vr&&(on=hm()):(qa=it,Od="value"in qa?qa.value:qa.textContent,vr=!0)),cr=lg(Fe,Rn),0<cr.length&&(Rn=new th(Rn,d,null,y,it),gt.push({event:Rn,listeners:cr}),on?Rn.data=on:(on=It(y),on!==null&&(Rn.data=on)))),(on=B?Cs(d,y):Yn(d,y))&&(Rn=lg(Fe,"onBeforeInput"),0<Rn.length&&(cr=new th("onBeforeInput","beforeinput",null,y,it),gt.push({event:cr,listeners:Rn}),cr.data=on)),kT(gt,d,Fe,y,it)}JE(gt,h)})}function sf(d,h,y){return{instance:d,listener:h,currentTarget:y}}function lg(d,h){for(var y=h+"Capture",b=[];d!==null;){var N=d,P=N.stateNode;if(N=N.tag,N!==5&&N!==26&&N!==27||P===null||(N=Nd(d,y),N!=null&&b.unshift(sf(d,N,P)),N=Nd(d,h),N!=null&&b.push(sf(d,N,P))),d.tag===3)return b;d=d.return}return[]}function af(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5&&d.tag!==27);return d||null}function BT(d,h,y,b,N){for(var P=h._reactName,J=[];y!==null&&y!==b;){var le=y,we=le.alternate,Fe=le.stateNode;if(le=le.tag,we!==null&&we===b)break;le!==5&&le!==26&&le!==27||Fe===null||(we=Fe,N?(Fe=Nd(y,P),Fe!=null&&J.unshift(sf(y,Fe,we))):N||(Fe=Nd(y,P),Fe!=null&&J.push(sf(y,Fe,we)))),y=y.return}J.length!==0&&d.push({event:h,listeners:J})}var fx=/\r\n?/g,of=/\u0000|\uFFFD/g;function Dh(d){return(typeof d=="string"?d:""+d).replace(fx,`
`).replace(of,"")}function ny(d,h){return h=Dh(h),Dh(d)===h}function dg(){}function Xr(d,h,y,b,N,P){switch(y){case"children":typeof b=="string"?h==="body"||h==="textarea"&&b===""||Ya(d,b):(typeof b=="number"||typeof b=="bigint")&&h!=="body"&&Ya(d,""+b);break;case"className":Wc(d,"class",b);break;case"tabIndex":Wc(d,"tabindex",b);break;case"dir":case"role":case"viewBox":case"width":case"height":Wc(d,y,b);break;case"style":dm(d,b,P);break;case"data":if(h!=="object"){Wc(d,"data",b);break}case"src":case"href":if(b===""&&(h!=="a"||y!=="href")){d.removeAttribute(y);break}if(b==null||typeof b=="function"||typeof b=="symbol"||typeof b=="boolean"){d.removeAttribute(y);break}b=Sp(""+b),d.setAttribute(y,b);break;case"action":case"formAction":if(typeof b=="function"){d.setAttribute(y,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof P=="function"&&(y==="formAction"?(h!=="input"&&Xr(d,h,"name",N.name,N,null),Xr(d,h,"formEncType",N.formEncType,N,null),Xr(d,h,"formMethod",N.formMethod,N,null),Xr(d,h,"formTarget",N.formTarget,N,null)):(Xr(d,h,"encType",N.encType,N,null),Xr(d,h,"method",N.method,N,null),Xr(d,h,"target",N.target,N,null)));if(b==null||typeof b=="symbol"||typeof b=="boolean"){d.removeAttribute(y);break}b=Sp(""+b),d.setAttribute(y,b);break;case"onClick":b!=null&&(d.onclick=dg);break;case"onScroll":b!=null&&rr("scroll",d);break;case"onScrollEnd":b!=null&&rr("scrollend",d);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error(s(61));if(y=b.__html,y!=null){if(N.children!=null)throw Error(s(60));d.innerHTML=y}}break;case"multiple":d.multiple=b&&typeof b!="function"&&typeof b!="symbol";break;case"muted":d.muted=b&&typeof b!="function"&&typeof b!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(b==null||typeof b=="function"||typeof b=="boolean"||typeof b=="symbol"){d.removeAttribute("xlink:href");break}y=Sp(""+b),d.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",y);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":b!=null&&typeof b!="function"&&typeof b!="symbol"?d.setAttribute(y,""+b):d.removeAttribute(y);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":b&&typeof b!="function"&&typeof b!="symbol"?d.setAttribute(y,""):d.removeAttribute(y);break;case"capture":case"download":b===!0?d.setAttribute(y,""):b!==!1&&b!=null&&typeof b!="function"&&typeof b!="symbol"?d.setAttribute(y,b):d.removeAttribute(y);break;case"cols":case"rows":case"size":case"span":b!=null&&typeof b!="function"&&typeof b!="symbol"&&!isNaN(b)&&1<=b?d.setAttribute(y,b):d.removeAttribute(y);break;case"rowSpan":case"start":b==null||typeof b=="function"||typeof b=="symbol"||isNaN(b)?d.removeAttribute(y):d.setAttribute(y,b);break;case"popover":rr("beforetoggle",d),rr("toggle",d),ci(d,"popover",b);break;case"xlinkActuate":ta(d,"http://www.w3.org/1999/xlink","xlink:actuate",b);break;case"xlinkArcrole":ta(d,"http://www.w3.org/1999/xlink","xlink:arcrole",b);break;case"xlinkRole":ta(d,"http://www.w3.org/1999/xlink","xlink:role",b);break;case"xlinkShow":ta(d,"http://www.w3.org/1999/xlink","xlink:show",b);break;case"xlinkTitle":ta(d,"http://www.w3.org/1999/xlink","xlink:title",b);break;case"xlinkType":ta(d,"http://www.w3.org/1999/xlink","xlink:type",b);break;case"xmlBase":ta(d,"http://www.w3.org/XML/1998/namespace","xml:base",b);break;case"xmlLang":ta(d,"http://www.w3.org/XML/1998/namespace","xml:lang",b);break;case"xmlSpace":ta(d,"http://www.w3.org/XML/1998/namespace","xml:space",b);break;case"is":ci(d,"is",b);break;case"innerText":case"textContent":break;default:(!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(y=dS.get(y)||y,ci(d,y,b))}}function HT(d,h,y,b,N,P){switch(y){case"style":dm(d,b,P);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error(s(61));if(y=b.__html,y!=null){if(N.children!=null)throw Error(s(60));d.innerHTML=y}}break;case"children":typeof b=="string"?Ya(d,b):(typeof b=="number"||typeof b=="bigint")&&Ya(d,""+b);break;case"onScroll":b!=null&&rr("scroll",d);break;case"onScrollEnd":b!=null&&rr("scrollend",d);break;case"onClick":b!=null&&(d.onclick=dg);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!zu.hasOwnProperty(y))e:{if(y[0]==="o"&&y[1]==="n"&&(N=y.endsWith("Capture"),h=y.slice(2,N?y.length-7:void 0),P=d[yr]||null,P=P!=null?P[y]:null,typeof P=="function"&&d.removeEventListener(h,P,N),typeof b=="function")){typeof P!="function"&&P!==null&&(y in d?d[y]=null:d.hasAttribute(y)&&d.removeAttribute(y)),d.addEventListener(h,b,N);break e}y in d?d[y]=b:b===!0?d.setAttribute(y,""):ci(d,y,b)}}}function Xs(d,h,y){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":rr("error",d),rr("load",d);var b=!1,N=!1,P;for(P in y)if(y.hasOwnProperty(P)){var J=y[P];if(J!=null)switch(P){case"src":b=!0;break;case"srcSet":N=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,h));default:Xr(d,h,P,J,y,null)}}N&&Xr(d,h,"srcSet",y.srcSet,y,null),b&&Xr(d,h,"src",y.src,y,null);return;case"input":rr("invalid",d);var le=P=J=N=null,we=null,Fe=null;for(b in y)if(y.hasOwnProperty(b)){var it=y[b];if(it!=null)switch(b){case"name":N=it;break;case"type":J=it;break;case"checked":we=it;break;case"defaultChecked":Fe=it;break;case"value":P=it;break;case"defaultValue":le=it;break;case"children":case"dangerouslySetInnerHTML":if(it!=null)throw Error(s(137,h));break;default:Xr(d,h,b,it,y,null)}}Qu(d,P,le,we,Fe,J,N,!1),yp(d);return;case"select":rr("invalid",d),b=J=P=null;for(N in y)if(y.hasOwnProperty(N)&&(le=y[N],le!=null))switch(N){case"value":P=le;break;case"defaultValue":J=le;break;case"multiple":b=le;default:Xr(d,h,N,le,y,null)}h=P,y=J,d.multiple=!!b,h!=null?Ml(d,!!b,h,!1):y!=null&&Ml(d,!!b,y,!0);return;case"textarea":rr("invalid",d),P=N=b=null;for(J in y)if(y.hasOwnProperty(J)&&(le=y[J],le!=null))switch(J){case"value":b=le;break;case"defaultValue":N=le;break;case"children":P=le;break;case"dangerouslySetInnerHTML":if(le!=null)throw Error(s(91));break;default:Xr(d,h,J,le,y,null)}$u(d,b,N,P),yp(d);return;case"option":for(we in y)if(y.hasOwnProperty(we)&&(b=y[we],b!=null))switch(we){case"selected":d.selected=b&&typeof b!="function"&&typeof b!="symbol";break;default:Xr(d,h,we,b,y,null)}return;case"dialog":rr("beforetoggle",d),rr("toggle",d),rr("cancel",d),rr("close",d);break;case"iframe":case"object":rr("load",d);break;case"video":case"audio":for(b=0;b<rf.length;b++)rr(rf[b],d);break;case"image":rr("error",d),rr("load",d);break;case"details":rr("toggle",d);break;case"embed":case"source":case"link":rr("error",d),rr("load",d);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Fe in y)if(y.hasOwnProperty(Fe)&&(b=y[Fe],b!=null))switch(Fe){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,h));default:Xr(d,h,Fe,b,y,null)}return;default:if(Ju(h)){for(it in y)y.hasOwnProperty(it)&&(b=y[it],b!==void 0&&HT(d,h,it,b,y,void 0));return}}for(le in y)y.hasOwnProperty(le)&&(b=y[le],b!=null&&Xr(d,h,le,b,y,null))}function mx(d,h,y,b){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var N=null,P=null,J=null,le=null,we=null,Fe=null,it=null;for(Xe in y){var gt=y[Xe];if(y.hasOwnProperty(Xe)&&gt!=null)switch(Xe){case"checked":break;case"value":break;case"defaultValue":we=gt;default:b.hasOwnProperty(Xe)||Xr(d,h,Xe,null,b,gt)}}for(var Ke in b){var Xe=b[Ke];if(gt=y[Ke],b.hasOwnProperty(Ke)&&(Xe!=null||gt!=null))switch(Ke){case"type":P=Xe;break;case"name":N=Xe;break;case"checked":Fe=Xe;break;case"defaultChecked":it=Xe;break;case"value":J=Xe;break;case"defaultValue":le=Xe;break;case"children":case"dangerouslySetInnerHTML":if(Xe!=null)throw Error(s(137,h));break;default:Xe!==gt&&Xr(d,h,Ke,Xe,b,gt)}}Eo(d,J,le,we,Fe,it,P,N);return;case"select":Xe=J=le=Ke=null;for(P in y)if(we=y[P],y.hasOwnProperty(P)&&we!=null)switch(P){case"value":break;case"multiple":Xe=we;default:b.hasOwnProperty(P)||Xr(d,h,P,null,b,we)}for(N in b)if(P=b[N],we=y[N],b.hasOwnProperty(N)&&(P!=null||we!=null))switch(N){case"value":Ke=P;break;case"defaultValue":le=P;break;case"multiple":J=P;default:P!==we&&Xr(d,h,N,P,b,we)}h=le,y=J,b=Xe,Ke!=null?Ml(d,!!y,Ke,!1):!!b!=!!y&&(h!=null?Ml(d,!!y,h,!0):Ml(d,!!y,y?[]:"",!1));return;case"textarea":Xe=Ke=null;for(le in y)if(N=y[le],y.hasOwnProperty(le)&&N!=null&&!b.hasOwnProperty(le))switch(le){case"value":break;case"children":break;default:Xr(d,h,le,null,b,N)}for(J in b)if(N=b[J],P=y[J],b.hasOwnProperty(J)&&(N!=null||P!=null))switch(J){case"value":Ke=N;break;case"defaultValue":Xe=N;break;case"children":break;case"dangerouslySetInnerHTML":if(N!=null)throw Error(s(91));break;default:N!==P&&Xr(d,h,J,N,b,P)}Zr(d,Ke,Xe);return;case"option":for(var Pn in y)if(Ke=y[Pn],y.hasOwnProperty(Pn)&&Ke!=null&&!b.hasOwnProperty(Pn))switch(Pn){case"selected":d.selected=!1;break;default:Xr(d,h,Pn,null,b,Ke)}for(we in b)if(Ke=b[we],Xe=y[we],b.hasOwnProperty(we)&&Ke!==Xe&&(Ke!=null||Xe!=null))switch(we){case"selected":d.selected=Ke&&typeof Ke!="function"&&typeof Ke!="symbol";break;default:Xr(d,h,we,Ke,b,Xe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var gn in y)Ke=y[gn],y.hasOwnProperty(gn)&&Ke!=null&&!b.hasOwnProperty(gn)&&Xr(d,h,gn,null,b,Ke);for(Fe in b)if(Ke=b[Fe],Xe=y[Fe],b.hasOwnProperty(Fe)&&Ke!==Xe&&(Ke!=null||Xe!=null))switch(Fe){case"children":case"dangerouslySetInnerHTML":if(Ke!=null)throw Error(s(137,h));break;default:Xr(d,h,Fe,Ke,b,Xe)}return;default:if(Ju(h)){for(var ti in y)Ke=y[ti],y.hasOwnProperty(ti)&&Ke!==void 0&&!b.hasOwnProperty(ti)&&HT(d,h,ti,void 0,b,Ke);for(it in b)Ke=b[it],Xe=y[it],!b.hasOwnProperty(it)||Ke===Xe||Ke===void 0&&Xe===void 0||HT(d,h,it,Ke,b,Xe);return}}for(var Le in y)Ke=y[Le],y.hasOwnProperty(Le)&&Ke!=null&&!b.hasOwnProperty(Le)&&Xr(d,h,Le,null,b,Ke);for(gt in b)Ke=b[gt],Xe=y[gt],!b.hasOwnProperty(gt)||Ke===Xe||Ke==null&&Xe==null||Xr(d,h,gt,Ke,b,Xe)}var GT=null,cf=null;function ry(d){return d.nodeType===9?d:d.ownerDocument}function rC(d){switch(d){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function iC(d,h){if(d===0)switch(h){case"svg":return 1;case"math":return 2;default:return 0}return d===1&&h==="foreignObject"?0:d}function WT(d,h){return d==="textarea"||d==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.children=="bigint"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var zT=null;function gx(){var d=window.event;return d&&d.type==="popstate"?d===zT?!1:(zT=d,!0):(zT=null,!1)}var sC=typeof setTimeout=="function"?setTimeout:void 0,_x=typeof clearTimeout=="function"?clearTimeout:void 0,aC=typeof Promise=="function"?Promise:void 0,Ex=typeof queueMicrotask=="function"?queueMicrotask:typeof aC<"u"?function(d){return aC.resolve(null).then(d).catch(yx)}:sC;function yx(d){setTimeout(function(){throw d})}function tu(d){return d==="head"}function oC(d,h){var y=h,b=0,N=0;do{var P=y.nextSibling;if(d.removeChild(y),P&&P.nodeType===8)if(y=P.data,y==="/$"){if(0<b&&8>b){y=b;var J=d.ownerDocument;if(y&1&&ug(J.documentElement),y&2&&ug(J.body),y&4)for(y=J.head,ug(y),J=y.firstChild;J;){var le=J.nextSibling,we=J.nodeName;J[za]||we==="SCRIPT"||we==="STYLE"||we==="LINK"&&J.rel.toLowerCase()==="stylesheet"||y.removeChild(J),J=le}}if(N===0){d.removeChild(P),Sg(h);return}N--}else y==="$"||y==="$?"||y==="$!"?N++:b=y.charCodeAt(0)-48;else b=0;y=P}while(y);Sg(h)}function YT(d){var h=d.firstChild;for(h&&h.nodeType===10&&(h=h.nextSibling);h;){var y=h;switch(h=h.nextSibling,y.nodeName){case"HTML":case"HEAD":case"BODY":YT(y),Ra(y);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(y.rel.toLowerCase()==="stylesheet")continue}d.removeChild(y)}}function vx(d,h,y,b){for(;d.nodeType===1;){var N=y;if(d.nodeName.toLowerCase()!==h.toLowerCase()){if(!b&&(d.nodeName!=="INPUT"||d.type!=="hidden"))break}else if(b){if(!d[za])switch(h){case"meta":if(!d.hasAttribute("itemprop"))break;return d;case"link":if(P=d.getAttribute("rel"),P==="stylesheet"&&d.hasAttribute("data-precedence"))break;if(P!==N.rel||d.getAttribute("href")!==(N.href==null||N.href===""?null:N.href)||d.getAttribute("crossorigin")!==(N.crossOrigin==null?null:N.crossOrigin)||d.getAttribute("title")!==(N.title==null?null:N.title))break;return d;case"style":if(d.hasAttribute("data-precedence"))break;return d;case"script":if(P=d.getAttribute("src"),(P!==(N.src==null?null:N.src)||d.getAttribute("type")!==(N.type==null?null:N.type)||d.getAttribute("crossorigin")!==(N.crossOrigin==null?null:N.crossOrigin))&&P&&d.hasAttribute("async")&&!d.hasAttribute("itemprop"))break;return d;default:return d}}else if(h==="input"&&d.type==="hidden"){var P=N.name==null?null:""+N.name;if(N.type==="hidden"&&d.getAttribute("name")===P)return d}else return d;if(d=Rc(d.nextSibling),d===null)break}return null}function Sx(d,h,y){if(h==="")return null;for(;d.nodeType!==3;)if((d.nodeType!==1||d.nodeName!=="INPUT"||d.type!=="hidden")&&!y||(d=Rc(d.nextSibling),d===null))return null;return d}function iy(d){return d.data==="$!"||d.data==="$?"&&d.ownerDocument.readyState==="complete"}function Tx(d,h){var y=d.ownerDocument;if(d.data!=="$?"||y.readyState==="complete")h();else{var b=function(){h(),y.removeEventListener("DOMContentLoaded",b)};y.addEventListener("DOMContentLoaded",b),d._reactRetry=b}}function Rc(d){for(;d!=null;d=d.nextSibling){var h=d.nodeType;if(h===1||h===3)break;if(h===8){if(h=d.data,h==="$"||h==="$!"||h==="$?"||h==="F!"||h==="F")break;if(h==="/$")return null}}return d}var qT=null;function cC(d){d=d.previousSibling;for(var h=0;d;){if(d.nodeType===8){var y=d.data;if(y==="$"||y==="$!"||y==="$?"){if(h===0)return d;h--}else y==="/$"&&h++}d=d.previousSibling}return null}function lC(d,h,y){switch(h=ry(y),d){case"html":if(d=h.documentElement,!d)throw Error(s(452));return d;case"head":if(d=h.head,!d)throw Error(s(453));return d;case"body":if(d=h.body,!d)throw Error(s(454));return d;default:throw Error(s(451))}}function ug(d){for(var h=d.attributes;h.length;)d.removeAttributeNode(h[0]);Ra(d)}var Ko=new Map,dC=new Set;function sy(d){return typeof d.getRootNode=="function"?d.getRootNode():d.nodeType===9?d:d.ownerDocument}var ed=Ie.d;Ie.d={f:bx,r:wx,D:Rx,C:Cx,L:Ax,m:hC,X:Nx,S:Ix,M:Ox};function bx(){var d=ed.f(),h=Ch();return d||h}function wx(d){var h=mo(d);h!==null&&h.tag===5&&h.type==="form"?ZS(h):ed.r(d)}var lf=typeof document>"u"?null:document;function uC(d,h,y){var b=lf;if(b&&typeof h=="string"&&h){var N=es(h);N='link[rel="'+d+'"][href="'+N+'"]',typeof y=="string"&&(N+='[crossorigin="'+y+'"]'),dC.has(N)||(dC.add(N),d={rel:d,crossOrigin:y,href:h},b.querySelector(N)===null&&(h=b.createElement("link"),Xs(h,"link",d),Ui(h),b.head.appendChild(h)))}}function Rx(d){ed.D(d),uC("dns-prefetch",d,null)}function Cx(d,h){ed.C(d,h),uC("preconnect",d,h)}function Ax(d,h,y){ed.L(d,h,y);var b=lf;if(b&&d&&h){var N='link[rel="preload"][as="'+es(h)+'"]';h==="image"&&y&&y.imageSrcSet?(N+='[imagesrcset="'+es(y.imageSrcSet)+'"]',typeof y.imageSizes=="string"&&(N+='[imagesizes="'+es(y.imageSizes)+'"]')):N+='[href="'+es(d)+'"]';var P=N;switch(h){case"style":P=df(d);break;case"script":P=hf(d)}Ko.has(P)||(d=O({rel:"preload",href:h==="image"&&y&&y.imageSrcSet?void 0:d,as:h},y),Ko.set(P,d),b.querySelector(N)!==null||h==="style"&&b.querySelector(uf(P))||h==="script"&&b.querySelector(hg(P))||(h=b.createElement("link"),Xs(h,"link",d),Ui(h),b.head.appendChild(h)))}}function hC(d,h){ed.m(d,h);var y=lf;if(y&&d){var b=h&&typeof h.as=="string"?h.as:"script",N='link[rel="modulepreload"][as="'+es(b)+'"][href="'+es(d)+'"]',P=N;switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":P=hf(d)}if(!Ko.has(P)&&(d=O({rel:"modulepreload",href:d},h),Ko.set(P,d),y.querySelector(N)===null)){switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(y.querySelector(hg(P)))return}b=y.createElement("link"),Xs(b,"link",d),Ui(b),y.head.appendChild(b)}}}function Ix(d,h,y){ed.S(d,h,y);var b=lf;if(b&&d){var N=Rs(b).hoistableStyles,P=df(d);h=h||"default";var J=N.get(P);if(!J){var le={loading:0,preload:null};if(J=b.querySelector(uf(P)))le.loading=5;else{d=O({rel:"stylesheet",href:d,"data-precedence":h},y),(y=Ko.get(P))&&KT(d,y);var we=J=b.createElement("link");Ui(we),Xs(we,"link",d),we._p=new Promise(function(Fe,it){we.onload=Fe,we.onerror=it}),we.addEventListener("load",function(){le.loading|=1}),we.addEventListener("error",function(){le.loading|=2}),le.loading|=4,cy(J,h,b)}J={type:"stylesheet",instance:J,count:1,state:le},N.set(P,J)}}}function Nx(d,h){ed.X(d,h);var y=lf;if(y&&d){var b=Rs(y).hoistableScripts,N=hf(d),P=b.get(N);P||(P=y.querySelector(hg(N)),P||(d=O({src:d,async:!0},h),(h=Ko.get(N))&&XT(d,h),P=y.createElement("script"),Ui(P),Xs(P,"link",d),y.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},b.set(N,P))}}function Ox(d,h){ed.M(d,h);var y=lf;if(y&&d){var b=Rs(y).hoistableScripts,N=hf(d),P=b.get(N);P||(P=y.querySelector(hg(N)),P||(d=O({src:d,async:!0,type:"module"},h),(h=Ko.get(N))&&XT(d,h),P=y.createElement("script"),Ui(P),Xs(P,"link",d),y.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},b.set(N,P))}}function pC(d,h,y,b){var N=(N=St.current)?sy(N):null;if(!N)throw Error(s(446));switch(d){case"meta":case"title":return null;case"style":return typeof y.precedence=="string"&&typeof y.href=="string"?(h=df(y.href),y=Rs(N).hoistableStyles,b=y.get(h),b||(b={type:"style",instance:null,count:0,state:null},y.set(h,b)),b):{type:"void",instance:null,count:0,state:null};case"link":if(y.rel==="stylesheet"&&typeof y.href=="string"&&typeof y.precedence=="string"){d=df(y.href);var P=Rs(N).hoistableStyles,J=P.get(d);if(J||(N=N.ownerDocument||N,J={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},P.set(d,J),(P=N.querySelector(uf(d)))&&!P._p&&(J.instance=P,J.state.loading=5),Ko.has(d)||(y={rel:"preload",as:"style",href:y.href,crossOrigin:y.crossOrigin,integrity:y.integrity,media:y.media,hrefLang:y.hrefLang,referrerPolicy:y.referrerPolicy},Ko.set(d,y),P||fC(N,d,y,J.state))),h&&b===null)throw Error(s(528,""));return J}if(h&&b!==null)throw Error(s(529,""));return null;case"script":return h=y.async,y=y.src,typeof y=="string"&&h&&typeof h!="function"&&typeof h!="symbol"?(h=hf(y),y=Rs(N).hoistableScripts,b=y.get(h),b||(b={type:"script",instance:null,count:0,state:null},y.set(h,b)),b):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,d))}}function df(d){return'href="'+es(d)+'"'}function uf(d){return'link[rel="stylesheet"]['+d+"]"}function ay(d){return O({},d,{"data-precedence":d.precedence,precedence:null})}function fC(d,h,y,b){d.querySelector('link[rel="preload"][as="style"]['+h+"]")?b.loading=1:(h=d.createElement("link"),b.preload=h,h.addEventListener("load",function(){return b.loading|=1}),h.addEventListener("error",function(){return b.loading|=2}),Xs(h,"link",y),Ui(h),d.head.appendChild(h))}function hf(d){return'[src="'+es(d)+'"]'}function hg(d){return"script[async]"+d}function oy(d,h,y){if(h.count++,h.instance===null)switch(h.type){case"style":var b=d.querySelector('style[data-href~="'+es(y.href)+'"]');if(b)return h.instance=b,Ui(b),b;var N=O({},y,{"data-href":y.href,"data-precedence":y.precedence,href:null,precedence:null});return b=(d.ownerDocument||d).createElement("style"),Ui(b),Xs(b,"style",N),cy(b,y.precedence,d),h.instance=b;case"stylesheet":N=df(y.href);var P=d.querySelector(uf(N));if(P)return h.state.loading|=4,h.instance=P,Ui(P),P;b=ay(y),(N=Ko.get(N))&&KT(b,N),P=(d.ownerDocument||d).createElement("link"),Ui(P);var J=P;return J._p=new Promise(function(le,we){J.onload=le,J.onerror=we}),Xs(P,"link",b),h.state.loading|=4,cy(P,y.precedence,d),h.instance=P;case"script":return P=hf(y.src),(N=d.querySelector(hg(P)))?(h.instance=N,Ui(N),N):(b=y,(N=Ko.get(P))&&(b=O({},y),XT(b,N)),d=d.ownerDocument||d,N=d.createElement("script"),Ui(N),Xs(N,"link",b),d.head.appendChild(N),h.instance=N);case"void":return null;default:throw Error(s(443,h.type))}else h.type==="stylesheet"&&(h.state.loading&4)===0&&(b=h.instance,h.state.loading|=4,cy(b,y.precedence,d));return h.instance}function cy(d,h,y){for(var b=y.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),N=b.length?b[b.length-1]:null,P=N,J=0;J<b.length;J++){var le=b[J];if(le.dataset.precedence===h)P=le;else if(P!==N)break}P?P.parentNode.insertBefore(d,P.nextSibling):(h=y.nodeType===9?y.head:y,h.insertBefore(d,h.firstChild))}function KT(d,h){d.crossOrigin==null&&(d.crossOrigin=h.crossOrigin),d.referrerPolicy==null&&(d.referrerPolicy=h.referrerPolicy),d.title==null&&(d.title=h.title)}function XT(d,h){d.crossOrigin==null&&(d.crossOrigin=h.crossOrigin),d.referrerPolicy==null&&(d.referrerPolicy=h.referrerPolicy),d.integrity==null&&(d.integrity=h.integrity)}var ly=null;function QT(d,h,y){if(ly===null){var b=new Map,N=ly=new Map;N.set(y,b)}else N=ly,b=N.get(y),b||(b=new Map,N.set(y,b));if(b.has(d))return b;for(b.set(d,null),y=y.getElementsByTagName(d),N=0;N<y.length;N++){var P=y[N];if(!(P[za]||P[mr]||d==="link"&&P.getAttribute("rel")==="stylesheet")&&P.namespaceURI!=="http://www.w3.org/2000/svg"){var J=P.getAttribute(h)||"";J=d+J;var le=b.get(J);le?le.push(P):b.set(J,[P])}}return b}function mC(d,h,y){d=d.ownerDocument||d,d.head.insertBefore(y,h==="title"?d.querySelector("head > title"):null)}function $T(d,h,y){if(y===1||h.itemProp!=null)return!1;switch(d){case"meta":case"title":return!0;case"style":if(typeof h.precedence!="string"||typeof h.href!="string"||h.href==="")break;return!0;case"link":if(typeof h.rel!="string"||typeof h.href!="string"||h.href===""||h.onLoad||h.onError)break;switch(h.rel){case"stylesheet":return d=h.disabled,typeof h.precedence=="string"&&d==null;default:return!0}case"script":if(h.async&&typeof h.async!="function"&&typeof h.async!="symbol"&&!h.onLoad&&!h.onError&&h.src&&typeof h.src=="string")return!0}return!1}function gC(d){return!(d.type==="stylesheet"&&(d.state.loading&3)===0)}var pg=null;function Dx(){}function xx(d,h,y){if(pg===null)throw Error(s(475));var b=pg;if(h.type==="stylesheet"&&(typeof y.media!="string"||matchMedia(y.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var N=df(y.href),P=d.querySelector(uf(N));if(P){d=P._p,d!==null&&typeof d=="object"&&typeof d.then=="function"&&(b.count++,b=dy.bind(b),d.then(b,b)),h.state.loading|=4,h.instance=P,Ui(P);return}P=d.ownerDocument||d,y=ay(y),(N=Ko.get(N))&&KT(y,N),P=P.createElement("link"),Ui(P);var J=P;J._p=new Promise(function(le,we){J.onload=le,J.onerror=we}),Xs(P,"link",y),h.instance=P}b.stylesheets===null&&(b.stylesheets=new Map),b.stylesheets.set(h,d),(d=h.state.preload)&&(h.state.loading&3)===0&&(b.count++,h=dy.bind(b),d.addEventListener("load",h),d.addEventListener("error",h))}}function _C(){if(pg===null)throw Error(s(475));var d=pg;return d.stylesheets&&d.count===0&&mg(d,d.stylesheets),0<d.count?function(h){var y=setTimeout(function(){if(d.stylesheets&&mg(d,d.stylesheets),d.unsuspend){var b=d.unsuspend;d.unsuspend=null,b()}},6e4);return d.unsuspend=h,function(){d.unsuspend=null,clearTimeout(y)}}:null}function dy(){if(this.count--,this.count===0){if(this.stylesheets)mg(this,this.stylesheets);else if(this.unsuspend){var d=this.unsuspend;this.unsuspend=null,d()}}}var fg=null;function mg(d,h){d.stylesheets=null,d.unsuspend!==null&&(d.count++,fg=new Map,h.forEach(Px,d),fg=null,dy.call(d))}function Px(d,h){if(!(h.state.loading&4)){var y=fg.get(d);if(y)var b=y.get(null);else{y=new Map,fg.set(d,y);for(var N=d.querySelectorAll("link[data-precedence],style[data-precedence]"),P=0;P<N.length;P++){var J=N[P];(J.nodeName==="LINK"||J.getAttribute("media")!=="not all")&&(y.set(J.dataset.precedence,J),b=J)}b&&y.set(null,b)}N=h.instance,J=N.getAttribute("data-precedence"),P=y.get(J)||b,P===b&&y.set(null,N),y.set(J,N),this.count++,b=dy.bind(this),N.addEventListener("load",b),N.addEventListener("error",b),P?P.parentNode.insertBefore(N,P.nextSibling):(d=d.nodeType===9?d.head:d,d.insertBefore(N,d.firstChild)),h.state.loading|=4}}var gg={$$typeof:ue,Provider:null,Consumer:null,_currentValue:Re,_currentValue2:Re,_threadCount:0};function EC(d,h,y,b,N,P,J,le){this.tag=1,this.containerInfo=d,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=nn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nn(0),this.hiddenUpdates=nn(null),this.identifierPrefix=b,this.onUncaughtError=N,this.onCaughtError=P,this.onRecoverableError=J,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=le,this.incompleteTransitions=new Map}function yC(d,h,y,b,N,P,J,le,we,Fe,it,gt){return d=new EC(d,h,y,J,le,we,Fe,gt),h=1,P===!0&&(h|=24),P=bo(3,null,null,h),d.current=P,P.stateNode=d,h=Rm(),h.refCount++,d.pooledCache=h,h.refCount++,P.memoizedState={element:b,isDehydrated:y,cache:h},fE(P),d}function JT(d){return d?(d=zl,d):zl}function ZT(d,h,y,b,N,P){N=JT(N),b.context===null?b.context=N:b.pendingContext=N,b=Fd(h),b.payload={element:y},P=P===void 0?null:P,P!==null&&(b.callback=P),y=Ql(d,b,h),y!==null&&(Za(y,d,h),Nm(y,d,h))}function vC(d,h){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var y=d.retryLane;d.retryLane=y!==0&&y<h?y:h}}function eb(d,h){vC(d,h),(d=d.alternate)&&vC(d,h)}function SC(d){if(d.tag===13){var h=Ap(d,67108864);h!==null&&Za(h,d,67108864),eb(d,67108864)}}var uy=!0;function kx(d,h,y,b){var N=be.T;be.T=null;var P=Ie.p;try{Ie.p=2,hy(d,h,y,b)}finally{Ie.p=P,be.T=N}}function Lx(d,h,y,b){var N=be.T;be.T=null;var P=Ie.p;try{Ie.p=8,hy(d,h,y,b)}finally{Ie.p=P,be.T=N}}function hy(d,h,y,b){if(uy){var N=_g(b);if(N===null)ty(d,h,b,Eg,y),nb(d,b);else if(bC(N,d,h,y,b))b.stopPropagation();else if(nb(d,b),h&4&&-1<Da.indexOf(d)){for(;N!==null;){var P=mo(N);if(P!==null)switch(P.tag){case 3:if(P=P.stateNode,P.current.memoizedState.isDehydrated){var J=zi(P.pendingLanes);if(J!==0){var le=P;for(le.pendingLanes|=2,le.entangledLanes|=2;J;){var we=1<<31-mn(J);le.entanglements[1]|=we,J&=~we}qo(P),(Ur&6)===0&&(Qp=mt()+500,og(0))}}break;case 13:le=Ap(P,2),le!==null&&Za(le,P,2),Ch(),eb(P,2)}if(P=_g(b),P===null&&ty(d,h,b,Eg,y),P===N)break;N=P}N!==null&&b.stopPropagation()}else ty(d,h,b,null,y)}}function _g(d){return d=Vo(d),nt(d)}var Eg=null;function nt(d){if(Eg=null,d=Uo(d),d!==null){var h=p(d);if(h===null)d=null;else{var y=h.tag;if(y===13){if(d=_(h),d!==null)return d;d=null}else if(y===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;d=null}else h!==d&&(d=null)}}return Eg=d,null}function TC(d){switch(d){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(kt()){case Gt:return 2;case Mn:return 8;case Ci:case bs:return 32;case Rr:return 268435456;default:return 32}default:return 32}}var tb=!1,nu=null,ru=null,iu=null,xh=new Map,yg=new Map,su=[],Da="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function nb(d,h){switch(d){case"focusin":case"focusout":nu=null;break;case"dragenter":case"dragleave":ru=null;break;case"mouseover":case"mouseout":iu=null;break;case"pointerover":case"pointerout":xh.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":yg.delete(h.pointerId)}}function vg(d,h,y,b,N,P){return d===null||d.nativeEvent!==P?(d={blockedOn:h,domEventName:y,eventSystemFlags:b,nativeEvent:P,targetContainers:[N]},h!==null&&(h=mo(h),h!==null&&SC(h)),d):(d.eventSystemFlags|=b,h=d.targetContainers,N!==null&&h.indexOf(N)===-1&&h.push(N),d)}function bC(d,h,y,b,N){switch(h){case"focusin":return nu=vg(nu,d,h,y,b,N),!0;case"dragenter":return ru=vg(ru,d,h,y,b,N),!0;case"mouseover":return iu=vg(iu,d,h,y,b,N),!0;case"pointerover":var P=N.pointerId;return xh.set(P,vg(xh.get(P)||null,d,h,y,b,N)),!0;case"gotpointercapture":return P=N.pointerId,yg.set(P,vg(yg.get(P)||null,d,h,y,b,N)),!0}return!1}function wC(d){var h=Uo(d.target);if(h!==null){var y=p(h);if(y!==null){if(h=y.tag,h===13){if(h=_(y),h!==null){d.blockedOn=h,Ai(d.priority,function(){if(y.tag===13){var b=Ao();b=un(b);var N=Ap(y,b);N!==null&&Za(N,y,b),eb(y,b)}});return}}else if(h===3&&y.stateNode.current.memoizedState.isDehydrated){d.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}d.blockedOn=null}function pf(d){if(d.blockedOn!==null)return!1;for(var h=d.targetContainers;0<h.length;){var y=_g(d.nativeEvent);if(y===null){y=d.nativeEvent;var b=new y.constructor(y.type,y);jl=b,y.target.dispatchEvent(b),jl=null}else return h=mo(y),h!==null&&SC(h),d.blockedOn=y,!1;h.shift()}return!0}function rb(d,h,y){pf(d)&&y.delete(h)}function RC(){tb=!1,nu!==null&&pf(nu)&&(nu=null),ru!==null&&pf(ru)&&(ru=null),iu!==null&&pf(iu)&&(iu=null),xh.forEach(rb),yg.forEach(rb)}function py(d,h){d.blockedOn===h&&(d.blockedOn=null,tb||(tb=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,RC)))}var fy=null;function ib(d){fy!==d&&(fy=d,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){fy===d&&(fy=null);for(var h=0;h<d.length;h+=3){var y=d[h],b=d[h+1],N=d[h+2];if(typeof b!="function"){if(nt(b||y)===null)continue;break}var P=mo(y);P!==null&&(d.splice(h,3),h-=3,Fp(P,{pending:!0,data:N,method:y.method,action:b},b,N))}}))}function Sg(d){function h(we){return py(we,d)}nu!==null&&py(nu,d),ru!==null&&py(ru,d),iu!==null&&py(iu,d),xh.forEach(h),yg.forEach(h);for(var y=0;y<su.length;y++){var b=su[y];b.blockedOn===d&&(b.blockedOn=null)}for(;0<su.length&&(y=su[0],y.blockedOn===null);)wC(y),y.blockedOn===null&&su.shift();if(y=(d.ownerDocument||d).$$reactFormReplay,y!=null)for(b=0;b<y.length;b+=3){var N=y[b],P=y[b+1],J=N[yr]||null;if(typeof P=="function")J||ib(y);else if(J){var le=null;if(P&&P.hasAttribute("formAction")){if(N=P,J=P[yr]||null)le=J.formAction;else if(nt(N)!==null)continue}else le=J.action;typeof le=="function"?y[b+1]=le:(y.splice(b,3),b-=3),ib(y)}}}function sb(d){this._internalRoot=d}Tg.prototype.render=sb.prototype.render=function(d){var h=this._internalRoot;if(h===null)throw Error(s(409));var y=h.current,b=Ao();ZT(y,b,d,h,null,null)},Tg.prototype.unmount=sb.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var h=d.containerInfo;ZT(d.current,2,null,d,null,null),Ch(),h[oi]=null}};function Tg(d){this._internalRoot=d}Tg.prototype.unstable_scheduleHydration=function(d){if(d){var h=Dn();d={blockedOn:null,target:d,priority:h};for(var y=0;y<su.length&&h!==0&&h<su[y].priority;y++);su.splice(y,0,d),y===0&&wC(d)}};var CC=n.version;if(CC!=="19.1.0")throw Error(s(527,CC,"19.1.0"));Ie.findDOMNode=function(d){var h=d._reactInternals;if(h===void 0)throw typeof d.render=="function"?Error(s(188)):(d=Object.keys(d).join(","),Error(s(268,d)));return d=w(h),d=d!==null?C(d):null,d=d===null?null:d.stateNode,d};var Mx={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:be,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bg.isDisabled&&bg.supportsFiber)try{Ht=bg.inject(Mx),sn=bg}catch{}}return yw.createRoot=function(d,h){if(!l(d))throw Error(s(299));var y=!1,b="",N=C0,P=A0,J=I0,le=null;return h!=null&&(h.unstable_strictMode===!0&&(y=!0),h.identifierPrefix!==void 0&&(b=h.identifierPrefix),h.onUncaughtError!==void 0&&(N=h.onUncaughtError),h.onCaughtError!==void 0&&(P=h.onCaughtError),h.onRecoverableError!==void 0&&(J=h.onRecoverableError),h.unstable_transitionCallbacks!==void 0&&(le=h.unstable_transitionCallbacks)),h=yC(d,1,!1,null,null,y,b,N,P,J,le,null),d[oi]=h.current,ey(d),new sb(h)},yw.hydrateRoot=function(d,h,y){if(!l(d))throw Error(s(299));var b=!1,N="",P=C0,J=A0,le=I0,we=null,Fe=null;return y!=null&&(y.unstable_strictMode===!0&&(b=!0),y.identifierPrefix!==void 0&&(N=y.identifierPrefix),y.onUncaughtError!==void 0&&(P=y.onUncaughtError),y.onCaughtError!==void 0&&(J=y.onCaughtError),y.onRecoverableError!==void 0&&(le=y.onRecoverableError),y.unstable_transitionCallbacks!==void 0&&(we=y.unstable_transitionCallbacks),y.formState!==void 0&&(Fe=y.formState)),h=yC(d,1,!0,h,y??null,b,N,P,J,le,we,Fe),h.context=JT(null),y=h.current,b=Ao(),b=un(b),N=Fd(b),N.callback=null,Ql(y,N,b),y=b,h.current.lanes=y,yn(h,y),qo(h),d[oi]=h.current,ey(d),new Tg(h)},yw.version="19.1.0",yw}var OW;function mae(){if(OW)return EL.exports;OW=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(n){console.error(n)}}return a(),EL.exports=fae(),EL.exports}var gae=mae();/**
 * react-router v7.7.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var DW="popstate";function _ae(a={}){function n(s,l){let{pathname:p,search:_,hash:T}=s.location;return OM("",{pathname:p,search:_,hash:T},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function i(s,l){return typeof l=="string"?l:$w(l)}return yae(n,i,null,a)}function Zi(a,n){if(a===!1||a===null||typeof a>"u")throw new Error(n)}function Td(a,n){if(!a){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function Eae(){return Math.random().toString(36).substring(2,10)}function xW(a,n){return{usr:a.state,key:a.key,idx:n}}function OM(a,n,i=null,s){return{pathname:typeof a=="string"?a:a.pathname,search:"",hash:"",...typeof n=="string"?$v(n):n,state:i,key:n&&n.key||s||Eae()}}function $w({pathname:a="/",search:n="",hash:i=""}){return n&&n!=="?"&&(a+=n.charAt(0)==="?"?n:"?"+n),i&&i!=="#"&&(a+=i.charAt(0)==="#"?i:"#"+i),a}function $v(a){let n={};if(a){let i=a.indexOf("#");i>=0&&(n.hash=a.substring(i),a=a.substring(0,i));let s=a.indexOf("?");s>=0&&(n.search=a.substring(s),a=a.substring(0,s)),a&&(n.pathname=a)}return n}function yae(a,n,i,s={}){let{window:l=document.defaultView,v5Compat:p=!1}=s,_=l.history,T="POP",w=null,C=O();C==null&&(C=0,_.replaceState({..._.state,idx:C},""));function O(){return(_.state||{idx:null}).idx}function k(){T="POP";let K=O(),ie=K==null?null:K-C;C=K,w&&w({action:T,location:ee.location,delta:ie})}function U(K,ie){T="PUSH";let se=OM(ee.location,K,ie);C=O()+1;let ue=xW(se,C),ye=ee.createHref(se);try{_.pushState(ue,"",ye)}catch(ae){if(ae instanceof DOMException&&ae.name==="DataCloneError")throw ae;l.location.assign(ye)}p&&w&&w({action:T,location:ee.location,delta:1})}function Y(K,ie){T="REPLACE";let se=OM(ee.location,K,ie);C=O();let ue=xW(se,C),ye=ee.createHref(se);_.replaceState(ue,"",ye),p&&w&&w({action:T,location:ee.location,delta:0})}function W(K){return vae(K)}let ee={get action(){return T},get location(){return a(l,_)},listen(K){if(w)throw new Error("A history only accepts one active listener");return l.addEventListener(DW,k),w=K,()=>{l.removeEventListener(DW,k),w=null}},createHref(K){return n(l,K)},createURL:W,encodeLocation(K){let ie=W(K);return{pathname:ie.pathname,search:ie.search,hash:ie.hash}},push:U,replace:Y,go(K){return _.go(K)}};return ee}function vae(a,n=!1){let i="http://localhost";typeof window<"u"&&(i=window.location.origin!=="null"?window.location.origin:window.location.href),Zi(i,"No window.location.(origin|href) available to create URL");let s=typeof a=="string"?a:$w(a);return s=s.replace(/ $/,"%20"),!n&&s.startsWith("//")&&(s=i+s),new URL(s,i)}function MY(a,n,i="/"){return Sae(a,n,i,!1)}function Sae(a,n,i,s){let l=typeof n=="string"?$v(n):n,p=op(l.pathname||"/",i);if(p==null)return null;let _=jY(a);Tae(_);let T=null;for(let w=0;T==null&&w<_.length;++w){let C=Pae(p);T=Dae(_[w],C,s)}return T}function jY(a,n=[],i=[],s=""){let l=(p,_,T)=>{let w={relativePath:T===void 0?p.path||"":T,caseSensitive:p.caseSensitive===!0,childrenIndex:_,route:p};w.relativePath.startsWith("/")&&(Zi(w.relativePath.startsWith(s),`Absolute route path "${w.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),w.relativePath=w.relativePath.slice(s.length));let C=$h([s,w.relativePath]),O=i.concat(w);p.children&&p.children.length>0&&(Zi(p.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${C}".`),jY(p.children,n,O,C)),!(p.path==null&&!p.index)&&n.push({path:C,score:Nae(C,p.index),routesMeta:O})};return a.forEach((p,_)=>{var T;if(p.path===""||!((T=p.path)!=null&&T.includes("?")))l(p,_);else for(let w of UY(p.path))l(p,_,w)}),n}function UY(a){let n=a.split("/");if(n.length===0)return[];let[i,...s]=n,l=i.endsWith("?"),p=i.replace(/\?$/,"");if(s.length===0)return l?[p,""]:[p];let _=UY(s.join("/")),T=[];return T.push(..._.map(w=>w===""?p:[p,w].join("/"))),l&&T.push(..._),T.map(w=>a.startsWith("/")&&w===""?"/":w)}function Tae(a){a.sort((n,i)=>n.score!==i.score?i.score-n.score:Oae(n.routesMeta.map(s=>s.childrenIndex),i.routesMeta.map(s=>s.childrenIndex)))}var bae=/^:[\w-]+$/,wae=3,Rae=2,Cae=1,Aae=10,Iae=-2,PW=a=>a==="*";function Nae(a,n){let i=a.split("/"),s=i.length;return i.some(PW)&&(s+=Iae),n&&(s+=Rae),i.filter(l=>!PW(l)).reduce((l,p)=>l+(bae.test(p)?wae:p===""?Cae:Aae),s)}function Oae(a,n){return a.length===n.length&&a.slice(0,-1).every((s,l)=>s===n[l])?a[a.length-1]-n[n.length-1]:0}function Dae(a,n,i=!1){let{routesMeta:s}=a,l={},p="/",_=[];for(let T=0;T<s.length;++T){let w=s[T],C=T===s.length-1,O=p==="/"?n:n.slice(p.length)||"/",k=cO({path:w.relativePath,caseSensitive:w.caseSensitive,end:C},O),U=w.route;if(!k&&C&&i&&!s[s.length-1].route.index&&(k=cO({path:w.relativePath,caseSensitive:w.caseSensitive,end:!1},O)),!k)return null;Object.assign(l,k.params),_.push({params:l,pathname:$h([p,k.pathname]),pathnameBase:jae($h([p,k.pathnameBase])),route:U}),k.pathnameBase!=="/"&&(p=$h([p,k.pathnameBase]))}return _}function cO(a,n){typeof a=="string"&&(a={path:a,caseSensitive:!1,end:!0});let[i,s]=xae(a.path,a.caseSensitive,a.end),l=n.match(i);if(!l)return null;let p=l[0],_=p.replace(/(.)\/+$/,"$1"),T=l.slice(1);return{params:s.reduce((C,{paramName:O,isOptional:k},U)=>{if(O==="*"){let W=T[U]||"";_=p.slice(0,p.length-W.length).replace(/(.)\/+$/,"$1")}const Y=T[U];return k&&!Y?C[O]=void 0:C[O]=(Y||"").replace(/%2F/g,"/"),C},{}),pathname:p,pathnameBase:_,pattern:a}}function xae(a,n=!1,i=!0){Td(a==="*"||!a.endsWith("*")||a.endsWith("/*"),`Route path "${a}" will be treated as if it were "${a.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${a.replace(/\*$/,"/*")}".`);let s=[],l="^"+a.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,T,w)=>(s.push({paramName:T,isOptional:w!=null}),w?"/?([^\\/]+)?":"/([^\\/]+)"));return a.endsWith("*")?(s.push({paramName:"*"}),l+=a==="*"||a==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?l+="\\/*$":a!==""&&a!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,n?void 0:"i"),s]}function Pae(a){try{return a.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return Td(!1,`The URL path "${a}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${n}).`),a}}function op(a,n){if(n==="/")return a;if(!a.toLowerCase().startsWith(n.toLowerCase()))return null;let i=n.endsWith("/")?n.length-1:n.length,s=a.charAt(i);return s&&s!=="/"?null:a.slice(i)||"/"}function kae(a,n="/"){let{pathname:i,search:s="",hash:l=""}=typeof a=="string"?$v(a):a;return{pathname:i?i.startsWith("/")?i:Lae(i,n):n,search:Uae(s),hash:Vae(l)}}function Lae(a,n){let i=n.replace(/\/+$/,"").split("/");return a.split("/").forEach(l=>{l===".."?i.length>1&&i.pop():l!=="."&&i.push(l)}),i.length>1?i.join("/"):"/"}function TL(a,n,i,s){return`Cannot include a '${a}' character in a manually specified \`to.${n}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${i}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Mae(a){return a.filter((n,i)=>i===0||n.route.path&&n.route.path.length>0)}function P2(a){let n=Mae(a);return n.map((i,s)=>s===n.length-1?i.pathname:i.pathnameBase)}function k2(a,n,i,s=!1){let l;typeof a=="string"?l=$v(a):(l={...a},Zi(!l.pathname||!l.pathname.includes("?"),TL("?","pathname","search",l)),Zi(!l.pathname||!l.pathname.includes("#"),TL("#","pathname","hash",l)),Zi(!l.search||!l.search.includes("#"),TL("#","search","hash",l)));let p=a===""||l.pathname==="",_=p?"/":l.pathname,T;if(_==null)T=i;else{let k=n.length-1;if(!s&&_.startsWith("..")){let U=_.split("/");for(;U[0]==="..";)U.shift(),k-=1;l.pathname=U.join("/")}T=k>=0?n[k]:"/"}let w=kae(l,T),C=_&&_!=="/"&&_.endsWith("/"),O=(p||_===".")&&i.endsWith("/");return!w.pathname.endsWith("/")&&(C||O)&&(w.pathname+="/"),w}var $h=a=>a.join("/").replace(/\/\/+/g,"/"),jae=a=>a.replace(/\/+$/,"").replace(/^\/*/,"/"),Uae=a=>!a||a==="?"?"":a.startsWith("?")?a:"?"+a,Vae=a=>!a||a==="#"?"":a.startsWith("#")?a:"#"+a;function Fae(a){return a!=null&&typeof a.status=="number"&&typeof a.statusText=="string"&&typeof a.internal=="boolean"&&"data"in a}var VY=["POST","PUT","PATCH","DELETE"];new Set(VY);var Bae=["GET",...VY];new Set(Bae);var Jv=F.createContext(null);Jv.displayName="DataRouter";var QO=F.createContext(null);QO.displayName="DataRouterState";F.createContext(!1);var FY=F.createContext({isTransitioning:!1});FY.displayName="ViewTransition";var Hae=F.createContext(new Map);Hae.displayName="Fetchers";var Gae=F.createContext(null);Gae.displayName="Await";var Rd=F.createContext(null);Rd.displayName="Navigation";var mR=F.createContext(null);mR.displayName="Location";var Hu=F.createContext({outlet:null,matches:[],isDataRoute:!1});Hu.displayName="Route";var L2=F.createContext(null);L2.displayName="RouteError";function Wae(a,{relative:n}={}){Zi(Zv(),"useHref() may be used only in the context of a <Router> component.");let{basename:i,navigator:s}=F.useContext(Rd),{hash:l,pathname:p,search:_}=gR(a,{relative:n}),T=p;return i!=="/"&&(T=p==="/"?i:$h([i,p])),s.createHref({pathname:T,search:_,hash:l})}function Zv(){return F.useContext(mR)!=null}function Wi(){return Zi(Zv(),"useLocation() may be used only in the context of a <Router> component."),F.useContext(mR).location}var BY="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function HY(a){F.useContext(Rd).static||F.useLayoutEffect(a)}function ds(){let{isDataRoute:a}=F.useContext(Hu);return a?roe():zae()}function zae(){Zi(Zv(),"useNavigate() may be used only in the context of a <Router> component.");let a=F.useContext(Jv),{basename:n,navigator:i}=F.useContext(Rd),{matches:s}=F.useContext(Hu),{pathname:l}=Wi(),p=JSON.stringify(P2(s)),_=F.useRef(!1);return HY(()=>{_.current=!0}),F.useCallback((w,C={})=>{if(Td(_.current,BY),!_.current)return;if(typeof w=="number"){i.go(w);return}let O=k2(w,JSON.parse(p),l,C.relative==="path");a==null&&n!=="/"&&(O.pathname=O.pathname==="/"?n:$h([n,O.pathname])),(C.replace?i.replace:i.push)(O,C.state,C)},[n,i,p,l,a])}F.createContext(null);function gR(a,{relative:n}={}){let{matches:i}=F.useContext(Hu),{pathname:s}=Wi(),l=JSON.stringify(P2(i));return F.useMemo(()=>k2(a,JSON.parse(l),s,n==="path"),[a,l,s,n])}function Yae(a,n){return GY(a,n)}function GY(a,n,i,s){var ie;Zi(Zv(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=F.useContext(Rd),{matches:p}=F.useContext(Hu),_=p[p.length-1],T=_?_.params:{},w=_?_.pathname:"/",C=_?_.pathnameBase:"/",O=_&&_.route;{let se=O&&O.path||"";WY(w,!O||se.endsWith("*")||se.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${w}" (under <Route path="${se}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${se}"> to <Route path="${se==="/"?"*":`${se}/*`}">.`)}let k=Wi(),U;if(n){let se=typeof n=="string"?$v(n):n;Zi(C==="/"||((ie=se.pathname)==null?void 0:ie.startsWith(C)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${C}" but pathname "${se.pathname}" was given in the \`location\` prop.`),U=se}else U=k;let Y=U.pathname||"/",W=Y;if(C!=="/"){let se=C.replace(/^\//,"").split("/");W="/"+Y.replace(/^\//,"").split("/").slice(se.length).join("/")}let ee=MY(a,{pathname:W});Td(O||ee!=null,`No routes matched location "${U.pathname}${U.search}${U.hash}" `),Td(ee==null||ee[ee.length-1].route.element!==void 0||ee[ee.length-1].route.Component!==void 0||ee[ee.length-1].route.lazy!==void 0,`Matched leaf route at location "${U.pathname}${U.search}${U.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let K=$ae(ee&&ee.map(se=>Object.assign({},se,{params:Object.assign({},T,se.params),pathname:$h([C,l.encodeLocation?l.encodeLocation(se.pathname).pathname:se.pathname]),pathnameBase:se.pathnameBase==="/"?C:$h([C,l.encodeLocation?l.encodeLocation(se.pathnameBase).pathname:se.pathnameBase])})),p,i,s);return n&&K?F.createElement(mR.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...U},navigationType:"POP"}},K):K}function qae(){let a=noe(),n=Fae(a)?`${a.status} ${a.statusText}`:a instanceof Error?a.message:JSON.stringify(a),i=a instanceof Error?a.stack:null,s="rgba(200,200,200, 0.5)",l={padding:"0.5rem",backgroundColor:s},p={padding:"2px 4px",backgroundColor:s},_=null;return console.error("Error handled by React Router default ErrorBoundary:",a),_=F.createElement(F.Fragment,null,F.createElement("p",null," Hey developer "),F.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",F.createElement("code",{style:p},"ErrorBoundary")," or"," ",F.createElement("code",{style:p},"errorElement")," prop on your route.")),F.createElement(F.Fragment,null,F.createElement("h2",null,"Unexpected Application Error!"),F.createElement("h3",{style:{fontStyle:"italic"}},n),i?F.createElement("pre",{style:l},i):null,_)}var Kae=F.createElement(qae,null),Xae=class extends F.Component{constructor(a){super(a),this.state={location:a.location,revalidation:a.revalidation,error:a.error}}static getDerivedStateFromError(a){return{error:a}}static getDerivedStateFromProps(a,n){return n.location!==a.location||n.revalidation!=="idle"&&a.revalidation==="idle"?{error:a.error,location:a.location,revalidation:a.revalidation}:{error:a.error!==void 0?a.error:n.error,location:n.location,revalidation:a.revalidation||n.revalidation}}componentDidCatch(a,n){console.error("React Router caught the following error during render",a,n)}render(){return this.state.error!==void 0?F.createElement(Hu.Provider,{value:this.props.routeContext},F.createElement(L2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Qae({routeContext:a,match:n,children:i}){let s=F.useContext(Jv);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),F.createElement(Hu.Provider,{value:a},i)}function $ae(a,n=[],i=null,s=null){if(a==null){if(!i)return null;if(i.errors)a=i.matches;else if(n.length===0&&!i.initialized&&i.matches.length>0)a=i.matches;else return null}let l=a,p=i==null?void 0:i.errors;if(p!=null){let w=l.findIndex(C=>C.route.id&&(p==null?void 0:p[C.route.id])!==void 0);Zi(w>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(p).join(",")}`),l=l.slice(0,Math.min(l.length,w+1))}let _=!1,T=-1;if(i)for(let w=0;w<l.length;w++){let C=l[w];if((C.route.HydrateFallback||C.route.hydrateFallbackElement)&&(T=w),C.route.id){let{loaderData:O,errors:k}=i,U=C.route.loader&&!O.hasOwnProperty(C.route.id)&&(!k||k[C.route.id]===void 0);if(C.route.lazy||U){_=!0,T>=0?l=l.slice(0,T+1):l=[l[0]];break}}}return l.reduceRight((w,C,O)=>{let k,U=!1,Y=null,W=null;i&&(k=p&&C.route.id?p[C.route.id]:void 0,Y=C.route.errorElement||Kae,_&&(T<0&&O===0?(WY("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),U=!0,W=null):T===O&&(U=!0,W=C.route.hydrateFallbackElement||null)));let ee=n.concat(l.slice(0,O+1)),K=()=>{let ie;return k?ie=Y:U?ie=W:C.route.Component?ie=F.createElement(C.route.Component,null):C.route.element?ie=C.route.element:ie=w,F.createElement(Qae,{match:C,routeContext:{outlet:w,matches:ee,isDataRoute:i!=null},children:ie})};return i&&(C.route.ErrorBoundary||C.route.errorElement||O===0)?F.createElement(Xae,{location:i.location,revalidation:i.revalidation,component:Y,error:k,children:K(),routeContext:{outlet:null,matches:ee,isDataRoute:!0}}):K()},null)}function M2(a){return`${a} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Jae(a){let n=F.useContext(Jv);return Zi(n,M2(a)),n}function Zae(a){let n=F.useContext(QO);return Zi(n,M2(a)),n}function eoe(a){let n=F.useContext(Hu);return Zi(n,M2(a)),n}function j2(a){let n=eoe(a),i=n.matches[n.matches.length-1];return Zi(i.route.id,`${a} can only be used on routes that contain a unique "id"`),i.route.id}function toe(){return j2("useRouteId")}function noe(){var s;let a=F.useContext(L2),n=Zae("useRouteError"),i=j2("useRouteError");return a!==void 0?a:(s=n.errors)==null?void 0:s[i]}function roe(){let{router:a}=Jae("useNavigate"),n=j2("useNavigate"),i=F.useRef(!1);return HY(()=>{i.current=!0}),F.useCallback(async(l,p={})=>{Td(i.current,BY),i.current&&(typeof l=="number"?a.navigate(l):await a.navigate(l,{fromRouteId:n,...p}))},[a,n])}var kW={};function WY(a,n,i){!n&&!kW[a]&&(kW[a]=!0,Td(!1,i))}F.memo(ioe);function ioe({routes:a,future:n,state:i}){return GY(a,void 0,i,n)}function soe({to:a,replace:n,state:i,relative:s}){Zi(Zv(),"<Navigate> may be used only in the context of a <Router> component.");let{static:l}=F.useContext(Rd);Td(!l,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:p}=F.useContext(Hu),{pathname:_}=Wi(),T=ds(),w=k2(a,P2(p),_,s==="path"),C=JSON.stringify(w);return F.useEffect(()=>{T(JSON.parse(C),{replace:n,state:i,relative:s})},[T,C,s,n,i]),null}function wi(a){Zi(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function aoe({basename:a="/",children:n=null,location:i,navigationType:s="POP",navigator:l,static:p=!1}){Zi(!Zv(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let _=a.replace(/^\/*/,"/"),T=F.useMemo(()=>({basename:_,navigator:l,static:p,future:{}}),[_,l,p]);typeof i=="string"&&(i=$v(i));let{pathname:w="/",search:C="",hash:O="",state:k=null,key:U="default"}=i,Y=F.useMemo(()=>{let W=op(w,_);return W==null?null:{location:{pathname:W,search:C,hash:O,state:k,key:U},navigationType:s}},[_,w,C,O,k,U,s]);return Td(Y!=null,`<Router basename="${_}"> is not able to match the URL "${w}${C}${O}" because it does not start with the basename, so the <Router> won't render anything.`),Y==null?null:F.createElement(Rd.Provider,{value:T},F.createElement(mR.Provider,{children:n,value:Y}))}function ooe({children:a,location:n}){return Yae(DM(a),n)}function DM(a,n=[]){let i=[];return F.Children.forEach(a,(s,l)=>{if(!F.isValidElement(s))return;let p=[...n,l];if(s.type===F.Fragment){i.push.apply(i,DM(s.props.children,p));return}Zi(s.type===wi,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Zi(!s.props.index||!s.props.children,"An index route cannot have child routes.");let _={id:s.props.id||p.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(_.children=DM(s.props.children,p)),i.push(_)}),i}var pN="get",fN="application/x-www-form-urlencoded";function $O(a){return a!=null&&typeof a.tagName=="string"}function coe(a){return $O(a)&&a.tagName.toLowerCase()==="button"}function loe(a){return $O(a)&&a.tagName.toLowerCase()==="form"}function doe(a){return $O(a)&&a.tagName.toLowerCase()==="input"}function uoe(a){return!!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)}function hoe(a,n){return a.button===0&&(!n||n==="_self")&&!uoe(a)}var YI=null;function poe(){if(YI===null)try{new FormData(document.createElement("form"),0),YI=!1}catch{YI=!0}return YI}var foe=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function bL(a){return a!=null&&!foe.has(a)?(Td(!1,`"${a}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${fN}"`),null):a}function moe(a,n){let i,s,l,p,_;if(loe(a)){let T=a.getAttribute("action");s=T?op(T,n):null,i=a.getAttribute("method")||pN,l=bL(a.getAttribute("enctype"))||fN,p=new FormData(a)}else if(coe(a)||doe(a)&&(a.type==="submit"||a.type==="image")){let T=a.form;if(T==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let w=a.getAttribute("formaction")||T.getAttribute("action");if(s=w?op(w,n):null,i=a.getAttribute("formmethod")||T.getAttribute("method")||pN,l=bL(a.getAttribute("formenctype"))||bL(T.getAttribute("enctype"))||fN,p=new FormData(T,a),!poe()){let{name:C,type:O,value:k}=a;if(O==="image"){let U=C?`${C}.`:"";p.append(`${U}x`,"0"),p.append(`${U}y`,"0")}else C&&p.append(C,k)}}else{if($O(a))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');i=pN,s=null,l=fN,_=a}return p&&l==="text/plain"&&(_=p,p=void 0),{action:s,method:i.toLowerCase(),encType:l,formData:p,body:_}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function U2(a,n){if(a===!1||a===null||typeof a>"u")throw new Error(n)}function goe(a,n,i){let s=typeof a=="string"?new URL(a,typeof window>"u"?"server://singlefetch/":window.location.origin):a;return s.pathname==="/"?s.pathname=`_root.${i}`:n&&op(s.pathname,n)==="/"?s.pathname=`${n.replace(/\/$/,"")}/_root.${i}`:s.pathname=`${s.pathname.replace(/\/$/,"")}.${i}`,s}async function _oe(a,n){if(a.id in n)return n[a.id];try{let i=await import(a.module);return n[a.id]=i,i}catch(i){return console.error(`Error loading route module \`${a.module}\`, reloading page...`),console.error(i),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Eoe(a){return a==null?!1:a.href==null?a.rel==="preload"&&typeof a.imageSrcSet=="string"&&typeof a.imageSizes=="string":typeof a.rel=="string"&&typeof a.href=="string"}async function yoe(a,n,i){let s=await Promise.all(a.map(async l=>{let p=n.routes[l.route.id];if(p){let _=await _oe(p,i);return _.links?_.links():[]}return[]}));return boe(s.flat(1).filter(Eoe).filter(l=>l.rel==="stylesheet"||l.rel==="preload").map(l=>l.rel==="stylesheet"?{...l,rel:"prefetch",as:"style"}:{...l,rel:"prefetch"}))}function LW(a,n,i,s,l,p){let _=(w,C)=>i[C]?w.route.id!==i[C].route.id:!0,T=(w,C)=>{var O;return i[C].pathname!==w.pathname||((O=i[C].route.path)==null?void 0:O.endsWith("*"))&&i[C].params["*"]!==w.params["*"]};return p==="assets"?n.filter((w,C)=>_(w,C)||T(w,C)):p==="data"?n.filter((w,C)=>{var k;let O=s.routes[w.route.id];if(!O||!O.hasLoader)return!1;if(_(w,C)||T(w,C))return!0;if(w.route.shouldRevalidate){let U=w.route.shouldRevalidate({currentUrl:new URL(l.pathname+l.search+l.hash,window.origin),currentParams:((k=i[0])==null?void 0:k.params)||{},nextUrl:new URL(a,window.origin),nextParams:w.params,defaultShouldRevalidate:!0});if(typeof U=="boolean")return U}return!0}):[]}function voe(a,n,{includeHydrateFallback:i}={}){return Soe(a.map(s=>{let l=n.routes[s.route.id];if(!l)return[];let p=[l.module];return l.clientActionModule&&(p=p.concat(l.clientActionModule)),l.clientLoaderModule&&(p=p.concat(l.clientLoaderModule)),i&&l.hydrateFallbackModule&&(p=p.concat(l.hydrateFallbackModule)),l.imports&&(p=p.concat(l.imports)),p}).flat(1))}function Soe(a){return[...new Set(a)]}function Toe(a){let n={},i=Object.keys(a).sort();for(let s of i)n[s]=a[s];return n}function boe(a,n){let i=new Set;return new Set(n),a.reduce((s,l)=>{let p=JSON.stringify(Toe(l));return i.has(p)||(i.add(p),s.push({key:p,link:l})),s},[])}function zY(){let a=F.useContext(Jv);return U2(a,"You must render this element inside a <DataRouterContext.Provider> element"),a}function woe(){let a=F.useContext(QO);return U2(a,"You must render this element inside a <DataRouterStateContext.Provider> element"),a}var V2=F.createContext(void 0);V2.displayName="FrameworkContext";function YY(){let a=F.useContext(V2);return U2(a,"You must render this element inside a <HydratedRouter> element"),a}function Roe(a,n){let i=F.useContext(V2),[s,l]=F.useState(!1),[p,_]=F.useState(!1),{onFocus:T,onBlur:w,onMouseEnter:C,onMouseLeave:O,onTouchStart:k}=n,U=F.useRef(null);F.useEffect(()=>{if(a==="render"&&_(!0),a==="viewport"){let ee=ie=>{ie.forEach(se=>{_(se.isIntersecting)})},K=new IntersectionObserver(ee,{threshold:.5});return U.current&&K.observe(U.current),()=>{K.disconnect()}}},[a]),F.useEffect(()=>{if(s){let ee=setTimeout(()=>{_(!0)},100);return()=>{clearTimeout(ee)}}},[s]);let Y=()=>{l(!0)},W=()=>{l(!1),_(!1)};return i?a!=="intent"?[p,U,{}]:[p,U,{onFocus:vw(T,Y),onBlur:vw(w,W),onMouseEnter:vw(C,Y),onMouseLeave:vw(O,W),onTouchStart:vw(k,Y)}]:[!1,U,{}]}function vw(a,n){return i=>{a&&a(i),i.defaultPrevented||n(i)}}function Coe({page:a,...n}){let{router:i}=zY(),s=F.useMemo(()=>MY(i.routes,a,i.basename),[i.routes,a,i.basename]);return s?F.createElement(Ioe,{page:a,matches:s,...n}):null}function Aoe(a){let{manifest:n,routeModules:i}=YY(),[s,l]=F.useState([]);return F.useEffect(()=>{let p=!1;return yoe(a,n,i).then(_=>{p||l(_)}),()=>{p=!0}},[a,n,i]),s}function Ioe({page:a,matches:n,...i}){let s=Wi(),{manifest:l,routeModules:p}=YY(),{basename:_}=zY(),{loaderData:T,matches:w}=woe(),C=F.useMemo(()=>LW(a,n,w,l,s,"data"),[a,n,w,l,s]),O=F.useMemo(()=>LW(a,n,w,l,s,"assets"),[a,n,w,l,s]),k=F.useMemo(()=>{if(a===s.pathname+s.search+s.hash)return[];let W=new Set,ee=!1;if(n.forEach(ie=>{var ue;let se=l.routes[ie.route.id];!se||!se.hasLoader||(!C.some(ye=>ye.route.id===ie.route.id)&&ie.route.id in T&&((ue=p[ie.route.id])!=null&&ue.shouldRevalidate)||se.hasClientLoader?ee=!0:W.add(ie.route.id))}),W.size===0)return[];let K=goe(a,_,"data");return ee&&W.size>0&&K.searchParams.set("_routes",n.filter(ie=>W.has(ie.route.id)).map(ie=>ie.route.id).join(",")),[K.pathname+K.search]},[_,T,s,l,C,n,a,p]),U=F.useMemo(()=>voe(O,l),[O,l]),Y=Aoe(O);return F.createElement(F.Fragment,null,k.map(W=>F.createElement("link",{key:W,rel:"prefetch",as:"fetch",href:W,...i})),U.map(W=>F.createElement("link",{key:W,rel:"modulepreload",href:W,...i})),Y.map(({key:W,link:ee})=>F.createElement("link",{key:W,...ee})))}function Noe(...a){return n=>{a.forEach(i=>{typeof i=="function"?i(n):i!=null&&(i.current=n)})}}var qY=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{qY&&(window.__reactRouterVersion="7.7.0")}catch{}function Ooe({basename:a,children:n,window:i}){let s=F.useRef();s.current==null&&(s.current=_ae({window:i,v5Compat:!0}));let l=s.current,[p,_]=F.useState({action:l.action,location:l.location}),T=F.useCallback(w=>{F.startTransition(()=>_(w))},[_]);return F.useLayoutEffect(()=>l.listen(T),[l,T]),F.createElement(aoe,{basename:a,children:n,location:p.location,navigationType:p.action,navigator:l})}var KY=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,dn=F.forwardRef(function({onClick:n,discover:i="render",prefetch:s="none",relative:l,reloadDocument:p,replace:_,state:T,target:w,to:C,preventScrollReset:O,viewTransition:k,...U},Y){let{basename:W}=F.useContext(Rd),ee=typeof C=="string"&&KY.test(C),K,ie=!1;if(typeof C=="string"&&ee&&(K=C,qY))try{let te=new URL(window.location.href),oe=C.startsWith("//")?new URL(te.protocol+C):new URL(C),re=op(oe.pathname,W);oe.origin===te.origin&&re!=null?C=re+oe.search+oe.hash:ie=!0}catch{Td(!1,`<Link to="${C}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let se=Wae(C,{relative:l}),[ue,ye,ae]=Roe(s,U),ve=koe(C,{replace:_,state:T,target:w,preventScrollReset:O,relative:l,viewTransition:k});function $(te){n&&n(te),te.defaultPrevented||ve(te)}let Q=F.createElement("a",{...U,...ae,href:K||se,onClick:ie||p?n:$,ref:Noe(Y,ye),target:w,"data-discover":!ee&&i==="render"?"true":void 0});return ue&&!ee?F.createElement(F.Fragment,null,Q,F.createElement(Coe,{page:se})):Q});dn.displayName="Link";var Doe=F.forwardRef(function({"aria-current":n="page",caseSensitive:i=!1,className:s="",end:l=!1,style:p,to:_,viewTransition:T,children:w,...C},O){let k=gR(_,{relative:C.relative}),U=Wi(),Y=F.useContext(QO),{navigator:W,basename:ee}=F.useContext(Rd),K=Y!=null&&Voe(k)&&T===!0,ie=W.encodeLocation?W.encodeLocation(k).pathname:k.pathname,se=U.pathname,ue=Y&&Y.navigation&&Y.navigation.location?Y.navigation.location.pathname:null;i||(se=se.toLowerCase(),ue=ue?ue.toLowerCase():null,ie=ie.toLowerCase()),ue&&ee&&(ue=op(ue,ee)||ue);const ye=ie!=="/"&&ie.endsWith("/")?ie.length-1:ie.length;let ae=se===ie||!l&&se.startsWith(ie)&&se.charAt(ye)==="/",ve=ue!=null&&(ue===ie||!l&&ue.startsWith(ie)&&ue.charAt(ie.length)==="/"),$={isActive:ae,isPending:ve,isTransitioning:K},Q=ae?n:void 0,te;typeof s=="function"?te=s($):te=[s,ae?"active":null,ve?"pending":null,K?"transitioning":null].filter(Boolean).join(" ");let oe=typeof p=="function"?p($):p;return F.createElement(dn,{...C,"aria-current":Q,className:te,ref:O,style:oe,to:_,viewTransition:T},typeof w=="function"?w($):w)});Doe.displayName="NavLink";var xoe=F.forwardRef(({discover:a="render",fetcherKey:n,navigate:i,reloadDocument:s,replace:l,state:p,method:_=pN,action:T,onSubmit:w,relative:C,preventScrollReset:O,viewTransition:k,...U},Y)=>{let W=joe(),ee=Uoe(T,{relative:C}),K=_.toLowerCase()==="get"?"get":"post",ie=typeof T=="string"&&KY.test(T),se=ue=>{if(w&&w(ue),ue.defaultPrevented)return;ue.preventDefault();let ye=ue.nativeEvent.submitter,ae=(ye==null?void 0:ye.getAttribute("formmethod"))||_;W(ye||ue.currentTarget,{fetcherKey:n,method:ae,navigate:i,replace:l,state:p,relative:C,preventScrollReset:O,viewTransition:k})};return F.createElement("form",{ref:Y,method:K,action:ee,onSubmit:s?w:se,...U,"data-discover":!ie&&a==="render"?"true":void 0})});xoe.displayName="Form";function Poe(a){return`${a} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function XY(a){let n=F.useContext(Jv);return Zi(n,Poe(a)),n}function koe(a,{target:n,replace:i,state:s,preventScrollReset:l,relative:p,viewTransition:_}={}){let T=ds(),w=Wi(),C=gR(a,{relative:p});return F.useCallback(O=>{if(hoe(O,n)){O.preventDefault();let k=i!==void 0?i:$w(w)===$w(C);T(a,{replace:k,state:s,preventScrollReset:l,relative:p,viewTransition:_})}},[w,T,C,i,s,n,a,l,p,_])}var Loe=0,Moe=()=>`__${String(++Loe)}__`;function joe(){let{router:a}=XY("useSubmit"),{basename:n}=F.useContext(Rd),i=toe();return F.useCallback(async(s,l={})=>{let{action:p,method:_,encType:T,formData:w,body:C}=moe(s,n);if(l.navigate===!1){let O=l.fetcherKey||Moe();await a.fetch(O,i,l.action||p,{preventScrollReset:l.preventScrollReset,formData:w,body:C,formMethod:l.method||_,formEncType:l.encType||T,flushSync:l.flushSync})}else await a.navigate(l.action||p,{preventScrollReset:l.preventScrollReset,formData:w,body:C,formMethod:l.method||_,formEncType:l.encType||T,replace:l.replace,state:l.state,fromRouteId:i,flushSync:l.flushSync,viewTransition:l.viewTransition})},[a,n,i])}function Uoe(a,{relative:n}={}){let{basename:i}=F.useContext(Rd),s=F.useContext(Hu);Zi(s,"useFormAction must be used inside a RouteContext");let[l]=s.matches.slice(-1),p={...gR(a||".",{relative:n})},_=Wi();if(a==null){p.search=_.search;let T=new URLSearchParams(p.search),w=T.getAll("index");if(w.some(O=>O==="")){T.delete("index"),w.filter(k=>k).forEach(k=>T.append("index",k));let O=T.toString();p.search=O?`?${O}`:""}}return(!a||a===".")&&l.route.index&&(p.search=p.search?p.search.replace(/^\?/,"?index&"):"?index"),i!=="/"&&(p.pathname=p.pathname==="/"?i:$h([i,p.pathname])),$w(p)}function Voe(a,n={}){let i=F.useContext(FY);Zi(i!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=XY("useViewTransitionState"),l=gR(a,{relative:n.relative});if(!i.isTransitioning)return!1;let p=op(i.currentLocation.pathname,s)||i.currentLocation.pathname,_=op(i.nextLocation.pathname,s)||i.nextLocation.pathname;return cO(l.pathname,_)!=null||cO(l.pathname,p)!=null}var QY=LY();const d_=fR(QY);var wL={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var MW;function Foe(){return MW||(MW=1,function(a){(function(){var n={}.hasOwnProperty;function i(){for(var p="",_=0;_<arguments.length;_++){var T=arguments[_];T&&(p=l(p,s(T)))}return p}function s(p){if(typeof p=="string"||typeof p=="number")return p;if(typeof p!="object")return"";if(Array.isArray(p))return i.apply(null,p);if(p.toString!==Object.prototype.toString&&!p.toString.toString().includes("[native code]"))return p.toString();var _="";for(var T in p)n.call(p,T)&&p[T]&&(_=l(_,T));return _}function l(p,_){return _?p?p+" "+_:p+_:p}a.exports?(i.default=i,a.exports=i):window.classNames=i})()}(wL)),wL.exports}var Boe=Foe();const gi=fR(Boe);function Hoe(a,n){if(a==null)return{};var i={};for(var s in a)if({}.hasOwnProperty.call(a,s)){if(n.indexOf(s)!==-1)continue;i[s]=a[s]}return i}function xM(a,n){return xM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},xM(a,n)}function Goe(a,n){a.prototype=Object.create(n.prototype),a.prototype.constructor=a,xM(a,n)}const Woe=["xxl","xl","lg","md","sm","xs"],zoe="xs",_R=F.createContext({prefixes:{},breakpoints:Woe,minBreakpoint:zoe}),{Consumer:WRe,Provider:zRe}=_R;function ys(a,n){const{prefixes:i}=F.useContext(_R);return a||i[n]||n}function $Y(){const{breakpoints:a}=F.useContext(_R);return a}function JY(){const{minBreakpoint:a}=F.useContext(_R);return a}function Yoe(){const{dir:a}=F.useContext(_R);return a==="rtl"}function JO(a){return a&&a.ownerDocument||document}function qoe(a){var n=JO(a);return n&&n.defaultView||window}function Koe(a,n){return qoe(a).getComputedStyle(a,n)}var Xoe=/([A-Z])/g;function Qoe(a){return a.replace(Xoe,"-$1").toLowerCase()}var $oe=/^ms-/;function qI(a){return Qoe(a).replace($oe,"-ms-")}var Joe=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function Zoe(a){return!!(a&&Joe.test(a))}function E_(a,n){var i="",s="";if(typeof n=="string")return a.style.getPropertyValue(qI(n))||Koe(a).getPropertyValue(qI(n));Object.keys(n).forEach(function(l){var p=n[l];!p&&p!==0?a.style.removeProperty(qI(l)):Zoe(l)?s+=l+"("+p+") ":i+=qI(l)+": "+p+";"}),s&&(i+="transform: "+s+";"),a.style.cssText+=";"+i}var RL={exports:{}},CL,jW;function ece(){if(jW)return CL;jW=1;var a="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return CL=a,CL}var AL,UW;function tce(){if(UW)return AL;UW=1;var a=ece();function n(){}function i(){}return i.resetWarningCache=n,AL=function(){function s(_,T,w,C,O,k){if(k!==a){var U=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw U.name="Invariant Violation",U}}s.isRequired=s;function l(){return s}var p={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:l,element:s,elementType:s,instanceOf:l,node:s,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:n};return p.PropTypes=p,p},AL}var VW;function nce(){return VW||(VW=1,RL.exports=tce()()),RL.exports}var rce=nce();const Jh=fR(rce),FW={disabled:!1},ZY=Ge.createContext(null);var ice=function(n){return n.scrollTop},Iw="unmounted",r_="exited",Vf="entering",c_="entered",PM="exiting",mp=function(a){Goe(n,a);function n(s,l){var p;p=a.call(this,s,l)||this;var _=l,T=_&&!_.isMounting?s.enter:s.appear,w;return p.appearStatus=null,s.in?T?(w=r_,p.appearStatus=Vf):w=c_:s.unmountOnExit||s.mountOnEnter?w=Iw:w=r_,p.state={status:w},p.nextCallback=null,p}n.getDerivedStateFromProps=function(l,p){var _=l.in;return _&&p.status===Iw?{status:r_}:null};var i=n.prototype;return i.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},i.componentDidUpdate=function(l){var p=null;if(l!==this.props){var _=this.state.status;this.props.in?_!==Vf&&_!==c_&&(p=Vf):(_===Vf||_===c_)&&(p=PM)}this.updateStatus(!1,p)},i.componentWillUnmount=function(){this.cancelNextCallback()},i.getTimeouts=function(){var l=this.props.timeout,p,_,T;return p=_=T=l,l!=null&&typeof l!="number"&&(p=l.exit,_=l.enter,T=l.appear!==void 0?l.appear:_),{exit:p,enter:_,appear:T}},i.updateStatus=function(l,p){if(l===void 0&&(l=!1),p!==null)if(this.cancelNextCallback(),p===Vf){if(this.props.unmountOnExit||this.props.mountOnEnter){var _=this.props.nodeRef?this.props.nodeRef.current:d_.findDOMNode(this);_&&ice(_)}this.performEnter(l)}else this.performExit();else this.props.unmountOnExit&&this.state.status===r_&&this.setState({status:Iw})},i.performEnter=function(l){var p=this,_=this.props.enter,T=this.context?this.context.isMounting:l,w=this.props.nodeRef?[T]:[d_.findDOMNode(this),T],C=w[0],O=w[1],k=this.getTimeouts(),U=T?k.appear:k.enter;if(!l&&!_||FW.disabled){this.safeSetState({status:c_},function(){p.props.onEntered(C)});return}this.props.onEnter(C,O),this.safeSetState({status:Vf},function(){p.props.onEntering(C,O),p.onTransitionEnd(U,function(){p.safeSetState({status:c_},function(){p.props.onEntered(C,O)})})})},i.performExit=function(){var l=this,p=this.props.exit,_=this.getTimeouts(),T=this.props.nodeRef?void 0:d_.findDOMNode(this);if(!p||FW.disabled){this.safeSetState({status:r_},function(){l.props.onExited(T)});return}this.props.onExit(T),this.safeSetState({status:PM},function(){l.props.onExiting(T),l.onTransitionEnd(_.exit,function(){l.safeSetState({status:r_},function(){l.props.onExited(T)})})})},i.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},i.safeSetState=function(l,p){p=this.setNextCallback(p),this.setState(l,p)},i.setNextCallback=function(l){var p=this,_=!0;return this.nextCallback=function(T){_&&(_=!1,p.nextCallback=null,l(T))},this.nextCallback.cancel=function(){_=!1},this.nextCallback},i.onTransitionEnd=function(l,p){this.setNextCallback(p);var _=this.props.nodeRef?this.props.nodeRef.current:d_.findDOMNode(this),T=l==null&&!this.props.addEndListener;if(!_||T){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var w=this.props.nodeRef?[this.nextCallback]:[_,this.nextCallback],C=w[0],O=w[1];this.props.addEndListener(C,O)}l!=null&&setTimeout(this.nextCallback,l)},i.render=function(){var l=this.state.status;if(l===Iw)return null;var p=this.props,_=p.children;p.in,p.mountOnEnter,p.unmountOnExit,p.appear,p.enter,p.exit,p.timeout,p.addEndListener,p.onEnter,p.onEntering,p.onEntered,p.onExit,p.onExiting,p.onExited,p.nodeRef;var T=Hoe(p,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return Ge.createElement(ZY.Provider,{value:null},typeof _=="function"?_(l,T):Ge.cloneElement(Ge.Children.only(_),T))},n}(Ge.Component);mp.contextType=ZY;mp.propTypes={};function _v(){}mp.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:_v,onEntering:_v,onEntered:_v,onExit:_v,onExiting:_v,onExited:_v};mp.UNMOUNTED=Iw;mp.EXITED=r_;mp.ENTERING=Vf;mp.ENTERED=c_;mp.EXITING=PM;function sce(a){return a.code==="Escape"||a.keyCode===27}function ace(){const a=F.version.split(".");return{major:+a[0],minor:+a[1],patch:+a[2]}}function ZO(a){if(!a||typeof a=="function")return null;const{major:n}=ace();return n>=19?a.props.ref:a.ref}const eS=!!(typeof window<"u"&&window.document&&window.document.createElement);var kM=!1,LM=!1;try{var IL={get passive(){return kM=!0},get once(){return LM=kM=!0}};eS&&(window.addEventListener("test",IL,IL),window.removeEventListener("test",IL,!0))}catch{}function eq(a,n,i,s){if(s&&typeof s!="boolean"&&!LM){var l=s.once,p=s.capture,_=i;!LM&&l&&(_=i.__once||function T(w){this.removeEventListener(n,T,p),i.call(this,w)},i.__once=_),a.addEventListener(n,_,kM?s:p)}a.addEventListener(n,i,s)}function MM(a,n,i,s){var l=s&&typeof s!="boolean"?s.capture:s;a.removeEventListener(n,i,l),i.__once&&a.removeEventListener(n,i.__once,l)}function lO(a,n,i,s){return eq(a,n,i,s),function(){MM(a,n,i,s)}}function oce(a,n,i,s){if(s===void 0&&(s=!0),a){var l=document.createEvent("HTMLEvents");l.initEvent(n,i,s),a.dispatchEvent(l)}}function cce(a){var n=E_(a,"transitionDuration")||"",i=n.indexOf("ms")===-1?1e3:1;return parseFloat(n)*i}function lce(a,n,i){i===void 0&&(i=5);var s=!1,l=setTimeout(function(){s||oce(a,"transitionend",!0)},n+i),p=lO(a,"transitionend",function(){s=!0},{once:!0});return function(){clearTimeout(l),p()}}function tq(a,n,i,s){i==null&&(i=cce(a)||0);var l=lce(a,i,s),p=lO(a,"transitionend",n);return function(){l(),p()}}function BW(a,n){const i=E_(a,n)||"",s=i.indexOf("ms")===-1?1e3:1;return parseFloat(i)*s}function dce(a,n){const i=BW(a,"transitionDuration"),s=BW(a,"transitionDelay"),l=tq(a,p=>{p.target===a&&(l(),n(p))},i+s)}function uce(a){a.offsetHeight}const HW=a=>!a||typeof a=="function"?a:n=>{a.current=n};function hce(a,n){const i=HW(a),s=HW(n);return l=>{i&&i(l),s&&s(l)}}function nq(a,n){return F.useMemo(()=>hce(a,n),[a,n])}function pce(a){return a&&"setState"in a?d_.findDOMNode(a):a??null}const fce=Ge.forwardRef(({onEnter:a,onEntering:n,onEntered:i,onExit:s,onExiting:l,onExited:p,addEndListener:_,children:T,childRef:w,...C},O)=>{const k=F.useRef(null),U=nq(k,w),Y=ve=>{U(pce(ve))},W=ve=>$=>{ve&&k.current&&ve(k.current,$)},ee=F.useCallback(W(a),[a]),K=F.useCallback(W(n),[n]),ie=F.useCallback(W(i),[i]),se=F.useCallback(W(s),[s]),ue=F.useCallback(W(l),[l]),ye=F.useCallback(W(p),[p]),ae=F.useCallback(W(_),[_]);return m.jsx(mp,{ref:O,...C,onEnter:ee,onEntered:ie,onEntering:K,onExit:se,onExited:ye,onExiting:ue,addEndListener:ae,nodeRef:k,children:typeof T=="function"?(ve,$)=>T(ve,{...$,ref:Y}):Ge.cloneElement(T,{ref:Y})})});function mce(a){const n=F.useRef(a);return F.useEffect(()=>{n.current=a},[a]),n}function jM(a){const n=mce(a);return F.useCallback(function(...i){return n.current&&n.current(...i)},[n])}const gce=a=>F.forwardRef((n,i)=>m.jsx("div",{...n,ref:i,className:gi(n.className,a)}));function _ce(a){const n=F.useRef(a);return F.useEffect(()=>{n.current=a},[a]),n}function l_(a){const n=_ce(a);return F.useCallback(function(...i){return n.current&&n.current(...i)},[n])}function Ece(){const a=F.useRef(!0),n=F.useRef(()=>a.current);return F.useEffect(()=>(a.current=!0,()=>{a.current=!1}),[]),n.current}function yce(a){const n=F.useRef(null);return F.useEffect(()=>{n.current=a}),n.current}const vce=typeof global<"u"&&global.navigator&&global.navigator.product==="ReactNative",Sce=typeof document<"u",GW=Sce||vce?F.useLayoutEffect:F.useEffect,Tce=["as","disabled"];function bce(a,n){if(a==null)return{};var i={};for(var s in a)if({}.hasOwnProperty.call(a,s)){if(n.indexOf(s)>=0)continue;i[s]=a[s]}return i}function wce(a){return!a||a.trim()==="#"}function rq({tagName:a,disabled:n,href:i,target:s,rel:l,role:p,onClick:_,tabIndex:T=0,type:w}){a||(i!=null||s!=null||l!=null?a="a":a="button");const C={tagName:a};if(a==="button")return[{type:w||"button",disabled:n},C];const O=U=>{if((n||a==="a"&&wce(i))&&U.preventDefault(),n){U.stopPropagation();return}_==null||_(U)},k=U=>{U.key===" "&&(U.preventDefault(),O(U))};return a==="a"&&(i||(i="#"),n&&(i=void 0)),[{role:p??"button",disabled:void 0,tabIndex:n?void 0:T,href:i,target:a==="a"?s:void 0,"aria-disabled":n||void 0,rel:a==="a"?l:void 0,onClick:O,onKeyDown:k},C]}const Rce=F.forwardRef((a,n)=>{let{as:i,disabled:s}=a,l=bce(a,Tce);const[p,{tagName:_}]=rq(Object.assign({tagName:i,disabled:s},l));return m.jsx(_,Object.assign({},l,p,{ref:n}))});Rce.displayName="Button";const Cce={[Vf]:"show",[c_]:"show"},F2=F.forwardRef(({className:a,children:n,transitionClasses:i={},onEnter:s,...l},p)=>{const _={in:!1,timeout:300,mountOnEnter:!1,unmountOnExit:!1,appear:!1,...l},T=F.useCallback((w,C)=>{uce(w),s==null||s(w,C)},[s]);return m.jsx(fce,{ref:p,addEndListener:dce,..._,onEnter:T,childRef:ZO(n),children:(w,C)=>F.cloneElement(n,{...C,className:gi("fade",a,n.props.className,Cce[w],i[w])})})});F2.displayName="Fade";const Ace={"aria-label":Jh.string,onClick:Jh.func,variant:Jh.oneOf(["white"])},B2=F.forwardRef(({className:a,variant:n,"aria-label":i="Close",...s},l)=>m.jsx("button",{ref:l,type:"button",className:gi("btn-close",n&&`btn-close-${n}`,a),"aria-label":i,...s}));B2.displayName="CloseButton";B2.propTypes=Ace;const Pi=F.forwardRef(({as:a,bsPrefix:n,variant:i="primary",size:s,active:l=!1,disabled:p=!1,className:_,...T},w)=>{const C=ys(n,"btn"),[O,{tagName:k}]=rq({tagName:a,disabled:p,...T}),U=k;return m.jsx(U,{...O,...T,ref:w,disabled:p,className:gi(_,C,l&&"active",i&&`${C}-${i}`,s&&`${C}-${s}`,T.href&&p&&"disabled")})});Pi.displayName="Button";function Ice(a){const n=F.useRef(a);return n.current=a,n}function Nce(a){const n=Ice(a);F.useEffect(()=>()=>n.current(),[])}function Oce(a,n){return F.Children.toArray(a).some(i=>F.isValidElement(i)&&i.type===n)}function Dce({as:a,bsPrefix:n,className:i,...s}){n=ys(n,"col");const l=$Y(),p=JY(),_=[],T=[];return l.forEach(w=>{const C=s[w];delete s[w];let O,k,U;typeof C=="object"&&C!=null?{span:O,offset:k,order:U}=C:O=C;const Y=w!==p?`-${w}`:"";O&&_.push(O===!0?`${n}${Y}`:`${n}${Y}-${O}`),U!=null&&T.push(`order${Y}-${U}`),k!=null&&T.push(`offset${Y}-${k}`)}),[{...s,className:gi(i,..._,...T)},{as:a,bsPrefix:n,spans:_}]}const dO=F.forwardRef((a,n)=>{const[{className:i,...s},{as:l="div",bsPrefix:p,spans:_}]=Dce(a);return m.jsx(l,{...s,ref:n,className:gi(i,!_.length&&p)})});dO.displayName="Col";const iq=F.forwardRef(({bsPrefix:a,fluid:n=!1,as:i="div",className:s,...l},p)=>{const _=ys(a,"container"),T=typeof n=="string"?`-${n}`:"-fluid";return m.jsx(i,{ref:p,...l,className:gi(s,n?`${_}${T}`:_)})});iq.displayName="Container";var xce=Function.prototype.bind.call(Function.prototype.call,[].slice);function Ev(a,n){return xce(a.querySelectorAll(n))}function WW(a,n){if(a.contains)return a.contains(n);if(a.compareDocumentPosition)return a===n||!!(a.compareDocumentPosition(n)&16)}const Pce="data-rr-ui-";function kce(a){return`${Pce}${a}`}const sq=F.createContext(eS?window:void 0);sq.Provider;function H2(){return F.useContext(sq)}const Lce={type:Jh.string,tooltip:Jh.bool,as:Jh.elementType},eD=F.forwardRef(({as:a="div",className:n,type:i="valid",tooltip:s=!1,...l},p)=>m.jsx(a,{...l,ref:p,className:gi(n,`${i}-${s?"tooltip":"feedback"}`)}));eD.displayName="Feedback";eD.propTypes=Lce;const cp=F.createContext({}),G2=F.forwardRef(({id:a,bsPrefix:n,className:i,type:s="checkbox",isValid:l=!1,isInvalid:p=!1,as:_="input",...T},w)=>{const{controlId:C}=F.useContext(cp);return n=ys(n,"form-check-input"),m.jsx(_,{...T,ref:w,type:s,id:a||C,className:gi(i,n,l&&"is-valid",p&&"is-invalid")})});G2.displayName="FormCheckInput";const uO=F.forwardRef(({bsPrefix:a,className:n,htmlFor:i,...s},l)=>{const{controlId:p}=F.useContext(cp);return a=ys(a,"form-check-label"),m.jsx("label",{...s,ref:l,htmlFor:i||p,className:gi(n,a)})});uO.displayName="FormCheckLabel";const aq=F.forwardRef(({id:a,bsPrefix:n,bsSwitchPrefix:i,inline:s=!1,reverse:l=!1,disabled:p=!1,isValid:_=!1,isInvalid:T=!1,feedbackTooltip:w=!1,feedback:C,feedbackType:O,className:k,style:U,title:Y="",type:W="checkbox",label:ee,children:K,as:ie="input",...se},ue)=>{n=ys(n,"form-check"),i=ys(i,"form-switch");const{controlId:ye}=F.useContext(cp),ae=F.useMemo(()=>({controlId:a||ye}),[ye,a]),ve=!K&&ee!=null&&ee!==!1||Oce(K,uO),$=m.jsx(G2,{...se,type:W==="switch"?"checkbox":W,ref:ue,isValid:_,isInvalid:T,disabled:p,as:ie});return m.jsx(cp.Provider,{value:ae,children:m.jsx("div",{style:U,className:gi(k,ve&&n,s&&`${n}-inline`,l&&`${n}-reverse`,W==="switch"&&i),children:K||m.jsxs(m.Fragment,{children:[$,ve&&m.jsx(uO,{title:Y,children:ee}),C&&m.jsx(eD,{type:O,tooltip:w,children:C})]})})})});aq.displayName="FormCheck";const hO=Object.assign(aq,{Input:G2,Label:uO}),oq=F.forwardRef(({bsPrefix:a,type:n,size:i,htmlSize:s,id:l,className:p,isValid:_=!1,isInvalid:T=!1,plaintext:w,readOnly:C,as:O="input",...k},U)=>{const{controlId:Y}=F.useContext(cp);return a=ys(a,"form-control"),m.jsx(O,{...k,type:n,size:s,ref:U,readOnly:C,id:l||Y,className:gi(p,w?`${a}-plaintext`:a,i&&`${a}-${i}`,n==="color"&&`${a}-color`,_&&"is-valid",T&&"is-invalid")})});oq.displayName="FormControl";const Mce=Object.assign(oq,{Feedback:eD}),cq=F.forwardRef(({className:a,bsPrefix:n,as:i="div",...s},l)=>(n=ys(n,"form-floating"),m.jsx(i,{ref:l,className:gi(a,n),...s})));cq.displayName="FormFloating";const W2=F.forwardRef(({controlId:a,as:n="div",...i},s)=>{const l=F.useMemo(()=>({controlId:a}),[a]);return m.jsx(cp.Provider,{value:l,children:m.jsx(n,{...i,ref:s})})});W2.displayName="FormGroup";const lq=F.forwardRef(({as:a="label",bsPrefix:n,column:i=!1,visuallyHidden:s=!1,className:l,htmlFor:p,..._},T)=>{const{controlId:w}=F.useContext(cp);n=ys(n,"form-label");let C="col-form-label";typeof i=="string"&&(C=`${C} ${C}-${i}`);const O=gi(l,n,s&&"visually-hidden",i&&C);return p=p||w,i?m.jsx(dO,{ref:T,as:"label",className:O,htmlFor:p,..._}):m.jsx(a,{ref:T,className:O,htmlFor:p,..._})});lq.displayName="FormLabel";const dq=F.forwardRef(({bsPrefix:a,className:n,id:i,...s},l)=>{const{controlId:p}=F.useContext(cp);return a=ys(a,"form-range"),m.jsx("input",{...s,type:"range",ref:l,className:gi(n,a),id:i||p})});dq.displayName="FormRange";const uq=F.forwardRef(({bsPrefix:a,size:n,htmlSize:i,className:s,isValid:l=!1,isInvalid:p=!1,id:_,...T},w)=>{const{controlId:C}=F.useContext(cp);return a=ys(a,"form-select"),m.jsx("select",{...T,size:i,ref:w,className:gi(s,a,n&&`${a}-${n}`,l&&"is-valid",p&&"is-invalid"),id:_||C})});uq.displayName="FormSelect";const hq=F.forwardRef(({bsPrefix:a,className:n,as:i="small",muted:s,...l},p)=>(a=ys(a,"form-text"),m.jsx(i,{...l,ref:p,className:gi(n,a,s&&"text-muted")})));hq.displayName="FormText";const pq=F.forwardRef((a,n)=>m.jsx(hO,{...a,ref:n,type:"switch"}));pq.displayName="Switch";const jce=Object.assign(pq,{Input:hO.Input,Label:hO.Label}),fq=F.forwardRef(({bsPrefix:a,className:n,children:i,controlId:s,label:l,...p},_)=>(a=ys(a,"form-floating"),m.jsxs(W2,{ref:_,className:gi(n,a),controlId:s,...p,children:[i,m.jsx("label",{htmlFor:s,children:l})]})));fq.displayName="FloatingLabel";const Uce={_ref:Jh.any,validated:Jh.bool,as:Jh.elementType},z2=F.forwardRef(({className:a,validated:n,as:i="form",...s},l)=>m.jsx(i,{...s,ref:l,className:gi(a,n&&"was-validated")}));z2.displayName="Form";z2.propTypes=Uce;const ot=Object.assign(z2,{Group:W2,Control:Mce,Floating:cq,Check:hO,Switch:jce,Label:lq,Text:hq,Range:dq,Select:uq,FloatingLabel:fq}),zW=a=>!a||typeof a=="function"?a:n=>{a.current=n};function Vce(a,n){const i=zW(a),s=zW(n);return l=>{i&&i(l),s&&s(l)}}function Y2(a,n){return F.useMemo(()=>Vce(a,n),[a,n])}var KI;function YW(a){if((!KI&&KI!==0||a)&&eS){var n=document.createElement("div");n.style.position="absolute",n.style.top="-9999px",n.style.width="50px",n.style.height="50px",n.style.overflow="scroll",document.body.appendChild(n),KI=n.offsetWidth-n.clientWidth,document.body.removeChild(n)}return KI}function Fce(){return F.useState(null)}function NL(a){a===void 0&&(a=JO());try{var n=a.activeElement;return!n||!n.nodeName?null:n}catch{return a.body}}function Bce(a){const n=F.useRef(a);return n.current=a,n}function Hce(a){const n=Bce(a);F.useEffect(()=>()=>n.current(),[])}function Gce(a=document){const n=a.defaultView;return Math.abs(n.innerWidth-a.documentElement.clientWidth)}const qW=kce("modal-open");class q2{constructor({ownerDocument:n,handleContainerOverflow:i=!0,isRTL:s=!1}={}){this.handleContainerOverflow=i,this.isRTL=s,this.modals=[],this.ownerDocument=n}getScrollbarWidth(){return Gce(this.ownerDocument)}getElement(){return(this.ownerDocument||document).body}setModalAttributes(n){}removeModalAttributes(n){}setContainerStyle(n){const i={overflow:"hidden"},s=this.isRTL?"paddingLeft":"paddingRight",l=this.getElement();n.style={overflow:l.style.overflow,[s]:l.style[s]},n.scrollBarWidth&&(i[s]=`${parseInt(E_(l,s)||"0",10)+n.scrollBarWidth}px`),l.setAttribute(qW,""),E_(l,i)}reset(){[...this.modals].forEach(n=>this.remove(n))}removeContainerStyle(n){const i=this.getElement();i.removeAttribute(qW),Object.assign(i.style,n.style)}add(n){let i=this.modals.indexOf(n);return i!==-1||(i=this.modals.length,this.modals.push(n),this.setModalAttributes(n),i!==0)||(this.state={scrollBarWidth:this.getScrollbarWidth(),style:{}},this.handleContainerOverflow&&this.setContainerStyle(this.state)),i}remove(n){const i=this.modals.indexOf(n);i!==-1&&(this.modals.splice(i,1),!this.modals.length&&this.handleContainerOverflow&&this.removeContainerStyle(this.state),this.removeModalAttributes(n))}isTopModal(n){return!!this.modals.length&&this.modals[this.modals.length-1]===n}}const OL=(a,n)=>eS?a==null?(n||JO()).body:(typeof a=="function"&&(a=a()),a&&"current"in a&&(a=a.current),a&&("nodeType"in a||a.getBoundingClientRect)?a:null):null;function Wce(a,n){const i=H2(),[s,l]=F.useState(()=>OL(a,i==null?void 0:i.document));if(!s){const p=OL(a);p&&l(p)}return F.useEffect(()=>{},[n,s]),F.useEffect(()=>{const p=OL(a);p!==s&&l(p)},[a,s]),s}function zce({children:a,in:n,onExited:i,mountOnEnter:s,unmountOnExit:l}){const p=F.useRef(null),_=F.useRef(n),T=l_(i);F.useEffect(()=>{n?_.current=!0:T(p.current)},[n,T]);const w=Y2(p,ZO(a)),C=F.cloneElement(a,{ref:w});return n?C:l||!_.current&&s?null:C}const Yce=["onEnter","onEntering","onEntered","onExit","onExiting","onExited","addEndListener","children"];function qce(a,n){if(a==null)return{};var i={};for(var s in a)if({}.hasOwnProperty.call(a,s)){if(n.indexOf(s)>=0)continue;i[s]=a[s]}return i}function Kce(a){let{onEnter:n,onEntering:i,onEntered:s,onExit:l,onExiting:p,onExited:_,addEndListener:T,children:w}=a,C=qce(a,Yce);const O=F.useRef(null),k=Y2(O,ZO(w)),U=ye=>ae=>{ye&&O.current&&ye(O.current,ae)},Y=F.useCallback(U(n),[n]),W=F.useCallback(U(i),[i]),ee=F.useCallback(U(s),[s]),K=F.useCallback(U(l),[l]),ie=F.useCallback(U(p),[p]),se=F.useCallback(U(_),[_]),ue=F.useCallback(U(T),[T]);return Object.assign({},C,{nodeRef:O},n&&{onEnter:Y},i&&{onEntering:W},s&&{onEntered:ee},l&&{onExit:K},p&&{onExiting:ie},_&&{onExited:se},T&&{addEndListener:ue},{children:typeof w=="function"?(ye,ae)=>w(ye,Object.assign({},ae,{ref:k})):F.cloneElement(w,{ref:k})})}const Xce=["component"];function Qce(a,n){if(a==null)return{};var i={};for(var s in a)if({}.hasOwnProperty.call(a,s)){if(n.indexOf(s)>=0)continue;i[s]=a[s]}return i}const $ce=F.forwardRef((a,n)=>{let{component:i}=a,s=Qce(a,Xce);const l=Kce(s);return m.jsx(i,Object.assign({ref:n},l))});function Jce({in:a,onTransition:n}){const i=F.useRef(null),s=F.useRef(!0),l=l_(n);return GW(()=>{if(!i.current)return;let p=!1;return l({in:a,element:i.current,initial:s.current,isStale:()=>p}),()=>{p=!0}},[a,l]),GW(()=>(s.current=!1,()=>{s.current=!0}),[]),i}function Zce({children:a,in:n,onExited:i,onEntered:s,transition:l}){const[p,_]=F.useState(!n);n&&p&&_(!1);const T=Jce({in:!!n,onTransition:C=>{const O=()=>{C.isStale()||(C.in?s==null||s(C.element,C.initial):(_(!0),i==null||i(C.element)))};Promise.resolve(l(C)).then(O,k=>{throw C.in||_(!0),k})}}),w=Y2(T,ZO(a));return p&&!n?null:F.cloneElement(a,{ref:w})}function KW(a,n,i){return a?m.jsx($ce,Object.assign({},i,{component:a})):n?m.jsx(Zce,Object.assign({},i,{transition:n})):m.jsx(zce,Object.assign({},i))}const ele=["show","role","className","style","children","backdrop","keyboard","onBackdropClick","onEscapeKeyDown","transition","runTransition","backdropTransition","runBackdropTransition","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","renderDialog","renderBackdrop","manager","container","onShow","onHide","onExit","onExited","onExiting","onEnter","onEntering","onEntered"];function tle(a,n){if(a==null)return{};var i={};for(var s in a)if({}.hasOwnProperty.call(a,s)){if(n.indexOf(s)>=0)continue;i[s]=a[s]}return i}let DL;function nle(a){return DL||(DL=new q2({ownerDocument:a==null?void 0:a.document})),DL}function rle(a){const n=H2(),i=a||nle(n),s=F.useRef({dialog:null,backdrop:null});return Object.assign(s.current,{add:()=>i.add(s.current),remove:()=>i.remove(s.current),isTopModal:()=>i.isTopModal(s.current),setDialogRef:F.useCallback(l=>{s.current.dialog=l},[]),setBackdropRef:F.useCallback(l=>{s.current.backdrop=l},[])})}const mq=F.forwardRef((a,n)=>{let{show:i=!1,role:s="dialog",className:l,style:p,children:_,backdrop:T=!0,keyboard:w=!0,onBackdropClick:C,onEscapeKeyDown:O,transition:k,runTransition:U,backdropTransition:Y,runBackdropTransition:W,autoFocus:ee=!0,enforceFocus:K=!0,restoreFocus:ie=!0,restoreFocusOptions:se,renderDialog:ue,renderBackdrop:ye=en=>m.jsx("div",Object.assign({},en)),manager:ae,container:ve,onShow:$,onHide:Q=()=>{},onExit:te,onExited:oe,onExiting:re,onEnter:fe,onEntering:pe,onEntered:Ne}=a,Je=tle(a,ele);const be=H2(),Ie=Wce(ve),Re=rle(ae),Me=Ece(),he=yce(i),[De,qe]=F.useState(!i),We=F.useRef(null);F.useImperativeHandle(n,()=>Re,[Re]),eS&&!he&&i&&(We.current=NL(be==null?void 0:be.document)),i&&De&&qe(!1);const Be=l_(()=>{if(Re.add(),Mt.current=lO(document,"keydown",ut),tn.current=lO(document,"focus",()=>setTimeout(St),!0),$&&$(),ee){var en,Dt;const mt=NL((en=(Dt=Re.dialog)==null?void 0:Dt.ownerDocument)!=null?en:be==null?void 0:be.document);Re.dialog&&mt&&!WW(Re.dialog,mt)&&(We.current=mt,Re.dialog.focus())}}),bt=l_(()=>{if(Re.remove(),Mt.current==null||Mt.current(),tn.current==null||tn.current(),ie){var en;(en=We.current)==null||en.focus==null||en.focus(se),We.current=null}});F.useEffect(()=>{!i||!Ie||Be()},[i,Ie,Be]),F.useEffect(()=>{De&&bt()},[De,bt]),Hce(()=>{bt()});const St=l_(()=>{if(!K||!Me()||!Re.isTopModal())return;const en=NL(be==null?void 0:be.document);Re.dialog&&en&&!WW(Re.dialog,en)&&Re.dialog.focus()}),Tt=l_(en=>{en.target===en.currentTarget&&(C==null||C(en),T===!0&&Q())}),ut=l_(en=>{w&&sce(en)&&Re.isTopModal()&&(O==null||O(en),en.defaultPrevented||Q())}),tn=F.useRef(),Mt=F.useRef(),wn=(...en)=>{qe(!0),oe==null||oe(...en)};if(!Ie)return null;const Yt=Object.assign({role:s,ref:Re.setDialogRef,"aria-modal":s==="dialog"?!0:void 0},Je,{style:p,className:l,tabIndex:-1});let Xn=ue?ue(Yt):m.jsx("div",Object.assign({},Yt,{children:F.cloneElement(_,{role:"document"})}));Xn=KW(k,U,{unmountOnExit:!0,mountOnEnter:!0,appear:!0,in:!!i,onExit:te,onExiting:re,onExited:wn,onEnter:fe,onEntering:pe,onEntered:Ne,children:Xn});let Ot=null;return T&&(Ot=ye({ref:Re.setBackdropRef,onClick:Tt}),Ot=KW(Y,W,{in:!!i,appear:!0,mountOnEnter:!0,unmountOnExit:!0,children:Ot})),m.jsx(m.Fragment,{children:d_.createPortal(m.jsxs(m.Fragment,{children:[Ot,Xn]}),Ie)})});mq.displayName="Modal";const ile=Object.assign(mq,{Manager:q2});function sle(a,n){return a.classList?a.classList.contains(n):(" "+(a.className.baseVal||a.className)+" ").indexOf(" "+n+" ")!==-1}function ale(a,n){a.classList?a.classList.add(n):sle(a,n)||(typeof a.className=="string"?a.className=a.className+" "+n:a.setAttribute("class",(a.className&&a.className.baseVal||"")+" "+n))}function XW(a,n){return a.replace(new RegExp("(^|\\s)"+n+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function ole(a,n){a.classList?a.classList.remove(n):typeof a.className=="string"?a.className=XW(a.className,n):a.setAttribute("class",XW(a.className&&a.className.baseVal||"",n))}const yv={FIXED_CONTENT:".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",STICKY_CONTENT:".sticky-top",NAVBAR_TOGGLER:".navbar-toggler"};class cle extends q2{adjustAndStore(n,i,s){const l=i.style[n];i.dataset[n]=l,E_(i,{[n]:`${parseFloat(E_(i,n))+s}px`})}restore(n,i){const s=i.dataset[n];s!==void 0&&(delete i.dataset[n],E_(i,{[n]:s}))}setContainerStyle(n){super.setContainerStyle(n);const i=this.getElement();if(ale(i,"modal-open"),!n.scrollBarWidth)return;const s=this.isRTL?"paddingLeft":"paddingRight",l=this.isRTL?"marginLeft":"marginRight";Ev(i,yv.FIXED_CONTENT).forEach(p=>this.adjustAndStore(s,p,n.scrollBarWidth)),Ev(i,yv.STICKY_CONTENT).forEach(p=>this.adjustAndStore(l,p,-n.scrollBarWidth)),Ev(i,yv.NAVBAR_TOGGLER).forEach(p=>this.adjustAndStore(l,p,n.scrollBarWidth))}removeContainerStyle(n){super.removeContainerStyle(n);const i=this.getElement();ole(i,"modal-open");const s=this.isRTL?"paddingLeft":"paddingRight",l=this.isRTL?"marginLeft":"marginRight";Ev(i,yv.FIXED_CONTENT).forEach(p=>this.restore(s,p)),Ev(i,yv.STICKY_CONTENT).forEach(p=>this.restore(l,p)),Ev(i,yv.NAVBAR_TOGGLER).forEach(p=>this.restore(l,p))}}let xL;function lle(a){return xL||(xL=new cle(a)),xL}const gq=F.forwardRef(({className:a,bsPrefix:n,as:i="div",...s},l)=>(n=ys(n,"modal-body"),m.jsx(i,{ref:l,className:gi(a,n),...s})));gq.displayName="ModalBody";const _q=F.createContext({onHide(){}}),K2=F.forwardRef(({bsPrefix:a,className:n,contentClassName:i,centered:s,size:l,fullscreen:p,children:_,scrollable:T,...w},C)=>{a=ys(a,"modal");const O=`${a}-dialog`,k=typeof p=="string"?`${a}-fullscreen-${p}`:`${a}-fullscreen`;return m.jsx("div",{...w,ref:C,className:gi(O,n,l&&`${a}-${l}`,s&&`${O}-centered`,T&&`${O}-scrollable`,p&&k),children:m.jsx("div",{className:gi(`${a}-content`,i),children:_})})});K2.displayName="ModalDialog";const Eq=F.forwardRef(({className:a,bsPrefix:n,as:i="div",...s},l)=>(n=ys(n,"modal-footer"),m.jsx(i,{ref:l,className:gi(a,n),...s})));Eq.displayName="ModalFooter";const dle=F.forwardRef(({closeLabel:a="Close",closeVariant:n,closeButton:i=!1,onHide:s,children:l,...p},_)=>{const T=F.useContext(_q),w=jM(()=>{T==null||T.onHide(),s==null||s()});return m.jsxs("div",{ref:_,...p,children:[l,i&&m.jsx(B2,{"aria-label":a,variant:n,onClick:w})]})}),yq=F.forwardRef(({bsPrefix:a,className:n,closeLabel:i="Close",closeButton:s=!1,...l},p)=>(a=ys(a,"modal-header"),m.jsx(dle,{ref:p,...l,className:gi(n,a),closeLabel:i,closeButton:s})));yq.displayName="ModalHeader";const ule=gce("h4"),vq=F.forwardRef(({className:a,bsPrefix:n,as:i=ule,...s},l)=>(n=ys(n,"modal-title"),m.jsx(i,{ref:l,className:gi(a,n),...s})));vq.displayName="ModalTitle";function hle(a){return m.jsx(F2,{...a,timeout:null})}function ple(a){return m.jsx(F2,{...a,timeout:null})}const Sq=F.forwardRef(({bsPrefix:a,className:n,style:i,dialogClassName:s,contentClassName:l,children:p,dialogAs:_=K2,"data-bs-theme":T,"aria-labelledby":w,"aria-describedby":C,"aria-label":O,show:k=!1,animation:U=!0,backdrop:Y=!0,keyboard:W=!0,onEscapeKeyDown:ee,onShow:K,onHide:ie,container:se,autoFocus:ue=!0,enforceFocus:ye=!0,restoreFocus:ae=!0,restoreFocusOptions:ve,onEntered:$,onExit:Q,onExiting:te,onEnter:oe,onEntering:re,onExited:fe,backdropClassName:pe,manager:Ne,...Je},be)=>{const[Ie,Re]=F.useState({}),[Me,he]=F.useState(!1),De=F.useRef(!1),qe=F.useRef(!1),We=F.useRef(null),[Be,bt]=Fce(),St=nq(be,bt),Tt=jM(ie),ut=Yoe();a=ys(a,"modal");const tn=F.useMemo(()=>({onHide:Tt}),[Tt]);function Mt(){return Ne||lle({isRTL:ut})}function wn(Ht){if(!eS)return;const sn=Mt().getScrollbarWidth()>0,wt=Ht.scrollHeight>JO(Ht).documentElement.clientHeight;Re({paddingRight:sn&&!wt?YW():void 0,paddingLeft:!sn&&wt?YW():void 0})}const Yt=jM(()=>{Be&&wn(Be.dialog)});Nce(()=>{MM(window,"resize",Yt),We.current==null||We.current()});const Xn=()=>{De.current=!0},Ot=Ht=>{De.current&&Be&&Ht.target===Be.dialog&&(qe.current=!0),De.current=!1},en=()=>{he(!0),We.current=tq(Be.dialog,()=>{he(!1)})},Dt=Ht=>{Ht.target===Ht.currentTarget&&en()},mt=Ht=>{if(Y==="static"){Dt(Ht);return}if(qe.current||Ht.target!==Ht.currentTarget){qe.current=!1;return}ie==null||ie()},kt=Ht=>{W?ee==null||ee(Ht):(Ht.preventDefault(),Y==="static"&&en())},Gt=(Ht,sn)=>{Ht&&wn(Ht),oe==null||oe(Ht,sn)},Mn=Ht=>{We.current==null||We.current(),Q==null||Q(Ht)},Ci=(Ht,sn)=>{re==null||re(Ht,sn),eq(window,"resize",Yt)},bs=Ht=>{Ht&&(Ht.style.display=""),fe==null||fe(Ht),MM(window,"resize",Yt)},Rr=F.useCallback(Ht=>m.jsx("div",{...Ht,className:gi(`${a}-backdrop`,pe,!U&&"show")}),[U,pe,a]),kn={...i,...Ie};kn.display="block";const Mi=Ht=>m.jsx("div",{role:"dialog",...Ht,style:kn,className:gi(n,a,Me&&`${a}-static`,!U&&"show"),onClick:Y?mt:void 0,onMouseUp:Ot,"data-bs-theme":T,"aria-label":O,"aria-labelledby":w,"aria-describedby":C,children:m.jsx(_,{...Je,onMouseDown:Xn,className:s,contentClassName:l,children:p})});return m.jsx(_q.Provider,{value:tn,children:m.jsx(ile,{show:k,ref:St,backdrop:Y,container:se,keyboard:!0,autoFocus:ue,enforceFocus:ye,restoreFocus:ae,restoreFocusOptions:ve,onEscapeKeyDown:kt,onShow:K,onHide:ie,onEnter:Gt,onEntering:Ci,onEntered:$,onExit:Mn,onExiting:te,onExited:bs,manager:Mt(),transition:U?hle:void 0,backdropTransition:U?ple:void 0,renderBackdrop:Rr,renderDialog:Mi})})});Sq.displayName="Modal";const bn=Object.assign(Sq,{Body:gq,Header:yq,Title:vq,Footer:Eq,Dialog:K2,TRANSITION_DURATION:300,BACKDROP_TRANSITION_DURATION:150}),UM=F.forwardRef(({bsPrefix:a,className:n,as:i="div",...s},l)=>{const p=ys(a,"row"),_=$Y(),T=JY(),w=`${p}-cols`,C=[];return _.forEach(O=>{const k=s[O];delete s[O];let U;k!=null&&typeof k=="object"?{cols:U}=k:U=k;const Y=O!==T?`-${O}`:"";U!=null&&C.push(`${w}${Y}-${U}`)}),m.jsx(i,{ref:l,...s,className:gi(n,p,...C)})});UM.displayName="Row";const Tq=F.forwardRef(({bsPrefix:a,className:n,striped:i,bordered:s,borderless:l,hover:p,size:_,variant:T,responsive:w,...C},O)=>{const k=ys(a,"table"),U=gi(n,k,T&&`${k}-${T}`,_&&`${k}-${_}`,i&&`${k}-${typeof i=="string"?`striped-${i}`:"striped"}`,s&&`${k}-bordered`,l&&`${k}-borderless`,p&&`${k}-hover`),Y=m.jsx("table",{...C,className:U,ref:O});if(w){let W=`${k}-responsive`;return typeof w=="string"&&(W=`${W}-${w}`),m.jsx("div",{className:W,children:Y})}return Y});var PL={exports:{}},kL={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QW;function fle(){if(QW)return kL;QW=1;var a=XO();function n(w,C){return w===C&&(w!==0||1/w===1/C)||w!==w&&C!==C}var i=typeof Object.is=="function"?Object.is:n,s=a.useSyncExternalStore,l=a.useRef,p=a.useEffect,_=a.useMemo,T=a.useDebugValue;return kL.useSyncExternalStoreWithSelector=function(w,C,O,k,U){var Y=l(null);if(Y.current===null){var W={hasValue:!1,value:null};Y.current=W}else W=Y.current;Y=_(function(){function K(ae){if(!ie){if(ie=!0,se=ae,ae=k(ae),U!==void 0&&W.hasValue){var ve=W.value;if(U(ve,ae))return ue=ve}return ue=ae}if(ve=ue,i(se,ae))return ve;var $=k(ae);return U!==void 0&&U(ve,$)?(se=ae,ve):(se=ae,ue=$)}var ie=!1,se,ue,ye=O===void 0?null:O;return[function(){return K(C())},ye===null?void 0:function(){return K(ye())}]},[C,O,k,U]);var ee=s(w,Y[0],Y[1]);return p(function(){W.hasValue=!0,W.value=ee},[ee]),T(ee),ee},kL}var $W;function mle(){return $W||($W=1,PL.exports=fle()),PL.exports}var gle=mle();function _le(a){a()}function Ele(){let a=null,n=null;return{clear(){a=null,n=null},notify(){_le(()=>{let i=a;for(;i;)i.callback(),i=i.next})},get(){const i=[];let s=a;for(;s;)i.push(s),s=s.next;return i},subscribe(i){let s=!0;const l=n={callback:i,next:null,prev:n};return l.prev?l.prev.next=l:a=l,function(){!s||a===null||(s=!1,l.next?l.next.prev=l.prev:n=l.prev,l.prev?l.prev.next=l.next:a=l.next)}}}}var JW={notify(){},get:()=>[]};function yle(a,n){let i,s=JW,l=0,p=!1;function _(ee){O();const K=s.subscribe(ee);let ie=!1;return()=>{ie||(ie=!0,K(),k())}}function T(){s.notify()}function w(){W.onStateChange&&W.onStateChange()}function C(){return p}function O(){l++,i||(i=a.subscribe(w),s=Ele())}function k(){l--,i&&l===0&&(i(),i=void 0,s.clear(),s=JW)}function U(){p||(p=!0,O())}function Y(){p&&(p=!1,k())}const W={addNestedSub:_,notifyNestedSubs:T,handleChangeWrapper:w,isSubscribed:C,trySubscribe:U,tryUnsubscribe:Y,getListeners:()=>s};return W}var vle=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Sle=vle(),Tle=()=>typeof navigator<"u"&&navigator.product==="ReactNative",ble=Tle(),wle=()=>Sle||ble?F.useLayoutEffect:F.useEffect,Rle=wle(),LL=Symbol.for("react-redux-context"),ML=typeof globalThis<"u"?globalThis:{};function Cle(){if(!F.createContext)return{};const a=ML[LL]??(ML[LL]=new Map);let n=a.get(F.createContext);return n||(n=F.createContext(null),a.set(F.createContext,n)),n}var Qf=Cle();function Ale(a){const{children:n,context:i,serverState:s,store:l}=a,p=F.useMemo(()=>{const w=yle(l);return{store:l,subscription:w,getServerState:s?()=>s:void 0}},[l,s]),_=F.useMemo(()=>l.getState(),[l]);Rle(()=>{const{subscription:w}=p;return w.onStateChange=w.notifyNestedSubs,w.trySubscribe(),_!==l.getState()&&w.notifyNestedSubs(),()=>{w.tryUnsubscribe(),w.onStateChange=void 0}},[p,_]);const T=i||Qf;return F.createElement(T.Provider,{value:p},n)}var Ile=Ale;function X2(a=Qf){return function(){return F.useContext(a)}}var bq=X2();function wq(a=Qf){const n=a===Qf?bq:X2(a),i=()=>{const{store:s}=n();return s};return Object.assign(i,{withTypes:()=>i}),i}var Nle=wq();function Ole(a=Qf){const n=a===Qf?Nle:wq(a),i=()=>n().dispatch;return Object.assign(i,{withTypes:()=>i}),i}var Li=Ole(),Dle=(a,n)=>a===n;function xle(a=Qf){const n=a===Qf?bq:X2(a),i=(s,l={})=>{const{equalityFn:p=Dle}=typeof l=="function"?{equalityFn:l}:l,_=n(),{store:T,subscription:w,getServerState:C}=_;F.useRef(!0);const O=F.useCallback({[s.name](U){return s(U)}}[s.name],[s]),k=gle.useSyncExternalStoreWithSelector(w.addNestedSub,T.getState,C||T.getState,O,p);return F.useDebugValue(k),k};return Object.assign(i,{withTypes:()=>i}),i}var Tr=xle();function Va(a){return`Minified Redux error #${a}; visit https://redux.js.org/Errors?code=${a} for the full message or use the non-minified dev environment for full errors. `}var Ple=typeof Symbol=="function"&&Symbol.observable||"@@observable",ZW=Ple,jL=()=>Math.random().toString(36).substring(7).split("").join("."),kle={INIT:`@@redux/INIT${jL()}`,REPLACE:`@@redux/REPLACE${jL()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${jL()}`},pO=kle;function Q2(a){if(typeof a!="object"||a===null)return!1;let n=a;for(;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return Object.getPrototypeOf(a)===n||Object.getPrototypeOf(a)===null}function Rq(a,n,i){if(typeof a!="function")throw new Error(Va(2));if(typeof n=="function"&&typeof i=="function"||typeof i=="function"&&typeof arguments[3]=="function")throw new Error(Va(0));if(typeof n=="function"&&typeof i>"u"&&(i=n,n=void 0),typeof i<"u"){if(typeof i!="function")throw new Error(Va(1));return i(Rq)(a,n)}let s=a,l=n,p=new Map,_=p,T=0,w=!1;function C(){_===p&&(_=new Map,p.forEach((K,ie)=>{_.set(ie,K)}))}function O(){if(w)throw new Error(Va(3));return l}function k(K){if(typeof K!="function")throw new Error(Va(4));if(w)throw new Error(Va(5));let ie=!0;C();const se=T++;return _.set(se,K),function(){if(ie){if(w)throw new Error(Va(6));ie=!1,C(),_.delete(se),p=null}}}function U(K){if(!Q2(K))throw new Error(Va(7));if(typeof K.type>"u")throw new Error(Va(8));if(typeof K.type!="string")throw new Error(Va(17));if(w)throw new Error(Va(9));try{w=!0,l=s(l,K)}finally{w=!1}return(p=_).forEach(se=>{se()}),K}function Y(K){if(typeof K!="function")throw new Error(Va(10));s=K,U({type:pO.REPLACE})}function W(){const K=k;return{subscribe(ie){if(typeof ie!="object"||ie===null)throw new Error(Va(11));function se(){const ye=ie;ye.next&&ye.next(O())}return se(),{unsubscribe:K(se)}},[ZW](){return this}}}return U({type:pO.INIT}),{dispatch:U,subscribe:k,getState:O,replaceReducer:Y,[ZW]:W}}function Lle(a){Object.keys(a).forEach(n=>{const i=a[n];if(typeof i(void 0,{type:pO.INIT})>"u")throw new Error(Va(12));if(typeof i(void 0,{type:pO.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Va(13))})}function Mle(a){const n=Object.keys(a),i={};for(let p=0;p<n.length;p++){const _=n[p];typeof a[_]=="function"&&(i[_]=a[_])}const s=Object.keys(i);let l;try{Lle(i)}catch(p){l=p}return function(_={},T){if(l)throw l;let w=!1;const C={};for(let O=0;O<s.length;O++){const k=s[O],U=i[k],Y=_[k],W=U(Y,T);if(typeof W>"u")throw T&&T.type,new Error(Va(14));C[k]=W,w=w||W!==Y}return w=w||s.length!==Object.keys(_).length,w?C:_}}function fO(...a){return a.length===0?n=>n:a.length===1?a[0]:a.reduce((n,i)=>(...s)=>n(i(...s)))}function jle(...a){return n=>(i,s)=>{const l=n(i,s);let p=()=>{throw new Error(Va(15))};const _={getState:l.getState,dispatch:(w,...C)=>p(w,...C)},T=a.map(w=>w(_));return p=fO(...T)(l.dispatch),{...l,dispatch:p}}}function Ule(a){return Q2(a)&&"type"in a&&typeof a.type=="string"}var Cq=Symbol.for("immer-nothing"),e8=Symbol.for("immer-draftable"),Bc=Symbol.for("immer-state");function vd(a,...n){throw new Error(`[Immer] minified error nr: ${a}. Full error at: https://bit.ly/3cXEKWf`)}var Lv=Object.getPrototypeOf;function C_(a){return!!a&&!!a[Bc]}function lp(a){var n;return a?Aq(a)||Array.isArray(a)||!!a[e8]||!!((n=a.constructor)!=null&&n[e8])||nD(a)||rD(a):!1}var Vle=Object.prototype.constructor.toString();function Aq(a){if(!a||typeof a!="object")return!1;const n=Lv(a);if(n===null)return!0;const i=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return i===Object?!0:typeof i=="function"&&Function.toString.call(i)===Vle}function mO(a,n){tD(a)===0?Reflect.ownKeys(a).forEach(i=>{n(i,a[i],a)}):a.forEach((i,s)=>n(s,i,a))}function tD(a){const n=a[Bc];return n?n.type_:Array.isArray(a)?1:nD(a)?2:rD(a)?3:0}function VM(a,n){return tD(a)===2?a.has(n):Object.prototype.hasOwnProperty.call(a,n)}function Iq(a,n,i){const s=tD(a);s===2?a.set(n,i):s===3?a.add(i):a[n]=i}function Fle(a,n){return a===n?a!==0||1/a===1/n:a!==a&&n!==n}function nD(a){return a instanceof Map}function rD(a){return a instanceof Set}function i_(a){return a.copy_||a.base_}function FM(a,n){if(nD(a))return new Map(a);if(rD(a))return new Set(a);if(Array.isArray(a))return Array.prototype.slice.call(a);const i=Aq(a);if(n===!0||n==="class_only"&&!i){const s=Object.getOwnPropertyDescriptors(a);delete s[Bc];let l=Reflect.ownKeys(s);for(let p=0;p<l.length;p++){const _=l[p],T=s[_];T.writable===!1&&(T.writable=!0,T.configurable=!0),(T.get||T.set)&&(s[_]={configurable:!0,writable:!0,enumerable:T.enumerable,value:a[_]})}return Object.create(Lv(a),s)}else{const s=Lv(a);if(s!==null&&i)return{...a};const l=Object.create(s);return Object.assign(l,a)}}function $2(a,n=!1){return iD(a)||C_(a)||!lp(a)||(tD(a)>1&&(a.set=a.add=a.clear=a.delete=Ble),Object.freeze(a),n&&Object.entries(a).forEach(([i,s])=>$2(s,!0))),a}function Ble(){vd(2)}function iD(a){return Object.isFrozen(a)}var Hle={};function A_(a){const n=Hle[a];return n||vd(0,a),n}var Jw;function Nq(){return Jw}function Gle(a,n){return{drafts_:[],parent_:a,immer_:n,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function t8(a,n){n&&(A_("Patches"),a.patches_=[],a.inversePatches_=[],a.patchListener_=n)}function BM(a){HM(a),a.drafts_.forEach(Wle),a.drafts_=null}function HM(a){a===Jw&&(Jw=a.parent_)}function n8(a){return Jw=Gle(Jw,a)}function Wle(a){const n=a[Bc];n.type_===0||n.type_===1?n.revoke_():n.revoked_=!0}function r8(a,n){n.unfinalizedDrafts_=n.drafts_.length;const i=n.drafts_[0];return a!==void 0&&a!==i?(i[Bc].modified_&&(BM(n),vd(4)),lp(a)&&(a=gO(n,a),n.parent_||_O(n,a)),n.patches_&&A_("Patches").generateReplacementPatches_(i[Bc].base_,a,n.patches_,n.inversePatches_)):a=gO(n,i,[]),BM(n),n.patches_&&n.patchListener_(n.patches_,n.inversePatches_),a!==Cq?a:void 0}function gO(a,n,i){if(iD(n))return n;const s=n[Bc];if(!s)return mO(n,(l,p)=>i8(a,s,n,l,p,i)),n;if(s.scope_!==a)return n;if(!s.modified_)return _O(a,s.base_,!0),s.base_;if(!s.finalized_){s.finalized_=!0,s.scope_.unfinalizedDrafts_--;const l=s.copy_;let p=l,_=!1;s.type_===3&&(p=new Set(l),l.clear(),_=!0),mO(p,(T,w)=>i8(a,s,l,T,w,i,_)),_O(a,l,!1),i&&a.patches_&&A_("Patches").generatePatches_(s,i,a.patches_,a.inversePatches_)}return s.copy_}function i8(a,n,i,s,l,p,_){if(C_(l)){const T=p&&n&&n.type_!==3&&!VM(n.assigned_,s)?p.concat(s):void 0,w=gO(a,l,T);if(Iq(i,s,w),C_(w))a.canAutoFreeze_=!1;else return}else _&&i.add(l);if(lp(l)&&!iD(l)){if(!a.immer_.autoFreeze_&&a.unfinalizedDrafts_<1)return;gO(a,l),(!n||!n.scope_.parent_)&&typeof s!="symbol"&&Object.prototype.propertyIsEnumerable.call(i,s)&&_O(a,l)}}function _O(a,n,i=!1){!a.parent_&&a.immer_.autoFreeze_&&a.canAutoFreeze_&&$2(n,i)}function zle(a,n){const i=Array.isArray(a),s={type_:i?1:0,scope_:n?n.scope_:Nq(),modified_:!1,finalized_:!1,assigned_:{},parent_:n,base_:a,draft_:null,copy_:null,revoke_:null,isManual_:!1};let l=s,p=J2;i&&(l=[s],p=Zw);const{revoke:_,proxy:T}=Proxy.revocable(l,p);return s.draft_=T,s.revoke_=_,T}var J2={get(a,n){if(n===Bc)return a;const i=i_(a);if(!VM(i,n))return Yle(a,i,n);const s=i[n];return a.finalized_||!lp(s)?s:s===UL(a.base_,n)?(VL(a),a.copy_[n]=WM(s,a)):s},has(a,n){return n in i_(a)},ownKeys(a){return Reflect.ownKeys(i_(a))},set(a,n,i){const s=Oq(i_(a),n);if(s!=null&&s.set)return s.set.call(a.draft_,i),!0;if(!a.modified_){const l=UL(i_(a),n),p=l==null?void 0:l[Bc];if(p&&p.base_===i)return a.copy_[n]=i,a.assigned_[n]=!1,!0;if(Fle(i,l)&&(i!==void 0||VM(a.base_,n)))return!0;VL(a),GM(a)}return a.copy_[n]===i&&(i!==void 0||n in a.copy_)||Number.isNaN(i)&&Number.isNaN(a.copy_[n])||(a.copy_[n]=i,a.assigned_[n]=!0),!0},deleteProperty(a,n){return UL(a.base_,n)!==void 0||n in a.base_?(a.assigned_[n]=!1,VL(a),GM(a)):delete a.assigned_[n],a.copy_&&delete a.copy_[n],!0},getOwnPropertyDescriptor(a,n){const i=i_(a),s=Reflect.getOwnPropertyDescriptor(i,n);return s&&{writable:!0,configurable:a.type_!==1||n!=="length",enumerable:s.enumerable,value:i[n]}},defineProperty(){vd(11)},getPrototypeOf(a){return Lv(a.base_)},setPrototypeOf(){vd(12)}},Zw={};mO(J2,(a,n)=>{Zw[a]=function(){return arguments[0]=arguments[0][0],n.apply(this,arguments)}});Zw.deleteProperty=function(a,n){return Zw.set.call(this,a,n,void 0)};Zw.set=function(a,n,i){return J2.set.call(this,a[0],n,i,a[0])};function UL(a,n){const i=a[Bc];return(i?i_(i):a)[n]}function Yle(a,n,i){var l;const s=Oq(n,i);return s?"value"in s?s.value:(l=s.get)==null?void 0:l.call(a.draft_):void 0}function Oq(a,n){if(!(n in a))return;let i=Lv(a);for(;i;){const s=Object.getOwnPropertyDescriptor(i,n);if(s)return s;i=Lv(i)}}function GM(a){a.modified_||(a.modified_=!0,a.parent_&&GM(a.parent_))}function VL(a){a.copy_||(a.copy_=FM(a.base_,a.scope_.immer_.useStrictShallowCopy_))}var qle=class{constructor(a){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(n,i,s)=>{if(typeof n=="function"&&typeof i!="function"){const p=i;i=n;const _=this;return function(w=p,...C){return _.produce(w,O=>i.call(this,O,...C))}}typeof i!="function"&&vd(6),s!==void 0&&typeof s!="function"&&vd(7);let l;if(lp(n)){const p=n8(this),_=WM(n,void 0);let T=!0;try{l=i(_),T=!1}finally{T?BM(p):HM(p)}return t8(p,s),r8(l,p)}else if(!n||typeof n!="object"){if(l=i(n),l===void 0&&(l=n),l===Cq&&(l=void 0),this.autoFreeze_&&$2(l,!0),s){const p=[],_=[];A_("Patches").generateReplacementPatches_(n,l,p,_),s(p,_)}return l}else vd(1,n)},this.produceWithPatches=(n,i)=>{if(typeof n=="function")return(_,...T)=>this.produceWithPatches(_,w=>n(w,...T));let s,l;return[this.produce(n,i,(_,T)=>{s=_,l=T}),s,l]},typeof(a==null?void 0:a.autoFreeze)=="boolean"&&this.setAutoFreeze(a.autoFreeze),typeof(a==null?void 0:a.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(a.useStrictShallowCopy)}createDraft(a){lp(a)||vd(8),C_(a)&&(a=Kle(a));const n=n8(this),i=WM(a,void 0);return i[Bc].isManual_=!0,HM(n),i}finishDraft(a,n){const i=a&&a[Bc];(!i||!i.isManual_)&&vd(9);const{scope_:s}=i;return t8(s,n),r8(void 0,s)}setAutoFreeze(a){this.autoFreeze_=a}setUseStrictShallowCopy(a){this.useStrictShallowCopy_=a}applyPatches(a,n){let i;for(i=n.length-1;i>=0;i--){const l=n[i];if(l.path.length===0&&l.op==="replace"){a=l.value;break}}i>-1&&(n=n.slice(i+1));const s=A_("Patches").applyPatches_;return C_(a)?s(a,n):this.produce(a,l=>s(l,n))}};function WM(a,n){const i=nD(a)?A_("MapSet").proxyMap_(a,n):rD(a)?A_("MapSet").proxySet_(a,n):zle(a,n);return(n?n.scope_:Nq()).drafts_.push(i),i}function Kle(a){return C_(a)||vd(10,a),Dq(a)}function Dq(a){if(!lp(a)||iD(a))return a;const n=a[Bc];let i;if(n){if(!n.modified_)return n.base_;n.finalized_=!0,i=FM(a,n.scope_.immer_.useStrictShallowCopy_)}else i=FM(a,!0);return mO(i,(s,l)=>{Iq(i,s,Dq(l))}),n&&(n.finalized_=!1),i}var Hc=new qle,xq=Hc.produce;Hc.produceWithPatches.bind(Hc);Hc.setAutoFreeze.bind(Hc);Hc.setUseStrictShallowCopy.bind(Hc);Hc.applyPatches.bind(Hc);Hc.createDraft.bind(Hc);Hc.finishDraft.bind(Hc);function Pq(a){return({dispatch:i,getState:s})=>l=>p=>typeof p=="function"?p(i,s,a):l(p)}var Xle=Pq(),Qle=Pq,$le=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?fO:fO.apply(null,arguments)},Jle=a=>a&&typeof a.match=="function";function jw(a,n){function i(...s){if(n){let l=n(...s);if(!l)throw new Error(Zh(0));return{type:a,payload:l.payload,..."meta"in l&&{meta:l.meta},..."error"in l&&{error:l.error}}}return{type:a,payload:s[0]}}return i.toString=()=>`${a}`,i.type=a,i.match=s=>Ule(s)&&s.type===a,i}var kq=class Nw extends Array{constructor(...n){super(...n),Object.setPrototypeOf(this,Nw.prototype)}static get[Symbol.species](){return Nw}concat(...n){return super.concat.apply(this,n)}prepend(...n){return n.length===1&&Array.isArray(n[0])?new Nw(...n[0].concat(this)):new Nw(...n.concat(this))}};function s8(a){return lp(a)?xq(a,()=>{}):a}function XI(a,n,i){return a.has(n)?a.get(n):a.set(n,i(n)).get(n)}function Zle(a){return typeof a=="boolean"}var ede=()=>function(n){const{thunk:i=!0,immutableCheck:s=!0,serializableCheck:l=!0,actionCreatorCheck:p=!0}=n??{};let _=new kq;return i&&(Zle(i)?_.push(Xle):_.push(Qle(i.extraArgument))),_},tde="RTK_autoBatch",a8=a=>n=>{setTimeout(n,a)},nde=(a={type:"raf"})=>n=>(...i)=>{const s=n(...i);let l=!0,p=!1,_=!1;const T=new Set,w=a.type==="tick"?queueMicrotask:a.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:a8(10):a.type==="callback"?a.queueNotification:a8(a.timeout),C=()=>{_=!1,p&&(p=!1,T.forEach(O=>O()))};return Object.assign({},s,{subscribe(O){const k=()=>l&&O(),U=s.subscribe(k);return T.add(O),()=>{U(),T.delete(O)}},dispatch(O){var k;try{return l=!((k=O==null?void 0:O.meta)!=null&&k[tde]),p=!l,p&&(_||(_=!0,w(C))),s.dispatch(O)}finally{l=!0}}})},rde=a=>function(i){const{autoBatch:s=!0}=i??{};let l=new kq(a);return s&&l.push(nde(typeof s=="object"?s:void 0)),l};function ide(a){const n=ede(),{reducer:i=void 0,middleware:s,devTools:l=!0,preloadedState:p=void 0,enhancers:_=void 0}=a||{};let T;if(typeof i=="function")T=i;else if(Q2(i))T=Mle(i);else throw new Error(Zh(1));let w;typeof s=="function"?w=s(n):w=n();let C=fO;l&&(C=$le({trace:!1,...typeof l=="object"&&l}));const O=jle(...w),k=rde(O);let U=typeof _=="function"?_(k):k();const Y=C(...U);return Rq(T,p,Y)}function Lq(a){const n={},i=[];let s;const l={addCase(p,_){const T=typeof p=="string"?p:p.type;if(!T)throw new Error(Zh(28));if(T in n)throw new Error(Zh(29));return n[T]=_,l},addMatcher(p,_){return i.push({matcher:p,reducer:_}),l},addDefaultCase(p){return s=p,l}};return a(l),[n,i,s]}function sde(a){return typeof a=="function"}function ade(a,n){let[i,s,l]=Lq(n),p;if(sde(a))p=()=>s8(a());else{const T=s8(a);p=()=>T}function _(T=p(),w){let C=[i[w.type],...s.filter(({matcher:O})=>O(w)).map(({reducer:O})=>O)];return C.filter(O=>!!O).length===0&&(C=[l]),C.reduce((O,k)=>{if(k)if(C_(O)){const Y=k(O,w);return Y===void 0?O:Y}else{if(lp(O))return xq(O,U=>k(U,w));{const U=k(O,w);if(U===void 0){if(O===null)return O;throw Error("A case reducer on a non-draftable value must not return undefined")}return U}}return O},T)}return _.getInitialState=p,_}var ode=(a,n)=>Jle(a)?a.match(n):a(n);function cde(...a){return n=>a.some(i=>ode(i,n))}var lde="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",dde=(a=21)=>{let n="",i=a;for(;i--;)n+=lde[Math.random()*64|0];return n},ude=["name","message","stack","code"],FL=class{constructor(a,n){zt(this,"_type");this.payload=a,this.meta=n}},o8=class{constructor(a,n){zt(this,"_type");this.payload=a,this.meta=n}},hde=a=>{if(typeof a=="object"&&a!==null){const n={};for(const i of ude)typeof a[i]=="string"&&(n[i]=a[i]);return n}return{message:String(a)}},c8="External signal was aborted",$t=(()=>{function a(n,i,s){const l=jw(n+"/fulfilled",(w,C,O,k)=>({payload:w,meta:{...k||{},arg:O,requestId:C,requestStatus:"fulfilled"}})),p=jw(n+"/pending",(w,C,O)=>({payload:void 0,meta:{...O||{},arg:C,requestId:w,requestStatus:"pending"}})),_=jw(n+"/rejected",(w,C,O,k,U)=>({payload:k,error:(s&&s.serializeError||hde)(w||"Rejected"),meta:{...U||{},arg:O,requestId:C,rejectedWithValue:!!k,requestStatus:"rejected",aborted:(w==null?void 0:w.name)==="AbortError",condition:(w==null?void 0:w.name)==="ConditionError"}}));function T(w,{signal:C}={}){return(O,k,U)=>{const Y=s!=null&&s.idGenerator?s.idGenerator(w):dde(),W=new AbortController;let ee,K;function ie(ue){K=ue,W.abort()}C&&(C.aborted?ie(c8):C.addEventListener("abort",()=>ie(c8),{once:!0}));const se=async function(){var ae,ve;let ue;try{let $=(ae=s==null?void 0:s.condition)==null?void 0:ae.call(s,w,{getState:k,extra:U});if(fde($)&&($=await $),$===!1||W.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const Q=new Promise((te,oe)=>{ee=()=>{oe({name:"AbortError",message:K||"Aborted"})},W.signal.addEventListener("abort",ee)});O(p(Y,w,(ve=s==null?void 0:s.getPendingMeta)==null?void 0:ve.call(s,{requestId:Y,arg:w},{getState:k,extra:U}))),ue=await Promise.race([Q,Promise.resolve(i(w,{dispatch:O,getState:k,extra:U,requestId:Y,signal:W.signal,abort:ie,rejectWithValue:(te,oe)=>new FL(te,oe),fulfillWithValue:(te,oe)=>new o8(te,oe)})).then(te=>{if(te instanceof FL)throw te;return te instanceof o8?l(te.payload,Y,w,te.meta):l(te,Y,w)})])}catch($){ue=$ instanceof FL?_(null,Y,w,$.payload,$.meta):_($,Y,w)}finally{ee&&W.signal.removeEventListener("abort",ee)}return s&&!s.dispatchConditionRejection&&_.match(ue)&&ue.meta.condition||O(ue),ue}();return Object.assign(se,{abort:ie,requestId:Y,arg:w,unwrap(){return se.then(pde)}})}}return Object.assign(T,{pending:p,rejected:_,fulfilled:l,settled:cde(_,l),typePrefix:n})}return a.withTypes=()=>a,a})();function pde(a){if(a.meta&&a.meta.rejectedWithValue)throw a.payload;if(a.error)throw a.error;return a.payload}function fde(a){return a!==null&&typeof a=="object"&&typeof a.then=="function"}var mde=Symbol.for("rtk-slice-createasyncthunk");function gde(a,n){return`${a}/${n}`}function _de({creators:a}={}){var i;const n=(i=a==null?void 0:a.asyncThunk)==null?void 0:i[mde];return function(l){const{name:p,reducerPath:_=p}=l;if(!p)throw new Error(Zh(11));const T=(typeof l.reducers=="function"?l.reducers(yde()):l.reducers)||{},w=Object.keys(T),C={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},O={addCase(ye,ae){const ve=typeof ye=="string"?ye:ye.type;if(!ve)throw new Error(Zh(12));if(ve in C.sliceCaseReducersByType)throw new Error(Zh(13));return C.sliceCaseReducersByType[ve]=ae,O},addMatcher(ye,ae){return C.sliceMatchers.push({matcher:ye,reducer:ae}),O},exposeAction(ye,ae){return C.actionCreators[ye]=ae,O},exposeCaseReducer(ye,ae){return C.sliceCaseReducersByName[ye]=ae,O}};w.forEach(ye=>{const ae=T[ye],ve={reducerName:ye,type:gde(p,ye),createNotation:typeof l.reducers=="function"};Sde(ae)?bde(ve,ae,O,n):vde(ve,ae,O)});function k(){const[ye={},ae=[],ve=void 0]=typeof l.extraReducers=="function"?Lq(l.extraReducers):[l.extraReducers],$={...ye,...C.sliceCaseReducersByType};return ade(l.initialState,Q=>{for(let te in $)Q.addCase(te,$[te]);for(let te of C.sliceMatchers)Q.addMatcher(te.matcher,te.reducer);for(let te of ae)Q.addMatcher(te.matcher,te.reducer);ve&&Q.addDefaultCase(ve)})}const U=ye=>ye,Y=new Map,W=new WeakMap;let ee;function K(ye,ae){return ee||(ee=k()),ee(ye,ae)}function ie(){return ee||(ee=k()),ee.getInitialState()}function se(ye,ae=!1){function ve(Q){let te=Q[ye];return typeof te>"u"&&ae&&(te=XI(W,ve,ie)),te}function $(Q=U){const te=XI(Y,ae,()=>new WeakMap);return XI(te,Q,()=>{const oe={};for(const[re,fe]of Object.entries(l.selectors??{}))oe[re]=Ede(fe,Q,()=>XI(W,Q,ie),ae);return oe})}return{reducerPath:ye,getSelectors:$,get selectors(){return $(ve)},selectSlice:ve}}const ue={name:p,reducer:K,actions:C.actionCreators,caseReducers:C.sliceCaseReducersByName,getInitialState:ie,...se(_),injectInto(ye,{reducerPath:ae,...ve}={}){const $=ae??_;return ye.inject({reducerPath:$,reducer:K},ve),{...ue,...se($,!0)}}};return ue}}function Ede(a,n,i,s){function l(p,..._){let T=n(p);return typeof T>"u"&&s&&(T=i()),a(T,..._)}return l.unwrapped=a,l}var sm=_de();function yde(){function a(n,i){return{_reducerDefinitionType:"asyncThunk",payloadCreator:n,...i}}return a.withTypes=()=>a,{reducer(n){return Object.assign({[n.name](...i){return n(...i)}}[n.name],{_reducerDefinitionType:"reducer"})},preparedReducer(n,i){return{_reducerDefinitionType:"reducerWithPrepare",prepare:n,reducer:i}},asyncThunk:a}}function vde({type:a,reducerName:n,createNotation:i},s,l){let p,_;if("reducer"in s){if(i&&!Tde(s))throw new Error(Zh(17));p=s.reducer,_=s.prepare}else p=s;l.addCase(a,p).exposeCaseReducer(n,p).exposeAction(n,_?jw(a,_):jw(a))}function Sde(a){return a._reducerDefinitionType==="asyncThunk"}function Tde(a){return a._reducerDefinitionType==="reducerWithPrepare"}function bde({type:a,reducerName:n},i,s,l){if(!l)throw new Error(Zh(18));const{payloadCreator:p,fulfilled:_,pending:T,rejected:w,settled:C,options:O}=i,k=l(a,p,O);s.exposeAction(n,k),_&&s.addCase(k.fulfilled,_),T&&s.addCase(k.pending,T),w&&s.addCase(k.rejected,w),C&&s.addMatcher(k.settled,C),s.exposeCaseReducer(n,{fulfilled:_||QI,pending:T||QI,rejected:w||QI,settled:C||QI})}function QI(){}function Zh(a){return`Minified Redux Toolkit error #${a}; visit https://redux-toolkit.js.org/Errors?code=${a} for the full message or use the non-minified dev environment for full errors. `}function Mq(a,n){return function(){return a.apply(n,arguments)}}const{toString:wde}=Object.prototype,{getPrototypeOf:Z2}=Object,{iterator:sD,toStringTag:jq}=Symbol,aD=(a=>n=>{const i=wde.call(n);return a[i]||(a[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Cd=a=>(a=a.toLowerCase(),n=>aD(n)===a),oD=a=>n=>typeof n===a,{isArray:tS}=Array,eR=oD("undefined");function Rde(a){return a!==null&&!eR(a)&&a.constructor!==null&&!eR(a.constructor)&&dc(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const Uq=Cd("ArrayBuffer");function Cde(a){let n;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?n=ArrayBuffer.isView(a):n=a&&a.buffer&&Uq(a.buffer),n}const Ade=oD("string"),dc=oD("function"),Vq=oD("number"),cD=a=>a!==null&&typeof a=="object",Ide=a=>a===!0||a===!1,mN=a=>{if(aD(a)!=="object")return!1;const n=Z2(a);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(jq in a)&&!(sD in a)},Nde=Cd("Date"),Ode=Cd("File"),Dde=Cd("Blob"),xde=Cd("FileList"),Pde=a=>cD(a)&&dc(a.pipe),kde=a=>{let n;return a&&(typeof FormData=="function"&&a instanceof FormData||dc(a.append)&&((n=aD(a))==="formdata"||n==="object"&&dc(a.toString)&&a.toString()==="[object FormData]"))},Lde=Cd("URLSearchParams"),[Mde,jde,Ude,Vde]=["ReadableStream","Request","Response","Headers"].map(Cd),Fde=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ER(a,n,{allOwnKeys:i=!1}={}){if(a===null||typeof a>"u")return;let s,l;if(typeof a!="object"&&(a=[a]),tS(a))for(s=0,l=a.length;s<l;s++)n.call(null,a[s],s,a);else{const p=i?Object.getOwnPropertyNames(a):Object.keys(a),_=p.length;let T;for(s=0;s<_;s++)T=p[s],n.call(null,a[T],T,a)}}function Fq(a,n){n=n.toLowerCase();const i=Object.keys(a);let s=i.length,l;for(;s-- >0;)if(l=i[s],n===l.toLowerCase())return l;return null}const u_=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Bq=a=>!eR(a)&&a!==u_;function zM(){const{caseless:a}=Bq(this)&&this||{},n={},i=(s,l)=>{const p=a&&Fq(n,l)||l;mN(n[p])&&mN(s)?n[p]=zM(n[p],s):mN(s)?n[p]=zM({},s):tS(s)?n[p]=s.slice():n[p]=s};for(let s=0,l=arguments.length;s<l;s++)arguments[s]&&ER(arguments[s],i);return n}const Bde=(a,n,i,{allOwnKeys:s}={})=>(ER(n,(l,p)=>{i&&dc(l)?a[p]=Mq(l,i):a[p]=l},{allOwnKeys:s}),a),Hde=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),Gde=(a,n,i,s)=>{a.prototype=Object.create(n.prototype,s),a.prototype.constructor=a,Object.defineProperty(a,"super",{value:n.prototype}),i&&Object.assign(a.prototype,i)},Wde=(a,n,i,s)=>{let l,p,_;const T={};if(n=n||{},a==null)return n;do{for(l=Object.getOwnPropertyNames(a),p=l.length;p-- >0;)_=l[p],(!s||s(_,a,n))&&!T[_]&&(n[_]=a[_],T[_]=!0);a=i!==!1&&Z2(a)}while(a&&(!i||i(a,n))&&a!==Object.prototype);return n},zde=(a,n,i)=>{a=String(a),(i===void 0||i>a.length)&&(i=a.length),i-=n.length;const s=a.indexOf(n,i);return s!==-1&&s===i},Yde=a=>{if(!a)return null;if(tS(a))return a;let n=a.length;if(!Vq(n))return null;const i=new Array(n);for(;n-- >0;)i[n]=a[n];return i},qde=(a=>n=>a&&n instanceof a)(typeof Uint8Array<"u"&&Z2(Uint8Array)),Kde=(a,n)=>{const s=(a&&a[sD]).call(a);let l;for(;(l=s.next())&&!l.done;){const p=l.value;n.call(a,p[0],p[1])}},Xde=(a,n)=>{let i;const s=[];for(;(i=a.exec(n))!==null;)s.push(i);return s},Qde=Cd("HTMLFormElement"),$de=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,s,l){return s.toUpperCase()+l}),l8=(({hasOwnProperty:a})=>(n,i)=>a.call(n,i))(Object.prototype),Jde=Cd("RegExp"),Hq=(a,n)=>{const i=Object.getOwnPropertyDescriptors(a),s={};ER(i,(l,p)=>{let _;(_=n(l,p,a))!==!1&&(s[p]=_||l)}),Object.defineProperties(a,s)},Zde=a=>{Hq(a,(n,i)=>{if(dc(a)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const s=a[i];if(dc(s)){if(n.enumerable=!1,"writable"in n){n.writable=!1;return}n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},eue=(a,n)=>{const i={},s=l=>{l.forEach(p=>{i[p]=!0})};return tS(a)?s(a):s(String(a).split(n)),i},tue=()=>{},nue=(a,n)=>a!=null&&Number.isFinite(a=+a)?a:n;function rue(a){return!!(a&&dc(a.append)&&a[jq]==="FormData"&&a[sD])}const iue=a=>{const n=new Array(10),i=(s,l)=>{if(cD(s)){if(n.indexOf(s)>=0)return;if(!("toJSON"in s)){n[l]=s;const p=tS(s)?[]:{};return ER(s,(_,T)=>{const w=i(_,l+1);!eR(w)&&(p[T]=w)}),n[l]=void 0,p}}return s};return i(a,0)},sue=Cd("AsyncFunction"),aue=a=>a&&(cD(a)||dc(a))&&dc(a.then)&&dc(a.catch),Gq=((a,n)=>a?setImmediate:n?((i,s)=>(u_.addEventListener("message",({source:l,data:p})=>{l===u_&&p===i&&s.length&&s.shift()()},!1),l=>{s.push(l),u_.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",dc(u_.postMessage)),oue=typeof queueMicrotask<"u"?queueMicrotask.bind(u_):typeof process<"u"&&process.nextTick||Gq,cue=a=>a!=null&&dc(a[sD]),rt={isArray:tS,isArrayBuffer:Uq,isBuffer:Rde,isFormData:kde,isArrayBufferView:Cde,isString:Ade,isNumber:Vq,isBoolean:Ide,isObject:cD,isPlainObject:mN,isReadableStream:Mde,isRequest:jde,isResponse:Ude,isHeaders:Vde,isUndefined:eR,isDate:Nde,isFile:Ode,isBlob:Dde,isRegExp:Jde,isFunction:dc,isStream:Pde,isURLSearchParams:Lde,isTypedArray:qde,isFileList:xde,forEach:ER,merge:zM,extend:Bde,trim:Fde,stripBOM:Hde,inherits:Gde,toFlatObject:Wde,kindOf:aD,kindOfTest:Cd,endsWith:zde,toArray:Yde,forEachEntry:Kde,matchAll:Xde,isHTMLForm:Qde,hasOwnProperty:l8,hasOwnProp:l8,reduceDescriptors:Hq,freezeMethods:Zde,toObjectSet:eue,toCamelCase:$de,noop:tue,toFiniteNumber:nue,findKey:Fq,global:u_,isContextDefined:Bq,isSpecCompliantForm:rue,toJSONObject:iue,isAsyncFn:sue,isThenable:aue,setImmediate:Gq,asap:oue,isIterable:cue};function tr(a,n,i,s,l){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=a,this.name="AxiosError",n&&(this.code=n),i&&(this.config=i),s&&(this.request=s),l&&(this.response=l,this.status=l.status?l.status:null)}rt.inherits(tr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:rt.toJSONObject(this.config),code:this.code,status:this.status}}});const Wq=tr.prototype,zq={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(a=>{zq[a]={value:a}});Object.defineProperties(tr,zq);Object.defineProperty(Wq,"isAxiosError",{value:!0});tr.from=(a,n,i,s,l,p)=>{const _=Object.create(Wq);return rt.toFlatObject(a,_,function(w){return w!==Error.prototype},T=>T!=="isAxiosError"),tr.call(_,a.message,n,i,s,l),_.cause=a,_.name=a.name,p&&Object.assign(_,p),_};const lue=null;function YM(a){return rt.isPlainObject(a)||rt.isArray(a)}function Yq(a){return rt.endsWith(a,"[]")?a.slice(0,-2):a}function d8(a,n,i){return a?a.concat(n).map(function(l,p){return l=Yq(l),!i&&p?"["+l+"]":l}).join(i?".":""):n}function due(a){return rt.isArray(a)&&!a.some(YM)}const uue=rt.toFlatObject(rt,{},null,function(n){return/^is[A-Z]/.test(n)});function lD(a,n,i){if(!rt.isObject(a))throw new TypeError("target must be an object");n=n||new FormData,i=rt.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ee,K){return!rt.isUndefined(K[ee])});const s=i.metaTokens,l=i.visitor||O,p=i.dots,_=i.indexes,w=(i.Blob||typeof Blob<"u"&&Blob)&&rt.isSpecCompliantForm(n);if(!rt.isFunction(l))throw new TypeError("visitor must be a function");function C(W){if(W===null)return"";if(rt.isDate(W))return W.toISOString();if(!w&&rt.isBlob(W))throw new tr("Blob is not supported. Use a Buffer instead.");return rt.isArrayBuffer(W)||rt.isTypedArray(W)?w&&typeof Blob=="function"?new Blob([W]):Buffer.from(W):W}function O(W,ee,K){let ie=W;if(W&&!K&&typeof W=="object"){if(rt.endsWith(ee,"{}"))ee=s?ee:ee.slice(0,-2),W=JSON.stringify(W);else if(rt.isArray(W)&&due(W)||(rt.isFileList(W)||rt.endsWith(ee,"[]"))&&(ie=rt.toArray(W)))return ee=Yq(ee),ie.forEach(function(ue,ye){!(rt.isUndefined(ue)||ue===null)&&n.append(_===!0?d8([ee],ye,p):_===null?ee:ee+"[]",C(ue))}),!1}return YM(W)?!0:(n.append(d8(K,ee,p),C(W)),!1)}const k=[],U=Object.assign(uue,{defaultVisitor:O,convertValue:C,isVisitable:YM});function Y(W,ee){if(!rt.isUndefined(W)){if(k.indexOf(W)!==-1)throw Error("Circular reference detected in "+ee.join("."));k.push(W),rt.forEach(W,function(ie,se){(!(rt.isUndefined(ie)||ie===null)&&l.call(n,ie,rt.isString(se)?se.trim():se,ee,U))===!0&&Y(ie,ee?ee.concat(se):[se])}),k.pop()}}if(!rt.isObject(a))throw new TypeError("data must be an object");return Y(a),n}function u8(a){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(s){return n[s]})}function ej(a,n){this._pairs=[],a&&lD(a,this,n)}const qq=ej.prototype;qq.append=function(n,i){this._pairs.push([n,i])};qq.toString=function(n){const i=n?function(s){return n.call(this,s,u8)}:u8;return this._pairs.map(function(l){return i(l[0])+"="+i(l[1])},"").join("&")};function hue(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Kq(a,n,i){if(!n)return a;const s=i&&i.encode||hue;rt.isFunction(i)&&(i={serialize:i});const l=i&&i.serialize;let p;if(l?p=l(n,i):p=rt.isURLSearchParams(n)?n.toString():new ej(n,i).toString(s),p){const _=a.indexOf("#");_!==-1&&(a=a.slice(0,_)),a+=(a.indexOf("?")===-1?"?":"&")+p}return a}class h8{constructor(){this.handlers=[]}use(n,i,s){return this.handlers.push({fulfilled:n,rejected:i,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){rt.forEach(this.handlers,function(s){s!==null&&n(s)})}}const Xq={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},pue=typeof URLSearchParams<"u"?URLSearchParams:ej,fue=typeof FormData<"u"?FormData:null,mue=typeof Blob<"u"?Blob:null,gue={isBrowser:!0,classes:{URLSearchParams:pue,FormData:fue,Blob:mue},protocols:["http","https","file","blob","url","data"]},tj=typeof window<"u"&&typeof document<"u",qM=typeof navigator=="object"&&navigator||void 0,_ue=tj&&(!qM||["ReactNative","NativeScript","NS"].indexOf(qM.product)<0),Eue=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",yue=tj&&window.location.href||"http://localhost",vue=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:tj,hasStandardBrowserEnv:_ue,hasStandardBrowserWebWorkerEnv:Eue,navigator:qM,origin:yue},Symbol.toStringTag,{value:"Module"})),uo={...vue,...gue};function Sue(a,n){return lD(a,new uo.classes.URLSearchParams,Object.assign({visitor:function(i,s,l,p){return uo.isNode&&rt.isBuffer(i)?(this.append(s,i.toString("base64")),!1):p.defaultVisitor.apply(this,arguments)}},n))}function Tue(a){return rt.matchAll(/\w+|\[(\w*)]/g,a).map(n=>n[0]==="[]"?"":n[1]||n[0])}function bue(a){const n={},i=Object.keys(a);let s;const l=i.length;let p;for(s=0;s<l;s++)p=i[s],n[p]=a[p];return n}function Qq(a){function n(i,s,l,p){let _=i[p++];if(_==="__proto__")return!0;const T=Number.isFinite(+_),w=p>=i.length;return _=!_&&rt.isArray(l)?l.length:_,w?(rt.hasOwnProp(l,_)?l[_]=[l[_],s]:l[_]=s,!T):((!l[_]||!rt.isObject(l[_]))&&(l[_]=[]),n(i,s,l[_],p)&&rt.isArray(l[_])&&(l[_]=bue(l[_])),!T)}if(rt.isFormData(a)&&rt.isFunction(a.entries)){const i={};return rt.forEachEntry(a,(s,l)=>{n(Tue(s),l,i,0)}),i}return null}function wue(a,n,i){if(rt.isString(a))try{return(n||JSON.parse)(a),rt.trim(a)}catch(s){if(s.name!=="SyntaxError")throw s}return(i||JSON.stringify)(a)}const yR={transitional:Xq,adapter:["xhr","http","fetch"],transformRequest:[function(n,i){const s=i.getContentType()||"",l=s.indexOf("application/json")>-1,p=rt.isObject(n);if(p&&rt.isHTMLForm(n)&&(n=new FormData(n)),rt.isFormData(n))return l?JSON.stringify(Qq(n)):n;if(rt.isArrayBuffer(n)||rt.isBuffer(n)||rt.isStream(n)||rt.isFile(n)||rt.isBlob(n)||rt.isReadableStream(n))return n;if(rt.isArrayBufferView(n))return n.buffer;if(rt.isURLSearchParams(n))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let T;if(p){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Sue(n,this.formSerializer).toString();if((T=rt.isFileList(n))||s.indexOf("multipart/form-data")>-1){const w=this.env&&this.env.FormData;return lD(T?{"files[]":n}:n,w&&new w,this.formSerializer)}}return p||l?(i.setContentType("application/json",!1),wue(n)):n}],transformResponse:[function(n){const i=this.transitional||yR.transitional,s=i&&i.forcedJSONParsing,l=this.responseType==="json";if(rt.isResponse(n)||rt.isReadableStream(n))return n;if(n&&rt.isString(n)&&(s&&!this.responseType||l)){const _=!(i&&i.silentJSONParsing)&&l;try{return JSON.parse(n)}catch(T){if(_)throw T.name==="SyntaxError"?tr.from(T,tr.ERR_BAD_RESPONSE,this,null,this.response):T}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:uo.classes.FormData,Blob:uo.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};rt.forEach(["delete","get","head","post","put","patch"],a=>{yR.headers[a]={}});const Rue=rt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Cue=a=>{const n={};let i,s,l;return a&&a.split(`
`).forEach(function(_){l=_.indexOf(":"),i=_.substring(0,l).trim().toLowerCase(),s=_.substring(l+1).trim(),!(!i||n[i]&&Rue[i])&&(i==="set-cookie"?n[i]?n[i].push(s):n[i]=[s]:n[i]=n[i]?n[i]+", "+s:s)}),n},p8=Symbol("internals");function Sw(a){return a&&String(a).trim().toLowerCase()}function gN(a){return a===!1||a==null?a:rt.isArray(a)?a.map(gN):String(a)}function Aue(a){const n=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=i.exec(a);)n[s[1]]=s[2];return n}const Iue=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function BL(a,n,i,s,l){if(rt.isFunction(s))return s.call(this,n,i);if(l&&(n=i),!!rt.isString(n)){if(rt.isString(s))return n.indexOf(s)!==-1;if(rt.isRegExp(s))return s.test(n)}}function Nue(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(n,i,s)=>i.toUpperCase()+s)}function Oue(a,n){const i=rt.toCamelCase(" "+n);["get","set","has"].forEach(s=>{Object.defineProperty(a,s+i,{value:function(l,p,_){return this[s].call(this,n,l,p,_)},configurable:!0})})}let uc=class{constructor(n){n&&this.set(n)}set(n,i,s){const l=this;function p(T,w,C){const O=Sw(w);if(!O)throw new Error("header name must be a non-empty string");const k=rt.findKey(l,O);(!k||l[k]===void 0||C===!0||C===void 0&&l[k]!==!1)&&(l[k||w]=gN(T))}const _=(T,w)=>rt.forEach(T,(C,O)=>p(C,O,w));if(rt.isPlainObject(n)||n instanceof this.constructor)_(n,i);else if(rt.isString(n)&&(n=n.trim())&&!Iue(n))_(Cue(n),i);else if(rt.isObject(n)&&rt.isIterable(n)){let T={},w,C;for(const O of n){if(!rt.isArray(O))throw TypeError("Object iterator must return a key-value pair");T[C=O[0]]=(w=T[C])?rt.isArray(w)?[...w,O[1]]:[w,O[1]]:O[1]}_(T,i)}else n!=null&&p(i,n,s);return this}get(n,i){if(n=Sw(n),n){const s=rt.findKey(this,n);if(s){const l=this[s];if(!i)return l;if(i===!0)return Aue(l);if(rt.isFunction(i))return i.call(this,l,s);if(rt.isRegExp(i))return i.exec(l);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,i){if(n=Sw(n),n){const s=rt.findKey(this,n);return!!(s&&this[s]!==void 0&&(!i||BL(this,this[s],s,i)))}return!1}delete(n,i){const s=this;let l=!1;function p(_){if(_=Sw(_),_){const T=rt.findKey(s,_);T&&(!i||BL(s,s[T],T,i))&&(delete s[T],l=!0)}}return rt.isArray(n)?n.forEach(p):p(n),l}clear(n){const i=Object.keys(this);let s=i.length,l=!1;for(;s--;){const p=i[s];(!n||BL(this,this[p],p,n,!0))&&(delete this[p],l=!0)}return l}normalize(n){const i=this,s={};return rt.forEach(this,(l,p)=>{const _=rt.findKey(s,p);if(_){i[_]=gN(l),delete i[p];return}const T=n?Nue(p):String(p).trim();T!==p&&delete i[p],i[T]=gN(l),s[T]=!0}),this}concat(...n){return this.constructor.concat(this,...n)}toJSON(n){const i=Object.create(null);return rt.forEach(this,(s,l)=>{s!=null&&s!==!1&&(i[l]=n&&rt.isArray(s)?s.join(", "):s)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([n,i])=>n+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n,...i){const s=new this(n);return i.forEach(l=>s.set(l)),s}static accessor(n){const s=(this[p8]=this[p8]={accessors:{}}).accessors,l=this.prototype;function p(_){const T=Sw(_);s[T]||(Oue(l,_),s[T]=!0)}return rt.isArray(n)?n.forEach(p):p(n),this}};uc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);rt.reduceDescriptors(uc.prototype,({value:a},n)=>{let i=n[0].toUpperCase()+n.slice(1);return{get:()=>a,set(s){this[i]=s}}});rt.freezeMethods(uc);function HL(a,n){const i=this||yR,s=n||i,l=uc.from(s.headers);let p=s.data;return rt.forEach(a,function(T){p=T.call(i,p,l.normalize(),n?n.status:void 0)}),l.normalize(),p}function $q(a){return!!(a&&a.__CANCEL__)}function nS(a,n,i){tr.call(this,a??"canceled",tr.ERR_CANCELED,n,i),this.name="CanceledError"}rt.inherits(nS,tr,{__CANCEL__:!0});function Jq(a,n,i){const s=i.config.validateStatus;!i.status||!s||s(i.status)?a(i):n(new tr("Request failed with status code "+i.status,[tr.ERR_BAD_REQUEST,tr.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function Due(a){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return n&&n[1]||""}function xue(a,n){a=a||10;const i=new Array(a),s=new Array(a);let l=0,p=0,_;return n=n!==void 0?n:1e3,function(w){const C=Date.now(),O=s[p];_||(_=C),i[l]=w,s[l]=C;let k=p,U=0;for(;k!==l;)U+=i[k++],k=k%a;if(l=(l+1)%a,l===p&&(p=(p+1)%a),C-_<n)return;const Y=O&&C-O;return Y?Math.round(U*1e3/Y):void 0}}function Pue(a,n){let i=0,s=1e3/n,l,p;const _=(C,O=Date.now())=>{i=O,l=null,p&&(clearTimeout(p),p=null),a.apply(null,C)};return[(...C)=>{const O=Date.now(),k=O-i;k>=s?_(C,O):(l=C,p||(p=setTimeout(()=>{p=null,_(l)},s-k)))},()=>l&&_(l)]}const EO=(a,n,i=3)=>{let s=0;const l=xue(50,250);return Pue(p=>{const _=p.loaded,T=p.lengthComputable?p.total:void 0,w=_-s,C=l(w),O=_<=T;s=_;const k={loaded:_,total:T,progress:T?_/T:void 0,bytes:w,rate:C||void 0,estimated:C&&T&&O?(T-_)/C:void 0,event:p,lengthComputable:T!=null,[n?"download":"upload"]:!0};a(k)},i)},f8=(a,n)=>{const i=a!=null;return[s=>n[0]({lengthComputable:i,total:a,loaded:s}),n[1]]},m8=a=>(...n)=>rt.asap(()=>a(...n)),kue=uo.hasStandardBrowserEnv?((a,n)=>i=>(i=new URL(i,uo.origin),a.protocol===i.protocol&&a.host===i.host&&(n||a.port===i.port)))(new URL(uo.origin),uo.navigator&&/(msie|trident)/i.test(uo.navigator.userAgent)):()=>!0,Lue=uo.hasStandardBrowserEnv?{write(a,n,i,s,l,p){const _=[a+"="+encodeURIComponent(n)];rt.isNumber(i)&&_.push("expires="+new Date(i).toGMTString()),rt.isString(s)&&_.push("path="+s),rt.isString(l)&&_.push("domain="+l),p===!0&&_.push("secure"),document.cookie=_.join("; ")},read(a){const n=document.cookie.match(new RegExp("(^|;\\s*)("+a+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove(a){this.write(a,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Mue(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function jue(a,n){return n?a.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):a}function Zq(a,n,i){let s=!Mue(n);return a&&(s||i==!1)?jue(a,n):n}const g8=a=>a instanceof uc?{...a}:a;function I_(a,n){n=n||{};const i={};function s(C,O,k,U){return rt.isPlainObject(C)&&rt.isPlainObject(O)?rt.merge.call({caseless:U},C,O):rt.isPlainObject(O)?rt.merge({},O):rt.isArray(O)?O.slice():O}function l(C,O,k,U){if(rt.isUndefined(O)){if(!rt.isUndefined(C))return s(void 0,C,k,U)}else return s(C,O,k,U)}function p(C,O){if(!rt.isUndefined(O))return s(void 0,O)}function _(C,O){if(rt.isUndefined(O)){if(!rt.isUndefined(C))return s(void 0,C)}else return s(void 0,O)}function T(C,O,k){if(k in n)return s(C,O);if(k in a)return s(void 0,C)}const w={url:p,method:p,data:p,baseURL:_,transformRequest:_,transformResponse:_,paramsSerializer:_,timeout:_,timeoutMessage:_,withCredentials:_,withXSRFToken:_,adapter:_,responseType:_,xsrfCookieName:_,xsrfHeaderName:_,onUploadProgress:_,onDownloadProgress:_,decompress:_,maxContentLength:_,maxBodyLength:_,beforeRedirect:_,transport:_,httpAgent:_,httpsAgent:_,cancelToken:_,socketPath:_,responseEncoding:_,validateStatus:T,headers:(C,O,k)=>l(g8(C),g8(O),k,!0)};return rt.forEach(Object.keys(Object.assign({},a,n)),function(O){const k=w[O]||l,U=k(a[O],n[O],O);rt.isUndefined(U)&&k!==T||(i[O]=U)}),i}const eK=a=>{const n=I_({},a);let{data:i,withXSRFToken:s,xsrfHeaderName:l,xsrfCookieName:p,headers:_,auth:T}=n;n.headers=_=uc.from(_),n.url=Kq(Zq(n.baseURL,n.url,n.allowAbsoluteUrls),a.params,a.paramsSerializer),T&&_.set("Authorization","Basic "+btoa((T.username||"")+":"+(T.password?unescape(encodeURIComponent(T.password)):"")));let w;if(rt.isFormData(i)){if(uo.hasStandardBrowserEnv||uo.hasStandardBrowserWebWorkerEnv)_.setContentType(void 0);else if((w=_.getContentType())!==!1){const[C,...O]=w?w.split(";").map(k=>k.trim()).filter(Boolean):[];_.setContentType([C||"multipart/form-data",...O].join("; "))}}if(uo.hasStandardBrowserEnv&&(s&&rt.isFunction(s)&&(s=s(n)),s||s!==!1&&kue(n.url))){const C=l&&p&&Lue.read(p);C&&_.set(l,C)}return n},Uue=typeof XMLHttpRequest<"u",Vue=Uue&&function(a){return new Promise(function(i,s){const l=eK(a);let p=l.data;const _=uc.from(l.headers).normalize();let{responseType:T,onUploadProgress:w,onDownloadProgress:C}=l,O,k,U,Y,W;function ee(){Y&&Y(),W&&W(),l.cancelToken&&l.cancelToken.unsubscribe(O),l.signal&&l.signal.removeEventListener("abort",O)}let K=new XMLHttpRequest;K.open(l.method.toUpperCase(),l.url,!0),K.timeout=l.timeout;function ie(){if(!K)return;const ue=uc.from("getAllResponseHeaders"in K&&K.getAllResponseHeaders()),ae={data:!T||T==="text"||T==="json"?K.responseText:K.response,status:K.status,statusText:K.statusText,headers:ue,config:a,request:K};Jq(function($){i($),ee()},function($){s($),ee()},ae),K=null}"onloadend"in K?K.onloadend=ie:K.onreadystatechange=function(){!K||K.readyState!==4||K.status===0&&!(K.responseURL&&K.responseURL.indexOf("file:")===0)||setTimeout(ie)},K.onabort=function(){K&&(s(new tr("Request aborted",tr.ECONNABORTED,a,K)),K=null)},K.onerror=function(){s(new tr("Network Error",tr.ERR_NETWORK,a,K)),K=null},K.ontimeout=function(){let ye=l.timeout?"timeout of "+l.timeout+"ms exceeded":"timeout exceeded";const ae=l.transitional||Xq;l.timeoutErrorMessage&&(ye=l.timeoutErrorMessage),s(new tr(ye,ae.clarifyTimeoutError?tr.ETIMEDOUT:tr.ECONNABORTED,a,K)),K=null},p===void 0&&_.setContentType(null),"setRequestHeader"in K&&rt.forEach(_.toJSON(),function(ye,ae){K.setRequestHeader(ae,ye)}),rt.isUndefined(l.withCredentials)||(K.withCredentials=!!l.withCredentials),T&&T!=="json"&&(K.responseType=l.responseType),C&&([U,W]=EO(C,!0),K.addEventListener("progress",U)),w&&K.upload&&([k,Y]=EO(w),K.upload.addEventListener("progress",k),K.upload.addEventListener("loadend",Y)),(l.cancelToken||l.signal)&&(O=ue=>{K&&(s(!ue||ue.type?new nS(null,a,K):ue),K.abort(),K=null)},l.cancelToken&&l.cancelToken.subscribe(O),l.signal&&(l.signal.aborted?O():l.signal.addEventListener("abort",O)));const se=Due(l.url);if(se&&uo.protocols.indexOf(se)===-1){s(new tr("Unsupported protocol "+se+":",tr.ERR_BAD_REQUEST,a));return}K.send(p||null)})},Fue=(a,n)=>{const{length:i}=a=a?a.filter(Boolean):[];if(n||i){let s=new AbortController,l;const p=function(C){if(!l){l=!0,T();const O=C instanceof Error?C:this.reason;s.abort(O instanceof tr?O:new nS(O instanceof Error?O.message:O))}};let _=n&&setTimeout(()=>{_=null,p(new tr(`timeout ${n} of ms exceeded`,tr.ETIMEDOUT))},n);const T=()=>{a&&(_&&clearTimeout(_),_=null,a.forEach(C=>{C.unsubscribe?C.unsubscribe(p):C.removeEventListener("abort",p)}),a=null)};a.forEach(C=>C.addEventListener("abort",p));const{signal:w}=s;return w.unsubscribe=()=>rt.asap(T),w}},Bue=function*(a,n){let i=a.byteLength;if(i<n){yield a;return}let s=0,l;for(;s<i;)l=s+n,yield a.slice(s,l),s=l},Hue=async function*(a,n){for await(const i of Gue(a))yield*Bue(i,n)},Gue=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const n=a.getReader();try{for(;;){const{done:i,value:s}=await n.read();if(i)break;yield s}}finally{await n.cancel()}},_8=(a,n,i,s)=>{const l=Hue(a,n);let p=0,_,T=w=>{_||(_=!0,s&&s(w))};return new ReadableStream({async pull(w){try{const{done:C,value:O}=await l.next();if(C){T(),w.close();return}let k=O.byteLength;if(i){let U=p+=k;i(U)}w.enqueue(new Uint8Array(O))}catch(C){throw T(C),C}},cancel(w){return T(w),l.return()}},{highWaterMark:2})},dD=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",tK=dD&&typeof ReadableStream=="function",Wue=dD&&(typeof TextEncoder=="function"?(a=>n=>a.encode(n))(new TextEncoder):async a=>new Uint8Array(await new Response(a).arrayBuffer())),nK=(a,...n)=>{try{return!!a(...n)}catch{return!1}},zue=tK&&nK(()=>{let a=!1;const n=new Request(uo.origin,{body:new ReadableStream,method:"POST",get duplex(){return a=!0,"half"}}).headers.has("Content-Type");return a&&!n}),E8=64*1024,KM=tK&&nK(()=>rt.isReadableStream(new Response("").body)),yO={stream:KM&&(a=>a.body)};dD&&(a=>{["text","arrayBuffer","blob","formData","stream"].forEach(n=>{!yO[n]&&(yO[n]=rt.isFunction(a[n])?i=>i[n]():(i,s)=>{throw new tr(`Response type '${n}' is not supported`,tr.ERR_NOT_SUPPORT,s)})})})(new Response);const Yue=async a=>{if(a==null)return 0;if(rt.isBlob(a))return a.size;if(rt.isSpecCompliantForm(a))return(await new Request(uo.origin,{method:"POST",body:a}).arrayBuffer()).byteLength;if(rt.isArrayBufferView(a)||rt.isArrayBuffer(a))return a.byteLength;if(rt.isURLSearchParams(a)&&(a=a+""),rt.isString(a))return(await Wue(a)).byteLength},que=async(a,n)=>{const i=rt.toFiniteNumber(a.getContentLength());return i??Yue(n)},Kue=dD&&(async a=>{let{url:n,method:i,data:s,signal:l,cancelToken:p,timeout:_,onDownloadProgress:T,onUploadProgress:w,responseType:C,headers:O,withCredentials:k="same-origin",fetchOptions:U}=eK(a);C=C?(C+"").toLowerCase():"text";let Y=Fue([l,p&&p.toAbortSignal()],_),W;const ee=Y&&Y.unsubscribe&&(()=>{Y.unsubscribe()});let K;try{if(w&&zue&&i!=="get"&&i!=="head"&&(K=await que(O,s))!==0){let ae=new Request(n,{method:"POST",body:s,duplex:"half"}),ve;if(rt.isFormData(s)&&(ve=ae.headers.get("content-type"))&&O.setContentType(ve),ae.body){const[$,Q]=f8(K,EO(m8(w)));s=_8(ae.body,E8,$,Q)}}rt.isString(k)||(k=k?"include":"omit");const ie="credentials"in Request.prototype;W=new Request(n,{...U,signal:Y,method:i.toUpperCase(),headers:O.normalize().toJSON(),body:s,duplex:"half",credentials:ie?k:void 0});let se=await fetch(W);const ue=KM&&(C==="stream"||C==="response");if(KM&&(T||ue&&ee)){const ae={};["status","statusText","headers"].forEach(te=>{ae[te]=se[te]});const ve=rt.toFiniteNumber(se.headers.get("content-length")),[$,Q]=T&&f8(ve,EO(m8(T),!0))||[];se=new Response(_8(se.body,E8,$,()=>{Q&&Q(),ee&&ee()}),ae)}C=C||"text";let ye=await yO[rt.findKey(yO,C)||"text"](se,a);return!ue&&ee&&ee(),await new Promise((ae,ve)=>{Jq(ae,ve,{data:ye,headers:uc.from(se.headers),status:se.status,statusText:se.statusText,config:a,request:W})})}catch(ie){throw ee&&ee(),ie&&ie.name==="TypeError"&&/Load failed|fetch/i.test(ie.message)?Object.assign(new tr("Network Error",tr.ERR_NETWORK,a,W),{cause:ie.cause||ie}):tr.from(ie,ie&&ie.code,a,W)}}),XM={http:lue,xhr:Vue,fetch:Kue};rt.forEach(XM,(a,n)=>{if(a){try{Object.defineProperty(a,"name",{value:n})}catch{}Object.defineProperty(a,"adapterName",{value:n})}});const y8=a=>`- ${a}`,Xue=a=>rt.isFunction(a)||a===null||a===!1,rK={getAdapter:a=>{a=rt.isArray(a)?a:[a];const{length:n}=a;let i,s;const l={};for(let p=0;p<n;p++){i=a[p];let _;if(s=i,!Xue(i)&&(s=XM[(_=String(i)).toLowerCase()],s===void 0))throw new tr(`Unknown adapter '${_}'`);if(s)break;l[_||"#"+p]=s}if(!s){const p=Object.entries(l).map(([T,w])=>`adapter ${T} `+(w===!1?"is not supported by the environment":"is not available in the build"));let _=n?p.length>1?`since :
`+p.map(y8).join(`
`):" "+y8(p[0]):"as no adapter specified";throw new tr("There is no suitable adapter to dispatch the request "+_,"ERR_NOT_SUPPORT")}return s},adapters:XM};function GL(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new nS(null,a)}function v8(a){return GL(a),a.headers=uc.from(a.headers),a.data=HL.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),rK.getAdapter(a.adapter||yR.adapter)(a).then(function(s){return GL(a),s.data=HL.call(a,a.transformResponse,s),s.headers=uc.from(s.headers),s},function(s){return $q(s)||(GL(a),s&&s.response&&(s.response.data=HL.call(a,a.transformResponse,s.response),s.response.headers=uc.from(s.response.headers))),Promise.reject(s)})}const iK="1.9.0",uD={};["object","boolean","number","function","string","symbol"].forEach((a,n)=>{uD[a]=function(s){return typeof s===a||"a"+(n<1?"n ":" ")+a}});const S8={};uD.transitional=function(n,i,s){function l(p,_){return"[Axios v"+iK+"] Transitional option '"+p+"'"+_+(s?". "+s:"")}return(p,_,T)=>{if(n===!1)throw new tr(l(_," has been removed"+(i?" in "+i:"")),tr.ERR_DEPRECATED);return i&&!S8[_]&&(S8[_]=!0,console.warn(l(_," has been deprecated since v"+i+" and will be removed in the near future"))),n?n(p,_,T):!0}};uD.spelling=function(n){return(i,s)=>(console.warn(`${s} is likely a misspelling of ${n}`),!0)};function Que(a,n,i){if(typeof a!="object")throw new tr("options must be an object",tr.ERR_BAD_OPTION_VALUE);const s=Object.keys(a);let l=s.length;for(;l-- >0;){const p=s[l],_=n[p];if(_){const T=a[p],w=T===void 0||_(T,p,a);if(w!==!0)throw new tr("option "+p+" must be "+w,tr.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new tr("Unknown option "+p,tr.ERR_BAD_OPTION)}}const _N={assertOptions:Que,validators:uD},Cu=_N.validators;let y_=class{constructor(n){this.defaults=n||{},this.interceptors={request:new h8,response:new h8}}async request(n,i){try{return await this._request(n,i)}catch(s){if(s instanceof Error){let l={};Error.captureStackTrace?Error.captureStackTrace(l):l=new Error;const p=l.stack?l.stack.replace(/^.+\n/,""):"";try{s.stack?p&&!String(s.stack).endsWith(p.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+p):s.stack=p}catch{}}throw s}}_request(n,i){typeof n=="string"?(i=i||{},i.url=n):i=n||{},i=I_(this.defaults,i);const{transitional:s,paramsSerializer:l,headers:p}=i;s!==void 0&&_N.assertOptions(s,{silentJSONParsing:Cu.transitional(Cu.boolean),forcedJSONParsing:Cu.transitional(Cu.boolean),clarifyTimeoutError:Cu.transitional(Cu.boolean)},!1),l!=null&&(rt.isFunction(l)?i.paramsSerializer={serialize:l}:_N.assertOptions(l,{encode:Cu.function,serialize:Cu.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),_N.assertOptions(i,{baseUrl:Cu.spelling("baseURL"),withXsrfToken:Cu.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let _=p&&rt.merge(p.common,p[i.method]);p&&rt.forEach(["delete","get","head","post","put","patch","common"],W=>{delete p[W]}),i.headers=uc.concat(_,p);const T=[];let w=!0;this.interceptors.request.forEach(function(ee){typeof ee.runWhen=="function"&&ee.runWhen(i)===!1||(w=w&&ee.synchronous,T.unshift(ee.fulfilled,ee.rejected))});const C=[];this.interceptors.response.forEach(function(ee){C.push(ee.fulfilled,ee.rejected)});let O,k=0,U;if(!w){const W=[v8.bind(this),void 0];for(W.unshift.apply(W,T),W.push.apply(W,C),U=W.length,O=Promise.resolve(i);k<U;)O=O.then(W[k++],W[k++]);return O}U=T.length;let Y=i;for(k=0;k<U;){const W=T[k++],ee=T[k++];try{Y=W(Y)}catch(K){ee.call(this,K);break}}try{O=v8.call(this,Y)}catch(W){return Promise.reject(W)}for(k=0,U=C.length;k<U;)O=O.then(C[k++],C[k++]);return O}getUri(n){n=I_(this.defaults,n);const i=Zq(n.baseURL,n.url,n.allowAbsoluteUrls);return Kq(i,n.params,n.paramsSerializer)}};rt.forEach(["delete","get","head","options"],function(n){y_.prototype[n]=function(i,s){return this.request(I_(s||{},{method:n,url:i,data:(s||{}).data}))}});rt.forEach(["post","put","patch"],function(n){function i(s){return function(p,_,T){return this.request(I_(T||{},{method:n,headers:s?{"Content-Type":"multipart/form-data"}:{},url:p,data:_}))}}y_.prototype[n]=i(),y_.prototype[n+"Form"]=i(!0)});let $ue=class sK{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(p){i=p});const s=this;this.promise.then(l=>{if(!s._listeners)return;let p=s._listeners.length;for(;p-- >0;)s._listeners[p](l);s._listeners=null}),this.promise.then=l=>{let p;const _=new Promise(T=>{s.subscribe(T),p=T}).then(l);return _.cancel=function(){s.unsubscribe(p)},_},n(function(p,_,T){s.reason||(s.reason=new nS(p,_,T),i(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const i=this._listeners.indexOf(n);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const n=new AbortController,i=s=>{n.abort(s)};return this.subscribe(i),n.signal.unsubscribe=()=>this.unsubscribe(i),n.signal}static source(){let n;return{token:new sK(function(l){n=l}),cancel:n}}};function Jue(a){return function(i){return a.apply(null,i)}}function Zue(a){return rt.isObject(a)&&a.isAxiosError===!0}const QM={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(QM).forEach(([a,n])=>{QM[n]=a});function aK(a){const n=new y_(a),i=Mq(y_.prototype.request,n);return rt.extend(i,y_.prototype,n,{allOwnKeys:!0}),rt.extend(i,n,null,{allOwnKeys:!0}),i.create=function(l){return aK(I_(a,l))},i}const Ri=aK(yR);Ri.Axios=y_;Ri.CanceledError=nS;Ri.CancelToken=$ue;Ri.isCancel=$q;Ri.VERSION=iK;Ri.toFormData=lD;Ri.AxiosError=tr;Ri.Cancel=Ri.CanceledError;Ri.all=function(n){return Promise.all(n)};Ri.spread=Jue;Ri.isAxiosError=Zue;Ri.mergeConfig=I_;Ri.AxiosHeaders=uc;Ri.formToJSON=a=>Qq(rt.isHTMLForm(a)?new FormData(a):a);Ri.getAdapter=rK.getAdapter;Ri.HttpStatusCode=QM;Ri.default=Ri;const{Axios:KRe,AxiosError:XRe,CanceledError:QRe,isCancel:$Re,CancelToken:JRe,VERSION:ZRe,all:e0e,Cancel:t0e,isAxiosError:n0e,spread:r0e,toFormData:i0e,AxiosHeaders:s0e,HttpStatusCode:a0e,formToJSON:o0e,getAdapter:c0e,mergeConfig:l0e}=Ri,mi="https://admin.awplconnect.com/",On=Ri.create({baseURL:`${mi}api`}),ehe=a=>On.post("/email-valid",a),the=a=>On.post("/login-password",a),nhe=a=>On.post("/forgot-password",a),rhe=a=>On.post("/otp-verfication",a),ihe=a=>On.post("/resend-otp",a),she=a=>On.post("/reset-password",a),ahe=a=>On.post("/first-login",a),ohe=()=>{var a;return On.get("/doctor/profile",{headers:{Authorization:`Bearer ${(a=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:a.token}`}})},che=a=>{var n;return On.post("/doctor/profile/update",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},lhe=a=>{var n;return On.post("/doctor/profile/photo",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},dhe=()=>{var a;return On.delete("/doctor/profile/photo",{headers:{Authorization:`Bearer ${(a=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:a.token}`}})},uhe=()=>{var a;return On.get("/doctor/prescriptions/pending",{headers:{Authorization:`Bearer ${(a=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:a.token}`}})},hhe=()=>{var a;return On.get("/doctor/prescriptions/completed",{headers:{Authorization:`Bearer ${(a=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:a.token}`}})},phe=a=>{var n;return On.post("/getScheduleTime",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`}})},fhe=a=>{var n;return On.post("/get_symptom",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},mhe=a=>{var n;return On.post("/doctor/prescriptions/submit",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"application/json"}})},ghe=a=>{var n;return On.post("/create-channel",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"application/json"}})},_he=a=>{var n;return On.post("/call-joined",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"application/json"}})},Ehe=a=>{var n;return On.post("/doctor-home",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},yhe=a=>{var n;return On.post("/api/logout",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`}})},vhe=()=>{var a;return On.post("/doctor/appointments/upcoming",{},{headers:{Authorization:`Bearer ${(a=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:a.token}`}})},She=()=>{var a;return On.post("/doctor/appointments/completed",{},{headers:{Authorization:`Bearer ${(a=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:a.token}`}})},The=()=>{var a;return On.post("/doctor/appointments/cancelled",{},{headers:{Authorization:`Bearer ${(a=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:a.token}`}})},bhe=()=>{var a;return On.post("/doctor/appointments/incomplete",{},{headers:{Authorization:`Bearer ${(a=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:a.token}`}})},whe=()=>{var a;return On.post("/doctor/appointments/missed",{},{headers:{Authorization:`Bearer ${(a=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:a.token}`}})},Rhe=a=>{var n;return On.post("/doctor/appointments/cancel",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Che=a=>{var n;return On.post("/doctor/appointments/details",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Ahe=a=>{var n;return On.post("/doctor/prescriptions/details",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Ihe=a=>{var n;return On.post("/doctor/patients/profile",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Nhe=a=>{var n;return On.post("/doctor/prescriptions/download",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"},responseType:"blob"})},Ohe=()=>{var a;return On.get("/doctor/notifications",{headers:{Authorization:`Bearer ${(a=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:a.token}`}})},Dhe=a=>{var n;return On.delete("/doctor/notifications/delete",{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"application/json"},data:{notification_ids:a}})},xhe=a=>{var n;return On.patch("/doctor/notifications/read",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"application/json"}})},Phe=a=>{var n;return On.post("/doctor/medicines/search",null,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},khe=()=>{var a;return On.get("/doctor/notifications/unread-count",{headers:{Authorization:`Bearer ${(a=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:a.token}`}})},Lhe=()=>{var a;return On.get("/doctor/appointment-notifications-status",{headers:{Authorization:`Bearer ${(a=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:a.token}`}})},Mhe=a=>{var n;return On.patch("/doctor/appointment-notifications-toggle",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`}})},jhe=a=>{var n;return On.post("/doctor/patients/past",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Uhe=a=>{var n;return On.post("/doctor/appointments/reminders",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`}})},Vhe=a=>{var n;return On.post("/doctor/appointments/scheduleAppointmentByDoctor",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Fhe=a=>{var n;return On.post("/doctor/prescriptions/submit_appointment_prescription",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"application/json"}})},Bhe=a=>{var n;return On.post("/doctor/treatments",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Hhe=a=>{var n;return On.post("/getChat",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Ghe=a=>{var n;return On.post("/doctor/unavailability/submit",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Whe=()=>{var a;return On.get("/doctor/unavailability/list",{headers:{Authorization:`Bearer ${(a=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:a.token}`}})},zhe=()=>{var a;return On.get("/doctor/unavailability/all-list",{headers:{Authorization:`Bearer ${(a=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:a.token}`}})},Yhe=a=>{var n;return On.post("/doctor/unavailability/confirm",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},qhe=a=>{var n;return On.post("/doctor/unavailability/respond",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Khe=a=>{var n;return On.post("/doctor/unavailability/doctors",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Xhe=a=>{var n;return On.post("/doctor/unavailability/mark-doctor-available",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Qhe=a=>{var n;return On.post("/doctor/unavailability/submit-by-hod",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},$he=a=>{var n;return On.post("/submitFeedback",a,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})};function oK(a){var n,i,s="";if(typeof a=="string"||typeof a=="number")s+=a;else if(typeof a=="object")if(Array.isArray(a)){var l=a.length;for(n=0;n<l;n++)a[n]&&(i=oK(a[n]))&&(s&&(s+=" "),s+=i)}else for(i in a)a[i]&&(s&&(s+=" "),s+=i);return s}function $i(){for(var a,n,i=0,s="",l=arguments.length;i<l;i++)(a=arguments[i])&&(n=oK(a))&&(s&&(s+=" "),s+=n);return s}function Jhe(a){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=a:i.appendChild(document.createTextNode(a))}Jhe(`:root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
`);var vR=a=>typeof a=="number"&&!isNaN(a),N_=a=>typeof a=="string",dp=a=>typeof a=="function",Zhe=a=>N_(a)||vR(a),$M=a=>N_(a)||dp(a)?a:null,epe=(a,n)=>a===!1||vR(a)&&a>0?a:n,JM=a=>F.isValidElement(a)||N_(a)||dp(a)||vR(a);function tpe(a,n,i=300){let{scrollHeight:s,style:l}=a;requestAnimationFrame(()=>{l.minHeight="initial",l.height=s+"px",l.transition=`all ${i}ms`,requestAnimationFrame(()=>{l.height="0",l.padding="0",l.margin="0",setTimeout(n,i)})})}function npe({enter:a,exit:n,appendPosition:i=!1,collapse:s=!0,collapseDuration:l=300}){return function({children:p,position:_,preventExitTransition:T,done:w,nodeRef:C,isIn:O,playToast:k}){let U=i?`${a}--${_}`:a,Y=i?`${n}--${_}`:n,W=F.useRef(0);return F.useLayoutEffect(()=>{let ee=C.current,K=U.split(" "),ie=se=>{se.target===C.current&&(k(),ee.removeEventListener("animationend",ie),ee.removeEventListener("animationcancel",ie),W.current===0&&se.type!=="animationcancel"&&ee.classList.remove(...K))};ee.classList.add(...K),ee.addEventListener("animationend",ie),ee.addEventListener("animationcancel",ie)},[]),F.useEffect(()=>{let ee=C.current,K=()=>{ee.removeEventListener("animationend",K),s?tpe(ee,w,l):w()};O||(T?K():(W.current=1,ee.className+=` ${Y}`,ee.addEventListener("animationend",K)))},[O]),Ge.createElement(Ge.Fragment,null,p)}}function T8(a,n){return{content:cK(a.content,a.props),containerId:a.props.containerId,id:a.props.toastId,theme:a.props.theme,type:a.props.type,data:a.props.data||{},isLoading:a.props.isLoading,icon:a.props.icon,reason:a.removalReason,status:n}}function cK(a,n,i=!1){return F.isValidElement(a)&&!N_(a.type)?F.cloneElement(a,{closeToast:n.closeToast,toastProps:n,data:n.data,isPaused:i}):dp(a)?a({closeToast:n.closeToast,toastProps:n,data:n.data,isPaused:i}):a}function rpe({closeToast:a,theme:n,ariaLabel:i="close"}){return Ge.createElement("button",{className:`Toastify__close-button Toastify__close-button--${n}`,type:"button",onClick:s=>{s.stopPropagation(),a(!0)},"aria-label":i},Ge.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},Ge.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function ipe({delay:a,isRunning:n,closeToast:i,type:s="default",hide:l,className:p,controlledProgress:_,progress:T,rtl:w,isIn:C,theme:O}){let k=l||_&&T===0,U={animationDuration:`${a}ms`,animationPlayState:n?"running":"paused"};_&&(U.transform=`scaleX(${T})`);let Y=$i("Toastify__progress-bar",_?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${O}`,`Toastify__progress-bar--${s}`,{"Toastify__progress-bar--rtl":w}),W=dp(p)?p({rtl:w,type:s,defaultClassName:Y}):$i(Y,p),ee={[_&&T>=1?"onTransitionEnd":"onAnimationEnd"]:_&&T<1?null:()=>{C&&i()}};return Ge.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":k},Ge.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${O} Toastify__progress-bar--${s}`}),Ge.createElement("div",{role:"progressbar","aria-hidden":k?"true":"false","aria-label":"notification timer",className:W,style:U,...ee}))}var spe=1,lK=()=>`${spe++}`;function ape(a,n,i){let s=1,l=0,p=[],_=[],T=n,w=new Map,C=new Set,O=se=>(C.add(se),()=>C.delete(se)),k=()=>{_=Array.from(w.values()),C.forEach(se=>se())},U=({containerId:se,toastId:ue,updateId:ye})=>{let ae=se?se!==a:a!==1,ve=w.has(ue)&&ye==null;return ae||ve},Y=(se,ue)=>{w.forEach(ye=>{var ae;(ue==null||ue===ye.props.toastId)&&((ae=ye.toggle)==null||ae.call(ye,se))})},W=se=>{var ue,ye;(ye=(ue=se.props)==null?void 0:ue.onClose)==null||ye.call(ue,se.removalReason),se.isActive=!1},ee=se=>{if(se==null)w.forEach(W);else{let ue=w.get(se);ue&&W(ue)}k()},K=()=>{l-=p.length,p=[]},ie=se=>{var ue,ye;let{toastId:ae,updateId:ve}=se.props,$=ve==null;se.staleId&&w.delete(se.staleId),se.isActive=!0,w.set(ae,se),k(),i(T8(se,$?"added":"updated")),$&&((ye=(ue=se.props).onOpen)==null||ye.call(ue))};return{id:a,props:T,observe:O,toggle:Y,removeToast:ee,toasts:w,clearQueue:K,buildToast:(se,ue)=>{if(U(ue))return;let{toastId:ye,updateId:ae,data:ve,staleId:$,delay:Q}=ue,te=ae==null;te&&l++;let oe={...T,style:T.toastStyle,key:s++,...Object.fromEntries(Object.entries(ue).filter(([fe,pe])=>pe!=null)),toastId:ye,updateId:ae,data:ve,isIn:!1,className:$M(ue.className||T.toastClassName),progressClassName:$M(ue.progressClassName||T.progressClassName),autoClose:ue.isLoading?!1:epe(ue.autoClose,T.autoClose),closeToast(fe){w.get(ye).removalReason=fe,ee(ye)},deleteToast(){let fe=w.get(ye);if(fe!=null){if(i(T8(fe,"removed")),w.delete(ye),l--,l<0&&(l=0),p.length>0){ie(p.shift());return}k()}}};oe.closeButton=T.closeButton,ue.closeButton===!1||JM(ue.closeButton)?oe.closeButton=ue.closeButton:ue.closeButton===!0&&(oe.closeButton=JM(T.closeButton)?T.closeButton:!0);let re={content:se,props:oe,staleId:$};T.limit&&T.limit>0&&l>T.limit&&te?p.push(re):vR(Q)?setTimeout(()=>{ie(re)},Q):ie(re)},setProps(se){T=se},setToggle:(se,ue)=>{let ye=w.get(se);ye&&(ye.toggle=ue)},isToastActive:se=>{var ue;return(ue=w.get(se))==null?void 0:ue.isActive},getSnapshot:()=>_}}var Lo=new Map,tR=[],ZM=new Set,ope=a=>ZM.forEach(n=>n(a)),dK=()=>Lo.size>0;function cpe(){tR.forEach(a=>hK(a.content,a.options)),tR=[]}var lpe=(a,{containerId:n})=>{var i;return(i=Lo.get(n||1))==null?void 0:i.toasts.get(a)};function uK(a,n){var i;if(n)return!!((i=Lo.get(n))!=null&&i.isToastActive(a));let s=!1;return Lo.forEach(l=>{l.isToastActive(a)&&(s=!0)}),s}function dpe(a){if(!dK()){tR=tR.filter(n=>a!=null&&n.options.toastId!==a);return}if(a==null||Zhe(a))Lo.forEach(n=>{n.removeToast(a)});else if(a&&("containerId"in a||"id"in a)){let n=Lo.get(a.containerId);n?n.removeToast(a.id):Lo.forEach(i=>{i.removeToast(a.id)})}}var upe=(a={})=>{Lo.forEach(n=>{n.props.limit&&(!a.containerId||n.id===a.containerId)&&n.clearQueue()})};function hK(a,n){JM(a)&&(dK()||tR.push({content:a,options:n}),Lo.forEach(i=>{i.buildToast(a,n)}))}function hpe(a){var n;(n=Lo.get(a.containerId||1))==null||n.setToggle(a.id,a.fn)}function pK(a,n){Lo.forEach(i=>{(n==null||!(n!=null&&n.containerId)||(n==null?void 0:n.containerId)===i.id)&&i.toggle(a,n==null?void 0:n.id)})}function ppe(a){let n=a.containerId||1;return{subscribe(i){let s=ape(n,a,ope);Lo.set(n,s);let l=s.observe(i);return cpe(),()=>{l(),Lo.delete(n)}},setProps(i){var s;(s=Lo.get(n))==null||s.setProps(i)},getSnapshot(){var i;return(i=Lo.get(n))==null?void 0:i.getSnapshot()}}}function fpe(a){return ZM.add(a),()=>{ZM.delete(a)}}function mpe(a){return a&&(N_(a.toastId)||vR(a.toastId))?a.toastId:lK()}function SR(a,n){return hK(a,n),n.toastId}function hD(a,n){return{...n,type:n&&n.type||a,toastId:mpe(n)}}function pD(a){return(n,i)=>SR(n,hD(a,i))}function ct(a,n){return SR(a,hD("default",n))}ct.loading=(a,n)=>SR(a,hD("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...n}));function gpe(a,{pending:n,error:i,success:s},l){let p;n&&(p=N_(n)?ct.loading(n,l):ct.loading(n.render,{...l,...n}));let _={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},T=(C,O,k)=>{if(O==null){ct.dismiss(p);return}let U={type:C,..._,...l,data:k},Y=N_(O)?{render:O}:O;return p?ct.update(p,{...U,...Y}):ct(Y.render,{...U,...Y}),k},w=dp(a)?a():a;return w.then(C=>T("success",s,C)).catch(C=>T("error",i,C)),w}ct.promise=gpe;ct.success=pD("success");ct.info=pD("info");ct.error=pD("error");ct.warning=pD("warning");ct.warn=ct.warning;ct.dark=(a,n)=>SR(a,hD("default",{theme:"dark",...n}));function _pe(a){dpe(a)}ct.dismiss=_pe;ct.clearWaitingQueue=upe;ct.isActive=uK;ct.update=(a,n={})=>{let i=lpe(a,n);if(i){let{props:s,content:l}=i,p={delay:100,...s,...n,toastId:n.toastId||a,updateId:lK()};p.toastId!==a&&(p.staleId=a);let _=p.render||l;delete p.render,SR(_,p)}};ct.done=a=>{ct.update(a,{progress:1})};ct.onChange=fpe;ct.play=a=>pK(!0,a);ct.pause=a=>pK(!1,a);function Epe(a){var n;let{subscribe:i,getSnapshot:s,setProps:l}=F.useRef(ppe(a)).current;l(a);let p=(n=F.useSyncExternalStore(i,s,s))==null?void 0:n.slice();function _(T){if(!p)return[];let w=new Map;return a.newestOnTop&&p.reverse(),p.forEach(C=>{let{position:O}=C.props;w.has(O)||w.set(O,[]),w.get(O).push(C)}),Array.from(w,C=>T(C[0],C[1]))}return{getToastToRender:_,isToastActive:uK,count:p==null?void 0:p.length}}function ype(a){let[n,i]=F.useState(!1),[s,l]=F.useState(!1),p=F.useRef(null),_=F.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:T,pauseOnHover:w,closeToast:C,onClick:O,closeOnClick:k}=a;hpe({id:a.toastId,containerId:a.containerId,fn:i}),F.useEffect(()=>{if(a.pauseOnFocusLoss)return U(),()=>{Y()}},[a.pauseOnFocusLoss]);function U(){document.hasFocus()||ie(),window.addEventListener("focus",K),window.addEventListener("blur",ie)}function Y(){window.removeEventListener("focus",K),window.removeEventListener("blur",ie)}function W($){if(a.draggable===!0||a.draggable===$.pointerType){se();let Q=p.current;_.canCloseOnClick=!0,_.canDrag=!0,Q.style.transition="none",a.draggableDirection==="x"?(_.start=$.clientX,_.removalDistance=Q.offsetWidth*(a.draggablePercent/100)):(_.start=$.clientY,_.removalDistance=Q.offsetHeight*(a.draggablePercent===80?a.draggablePercent*1.5:a.draggablePercent)/100)}}function ee($){let{top:Q,bottom:te,left:oe,right:re}=p.current.getBoundingClientRect();$.nativeEvent.type!=="touchend"&&a.pauseOnHover&&$.clientX>=oe&&$.clientX<=re&&$.clientY>=Q&&$.clientY<=te?ie():K()}function K(){i(!0)}function ie(){i(!1)}function se(){_.didMove=!1,document.addEventListener("pointermove",ye),document.addEventListener("pointerup",ae)}function ue(){document.removeEventListener("pointermove",ye),document.removeEventListener("pointerup",ae)}function ye($){let Q=p.current;if(_.canDrag&&Q){_.didMove=!0,n&&ie(),a.draggableDirection==="x"?_.delta=$.clientX-_.start:_.delta=$.clientY-_.start,_.start!==$.clientX&&(_.canCloseOnClick=!1);let te=a.draggableDirection==="x"?`${_.delta}px, var(--y)`:`0, calc(${_.delta}px + var(--y))`;Q.style.transform=`translate3d(${te},0)`,Q.style.opacity=`${1-Math.abs(_.delta/_.removalDistance)}`}}function ae(){ue();let $=p.current;if(_.canDrag&&_.didMove&&$){if(_.canDrag=!1,Math.abs(_.delta)>_.removalDistance){l(!0),a.closeToast(!0),a.collapseAll();return}$.style.transition="transform 0.2s, opacity 0.2s",$.style.removeProperty("transform"),$.style.removeProperty("opacity")}}let ve={onPointerDown:W,onPointerUp:ee};return T&&w&&(ve.onMouseEnter=ie,a.stacked||(ve.onMouseLeave=K)),k&&(ve.onClick=$=>{O&&O($),_.canCloseOnClick&&C(!0)}),{playToast:K,pauseToast:ie,isRunning:n,preventExitTransition:s,toastRef:p,eventHandlers:ve}}var vpe=typeof window<"u"?F.useLayoutEffect:F.useEffect,fD=({theme:a,type:n,isLoading:i,...s})=>Ge.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:a==="colored"?"currentColor":`var(--toastify-icon-color-${n})`,...s});function Spe(a){return Ge.createElement(fD,{...a},Ge.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))}function Tpe(a){return Ge.createElement(fD,{...a},Ge.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))}function bpe(a){return Ge.createElement(fD,{...a},Ge.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))}function wpe(a){return Ge.createElement(fD,{...a},Ge.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))}function Rpe(){return Ge.createElement("div",{className:"Toastify__spinner"})}var e2={info:Tpe,warning:Spe,success:bpe,error:wpe,spinner:Rpe},Cpe=a=>a in e2;function Ape({theme:a,type:n,isLoading:i,icon:s}){let l=null,p={theme:a,type:n};return s===!1||(dp(s)?l=s({...p,isLoading:i}):F.isValidElement(s)?l=F.cloneElement(s,p):i?l=e2.spinner():Cpe(n)&&(l=e2[n](p))),l}var Ipe=a=>{let{isRunning:n,preventExitTransition:i,toastRef:s,eventHandlers:l,playToast:p}=ype(a),{closeButton:_,children:T,autoClose:w,onClick:C,type:O,hideProgressBar:k,closeToast:U,transition:Y,position:W,className:ee,style:K,progressClassName:ie,updateId:se,role:ue,progress:ye,rtl:ae,toastId:ve,deleteToast:$,isIn:Q,isLoading:te,closeOnClick:oe,theme:re,ariaLabel:fe}=a,pe=$i("Toastify__toast",`Toastify__toast-theme--${re}`,`Toastify__toast--${O}`,{"Toastify__toast--rtl":ae},{"Toastify__toast--close-on-click":oe}),Ne=dp(ee)?ee({rtl:ae,position:W,type:O,defaultClassName:pe}):$i(pe,ee),Je=Ape(a),be=!!ye||!w,Ie={closeToast:U,type:O,theme:re},Re=null;return _===!1||(dp(_)?Re=_(Ie):F.isValidElement(_)?Re=F.cloneElement(_,Ie):Re=rpe(Ie)),Ge.createElement(Y,{isIn:Q,done:$,position:W,preventExitTransition:i,nodeRef:s,playToast:p},Ge.createElement("div",{id:ve,tabIndex:0,onClick:C,"data-in":Q,className:Ne,...l,style:K,ref:s,...Q&&{role:ue,"aria-label":fe}},Je!=null&&Ge.createElement("div",{className:$i("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!te})},Je),cK(T,a,!n),Re,!a.customProgressBar&&Ge.createElement(ipe,{...se&&!be?{key:`p-${se}`}:{},rtl:ae,theme:re,delay:w,isRunning:n,isIn:Q,closeToast:U,hide:k,type:O,className:ie,controlledProgress:be,progress:ye||0})))},Npe=(a,n=!1)=>({enter:`Toastify--animate Toastify__${a}-enter`,exit:`Toastify--animate Toastify__${a}-exit`,appendPosition:n}),Ope=npe(Npe("bounce",!0)),Dpe={position:"top-right",transition:Ope,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light","aria-label":"Notifications Alt+T",hotKeys:a=>a.altKey&&a.code==="KeyT"};function nj(a){let n={...Dpe,...a},i=a.stacked,[s,l]=F.useState(!0),p=F.useRef(null),{getToastToRender:_,isToastActive:T,count:w}=Epe(n),{className:C,style:O,rtl:k,containerId:U,hotKeys:Y}=n;function W(K){let ie=$i("Toastify__toast-container",`Toastify__toast-container--${K}`,{"Toastify__toast-container--rtl":k});return dp(C)?C({position:K,rtl:k,defaultClassName:ie}):$i(ie,$M(C))}function ee(){i&&(l(!0),ct.play())}return vpe(()=>{var K;if(i){let ie=p.current.querySelectorAll('[data-in="true"]'),se=12,ue=(K=n.position)==null?void 0:K.includes("top"),ye=0,ae=0;Array.from(ie).reverse().forEach((ve,$)=>{let Q=ve;Q.classList.add("Toastify__toast--stacked"),$>0&&(Q.dataset.collapsed=`${s}`),Q.dataset.pos||(Q.dataset.pos=ue?"top":"bot");let te=ye*(s?.2:1)+(s?0:se*$);Q.style.setProperty("--y",`${ue?te:te*-1}px`),Q.style.setProperty("--g",`${se}`),Q.style.setProperty("--s",`${1-(s?ae:0)}`),ye+=Q.offsetHeight,ae+=.025})}},[s,w,i]),F.useEffect(()=>{function K(ie){var se;let ue=p.current;Y(ie)&&((se=ue.querySelector('[tabIndex="0"]'))==null||se.focus(),l(!1),ct.pause()),ie.key==="Escape"&&(document.activeElement===ue||ue!=null&&ue.contains(document.activeElement))&&(l(!0),ct.play())}return document.addEventListener("keydown",K),()=>{document.removeEventListener("keydown",K)}},[Y]),Ge.createElement("section",{ref:p,className:"Toastify",id:U,onMouseEnter:()=>{i&&(l(!1),ct.pause())},onMouseLeave:ee,"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text","aria-label":n["aria-label"]},_((K,ie)=>{let se=ie.length?{...O}:{...O,pointerEvents:"none"};return Ge.createElement("div",{tabIndex:-1,className:W(K),"data-stacked":i,style:se,key:`c-${K}`},ie.map(({content:ue,props:ye})=>Ge.createElement(Ipe,{...ye,stacked:i,collapseAll:ee,isIn:T(ye.toastId,ye.containerId),key:`t-${ye.key}`},ue)))}))}function $I(){ct.error("Token Expired"),localStorage.removeItem("nfc-admin"),setTimeout(()=>{window.location.href="/"},1e3)}const EN=$t("doctor/emailCheck",async(a,{rejectWithValue:n})=>{var i;try{return(await ehe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),yN=$t("doctor/login",async(a,{rejectWithValue:n})=>{var i;try{return(await the(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),vN=$t("doctor/forgotPassword",async(a,{rejectWithValue:n})=>{var i;try{return(await nhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),SN=$t("doctor/otpVerification",async(a,{rejectWithValue:n})=>{var i;try{return(await rhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),TN=$t("doctor/resendOtp",async(a,{rejectWithValue:n})=>{var i;try{return(await ihe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),bN=$t("doctor/resetPassword",async(a,{rejectWithValue:n})=>{var i;try{return(await she(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),wN=$t("doctor/firstLogin",async(a,{rejectWithValue:n})=>{var i;try{return(await ahe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),v_=$t("doctor/getDoctorProfile",async(a,{rejectWithValue:n})=>{var i;try{return(await ohe()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),RN=$t("doctor/doctorProfileUpdate",async(a,{rejectWithValue:n})=>{var i;try{return(await che(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),CN=$t("doctor/doctorPhotoUpdate",async(a,{rejectWithValue:n})=>{var i;try{return(await lhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),AN=$t("doctor/deleteDoctorPhoto",async(a,{rejectWithValue:n})=>{var i;try{return(await dhe()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),IN=$t("doctor/doctorPendingPrescriptions",async(a,{rejectWithValue:n})=>{var i;try{return(await uhe()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),WL=$t("doctor/doctorCompletedPrescriptions",async(a,{rejectWithValue:n})=>{var i;try{return(await hhe()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),NN=$t("doctor/symptomUploadDetails",async(a,{rejectWithValue:n})=>{var i;try{return(await fhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),zL=$t("doctor/completePrescription",async(a,{rejectWithValue:n})=>{var i;try{return(await mhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),ON=$t("doctor/logout",async(a,{rejectWithValue:n})=>{var i;try{return(await yhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),Uw=$t("user/medicineSearch",async(a,{rejectWithValue:n})=>{var i;try{return(await Phe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),YL=$t("user/getAllUser",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}});$t("user/userId",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}});const qL=$t("user/create",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),KL=$t("user/editUser",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),XL=$t("user/delete",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),xpe=sm({name:"user",initialState:{user:[],pendingPrescription:[],completedPrescription:[],symptomUploadDetail:[],medicineSearch:[],completeAssignedPrescription:null,loading:!1,loading2:!1,error:null,message:null},reducers:{},extraReducers:a=>{a.addCase(EN.pending,n=>{n.loading=!0,n.error=null}).addCase(EN.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(EN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(yN.pending,n=>{n.loading=!0,n.error=null}).addCase(yN.fulfilled,(n,i)=>{var s,l;n.loading=!1,n.user=i.payload,localStorage.setItem("doctor-app",JSON.stringify({doctorData:(s=i.payload.data)==null?void 0:s.doctor,token:(l=i.payload.data)==null?void 0:l.token}))}).addCase(yN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload,ct.error(i.payload.message)}).addCase(vN.pending,n=>{n.loading=!0,n.error=null}).addCase(vN.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(vN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(SN.pending,n=>{n.loading=!0,n.error=null}).addCase(SN.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(SN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(TN.pending,n=>{n.loading=!0,n.error=null}).addCase(TN.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(TN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(bN.pending,n=>{n.loading=!0,n.error=null}).addCase(bN.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(bN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(wN.pending,n=>{n.loading=!0,n.error=null}).addCase(wN.fulfilled,(n,i)=>{var s,l;n.loading=!1,n.user=i.payload,localStorage.setItem("doctor-app",JSON.stringify({doctorData:(s=i.payload.data)==null?void 0:s.doctor,token:(l=i.payload.data)==null?void 0:l.token}))}).addCase(wN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(v_.pending,n=>{n.loading=!0,n.error=null}).addCase(v_.fulfilled,(n,i)=>{var s,l;n.loading=!1,n.user=(l=(s=i.payload)==null?void 0:s.data)==null?void 0:l.doctor}).addCase(v_.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(RN.pending,n=>{n.loading=!0,n.error=null}).addCase(RN.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(RN.rejected,(n,i)=>{var s,l,p,_,T,w;n.loading=!1,n.error=i.payload,ct.error(((p=(l=(s=i.payload)==null?void 0:s.data)==null?void 0:l.experience)==null?void 0:p[0])||((w=(T=(_=i.payload)==null?void 0:_.data)==null?void 0:T.contact_no)==null?void 0:w[0]))}).addCase(CN.pending,n=>{n.loading=!0,n.error=null}).addCase(CN.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(CN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(AN.pending,n=>{n.loading=!0,n.error=null}).addCase(AN.fulfilled,(n,i)=>{n.loading=!1,n.user&&(n.user.profile_path=null)}).addCase(AN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(IN.pending,n=>{n.loading=!0,n.error=null}).addCase(IN.fulfilled,(n,i)=>{var s;n.loading=!1,n.pendingPrescription=(s=i.payload.data)==null?void 0:s.pending_prescriptions}).addCase(IN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(WL.pending,n=>{n.loading=!0,n.error=null}).addCase(WL.fulfilled,(n,i)=>{var s;n.loading=!1,n.completedPrescription=(s=i.payload.data)==null?void 0:s.completed_prescriptions}).addCase(WL.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(NN.pending,n=>{n.loading=!0,n.error=null}).addCase(NN.fulfilled,(n,i)=>{n.loading=!1,n.symptomUploadDetail=i.payload.data}).addCase(NN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(zL.pending,n=>{n.loading=!0,n.error=null}).addCase(zL.fulfilled,(n,i)=>{n.loading=!1,n.completeAssignedPrescription=i.payload}).addCase(zL.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(ON.pending,n=>{n.loading=!0,n.error=null}).addCase(ON.fulfilled,n=>{n.loading=!1,n.user=null,localStorage.removeItem("doctor-app")}).addCase(ON.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(Uw.pending,n=>{n.loading2=!0,n.error=null}).addCase(Uw.fulfilled,(n,i)=>{var s,l;n.loading2=!1,n.medicineSearch=(l=(s=i.payload)==null?void 0:s.data)==null?void 0:l.results}).addCase(Uw.rejected,(n,i)=>{n.loading2=!1,n.error=i.payload||"Failed to search medicine",ct.error(i.payload.message||"Failed to search medicine")}).addCase(YL.pending,n=>{n.loading=!0,n.error=null}).addCase(YL.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(YL.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&$I()}).addCase(qL.pending,n=>{n.loading=!0,n.error=null}).addCase(qL.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload,n.message="User created successfully",ct.success(i.payload.message||"User created successfully")}).addCase(qL.rejected,(n,i)=>{var s;n.loading=!1,n.error=((s=i.payload)==null?void 0:s.errors)||"User creation failed",i.payload.message=="Unauthenticated."&&$I()}).addCase(KL.pending,n=>{n.loading=!0,n.error=null}).addCase(KL.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload,n.message="User updated successfully"}).addCase(KL.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to update user",i.payload.message=="Unauthenticated."&&$I()}).addCase(XL.pending,n=>{n.loading=!0,n.error=null}).addCase(XL.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload,n.message="User Deleted successfully",ct.success(i.payload.message||"User deleted successfully")}).addCase(XL.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to delete user",ct.error(i.payload.message||"Failed to delete user"),i.payload.message=="Unauthenticated."&&$I()})}}),Ppe=xpe.reducer;var fK={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},b8=Ge.createContext&&Ge.createContext(fK),kpe=["attr","size","title"];function Lpe(a,n){if(a==null)return{};var i=Mpe(a,n),s,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(a);for(l=0;l<p.length;l++)s=p[l],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(a,s)&&(i[s]=a[s])}return i}function Mpe(a,n){if(a==null)return{};var i={};for(var s in a)if(Object.prototype.hasOwnProperty.call(a,s)){if(n.indexOf(s)>=0)continue;i[s]=a[s]}return i}function vO(){return vO=Object.assign?Object.assign.bind():function(a){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(a[s]=i[s])}return a},vO.apply(this,arguments)}function w8(a,n){var i=Object.keys(a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);n&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(a,l).enumerable})),i.push.apply(i,s)}return i}function SO(a){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?w8(Object(i),!0).forEach(function(s){jpe(a,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):w8(Object(i)).forEach(function(s){Object.defineProperty(a,s,Object.getOwnPropertyDescriptor(i,s))})}return a}function jpe(a,n,i){return n=Upe(n),n in a?Object.defineProperty(a,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):a[n]=i,a}function Upe(a){var n=Vpe(a,"string");return typeof n=="symbol"?n:n+""}function Vpe(a,n){if(typeof a!="object"||!a)return a;var i=a[Symbol.toPrimitive];if(i!==void 0){var s=i.call(a,n);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(a)}function mK(a){return a&&a.map((n,i)=>Ge.createElement(n.tag,SO({key:i},n.attr),mK(n.child)))}function rS(a){return n=>Ge.createElement(Fpe,vO({attr:SO({},a.attr)},n),mK(a.child))}function Fpe(a){var n=i=>{var{attr:s,size:l,title:p}=a,_=Lpe(a,kpe),T=l||i.size||"1em",w;return i.className&&(w=i.className),a.className&&(w=(w?w+" ":"")+a.className),Ge.createElement("svg",vO({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,s,_,{className:w,style:SO(SO({color:a.color||i.color},i.style),a.style),height:T,width:T,xmlns:"http://www.w3.org/2000/svg"}),p&&Ge.createElement("title",null,p),a.children)};return b8!==void 0?Ge.createElement(b8.Consumer,null,i=>n(i)):n(fK)}function QL(){ct.error("Token Expired"),localStorage.removeItem("doctor-app"),setTimeout(()=>{window.location.href="/"},1e3)}const ep=$t("notification/getAllNotifications",async(a,{rejectWithValue:n})=>{var i;try{return(await Ohe()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),DN=$t("doctor/deleteNotification",async(a,{rejectWithValue:n})=>{var i;try{const s=await Dhe(a);return{deletedIds:a}}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),Vw=$t("doctor/markAllRead",async(a,{rejectWithValue:n})=>{var i;try{return(await xhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),Av=$t("/doctor/unreadCount",async(a,{rejectWithValue:n})=>{var i;try{return(await khe()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),xN=$t("/doctor/checkToggleNotification",async(a,{rejectWithValue:n})=>{var i;try{return(await Lhe()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),PN=$t("/doctor/changeAppointmentNotificaiton",async(a,{rejectWithValue:n})=>{var i;try{return(await Mhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),kN=$t("/getChat",async(a,{rejectWithValue:n})=>{var i;try{return(await Hhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}});$t("/doctor/toggleNotifications",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}});const LN=$t("/doctor/reminderPopup",async(a,{rejectWithValue:n})=>{var i;try{return(await Uhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),Bpe=sm({name:"Notification",initialState:{doctorNotifications:[],unreadCounts:[],isNotificationActive:!1,reminderPopupData:[],loading:!1,error:null,newNotificaion:null},reducer:{},extraReducers:a=>{a.addCase(ep.pending,n=>{n.loading=!0,n.error=null}).addCase(ep.fulfilled,(n,i)=>{n.loading=!1,n.doctorNotifications=i.payload.data}).addCase(ep.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&QL()}).addCase(DN.pending,n=>{n.loading=!0,n.error=null}).addCase(DN.fulfilled,(n,i)=>{const s=i.payload.deletedIds,l=p=>(p==null?void 0:p.filter(_=>!s.includes(_.id)))??[];n.doctorNotifications.today=l(n.doctorNotifications.today),n.doctorNotifications.yesterday=l(n.doctorNotifications.yesterday),n.doctorNotifications.older=l(n.doctorNotifications.older)}).addCase(DN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&QL()}).addCase(Vw.pending,n=>{n.loading=!0,n.error=null}).addCase(Vw.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(Vw.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to update user",i.payload.message=="Unauthenticated."&&QL()}).addCase(Av.pending,n=>{n.loading=!0,n.error=null}).addCase(Av.fulfilled,(n,i)=>{n.loading=!1,n.unreadCounts=i.payload.data.count}).addCase(Av.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch unread count"}).addCase(xN.pending,n=>{n.loading=!0}).addCase(xN.fulfilled,(n,i)=>{n.loading=!1,n.isNotificationActive=i.payload.data.isActive}).addCase(xN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to Get Notification Status"}).addCase(kN.pending,n=>{n.loading=!0}).addCase(kN.fulfilled,(n,i)=>{var s,l,p;n.loading=!1,n.newNotificaion=i.payload.data,((s=i.payload.data)==null?void 0:s.notification_count)==0||(l=i.payload.data)!=null&&l.notification_message&&ct.success((p=i.payload.data)==null?void 0:p.notification_message)}).addCase(kN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to Get Notification Status"}).addCase(PN.pending,n=>{n.loading=!0}).addCase(PN.fulfilled,(n,i)=>{n.loading=!1,n.isNotificationActive=i.payload.data.isActive}).addCase(PN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to Update Notification Status"}).addCase(LN.pending,n=>{n.loading=!0}).addCase(LN.fulfilled,(n,i)=>{n.loading=!1,n.reminderPopupData=i.payload.data}).addCase(LN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to Update Notification Status"})}}),Hpe=Bpe.reducer,Gpe="https://admin.awplconnect.com",Mc={BaseUrl:Gpe},Ga=()=>{const[a,n]=F.useState(!1),[i,s]=F.useState(!1),[l,p]=F.useState(!1),_=ds(),T=Li(),w=Wi(),{user:C}=Tr(se=>se.user),{unreadCounts:O,isNotificationActive:k}=Tr(se=>se.notification),{doctorNotifications:U,loading:Y,error:W}=Tr(se=>se.notification),ee=U==null?void 0:U.unread_new_message_count;F.useEffect(()=>{T(Av()),T(xN())},[T]),F.useEffect(()=>{C!=null&&C.profile_path||T(v_())},[T,C]);const K=()=>{n(!1),localStorage.removeItem("doctor-app"),T(ON()),_("/"),localStorage.removeItem("feedbackPopup")};F.useEffect(()=>{const se=JSON.parse(localStorage.getItem("doctor-app")).doctorData;se&&p(se.is_hod)},[]),F.useEffect(()=>{T(kN()),T(ep())},[w==null?void 0:w.pathname]);const ie=()=>{T(PN({isActive:!k}))};return m.jsxs(m.Fragment,{children:[i&&m.jsx("div",{onClick:()=>s(!1),style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.3)",zIndex:999}}),m.jsx("div",{className:"sidebar",style:{transform:i?"translateX(0)":"translateX(-100%)",transition:"transform 0.3s ease-in-out",position:"fixed",left:0,top:0,width:"280px",height:"100%",backgroundColor:"#fff",zIndex:1e3},children:m.jsxs("div",{className:"sidebar-inr",children:[m.jsx("div",{className:"sidebar-close",onClick:()=>s(!1),style:{cursor:"pointer",padding:"10px",textAlign:"right"},children:m.jsx("i",{className:"fa-solid fa-times-circle"})}),m.jsxs("div",{className:"doc-profile-wrp",children:[m.jsx("div",{className:"doc-img ml-0 ms-0",children:m.jsx("img",{src:`${Mc==null?void 0:Mc.BaseUrl}${C==null?void 0:C.profile_path}`,alt:"Doctor"})}),m.jsxs("div",{className:"doc-profile-body",children:[m.jsx("p",{children:(C==null?void 0:C.name)||"Doctor Name"}),m.jsx(dn,{to:"/UserProfile",className:"view-profile",onClick:()=>s(!1),children:"View my profile"})]})]}),m.jsx("div",{className:"sidebar-nav",children:m.jsxs("ul",{children:[m.jsxs("li",{children:[m.jsx("img",{src:"/images/dash.svg",alt:"Icon",style:{height:"18px",width:"18px"}}),m.jsx(dn,{to:"/doctor-home",onClick:()=>s(!1),children:"Dashboard"})]}),m.jsx("li",{children:m.jsxs("div",{className:"notification-set",children:[m.jsxs("div",{className:"not-set-left",children:[m.jsx("img",{src:"/images/notification-icon.svg",alt:"Notification",style:{height:"18px",width:"18px"}}),m.jsx("span",{children:"Notification"})]}),m.jsx("div",{className:"not-set-right",children:m.jsxs("div",{className:"not-toggler",children:[m.jsx("input",{type:"checkbox",id:"notificationToggle",checked:k,onChange:ie}),m.jsx("label",{htmlFor:"notificationToggle"})]})})]})}),m.jsxs("li",{children:[m.jsx("img",{src:"/images/appointment-icon.svg",alt:"Icon",style:{height:"18px",width:"18px"}}),m.jsx(dn,{to:"/my-appointments",onClick:()=>s(!1),children:"My Appointments"})]}),m.jsxs("li",{children:[m.jsx("img",{src:"/images/pending-prescription-icon.svg",alt:"Icon",style:{height:"18px",width:"18px"}}),m.jsx(dn,{to:"/pendingprescription",onClick:()=>s(!1),children:"Pending prescriptions"})]}),m.jsxs("li",{children:[m.jsx("img",{src:"/images/past-patients-icon.svg",alt:"Icon",style:{height:"18px",width:"18px"}}),m.jsx(dn,{to:"/pastpatient",onClick:()=>s(!1),children:"My Past Patients"})]}),m.jsxs("li",{children:[m.jsx("img",{src:"https://uxwing.com/wp-content/themes/uxwing/download/web-app-development/database-delete-icon.png",alt:"Icon",style:{height:"18px",width:"18px"}}),m.jsx(dn,{to:"/doctorUnavailibility",onClick:()=>s(!1),children:"Mark Unavailability"})]}),l&&(C==null?void 0:C.is_hod)&&m.jsxs("li",{children:[m.jsx("img",{src:"/images/user-tie.com.svg",alt:"Icon",style:{height:"18px",width:"18px"}}),m.jsx(dn,{to:"/hod",onClick:()=>s(!1),children:"Unavailability Management"})]}),m.jsxs("li",{className:"logout",children:[m.jsx("img",{src:"/images/menu-logout-icon.svg",alt:"Icon",style:{height:"18px",width:"18px"}}),m.jsxs(Pi,{variant:"link",style:{textDecoration:"none",color:"black",fontWeight:"600",textTransform:"none"},onClick:()=>n(!0),children:["Logout ",m.jsx("i",{className:"fa-solid fa-chevron-right"})]})]})]})})]})}),m.jsxs("div",{className:"doc-panel-header",style:{display:"flex",alignItems:"center",padding:"15px 10px",background:"#fff",justifyContent:"space-between"},children:[m.jsx("button",{type:"button",className:"docpnl-hdr-toggler",onClick:()=>s(!0),style:{background:"transparent",border:"none",cursor:"pointer"},children:m.jsx("img",{src:"/images/bars.svg",alt:"Menu"})}),m.jsx("div",{className:"logo",children:m.jsx(dn,{to:"/doctor-home",children:m.jsx("img",{src:"/images/logo.png",alt:"Logo"})})}),m.jsxs("div",{className:"notifications",children:[m.jsx(dn,{to:"/notifications",children:m.jsx("img",{src:"/images/notification-icon-2.svg",alt:"Notification"})}),ee>0&&m.jsx("div",{style:{backgroundColor:"red",width:ee>9?"25px":"20px",height:"20px",borderRadius:"10px",color:"white",position:"absolute",top:-10,right:0},children:m.jsx("p",{style:{fontWeight:"bold",marginLeft:5},children:ee>9?"9+":ee})}),ee===0&&O>0&&m.jsx("span",{})]})]}),a&&m.jsx("div",{className:"modal fade show popup-wrp small-pop dash-pop",tabIndex:"-1",style:{display:"block",background:"rgba(0,0,0,0.5)"},children:m.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:m.jsxs("div",{className:"modal-content",children:[m.jsx("button",{type:"button",className:"close",onClick:()=>n(!1),"aria-label":"Close",children:m.jsx("span",{"aria-hidden":"true",children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close"})})}),m.jsx("div",{className:"modal-icon",children:m.jsx("img",{src:"/images/logout-icon.svg",alt:"Icon"})}),m.jsxs("div",{className:"modal-header",children:[m.jsx("h2",{children:"Logout"}),m.jsx("p",{children:"Are you sure you want to logout?"})]}),m.jsxs("div",{className:"modal-footer btn-wrp",children:[m.jsx("button",{type:"button",className:"cmn-btn",onClick:()=>n(!1),children:"Cancel"}),m.jsx("button",{type:"button",className:"cmn-btn orange-btn",onClick:K,children:"Logout"})]})]})})})]})},po=()=>m.jsxs("div",{className:"panel-footer",children:[m.jsx("div",{className:"copyright",children:m.jsxs("p",{children:[" ",m.jsx("span",{className:"curryr",children:new Date().getFullYear()})," . All rights reserved."]})}),m.jsx("div",{className:"ftr-right"})]}),Wpe=()=>{const[a,n]=F.useState(!1),i=Li(),{loading:s}=Tr(O=>O.user),[l,p]=F.useState(""),[_,T]=F.useState(""),w=ds();F.useEffect(()=>{localStorage.getItem("doctor-app")&&w("/doctor-home")},[]);const C=async O=>{var Y,W,ee,K;if(O.preventDefault(),!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(l)){T("Please enter a valid email address");return}T("");const U=await i(EN({email:l}));((Y=U.payload.data)==null?void 0:Y.verified)==1&&((W=U.payload.data)==null?void 0:W.new_user)==1?w("/create-password",{state:{email:l}}):((ee=U.payload.data)==null?void 0:ee.verified)==1&&((K=U.payload.data)==null?void 0:K.new_user)==0?w("/login-password",{state:{email:l}}):n(!0)};return m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"sign-sec",children:m.jsx("div",{className:"container",children:m.jsx("div",{className:"sign-sec-inr",children:m.jsxs("div",{className:"sign-inr-row row",children:[m.jsx("div",{className:"sign-left-wrp col-lg-7",children:m.jsxs("div",{className:"sign-left has-texture",children:[m.jsx("div",{className:"texture",children:m.jsx("img",{src:"./images/doctor-symbol.png",alt:"Doctor Symbol"})}),m.jsx("div",{className:"sign-left-img",children:m.jsx("img",{src:"./images/login-left-img.png",alt:"Login Left Image"})})]})}),m.jsx("div",{className:"sign-right-wrp col-lg-5",children:m.jsxs("div",{className:"sign-right",children:[m.jsx("div",{className:"logo-wrp",children:m.jsx("div",{className:"logo-inr-wrp",children:m.jsx("span",{children:m.jsx("img",{src:"./images/logo.png",alt:"Logo"})})})}),m.jsxs("div",{className:"sign-inr-head",children:[m.jsx("h1",{children:"Login as Doctor"}),m.jsx("p",{children:"Use credentials to access your account"})]}),m.jsx("div",{className:"sign-form",children:m.jsx("form",{onSubmit:C,children:m.jsx("div",{className:"sign-form-steps-wrp",children:m.jsxs("div",{className:"sign-form-step email-step",children:[m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Enter Email Id"}),m.jsx("input",{type:"email",placeholder:"Enter Your Email Id",required:!0,value:l,onChange:O=>{p(O.target.value),_&&T("")}}),_&&m.jsx("div",{className:"text-danger mt-1",style:{fontSize:"0.9rem"},children:_})]}),m.jsx("input",{type:"submit",value:"Next"})]})})})})]})})]})})})}),m.jsx(bn,{show:a,onHide:()=>n(!1),centered:!0,className:"popup-wrp",children:m.jsxs(bn.Body,{className:"text-center",children:[m.jsx("div",{className:"modal-icon",children:m.jsx("img",{src:"/images/wrong-mail-icon.png",alt:"Icon"})}),m.jsxs(bn.Header,{className:"modal-header",children:[m.jsx("h2",{children:"Unrecognized Email Id"}),m.jsx("p",{children:"Your Email Id is not registered yet."})]}),m.jsx(bn.Footer,{className:"modal-footer",children:m.jsx(Pi,{className:"orange-btn",onClick:()=>n(!1),children:"OK"})})]})})]})},zpe=()=>{const a=ds(),n=Li(),{loading:i}=Tr(ee=>ee.user),s=Wi(),{email:l,password:p}=s.state||{},[_,T]=F.useState(""),[w,C]=F.useState(!1),[O,k]=F.useState(!1),U=async ee=>{if(ee.preventDefault(),!/^(?=.*[a-z])(?=.*[A-Z])(?=.*[\d\W]).{8,}$/.test(_)){ct.error("Please enter a valid password");return}const ie=await n(yN({email:l,password:_}));ie.payload&&ie.payload.status&&C(!0)},Y=()=>{k(ee=>!ee)},W=()=>{C(!1),a("/doctor-home",{replace:!0})};return m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"sign-sec",children:m.jsx("div",{className:"container",children:m.jsx("div",{className:"sign-sec-inr",children:m.jsxs("div",{className:"sign-inr-row row",children:[m.jsx("div",{className:"sign-left-wrp col-lg-7",children:m.jsxs("div",{className:"sign-left has-texture",children:[m.jsx("div",{className:"texture",children:m.jsx("img",{src:"./images/doctor-symbol.png",alt:"Doctor Symbol"})}),m.jsx("div",{className:"sign-left-img",children:m.jsx("img",{src:"./images/login-left-img.png",alt:"Login Left Image"})})]})}),m.jsx("div",{className:"sign-right-wrp col-lg-5",children:m.jsxs("div",{className:"sign-right",children:[m.jsx("div",{className:"logo-wrp",children:m.jsx("div",{className:"logo-inr-wrp",children:m.jsx("span",{children:m.jsx("img",{src:"./images/logo.png",alt:"Logo"})})})}),m.jsxs("div",{className:"sign-inr-head",children:[m.jsx("h1",{children:"Login as Doctor"}),m.jsx("p",{children:"Use credentials to access your account"})]}),m.jsx("div",{className:"sign-form",children:m.jsx("form",{onSubmit:U,children:m.jsx("div",{className:"sign-form-steps-wrp",children:m.jsxs("div",{className:"sign-form-step",children:[m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Enter Password"}),m.jsxs("div",{className:"input-pass-field",children:[m.jsx("input",{type:O?"text":"password",id:"password",placeholder:"Password",required:!0,value:_,onChange:ee=>T(ee.target.value)}),m.jsx("span",{className:"eye-btn",onClick:Y,style:{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",cursor:"pointer"},children:m.jsx("img",{src:O?"./images/eye-open.svg":"./images/eye-close.svg",alt:O?"Hide password":"Show password"})})]})]}),m.jsx("div",{className:"text-right",children:m.jsx(dn,{to:"/forgot-password",className:"forgot-pass",children:"Forgot password?"})}),m.jsxs("button",{type:"submit",className:"orange-btn",children:[" ","Login"," "]})]})})})})]})})]})})})}),m.jsxs(bn,{show:w,onHide:()=>{},centered:!0,className:"popup-wrp",id:"congratulations",dialogClassName:"custom-modal",children:[m.jsx("style",{children:`
                      .custom-modal .modal-content{
                        padding:30px 0 50px 0;
                        margin:0;
                      }
            
                    `}),m.jsx("div",{className:"modal-icon text-center mt-4",children:m.jsx("img",{src:"/images/check-icon.png",alt:"Icon"})}),m.jsxs(bn.Header,{className:"border-0 flex-column text-center",children:[m.jsx(bn.Title,{id:"exampleModalLongTitle",className:"w-100",children:m.jsx("h2",{children:"Login Successful"})}),m.jsx("p",{children:"Welcome to the world of health."})]}),m.jsx(bn.Footer,{className:"d-flex justify-content-center border-0",children:m.jsx("button",{className:"orange-btn",onClick:W,children:"Ok"})})]})]})},Ype=()=>{const a=ds(),n=Li(),[i,s]=F.useState(""),{loading:l}=Tr(_=>_.user),p=async _=>{if(_.preventDefault(),!i.trim()){ct.error("Please enter the email");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){ct.error("Invalid email");return}(await n(vN({email:i}))).payload.status?a("/otp-verification",{state:{sendEmail:i}}):ct.error("Email is not registered")};return m.jsx("div",{className:"sign-sec pt-0",children:m.jsx("div",{className:"container",children:m.jsxs("div",{className:"sign-sec-inr",children:[m.jsx("div",{className:"docpnl-sec-head",style:{padding:"0",margin:"0"},children:m.jsx("div",{className:"back-btn",style:{padding:"0",margin:"0"},children:m.jsx(dn,{to:"/",children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})}),m.jsxs("div",{className:"sign-inr-row row",style:{padding:"0",margin:"0"},children:[m.jsx("div",{className:"sign-left-wrp col-lg-7",style:{padding:"0",margin:"0"},children:m.jsxs("div",{className:"sign-left has-texture",children:[m.jsx("div",{className:"texture",children:m.jsx("img",{src:"./images/doctor-symbol.png",alt:"Doctor Symbol"})}),m.jsx("div",{className:"sign-left-img",children:m.jsx("img",{src:"./images/forgot-pass-bnr.png",alt:"Forgot Password Banner",style:{width:"80%"}})})]})}),m.jsx("div",{className:"sign-right-wrp col-lg-5",style:{padding:"0",margin:"0"},children:m.jsxs("div",{className:"sign-right",children:[m.jsx("div",{className:"logo-wrp",children:m.jsx("div",{className:"logo-inr-wrp",children:m.jsx("span",{children:m.jsx("img",{src:"./images/logo.png",alt:"Logo"})})})}),m.jsxs("div",{className:"sign-inr-head",children:[m.jsx("h1",{children:"Forgot Password"}),m.jsx("p",{children:"Select which contact details should be used to reset your password"})]}),m.jsx("div",{className:"sign-form",children:m.jsx("form",{onSubmit:p,children:m.jsx("div",{className:"sign-form-steps-wrp",children:m.jsxs("div",{className:"sign-form-step",children:[m.jsxs("div",{className:"formfield mb-0",children:[m.jsx("label",{children:"Enter Email Id"}),m.jsx("input",{type:"email",placeholder:"Enter Your Email Id",value:i,onChange:_=>s(_.target.value)})]}),m.jsx("input",{type:"submit",value:l?"Loading...":"Continue"})]})})})})]})})]})]})})})},qpe=()=>{const a=Li(),n=ds(),i=Wi(),[s,l]=F.useState(0),{sendEmail:p}=i.state||{},[_,T]=F.useState(!1),w=p,[C,O]=F.useState(["","","","",""]),k=F.useRef([]);F.useEffect(()=>{if(s>0){const se=setInterval(()=>{l(ue=>ue-1)},1e3);return()=>clearInterval(se)}},[s]);const U=(se,ue)=>{if(ue.length>1)return;const ye=[...C];ye[se]=ue,O(ye),ue&&se<4&&k.current[se+1].focus()},Y=(se,ue)=>{ue.key==="Backspace"&&!C[se]&&se>0&&k.current[se-1].focus()},W=se=>{se.preventDefault();const ue=se.clipboardData.getData("text/plain").slice(0,5),ye=[...C];ue.split("").forEach((ae,ve)=>{ve<5&&(ye[ve]=ae,ve<4&&k.current[ve+1].focus())}),O(ye)},ee=async se=>{if(se.preventDefault(),C.some(ye=>ye===""))return ct.error("Please enter the OTP");(await a(SN({email:p,otp:C.join("")}))).payload.status?n("/set-password",{state:{email:w}}):ct.error("Please enter the correct OTP.")},K=async se=>{if(se.preventDefault(),s>0)return;(await a(TN({email:w,otp:C.join("")}))).payload.status?(ct.success("OTP resent successfully."),l(120)):ct.error("Failed to resend OTP.")},ie=se=>{const ue=Math.floor(se/60),ye=se%60,ae=String(ue).padStart(2,"0"),ve=String(ye).padStart(2,"0");return`${ae}:${ve}`};return m.jsx(m.Fragment,{children:m.jsx("div",{className:"sign-sec pt-0",children:m.jsx("div",{className:"container",children:m.jsxs("div",{className:"sign-sec-inr",children:[m.jsx("div",{className:"docpnl-sec-head",style:{padding:"0",margin:"0"},children:m.jsx("div",{className:"back-btn",style:{padding:"0",margin:"0"},children:m.jsx(dn,{to:"/forgot-password",children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})}),m.jsxs("div",{className:"sign-inr-row row",style:{padding:"0",margin:"0"},children:[m.jsx("div",{className:"sign-left-wrp col-lg-7",style:{padding:"0",margin:"0"},children:m.jsxs("div",{className:"sign-left has-texture",children:[m.jsx("div",{className:"texture",children:m.jsx("img",{src:"./images/doctor-symbol.png",alt:"Doctor Symbol"})}),m.jsx("div",{className:"sign-left-img",children:m.jsx("img",{src:"./images/otp-bnr.png",alt:"OTP Banner",style:{width:"63%"}})})]})}),m.jsx("div",{className:"sign-right-wrp col-lg-5",style:{padding:"0",margin:"0"},children:m.jsxs("div",{className:"sign-right",children:[m.jsx("div",{className:"logo-wrp",children:m.jsx("div",{className:"logo-inr-wrp",children:m.jsx("span",{children:m.jsx("img",{src:"./images/logo.png",alt:"Logo"})})})}),m.jsxs("div",{className:"sign-inr-head",children:[m.jsx("h1",{children:"Enter Verification Code"}),m.jsx("p",{children:"We have sent the code verification to your registered email id"})]}),m.jsx("div",{className:"sign-form",children:m.jsx("form",{onSubmit:ee,children:m.jsx("div",{className:"sign-form-steps-wrp",children:m.jsxs("div",{className:"sign-form-step",children:[m.jsx("div",{className:"formfield",children:m.jsx("div",{className:"otp-container",style:{display:"flex",gap:"10px",justifyContent:"center",marginBottom:"10px"},children:[0,1,2,3,4].map(se=>m.jsx("input",{id:`otp-${se}`,ref:ue=>k.current[se]=ue,type:"number",maxLength:1,value:C[se],className:"otp-verification-code-in",onChange:ue=>U(se,ue.target.value),onKeyDown:ue=>Y(se,ue),onPaste:W},se))})}),m.jsx("div",{className:"resend-code",style:{paddingRight:"18px"},children:m.jsxs("p",{children:["Didnt get a Code?",s>0?m.jsxs("span",{style:{color:"#888",marginLeft:5},children:["Resend in"," ",m.jsxs("span",{style:{color:"#199FD9"},children:[ie(s),"sec"]})]}):m.jsx(dn,{to:"#",onClick:K,style:{color:"#199FD9",marginLeft:5},children:"Resend"})]})}),m.jsx("input",{type:"submit",value:"Continue"})]})})})})]})})]})]})})})})},Kpe=()=>{const[a,n]=F.useState(""),[i,s]=F.useState(""),[l,p]=F.useState(!1),[_,T]=F.useState(!1),[w,C]=F.useState(!1),O=ds(),k=Li(),U=Wi(),{email:Y}=U.state||{},W=async ee=>{var ie,se;if(ee.preventDefault(),a.trim()||ct.error("Please enter the password"),!i.trim()){ct.error("Please confirm your password");return}if(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*[\d\W]).{8,}$/.test(a)){ct.error("Password must be at least 8 characters long and include at least one uppercase letter, one lowercase letter, and one number or special character.");return}if(a!==i){ct.error("Passwords do not match");return}try{const ue=await k(bN({email:Y,password:a}));(ie=ue.payload)!=null&&ie.status?C(!0):ct.error(((se=ue.payload)==null?void 0:se.message)||"Password reset failed")}catch{ct.error("An error occurred during password reset")}};return m.jsxs("div",{className:"sign-sec set-pass pt-0",children:[m.jsx("div",{className:"container",children:m.jsxs("div",{className:"sign-sec-inr",children:[m.jsx("div",{className:"docpnl-sec-head",children:m.jsx("div",{className:"back-btn",children:m.jsx(dn,{to:"/login-password",children:m.jsx("img",{src:"/images/left-arrow.svg",alt:"Icon"})})})}),m.jsxs("div",{className:"sign-inr-row row",children:[m.jsx("div",{className:"sign-left-wrp col-lg-7",children:m.jsxs("div",{className:"sign-left has-texture",children:[m.jsx("div",{className:"texture",children:m.jsx("img",{src:"/images/doctor-symbol.png",alt:"Doctor Symbol"})}),m.jsx("div",{className:"sign-left-img",children:m.jsx("img",{src:"/images/new-pass-bnr.png",alt:"Login Left Image"})})]})}),m.jsx("div",{className:"sign-right-wrp col-lg-5",children:m.jsxs("div",{className:"sign-right",children:[m.jsx("div",{className:"logo-wrp",children:m.jsx("div",{className:"logo-inr-wrp",children:m.jsx("span",{children:m.jsx("img",{src:"/images/logo.png",alt:"Logo"})})})}),m.jsxs("div",{className:"sign-inr-head",children:[m.jsx("h1",{children:"Enter New Password"}),m.jsx("p",{children:"Please enter your new password"})]}),m.jsx("div",{className:"sign-form",children:m.jsx("form",{onSubmit:W,children:m.jsx("div",{className:"sign-form-steps-wrp",children:m.jsxs("div",{className:"sign-form-step",children:[m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Enter New Password"}),m.jsxs("div",{className:"input-pass-field position-relative",children:[m.jsx("input",{type:l?"text":"password",placeholder:"Password",value:a,onChange:ee=>{n(ee.target.value)}}),m.jsx("span",{className:"eye-btn",onClick:()=>{p(!l)},style:{cursor:"pointer",position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)"},children:m.jsx("img",{src:l?"/images/eye-open.svg":"/images/eye-close.svg",alt:l?"Hide Password":"Show Password"})})]})]}),m.jsxs("div",{className:"formfield mb-0",children:[m.jsx("label",{children:"Confirm New Password"}),m.jsxs("div",{className:"input-pass-field position-relative",children:[m.jsx("input",{type:_?"text":"password",placeholder:"Password",value:i,onChange:ee=>{s(ee.target.value)}}),m.jsx("span",{className:"eye-btn",onClick:()=>{T(!_)},style:{cursor:"pointer",position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)"},children:m.jsx("img",{src:_?"/images/eye-open.svg":"/images/eye-close.svg",alt:_?"Hide Password":"Show Password"})})]})]}),m.jsx(Pi,{type:"submit",className:"orange-btn mt-3",children:"Continue"})]})})})})]})})]})]})}),m.jsxs(bn,{show:w,onHide:()=>C(!1),centered:!0,className:"popup-wrp",dialogClassName:"custom-modal",children:[m.jsx("style",{children:`
    .custom-modal .modal-content {
      padding: 30px 0 50px 0;
      margin: 0;
      position: relative; /* needed for absolute close icon */
    }
  `}),m.jsx("div",{className:"modal-icon text-center mt-4",children:m.jsx("img",{src:"/images/check-icon.png",alt:"Success"})}),m.jsx("span",{"aria-hidden":"true",onClick:()=>{C(!1),O("/login-password")},style:{position:"absolute",top:"15px",right:"15px",cursor:"pointer",zIndex:1051},children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close"})}),m.jsxs(bn.Header,{className:"border-0 flex-column text-center",children:[m.jsx(bn.Title,{className:"w-100",children:m.jsx("h2",{children:"Congratulations"})}),m.jsx("p",{children:"Your account is ready to use."})]}),m.jsx(bn.Footer,{className:"d-flex justify-content-center border-0",children:m.jsx(dn,{to:"/",className:"orange-btn",onClick:()=>C(!1),children:"Continue"})})]})]})},tp=({visible:a,title:n,subtitle:i,onCancel:s,onConfirm:l,inputField:p=!1,inputValue:_="",onInputChange:T=()=>{},actionType:w="cancel"})=>{if(!a)return null;const C=()=>{switch(w){case"cancel":return"/images/cancel-icon.png";case"success":return"/images/check-icon.png";default:return null}};return m.jsx("div",{className:"modal fade show d-block popup-wrp dash-pop",tabIndex:"-1",role:"dialog",children:m.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:m.jsxs("div",{className:`modal-content ${w==="info"?"large-pop":"small-pop"}`,children:[w!=="info"&&m.jsx("div",{className:"modal-icon",style:{cursor:w==="cancel"?"pointer":"default"},onClick:w==="cancel"?s:null,children:m.jsx("img",{src:C(),alt:"Icon"})}),w!=="success"&&m.jsx("button",{type:"button",className:"close",onClick:s,"aria-label":"Close",children:m.jsx("span",{"aria-hidden":"true",children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close"})})}),m.jsxs("div",{className:"modal-header",children:[m.jsx("h2",{children:n}),w!=="info"&&m.jsx("p",{children:i})]}),p&&m.jsx("div",{className:"modal-body",children:m.jsx("form",{children:m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Reason for cancellation."}),m.jsx("textarea",{placeholder:"Give the reason.",required:!0,value:_,onChange:O=>T(O.target.value)})]})})}),m.jsx("div",{className:"modal-footer btn-wrp",children:w==="cancel"?m.jsxs(m.Fragment,{children:[m.jsx("button",{className:"cmn-btn white-input",onClick:s,children:"No"}),m.jsx("button",{className:"orange-btn",onClick:l,children:"Yes"})]}):w==="info"?m.jsx("button",{className:"orange-btn",onClick:l,children:"Submit"}):m.jsx("button",{className:"orange-btn",onClick:l,children:"Ok"})})]})})})},h_=$t("doctor/doctorHomeDashboard",async(a,{rejectWithValue:n})=>{var i;try{return(await Ehe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),Iv=$t("/doctor/patients/past",async(a,{rejectWithValue:n})=>{var i;try{return(await jhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),Fw=$t("/doctor/treatments",async(a,{rejectWithValue:n})=>{var i;try{return(await Bhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),$L=$t("doctor/videoCallSubmit",async(a,{rejectWithValue:n})=>{var i;try{return(await Fhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),Xpe=sm({name:"dataSlice",initialState:{userdata:[],pastPatients:[],videoSubmit:null,loading:!1,error:null,message:null,allMedicine:{}},reducers:{},extraReducers:a=>{a.addCase(h_.pending,n=>{n.loading=!0,n.error=null}).addCase(h_.fulfilled,(n,i)=>{n.loading=!1,n.userdata=i.payload.data}).addCase(h_.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(Fw.pending,n=>{n.loading=!0,n.error=null}).addCase(Fw.fulfilled,(n,i)=>{n.loading=!1,n.allMedicine=i.payload.data}).addCase(Fw.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(Iv.pending,n=>{n.loading=!0,n.error=null}).addCase(Iv.fulfilled,(n,i)=>{var s,l;n.loading=!1,n.pastPatients=(l=(s=i.payload)==null?void 0:s.data)==null?void 0:l.past_patients}).addCase(Iv.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase($L.pending,n=>{n.loading=!0,n.error=null}).addCase($L.fulfilled,(n,i)=>{n.loading=!1,n.videoSubmit=i.payload}).addCase($L.rejected,(n,i)=>{n.loading=!1,n.error=i.payload})}}),Qpe=Xpe.reducer;function Au(){ct.error("Token Expired"),localStorage.removeItem("doctor-app"),setTimeout(()=>{window.location.href="/"},1e3)}const Bw=$t("user/getAllUpcomingAppointment",async(a,{rejectWithValue:n})=>{var i;try{return(await vhe()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),MN=$t("user/getAllIncompletedAppointment",async(a,{rejectWithValue:n})=>{var i;try{return(await bhe()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),jN=$t("user/getAllMissedAppointment",async(a,{rejectWithValue:n})=>{var i;try{return(await whe()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),JL=$t("create-channel",async(a,{rejectWithValue:n})=>{var i;try{return(await ghe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),Hw=$t("/call-notification",async(a,{rejectWithValue:n})=>{var i;try{return(await _he(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),UN=$t("user/getAllCompletedAppointment",async(a,{rejectWithValue:n})=>{var i;try{return(await She()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),VN=$t("user/getAllCanceledAppointment",async(a,{rejectWithValue:n})=>{var i;try{return(await The()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),Nv=$t("user/doctorCanceledAppointment",async(a,{rejectWithValue:n})=>{var i;try{return(await Rhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),FN=$t("user/patientAppointmentDetails",async(a,{rejectWithValue:n})=>{var i;try{return(await Che(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}});$t("user/userId",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}});const ZL=$t("user/delete",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),$pe=sm({name:"Appointment",initialState:{upcommingAppointment:[],upcomingLoading:!1,completedAppointment:[],completedLoading:!1,cancelledAppointment:[],cancelledLoading:!1,incompletedAppointment:[],missedAppointment:[],incompletedLoading:!1,missedLoading:!1,doctorCancelledAppointment:[],doctorcancelledLoading:!1,patientAppointmentsDetail:[],patientAppointmentsDetailLoading:!1,channelDetails:null,channelDetailsLoading:!1,pushNotificationLoading:!1,pushnotification:null,error:null},reducers:{},extraReducers:a=>{a.addCase(Bw.pending,n=>{n.upcomingLoading=!0,n.error=null}).addCase(Bw.fulfilled,(n,i)=>{var s,l;n.upcomingLoading=!1,n.upcommingAppointment=(l=(s=i.payload)==null?void 0:s.data)==null?void 0:l.upcomingAppointments}).addCase(Bw.rejected,(n,i)=>{n.upcomingLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Au()}).addCase(UN.pending,n=>{n.completedLoading=!0,n.error=null}).addCase(UN.fulfilled,(n,i)=>{n.completedLoading=!1,n.completedAppointment=i.payload.data.completed_appointments}).addCase(UN.rejected,(n,i)=>{n.completedLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Au()}).addCase(VN.pending,n=>{n.cancelledLoading=!0,n.error=null}).addCase(VN.fulfilled,(n,i)=>{n.cancelledLoading=!1,n.cancelledAppointment=i.payload.data.cancelled_appointments}).addCase(VN.rejected,(n,i)=>{n.cancelledLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Au()}).addCase(MN.pending,n=>{n.incompletedLoading=!0,n.error=null}).addCase(MN.fulfilled,(n,i)=>{var s,l;n.incompletedLoading=!1,n.incompletedAppointment=(l=(s=i.payload)==null?void 0:s.data)==null?void 0:l.incomplete_appointments}).addCase(MN.rejected,(n,i)=>{n.incompletedLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Au()}).addCase(jN.pending,n=>{n.missedLoading=!0,n.error=null}).addCase(jN.fulfilled,(n,i)=>{var s,l;n.missedLoading=!1,n.missedAppointment=(l=(s=i.payload)==null?void 0:s.data)==null?void 0:l.missed_appointments}).addCase(jN.rejected,(n,i)=>{n.missedLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Au()}).addCase(Nv.pending,n=>{n.doctorcancelledLoading=!0,n.error=null}).addCase(Nv.fulfilled,(n,i)=>{n.doctorcancelledLoading=!1,n.doctorcancelledAppointment=i.payload}).addCase(Nv.rejected,(n,i)=>{n.doctorcancelledLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Au()}).addCase(FN.pending,n=>{n.patientAppointmentsDetailLoading=!0,n.error=null}).addCase(FN.fulfilled,(n,i)=>{n.patientAppointmentsDetailLoading=!1,n.patientAppointmentsDetail=i.payload.data}).addCase(FN.rejected,(n,i)=>{n.patientAppointmentsDetailLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Au()}).addCase(Hw.pending,n=>{n.pushNotificationLoading=!0,n.error=null}).addCase(Hw.fulfilled,(n,i)=>{n.pushNotificationLoading=!1,n.pushnotification=i.payload.data}).addCase(Hw.rejected,(n,i)=>{n.pushNotificationLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Au()}).addCase(JL.pending,n=>{n.channelDetailsLoading=!0,n.error=null}).addCase(JL.fulfilled,(n,i)=>{n.channelDetailsLoading=!1,n.channelDetails=i.payload.data}).addCase(JL.rejected,(n,i)=>{n.channelDetailsLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Au()}).addCase(ZL.pending,n=>{n.loading=!0,n.error=null}).addCase(ZL.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload,n.message="User Deleted successfully",ct.success(i.payload.message||"User deleted successfully")}).addCase(ZL.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to delete user",ct.error(i.payload.message||"Failed to delete user"),i.payload.message=="Unauthenticated."&&Au()})}}),Jpe=$pe.reducer;function Iu(){ct.error("Token Expired"),localStorage.removeItem("doctor-app"),setTimeout(()=>{window.location.href="/"},1e3)}const Ov=$t("doctor/getPatientProfileData",async(a,{rejectWithValue:n})=>{var i;try{return(await Ihe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),BN=$t("doctor/unavailabilityRequest",async(a,{rejectWithValue:n})=>{var i;try{return(await Ghe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),Gw=$t("doctor/doctorUnavailability",async(a,{rejectWithValue:n})=>{var i;try{return(await Whe()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),p_=$t("doctor/hodScreenRequestsList",async(a,{rejectWithValue:n})=>{var i;try{return(await zhe()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),HN=$t("doctor/hodRequestsConfirmButton",async(a,{rejectWithValue:n})=>{var i;try{return(await Yhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),Ww=$t("doctor/hodRequestsRespondButton",async(a,{rejectWithValue:n})=>{var i;try{return(await qhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),f_=$t("doctor/hodScreenDoctorsList",async(a,{rejectWithValue:n})=>{var i;try{return(await Khe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),GN=$t("doctor/markDoctorAvailable",async(a,{rejectWithValue:n})=>{var i;try{return(await Xhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),WN=$t("doctor/unavailabilitySubmitByHod",async(a,{rejectWithValue:n})=>{var i;try{return(await Qhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),zN=$t("doctor/feedbackapi",async(a,{rejectWithValue:n})=>{var i;try{return(await $he(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),Zpe=sm({name:"patientProfile",initialState:{patientProfileData:[],unavailabilityrequest:null,unavailabilityLoading:!1,doctorUnavailabilityList:[],doctorUnavailabilityLoading:!1,hodScreenRequests:[],hodScreenRequestsLoading:!1,hodRequestsConfirmButtonLoading:!1,hodRequestsRespondButtonLoading:!1,hodRequestsRespond:[],hodRequestsConfirm:[],hodScreenDoctorsListLoading:!1,hodScreenDoctors:[],confirmDoctorAvailable:[],markDoctorAvailableLoading:!1,unavailabilitySubmitByHodLoading:!1,doctorUnavailabilitySubmit:[],loading:!1,error:null,feedbackLoading:!1,feedbackSubmit:[]},reducers:{},extraReducers:a=>{a.addCase(Ov.pending,n=>{n.loading=!0,n.error=null}).addCase(Ov.fulfilled,(n,i)=>{var s;n.loading=!1,n.patientProfileData=(s=i.payload)==null?void 0:s.data}).addCase(Ov.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Iu()}).addCase(BN.pending,n=>{n.unavailabilityLoading=!0,n.error=null}).addCase(BN.fulfilled,(n,i)=>{n.unavailabilityLoading=!1,n.patientProfileData=i.payload}).addCase(BN.rejected,(n,i)=>{n.unavailabilityLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Iu()}).addCase(Gw.pending,n=>{n.doctorUnavailabilityLoading=!0,n.error=null}).addCase(Gw.fulfilled,(n,i)=>{var s;n.doctorUnavailabilityLoading=!1,n.doctorUnavailabilityList=(s=i.payload)==null?void 0:s.data}).addCase(Gw.rejected,(n,i)=>{n.doctorUnavailabilityLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Iu()}).addCase(p_.pending,n=>{n.hodScreenRequestsListLoading=!0,n.error=null}).addCase(p_.fulfilled,(n,i)=>{var s;n.hodScreenRequestsListLoading=!1,n.hodScreenRequests=(s=i.payload)==null?void 0:s.data}).addCase(p_.rejected,(n,i)=>{n.hodScreenRequestsListLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Iu()}).addCase(HN.pending,n=>{n.hodRequestsConfirmButtonLoading=!0,n.error=null}).addCase(HN.fulfilled,(n,i)=>{n.hodRequestsConfirmButtonLoading=!1,n.hodRequestsConfirm=i.payload}).addCase(HN.rejected,(n,i)=>{n.hodRequestsConfirmButtonLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Iu()}).addCase(Ww.pending,n=>{n.hodRequestsRespondButtonLoading=!0,n.error=null}).addCase(Ww.fulfilled,(n,i)=>{n.hodRequestsRespondButtonLoading=!1,n.hodRequestsRespond=i.payload}).addCase(Ww.rejected,(n,i)=>{n.hodRequestsRespondButtonLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Iu()}).addCase(f_.pending,n=>{n.hodScreenDoctorsListLoading=!0,n.error=null}).addCase(f_.fulfilled,(n,i)=>{var s;n.hodScreenDoctorsListLoading=!1,n.hodScreenDoctors=(s=i.payload)==null?void 0:s.data}).addCase(f_.rejected,(n,i)=>{n.hodScreenDoctorsListLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Iu()}).addCase(GN.pending,n=>{n.markDoctorAvailableLoading=!0,n.error=null}).addCase(GN.fulfilled,(n,i)=>{n.markDoctorAvailableLoading=!1,n.confirmDoctorAvailable=i.payload}).addCase(GN.rejected,(n,i)=>{n.markDoctorAvailableLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Iu()}).addCase(WN.pending,n=>{n.unavailabilitySubmitByHodLoading=!0,n.error=null}).addCase(WN.fulfilled,(n,i)=>{n.unavailabilitySubmitByHodLoading=!1,n.doctorUnavailabilitySubmit=i.payload}).addCase(WN.rejected,(n,i)=>{n.unavailabilitySubmitByHodLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Iu()}).addCase(zN.pending,n=>{n.feedbackLoading=!0,n.error=null}).addCase(zN.fulfilled,(n,i)=>{n.feedbackLoading=!1,n.feedbackSubmit=i.payload,localStorage.setItem("feedbackPopup","1")}).addCase(zN.rejected,(n,i)=>{n.feedbackLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Iu()})}}),efe=Zpe.reducer,tfe={channelDetails:null},gK=sm({name:"info",initialState:tfe,reducers:{setVideoData:(a,n)=>{a.channelDetails=n.payload}}}),{setVideoData:_K}=gK.actions,nfe=gK.reducer,rfe=({visible:a,onClose:n})=>{if(!a)return null;const i={position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},s={backgroundColor:"#fff",padding:"40px 30px",borderRadius:"10px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",maxWidth:"400px",width:"90%",textAlign:"center",color:"#333",display:"flex",flexDirection:"column",alignItems:"center",gap:"20px"},l={width:"80px",height:"80px",borderRadius:"50%",border:"4px solid #199fd9",display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"10px"},p={color:"#199fd9",fontSize:"50px",fontWeight:"bold",lineHeight:"1"},_={color:"#333",fontSize:"1.8em",fontWeight:"600",margin:"0"},T={color:"#777",fontSize:"1em",margin:"0",marginBottom:"20px"},w={backgroundColor:"#ff7f00",color:"white",border:"none",padding:"12px 30px",borderRadius:"5px",cursor:"pointer",fontSize:"1.1em",fontWeight:"bold",transition:"background-color 0.3s ease",width:"60%"};return m.jsx("div",{style:i,children:m.jsxs("div",{style:s,children:[m.jsxs("div",{style:l,children:[m.jsx("span",{style:p,children:""})," "]}),m.jsx("h2",{style:_,children:"Access Suspended"}),m.jsxs("p",{style:T,children:["Your access has been suspended by the admin. For support, please contact our admin team at",m.jsx("span",{style:{color:"#199FD9"},children:"awplconnect@asclepiuswellness.co.in"})]}),m.jsx("button",{onClick:n,style:w,children:"Ok"})]})})};function EK(a){return rS({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"},child:[]}]})(a)}function ife(a){return rS({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(a)}function sfe(a){return rS({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(a)}function rj(a){return rS({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M352 240v32c0 6.6-5.4 12-12 12h-88v88c0 6.6-5.4 12-12 12h-32c-6.6 0-12-5.4-12-12v-88h-88c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h88v-88c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v88h88c6.6 0 12 5.4 12 12zm96-160v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48zm-48 346V86c0-3.3-2.7-6-6-6H54c-3.3 0-6 2.7-6 6v340c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"},child:[]}]})(a)}const afe=({rating:a,onRatingChange:n})=>m.jsx("div",{children:[...Array(5)].map((i,s)=>{const l=s+1;return m.jsxs("label",{children:[m.jsx("input",{type:"radio",name:"rating",value:l,onClick:()=>n(l),style:{display:"none"}}),m.jsx(sfe,{className:"star",color:l<=a?"#ffc107":"#e4e5e9",size:30,style:{cursor:"pointer"}})]},s)})}),ofe=()=>{const a=Wi(),n=ds(),[i,s]=F.useState(null),l=JSON.parse(localStorage.getItem("feedbackPopup"));JSON.parse(localStorage.getItem("doctor-app")||"{}").doctorData;const _=Li(),{userdata:T,loading:w,error:C}=Tr(wt=>wt.userdata),{appointmentIdd:O,modaleOpen:k}=a.state||{},{channelDetails:U}=Tr(wt=>wt.appointments),[Y,W]=F.useState(!1),{feedbackSubmit:ee,feedbackLoading:K}=Tr(wt=>wt.patientProfile),{user:ie}=Tr(wt=>wt.user);F.useEffect(()=>{ie!=null&&ie.profile_path||_(v_())},[_,ie]),F.useEffect(()=>{_(h_()).then(wt=>{var jn;const mn=(jn=wt.payload)==null?void 0:jn.data;if(mn&&mn.upcomingAppointments&&mn.upcomingAppointments.length>0){const Ei=mn.upcomingAppointments[0].appointment_starttime;s(new Date(Ei))}}).catch(wt=>{console.error("Error fetching dashboard data:",wt)})},[_]),F.useEffect(()=>{if(i){const wt=new Date,mn=i.getTime()-wt.getTime();if(mn>0){const jn=setTimeout(()=>{_(h_())},mn);return()=>clearTimeout(jn)}else _(h_())}},[i,_]);const[se,ue]=F.useState(!1),[ye,ae]=F.useState(!1),[ve,$]=F.useState(!1),[Q,te]=F.useState(null),[oe,re]=F.useState(""),[fe,pe]=F.useState(!1),[Ne,Je]=F.useState(!1),[be,Ie]=F.useState(!1),[Re,Me]=F.useState(!1),[he,De]=F.useState(!0),qe=()=>{W(!1),n("/login-password"),localStorage.removeItem("doctor-app")},[We,Be]=F.useState(!1),[bt,St]=F.useState(!1),[Tt,ut]=F.useState(null);F.useEffect(()=>{if(T!=null&&T.upcomingAppointments){const wt=T.upcomingAppointments.find(mn=>mn.status===1);wt?(ut(wt),St(!0)):(ut(null),St(!1))}},[T==null?void 0:T.upcomingAppointments]);const tn=wt=>{te(wt),ue(!0)},Mt=()=>{ue(!1),ae(!0)},wn=()=>{_(Nv({appointment_id:Q,cancel_message:oe})).then(()=>{_(h_()),ae(!1),re(""),te(null),$(!0)})};F.useEffect(()=>{const wt=setTimeout(()=>{},1e3),mn=setTimeout(()=>{St(!0)},3e3);return()=>{clearTimeout(wt),clearTimeout(mn)}},[]);const Yt=(T==null?void 0:T.upcomingAppointments)||[],Xn=(T==null?void 0:T.pendingPrescriptions)||[],Ot=fe?Yt:Yt.slice(0,6),en=Ne?Xn:Xn.slice(0,3),Dt=async wt=>{await _(Hw({appointmentId:wt}))};F.useEffect(()=>{_(ep())},[]);const mt=async wt=>{var mn,jn,Ei;Be(!0);try{const ai=(mn=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:mn.token,Cr=await Ri.post(`${mi}api/create-channel`,{appointmentId:wt},{headers:{Authorization:`Bearer ${ai}`,"Content-Type":"application/json"}});Cr.data?(_(_K((jn=Cr==null?void 0:Cr.data)==null?void 0:jn.data)),n("/VideoCall",{state:{id:Tt.appointment_id,patientId:Tt.patient_id,name:Tt==null?void 0:Tt.patient_name,time_period:Tt==null?void 0:Tt.time}}),Dt(wt)):console.error("Channel creation failed:",(Ei=Cr.data)==null?void 0:Ei.message)}catch(ai){console.error("Error creating channel:",ai)}finally{Be(!1)}},kt=(wt,mn)=>{try{const[jn,Ei,ai]=wt.split(" "),Cr=new Date().getFullYear(),[ji,zi]=mn.split(" - "),ws=zi.trim().slice(-2),ua=`${ji.trim()} ${ws}`,Fs=zi.trim(),Wa=new Date(`${Ei} ${ai}, ${Cr} ${ua}`),je=new Date(`${Ei} ${ai}, ${Cr} ${Fs}`),nn=new Date;return nn>=Wa&&nn<=je}catch(jn){return console.error("Error parsing appointment time:",jn),!1}},Gt=wt=>{if(!wt)return"N/A";const mn=new Date().getFullYear(),jn=`${wt} ${mn}`,Ei=new Date(jn);if(isNaN(Ei))return"Invalid Date";const ai=String(Ei.getDate()).padStart(2,"0"),Cr=String(Ei.getMonth()+1).padStart(2,"0"),ji=Ei.getFullYear();return`${ai}/${Cr}/${ji}`},Mn=F.useCallback(async()=>{var mn;const wt=`${mi}api/doctor/is_suspended`;try{const jn=JSON.parse(localStorage.getItem("doctor-app")),Ei=jn==null?void 0:jn.token;if(!Ei){console.warn("No token found in localStorage. User might not be logged in.");return}const ai=await Ri.post(wt,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${Ei}`}}),Cr=ai.data;ai.data?Cr.data.is_suspended?W(!0):W(!1):console.error("API Error (unexpected Axios success path):",Cr.message)}catch(jn){Ri.isAxiosError(jn)?jn.response?((mn=jn.response.data)!=null&&mn.message||jn.message,console.error("Axios API Error Response:",jn.response.data)):jn.request?console.error("Axios No Response Error:",jn.request):console.error("Axios Request Setup Error:",jn.message):console.error("General Error:",jn)}},[n]);F.useEffect(()=>{Mn()},[Mn]);const[Ci,bs]=F.useState(!1),[Rr,kn]=F.useState(0),[Mi,Ht]=F.useState("");F.useEffect(()=>{k&&O&&l!="1"&&bs(!0)},[k,O]);const sn=()=>{_(zN({appointment_id:O,rating:Rr,comment:Mi})),bs(!1)};return m.jsx(m.Fragment,{children:m.jsxs("main",{className:"doctor-panel",children:[m.jsxs("div",{className:"container-fluid",children:[m.jsx(rfe,{visible:Y,onClose:qe}),m.jsxs("div",{className:"doc-panel-inr",style:{display:"flex",gap:"20px"},children:[m.jsx("div",{style:{width:"100%"},children:m.jsx(Ga,{})}),m.jsxs("div",{children:[m.jsx("div",{className:"doc-img",children:m.jsx("img",{src:`${Mc==null?void 0:Mc.BaseUrl}${ie==null?void 0:ie.profile_path}`,alt:"Doctor"})}),m.jsx("div",{className:"doc-profile-body",children:m.jsx(dn,{to:"/UserProfile",children:m.jsx("p",{style:{color:"#199FD9"},children:(ie==null?void 0:ie.name)||"Doctor Name"})})})]})]}),w?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsx("div",{className:"doc-panel-body",children:m.jsxs("div",{className:"appointments",children:[bt&&Tt&&m.jsxs("div",{className:"start-appointment mt-0",style:{marginBottom:"60px"},children:[m.jsx("div",{className:"docpnl-sec-head",children:m.jsx("h6",{className:"h2-title",children:"Start Appointment"})}),m.jsxs("div",{className:"apointment-detail-card",children:[m.jsx("div",{className:"apoint-dtl-img",children:Tt.is_referred_patient==!0?m.jsx("div",{style:{border:"2px solid #199FD9",borderRadius:8},children:m.jsx("img",{src:"./images/referredProfile.png",alt:"referred patient"})}):m.jsx("img",{src:`${mi}/${Tt.patient_profile}`,alt:Tt.patient_name,style:{height:180,resize:"contain"}})}),m.jsxs("div",{className:"appoint-dtl-content",children:[m.jsxs("div",{className:"appoint-dtl-left",children:[m.jsxs("div",{className:"appoint-dtl-head",children:[m.jsx("h2",{className:"h3-title",children:Tt.patient_name}),m.jsxs("h3",{style:{fontSize:15,color:"#363636"},children:["Disease:",m.jsxs("span",{style:{color:"#199FD9",fontSize:16},children:[" ",Tt.diseaseName]})]}),Tt.is_referred_patient==!0?m.jsxs("p",{children:[m.jsxs("span",{style:{color:"#363636"},children:["Referred by DS Code:"," "]}),m.jsx("span",{style:{color:"#199FD9"},children:Tt.ds_code})]}):m.jsxs("p",{style:{marginTop:-10},children:[m.jsxs("span",{style:{color:"#363636"},children:["DS Code:"," "]}),m.jsx("span",{style:{color:"#199FD9"},children:Tt.ds_code})]})]}),m.jsxs("div",{className:"appoint-btm",children:[m.jsxs("p",{children:[m.jsx("img",{src:"/images/clock-icon.svg",alt:"Icon"}),Tt.date]}),m.jsx("p",{className:"appoint-time",children:Tt.time}),m.jsx("a",{className:"orange-btn",onClick:()=>mt(String(Tt.appointment_id)),style:{cursor:We?"not-allowed":"pointer",pointerEvents:We?"none":"auto"},children:We?"Loading...":"Start now"})]})]}),m.jsx(dn,{to:"/patient-profile",state:{patientId:Tt.patient_id},className:"cmn-btn",children:"View profile"})]})]})]}),m.jsxs("div",{className:"upcoming-apoints cmn-mb",children:[m.jsxs("div",{className:"docpnl-sec-head",children:[m.jsx("h1",{className:"h2-title",children:"Upcoming Appointments"}),m.jsx("button",{className:"cmn-btn",onClick:()=>n("/my-appointments"),children:"See all"})]}),m.jsx("div",{className:"appointments-row-wrp cmn-mb",style:{marginTop:-35},children:m.jsxs("div",{className:"appointments-row row",children:[Ot.length==0&&m.jsx("h3",{style:{textAlign:"center",padding:"25px 0",fontWeight:"400",color:"#199FD9",fontSize:18},children:"No upcoming appointments."}),Ot.map((wt,mn)=>m.jsx("div",{className:"appointment-card-wrp col-lg-2 col-md-4 col-sm-6",children:m.jsxs("div",{className:"appointment-card",children:[m.jsx("div",{className:"card-img",children:wt.is_referred_patient==!0?m.jsx("img",{src:"./images/referredProfile.png",alt:"referred patient"}):m.jsx("img",{src:`${mi}/${wt.patient_profile}`,alt:wt.patient_name})}),m.jsxs("div",{className:"card-body",children:[m.jsx(dn,{to:"/patient-details",state:{id:wt.appointment_id,patientId:wt.patient_id,referrerDscode:wt.ds_code,referrer:wt.referred_patient_name},className:"cmn-btn",children:"View full detail"}),m.jsxs("div",{className:"appointment-datetime",children:[m.jsx("p",{className:"date",children:wt.date}),m.jsx("p",{className:"time",children:wt.time})]}),m.jsx("div",{style:{minHeight:"24px"},children:wt.is_referred_patient?m.jsxs("p",{children:[m.jsx("span",{children:"Referred by DS Code: "}),m.jsx("span",{style:{color:"#199FD9"},children:wt.ds_code})]}):m.jsxs("p",{children:[m.jsx("span",{style:{},children:"DS Code: "}),m.jsx("span",{style:{color:"#199FD9"},children:wt.ds_code})]})}),m.jsx("h3",{style:{fontSize:22},children:wt.patient_name})," ",m.jsxs("h3",{style:{fontSize:22},children:["Disease:",m.jsxs("span",{style:{color:"#199FD9",fontSize:16},children:[" ",wt.diseaseName]})]}),kt(wt.date,wt.time)?m.jsx("input",{type:"submit",value:"Start now",className:"w-100",onClick:()=>mt(String(wt.appointment_id)),style:{cursor:"pointer"}}):m.jsx("input",{type:"submit",value:"Cancel",className:"w-100 up-btn",onClick:()=>tn(wt.appointment_id),style:{cursor:"pointer"}})]})]})},mn))]})}),m.jsxs("div",{className:"pending-prescriptions",style:{marginTop:-40},children:[m.jsxs("div",{className:"docpnl-sec-head",children:[m.jsx("h2",{children:"Pending Prescriptions"}),m.jsx("button",{className:"cmn-btn",onClick:()=>n("/pendingprescription"),children:"See all"})]}),m.jsx("div",{className:"pending-presc-table",style:{marginTop:-20},children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Patient Name"}),m.jsx("th",{children:"Upload Date"}),m.jsx("th",{children:"Disease"}),m.jsx("th",{children:"View Details"})]})}),m.jsxs("tbody",{children:[en.length==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center",fontWeight:"400",fontSize:18},children:w?"Loading...":"No data found"})}),en.map((wt,mn)=>m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String(mn+1).padStart(2,"0")}),m.jsxs("td",{style:{textAlign:"left",paddingLeft:"45px",width:"200px"},children:[m.jsx(dn,{to:"/patient-profile",state:{patientId:wt.patient_id},className:"no-underline-link",style:{display:"inline-block",fontSize:21,marginLeft:-5},children:wt.patient_name}),(wt==null?void 0:wt.is_referred_patient)==!0?m.jsxs("div",{className:"time",style:{color:"#199fd9",marginTop:"2px",fontSize:16,marginLeft:-5,fontWeight:"400"},children:[m.jsx("span",{style:{color:"black",fontWeight:"400"},children:"(Referred by DS Code:"}),wt.ds_code,m.jsx("spna",{style:{color:"black",fontWeight:"400"},children:")"})]}):m.jsxs("div",{className:"time",style:{color:"#199fd9",marginTop:"2px",fontSize:16,marginLeft:-5,fontWeight:"400"},children:[m.jsx("span",{style:{color:"black",fontWeight:"400"},children:"(DS Code:"}),wt.ds_code,m.jsx("span",{style:{color:"black",fontWeight:"bold"},children:")"})]})]}),m.jsxs("td",{children:[m.jsx("div",{className:"date",style:{fontSize:21,color:"#199FD9"},children:Gt(wt.date)}),m.jsx("div",{className:"time",style:{fontSize:16,color:"#199fd9"},children:wt.time})]}),m.jsx("td",{style:{color:"#199FD9"},children:wt.diseaseName}),m.jsx("td",{children:m.jsx(dn,{to:"/patient-details",state:{id:wt.appointment_id,patientId:wt.patient_id,referrerDscode:wt.ds_code,referrer:wt.referred_patient_name},style:{fontSize:21,marginLeft:-50},children:"View"})})]},mn))]})]})})]})]})]})}),!bt&&Re&&m.jsx("div",{className:"modal fade show",tabIndex:"-1",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.5)"},children:m.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:m.jsxs("div",{className:"modal-content text-center position-relative shadow",style:{width:"400px",minHeight:"280px",borderRadius:"20px",padding:"30px 20px"},children:[m.jsx("button",{type:"button",onClick:()=>Me(!1),className:"position-absolute top-0 end-0 m-3 border-0 bg-transparent","aria-label":"Close",children:m.jsx("img",{src:"./images/cross-blue.png",alt:"Close Icon",style:{width:"24px",height:"24px"}})}),m.jsx("div",{className:"modal-icon mb-3",children:m.jsx("img",{src:"./images/bell-icon.svg",alt:"Reminder Icon",style:{width:"40px",height:"40px"}})}),m.jsxs("div",{className:"modal-header border-0 flex-column align-items-center p-0",children:[m.jsx("h2",{className:"fw-bold mb-2",style:{fontSize:"22px",color:"#333"},children:"Reminder:"}),m.jsx("p",{className:"m-0",style:{color:"#009CDE",fontWeight:"500"},children:"Your Appointment Starts in 2 Minutes!"})]}),m.jsxs("div",{className:"modal-body p-0 mt-4",children:[m.jsxs("div",{className:"text-muted mb-2",children:["Patients Name:"," ",m.jsx("span",{className:"fw-medium",style:{color:"#356598"},children:"John Smith"})]}),m.jsxs("div",{className:"text-muted",children:["Date and Time:"," ",m.jsx("span",{className:"fw-medium",style:{color:"#356598"},children:"December 26, 2024, 3:00 PM"})]})]})]})})}),m.jsx(po,{})]}),m.jsx(tp,{visible:se,title:"Cancel Appointment",subtitle:"Are you sure you want to cancel the appointment?",onConfirm:Mt,onCancel:()=>ue(!1),actionType:"cancel"}),m.jsx(tp,{visible:ye,title:"Cancel Appointment",subtitle:"Reason for cancellation",inputField:!0,inputValue:oe,onInputChange:wt=>re(wt),onCancel:()=>{ae(!1),re("")},onConfirm:wn,actionType:"info"}),m.jsx(tp,{visible:ve,title:"Appointment Cancelled",subtitle:"Your appointment is cancelled successfully.",onConfirm:()=>$(!1),onCancel:()=>$(!1),actionType:"success"}),Ci&&m.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},children:m.jsx("div",{className:"modal-dialog modal-dialog-centered",children:m.jsxs("div",{className:"modal-content",style:{padding:"20px",borderRadius:"10px"},children:[m.jsxs("div",{className:"modal-header",children:[m.jsx("h5",{className:"modal-title",children:"Rate Your Experience"}),m.jsx("button",{type:"button",className:"close",onClick:()=>bs(!1),style:{color:"#199FD9",fontSize:30},children:""})]}),m.jsxs("div",{className:"modal-body text-center",children:[m.jsx(afe,{rating:Rr,onRatingChange:kn}),m.jsx("textarea",{className:"form-control mt-3",placeholder:"Share your feedback (optional)",value:Mi,onChange:wt=>Ht(wt.target.value),rows:"3"})]}),m.jsxs("div",{className:"modal-footer justify-content-center",children:[m.jsx("button",{type:"button",className:"btn btn-secondary mr-2",onClick:()=>bs(!1),children:"Skip"}),m.jsx("button",{type:"button",className:"btn btn-primary",style:{backgroundColor:"#199FD9"},onClick:sn,children:K?"Submitting...":"Submit"})]})]})})})]})})},cfe=()=>{var Ne,Je,be,Ie,Re,Me,he,De,qe,We,Be,bt,St,Tt,ut,tn,Mt,wn,Yt,Xn,Ot,en,Dt;const a=ds(),n=Wi(),{id:i,patientId:s,referrerDscode:l,referrer:p}=n.state||{},[_,T]=F.useState(!1),[w,C]=F.useState(!1),[O,k]=F.useState(!1),[U,Y]=F.useState(null),[W,ee]=F.useState(""),[K,ie]=F.useState(null),[se,ue]=F.useState(!1),ye=Li(),{patientAppointmentsDetail:ae,doctorcancelledAppointment:ve,patientAppointmentsDetailLoading:$,doctorcancelledLoading:Q}=Tr(mt=>mt.appointments);F.useEffect(()=>{i&&ye(FN({appointmentId:i}))},[ye,i]);const te=mt=>{Y(mt),T(!0)},oe=()=>{T(!1),C(!0)},re=()=>{ye(Nv({appointment_id:U,cancel_message:W})).then(()=>{C(!1),ee(""),Y(null),k(!0)})},fe=mt=>{ie(mt),ue(!0)},pe=()=>{var Gt,Mn;const mt=(Gt=ae==null?void 0:ae.patientData)==null?void 0:Gt.dayDate,kt=(Mn=ae==null?void 0:ae.patientData)==null?void 0:Mn.time;if(!mt||!kt)return!1;try{const[,Ci,bs]=mt.split(" "),Rr=new Date().getFullYear(),[kn,Mi]=kt.split(" - "),Ht=Mi.trim().slice(-2),sn=`${kn.trim()} ${Ht}`,wt=new Date(`${Ci} ${bs} ${Rr} ${sn}`);return new Date>=wt}catch(Ci){return console.error("Time parse error:",Ci),!1}};return m.jsx(m.Fragment,{children:m.jsxs("main",{className:"doctor-panel",children:[m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(Ga,{})}),$?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"doc-panel-body appoint-details-pg has-texture",children:[m.jsx("div",{className:"texture only-img",children:m.jsx("img",{src:"/images/doctor-symbol.png",alt:"Image"})}),m.jsxs("div",{className:"appointments",children:[m.jsxs("div",{className:"start-appointment cmn-mb mb-4",children:[m.jsxs("div",{className:"docpnl-sec-head",children:[m.jsx("h1",{className:"h2-title mb-1",children:"Appointment Details"}),m.jsx("div",{className:"back-btn",children:m.jsx(dn,{to:"#",onClick:mt=>{mt.preventDefault(),window.history.back()},children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),((Ne=ae==null?void 0:ae.patientData)==null?void 0:Ne.is_referred_patient)&&m.jsx("div",{className:"refered-by-cd",children:m.jsxs("p",{children:["Referred by ",p," (",l,")"]})}),m.jsxs("div",{className:"apointment-detail-card",style:{border:"2px solid #199FD9"},children:[!((Je=ae==null?void 0:ae.patientData)!=null&&Je.is_referred_patient)&&m.jsx("div",{className:"apoint-dtl-img",children:m.jsx("img",{src:`${mi}/${(be=ae==null?void 0:ae.patientData)==null?void 0:be.patient_profile}`,alt:"Client"})}),m.jsxs("div",{className:`appoint-dtl-content ${(Ie=ae==null?void 0:ae.patientData)!=null&&Ie.is_referred_patient?"w-100 p-0":""}`,children:[m.jsxs("div",{className:"appoint-dtl-left",children:[m.jsxs("div",{className:"appoint-dtl-head",children:[m.jsxs("h2",{className:"h3-title",children:[(Re=ae==null?void 0:ae.patientData)==null?void 0:Re.patient_name,!((Me=ae==null?void 0:ae.patientData)!=null&&Me.is_referred_patient)&&m.jsxs("div",{style:{fontSize:"15px"},children:["(",m.jsxs("span",{style:{color:"#363636"},children:["DS Code:"," "]}),m.jsx("span",{style:{color:"#199FD9"},children:l}),")"]})]}),m.jsx("h2",{className:"h3-title",children:m.jsxs("span",{style:{color:"#363636",fontSize:16},children:["Disease :",m.jsxs("span",{style:{color:"#199FD9"},children:[" ",(he=ae==null?void 0:ae.patientData)==null?void 0:he.diseaseName]})]})})]}),m.jsxs("div",{className:"appoint-btm",style:{marginTop:-10},children:[m.jsxs("p",{children:[m.jsx("img",{src:"/images/clock-icon.svg",alt:"Icon"}),(De=ae==null?void 0:ae.patientData)==null?void 0:De.dayDate]}),m.jsx("p",{className:"appoint-time",children:(qe=ae==null?void 0:ae.patientData)==null?void 0:qe.time})]})]}),m.jsx(dn,{to:"/patient-profile",state:{patientId:s,hideSchedule:!0},className:"cmn-btn",children:"View profile"})]})]})]}),m.jsx("div",{className:"patient-details-wrp",children:m.jsx("form",{children:m.jsxs("div",{className:"patient-dtl-form",children:[m.jsxs("div",{className:"patient-basic-info cmn-mb2",children:[m.jsx("h2",{children:"Basic Information"}),m.jsxs("div",{className:"row",children:[m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Full Name"}),m.jsx("input",{type:"text",placeholder:"Name",value:(We=ae==null?void 0:ae.basicInformation)==null?void 0:We.name,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Height"}),m.jsx("input",{type:"text",placeholder:"26",value:(Be=ae==null?void 0:ae.basicInformation)==null?void 0:Be.height,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Weight"}),m.jsx("input",{type:"text",placeholder:"50kg",value:(bt=ae==null?void 0:ae.basicInformation)==null?void 0:bt.weight,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Gender"}),m.jsx("input",{type:"text",placeholder:"Male",value:((Tt=(St=ae==null?void 0:ae.basicInformation)==null?void 0:St.gender)==null?void 0:Tt.charAt(0).toUpperCase())+((tn=(ut=ae==null?void 0:ae.basicInformation)==null?void 0:ut.gender)==null?void 0:tn.slice(1).toLowerCase()),readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Age"}),m.jsx("input",{type:"text",placeholder:"26",value:(Mt=ae==null?void 0:ae.basicInformation)==null?void 0:Mt.age,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Disease"}),m.jsx("input",{type:"text",placeholder:"26",value:(wn=ae==null?void 0:ae.basicInformation)==null?void 0:wn.diseaseName,readOnly:!0})]})})]})]}),m.jsxs("div",{className:"scheduled-call-consultations cmn-mb2",children:[m.jsx("h2",{children:"Scheduled Call Consultations"}),m.jsxs("div",{className:"row",children:[m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"1. How long are you suffering from this disease?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(Yt=ae==null?void 0:ae.symptomAnswers)==null?void 0:Yt.answer1,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"2. Any other problem which you would like to share related to your problem?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(Xn=ae==null?void 0:ae.symptomAnswers)==null?void 0:Xn.answer2,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"3. Do you have any history of this disease?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(Ot=ae==null?void 0:ae.symptomAnswers)==null?void 0:Ot.answer3,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"4. Are you taking any medicines? If yes, please share the name of medicine and since how long you are taking this medicine?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(en=ae==null?void 0:ae.symptomAnswers)==null?void 0:en.answer4,readOnly:!0})]})})]})]}),Array.isArray(ae==null?void 0:ae.symptomFiles)&&(ae==null?void 0:ae.symptomFiles.length)>0&&m.jsxs("div",{className:"view-uploaded-images-wrp",children:[m.jsx("h2",{children:"View Uploaded Images"}),m.jsx("div",{className:"view-uploaded-img",children:ae==null?void 0:ae.symptomFiles.filter(mt=>mt.file_type.toLowerCase().match(/jpg|jpeg|png|gif/)).map((mt,kt)=>m.jsx("div",{className:"img-wrp",children:m.jsx("a",{href:"#",onClick:Gt=>{Gt.preventDefault(),fe(mt)},children:m.jsx("img",{src:`${mi}/${mt.file_path}`,alt:`Symptom Image ${kt+1}`})})},kt))})]}),((Dt=ae==null?void 0:ae.patientData)==null?void 0:Dt.need_prescription)==!0?m.jsx("div",{className:"btn-wrp",children:m.jsx(dn,{to:"/CompletedAssignedPrescription",state:{id:i,patientId:s},children:m.jsx("button",{type:"button",className:"orange-btn",children:"Respond"})})}):pe()?null:m.jsx("div",{className:"btn-wrp",children:m.jsx("button",{type:"button",className:"orange-btn",onClick:()=>te(i),children:"Cancel"})})]})})})]})]}),m.jsx(po,{})]}),m.jsx(tp,{visible:_,title:"Cancel Appointment",subtitle:"Are you sure you want to cancel the appointment?",onConfirm:oe,onCancel:()=>T(!1),actionType:"cancel"}),m.jsx(tp,{visible:w,title:"Cancel Appointment",subtitle:"Reason for cancellation",inputField:!0,inputValue:W,onInputChange:mt=>ee(mt),onCancel:()=>{C(!1),ee("")},onConfirm:re,actionType:"info"}),m.jsx(tp,{visible:O,title:"Appointment Cancelled",subtitle:"Your appointment is cancelled successfully.",onConfirm:()=>{k(!1),a("/doctor-home")},onCancel:()=>k(!1),actionType:"success"}),se&&K&&m.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",overflow:"auto"},children:[m.jsx("button",{onClick:()=>ue(!1),style:{position:"fixed",right:"30px",top:"30px",zIndex:1060,background:"transparent",border:"none",cursor:"pointer",padding:0},"aria-label":"Close",children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close",style:{width:"24px",height:"24px",filter:"brightness(0) invert(1)"}})}),m.jsx("div",{style:{maxWidth:"90vw",maxHeight:"90vh",display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsx("img",{src:`${mi}/${K.file_path}`,alt:"Enlarged view",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})})]})]})})},lfe=()=>{var ue,ye,ae,ve,$,Q,te,oe,re,fe,pe,Ne,Je,be,Ie,Re,Me;const a=Wi();ds();const{patientId:n,appointmentId:i,hideSchedule:s,source:l}=a.state||{},p=Li(),{patientProfileData:_,loading:T}=Tr(he=>he.patientProfile),[w,C]=F.useState(null),[O,k]=F.useState(null),[U,Y]=F.useState(!1);F.useEffect(()=>{n&&p(Ov({patientId:n,source:l}))},[p,n,l]);const W=(_==null?void 0:_.basic_information)||{},ee=(_==null?void 0:_.appointment_date_time)||{},K=(_==null?void 0:_.appointment_history)||{},ie=(_==null?void 0:_.referred_patients)||{},se=he=>{k(he),Y(!0)};return m.jsx(m.Fragment,{children:m.jsx("main",{className:"doctor-panel",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(Ga,{})}),T?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsx("div",{className:"doc-panel-body has-texture",children:m.jsxs("div",{className:"start-appointment cmn-mb",children:[m.jsxs("div",{className:"docpnl-sec-head text-center",children:[m.jsx("h1",{className:"h2-title",children:"Patient Profile"}),m.jsx("div",{className:"back-btn",children:m.jsx(dn,{to:"#",onClick:he=>{he.preventDefault(),window.history.back()},children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),m.jsxs("div",{className:"patient-details-wrp",children:[m.jsx("div",{className:"patient-profile-wrp cmn-mb2",style:(ue=_==null?void 0:_.basic_information)!=null&&ue.is_referred?{}:{width:"100%",maxWidth:"100%"},children:m.jsx("div",{className:"patient-profile",style:{width:"100%",maxWidth:"100%"},children:m.jsxs("div",{className:"patient-profile-inr",style:{display:"flex",width:"100%",alignItems:"flex-start"},children:[!((ye=_==null?void 0:_.basic_information)!=null&&ye.is_referred)&&m.jsx("div",{className:"patient-profile-left",children:m.jsx("div",{className:"patient-profile-img-cover",children:m.jsx("div",{className:"patient-profile-cover-inr",children:m.jsx("div",{className:"patient-profile-img",children:m.jsx("img",{src:`${mi}/${W.patient_profile}`,alt:"Patinet Profile Image"})})})})}),m.jsxs("div",{className:"patient-profile-right",style:{maxWidth:(ae=_==null?void 0:_.basic_information)!=null&&ae.is_referred?"100%":void 0},children:[m.jsxs("div",{className:"patient-id",children:[m.jsx("h2",{children:W.name}),m.jsx("p",{className:"dscode",children:(ve=_==null?void 0:_.basic_information)!=null&&ve.is_referred?m.jsxs(m.Fragment,{children:[m.jsx("span",{style:{color:"black"},children:"Referred by"}),m.jsx(dn,{to:"/patient-profile",state:{patientId:($=_==null?void 0:_.basic_information)==null?void 0:$.referred_id},style:{color:"#199fd9",textDecoration:"none",marginLeft:5,display:"inline"},children:m.jsx("span",{children:(Q=_==null?void 0:_.basic_information)==null?void 0:Q.referred_by})}),m.jsxs("span",{style:{color:"#000"},children:["(DS Code:",m.jsxs("span",{style:{color:"#199fd9"},children:[" ",W.ds_code]}),")"]})]}):m.jsxs("span",{children:["(",m.jsx("span",{style:{color:"black"},children:"DS Code:"}),W.ds_code,m.jsx("span",{children:")"})]})})]}),m.jsxs("div",{className:"patient-info",style:{display:"flex",flexWrap:"wrap",gap:"16px",padding:"0 16px"},children:[m.jsxs("div",{className:"patient-info-card",style:{flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[m.jsx("h3",{children:"Gender"}),m.jsx("p",{style:{color:"#199FD9"},children:((te=W.gender)==null?void 0:te.charAt(0).toUpperCase())+((oe=W.gender)==null?void 0:oe.slice(1).toLowerCase())})]}),m.jsxs("div",{className:"patient-info-card",style:{flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[m.jsx("h3",{children:"Age"}),m.jsx("p",{style:{color:"#199FD9"},children:W.age})]}),m.jsxs("div",{className:"patient-info-card",style:{flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[m.jsx("h3",{children:"Height"}),m.jsx("p",{style:{color:"#199FD9"},children:W.height})]}),m.jsxs("div",{className:"patient-info-card",style:{flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[m.jsx("h3",{children:"Weight"}),m.jsx("p",{style:{color:"#199FD9"},children:W.weight})]})]}),!((re=_==null?void 0:_.basic_information)!=null&&re.is_referred)&&m.jsxs("div",{className:"patient-info",children:[m.jsxs("div",{className:"patient-info-card",style:{marginLeft:12,flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[m.jsx("h3",{children:"Phone number"}),m.jsx("p",{style:{color:"#199FD9"},children:W.phone_no})]}),m.jsxs("div",{className:"patient-info-card",style:{flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[m.jsx("h3",{style:{marginLeft:15},children:"Email ID"}),m.jsx("p",{style:{marginLeft:15,color:"#199FD9"},children:W.email})]})]})]})]})})}),(_==null?void 0:_.is_appointment_present)&&m.jsxs("div",{className:"patient-basic-info cmn-mb2",children:[m.jsx("h2",{children:"Appointment Date & Time"}),m.jsxs("div",{className:"appointment-timing",children:[m.jsx("div",{className:"appointment-date",children:ee.date}),m.jsx("div",{className:"appointment-time",children:ee.time})]})]}),(_==null?void 0:_.is_appointment_present)&&!((fe=_==null?void 0:_.basic_information)!=null&&fe.is_referred)&&m.jsx("div",{className:"patient-detail-form-wrp cmn-mb2",children:m.jsx("form",{children:m.jsx("div",{className:"patient-dtl-form",children:m.jsxs("div",{className:"health-issues-symptoms cmn-mb2",children:[m.jsx("h2",{children:"Appointment Details"}),m.jsxs("div",{className:"health-symptoms-inr",children:[m.jsxs("div",{className:"health-symptoms-content",children:[m.jsxs("div",{className:"formfield white-input",children:[m.jsx("label",{children:"What symptoms are you facing? Please describe your symptoms in brief."}),m.jsx("input",{type:"text",placeholder:"Answer",value:((pe=_==null?void 0:_.appointment_details)==null?void 0:pe.answer1)||"No symptoms reported",readOnly:!0})]}),m.jsxs("div",{className:"formfield white-input",children:[m.jsx("label",{children:"How long have you been experiencing these symptoms?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:((Ne=_==null?void 0:_.appointment_details)==null?void 0:Ne.answer2)||"No duration specified",readOnly:!0})]}),m.jsxs("div",{className:"formfield white-input",children:[m.jsx("label",{children:"Any knows Diseases / Health Conditions you are facing?"}),m.jsx("input",{type:"text",placeholder:"Parasitic diseases",value:((Je=_==null?void 0:_.appointment_details)==null?void 0:Je.answer3)||"No known diseases",readOnly:!0})]}),m.jsxs("div",{className:"formfield white-input",children:[m.jsx("label",{children:"Any past medical conditions?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:((be=_==null?void 0:_.appointment_details)==null?void 0:be.answer4)||"No past conditions reported",readOnly:!0})]})]}),Array.isArray(_==null?void 0:_.viewUploadedImages)&&((Ie=_==null?void 0:_.viewUploadedImages)==null?void 0:Ie.length)>0&&m.jsxs("div",{className:"view-uploaded-images-wrp",children:[m.jsx("h2",{className:"h5-title",children:"View Uploaded Images"}),m.jsx("div",{className:"view-uploaded-img",children:((Re=_==null?void 0:_.viewUploadedImages)==null?void 0:Re.length)>0?_.viewUploadedImages.map((he,De)=>m.jsx("div",{className:"img-wrp",children:m.jsx("a",{href:"#",onClick:qe=>{qe.preventDefault(),se(he)},children:m.jsx("img",{src:`${mi}/${he.file_path}`,alt:`Symptom ${De+1}`})})},De)):m.jsx("p",{children:"No images uploaded"})}),U&&O&&m.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",overflow:"auto"},children:[m.jsx("button",{onClick:()=>Y(!1),style:{position:"fixed",right:"30px",top:"30px",zIndex:1060,background:"transparent",border:"none",cursor:"pointer",padding:0},"aria-label":"Close",children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close",style:{width:"24px",height:"24px",filter:"brightness(0) invert(1)"}})}),m.jsx("div",{style:{maxWidth:"90vw",maxHeight:"90vh",display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsx("img",{src:`${mi}/${O.file_path}`,alt:"Enlarged view",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})})]})]})]})]})})})}),m.jsxs("div",{className:"pending-prescriptions cmn-mb2 bg-blue",children:[m.jsx("h2",{children:"Appointment History"}),m.jsx("div",{className:"pending-presc-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Appointment Date"}),m.jsx("th",{children:"Disease"}),m.jsx("th",{children:"View Prescription"})]})}),m.jsx("tbody",{children:K.length>0?K.map((he,De)=>{var qe;return m.jsxs("tr",{children:[m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:String(De+1).padStart(2,"0")}),m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:he.appointment_date}),m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:he.diagnosis}),m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:m.jsx(dn,{to:"/completed-appointment-screen",state:{id:he==null?void 0:he.appointment_id,patientId:(qe=_==null?void 0:_.appointment_details)==null?void 0:qe.patient_id,chat_id:he.chat_id,ds_code:W.ds_code,prescription_id:he==null?void 0:he.prescription_id},className:"link",children:"View"})})]},he.id||De)}):m.jsx("tr",{children:m.jsx("td",{colSpan:"4",className:"text-center",style:{fontSize:20,color:"#199FD9"},children:"No Appointment history found"})})})]})})]}),!((Me=_==null?void 0:_.basic_information)!=null&&Me.is_referred)&&m.jsxs("div",{className:"pending-prescriptions",children:[m.jsx("h2",{children:"Referred Patient list"}),m.jsx("div",{className:"pending-presc-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Patient Name"}),m.jsx("th",{children:"Gender"}),m.jsx("th",{children:"Age"}),m.jsx("th",{children:"Weight (kg)"}),m.jsx("th",{children:"Height"}),m.jsx("th",{children:"View Profile"})]})}),m.jsx("tbody",{children:ie.length>0?ie.map((he,De)=>{var qe,We;return m.jsxs("tr",{children:[m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:String(De+1).padStart(2,"0")}),m.jsx("td",{style:{textAlign:"left",paddingLeft:"60px",fontSize:20,color:"#199FD9"},children:m.jsx(dn,{to:"/patient-profile",state:{patientid:n},className:"no-underline-link",style:{color:"#199FD9",display:"inline-block"},children:he.name.charAt(0).toUpperCase()+he.name.slice(1).toLowerCase()})}),m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:((qe=W.gender)==null?void 0:qe.charAt(0).toUpperCase())+((We=W.gender)==null?void 0:We.slice(1).toLowerCase())}),m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:he.age}),m.jsxs("td",{style:{fontSize:20,color:"#199FD9"},children:[" ",he.weight]}),m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:he.height}),m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:m.jsx(dn,{to:"/patient-profile",state:{referrer:W.name,referrerDscode:W.ds_code,id:he.id,patientId:he.id},style:{color:"#199FD9",textDecoration:"underline !important"},className:"text-decoration-underline",children:"View Profile"})})]},he.id||De)}):m.jsx("tr",{children:m.jsx("td",{colSpan:"7",className:"text-center",style:{color:"#199FD9",fontSize:20},children:"No Referred patients found"})})})]})})]})]}),!(_!=null&&_.is_appointment_present)&&!s&&m.jsx("div",{className:"schedule-appoinment-btn",children:m.jsx(dn,{to:"/schedule-appointment",state:{patientId:n,appointmentId:i,patientName:W.name},className:"orange-btn",children:"Schedule Appointment"})})]})}),m.jsx(po,{})]})})})},dfe=({onFilterChange:a,onSearch:n,activeTab:i,onSearchDate:s})=>{const[l,p]=F.useState(""),[_,T]=F.useState([]),[w,C]=F.useState(""),[O,k]=F.useState(!1),[U,Y]=F.useState([]),[W,ee]=F.useState({name:"",age:"",dscode:"",diagnosis:""}),[K,ie]=F.useState(!1),[se,ue]=F.useState(new Date().getMonth()),[ye,ae]=F.useState(new Date().getFullYear()),[ve,$]=F.useState(!0),[Q,te]=F.useState(""),[oe,re]=F.useState(""),[fe,pe]=F.useState(""),[Ne,Je]=F.useState(!1),[be,Ie]=F.useState(!1);Li();const{completedAppointment:Re}=Tr(Dt=>Dt.appointments),Me=["January","February","March","April","May","June","July","August","September","October","November","December"];F.useEffect(()=>{he()},[]),F.useEffect(()=>{he(),s(null),a({name:"",age:"",dscode:"",diagnosis:""})},[i]),F.useEffect(()=>{if(Re&&Re.length>0){const Dt=[...new Set(Re.map(mt=>mt.diagnosis).filter(mt=>mt&&mt.trim()!==""&&mt.trim()!=="-"))];Y(Dt)}},[Re]);const he=()=>{p(""),C(""),ee({name:"",age:"",diagnosis:""}),k(!1),te(""),re(""),ie(!1),ue(new Date().getMonth()),ae(new Date().getFullYear()),pe("")},De=Dt=>{const mt=Dt.target.value;pe(mt),n(mt)},qe=Dt=>{const{name:mt,value:kt}=Dt.target;if(mt==="name"){const Gt=kt.replace(/[^A-Za-z\s]/g,"");ee(Mn=>({...Mn,[mt]:Gt}))}else mt==="age"?(kt===""||/^[0-9\b]+$/.test(kt))&&ee(Gt=>({...Gt,[mt]:kt})):ee(mt==="dscode"?Gt=>({...Gt,[mt]:kt}):Gt=>({...Gt,[mt]:kt}))},We=()=>{k(Dt=>!Dt)},Be=Dt=>{let mt=se+Dt,kt=ye;mt>11?(mt=0,kt++):mt<0&&(mt=11,kt--),ue(mt),ae(kt)},bt=()=>{const Dt=new Date(ye,se,1).getDay(),mt=new Date(ye,se+1,0).getDate(),kt=[];let Gt=[];for(let Mn=0;Mn<Dt;Mn++)Gt.push(m.jsx("td",{className:"empty-cell"},`empty-${Mn}`));for(let Mn=1;Mn<=mt;Mn++){const Ci=Q&&Q.startsWith(`${Mn}/${se+1}`),bs=oe&&oe.startsWith(`${Mn}/${se+1}`);let Rr=!1;if(!ve&&Q){const kn=Q.split("/"),Mi=new Date(kn[2],kn[1]-1,kn[0]);Rr=new Date(ye,se,Mn)<=Mi}Gt.push(m.jsx("td",{className:`calendar-day 
            ${Ci?"selected-from":""} 
            ${bs?"selected-to":""}
            ${Rr?"disabled-day":""}`,onClick:()=>!Rr&&St(Mn),style:Rr?{color:"#ccc",cursor:"not-allowed"}:{},children:Mn},`day-${Mn}`)),((Dt+Mn)%7===0||Mn===mt)&&(kt.push(m.jsx("tr",{children:Gt},`week-${kt.length}`)),Gt=[])}return kt},St=Dt=>{const mt=`${Dt}/${se+1}/${ye}`;if(ve){if(te(mt),$(!1),oe){const kt=oe.split("/"),Gt=new Date(kt[2],kt[1]-1,kt[0]),Mn=new Date(ye,se,Dt);Gt<=Mn&&re("")}}else{const kt=Q.split("/"),Gt=new Date(kt[2],kt[1]-1,kt[0]);if(new Date(ye,se,Dt)>Gt)re(mt);else{alert("To Date must be after From Date");return}}},Tt=()=>{ie(Dt=>!Dt),!K&&!Q&&!oe&&$(!0)},ut=Dt=>{Dt==="clear"?(ee({name:"",age:"",dscode:"",diagnosis:""}),a({patientName:"",age:"",dscode:"",disease:""}),k(!1)):(a({patientName:W.name,age:W.age,dscode:W.dscode,disease:W.diagnosis}),k(!1))},tn=()=>{te(""),re(""),$(!0),s(null),ie(!1)},Mt=()=>{if(Q&&oe){const Dt=Q.split("/"),mt=oe.split("/"),kt=new Date(Dt[2],Dt[1]-1,Dt[0]),Gt=new Date(mt[2],mt[1]-1,mt[0]);Gt.setHours(23,59,59,999),s([kt,Gt]),ie(!1)}},Yt=(()=>{const Dt=[],mt=new Set;return Re&&Re.forEach(kt=>{kt.patient_name&&!mt.has(kt.patient_name.toLowerCase())&&(mt.add(kt.patient_name.toLowerCase()),Dt.push({name:kt.patient_name,dsCode:kt.ds_code||""}))}),Dt})(),Xn=W.name?Yt.filter(Dt=>Dt.name.toLowerCase().includes(W.name.toLowerCase())):Yt,Ot=Dt=>{ee(mt=>({...mt,name:Dt.name})),Je(!1)},en=Dt=>{if(!Dt)return"";const[mt,kt,Gt]=Dt.split("/").map(Number);return`${mt.toString().padStart(2,"0")}/${kt.toString().padStart(2,"0")}/${Gt}`};return m.jsxs("div",{className:"my-appointments-search-wrp",style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px"},children:[m.jsxs("div",{className:"datepicker-wrp",style:i==="upcoming"?{display:"none"}:["cancelled","incompleted","missed"].includes(i)?{width:"50%"}:{},children:[m.jsx("input",{type:"text",id:"dateRangeInput",placeholder:"Select date range",readOnly:!0,value:Q&&oe?`${en(Q)} - ${en(oe)}`:"",onClick:Tt}),K&&m.jsxs("div",{className:"calendar-popup",style:{display:"block",position:"absolute",zIndex:1e3,background:"white",padding:"0px",borderRadius:"5px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)",width:"300px",left:0,overflow:"hidden"},children:[m.jsxs("div",{className:"calendar-header",children:[m.jsx("div",{className:"cal-head-btn-wrp",children:m.jsx("button",{type:"button",className:`range-btn ${ve?"active":""}`,onClick:()=>$(!0),children:m.jsx("span",{id:"fromDateLabel",children:Q?en(Q):"From Date"})})}),m.jsx("div",{className:"cal-head-btn-wrp",children:m.jsx("button",{type:"button",className:`range-btn ${ve?"":"active"}`,onClick:()=>$(!1),children:m.jsx("span",{id:"toDateLabel",children:oe?en(oe):"To Date"})})}),m.jsxs("div",{className:"monthyear-wrp w-100",style:{display:"flex",justifyContent:"space-between",alignItems:"center",margin:"10px 0"},children:[m.jsx("button",{type:"button",className:"arrow-btn",onClick:()=>Be(-1),style:{border:"none",background:"none",cursor:"pointer",fontSize:"16px"},children:""}),m.jsxs("span",{id:"monthYearLabel",style:{fontWeight:"bold"},children:[Me[se]," ",ye]}),m.jsx("button",{type:"button",className:"arrow-btn",onClick:()=>Be(1),style:{border:"none",background:"none",cursor:"pointer",fontSize:"16px"},children:""})]})]}),m.jsxs("table",{className:"calendar-grid",style:{width:"100%",borderCollapse:"collapse"},children:[m.jsx("thead",{children:m.jsx("tr",{children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(Dt=>m.jsx("th",{style:{padding:"5px",textAlign:"center"},children:Dt},Dt))})}),m.jsx("tbody",{children:bt()})]}),m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"10px",borderTop:"1px solid #eee"},children:[m.jsx("button",{onClick:tn,style:{padding:"5px 10px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:"3px",cursor:"pointer"},children:"Clear"}),m.jsx("button",{onClick:Mt,disabled:!Q||!oe,style:{padding:"5px 10px",background:Q&&oe?"#0066cc":"#ccc",color:"white",border:"none",borderRadius:"3px",cursor:Q&&oe?"pointer":"not-allowed"},children:"Apply"})]})]})]}),m.jsxs("div",{className:"formfield",style:i=="completed"?{display:"none"}:["cancelled","incompleted","missed"].includes(i)?{width:"50%"}:{},children:[m.jsx("input",{placeholder:"Search anything here",type:"text",value:fe,onChange:De}),m.jsx("input",{type:"submit"})]}),m.jsxs("div",{className:"past-patient-filter-wrp",style:i==="cancelled"||i==="upcoming"||i==="incompleted"||i==="missed"?{display:"none"}:{},children:[m.jsxs("button",{type:"button",onClick:We,children:["Filter",m.jsx("img",{src:"./images/filter-icon.svg",alt:"Icon"})]}),m.jsx("div",{className:`filter-options-drpdn ${O?"active":""}`,children:m.jsxs("form",{children:[m.jsxs("div",{className:"filter-form",children:[m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"Patient Name"}),m.jsxs("div",{className:"suggestion-container",style:{position:"relative"},children:[m.jsx("input",{type:"text",name:"name",value:W.name,onChange:qe,placeholder:"Patient Name",pattern:"[A-Za-z\\s]+",title:"Only letters and spaces allowed",autoComplete:"off",onFocus:()=>{Ie(!0),W.name&&Je(!0)},onBlur:()=>{setTimeout(()=>{Ie(!1),Je(!1)},200)}}),(Ne||be)&&Xn.length>0&&m.jsx("ul",{className:"suggestions-dropdown",style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"#fff",border:"1px solid #ddd",borderRadius:"4px",maxHeight:"200px",overflowY:"auto",zIndex:1e3,marginTop:"5px",padding:0,listStyle:"none"},children:Xn.map((Dt,mt)=>m.jsxs("li",{onClick:()=>Ot(Dt),style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid #eee",display:"flex",flexDirection:"column"},children:[m.jsx("div",{children:Dt.name}),Dt.dsCode&&m.jsxs("div",{style:{color:"#199fd9",fontSize:"0.8em"},children:["(DS Code: ",Dt.dsCode,")"]})]},mt))})]})]}),m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"Age"}),m.jsx("input",{type:"text",name:"age",value:W.age,onChange:qe,placeholder:"Age",pattern:"[0-9]*"})]}),m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"DS Code"}),m.jsx("input",{id:"dscode",type:"text",name:"dscode",value:W.dscode,onChange:qe,placeholder:"DS Code"})]}),m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"Disease"}),m.jsxs("select",{name:"diagnosis",value:W.diagnosis,onChange:qe,children:[m.jsx("option",{value:"",children:"Disease"}),U.map((Dt,mt)=>m.jsx("option",{value:Dt,children:Dt},mt))]})]})]}),m.jsxs("div",{className:"filter-form-btn-wrp",children:[m.jsx("button",{type:"button",className:"orange-btn",onClick:()=>ut("clear"),style:{borderRadius:0},children:"Clear Filter"}),m.jsx("button",{type:"button",className:"orange-btn",onClick:()=>ut("apply"),style:{borderRadius:0},children:"Apply Filter"})]})]})})]})]})},xu=({currentPage:a,totalPages:n,onPageChange:i,onNext:s,onPrevious:l})=>{const p=[];if(n<=5)for(let _=1;_<=n;_++)p.push(_);else a<=3?p.push(1,2,3,4,"...",n):a>=n-2?p.push(1,"...",n-3,n-2,n-1,n):p.push(1,"...",a-1,a,a+1,"...",n);return m.jsxs("div",{className:"tablepagination",children:[m.jsx("div",{className:"tbl-pagination-inr",children:m.jsxs("ul",{children:[m.jsx("li",{children:m.jsxs(dn,{to:"#url",onClick:_=>{_.preventDefault(),l()},children:[m.jsx("img",{src:"./images/arrow-left-black.svg",alt:"Icon"}),"Previous"]})}),p.map((_,T)=>m.jsx("li",{className:a===_?"active":"",children:_==="..."?m.jsx(dn,{to:"#url",onClick:w=>w.preventDefault(),children:"..."}):m.jsx(dn,{to:"#url",onClick:w=>{w.preventDefault(),i(_)},children:_})},T)),m.jsx("li",{children:m.jsxs(dn,{to:"#url",onClick:_=>{_.preventDefault(),s()},children:["Next",m.jsx("img",{src:"./images/arrow-right-black.svg",alt:"Icon"})]})})]})}),m.jsxs("div",{className:"pages-select",children:[m.jsx("form",{children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Page"}),m.jsx("select",{value:a,onChange:_=>i(Number(_.target.value)),children:Array.from({length:n},(_,T)=>T+1).map(_=>m.jsx("option",{value:_,children:_},`page-${_}`))})]})}),m.jsxs("p",{children:["of ",n]})]})]})},R8=()=>{var jn,Ei,ai,Cr,ji,zi,ws,ua,Fs,Wa;const a=ds(),{channelDetails:n}=Tr(je=>je.appointments),[i,s]=F.useState(!1),l=Li(),{upcommingAppointment:p,completedAppointment:_,cancelledAppointment:T,incompletedAppointment:w,doctorcancelledAppointment:C,missedAppointment:O,upcomingLoading:k,completedLoading:U,cancelledLoading:Y,incompletedLoading:W,doctorcancelledLoading:ee,missedLoading:K}=Tr(je=>je.appointments),[ie,se]=F.useState("upcoming"),[ue,ye]=F.useState(!1),[ae,ve]=F.useState(!1),[$,Q]=F.useState(!1),[te,oe]=F.useState(null),[re,fe]=F.useState(""),[pe,Ne]=F.useState(1),[Je,be]=F.useState(new Date),Ie=8,[Re,Me]=F.useState({patientName:"",age:"",dsCode:"",disease:""}),[he,De]=F.useState([]),[qe,We]=F.useState([]),[Be,bt]=F.useState([]),[St,Tt]=F.useState([]),[ut,tn]=F.useState([]);F.useEffect(()=>{l(Bw()),l(UN()),l(VN()),l(MN()),l(jN())},[l]),F.useEffect(()=>{Ne(1),Me({patientName:"",age:"",dsCode:"",disease:""}),De(p),We(_),bt(T),Tt(w),tn(O)},[ie,p,_,T,w,O]),F.useEffect(()=>{We(Mt(_,"completed"))},[Re]);const Mt=(je,nn)=>je.filter(yn=>{var rn;const nr=!Re.patientName||((rn=yn.patient_name)==null?void 0:rn.toLowerCase().includes(Re.patientName.toLowerCase())),Qe=!Re.age||yn.patient_age.toString().includes(Re.age),Kt=!Re.dscode||yn.ds_code&&yn.ds_code.toLowerCase().includes(Re.dscode.toLowerCase());if(nn==="cancelled"||nn==="incompleted"||nn==="missed")return nr&&Qe&&Kt;const un=!Re.disease||yn.diagnosis&&yn.diagnosis!=="-"&&yn.diagnosis.toLowerCase()===Re.disease.toLowerCase();return nr&&Qe&&Kt&&un}),[wn,Yt]=F.useState(null);F.useEffect(()=>{if(he){const je=he.find(nn=>nn.status===1);Yt(je||null)}},[he]);const Xn=je=>{switch(Me({patientName:je.patientName||"",age:je.age||"",dscode:je.dscode||"",disease:je.disease||""}),ie){case"upcoming":De(Mt(p,"upcoming"));break;case"completed":We(Mt(_,"completed"));break;case"cancelled":bt(Mt(T,"cancelled"));break;case"incompleted":Tt(Mt(w,"incompleted"));break;case"missed":tn(Mt(O,"missed"));break}Ne(1)};JSON.parse(localStorage.getItem("doctor-app")||"{}").doctorData;const en=async je=>{var nn,yn,nr;s(!0);try{const Qe=(nn=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:nn.token,Kt=await Ri.post(`${mi}api/create-channel`,{appointmentId:je},{headers:{Authorization:`Bearer ${Qe}`,"Content-Type":"application/json"}});Kt.data?(l(_K((yn=Kt==null?void 0:Kt.data)==null?void 0:yn.data)),a("/VideoCall",{state:{id:wn.appointment_id,patientId:wn.patient_id,name:wn==null?void 0:wn.patient_name,time_period:wn==null?void 0:wn.time}}),Dt(je)):console.error("Channel creation failed:",(nr=Kt.data)==null?void 0:nr.message)}catch(Qe){console.error("Error creating channel:",Qe)}finally{s(!1)}},Dt=async je=>{console.log("call 222"),await l(Hw({appointmentId:je}))},mt=je=>{const nn=je.toLowerCase().trim(),yn=/^\d+$/.test(je),nr=Qe=>Qe.filter(Kt=>{var ln,mr,yr,oi,Bs,fo,Hs;const un=((ln=Kt.patient_age)==null?void 0:ln.toString())||"",rn=((mr=Kt.patient_phone)==null?void 0:mr.toString())||"",Dn=Kt.datetime?new Date(Kt.datetime).getDate().toString():"",Ai=((yr=Kt.ds_code)==null?void 0:yr.toLowerCase())||"";return yn?un===je||rn.includes(je)||Ai.includes(nn):((oi=Kt.patient_name)==null?void 0:oi.toLowerCase().includes(nn))||((Bs=Kt.patient_gender)==null?void 0:Bs.toLowerCase())===nn||rn.includes(je)||Dn.includes(nn)||Ai.includes(nn)||((fo=Kt.datetime)==null?void 0:fo.toLowerCase().includes(nn))||ie==="completed"&&((Hs=Kt.diagnosis)==null?void 0:Hs.toLowerCase().includes(nn))});switch(ie){case"upcoming":De(nr(p));break;case"completed":We(nr(_));break;case"cancelled":bt(nr(T));break;case"incompleted":Tt(nr(w));break;case"missed":tn(nr(O));break}Ne(1)},kt=je=>{const[nn,yn,nr]=je.split(" "),[Qe,Kt,un]=nn.split("/").map(Number);let[rn,Dn]=yn.split(":").map(Number);return nr==="PM"&&rn!==12&&(rn+=12),nr==="AM"&&rn===12&&(rn=0),new Date(un,Kt-1,Qe,rn,Dn)},Gt=je=>{if(je==null){switch(ie){case"completed":We(_);break;case"cancelled":bt(T);break;case"incompleted":bt(T);break;case"missed":bt(T);break}return}if(!je||je.length!==2)return;const[nn,yn]=je;switch(ie){case"completed":const nr=_.filter(rn=>{const Dn=kt(rn.datetime);return Dn>=nn&&Dn<=yn});We(nr);break;case"cancelled":const Qe=T.filter(rn=>{const Dn=kt(rn.datetime);return Dn>=nn&&Dn<=yn});bt(Qe);break;case"incompleted":const Kt=w.filter(rn=>{const Dn=kt(rn.datetime);return Dn>=nn&&Dn<=yn});Tt(Kt);break;case"missed":const un=O.filter(rn=>{const Dn=kt(rn.datetime);return Dn>=nn&&Dn<=yn});tn(un);break}},Mn=je=>{oe(je),ye(!0)},Ci=()=>{ye(!1),ve(!0)},bs=()=>{l(Nv({appointment_id:te,cancel_message:re})).then(()=>{l(Bw()),ve(!1),fe(""),oe(null),Q(!0)})},Rr=je=>{const nn=pe*Ie,yn=nn-Ie;return je==null?void 0:je.slice(yn,nn)},kn=je=>Math.ceil((je==null?void 0:je.length)/Ie),Mi=je=>{Ne(je)},Ht=()=>{const je=kn(ie==="upcoming"?he:ie==="completed"?qe:ie==="cancelled"?Be:ie==="incompleted"?St:ut);pe<je&&Ne(pe+1)},sn=()=>{pe>1&&Ne(pe-1)};kn(ie==="upcoming"?he:ie==="completed"?qe:ie==="cancelled"?Be:ie==="incompleted"?St:ut);const mn=je=>kt(je)<new Date;return m.jsxs("div",{className:"doctor-panel",children:[m.jsxs("div",{className:"container-fluid",children:[m.jsxs("div",{className:"doc-panel-inr",children:[" ",m.jsx(Ga,{})," "]}),k||U||Y||W?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"doc-panel-body",children:[m.jsx("div",{className:"docpnl-sec-head",children:m.jsx("h1",{className:"h2-title",children:"My Appointments"})}),m.jsx("div",{className:"my-appointments-wrp",children:m.jsxs("div",{className:"my-appointments-inr",children:[m.jsxs("div",{className:"my-appointments-tab-header",children:[m.jsx("div",{className:"my-appointments-tab-head",children:m.jsxs("ul",{style:{position:"relative"},children:[m.jsx("li",{className:"tab-bg"}),m.jsxs("li",{style:ie=="upcoming"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>se("upcoming"),children:[" ","Upcoming"," "]}),m.jsxs("li",{style:ie=="completed"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>se("completed"),children:[" ","Completed"," "]}),m.jsxs("li",{style:ie=="cancelled"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>se("cancelled"),children:[" ","Cancelled"," "]}),m.jsxs("li",{style:ie=="incompleted"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>se("incompleted"),children:[" ","Incompleted"," "]}),m.jsxs("li",{style:ie=="missed"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>se("missed"),children:[" ","Missed"," "]})]})}),m.jsx(dfe,{onFilterChange:Xn,onSearch:mt,onSearchDate:Gt,activeTab:ie})]}),m.jsxs("div",{className:"my-appointments-tab-content-wrp",children:[m.jsxs("div",{className:`myapintmnt-content-tab ${ie==="upcoming"?"upcoming":""}`,style:{display:ie==="upcoming"?"block":"none"},children:[m.jsx("div",{className:"myapintmnt-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Name"}),m.jsx("th",{children:"Age"}),m.jsx("th",{children:"Gender"}),m.jsx("th",{children:"Phone number"}),m.jsx("th",{children:"Appointment date"}),m.jsx("th",{children:"Disease"}),m.jsx("th",{children:"Status"}),m.jsx("th",{children:"Action"})]})}),m.jsxs("tbody",{children:[console.log("filteredUpcomingPatients1234: ",he),((jn=Rr(he))==null?void 0:jn.length)==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"25px 0",fontSize:18,fontWeight:"400",color:"#199FD9"},children:"No data found"})}),(Ei=Rr(he))==null?void 0:Ei.map((je,nn)=>{var yn,nr;return m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String((pe-1)*Ie+nn+1).padStart(2,"0")}),m.jsxs("td",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[m.jsx("img",{src:mi+"/"+(je==null?void 0:je.patient_profile),alt:"Patient"}),m.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[m.jsx(dn,{to:"/patient-profile",state:{patientId:je.patient_id},children:m.jsx("h3",{style:{margin:0,textAlign:"left",color:"#199FD9"},children:je.patient_name||"-"})}),(je==null?void 0:je.referred)==!0?m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(Referred by DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]}):m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]})]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_age||"-"}),m.jsx("td",{style:{color:"#199FD9"},children:((yn=je.patient_gender)==null?void 0:yn.charAt(0).toUpperCase())+((nr=je.patient_gender)==null?void 0:nr.slice(1).toLowerCase())}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_phone||"-"}),m.jsxs("td",{style:{color:"#199FD9"},children:[m.jsx("div",{className:"date h3-title",style:{color:"#199FD9"},children:je.datetime.split(" ")[0]}),m.jsxs("div",{className:"time",style:{color:"#199FD9"},children:[je.datetime.split(" ")[1]," ",je.datetime.split(" ")[2]]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.diseaseName}),m.jsx("td",{children:je.status===1?m.jsx("a",{className:"orange-btn",style:{cursor:i?"not-allowed":"pointer",pointerEvents:i?"none":"auto"},onClick:()=>en(je.appointment_id),children:i?"Loading...":"Start now"}):m.jsx("button",{type:"button",className:"cmn-btn blue-bg",onClick:()=>Mn(je.appointment_id),disabled:mn(je.datetime),style:{opacity:mn(je.datetime)?.6:1,cursor:mn(je.datetime)?"not-allowed":"pointer"},children:"Cancel"})}),m.jsx("td",{children:m.jsx(dn,{to:"/patient-profile",state:{patientId:je.patient_id},className:"cmn-btn",children:"View Profile"})})]},`upcoming-${nn}`)})]})]})}),(he==null?void 0:he.length)>0&&m.jsx(xu,{currentPage:pe,totalPages:kn(he),onPageChange:Mi,onPrevious:sn,onNext:Ht})]}),m.jsxs("div",{className:`myapintmnt-content-tab ${ie==="completed"?"completed":""}`,style:{display:ie==="completed"?"block":"none"},children:[m.jsx("div",{className:"myapintmnt-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Name"}),m.jsx("th",{children:"Age"}),m.jsx("th",{children:"Gender"}),m.jsx("th",{children:"Phone number"}),m.jsx("th",{children:"Appointment date"}),m.jsx("th",{children:"Disease"}),m.jsx("th",{children:"Prescription Details"}),m.jsx("th",{children:"Action"})]})}),m.jsxs("tbody",{children:[((ai=Rr(qe))==null?void 0:ai.length)==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"25px 0",fontSize:18,fontWeight:"400",color:"#199FD9"},children:"No data found"})}),(Cr=Rr(qe))==null?void 0:Cr.map((je,nn)=>{var yn,nr;return m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String((pe-1)*Ie+nn+1).padStart(2,"0")}),m.jsxs("td",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[m.jsx("img",{src:mi+"/"+(je==null?void 0:je.patient_profile),alt:"Patient"}),m.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[m.jsx(dn,{to:"/patient-profile",state:{patientId:je.patient_id},children:m.jsx("h3",{style:{margin:0,textAlign:"left",color:"#199FD9"},children:je.patient_name||"-"})}),(je==null?void 0:je.referred)==!0?m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(Referred by DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]}):m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black",fontSize:15},children:[" ","(DS Code:"," "]}),je.ds_code," ",m.jsx("span",{style:{color:"black"},children:")"})]})]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_age||"-"}),m.jsx("td",{style:{color:"#199FD9"},children:((yn=je.patient_gender)==null?void 0:yn.charAt(0).toUpperCase())+((nr=je.patient_gender)==null?void 0:nr.slice(1).toLowerCase())}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_phone||"-"}),m.jsxs("td",{children:[m.jsx("div",{className:"date h3-title",style:{color:"#199FD9"},children:je.datetime.split(" ")[0]}),m.jsxs("div",{className:"time",style:{color:"#199FD9"},children:[je.datetime.split(" ")[1]," ",je.datetime.split(" ")[2]]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.diseaseName}),m.jsx("td",{children:m.jsx(dn,{to:"/completed-appointment-screen",state:{id:je.appointment_id,patientId:je.patient_id,chat_id:je.chat_id,ds_code:je.ds_code,referred:je.referred,prescription_id:je==null?void 0:je.prescription_id},style:{color:"#199FD9",textDecoration:"underline !important"},className:" text-decoration-underline",children:"View"})}),m.jsx("td",{children:m.jsx(dn,{to:"/patient-profile",state:{patientId:je.patient_id,appointmentId:je.appointment_id,source:"completed",hideSchedule:!1},className:"cmn-btn",children:"View Profile"})})]},`completed-${nn}`)})]})]})}),(qe==null?void 0:qe.length)>0&&m.jsx(xu,{currentPage:pe,totalPages:kn(qe),onPageChange:Mi,onPrevious:sn,onNext:Ht})]}),m.jsxs("div",{className:`myapintmnt-content-tab ${ie==="cancelled"?"cancelled":""}`,style:{display:ie==="cancelled"?"block":"none"},children:[m.jsx("div",{className:"myapintmnt-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Name"}),m.jsx("th",{children:"Age"}),m.jsx("th",{children:"Gender"}),m.jsx("th",{children:"Phone number"}),m.jsx("th",{children:"Appointment date"}),m.jsx("th",{children:"Disease"}),m.jsx("th",{children:"Action"})]})}),m.jsxs("tbody",{children:[((ji=Rr(Be))==null?void 0:ji.length)==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"25px 0",fontSize:18,color:"#199FD9",fontWeight:"400"},children:"No data found"})}),(zi=Rr(Be))==null?void 0:zi.map((je,nn)=>{var yn,nr;return m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String((pe-1)*Ie+nn+1).padStart(2,"0")}),m.jsxs("td",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[m.jsx("img",{src:mi+"/"+(je==null?void 0:je.patient_profile),alt:"Patient"}),m.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[m.jsx(dn,{to:"/patient-profile",state:{patientId:je.patient_id},children:m.jsx("h3",{style:{margin:0,textAlign:"left",color:"#199FD9"},children:je.patient_name||"-"})}),(je==null?void 0:je.referred)==!0?m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(Referred by DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]}):m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]})]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_age||"-"}),m.jsx("td",{style:{color:"#199FD9"},children:((yn=je.patient_gender)==null?void 0:yn.charAt(0).toUpperCase())+((nr=je.patient_gender)==null?void 0:nr.slice(1).toLowerCase())}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_phone||"-"}),m.jsxs("td",{style:{color:"#199FD9"},children:[m.jsx("div",{className:"date h3-title",style:{color:"#199FD9"},children:je.datetime.split(" ")[0]}),m.jsxs("div",{className:"time",style:{color:"#199FD9"},children:[je.datetime.split(" ")[1]," ",je.datetime.split(" ")[2]]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.diseaseName}),m.jsx("td",{children:m.jsx(dn,{to:"/patient-profile",state:{patientId:je.patient_id,appointmentId:je.appointment_id,source:"cancelled",hideSchedule:!0},className:"cmn-btn",children:"View Profile"})})]},`cancelled-${nn}`)})]})]})}),(Be==null?void 0:Be.length)>0&&m.jsx(xu,{currentPage:pe,totalPages:kn(Be),onPageChange:Mi,onPrevious:sn,onNext:Ht})]}),m.jsxs("div",{className:`myapintmnt-content-tab ${ie==="incompleted"?"incompleted":""}`,style:{display:ie==="incompleted"?"block":"none"},children:[m.jsx("div",{className:"myapintmnt-table incomp_tbl",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Name"}),m.jsx("th",{children:"Age"}),m.jsx("th",{children:"Gender"}),m.jsx("th",{children:"Phone number"}),m.jsx("th",{children:"Appointment date"}),m.jsx("th",{children:"Disease"}),m.jsx("th",{children:"Reason"})]})}),m.jsxs("tbody",{children:[((ws=Rr(St))==null?void 0:ws.length)==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"25px 0",fontSize:18,fontWeight:"400",color:"#199FD9"},children:"No data found"})}),(ua=Rr(St))==null?void 0:ua.map((je,nn)=>{var yn,nr;return m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String((pe-1)*Ie+nn+1).padStart(2,"0")}),m.jsxs("td",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[m.jsx("img",{src:mi+"/"+(je==null?void 0:je.patient_profile),alt:"Patient"}),m.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[m.jsx("h3",{style:{margin:0,textAlign:"left",color:"#199FD9"},children:je.patient_name||"-"}),(je==null?void 0:je.referred)==!0?m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(Referred by DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]}):m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]})]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_age||"-"}),m.jsx("td",{style:{color:"#199FD9"},children:((yn=je.patient_gender)==null?void 0:yn.charAt(0).toUpperCase())+((nr=je.patient_gender)==null?void 0:nr.slice(1).toLowerCase())}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_phone||"-"}),m.jsxs("td",{children:[m.jsx("div",{className:"date h3-title",style:{color:"#199FD9"},children:je.datetime.split(" ")[0]}),m.jsxs("div",{className:"time",style:{color:"#199FD9"},children:[je.datetime.split(" ")[1]," ",je.datetime.split(" ")[2]]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.diseaseName}),m.jsx("td",{style:{color:"#199FD9"},children:je.reason})]},`incompleted-${nn}`)})]})]})}),(St==null?void 0:St.length)>0&&m.jsx(xu,{currentPage:pe,totalPages:kn(St),onPageChange:Mi,onPrevious:sn,onNext:Ht})]}),m.jsxs("div",{className:`myapintmnt-content-tab ${ie==="missed"?"missed":""}`,style:{display:ie==="missed"?"block":"none"},children:[m.jsx("div",{className:"myapintmnt-table incomp_tbl",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Name"}),m.jsx("th",{children:"Age"}),m.jsx("th",{children:"Gender"}),m.jsx("th",{children:"Phone number"}),m.jsx("th",{children:"Appointment date"}),m.jsx("th",{children:"Disease"})]})}),m.jsxs("tbody",{children:[((Fs=Rr(ut))==null?void 0:Fs.length)==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"25px 0",fontSize:18,fontWeight:"400",color:"#199FD9"},children:"No data found"})}),(Wa=Rr(ut))==null?void 0:Wa.map((je,nn)=>{var yn,nr;return m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String((pe-1)*Ie+nn+1).padStart(2,"0")}),m.jsxs("td",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[m.jsx("img",{src:mi+"/"+(je==null?void 0:je.patient_profile),alt:"Patient"}),m.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[m.jsx("h3",{style:{margin:0,textAlign:"left",color:"#199FD9"},children:je.patient_name||"-"}),(je==null?void 0:je.referred)==!0?m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(Referred by DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]}):m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]})]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_age||"-"}),m.jsx("td",{style:{color:"#199FD9"},children:((yn=je.patient_gender)==null?void 0:yn.charAt(0).toUpperCase())+((nr=je.patient_gender)==null?void 0:nr.slice(1).toLowerCase())}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_phone||"-"}),m.jsxs("td",{children:[m.jsx("div",{className:"date h3-title",style:{color:"#199FD9"},children:je.datetime.split(" ")[0]}),m.jsxs("div",{className:"time",style:{color:"#199FD9"},children:[je.datetime.split(" ")[1]," ",je.datetime.split(" ")[2]]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.diseaseName})]},`missed-${nn}`)})]})]})}),(ut==null?void 0:ut.length)>0&&m.jsx(xu,{currentPage:pe,totalPages:kn(ut),onPageChange:Mi,onPrevious:sn,onNext:Ht})]})]})]})})]}),m.jsx(po,{})]}),m.jsx(tp,{visible:ue,title:"Cancel Appointment",subtitle:"Are you sure you want to cancel the appointment?",onConfirm:Ci,onCancel:()=>ye(!1),actionType:"cancel"}),m.jsx(tp,{visible:ae,title:"Cancel Appointment",subtitle:"Reason for cancellation",inputField:!0,inputValue:re,onInputChange:je=>fe(je),onCancel:()=>{ve(!1),fe("")},onConfirm:bs,actionType:"info"}),m.jsx(tp,{visible:$,title:"Appointment Cancelled",subtitle:"Your appointment is cancelled successfully.",onConfirm:()=>Q(!1),onCancel:()=>Q(!1),actionType:"success"})]})};function JI(){ct.error("Token Expired"),localStorage.removeItem("doctor-app"),setTimeout(()=>{window.location.href="/"},1e3)}const YN=$t("doctor/getScheduleTime",async(a,{rejectWithValue:n})=>{var i;try{return(await phe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),qN=$t("doctor/completeAppointmentPatientDetails",async(a,{rejectWithValue:n})=>{var i;try{return(await Ahe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),zw=$t("doctor/prescriptionDownload",async(a,{rejectWithValue:n})=>{var i;try{return(await Nhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),KN=$t("doctor/bookAppointment",async(a,{rejectWithValue:n})=>{var i;try{return(await Vhe(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),ufe=sm({name:"prescriptions",initialState:{scheduleTime:[],bookAppointments:[],prescription_Download:[],completeAppointmentPatientDetail:[],loading:!1,error:null},reducers:{},extraReducers:a=>{a.addCase(YN.pending,n=>{n.upcomingLoading=!0,n.error=null}).addCase(YN.fulfilled,(n,i)=>{var s,l;n.upcomingLoading=!1,n.scheduleTime=(l=(s=i.payload)==null?void 0:s.data)==null?void 0:l.available_time_slots}).addCase(YN.rejected,(n,i)=>{n.upcomingLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&JI()}).addCase(qN.pending,n=>{n.loading=!0,n.error=null}).addCase(qN.fulfilled,(n,i)=>{var s;n.loading=!1,n.completeAppointmentPatientDetail=(s=i.payload)==null?void 0:s.data}).addCase(qN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&JI()}).addCase(zw.pending,n=>{n.loading=!0,n.error=null}).addCase(zw.fulfilled,(n,i)=>{n.loading=!1}).addCase(zw.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&JI()}).addCase(KN.pending,n=>{n.loading=!0,n.error=null}).addCase(KN.fulfilled,(n,i)=>{n.loading=!1,n.bookAppointments=i.payload}).addCase(KN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&JI()})}}),hfe=ufe.reducer,pfe=()=>{const a=Wi(),{patientId:n,appointmentId:i,patientName:s}=a.state||{},l=Li(),{scheduleTime:p,loading:_}=Tr(Ne=>Ne.prescriptions),{patientProfileData:T}=Tr(Ne=>Ne.patientProfile),[w,C]=F.useState(new Date),[O,k]=F.useState(),[U,Y]=F.useState(!1),[W,ee]=F.useState(w.getMonth()),[K,ie]=F.useState(w.getFullYear());function se(Ne){const Je=new Date(Ne),be=Je.getFullYear(),Ie=String(Je.getMonth()+1).padStart(2,"0"),Re=String(Je.getDate()).padStart(2,"0");return`${be}-${Ie}-${Re}`}F.useEffect(()=>{ee(w.getMonth()),ie(w.getFullYear())},[w]),F.useEffect(()=>{l(YN({date:se(w)}))},[l,w]);const ye=(()=>{const Ne=[],Je=new Date(K,W,1).getDay(),be=Je===0?7:Je,Ie=new Date(K,W+1,0).getDate(),Re=new Date(K,W,0).getDate();for(let he=be-1;he>0;he--)Ne.push({day:Re-he+1,currentMonth:!1,date:new Date(K,W-1,Re-he+1)});for(let he=1;he<=Ie;he++)Ne.push({day:he,currentMonth:!0,date:new Date(K,W,he)});const Me=7-Ne.length%7;if(Me<7)for(let he=1;he<=Me;he++)Ne.push({day:he,currentMonth:!1,date:new Date(K,W+1,he)});return Ne})(),ae=()=>{let Ne=W-1,Je=K;Ne<0&&(Ne=11,Je-=1),ee(Ne),ie(Je),C(new Date(Je,Ne,1)),k(void 0)},ve=()=>{let Ne=W+1,Je=K;Ne>11&&(Ne=0,Je+=1),ee(Ne),ie(Je),C(new Date(Je,Ne,1)),k(void 0)},$=Ne=>{Ne.currentMonth&&(C(Ne.date),k(void 0))},Q=(Ne,Je=w)=>{if(!Ne||!Je)return!1;const be=Ne.match(/(\d{1,2}:\d{2})\s*(AM|PM)/i);if(!be)return!1;const[,Ie,Re]=be;let[Me,he]=Ie.split(":").map(Number);Re.toLowerCase()==="pm"&&Me!==12&&(Me+=12),Re.toLowerCase()==="am"&&Me===12&&(Me=0);const De=new Date,qe=new Date(Je);if(qe.setHours(0,0,0,0),De.setSeconds(0,0),!(qe.toDateString()===De.toDateString()))return!1;const Be=new Date;return Be.setHours(Me,he,0,0),Be<=De},te=(Ne,Je=w)=>{if(!Ne||!Je)return!1;const be=Ne.match(/(\d{1,2}:\d{2})\s*(AM|PM)/i);if(!be)return!1;const[,Ie,Re]=be;let[Me,he]=Ie.split(":").map(Number);Re.toLowerCase()==="pm"&&Me!==12&&(Me+=12),Re.toLowerCase()==="am"&&Me===12&&(Me=0);const De=new Date,qe=new Date(Je);return qe.setHours(Me,he,0,0),(qe-De)/(1e3*60*60)>=2},oe=(Ne,Je)=>{Je&&(Q(Ne)||k(Ne))},re=async()=>{var Ne,Je;if(!O){ct.error("Please select a time");return}if(!te(O)){ct.error("Appointments must be booked at least 2 hours in advance");return}try{const be=await l(KN({date:se(w),time:O,patient_id:n,appointment_id:i}));(Ne=be.payload)!=null&&Ne.status?Y(!0):ct.error(((Je=be.payload)==null?void 0:Je.message)||"Failed to book appointment")}catch{ct.error("An error occurred while booking the appointment")}},fe=()=>Y(!1),pe=Ne=>{const Je=new Date;return Je.setHours(0,0,0,0),Ne<Je};return m.jsxs("div",{className:"doctor-panel",children:[m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(Ga,{})}),_?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsx("div",{className:"doc-panel-body has-texture",children:m.jsxs("div",{className:"start-appointment cmn-mb",children:[m.jsxs("div",{className:"docpnl-sec-head text-center",children:[m.jsx("h1",{className:"h2-title",children:"Schedule Appointment"}),m.jsx("div",{className:"back-btn",children:m.jsx(dn,{to:"#",onClick:Ne=>{Ne.preventDefault(),window.history.back()},children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),m.jsx("div",{className:"schedule-appointment-wrp",children:m.jsxs("div",{className:"schedule-appointment row",children:[m.jsx("div",{className:"schedule-appointment-left-wrp col-lg-6",children:m.jsx("div",{className:"schedule-appointmnet-left",children:m.jsx("img",{src:"./images/schedule-aapointment-left-img.png",alt:"Schedule"})})}),m.jsx("div",{className:"schedule-appointment-right-wrp col-lg-6",children:m.jsx("div",{className:"schedule-appointment-right",children:m.jsxs("div",{className:"calender-wrp",children:[m.jsx("div",{className:"caleder-heading",children:m.jsx("h2",{className:"h3-title",children:"Select Date and Time"})}),m.jsxs("div",{className:"calender",children:[m.jsxs("div",{className:"calender-monthyear",children:[m.jsx("button",{className:"prev-month",onClick:ae,type:"button",children:m.jsx("img",{src:"./images/chevron-left.svg",alt:"Icon"})}),m.jsx("h2",{className:"h3-title",children:new Date(K,W).toLocaleString("default",{month:"long",year:"numeric"})}),m.jsx("button",{className:"next-month",onClick:ve,type:"button",children:m.jsx("img",{src:"./images/chevron-right.svg",alt:"Icon"})})]}),m.jsx("div",{className:"calneder-body",children:m.jsxs("div",{className:"calender-body-inr",children:[m.jsxs("div",{className:"week-days-wrp",children:[m.jsx("div",{children:"Mon"}),m.jsx("div",{children:"Tue"}),m.jsx("div",{children:"Wed"}),m.jsx("div",{children:"Thu"}),m.jsx("div",{children:"Fri"}),m.jsx("div",{children:"Sat"}),m.jsx("div",{children:"Sun"})]}),m.jsx("div",{className:"moth-days-wrp",children:ye.map((Ne,Je)=>{const be=se(Ne.date)===se(w),Ie=se(Ne.date)===se(new Date),Re=!Ne.currentMonth||pe(Ne.date);return m.jsx("div",{className:`day ${be?"selected-day":Ie?"today":""} ${Ne.currentMonth?"":"not-current-month"} ${Re?"disabled-day":""}`,onClick:()=>$(Ne),style:{cursor:Re?"default":"pointer",color:Ne.currentMonth?Re?"#999":be?"#fff":"#356598":"#ccc",backgroundColor:be?"#199FD9":Ie?"#ccc":"transparent",borderRadius:be?"50%":"0",userSelect:"none",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",margin:"2px",fontWeight:be?"bold":"normal"},children:Ne.day},Je)})})]})}),m.jsxs("div",{className:"selected-date",style:{marginTop:"15px",fontWeight:"bold"},children:["Selected:"," ",w.toLocaleString("default",{month:"long",day:"numeric",year:"numeric"})]}),m.jsxs("div",{className:"select-time-wrp",style:{marginTop:"15px"},children:[_&&m.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",minHeight:"100px"},children:m.jsx("span",{className:"loader"})}),p.map(Ne=>{const Je=!(Ne!=null&&Ne.is_available),be=Q(Ne==null?void 0:Ne.display_time),Ie=O===(Ne==null?void 0:Ne.display_time);return m.jsx("div",{className:`available-time 
                                      ${Je?"booked-time":""}
                                      ${be?"disabled-time":""}
                                      ${Ie?"selected":""}`,onClick:()=>oe(Ne==null?void 0:Ne.display_time,Ne==null?void 0:Ne.is_available),style:{pointerEvents:Je||be?"none":"auto",opacity:Je||be?.5:1,cursor:Je||be?"default":"pointer",userSelect:"none",padding:"8px 12px",borderRadius:"4px",margin:"4px",display:"inline-block",border:Ie?"2px solid #199FD9":"1px solid #ccc",fontWeight:Ie?"bold":"normal"},children:Ne==null?void 0:Ne.display_time},Ne==null?void 0:Ne.value)})]}),m.jsx("button",{type:"button",className:"orange-btn book-btn",onClick:re,disabled:!w||!O,style:{marginTop:"20px"},children:"Book Now"})]})]})})})]})})]})}),m.jsx(po,{})]}),m.jsxs(bn,{show:U,onHide:fe,centered:!0,className:"popup-wrp",id:"congratulations",dialogClassName:"custom-modal",children:[m.jsx("style",{children:`
            .custom-modal .modal-content {
              padding: 30px 0 50px 0;
              margin: 0;
            }
          `}),m.jsx("button",{type:"button",className:"close",onClick:fe,"aria-label":"Close",children:m.jsx("span",{"aria-hidden":"true",children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close"})})}),m.jsx("div",{className:"modal-icon text-center mt-4",children:m.jsx("img",{src:"./images/check-icon.png",alt:"Icon"})}),m.jsxs(bn.Header,{className:"border-0 flex-column text-center",children:[m.jsx(bn.Title,{id:"exampleModalLongTitle",className:"w-100",children:m.jsx("h2",{children:"Congratulations"})}),m.jsxs("p",{style:{padding:"20px",fontSize:"20px",color:"#858484"},children:["Your appointment with",m.jsx("br",{})," ",s," is confirmed for ",m.jsx("br",{}),m.jsx("span",{className:"bookingDateTime",children:w&&O?`${w.toLocaleString("default",{month:"long",day:"numeric",year:"numeric"})} at ${O}`:""}),"."]})]}),m.jsx(bn.Footer,{className:"d-flex justify-content-center border-0",children:m.jsx(dn,{to:"/doctor-home",className:"orange-btn",onClick:fe,children:"Ok"})})]})]})},ffe=()=>{};var C8={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yK=function(a){const n=[];let i=0;for(let s=0;s<a.length;s++){let l=a.charCodeAt(s);l<128?n[i++]=l:l<2048?(n[i++]=l>>6|192,n[i++]=l&63|128):(l&64512)===55296&&s+1<a.length&&(a.charCodeAt(s+1)&64512)===56320?(l=65536+((l&1023)<<10)+(a.charCodeAt(++s)&1023),n[i++]=l>>18|240,n[i++]=l>>12&63|128,n[i++]=l>>6&63|128,n[i++]=l&63|128):(n[i++]=l>>12|224,n[i++]=l>>6&63|128,n[i++]=l&63|128)}return n},mfe=function(a){const n=[];let i=0,s=0;for(;i<a.length;){const l=a[i++];if(l<128)n[s++]=String.fromCharCode(l);else if(l>191&&l<224){const p=a[i++];n[s++]=String.fromCharCode((l&31)<<6|p&63)}else if(l>239&&l<365){const p=a[i++],_=a[i++],T=a[i++],w=((l&7)<<18|(p&63)<<12|(_&63)<<6|T&63)-65536;n[s++]=String.fromCharCode(55296+(w>>10)),n[s++]=String.fromCharCode(56320+(w&1023))}else{const p=a[i++],_=a[i++];n[s++]=String.fromCharCode((l&15)<<12|(p&63)<<6|_&63)}}return n.join("")},vK={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(a,n){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=n?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let l=0;l<a.length;l+=3){const p=a[l],_=l+1<a.length,T=_?a[l+1]:0,w=l+2<a.length,C=w?a[l+2]:0,O=p>>2,k=(p&3)<<4|T>>4;let U=(T&15)<<2|C>>6,Y=C&63;w||(Y=64,_||(U=64)),s.push(i[O],i[k],i[U],i[Y])}return s.join("")},encodeString(a,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(a):this.encodeByteArray(yK(a),n)},decodeString(a,n){return this.HAS_NATIVE_SUPPORT&&!n?atob(a):mfe(this.decodeStringToByteArray(a,n))},decodeStringToByteArray(a,n){this.init_();const i=n?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let l=0;l<a.length;){const p=i[a.charAt(l++)],T=l<a.length?i[a.charAt(l)]:0;++l;const C=l<a.length?i[a.charAt(l)]:64;++l;const k=l<a.length?i[a.charAt(l)]:64;if(++l,p==null||T==null||C==null||k==null)throw new gfe;const U=p<<2|T>>4;if(s.push(U),C!==64){const Y=T<<4&240|C>>2;if(s.push(Y),k!==64){const W=C<<6&192|k;s.push(W)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}};class gfe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const _fe=function(a){const n=yK(a);return vK.encodeByteArray(n,!0)},TO=function(a){return _fe(a).replace(/\./g,"")},Efe=function(a){try{return vK.decodeString(a,!0)}catch(n){console.error("base64Decode failed: ",n)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yfe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vfe=()=>yfe().__FIREBASE_DEFAULTS__,Sfe=()=>{if(typeof process>"u"||typeof C8>"u")return;const a=C8.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)},Tfe=()=>{if(typeof document>"u")return;let a;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const n=a&&Efe(a[1]);return n&&JSON.parse(n)},ij=()=>{try{return ffe()||vfe()||Sfe()||Tfe()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}},bfe=a=>{var n,i;return(i=(n=ij())===null||n===void 0?void 0:n.emulatorHosts)===null||i===void 0?void 0:i[a]},SK=a=>{const n=bfe(a);if(!n)return;const i=n.lastIndexOf(":");if(i<=0||i+1===n.length)throw new Error(`Invalid host ${n} with no separate hostname and port!`);const s=parseInt(n.substring(i+1),10);return n[0]==="["?[n.substring(1,i-1),s]:[n.substring(0,i),s]},TK=()=>{var a;return(a=ij())===null||a===void 0?void 0:a.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wfe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((n,i)=>{this.resolve=n,this.reject=i})}wrapCallback(n){return(i,s)=>{i?this.reject(i):this.resolve(s),typeof n=="function"&&(this.promise.catch(()=>{}),n.length===1?n(i):n(i,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bK(a,n){if(a.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},s=n||"demo-project",l=a.iat||0,p=a.sub||a.user_id;if(!p)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const _=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:l,exp:l+3600,auth_time:l,sub:p,user_id:p,firebase:{sign_in_provider:"custom",identities:{}}},a);return[TO(JSON.stringify(i)),TO(JSON.stringify(_)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rfe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Cfe(){var a;const n=(a=ij())===null||a===void 0?void 0:a.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Afe(){return!Cfe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ife(){try{return typeof indexedDB=="object"}catch{return!1}}function Nfe(){return new Promise((a,n)=>{try{let i=!0;const s="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(s);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(s),a(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var p;n(((p=l.error)===null||p===void 0?void 0:p.message)||"")}}catch(i){n(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ofe="FirebaseError";class M_ extends Error{constructor(n,i,s){super(i),this.code=n,this.customData=s,this.name=Ofe,Object.setPrototypeOf(this,M_.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,wK.prototype.create)}}class wK{constructor(n,i,s){this.service=n,this.serviceName=i,this.errors=s}create(n,...i){const s=i[0]||{},l=`${this.service}/${n}`,p=this.errors[n],_=p?Dfe(p,s):"Error",T=`${this.serviceName}: ${_} (${l}).`;return new M_(l,T,s)}}function Dfe(a,n){return a.replace(xfe,(i,s)=>{const l=n[s];return l!=null?String(l):`<${s}?>`})}const xfe=/\{\$([^}]+)}/g;function bO(a,n){if(a===n)return!0;const i=Object.keys(a),s=Object.keys(n);for(const l of i){if(!s.includes(l))return!1;const p=a[l],_=n[l];if(A8(p)&&A8(_)){if(!bO(p,_))return!1}else if(p!==_)return!1}for(const l of s)if(!i.includes(l))return!1;return!0}function A8(a){return a!==null&&typeof a=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jo(a){return a&&a._delegate?a._delegate:a}class Mv{constructor(n,i,s){this.name=n,this.instanceFactory=i,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(n){return this.instantiationMode=n,this}setMultipleInstances(n){return this.multipleInstances=n,this}setServiceProps(n){return this.serviceProps=n,this}setInstanceCreatedCallback(n){return this.onInstanceCreated=n,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s_="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pfe{constructor(n,i){this.name=n,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(n){const i=this.normalizeInstanceIdentifier(n);if(!this.instancesDeferred.has(i)){const s=new wfe;if(this.instancesDeferred.set(i,s),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&s.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(n){var i;const s=this.normalizeInstanceIdentifier(n==null?void 0:n.identifier),l=(i=n==null?void 0:n.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(p){if(l)return null;throw p}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(n){if(n.name!==this.name)throw Error(`Mismatching Component ${n.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=n,!!this.shouldAutoInitialize()){if(Lfe(n))try{this.getOrInitializeService({instanceIdentifier:s_})}catch{}for(const[i,s]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const p=this.getOrInitializeService({instanceIdentifier:l});s.resolve(p)}catch{}}}}clearInstance(n=s_){this.instancesDeferred.delete(n),this.instancesOptions.delete(n),this.instances.delete(n)}async delete(){const n=Array.from(this.instances.values());await Promise.all([...n.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...n.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(n=s_){return this.instances.has(n)}getOptions(n=s_){return this.instancesOptions.get(n)||{}}initialize(n={}){const{options:i={}}=n,s=this.normalizeInstanceIdentifier(n.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:s,options:i});for(const[p,_]of this.instancesDeferred.entries()){const T=this.normalizeInstanceIdentifier(p);s===T&&_.resolve(l)}return l}onInit(n,i){var s;const l=this.normalizeInstanceIdentifier(i),p=(s=this.onInitCallbacks.get(l))!==null&&s!==void 0?s:new Set;p.add(n),this.onInitCallbacks.set(l,p);const _=this.instances.get(l);return _&&n(_,l),()=>{p.delete(n)}}invokeOnInitCallbacks(n,i){const s=this.onInitCallbacks.get(i);if(s)for(const l of s)try{l(n,i)}catch{}}getOrInitializeService({instanceIdentifier:n,options:i={}}){let s=this.instances.get(n);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:kfe(n),options:i}),this.instances.set(n,s),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(s,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,s)}catch{}return s||null}normalizeInstanceIdentifier(n=s_){return this.component?this.component.multipleInstances?n:s_:n}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function kfe(a){return a===s_?void 0:a}function Lfe(a){return a.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mfe{constructor(n){this.name=n,this.providers=new Map}addComponent(n){const i=this.getProvider(n.name);if(i.isComponentSet())throw new Error(`Component ${n.name} has already been registered with ${this.name}`);i.setComponent(n)}addOrOverwriteComponent(n){this.getProvider(n.name).isComponentSet()&&this.providers.delete(n.name),this.addComponent(n)}getProvider(n){if(this.providers.has(n))return this.providers.get(n);const i=new Pfe(n,this);return this.providers.set(n,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lr;(function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"})(Lr||(Lr={}));const jfe={debug:Lr.DEBUG,verbose:Lr.VERBOSE,info:Lr.INFO,warn:Lr.WARN,error:Lr.ERROR,silent:Lr.SILENT},Ufe=Lr.INFO,Vfe={[Lr.DEBUG]:"log",[Lr.VERBOSE]:"log",[Lr.INFO]:"info",[Lr.WARN]:"warn",[Lr.ERROR]:"error"},Ffe=(a,n,...i)=>{if(n<a.logLevel)return;const s=new Date().toISOString(),l=Vfe[n];if(l)console[l](`[${s}]  ${a.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${n})`)};class RK{constructor(n){this.name=n,this._logLevel=Ufe,this._logHandler=Ffe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(n){if(!(n in Lr))throw new TypeError(`Invalid value "${n}" assigned to \`logLevel\``);this._logLevel=n}setLogLevel(n){this._logLevel=typeof n=="string"?jfe[n]:n}get logHandler(){return this._logHandler}set logHandler(n){if(typeof n!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=n}get userLogHandler(){return this._userLogHandler}set userLogHandler(n){this._userLogHandler=n}debug(...n){this._userLogHandler&&this._userLogHandler(this,Lr.DEBUG,...n),this._logHandler(this,Lr.DEBUG,...n)}log(...n){this._userLogHandler&&this._userLogHandler(this,Lr.VERBOSE,...n),this._logHandler(this,Lr.VERBOSE,...n)}info(...n){this._userLogHandler&&this._userLogHandler(this,Lr.INFO,...n),this._logHandler(this,Lr.INFO,...n)}warn(...n){this._userLogHandler&&this._userLogHandler(this,Lr.WARN,...n),this._logHandler(this,Lr.WARN,...n)}error(...n){this._userLogHandler&&this._userLogHandler(this,Lr.ERROR,...n),this._logHandler(this,Lr.ERROR,...n)}}const Bfe=(a,n)=>n.some(i=>a instanceof i);let I8,N8;function Hfe(){return I8||(I8=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Gfe(){return N8||(N8=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const CK=new WeakMap,t2=new WeakMap,AK=new WeakMap,eM=new WeakMap,sj=new WeakMap;function Wfe(a){const n=new Promise((i,s)=>{const l=()=>{a.removeEventListener("success",p),a.removeEventListener("error",_)},p=()=>{i(Gf(a.result)),l()},_=()=>{s(a.error),l()};a.addEventListener("success",p),a.addEventListener("error",_)});return n.then(i=>{i instanceof IDBCursor&&CK.set(i,a)}).catch(()=>{}),sj.set(n,a),n}function zfe(a){if(t2.has(a))return;const n=new Promise((i,s)=>{const l=()=>{a.removeEventListener("complete",p),a.removeEventListener("error",_),a.removeEventListener("abort",_)},p=()=>{i(),l()},_=()=>{s(a.error||new DOMException("AbortError","AbortError")),l()};a.addEventListener("complete",p),a.addEventListener("error",_),a.addEventListener("abort",_)});t2.set(a,n)}let n2={get(a,n,i){if(a instanceof IDBTransaction){if(n==="done")return t2.get(a);if(n==="objectStoreNames")return a.objectStoreNames||AK.get(a);if(n==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Gf(a[n])},set(a,n,i){return a[n]=i,!0},has(a,n){return a instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in a}};function Yfe(a){n2=a(n2)}function qfe(a){return a===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(n,...i){const s=a.call(tM(this),n,...i);return AK.set(s,n.sort?n.sort():[n]),Gf(s)}:Gfe().includes(a)?function(...n){return a.apply(tM(this),n),Gf(CK.get(this))}:function(...n){return Gf(a.apply(tM(this),n))}}function Kfe(a){return typeof a=="function"?qfe(a):(a instanceof IDBTransaction&&zfe(a),Bfe(a,Hfe())?new Proxy(a,n2):a)}function Gf(a){if(a instanceof IDBRequest)return Wfe(a);if(eM.has(a))return eM.get(a);const n=Kfe(a);return n!==a&&(eM.set(a,n),sj.set(n,a)),n}const tM=a=>sj.get(a);function Xfe(a,n,{blocked:i,upgrade:s,blocking:l,terminated:p}={}){const _=indexedDB.open(a,n),T=Gf(_);return s&&_.addEventListener("upgradeneeded",w=>{s(Gf(_.result),w.oldVersion,w.newVersion,Gf(_.transaction),w)}),i&&_.addEventListener("blocked",w=>i(w.oldVersion,w.newVersion,w)),T.then(w=>{p&&w.addEventListener("close",()=>p()),l&&w.addEventListener("versionchange",C=>l(C.oldVersion,C.newVersion,C))}).catch(()=>{}),T}const Qfe=["get","getKey","getAll","getAllKeys","count"],$fe=["put","add","delete","clear"],nM=new Map;function O8(a,n){if(!(a instanceof IDBDatabase&&!(n in a)&&typeof n=="string"))return;if(nM.get(n))return nM.get(n);const i=n.replace(/FromIndex$/,""),s=n!==i,l=$fe.includes(i);if(!(i in(s?IDBIndex:IDBObjectStore).prototype)||!(l||Qfe.includes(i)))return;const p=async function(_,...T){const w=this.transaction(_,l?"readwrite":"readonly");let C=w.store;return s&&(C=C.index(T.shift())),(await Promise.all([C[i](...T),l&&w.done]))[0]};return nM.set(n,p),p}Yfe(a=>({...a,get:(n,i,s)=>O8(n,i)||a.get(n,i,s),has:(n,i)=>!!O8(n,i)||a.has(n,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jfe{constructor(n){this.container=n}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(Zfe(i)){const s=i.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(i=>i).join(" ")}}function Zfe(a){const n=a.getComponent();return(n==null?void 0:n.type)==="VERSION"}const r2="@firebase/app",D8="0.11.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const up=new RK("@firebase/app"),eme="@firebase/app-compat",tme="@firebase/analytics-compat",nme="@firebase/analytics",rme="@firebase/app-check-compat",ime="@firebase/app-check",sme="@firebase/auth",ame="@firebase/auth-compat",ome="@firebase/database",cme="@firebase/data-connect",lme="@firebase/database-compat",dme="@firebase/functions",ume="@firebase/functions-compat",hme="@firebase/installations",pme="@firebase/installations-compat",fme="@firebase/messaging",mme="@firebase/messaging-compat",gme="@firebase/performance",_me="@firebase/performance-compat",Eme="@firebase/remote-config",yme="@firebase/remote-config-compat",vme="@firebase/storage",Sme="@firebase/storage-compat",Tme="@firebase/firestore",bme="@firebase/vertexai",wme="@firebase/firestore-compat",Rme="firebase",Cme="11.6.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i2="[DEFAULT]",Ame={[r2]:"fire-core",[eme]:"fire-core-compat",[nme]:"fire-analytics",[tme]:"fire-analytics-compat",[ime]:"fire-app-check",[rme]:"fire-app-check-compat",[sme]:"fire-auth",[ame]:"fire-auth-compat",[ome]:"fire-rtdb",[cme]:"fire-data-connect",[lme]:"fire-rtdb-compat",[dme]:"fire-fn",[ume]:"fire-fn-compat",[hme]:"fire-iid",[pme]:"fire-iid-compat",[fme]:"fire-fcm",[mme]:"fire-fcm-compat",[gme]:"fire-perf",[_me]:"fire-perf-compat",[Eme]:"fire-rc",[yme]:"fire-rc-compat",[vme]:"fire-gcs",[Sme]:"fire-gcs-compat",[Tme]:"fire-fst",[wme]:"fire-fst-compat",[bme]:"fire-vertex","fire-js":"fire-js",[Rme]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wO=new Map,Ime=new Map,s2=new Map;function x8(a,n){try{a.container.addComponent(n)}catch(i){up.debug(`Component ${n.name} failed to register with FirebaseApp ${a.name}`,i)}}function nR(a){const n=a.name;if(s2.has(n))return up.debug(`There were multiple attempts to register component ${n}.`),!1;s2.set(n,a);for(const i of wO.values())x8(i,a);for(const i of Ime.values())x8(i,a);return!0}function IK(a,n){const i=a.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),a.container.getProvider(n)}function NK(a){return a==null?!1:a.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nme={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Wf=new wK("app","Firebase",Nme);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ome{constructor(n,i,s){this._isDeleted=!1,this._options=Object.assign({},n),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Mv("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(n){this.checkDestroyed(),this._automaticDataCollectionEnabled=n}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(n){this._isDeleted=n}checkDestroyed(){if(this.isDeleted)throw Wf.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OK=Cme;function DK(a,n={}){let i=a;typeof n!="object"&&(n={name:n});const s=Object.assign({name:i2,automaticDataCollectionEnabled:!1},n),l=s.name;if(typeof l!="string"||!l)throw Wf.create("bad-app-name",{appName:String(l)});if(i||(i=TK()),!i)throw Wf.create("no-options");const p=wO.get(l);if(p){if(bO(i,p.options)&&bO(s,p.config))return p;throw Wf.create("duplicate-app",{appName:l})}const _=new Mfe(l);for(const w of s2.values())_.addComponent(w);const T=new Ome(i,s,_);return wO.set(l,T),T}function xK(a=i2){const n=wO.get(a);if(!n&&a===i2&&TK())return DK();if(!n)throw Wf.create("no-app",{appName:a});return n}function zf(a,n,i){var s;let l=(s=Ame[a])!==null&&s!==void 0?s:a;i&&(l+=`-${i}`);const p=l.match(/\s|\//),_=n.match(/\s|\//);if(p||_){const T=[`Unable to register library "${l}" with version "${n}":`];p&&T.push(`library name "${l}" contains illegal characters (whitespace or "/")`),p&&_&&T.push("and"),_&&T.push(`version name "${n}" contains illegal characters (whitespace or "/")`),up.warn(T.join(" "));return}nR(new Mv(`${l}-version`,()=>({library:l,version:n}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dme="firebase-heartbeat-database",xme=1,rR="firebase-heartbeat-store";let rM=null;function PK(){return rM||(rM=Xfe(Dme,xme,{upgrade:(a,n)=>{switch(n){case 0:try{a.createObjectStore(rR)}catch(i){console.warn(i)}}}}).catch(a=>{throw Wf.create("idb-open",{originalErrorMessage:a.message})})),rM}async function Pme(a){try{const i=(await PK()).transaction(rR),s=await i.objectStore(rR).get(kK(a));return await i.done,s}catch(n){if(n instanceof M_)up.warn(n.message);else{const i=Wf.create("idb-get",{originalErrorMessage:n==null?void 0:n.message});up.warn(i.message)}}}async function P8(a,n){try{const s=(await PK()).transaction(rR,"readwrite");await s.objectStore(rR).put(n,kK(a)),await s.done}catch(i){if(i instanceof M_)up.warn(i.message);else{const s=Wf.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});up.warn(s.message)}}}function kK(a){return`${a.name}!${a.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kme=1024,Lme=30;class Mme{constructor(n){this.container=n,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new Ume(i),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var n,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),p=k8();if(((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===p||this._heartbeatsCache.heartbeats.some(_=>_.date===p))return;if(this._heartbeatsCache.heartbeats.push({date:p,agent:l}),this._heartbeatsCache.heartbeats.length>Lme){const _=Vme(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(_,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){up.warn(s)}}async getHeartbeatsHeader(){var n;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=k8(),{heartbeatsToSend:s,unsentEntries:l}=jme(this._heartbeatsCache.heartbeats),p=TO(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),p}catch(i){return up.warn(i),""}}}function k8(){return new Date().toISOString().substring(0,10)}function jme(a,n=kme){const i=[];let s=a.slice();for(const l of a){const p=i.find(_=>_.agent===l.agent);if(p){if(p.dates.push(l.date),L8(i)>n){p.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),L8(i)>n){i.pop();break}s=s.slice(1)}return{heartbeatsToSend:i,unsentEntries:s}}class Ume{constructor(n){this.app=n,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ife()?Nfe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await Pme(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(n){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return P8(this.app,{lastSentHeartbeatDate:(i=n.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:n.heartbeats})}else return}async add(n){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return P8(this.app,{lastSentHeartbeatDate:(i=n.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...n.heartbeats]})}else return}}function L8(a){return TO(JSON.stringify({version:2,heartbeats:a})).length}function Vme(a){if(a.length===0)return-1;let n=0,i=a[0].date;for(let s=1;s<a.length;s++)a[s].date<i&&(i=a[s].date,n=s);return n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fme(a){nR(new Mv("platform-logger",n=>new Jfe(n),"PRIVATE")),nR(new Mv("heartbeat",n=>new Mme(n),"PRIVATE")),zf(r2,D8,a),zf(r2,D8,"esm2017"),zf("fire-js","")}Fme("");var M8=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Yf,LK;(function(){var a;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function n($,Q){function te(){}te.prototype=Q.prototype,$.D=Q.prototype,$.prototype=new te,$.prototype.constructor=$,$.C=function(oe,re,fe){for(var pe=Array(arguments.length-2),Ne=2;Ne<arguments.length;Ne++)pe[Ne-2]=arguments[Ne];return Q.prototype[re].apply(oe,pe)}}function i(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}n(s,i),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l($,Q,te){te||(te=0);var oe=Array(16);if(typeof Q=="string")for(var re=0;16>re;++re)oe[re]=Q.charCodeAt(te++)|Q.charCodeAt(te++)<<8|Q.charCodeAt(te++)<<16|Q.charCodeAt(te++)<<24;else for(re=0;16>re;++re)oe[re]=Q[te++]|Q[te++]<<8|Q[te++]<<16|Q[te++]<<24;Q=$.g[0],te=$.g[1],re=$.g[2];var fe=$.g[3],pe=Q+(fe^te&(re^fe))+oe[0]+3614090360&4294967295;Q=te+(pe<<7&4294967295|pe>>>25),pe=fe+(re^Q&(te^re))+oe[1]+3905402710&4294967295,fe=Q+(pe<<12&4294967295|pe>>>20),pe=re+(te^fe&(Q^te))+oe[2]+606105819&4294967295,re=fe+(pe<<17&4294967295|pe>>>15),pe=te+(Q^re&(fe^Q))+oe[3]+3250441966&4294967295,te=re+(pe<<22&4294967295|pe>>>10),pe=Q+(fe^te&(re^fe))+oe[4]+4118548399&4294967295,Q=te+(pe<<7&4294967295|pe>>>25),pe=fe+(re^Q&(te^re))+oe[5]+1200080426&4294967295,fe=Q+(pe<<12&4294967295|pe>>>20),pe=re+(te^fe&(Q^te))+oe[6]+2821735955&4294967295,re=fe+(pe<<17&4294967295|pe>>>15),pe=te+(Q^re&(fe^Q))+oe[7]+4249261313&4294967295,te=re+(pe<<22&4294967295|pe>>>10),pe=Q+(fe^te&(re^fe))+oe[8]+1770035416&4294967295,Q=te+(pe<<7&4294967295|pe>>>25),pe=fe+(re^Q&(te^re))+oe[9]+2336552879&4294967295,fe=Q+(pe<<12&4294967295|pe>>>20),pe=re+(te^fe&(Q^te))+oe[10]+4294925233&4294967295,re=fe+(pe<<17&4294967295|pe>>>15),pe=te+(Q^re&(fe^Q))+oe[11]+2304563134&4294967295,te=re+(pe<<22&4294967295|pe>>>10),pe=Q+(fe^te&(re^fe))+oe[12]+1804603682&4294967295,Q=te+(pe<<7&4294967295|pe>>>25),pe=fe+(re^Q&(te^re))+oe[13]+4254626195&4294967295,fe=Q+(pe<<12&4294967295|pe>>>20),pe=re+(te^fe&(Q^te))+oe[14]+2792965006&4294967295,re=fe+(pe<<17&4294967295|pe>>>15),pe=te+(Q^re&(fe^Q))+oe[15]+1236535329&4294967295,te=re+(pe<<22&4294967295|pe>>>10),pe=Q+(re^fe&(te^re))+oe[1]+4129170786&4294967295,Q=te+(pe<<5&4294967295|pe>>>27),pe=fe+(te^re&(Q^te))+oe[6]+3225465664&4294967295,fe=Q+(pe<<9&4294967295|pe>>>23),pe=re+(Q^te&(fe^Q))+oe[11]+643717713&4294967295,re=fe+(pe<<14&4294967295|pe>>>18),pe=te+(fe^Q&(re^fe))+oe[0]+3921069994&4294967295,te=re+(pe<<20&4294967295|pe>>>12),pe=Q+(re^fe&(te^re))+oe[5]+3593408605&4294967295,Q=te+(pe<<5&4294967295|pe>>>27),pe=fe+(te^re&(Q^te))+oe[10]+38016083&4294967295,fe=Q+(pe<<9&4294967295|pe>>>23),pe=re+(Q^te&(fe^Q))+oe[15]+3634488961&4294967295,re=fe+(pe<<14&4294967295|pe>>>18),pe=te+(fe^Q&(re^fe))+oe[4]+3889429448&4294967295,te=re+(pe<<20&4294967295|pe>>>12),pe=Q+(re^fe&(te^re))+oe[9]+568446438&4294967295,Q=te+(pe<<5&4294967295|pe>>>27),pe=fe+(te^re&(Q^te))+oe[14]+3275163606&4294967295,fe=Q+(pe<<9&4294967295|pe>>>23),pe=re+(Q^te&(fe^Q))+oe[3]+4107603335&4294967295,re=fe+(pe<<14&4294967295|pe>>>18),pe=te+(fe^Q&(re^fe))+oe[8]+1163531501&4294967295,te=re+(pe<<20&4294967295|pe>>>12),pe=Q+(re^fe&(te^re))+oe[13]+2850285829&4294967295,Q=te+(pe<<5&4294967295|pe>>>27),pe=fe+(te^re&(Q^te))+oe[2]+4243563512&4294967295,fe=Q+(pe<<9&4294967295|pe>>>23),pe=re+(Q^te&(fe^Q))+oe[7]+1735328473&4294967295,re=fe+(pe<<14&4294967295|pe>>>18),pe=te+(fe^Q&(re^fe))+oe[12]+2368359562&4294967295,te=re+(pe<<20&4294967295|pe>>>12),pe=Q+(te^re^fe)+oe[5]+4294588738&4294967295,Q=te+(pe<<4&4294967295|pe>>>28),pe=fe+(Q^te^re)+oe[8]+2272392833&4294967295,fe=Q+(pe<<11&4294967295|pe>>>21),pe=re+(fe^Q^te)+oe[11]+1839030562&4294967295,re=fe+(pe<<16&4294967295|pe>>>16),pe=te+(re^fe^Q)+oe[14]+4259657740&4294967295,te=re+(pe<<23&4294967295|pe>>>9),pe=Q+(te^re^fe)+oe[1]+2763975236&4294967295,Q=te+(pe<<4&4294967295|pe>>>28),pe=fe+(Q^te^re)+oe[4]+1272893353&4294967295,fe=Q+(pe<<11&4294967295|pe>>>21),pe=re+(fe^Q^te)+oe[7]+4139469664&4294967295,re=fe+(pe<<16&4294967295|pe>>>16),pe=te+(re^fe^Q)+oe[10]+3200236656&4294967295,te=re+(pe<<23&4294967295|pe>>>9),pe=Q+(te^re^fe)+oe[13]+681279174&4294967295,Q=te+(pe<<4&4294967295|pe>>>28),pe=fe+(Q^te^re)+oe[0]+3936430074&4294967295,fe=Q+(pe<<11&4294967295|pe>>>21),pe=re+(fe^Q^te)+oe[3]+3572445317&4294967295,re=fe+(pe<<16&4294967295|pe>>>16),pe=te+(re^fe^Q)+oe[6]+76029189&4294967295,te=re+(pe<<23&4294967295|pe>>>9),pe=Q+(te^re^fe)+oe[9]+3654602809&4294967295,Q=te+(pe<<4&4294967295|pe>>>28),pe=fe+(Q^te^re)+oe[12]+3873151461&4294967295,fe=Q+(pe<<11&4294967295|pe>>>21),pe=re+(fe^Q^te)+oe[15]+530742520&4294967295,re=fe+(pe<<16&4294967295|pe>>>16),pe=te+(re^fe^Q)+oe[2]+3299628645&4294967295,te=re+(pe<<23&4294967295|pe>>>9),pe=Q+(re^(te|~fe))+oe[0]+4096336452&4294967295,Q=te+(pe<<6&4294967295|pe>>>26),pe=fe+(te^(Q|~re))+oe[7]+1126891415&4294967295,fe=Q+(pe<<10&4294967295|pe>>>22),pe=re+(Q^(fe|~te))+oe[14]+2878612391&4294967295,re=fe+(pe<<15&4294967295|pe>>>17),pe=te+(fe^(re|~Q))+oe[5]+4237533241&4294967295,te=re+(pe<<21&4294967295|pe>>>11),pe=Q+(re^(te|~fe))+oe[12]+1700485571&4294967295,Q=te+(pe<<6&4294967295|pe>>>26),pe=fe+(te^(Q|~re))+oe[3]+2399980690&4294967295,fe=Q+(pe<<10&4294967295|pe>>>22),pe=re+(Q^(fe|~te))+oe[10]+4293915773&4294967295,re=fe+(pe<<15&4294967295|pe>>>17),pe=te+(fe^(re|~Q))+oe[1]+2240044497&4294967295,te=re+(pe<<21&4294967295|pe>>>11),pe=Q+(re^(te|~fe))+oe[8]+1873313359&4294967295,Q=te+(pe<<6&4294967295|pe>>>26),pe=fe+(te^(Q|~re))+oe[15]+4264355552&4294967295,fe=Q+(pe<<10&4294967295|pe>>>22),pe=re+(Q^(fe|~te))+oe[6]+2734768916&4294967295,re=fe+(pe<<15&4294967295|pe>>>17),pe=te+(fe^(re|~Q))+oe[13]+1309151649&4294967295,te=re+(pe<<21&4294967295|pe>>>11),pe=Q+(re^(te|~fe))+oe[4]+4149444226&4294967295,Q=te+(pe<<6&4294967295|pe>>>26),pe=fe+(te^(Q|~re))+oe[11]+3174756917&4294967295,fe=Q+(pe<<10&4294967295|pe>>>22),pe=re+(Q^(fe|~te))+oe[2]+718787259&4294967295,re=fe+(pe<<15&4294967295|pe>>>17),pe=te+(fe^(re|~Q))+oe[9]+3951481745&4294967295,$.g[0]=$.g[0]+Q&4294967295,$.g[1]=$.g[1]+(re+(pe<<21&4294967295|pe>>>11))&4294967295,$.g[2]=$.g[2]+re&4294967295,$.g[3]=$.g[3]+fe&4294967295}s.prototype.u=function($,Q){Q===void 0&&(Q=$.length);for(var te=Q-this.blockSize,oe=this.B,re=this.h,fe=0;fe<Q;){if(re==0)for(;fe<=te;)l(this,$,fe),fe+=this.blockSize;if(typeof $=="string"){for(;fe<Q;)if(oe[re++]=$.charCodeAt(fe++),re==this.blockSize){l(this,oe),re=0;break}}else for(;fe<Q;)if(oe[re++]=$[fe++],re==this.blockSize){l(this,oe),re=0;break}}this.h=re,this.o+=Q},s.prototype.v=function(){var $=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);$[0]=128;for(var Q=1;Q<$.length-8;++Q)$[Q]=0;var te=8*this.o;for(Q=$.length-8;Q<$.length;++Q)$[Q]=te&255,te/=256;for(this.u($),$=Array(16),Q=te=0;4>Q;++Q)for(var oe=0;32>oe;oe+=8)$[te++]=this.g[Q]>>>oe&255;return $};function p($,Q){var te=T;return Object.prototype.hasOwnProperty.call(te,$)?te[$]:te[$]=Q($)}function _($,Q){this.h=Q;for(var te=[],oe=!0,re=$.length-1;0<=re;re--){var fe=$[re]|0;oe&&fe==Q||(te[re]=fe,oe=!1)}this.g=te}var T={};function w($){return-128<=$&&128>$?p($,function(Q){return new _([Q|0],0>Q?-1:0)}):new _([$|0],0>$?-1:0)}function C($){if(isNaN($)||!isFinite($))return k;if(0>$)return K(C(-$));for(var Q=[],te=1,oe=0;$>=te;oe++)Q[oe]=$/te|0,te*=4294967296;return new _(Q,0)}function O($,Q){if($.length==0)throw Error("number format error: empty string");if(Q=Q||10,2>Q||36<Q)throw Error("radix out of range: "+Q);if($.charAt(0)=="-")return K(O($.substring(1),Q));if(0<=$.indexOf("-"))throw Error('number format error: interior "-" character');for(var te=C(Math.pow(Q,8)),oe=k,re=0;re<$.length;re+=8){var fe=Math.min(8,$.length-re),pe=parseInt($.substring(re,re+fe),Q);8>fe?(fe=C(Math.pow(Q,fe)),oe=oe.j(fe).add(C(pe))):(oe=oe.j(te),oe=oe.add(C(pe)))}return oe}var k=w(0),U=w(1),Y=w(16777216);a=_.prototype,a.m=function(){if(ee(this))return-K(this).m();for(var $=0,Q=1,te=0;te<this.g.length;te++){var oe=this.i(te);$+=(0<=oe?oe:4294967296+oe)*Q,Q*=4294967296}return $},a.toString=function($){if($=$||10,2>$||36<$)throw Error("radix out of range: "+$);if(W(this))return"0";if(ee(this))return"-"+K(this).toString($);for(var Q=C(Math.pow($,6)),te=this,oe="";;){var re=ye(te,Q).g;te=ie(te,re.j(Q));var fe=((0<te.g.length?te.g[0]:te.h)>>>0).toString($);if(te=re,W(te))return fe+oe;for(;6>fe.length;)fe="0"+fe;oe=fe+oe}},a.i=function($){return 0>$?0:$<this.g.length?this.g[$]:this.h};function W($){if($.h!=0)return!1;for(var Q=0;Q<$.g.length;Q++)if($.g[Q]!=0)return!1;return!0}function ee($){return $.h==-1}a.l=function($){return $=ie(this,$),ee($)?-1:W($)?0:1};function K($){for(var Q=$.g.length,te=[],oe=0;oe<Q;oe++)te[oe]=~$.g[oe];return new _(te,~$.h).add(U)}a.abs=function(){return ee(this)?K(this):this},a.add=function($){for(var Q=Math.max(this.g.length,$.g.length),te=[],oe=0,re=0;re<=Q;re++){var fe=oe+(this.i(re)&65535)+($.i(re)&65535),pe=(fe>>>16)+(this.i(re)>>>16)+($.i(re)>>>16);oe=pe>>>16,fe&=65535,pe&=65535,te[re]=pe<<16|fe}return new _(te,te[te.length-1]&-2147483648?-1:0)};function ie($,Q){return $.add(K(Q))}a.j=function($){if(W(this)||W($))return k;if(ee(this))return ee($)?K(this).j(K($)):K(K(this).j($));if(ee($))return K(this.j(K($)));if(0>this.l(Y)&&0>$.l(Y))return C(this.m()*$.m());for(var Q=this.g.length+$.g.length,te=[],oe=0;oe<2*Q;oe++)te[oe]=0;for(oe=0;oe<this.g.length;oe++)for(var re=0;re<$.g.length;re++){var fe=this.i(oe)>>>16,pe=this.i(oe)&65535,Ne=$.i(re)>>>16,Je=$.i(re)&65535;te[2*oe+2*re]+=pe*Je,se(te,2*oe+2*re),te[2*oe+2*re+1]+=fe*Je,se(te,2*oe+2*re+1),te[2*oe+2*re+1]+=pe*Ne,se(te,2*oe+2*re+1),te[2*oe+2*re+2]+=fe*Ne,se(te,2*oe+2*re+2)}for(oe=0;oe<Q;oe++)te[oe]=te[2*oe+1]<<16|te[2*oe];for(oe=Q;oe<2*Q;oe++)te[oe]=0;return new _(te,0)};function se($,Q){for(;($[Q]&65535)!=$[Q];)$[Q+1]+=$[Q]>>>16,$[Q]&=65535,Q++}function ue($,Q){this.g=$,this.h=Q}function ye($,Q){if(W(Q))throw Error("division by zero");if(W($))return new ue(k,k);if(ee($))return Q=ye(K($),Q),new ue(K(Q.g),K(Q.h));if(ee(Q))return Q=ye($,K(Q)),new ue(K(Q.g),Q.h);if(30<$.g.length){if(ee($)||ee(Q))throw Error("slowDivide_ only works with positive integers.");for(var te=U,oe=Q;0>=oe.l($);)te=ae(te),oe=ae(oe);var re=ve(te,1),fe=ve(oe,1);for(oe=ve(oe,2),te=ve(te,2);!W(oe);){var pe=fe.add(oe);0>=pe.l($)&&(re=re.add(te),fe=pe),oe=ve(oe,1),te=ve(te,1)}return Q=ie($,re.j(Q)),new ue(re,Q)}for(re=k;0<=$.l(Q);){for(te=Math.max(1,Math.floor($.m()/Q.m())),oe=Math.ceil(Math.log(te)/Math.LN2),oe=48>=oe?1:Math.pow(2,oe-48),fe=C(te),pe=fe.j(Q);ee(pe)||0<pe.l($);)te-=oe,fe=C(te),pe=fe.j(Q);W(fe)&&(fe=U),re=re.add(fe),$=ie($,pe)}return new ue(re,$)}a.A=function($){return ye(this,$).h},a.and=function($){for(var Q=Math.max(this.g.length,$.g.length),te=[],oe=0;oe<Q;oe++)te[oe]=this.i(oe)&$.i(oe);return new _(te,this.h&$.h)},a.or=function($){for(var Q=Math.max(this.g.length,$.g.length),te=[],oe=0;oe<Q;oe++)te[oe]=this.i(oe)|$.i(oe);return new _(te,this.h|$.h)},a.xor=function($){for(var Q=Math.max(this.g.length,$.g.length),te=[],oe=0;oe<Q;oe++)te[oe]=this.i(oe)^$.i(oe);return new _(te,this.h^$.h)};function ae($){for(var Q=$.g.length+1,te=[],oe=0;oe<Q;oe++)te[oe]=$.i(oe)<<1|$.i(oe-1)>>>31;return new _(te,$.h)}function ve($,Q){var te=Q>>5;Q%=32;for(var oe=$.g.length-te,re=[],fe=0;fe<oe;fe++)re[fe]=0<Q?$.i(fe+te)>>>Q|$.i(fe+te+1)<<32-Q:$.i(fe+te);return new _(re,$.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,LK=s,_.prototype.add=_.prototype.add,_.prototype.multiply=_.prototype.j,_.prototype.modulo=_.prototype.A,_.prototype.compare=_.prototype.l,_.prototype.toNumber=_.prototype.m,_.prototype.toString=_.prototype.toString,_.prototype.getBits=_.prototype.i,_.fromNumber=C,_.fromString=O,Yf=_}).apply(typeof M8<"u"?M8:typeof self<"u"?self:typeof window<"u"?window:{});var ZI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var MK,Ow,jK,XN,a2,UK,VK,FK;(function(){var a,n=typeof Object.defineProperties=="function"?Object.defineProperty:function(A,B,X){return A==Array.prototype||A==Object.prototype||(A[B]=X.value),A};function i(A){A=[typeof globalThis=="object"&&globalThis,A,typeof window=="object"&&window,typeof self=="object"&&self,typeof ZI=="object"&&ZI];for(var B=0;B<A.length;++B){var X=A[B];if(X&&X.Math==Math)return X}throw Error("Cannot find global object")}var s=i(this);function l(A,B){if(B)e:{var X=s;A=A.split(".");for(var ge=0;ge<A.length-1;ge++){var Ue=A[ge];if(!(Ue in X))break e;X=X[Ue]}A=A[A.length-1],ge=X[A],B=B(ge),B!=ge&&B!=null&&n(X,A,{configurable:!0,writable:!0,value:B})}}function p(A,B){A instanceof String&&(A+="");var X=0,ge=!1,Ue={next:function(){if(!ge&&X<A.length){var Ze=X++;return{value:B(Ze,A[Ze]),done:!1}}return ge=!0,{done:!0,value:void 0}}};return Ue[Symbol.iterator]=function(){return Ue},Ue}l("Array.prototype.values",function(A){return A||function(){return p(this,function(B,X){return X})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var _=_||{},T=this||self;function w(A){var B=typeof A;return B=B!="object"?B:A?Array.isArray(A)?"array":B:"null",B=="array"||B=="object"&&typeof A.length=="number"}function C(A){var B=typeof A;return B=="object"&&A!=null||B=="function"}function O(A,B,X){return A.call.apply(A.bind,arguments)}function k(A,B,X){if(!A)throw Error();if(2<arguments.length){var ge=Array.prototype.slice.call(arguments,2);return function(){var Ue=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ue,ge),A.apply(B,Ue)}}return function(){return A.apply(B,arguments)}}function U(A,B,X){return U=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?O:k,U.apply(null,arguments)}function Y(A,B){var X=Array.prototype.slice.call(arguments,1);return function(){var ge=X.slice();return ge.push.apply(ge,arguments),A.apply(this,ge)}}function W(A,B){function X(){}X.prototype=B.prototype,A.aa=B.prototype,A.prototype=new X,A.prototype.constructor=A,A.Qb=function(ge,Ue,Ze){for(var It=Array(arguments.length-2),vr=2;vr<arguments.length;vr++)It[vr-2]=arguments[vr];return B.prototype[Ue].apply(ge,It)}}function ee(A){const B=A.length;if(0<B){const X=Array(B);for(let ge=0;ge<B;ge++)X[ge]=A[ge];return X}return[]}function K(A,B){for(let X=1;X<arguments.length;X++){const ge=arguments[X];if(w(ge)){const Ue=A.length||0,Ze=ge.length||0;A.length=Ue+Ze;for(let It=0;It<Ze;It++)A[Ue+It]=ge[It]}else A.push(ge)}}class ie{constructor(B,X){this.i=B,this.j=X,this.h=0,this.g=null}get(){let B;return 0<this.h?(this.h--,B=this.g,this.g=B.next,B.next=null):B=this.i(),B}}function se(A){return/^[\s\xa0]*$/.test(A)}function ue(){var A=T.navigator;return A&&(A=A.userAgent)?A:""}function ye(A){return ye[" "](A),A}ye[" "]=function(){};var ae=ue().indexOf("Gecko")!=-1&&!(ue().toLowerCase().indexOf("webkit")!=-1&&ue().indexOf("Edge")==-1)&&!(ue().indexOf("Trident")!=-1||ue().indexOf("MSIE")!=-1)&&ue().indexOf("Edge")==-1;function ve(A,B,X){for(const ge in A)B.call(X,A[ge],ge,A)}function $(A,B){for(const X in A)B.call(void 0,A[X],X,A)}function Q(A){const B={};for(const X in A)B[X]=A[X];return B}const te="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function oe(A,B){let X,ge;for(let Ue=1;Ue<arguments.length;Ue++){ge=arguments[Ue];for(X in ge)A[X]=ge[X];for(let Ze=0;Ze<te.length;Ze++)X=te[Ze],Object.prototype.hasOwnProperty.call(ge,X)&&(A[X]=ge[X])}}function re(A){var B=1;A=A.split(":");const X=[];for(;0<B&&A.length;)X.push(A.shift()),B--;return A.length&&X.push(A.join(":")),X}function fe(A){T.setTimeout(()=>{throw A},0)}function pe(){var A=Me;let B=null;return A.g&&(B=A.g,A.g=A.g.next,A.g||(A.h=null),B.next=null),B}class Ne{constructor(){this.h=this.g=null}add(B,X){const ge=Je.get();ge.set(B,X),this.h?this.h.next=ge:this.g=ge,this.h=ge}}var Je=new ie(()=>new be,A=>A.reset());class be{constructor(){this.next=this.g=this.h=null}set(B,X){this.h=B,this.g=X,this.next=null}reset(){this.next=this.g=this.h=null}}let Ie,Re=!1,Me=new Ne,he=()=>{const A=T.Promise.resolve(void 0);Ie=()=>{A.then(De)}};var De=()=>{for(var A;A=pe();){try{A.h.call(A.g)}catch(X){fe(X)}var B=Je;B.j(A),100>B.h&&(B.h++,A.next=B.g,B.g=A)}Re=!1};function qe(){this.s=this.s,this.C=this.C}qe.prototype.s=!1,qe.prototype.ma=function(){this.s||(this.s=!0,this.N())},qe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function We(A,B){this.type=A,this.g=this.target=B,this.defaultPrevented=!1}We.prototype.h=function(){this.defaultPrevented=!0};var Be=function(){if(!T.addEventListener||!Object.defineProperty)return!1;var A=!1,B=Object.defineProperty({},"passive",{get:function(){A=!0}});try{const X=()=>{};T.addEventListener("test",X,B),T.removeEventListener("test",X,B)}catch{}return A}();function bt(A,B){if(We.call(this,A?A.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,A){var X=this.type=A.type,ge=A.changedTouches&&A.changedTouches.length?A.changedTouches[0]:null;if(this.target=A.target||A.srcElement,this.g=B,B=A.relatedTarget){if(ae){e:{try{ye(B.nodeName);var Ue=!0;break e}catch{}Ue=!1}Ue||(B=null)}}else X=="mouseover"?B=A.fromElement:X=="mouseout"&&(B=A.toElement);this.relatedTarget=B,ge?(this.clientX=ge.clientX!==void 0?ge.clientX:ge.pageX,this.clientY=ge.clientY!==void 0?ge.clientY:ge.pageY,this.screenX=ge.screenX||0,this.screenY=ge.screenY||0):(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0),this.button=A.button,this.key=A.key||"",this.ctrlKey=A.ctrlKey,this.altKey=A.altKey,this.shiftKey=A.shiftKey,this.metaKey=A.metaKey,this.pointerId=A.pointerId||0,this.pointerType=typeof A.pointerType=="string"?A.pointerType:St[A.pointerType]||"",this.state=A.state,this.i=A,A.defaultPrevented&&bt.aa.h.call(this)}}W(bt,We);var St={2:"touch",3:"pen",4:"mouse"};bt.prototype.h=function(){bt.aa.h.call(this);var A=this.i;A.preventDefault?A.preventDefault():A.returnValue=!1};var Tt="closure_listenable_"+(1e6*Math.random()|0),ut=0;function tn(A,B,X,ge,Ue){this.listener=A,this.proxy=null,this.src=B,this.type=X,this.capture=!!ge,this.ha=Ue,this.key=++ut,this.da=this.fa=!1}function Mt(A){A.da=!0,A.listener=null,A.proxy=null,A.src=null,A.ha=null}function wn(A){this.src=A,this.g={},this.h=0}wn.prototype.add=function(A,B,X,ge,Ue){var Ze=A.toString();A=this.g[Ze],A||(A=this.g[Ze]=[],this.h++);var It=Xn(A,B,ge,Ue);return-1<It?(B=A[It],X||(B.fa=!1)):(B=new tn(B,this.src,Ze,!!ge,Ue),B.fa=X,A.push(B)),B};function Yt(A,B){var X=B.type;if(X in A.g){var ge=A.g[X],Ue=Array.prototype.indexOf.call(ge,B,void 0),Ze;(Ze=0<=Ue)&&Array.prototype.splice.call(ge,Ue,1),Ze&&(Mt(B),A.g[X].length==0&&(delete A.g[X],A.h--))}}function Xn(A,B,X,ge){for(var Ue=0;Ue<A.length;++Ue){var Ze=A[Ue];if(!Ze.da&&Ze.listener==B&&Ze.capture==!!X&&Ze.ha==ge)return Ue}return-1}var Ot="closure_lm_"+(1e6*Math.random()|0),en={};function Dt(A,B,X,ge,Ue){if(Array.isArray(B)){for(var Ze=0;Ze<B.length;Ze++)Dt(A,B[Ze],X,ge,Ue);return null}return X=Mi(X),A&&A[Tt]?A.K(B,X,C(ge)?!!ge.capture:!1,Ue):mt(A,B,X,!1,ge,Ue)}function mt(A,B,X,ge,Ue,Ze){if(!B)throw Error("Invalid event type");var It=C(Ue)?!!Ue.capture:!!Ue,vr=Rr(A);if(vr||(A[Ot]=vr=new wn(A)),X=vr.add(B,X,ge,It,Ze),X.proxy)return X;if(ge=kt(),X.proxy=ge,ge.src=A,ge.listener=X,A.addEventListener)Be||(Ue=It),Ue===void 0&&(Ue=!1),A.addEventListener(B.toString(),ge,Ue);else if(A.attachEvent)A.attachEvent(Ci(B.toString()),ge);else if(A.addListener&&A.removeListener)A.addListener(ge);else throw Error("addEventListener and attachEvent are unavailable.");return X}function kt(){function A(X){return B.call(A.src,A.listener,X)}const B=bs;return A}function Gt(A,B,X,ge,Ue){if(Array.isArray(B))for(var Ze=0;Ze<B.length;Ze++)Gt(A,B[Ze],X,ge,Ue);else ge=C(ge)?!!ge.capture:!!ge,X=Mi(X),A&&A[Tt]?(A=A.i,B=String(B).toString(),B in A.g&&(Ze=A.g[B],X=Xn(Ze,X,ge,Ue),-1<X&&(Mt(Ze[X]),Array.prototype.splice.call(Ze,X,1),Ze.length==0&&(delete A.g[B],A.h--)))):A&&(A=Rr(A))&&(B=A.g[B.toString()],A=-1,B&&(A=Xn(B,X,ge,Ue)),(X=-1<A?B[A]:null)&&Mn(X))}function Mn(A){if(typeof A!="number"&&A&&!A.da){var B=A.src;if(B&&B[Tt])Yt(B.i,A);else{var X=A.type,ge=A.proxy;B.removeEventListener?B.removeEventListener(X,ge,A.capture):B.detachEvent?B.detachEvent(Ci(X),ge):B.addListener&&B.removeListener&&B.removeListener(ge),(X=Rr(B))?(Yt(X,A),X.h==0&&(X.src=null,B[Ot]=null)):Mt(A)}}}function Ci(A){return A in en?en[A]:en[A]="on"+A}function bs(A,B){if(A.da)A=!0;else{B=new bt(B,this);var X=A.listener,ge=A.ha||A.src;A.fa&&Mn(A),A=X.call(ge,B)}return A}function Rr(A){return A=A[Ot],A instanceof wn?A:null}var kn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Mi(A){return typeof A=="function"?A:(A[kn]||(A[kn]=function(B){return A.handleEvent(B)}),A[kn])}function Ht(){qe.call(this),this.i=new wn(this),this.M=this,this.F=null}W(Ht,qe),Ht.prototype[Tt]=!0,Ht.prototype.removeEventListener=function(A,B,X,ge){Gt(this,A,B,X,ge)};function sn(A,B){var X,ge=A.F;if(ge)for(X=[];ge;ge=ge.F)X.push(ge);if(A=A.M,ge=B.type||B,typeof B=="string")B=new We(B,A);else if(B instanceof We)B.target=B.target||A;else{var Ue=B;B=new We(ge,A),oe(B,Ue)}if(Ue=!0,X)for(var Ze=X.length-1;0<=Ze;Ze--){var It=B.g=X[Ze];Ue=wt(It,ge,!0,B)&&Ue}if(It=B.g=A,Ue=wt(It,ge,!0,B)&&Ue,Ue=wt(It,ge,!1,B)&&Ue,X)for(Ze=0;Ze<X.length;Ze++)It=B.g=X[Ze],Ue=wt(It,ge,!1,B)&&Ue}Ht.prototype.N=function(){if(Ht.aa.N.call(this),this.i){var A=this.i,B;for(B in A.g){for(var X=A.g[B],ge=0;ge<X.length;ge++)Mt(X[ge]);delete A.g[B],A.h--}}this.F=null},Ht.prototype.K=function(A,B,X,ge){return this.i.add(String(A),B,!1,X,ge)},Ht.prototype.L=function(A,B,X,ge){return this.i.add(String(A),B,!0,X,ge)};function wt(A,B,X,ge){if(B=A.i.g[String(B)],!B)return!0;B=B.concat();for(var Ue=!0,Ze=0;Ze<B.length;++Ze){var It=B[Ze];if(It&&!It.da&&It.capture==X){var vr=It.listener,Cs=It.ha||It.src;It.fa&&Yt(A.i,It),Ue=vr.call(Cs,ge)!==!1&&Ue}}return Ue&&!ge.defaultPrevented}function mn(A,B,X){if(typeof A=="function")X&&(A=U(A,X));else if(A&&typeof A.handleEvent=="function")A=U(A.handleEvent,A);else throw Error("Invalid listener argument");return 2147483647<Number(B)?-1:T.setTimeout(A,B||0)}function jn(A){A.g=mn(()=>{A.g=null,A.i&&(A.i=!1,jn(A))},A.l);const B=A.h;A.h=null,A.m.apply(null,B)}class Ei extends qe{constructor(B,X){super(),this.m=B,this.l=X,this.h=null,this.i=!1,this.g=null}j(B){this.h=arguments,this.g?this.i=!0:jn(this)}N(){super.N(),this.g&&(T.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ai(A){qe.call(this),this.h=A,this.g={}}W(ai,qe);var Cr=[];function ji(A){ve(A.g,function(B,X){this.g.hasOwnProperty(X)&&Mn(B)},A),A.g={}}ai.prototype.N=function(){ai.aa.N.call(this),ji(this)},ai.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var zi=T.JSON.stringify,ws=T.JSON.parse,ua=class{stringify(A){return T.JSON.stringify(A,void 0)}parse(A){return T.JSON.parse(A,void 0)}};function Fs(){}Fs.prototype.h=null;function Wa(A){return A.h||(A.h=A.i())}function je(){}var nn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function yn(){We.call(this,"d")}W(yn,We);function nr(){We.call(this,"c")}W(nr,We);var Qe={},Kt=null;function un(){return Kt=Kt||new Ht}Qe.La="serverreachability";function rn(A){We.call(this,Qe.La,A)}W(rn,We);function Dn(A){const B=un();sn(B,new rn(B))}Qe.STAT_EVENT="statevent";function Ai(A,B){We.call(this,Qe.STAT_EVENT,A),this.stat=B}W(Ai,We);function ln(A){const B=un();sn(B,new Ai(B,A))}Qe.Ma="timingevent";function mr(A,B){We.call(this,Qe.Ma,A),this.size=B}W(mr,We);function yr(A,B){if(typeof A!="function")throw Error("Fn must not be null and must be a function");return T.setTimeout(function(){A()},B)}function oi(){this.g=!0}oi.prototype.xa=function(){this.g=!1};function Bs(A,B,X,ge,Ue,Ze){A.info(function(){if(A.g)if(Ze)for(var It="",vr=Ze.split("&"),Cs=0;Cs<vr.length;Cs++){var Yn=vr[Cs].split("=");if(1<Yn.length){var zs=Yn[0];Yn=Yn[1];var As=zs.split("_");It=2<=As.length&&As[1]=="type"?It+(zs+"="+Yn+"&"):It+(zs+"=redacted&")}}else It=null;else It=Ze;return"XMLHTTP REQ ("+ge+") [attempt "+Ue+"]: "+B+`
`+X+`
`+It})}function fo(A,B,X,ge,Ue,Ze,It){A.info(function(){return"XMLHTTP RESP ("+ge+") [ attempt "+Ue+"]: "+B+`
`+X+`
`+Ze+" "+It})}function Hs(A,B,X,ge){A.info(function(){return"XMLHTTP TEXT ("+B+"): "+za(A,X)+(ge?" "+ge:"")})}function Gc(A,B){A.info(function(){return"TIMEOUT: "+B})}oi.prototype.info=function(){};function za(A,B){if(!A.g)return B;if(!B)return null;try{var X=JSON.parse(B);if(X){for(A=0;A<X.length;A++)if(Array.isArray(X[A])){var ge=X[A];if(!(2>ge.length)){var Ue=ge[1];if(Array.isArray(Ue)&&!(1>Ue.length)){var Ze=Ue[0];if(Ze!="noop"&&Ze!="stop"&&Ze!="close")for(var It=1;It<Ue.length;It++)Ue[It]=""}}}}return zi(X)}catch{return B}}var Ra={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Uo={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},mo;function go(){}W(go,Fs),go.prototype.g=function(){return new XMLHttpRequest},go.prototype.i=function(){return{}},mo=new go;function Rs(A,B,X,ge){this.j=A,this.i=B,this.l=X,this.R=ge||1,this.U=new ai(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ui}function Ui(){this.i=null,this.g="",this.h=!1}var Wu={},zu={};function ha(A,B,X){A.L=1,A.v=$u(Eo(B)),A.m=X,A.P=!0,Ll(A,null)}function Ll(A,B){A.F=Date.now(),Yu(A),A.A=Eo(A.v);var X=A.A,ge=A.R;Array.isArray(ge)||(ge=[String(ge)]),um(X.i,"t",ge),A.C=0,X=A.j.J,A.h=new Ui,A.g=Em(A.j,X?B:null,!A.m),0<A.O&&(A.M=new Ei(U(A.Y,A,A.g),A.O)),B=A.U,X=A.g,ge=A.ca;var Ue="readystatechange";Array.isArray(Ue)||(Ue&&(Cr[0]=Ue.toString()),Ue=Cr);for(var Ze=0;Ze<Ue.length;Ze++){var It=Dt(X,Ue[Ze],ge||B.handleEvent,!1,B.h||B);if(!It)break;B.g[It.key]=It}B=A.H?Q(A.H):{},A.m?(A.u||(A.u="POST"),B["Content-Type"]="application/x-www-form-urlencoded",A.g.ea(A.A,A.u,A.m,B)):(A.u="GET",A.g.ea(A.A,A.u,null,B)),Dn(),Bs(A.i,A.u,A.A,A.l,A.R,A.m)}Rs.prototype.ca=function(A){A=A.target;const B=this.M;B&&Bo(A)==3?B.j():this.Y(A)},Rs.prototype.Y=function(A){try{if(A==this.g)e:{const As=Bo(this.g);var B=this.g.Ba();const Gl=this.g.Z();if(!(3>As)&&(As!=3||this.g&&(this.h.h||this.g.oa()||q_(this.g)))){this.J||As!=4||B==7||(B==8||0>=Gl?Dn(3):Dn(2)),ci(this);var X=this.g.Z();this.X=X;t:if(B_(this)){var ge=q_(this.g);A="";var Ue=ge.length,Ze=Bo(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ta(this),Wc(this);var It="";break t}this.h.i=new T.TextDecoder}for(B=0;B<Ue;B++)this.h.h=!0,A+=this.h.i.decode(ge[B],{stream:!(Ze&&B==Ue-1)});ge.length=0,this.h.g+=A,this.C=0,It=this.h.g}else It=this.g.oa();if(this.o=X==200,fo(this.i,this.u,this.A,this.l,this.R,As,X),this.o){if(this.T&&!this.K){t:{if(this.g){var vr,Cs=this.g;if((vr=Cs.g?Cs.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!se(vr)){var Yn=vr;break t}}Yn=null}if(X=Yn)Hs(this.i,this.l,X,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,qu(this,X);else{this.o=!1,this.s=3,ln(12),ta(this),Wc(this);break e}}if(this.P){X=!0;let Ys;for(;!this.J&&this.C<It.length;)if(Ys=_o(this,It),Ys==zu){As==4&&(this.s=4,ln(14),X=!1),Hs(this.i,this.l,null,"[Incomplete Response]");break}else if(Ys==Wu){this.s=4,ln(15),Hs(this.i,this.l,It,"[Invalid Chunk]"),X=!1;break}else Hs(this.i,this.l,Ys,null),qu(this,Ys);if(B_(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),As!=4||It.length!=0||this.h.h||(this.s=1,ln(16),X=!1),this.o=this.o&&X,!X)Hs(this.i,this.l,It,"[Invalid Chunked Response]"),ta(this),Wc(this);else if(0<It.length&&!this.W){this.W=!0;var zs=this.j;zs.g==this&&zs.ba&&!zs.M&&(zs.j.info("Great, no buffering proxy detected. Bytes received: "+It.length),rh(zs),zs.M=!0,ln(11))}}else Hs(this.i,this.l,It,null),qu(this,It);As==4&&ta(this),this.o&&!this.J&&(As==4?$_(this.j,this):(this.o=!1,Yu(this)))}else uS(this.g),X==400&&0<It.indexOf("Unknown SID")?(this.s=3,ln(12)):(this.s=0,ln(13)),ta(this),Wc(this)}}}catch{}finally{}};function B_(A){return A.g?A.u=="GET"&&A.L!=2&&A.j.Ca:!1}function _o(A,B){var X=A.C,ge=B.indexOf(`
`,X);return ge==-1?zu:(X=Number(B.substring(X,ge)),isNaN(X)?Wu:(ge+=1,ge+X>B.length?zu:(B=B.slice(ge,ge+X),A.C=ge+X,B)))}Rs.prototype.cancel=function(){this.J=!0,ta(this)};function Yu(A){A.S=Date.now()+A.I,H_(A,A.I)}function H_(A,B){if(A.B!=null)throw Error("WatchDog timer not null");A.B=yr(U(A.ba,A),B)}function ci(A){A.B&&(T.clearTimeout(A.B),A.B=null)}Rs.prototype.ba=function(){this.B=null;const A=Date.now();0<=A-this.S?(Gc(this.i,this.A),this.L!=2&&(Dn(),ln(17)),ta(this),this.s=2,Wc(this)):H_(this,this.S-A)};function Wc(A){A.j.G==0||A.J||$_(A.j,A)}function ta(A){ci(A);var B=A.M;B&&typeof B.ma=="function"&&B.ma(),A.M=null,ji(A.U),A.g&&(B=A.g,A.g=null,B.abort(),B.ma())}function qu(A,B){try{var X=A.j;if(X.G!=0&&(X.g==A||cm(X.h,A))){if(!A.K&&cm(X.h,A)&&X.G==3){try{var ge=X.Da.g.parse(B)}catch{ge=null}if(Array.isArray(ge)&&ge.length==3){var Ue=ge;if(Ue[0]==0){e:if(!X.u){if(X.g)if(X.g.F+3e3<A.F)wp(X),Dd(X);else break e;Bl(X),ln(18)}}else X.za=Ue[1],0<X.za-X.T&&37500>Ue[2]&&X.F&&X.v==0&&!X.C&&(X.C=yr(U(X.Za,X),6e3));if(1>=Ku(X.h)&&X.ca){try{X.ca()}catch{}X.ca=void 0}}else Ka(X,11)}else if((A.K||X.g==A)&&wp(X),!se(B))for(Ue=X.Da.g.parse(B),B=0;B<Ue.length;B++){let Yn=Ue[B];if(X.T=Yn[0],Yn=Yn[1],X.G==2)if(Yn[0]=="c"){X.K=Yn[1],X.ia=Yn[2];const zs=Yn[3];zs!=null&&(X.la=zs,X.j.info("VER="+X.la));const As=Yn[4];As!=null&&(X.Aa=As,X.j.info("SVER="+X.Aa));const Gl=Yn[5];Gl!=null&&typeof Gl=="number"&&0<Gl&&(ge=1.5*Gl,X.L=ge,X.j.info("backChannelRequestTimeoutMs_="+ge)),ge=X;const Ys=A.g;if(Ys){const Ho=Ys.g?Ys.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ho){var Ze=ge.h;Ze.g||Ho.indexOf("spdy")==-1&&Ho.indexOf("quic")==-1&&Ho.indexOf("h2")==-1||(Ze.j=Ze.l,Ze.g=new Set,Ze.h&&(Ep(Ze,Ze.h),Ze.h=null))}if(ge.D){const ym=Ys.g?Ys.g.getResponseHeader("X-HTTP-Session-Id"):null;ym&&(ge.ya=ym,Zr(ge.I,ge.D,ym))}}X.G=3,X.l&&X.l.ua(),X.ba&&(X.R=Date.now()-A.F,X.j.info("Handshake RTT: "+X.R+"ms")),ge=X;var It=A;if(ge.qa=Hl(ge,ge.J?ge.ia:null,ge.W),It.K){Ca(ge.h,It);var vr=It,Cs=ge.L;Cs&&(vr.I=Cs),vr.B&&(ci(vr),Yu(vr)),ge.g=It}else Qc(ge);0<X.i.length&&xd(X)}else Yn[0]!="stop"&&Yn[0]!="close"||Ka(X,7);else X.G==3&&(Yn[0]=="stop"||Yn[0]=="close"?Yn[0]=="stop"?Ka(X,7):mm(X):Yn[0]!="noop"&&X.l&&X.l.ta(Yn),X.v=0)}}Dn(4)}catch{}}var G_=class{constructor(A,B){this.g=A,this.map=B}};function hc(A){this.l=A||10,T.PerformanceNavigationTiming?(A=T.performance.getEntriesByType("navigation"),A=0<A.length&&(A[0].nextHopProtocol=="hq"||A[0].nextHopProtocol=="h2")):A=!!(T.chrome&&T.chrome.loadTimes&&T.chrome.loadTimes()&&T.chrome.loadTimes().wasFetchedViaSpdy),this.j=A?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function _p(A){return A.h?!0:A.g?A.g.size>=A.j:!1}function Ku(A){return A.h?1:A.g?A.g.size:0}function cm(A,B){return A.h?A.h==B:A.g?A.g.has(B):!1}function Ep(A,B){A.g?A.g.add(B):A.h=B}function Ca(A,B){A.h&&A.h==B?A.h=null:A.g&&A.g.has(B)&&A.g.delete(B)}hc.prototype.cancel=function(){if(this.i=zc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const A of this.g.values())A.cancel();this.g.clear()}};function zc(A){if(A.h!=null)return A.i.concat(A.h.D);if(A.g!=null&&A.g.size!==0){let B=A.i;for(const X of A.g.values())B=B.concat(X.D);return B}return ee(A.i)}function lm(A){if(A.V&&typeof A.V=="function")return A.V();if(typeof Map<"u"&&A instanceof Map||typeof Set<"u"&&A instanceof Set)return Array.from(A.values());if(typeof A=="string")return A.split("");if(w(A)){for(var B=[],X=A.length,ge=0;ge<X;ge++)B.push(A[ge]);return B}B=[],X=0;for(ge in A)B[X++]=A[ge];return B}function yp(A){if(A.na&&typeof A.na=="function")return A.na();if(!A.V||typeof A.V!="function"){if(typeof Map<"u"&&A instanceof Map)return Array.from(A.keys());if(!(typeof Set<"u"&&A instanceof Set)){if(w(A)||typeof A=="string"){var B=[];A=A.length;for(var X=0;X<A;X++)B.push(X);return B}B=[],X=0;for(const ge in A)B[X++]=ge;return B}}}function Mr(A,B){if(A.forEach&&typeof A.forEach=="function")A.forEach(B,void 0);else if(w(A)||typeof A=="string")Array.prototype.forEach.call(A,B,void 0);else for(var X=yp(A),ge=lm(A),Ue=ge.length,Ze=0;Ze<Ue;Ze++)B.call(void 0,ge[Ze],X&&X[Ze],A)}var Xu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function W_(A,B){if(A){A=A.split("&");for(var X=0;X<A.length;X++){var ge=A[X].indexOf("="),Ue=null;if(0<=ge){var Ze=A[X].substring(0,ge);Ue=A[X].substring(ge+1)}else Ze=A[X];B(Ze,Ue?decodeURIComponent(Ue.replace(/\+/g," ")):"")}}}function es(A){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,A instanceof es){this.h=A.h,Qu(this,A.j),this.o=A.o,this.g=A.g,Ad(this,A.s),this.l=A.l;var B=A.i,X=new jl;X.i=B.i,B.g&&(X.g=new Map(B.g),X.h=B.h),Ml(this,X),this.m=A.m}else A&&(B=String(A).match(Xu))?(this.h=!1,Qu(this,B[1]||"",!0),this.o=Ya(B[2]||""),this.g=Ya(B[3]||"",!0),Ad(this,B[4]),this.l=Ya(B[5]||"",!0),Ml(this,B[6]||"",!0),this.m=Ya(B[7]||"")):(this.h=!1,this.i=new jl(null,this.h))}es.prototype.toString=function(){var A=[],B=this.j;B&&A.push(Id(B,dm,!0),":");var X=this.g;return(X||B=="file")&&(A.push("//"),(B=this.o)&&A.push(Id(B,dm,!0),"@"),A.push(encodeURIComponent(String(X)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),X=this.s,X!=null&&A.push(":",String(X))),(X=this.l)&&(this.g&&X.charAt(0)!="/"&&A.push("/"),A.push(Id(X,X.charAt(0)=="/"?dS:Ju,!0))),(X=this.i.toString())&&A.push("?",X),(X=this.m)&&A.push("#",Id(X,Sp)),A.join("")};function Eo(A){return new es(A)}function Qu(A,B,X){A.j=X?Ya(B,!0):B,A.j&&(A.j=A.j.replace(/:$/,""))}function Ad(A,B){if(B){if(B=Number(B),isNaN(B)||0>B)throw Error("Bad port number "+B);A.s=B}else A.s=null}function Ml(A,B,X){B instanceof jl?(A.i=B,Y_(A.i,A.h)):(X||(B=Id(B,z_)),A.i=new jl(B,A.h))}function Zr(A,B,X){A.i.set(B,X)}function $u(A){return Zr(A,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),A}function Ya(A,B){return A?B?decodeURI(A.replace(/%25/g,"%2525")):decodeURIComponent(A):""}function Id(A,B,X){return typeof A=="string"?(A=encodeURI(A).replace(B,vp),X&&(A=A.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A):null}function vp(A){return A=A.charCodeAt(0),"%"+(A>>4&15).toString(16)+(A&15).toString(16)}var dm=/[#\/\?@]/g,Ju=/[#\?:]/g,dS=/[#\?]/g,z_=/[#\?@]/g,Sp=/#/g;function jl(A,B){this.h=this.g=null,this.i=A||null,this.j=!!B}function Vo(A){A.g||(A.g=new Map,A.h=0,A.i&&W_(A.i,function(B,X){A.add(decodeURIComponent(B.replace(/\+/g," ")),X)}))}a=jl.prototype,a.add=function(A,B){Vo(this),this.i=null,A=Yc(this,A);var X=this.g.get(A);return X||this.g.set(A,X=[]),X.push(B),this.h+=1,this};function Ul(A,B){Vo(A),B=Yc(A,B),A.g.has(B)&&(A.i=null,A.h-=A.g.get(B).length,A.g.delete(B))}function Vl(A,B){return Vo(A),B=Yc(A,B),A.g.has(B)}a.forEach=function(A,B){Vo(this),this.g.forEach(function(X,ge){X.forEach(function(Ue){A.call(B,Ue,ge,this)},this)},this)},a.na=function(){Vo(this);const A=Array.from(this.g.values()),B=Array.from(this.g.keys()),X=[];for(let ge=0;ge<B.length;ge++){const Ue=A[ge];for(let Ze=0;Ze<Ue.length;Ze++)X.push(B[ge])}return X},a.V=function(A){Vo(this);let B=[];if(typeof A=="string")Vl(this,A)&&(B=B.concat(this.g.get(Yc(this,A))));else{A=Array.from(this.g.values());for(let X=0;X<A.length;X++)B=B.concat(A[X])}return B},a.set=function(A,B){return Vo(this),this.i=null,A=Yc(this,A),Vl(this,A)&&(this.h-=this.g.get(A).length),this.g.set(A,[B]),this.h+=1,this},a.get=function(A,B){return A?(A=this.V(A),0<A.length?String(A[0]):B):B};function um(A,B,X){Ul(A,B),0<X.length&&(A.i=null,A.g.set(Yc(A,B),ee(X)),A.h+=X.length)}a.toString=function(){if(this.i)return this.i;if(!this.g)return"";const A=[],B=Array.from(this.g.keys());for(var X=0;X<B.length;X++){var ge=B[X];const Ze=encodeURIComponent(String(ge)),It=this.V(ge);for(ge=0;ge<It.length;ge++){var Ue=Ze;It[ge]!==""&&(Ue+="="+encodeURIComponent(String(It[ge]))),A.push(Ue)}}return this.i=A.join("&")};function Yc(A,B){return B=String(B),A.j&&(B=B.toLowerCase()),B}function Y_(A,B){B&&!A.j&&(Vo(A),A.i=null,A.g.forEach(function(X,ge){var Ue=ge.toLowerCase();ge!=Ue&&(Ul(this,ge),um(this,Ue,X))},A)),A.j=B}function Nd(A,B){const X=new oi;if(T.Image){const ge=new Image;ge.onload=Y(Fo,X,"TestLoadImage: loaded",!0,B,ge),ge.onerror=Y(Fo,X,"TestLoadImage: error",!1,B,ge),ge.onabort=Y(Fo,X,"TestLoadImage: abort",!1,B,ge),ge.ontimeout=Y(Fo,X,"TestLoadImage: timeout",!1,B,ge),T.setTimeout(function(){ge.ontimeout&&ge.ontimeout()},1e4),ge.src=A}else B(!1)}function pc(A,B){const X=new oi,ge=new AbortController,Ue=setTimeout(()=>{ge.abort(),Fo(X,"TestPingServer: timeout",!1,B)},1e4);fetch(A,{signal:ge.signal}).then(Ze=>{clearTimeout(Ue),Ze.ok?Fo(X,"TestPingServer: ok",!0,B):Fo(X,"TestPingServer: server error",!1,B)}).catch(()=>{clearTimeout(Ue),Fo(X,"TestPingServer: error",!1,B)})}function Fo(A,B,X,ge,Ue){try{Ue&&(Ue.onload=null,Ue.onerror=null,Ue.onabort=null,Ue.ontimeout=null),ge(X)}catch{}}function Zu(){this.g=new ua}function qa(A,B,X){const ge=X||"";try{Mr(A,function(Ue,Ze){let It=Ue;C(Ue)&&(It=zi(Ue)),B.push(ge+Ze+"="+encodeURIComponent(It))})}catch(Ue){throw B.push(ge+"type="+encodeURIComponent("_badmap")),Ue}}function Od(A){this.l=A.Ub||null,this.j=A.eb||!1}W(Od,Fs),Od.prototype.g=function(){return new Fl(this.l,this.j)},Od.prototype.i=function(A){return function(){return A}}({});function Fl(A,B){Ht.call(this),this.D=A,this.o=B,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}W(Fl,Ht),a=Fl.prototype,a.open=function(A,B){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=A,this.A=B,this.readyState=1,fc(this)},a.send=function(A){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const B={headers:this.u,method:this.B,credentials:this.m,cache:void 0};A&&(B.body=A),(this.D||T).fetch(new Request(this.A,B)).then(this.Sa.bind(this),this.ga.bind(this))},a.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,qc(this)),this.readyState=0},a.Sa=function(A){if(this.g&&(this.l=A,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=A.headers,this.readyState=2,fc(this)),this.g&&(this.readyState=3,fc(this),this.g)))if(this.responseType==="arraybuffer")A.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof T.ReadableStream<"u"&&"body"in A){if(this.j=A.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;hm(this)}else A.text().then(this.Ra.bind(this),this.ga.bind(this))};function hm(A){A.j.read().then(A.Pa.bind(A)).catch(A.ga.bind(A))}a.Pa=function(A){if(this.g){if(this.o&&A.value)this.response.push(A.value);else if(!this.o){var B=A.value?A.value:new Uint8Array(0);(B=this.v.decode(B,{stream:!A.done}))&&(this.response=this.responseText+=B)}A.done?qc(this):fc(this),this.readyState==3&&hm(this)}},a.Ra=function(A){this.g&&(this.response=this.responseText=A,qc(this))},a.Qa=function(A){this.g&&(this.response=A,qc(this))},a.ga=function(){this.g&&qc(this)};function qc(A){A.readyState=4,A.l=null,A.j=null,A.v=null,fc(A)}a.setRequestHeader=function(A,B){this.u.append(A,B)},a.getResponseHeader=function(A){return this.h&&this.h.get(A.toLowerCase())||""},a.getAllResponseHeaders=function(){if(!this.h)return"";const A=[],B=this.h.entries();for(var X=B.next();!X.done;)X=X.value,A.push(X[0]+": "+X[1]),X=B.next();return A.join(`\r
`)};function fc(A){A.onreadystatechange&&A.onreadystatechange.call(A)}Object.defineProperty(Fl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(A){this.m=A?"include":"same-origin"}});function pm(A){let B="";return ve(A,function(X,ge){B+=ge,B+=":",B+=X,B+=`\r
`}),B}function Gs(A,B,X){e:{for(ge in X){var ge=!1;break e}ge=!0}ge||(X=pm(X),typeof A=="string"?X!=null&&encodeURIComponent(String(X)):Zr(A,B,X))}function Yr(A){Ht.call(this),this.headers=new Map,this.o=A||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}W(Yr,Ht);var yo=/^https?$/i,Ws=["POST","PUT"];a=Yr.prototype,a.Ha=function(A){this.J=A},a.ea=function(A,B,X,ge){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+A);B=B?B.toUpperCase():"GET",this.D=A,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():mo.g(),this.v=this.o?Wa(this.o):Wa(mo),this.g.onreadystatechange=U(this.Ea,this);try{this.B=!0,this.g.open(B,String(A),!0),this.B=!1}catch(Ze){fm(this,Ze);return}if(A=X||"",X=new Map(this.headers),ge)if(Object.getPrototypeOf(ge)===Object.prototype)for(var Ue in ge)X.set(Ue,ge[Ue]);else if(typeof ge.keys=="function"&&typeof ge.get=="function")for(const Ze of ge.keys())X.set(Ze,ge.get(Ze));else throw Error("Unknown input type for opt_headers: "+String(ge));ge=Array.from(X.keys()).find(Ze=>Ze.toLowerCase()=="content-type"),Ue=T.FormData&&A instanceof T.FormData,!(0<=Array.prototype.indexOf.call(Ws,B,void 0))||ge||Ue||X.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Ze,It]of X)this.g.setRequestHeader(Ze,It);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ts(this),this.u=!0,this.g.send(A),this.u=!1}catch(Ze){fm(this,Ze)}};function fm(A,B){A.h=!1,A.g&&(A.j=!0,A.g.abort(),A.j=!1),A.l=B,A.m=5,Tp(A),Kc(A)}function Tp(A){A.A||(A.A=!0,sn(A,"complete"),sn(A,"error"))}a.abort=function(A){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=A||7,sn(this,"complete"),sn(this,"abort"),Kc(this))},a.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Kc(this,!0)),Yr.aa.N.call(this)},a.Ea=function(){this.s||(this.B||this.u||this.j?bp(this):this.bb())},a.bb=function(){bp(this)};function bp(A){if(A.h&&typeof _<"u"&&(!A.v[1]||Bo(A)!=4||A.Z()!=2)){if(A.u&&Bo(A)==4)mn(A.Ea,0,A);else if(sn(A,"readystatechange"),Bo(A)==4){A.h=!1;try{const It=A.Z();e:switch(It){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var B=!0;break e;default:B=!1}var X;if(!(X=B)){var ge;if(ge=It===0){var Ue=String(A.D).match(Xu)[1]||null;!Ue&&T.self&&T.self.location&&(Ue=T.self.location.protocol.slice(0,-1)),ge=!yo.test(Ue?Ue.toLowerCase():"")}X=ge}if(X)sn(A,"complete"),sn(A,"success");else{A.m=6;try{var Ze=2<Bo(A)?A.g.statusText:""}catch{Ze=""}A.l=Ze+" ["+A.Z()+"]",Tp(A)}}finally{Kc(A)}}}}function Kc(A,B){if(A.g){ts(A);const X=A.g,ge=A.v[0]?()=>{}:null;A.g=null,A.v=null,B||sn(A,"ready");try{X.onreadystatechange=ge}catch{}}}function ts(A){A.I&&(T.clearTimeout(A.I),A.I=null)}a.isActive=function(){return!!this.g};function Bo(A){return A.g?A.g.readyState:0}a.Z=function(){try{return 2<Bo(this)?this.g.status:-1}catch{return-1}},a.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},a.Oa=function(A){if(this.g){var B=this.g.responseText;return A&&B.indexOf(A)==0&&(B=B.substring(A.length)),ws(B)}};function q_(A){try{if(!A.g)return null;if("response"in A.g)return A.g.response;switch(A.H){case"":case"text":return A.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in A.g)return A.g.mozResponseArrayBuffer}return null}catch{return null}}function uS(A){const B={};A=(A.g&&2<=Bo(A)&&A.g.getAllResponseHeaders()||"").split(`\r
`);for(let ge=0;ge<A.length;ge++){if(se(A[ge]))continue;var X=re(A[ge]);const Ue=X[0];if(X=X[1],typeof X!="string")continue;X=X.trim();const Ze=B[Ue]||[];B[Ue]=Ze,Ze.push(X)}$(B,function(ge){return ge.join(", ")})}a.Ba=function(){return this.m},a.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Xc(A,B,X){return X&&X.internalChannelParams&&X.internalChannelParams[A]||B}function eh(A){this.Aa=0,this.i=[],this.j=new oi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Xc("failFast",!1,A),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Xc("baseRetryDelayMs",5e3,A),this.cb=Xc("retryDelaySeedMs",1e4,A),this.Wa=Xc("forwardChannelMaxRetries",2,A),this.wa=Xc("forwardChannelRequestTimeoutMs",2e4,A),this.pa=A&&A.xmlHttpFactory||void 0,this.Xa=A&&A.Tb||void 0,this.Ca=A&&A.useFetchStreams||!1,this.L=void 0,this.J=A&&A.supportsCrossDomainXhr||!1,this.K="",this.h=new hc(A&&A.concurrentRequestLimit),this.Da=new Zu,this.P=A&&A.fastHandshake||!1,this.O=A&&A.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=A&&A.Rb||!1,A&&A.xa&&this.j.xa(),A&&A.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&A&&A.detectBufferingProxy||!1,this.ja=void 0,A&&A.longPollingTimeout&&0<A.longPollingTimeout&&(this.ja=A.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}a=eh.prototype,a.la=8,a.G=1,a.connect=function(A,B,X,ge){ln(0),this.W=A,this.H=B||{},X&&ge!==void 0&&(this.H.OSID=X,this.H.OAID=ge),this.F=this.X,this.I=Hl(this,null,this.W),xd(this)};function mm(A){if(K_(A),A.G==3){var B=A.U++,X=Eo(A.I);if(Zr(X,"SID",A.K),Zr(X,"RID",B),Zr(X,"TYPE","terminate"),nh(A,X),B=new Rs(A,A.j,B),B.L=2,B.v=$u(Eo(X)),X=!1,T.navigator&&T.navigator.sendBeacon)try{X=T.navigator.sendBeacon(B.v.toString(),"")}catch{}!X&&T.Image&&(new Image().src=B.v,X=!0),X||(B.g=Em(B.j,null),B.g.ea(B.v)),B.F=Date.now(),Yu(B)}J_(A)}function Dd(A){A.g&&(rh(A),A.g.cancel(),A.g=null)}function K_(A){Dd(A),A.u&&(T.clearTimeout(A.u),A.u=null),wp(A),A.h.cancel(),A.s&&(typeof A.s=="number"&&T.clearTimeout(A.s),A.s=null)}function xd(A){if(!_p(A.h)&&!A.s){A.s=!0;var B=A.Ga;Ie||he(),Re||(Ie(),Re=!0),Me.add(B,A),A.B=0}}function gm(A,B){return Ku(A.h)>=A.h.j-(A.s?1:0)?!1:A.s?(A.i=B.D.concat(A.i),!0):A.G==1||A.G==2||A.B>=(A.Va?0:A.Wa)?!1:(A.s=yr(U(A.Ga,A,B),_m(A,A.B)),A.B++,!0)}a.Ga=function(A){if(this.s)if(this.s=null,this.G==1){if(!A){this.U=Math.floor(1e5*Math.random()),A=this.U++;const Ue=new Rs(this,this.j,A);let Ze=this.o;if(this.S&&(Ze?(Ze=Q(Ze),oe(Ze,this.S)):Ze=this.S),this.m!==null||this.O||(Ue.H=Ze,Ze=null),this.P)e:{for(var B=0,X=0;X<this.i.length;X++){t:{var ge=this.i[X];if("__data__"in ge.map&&(ge=ge.map.__data__,typeof ge=="string")){ge=ge.length;break t}ge=void 0}if(ge===void 0)break;if(B+=ge,4096<B){B=X;break e}if(B===4096||X===this.i.length-1){B=X+1;break e}}B=1e3}else B=1e3;B=X_(this,Ue,B),X=Eo(this.I),Zr(X,"RID",A),Zr(X,"CVER",22),this.D&&Zr(X,"X-HTTP-Session-Id",this.D),nh(this,X),Ze&&(this.O?B="headers="+encodeURIComponent(String(pm(Ze)))+"&"+B:this.m&&Gs(X,this.m,Ze)),Ep(this.h,Ue),this.Ua&&Zr(X,"TYPE","init"),this.P?(Zr(X,"$req",B),Zr(X,"SID","null"),Ue.T=!0,ha(Ue,X,null)):ha(Ue,X,B),this.G=2}}else this.G==3&&(A?th(this,A):this.i.length==0||_p(this.h)||th(this))};function th(A,B){var X;B?X=B.l:X=A.U++;const ge=Eo(A.I);Zr(ge,"SID",A.K),Zr(ge,"RID",X),Zr(ge,"AID",A.T),nh(A,ge),A.m&&A.o&&Gs(ge,A.m,A.o),X=new Rs(A,A.j,X,A.B+1),A.m===null&&(X.H=A.o),B&&(A.i=B.D.concat(A.i)),B=X_(A,X,1e3),X.I=Math.round(.5*A.wa)+Math.round(.5*A.wa*Math.random()),Ep(A.h,X),ha(X,ge,B)}function nh(A,B){A.H&&ve(A.H,function(X,ge){Zr(B,ge,X)}),A.l&&Mr({},function(X,ge){Zr(B,ge,X)})}function X_(A,B,X){X=Math.min(A.i.length,X);var ge=A.l?U(A.l.Na,A.l,A):null;e:{var Ue=A.i;let Ze=-1;for(;;){const It=["count="+X];Ze==-1?0<X?(Ze=Ue[0].g,It.push("ofs="+Ze)):Ze=0:It.push("ofs="+Ze);let vr=!0;for(let Cs=0;Cs<X;Cs++){let Yn=Ue[Cs].g;const zs=Ue[Cs].map;if(Yn-=Ze,0>Yn)Ze=Math.max(0,Ue[Cs].g-100),vr=!1;else try{qa(zs,It,"req"+Yn+"_")}catch{ge&&ge(zs)}}if(vr){ge=It.join("&");break e}}}return A=A.i.splice(0,X),B.D=A,ge}function Qc(A){if(!A.g&&!A.u){A.Y=1;var B=A.Fa;Ie||he(),Re||(Ie(),Re=!0),Me.add(B,A),A.v=0}}function Bl(A){return A.g||A.u||3<=A.v?!1:(A.Y++,A.u=yr(U(A.Fa,A),_m(A,A.v)),A.v++,!0)}a.Fa=function(){if(this.u=null,Q_(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var A=2*this.R;this.j.info("BP detection timer enabled: "+A),this.A=yr(U(this.ab,this),A)}},a.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ln(10),Dd(this),Q_(this))};function rh(A){A.A!=null&&(T.clearTimeout(A.A),A.A=null)}function Q_(A){A.g=new Rs(A,A.j,"rpc",A.Y),A.m===null&&(A.g.H=A.o),A.g.O=0;var B=Eo(A.qa);Zr(B,"RID","rpc"),Zr(B,"SID",A.K),Zr(B,"AID",A.T),Zr(B,"CI",A.F?"0":"1"),!A.F&&A.ja&&Zr(B,"TO",A.ja),Zr(B,"TYPE","xmlhttp"),nh(A,B),A.m&&A.o&&Gs(B,A.m,A.o),A.L&&(A.g.I=A.L);var X=A.g;A=A.ia,X.L=1,X.v=$u(Eo(B)),X.m=null,X.P=!0,Ll(X,A)}a.Za=function(){this.C!=null&&(this.C=null,Dd(this),Bl(this),ln(19))};function wp(A){A.C!=null&&(T.clearTimeout(A.C),A.C=null)}function $_(A,B){var X=null;if(A.g==B){wp(A),rh(A),A.g=null;var ge=2}else if(cm(A.h,B))X=B.D,Ca(A.h,B),ge=1;else return;if(A.G!=0){if(B.o)if(ge==1){X=B.m?B.m.length:0,B=Date.now()-B.F;var Ue=A.B;ge=un(),sn(ge,new mr(ge,X)),xd(A)}else Qc(A);else if(Ue=B.s,Ue==3||Ue==0&&0<B.X||!(ge==1&&gm(A,B)||ge==2&&Bl(A)))switch(X&&0<X.length&&(B=A.h,B.i=B.i.concat(X)),Ue){case 1:Ka(A,5);break;case 4:Ka(A,10);break;case 3:Ka(A,6);break;default:Ka(A,2)}}}function _m(A,B){let X=A.Ta+Math.floor(Math.random()*A.cb);return A.isActive()||(X*=2),X*B}function Ka(A,B){if(A.j.info("Error code "+B),B==2){var X=U(A.fb,A),ge=A.Xa;const Ue=!ge;ge=new es(ge||"//www.google.com/images/cleardot.gif"),T.location&&T.location.protocol=="http"||Qu(ge,"https"),$u(ge),Ue?Nd(ge.toString(),X):pc(ge.toString(),X)}else ln(2);A.G=0,A.l&&A.l.sa(B),J_(A),K_(A)}a.fb=function(A){A?(this.j.info("Successfully pinged google.com"),ln(2)):(this.j.info("Failed to ping google.com"),ln(1))};function J_(A){if(A.G=0,A.ka=[],A.l){const B=zc(A.h);(B.length!=0||A.i.length!=0)&&(K(A.ka,B),K(A.ka,A.i),A.h.i.length=0,ee(A.i),A.i.length=0),A.l.ra()}}function Hl(A,B,X){var ge=X instanceof es?Eo(X):new es(X);if(ge.g!="")B&&(ge.g=B+"."+ge.g),Ad(ge,ge.s);else{var Ue=T.location;ge=Ue.protocol,B=B?B+"."+Ue.hostname:Ue.hostname,Ue=+Ue.port;var Ze=new es(null);ge&&Qu(Ze,ge),B&&(Ze.g=B),Ue&&Ad(Ze,Ue),X&&(Ze.l=X),ge=Ze}return X=A.D,B=A.ya,X&&B&&Zr(ge,X,B),Zr(ge,"VER",A.la),nh(A,ge),ge}function Em(A,B,X){if(B&&!A.J)throw Error("Can't create secondary domain capable XhrIo object.");return B=A.Ca&&!A.pa?new Yr(new Od({eb:X})):new Yr(A.pa),B.Ha(A.J),B}a.isActive=function(){return!!this.l&&this.l.isActive(this)};function Z_(){}a=Z_.prototype,a.ua=function(){},a.ta=function(){},a.sa=function(){},a.ra=function(){},a.isActive=function(){return!0},a.Na=function(){};function xn(){}xn.prototype.g=function(A,B){return new Aa(A,B)};function Aa(A,B){Ht.call(this),this.g=new eh(B),this.l=A,this.h=B&&B.messageUrlParams||null,A=B&&B.messageHeaders||null,B&&B.clientProtocolHeaderRequired&&(A?A["X-Client-Protocol"]="webchannel":A={"X-Client-Protocol":"webchannel"}),this.g.o=A,A=B&&B.initMessageHeaders||null,B&&B.messageContentType&&(A?A["X-WebChannel-Content-Type"]=B.messageContentType:A={"X-WebChannel-Content-Type":B.messageContentType}),B&&B.va&&(A?A["X-WebChannel-Client-Profile"]=B.va:A={"X-WebChannel-Client-Profile":B.va}),this.g.S=A,(A=B&&B.Sb)&&!se(A)&&(this.g.m=A),this.v=B&&B.supportsCrossDomainXhr||!1,this.u=B&&B.sendRawJson||!1,(B=B&&B.httpSessionIdParam)&&!se(B)&&(this.g.D=B,A=this.h,A!==null&&B in A&&(A=this.h,B in A&&delete A[B])),this.j=new $c(this)}W(Aa,Ht),Aa.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Aa.prototype.close=function(){mm(this.g)},Aa.prototype.o=function(A){var B=this.g;if(typeof A=="string"){var X={};X.__data__=A,A=X}else this.u&&(X={},X.__data__=zi(A),A=X);B.i.push(new G_(B.Ya++,A)),B.G==3&&xd(B)},Aa.prototype.N=function(){this.g.l=null,delete this.j,mm(this.g),delete this.g,Aa.aa.N.call(this)};function eE(A){yn.call(this),A.__headers__&&(this.headers=A.__headers__,this.statusCode=A.__status__,delete A.__headers__,delete A.__status__);var B=A.__sm__;if(B){e:{for(const X in B){A=X;break e}A=void 0}(this.i=A)&&(A=this.i,B=B!==null&&A in B?B[A]:void 0),this.data=B}else this.data=A}W(eE,yn);function tE(){nr.call(this),this.status=1}W(tE,nr);function $c(A){this.g=A}W($c,Z_),$c.prototype.ua=function(){sn(this.g,"a")},$c.prototype.ta=function(A){sn(this.g,new eE(A))},$c.prototype.sa=function(A){sn(this.g,new tE)},$c.prototype.ra=function(){sn(this.g,"b")},xn.prototype.createWebChannel=xn.prototype.g,Aa.prototype.send=Aa.prototype.o,Aa.prototype.open=Aa.prototype.m,Aa.prototype.close=Aa.prototype.close,FK=function(){return new xn},VK=function(){return un()},UK=Qe,a2={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ra.NO_ERROR=0,Ra.TIMEOUT=8,Ra.HTTP_ERROR=6,XN=Ra,Uo.COMPLETE="complete",jK=Uo,je.EventType=nn,nn.OPEN="a",nn.CLOSE="b",nn.ERROR="c",nn.MESSAGE="d",Ht.prototype.listen=Ht.prototype.K,Ow=je,Yr.prototype.listenOnce=Yr.prototype.L,Yr.prototype.getLastError=Yr.prototype.Ka,Yr.prototype.getLastErrorCode=Yr.prototype.Ba,Yr.prototype.getStatus=Yr.prototype.Z,Yr.prototype.getResponseJson=Yr.prototype.Oa,Yr.prototype.getResponseText=Yr.prototype.oa,Yr.prototype.send=Yr.prototype.ea,Yr.prototype.setWithCredentials=Yr.prototype.Ha,MK=Yr}).apply(typeof ZI<"u"?ZI:typeof self<"u"?self:typeof window<"u"?window:{});const j8="@firebase/firestore",U8="4.7.11";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(n){this.uid=n}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(n){return n.uid===this.uid}}co.UNAUTHENTICATED=new co(null),co.GOOGLE_CREDENTIALS=new co("google-credentials-uid"),co.FIRST_PARTY=new co("first-party-uid"),co.MOCK_USER=new co("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iS="11.6.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O_=new RK("@firebase/firestore");function Sv(){return O_.logLevel}function Xt(a,...n){if(O_.logLevel<=Lr.DEBUG){const i=n.map(aj);O_.debug(`Firestore (${iS}): ${a}`,...i)}}function hp(a,...n){if(O_.logLevel<=Lr.ERROR){const i=n.map(aj);O_.error(`Firestore (${iS}): ${a}`,...i)}}function jv(a,...n){if(O_.logLevel<=Lr.WARN){const i=n.map(aj);O_.warn(`Firestore (${iS}): ${a}`,...i)}}function aj(a){if(typeof a=="string")return a;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(a)}catch{return a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ln(a,n,i){let s="Unexpected state";typeof n=="string"?s=n:i=n,BK(a,s,i)}function BK(a,n,i){let s=`FIRESTORE (${iS}) INTERNAL ASSERTION FAILED: ${n} (ID: ${a.toString(16)})`;if(i!==void 0)try{s+=" CONTEXT: "+JSON.stringify(i)}catch{s+=" CONTEXT: "+i}throw hp(s),new Error(s)}function si(a,n,i,s){let l="Unexpected state";typeof i=="string"?l=i:s=i,a||BK(n,l,s)}function zn(a,n){return a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Et={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Qt extends M_{constructor(n,i){super(n,i),this.code=n,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S_{constructor(){this.promise=new Promise((n,i)=>{this.resolve=n,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HK{constructor(n,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${n}`)}}class Bme{getToken(){return Promise.resolve(null)}invalidateToken(){}start(n,i){n.enqueueRetryable(()=>i(co.UNAUTHENTICATED))}shutdown(){}}class Hme{constructor(n){this.token=n,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(n,i){this.changeListener=i,n.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class Gme{constructor(n){this.t=n,this.currentUser=co.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(n,i){si(this.o===void 0,42304);let s=this.i;const l=w=>this.i!==s?(s=this.i,i(w)):Promise.resolve();let p=new S_;this.o=()=>{this.i++,this.currentUser=this.u(),p.resolve(),p=new S_,n.enqueueRetryable(()=>l(this.currentUser))};const _=()=>{const w=p;n.enqueueRetryable(async()=>{await w.promise,await l(this.currentUser)})},T=w=>{Xt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=w,this.o&&(this.auth.addAuthTokenListener(this.o),_())};this.t.onInit(w=>T(w)),setTimeout(()=>{if(!this.auth){const w=this.t.getImmediate({optional:!0});w?T(w):(Xt("FirebaseAuthCredentialsProvider","Auth not yet detected"),p.resolve(),p=new S_)}},0),_()}getToken(){const n=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(s=>this.i!==n?(Xt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(si(typeof s.accessToken=="string",31837,{l:s}),new HK(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const n=this.auth&&this.auth.getUid();return si(n===null||typeof n=="string",2055,{h:n}),new co(n)}}class Wme{constructor(n,i,s){this.P=n,this.T=i,this.I=s,this.type="FirstParty",this.user=co.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const n=this.R();return n&&this.A.set("Authorization",n),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class zme{constructor(n,i,s){this.P=n,this.T=i,this.I=s}getToken(){return Promise.resolve(new Wme(this.P,this.T,this.I))}start(n,i){n.enqueueRetryable(()=>i(co.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class V8{constructor(n){this.value=n,this.type="AppCheck",this.headers=new Map,n&&n.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Yme{constructor(n,i){this.V=i,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,NK(n)&&n.settings.appCheckToken&&(this.p=n.settings.appCheckToken)}start(n,i){si(this.o===void 0,3512);const s=p=>{p.error!=null&&Xt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${p.error.message}`);const _=p.token!==this.m;return this.m=p.token,Xt("FirebaseAppCheckTokenProvider",`Received ${_?"new":"existing"} token.`),_?i(p.token):Promise.resolve()};this.o=p=>{n.enqueueRetryable(()=>s(p))};const l=p=>{Xt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=p,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(p=>l(p)),setTimeout(()=>{if(!this.appCheck){const p=this.V.getImmediate({optional:!0});p?l(p):Xt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new V8(this.p));const n=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(n).then(i=>i?(si(typeof i.token=="string",44558,{tokenResult:i}),this.m=i.token,new V8(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qme(a){const n=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(a);if(n&&typeof n.getRandomValues=="function")n.getRandomValues(i);else for(let s=0;s<a;s++)i[s]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GK(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WK{static newId(){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const l=qme(40);for(let p=0;p<l.length;++p)s.length<20&&l[p]<i&&(s+=n.charAt(l[p]%62))}return s}}function pr(a,n){return a<n?-1:a>n?1:0}function o2(a,n){let i=0;for(;i<a.length&&i<n.length;){const s=a.codePointAt(i),l=n.codePointAt(i);if(s!==l){if(s<128&&l<128)return pr(s,l);{const p=GK(),_=Kme(p.encode(F8(a,i)),p.encode(F8(n,i)));return _!==0?_:pr(s,l)}}i+=s>65535?2:1}return pr(a.length,n.length)}function F8(a,n){return a.codePointAt(n)>65535?a.substring(n,n+2):a.substring(n,n+1)}function Kme(a,n){for(let i=0;i<a.length&&i<n.length;++i)if(a[i]!==n[i])return pr(a[i],n[i]);return pr(a.length,n.length)}function Uv(a,n,i){return a.length===n.length&&a.every((s,l)=>i(s,n[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B8=-62135596800,H8=1e6;class la{static now(){return la.fromMillis(Date.now())}static fromDate(n){return la.fromMillis(n.getTime())}static fromMillis(n){const i=Math.floor(n/1e3),s=Math.floor((n-1e3*i)*H8);return new la(i,s)}constructor(n,i){if(this.seconds=n,this.nanoseconds=i,i<0)throw new Qt(Et.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Qt(Et.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(n<B8)throw new Qt(Et.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n);if(n>=253402300800)throw new Qt(Et.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/H8}_compareTo(n){return this.seconds===n.seconds?pr(this.nanoseconds,n.nanoseconds):pr(this.seconds,n.seconds)}isEqual(n){return n.seconds===this.seconds&&n.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const n=this.seconds-B8;return String(n).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{static fromTimestamp(n){return new Gn(n)}static min(){return new Gn(new la(0,0))}static max(){return new Gn(new la(253402300799,999999999))}constructor(n){this.timestamp=n}compareTo(n){return this.timestamp._compareTo(n.timestamp)}isEqual(n){return this.timestamp.isEqual(n.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G8="__name__";class Nu{constructor(n,i,s){i===void 0?i=0:i>n.length&&Ln(637,{offset:i,range:n.length}),s===void 0?s=n.length-i:s>n.length-i&&Ln(1746,{length:s,range:n.length-i}),this.segments=n,this.offset=i,this.len=s}get length(){return this.len}isEqual(n){return Nu.comparator(this,n)===0}child(n){const i=this.segments.slice(this.offset,this.limit());return n instanceof Nu?n.forEach(s=>{i.push(s)}):i.push(n),this.construct(i)}limit(){return this.offset+this.length}popFirst(n){return n=n===void 0?1:n,this.construct(this.segments,this.offset+n,this.length-n)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(n){return this.segments[this.offset+n]}isEmpty(){return this.length===0}isPrefixOf(n){if(n.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==n.get(i))return!1;return!0}isImmediateParentOf(n){if(this.length+1!==n.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==n.get(i))return!1;return!0}forEach(n){for(let i=this.offset,s=this.limit();i<s;i++)n(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(n,i){const s=Math.min(n.length,i.length);for(let l=0;l<s;l++){const p=Nu.compareSegments(n.get(l),i.get(l));if(p!==0)return p}return pr(n.length,i.length)}static compareSegments(n,i){const s=Nu.isNumericId(n),l=Nu.isNumericId(i);return s&&!l?-1:!s&&l?1:s&&l?Nu.extractNumericId(n).compare(Nu.extractNumericId(i)):o2(n,i)}static isNumericId(n){return n.startsWith("__id")&&n.endsWith("__")}static extractNumericId(n){return Yf.fromString(n.substring(4,n.length-2))}}class Gi extends Nu{construct(n,i,s){return new Gi(n,i,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...n){const i=[];for(const s of n){if(s.indexOf("//")>=0)throw new Qt(Et.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);i.push(...s.split("/").filter(l=>l.length>0))}return new Gi(i)}static emptyPath(){return new Gi([])}}const Xme=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ba extends Nu{construct(n,i,s){return new Ba(n,i,s)}static isValidIdentifier(n){return Xme.test(n)}canonicalString(){return this.toArray().map(n=>(n=n.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ba.isValidIdentifier(n)||(n="`"+n+"`"),n)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===G8}static keyField(){return new Ba([G8])}static fromServerFormat(n){const i=[];let s="",l=0;const p=()=>{if(s.length===0)throw new Qt(Et.INVALID_ARGUMENT,`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(s),s=""};let _=!1;for(;l<n.length;){const T=n[l];if(T==="\\"){if(l+1===n.length)throw new Qt(Et.INVALID_ARGUMENT,"Path has trailing escape character: "+n);const w=n[l+1];if(w!=="\\"&&w!=="."&&w!=="`")throw new Qt(Et.INVALID_ARGUMENT,"Path has invalid escape sequence: "+n);s+=w,l+=2}else T==="`"?(_=!_,l++):T!=="."||_?(s+=T,l++):(p(),l++)}if(p(),_)throw new Qt(Et.INVALID_ARGUMENT,"Unterminated ` in path: "+n);return new Ba(i)}static emptyPath(){return new Ba([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(n){this.path=n}static fromPath(n){return new En(Gi.fromString(n))}static fromName(n){return new En(Gi.fromString(n).popFirst(5))}static empty(){return new En(Gi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(n){return this.path.length>=2&&this.path.get(this.path.length-2)===n}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(n){return n!==null&&Gi.comparator(this.path,n.path)===0}toString(){return this.path.toString()}static comparator(n,i){return Gi.comparator(n.path,i.path)}static isDocumentKey(n){return n.length%2==0}static fromSegments(n){return new En(new Gi(n.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iR=-1;function Qme(a,n){const i=a.toTimestamp().seconds,s=a.toTimestamp().nanoseconds+1,l=Gn.fromTimestamp(s===1e9?new la(i+1,0):new la(i,s));return new $f(l,En.empty(),n)}function $me(a){return new $f(a.readTime,a.key,iR)}class $f{constructor(n,i,s){this.readTime=n,this.documentKey=i,this.largestBatchId=s}static min(){return new $f(Gn.min(),En.empty(),iR)}static max(){return new $f(Gn.max(),En.empty(),iR)}}function Jme(a,n){let i=a.readTime.compareTo(n.readTime);return i!==0?i:(i=En.comparator(a.documentKey,n.documentKey),i!==0?i:pr(a.largestBatchId,n.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zme="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ege{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(n){this.onCommittedListeners.push(n)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(n=>n())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sS(a){if(a.code!==Et.FAILED_PRECONDITION||a.message!==Zme)throw a;Xt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(n){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,n(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(n){return this.next(void 0,n)}next(n,i){return this.callbackAttached&&Ln(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(n,this.result):new yt((s,l)=>{this.nextCallback=p=>{this.wrapSuccess(n,p).next(s,l)},this.catchCallback=p=>{this.wrapFailure(i,p).next(s,l)}})}toPromise(){return new Promise((n,i)=>{this.next(n,i)})}wrapUserFunction(n){try{const i=n();return i instanceof yt?i:yt.resolve(i)}catch(i){return yt.reject(i)}}wrapSuccess(n,i){return n?this.wrapUserFunction(()=>n(i)):yt.resolve(i)}wrapFailure(n,i){return n?this.wrapUserFunction(()=>n(i)):yt.reject(i)}static resolve(n){return new yt((i,s)=>{i(n)})}static reject(n){return new yt((i,s)=>{s(n)})}static waitFor(n){return new yt((i,s)=>{let l=0,p=0,_=!1;n.forEach(T=>{++l,T.next(()=>{++p,_&&p===l&&i()},w=>s(w))}),_=!0,p===l&&i()})}static or(n){let i=yt.resolve(!1);for(const s of n)i=i.next(l=>l?yt.resolve(l):s());return i}static forEach(n,i){const s=[];return n.forEach((l,p)=>{s.push(i.call(this,l,p))}),this.waitFor(s)}static mapArray(n,i){return new yt((s,l)=>{const p=n.length,_=new Array(p);let T=0;for(let w=0;w<p;w++){const C=w;i(n[C]).next(O=>{_[C]=O,++T,T===p&&s(_)},O=>l(O))}})}static doWhile(n,i){return new yt((s,l)=>{const p=()=>{n()===!0?i().next(()=>{p()},l):s()};p()})}}function tge(a){const n=a.match(/Android ([\d.]+)/i),i=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function aS(a){return a.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mD{constructor(n,i){this.previousValue=n,i&&(i.sequenceNumberHandler=s=>this.ue(s),this.ce=s=>i.writeSequenceNumber(s))}ue(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){const n=++this.previousValue;return this.ce&&this.ce(n),n}}mD.le=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oj=-1;function gD(a){return a==null}function RO(a){return a===0&&1/a==-1/0}function nge(a){return typeof a=="number"&&Number.isInteger(a)&&!RO(a)&&a<=Number.MAX_SAFE_INTEGER&&a>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zK="";function rge(a){let n="";for(let i=0;i<a.length;i++)n.length>0&&(n=W8(n)),n=ige(a.get(i),n);return W8(n)}function ige(a,n){let i=n;const s=a.length;for(let l=0;l<s;l++){const p=a.charAt(l);switch(p){case"\0":i+="";break;case zK:i+="";break;default:i+=p}}return i}function W8(a){return a+zK+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z8(a){let n=0;for(const i in a)Object.prototype.hasOwnProperty.call(a,i)&&n++;return n}function am(a,n){for(const i in a)Object.prototype.hasOwnProperty.call(a,i)&&n(i,a[i])}function YK(a){for(const n in a)if(Object.prototype.hasOwnProperty.call(a,n))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ls{constructor(n,i){this.comparator=n,this.root=i||Fa.EMPTY}insert(n,i){return new ls(this.comparator,this.root.insert(n,i,this.comparator).copy(null,null,Fa.BLACK,null,null))}remove(n){return new ls(this.comparator,this.root.remove(n,this.comparator).copy(null,null,Fa.BLACK,null,null))}get(n){let i=this.root;for(;!i.isEmpty();){const s=this.comparator(n,i.key);if(s===0)return i.value;s<0?i=i.left:s>0&&(i=i.right)}return null}indexOf(n){let i=0,s=this.root;for(;!s.isEmpty();){const l=this.comparator(n,s.key);if(l===0)return i+s.left.size;l<0?s=s.left:(i+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(n){return this.root.inorderTraversal(n)}forEach(n){this.inorderTraversal((i,s)=>(n(i,s),!1))}toString(){const n=[];return this.inorderTraversal((i,s)=>(n.push(`${i}:${s}`),!1)),`{${n.join(", ")}}`}reverseTraversal(n){return this.root.reverseTraversal(n)}getIterator(){return new eN(this.root,null,this.comparator,!1)}getIteratorFrom(n){return new eN(this.root,n,this.comparator,!1)}getReverseIterator(){return new eN(this.root,null,this.comparator,!0)}getReverseIteratorFrom(n){return new eN(this.root,n,this.comparator,!0)}}class eN{constructor(n,i,s,l){this.isReverse=l,this.nodeStack=[];let p=1;for(;!n.isEmpty();)if(p=i?s(n.key,i):1,i&&l&&(p*=-1),p<0)n=this.isReverse?n.left:n.right;else{if(p===0){this.nodeStack.push(n);break}this.nodeStack.push(n),n=this.isReverse?n.right:n.left}}getNext(){let n=this.nodeStack.pop();const i={key:n.key,value:n.value};if(this.isReverse)for(n=n.left;!n.isEmpty();)this.nodeStack.push(n),n=n.right;else for(n=n.right;!n.isEmpty();)this.nodeStack.push(n),n=n.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const n=this.nodeStack[this.nodeStack.length-1];return{key:n.key,value:n.value}}}class Fa{constructor(n,i,s,l,p){this.key=n,this.value=i,this.color=s??Fa.RED,this.left=l??Fa.EMPTY,this.right=p??Fa.EMPTY,this.size=this.left.size+1+this.right.size}copy(n,i,s,l,p){return new Fa(n??this.key,i??this.value,s??this.color,l??this.left,p??this.right)}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,i,s){let l=this;const p=s(n,l.key);return l=p<0?l.copy(null,null,null,l.left.insert(n,i,s),null):p===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(n,i,s)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Fa.EMPTY;let n=this;return n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.removeMin(),null),n.fixUp()}remove(n,i){let s,l=this;if(i(n,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(n,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(n,l.key)===0){if(l.right.isEmpty())return Fa.EMPTY;s=l.right.min(),l=l.copy(s.key,s.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(n,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let n=this;return n.right.isRed()&&!n.left.isRed()&&(n=n.rotateLeft()),n.left.isRed()&&n.left.left.isRed()&&(n=n.rotateRight()),n.left.isRed()&&n.right.isRed()&&(n=n.colorFlip()),n}moveRedLeft(){let n=this.colorFlip();return n.right.left.isRed()&&(n=n.copy(null,null,null,null,n.right.rotateRight()),n=n.rotateLeft(),n=n.colorFlip()),n}moveRedRight(){let n=this.colorFlip();return n.left.left.isRed()&&(n=n.rotateRight(),n=n.colorFlip()),n}rotateLeft(){const n=this.copy(null,null,Fa.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight(){const n=this.copy(null,null,Fa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip(){const n=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,i)}checkMaxDepth(){const n=this.check();return Math.pow(2,n)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ln(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ln(14113,{key:this.key,value:this.value});const n=this.left.check();if(n!==this.right.check())throw Ln(27949);return n+(this.isRed()?0:1)}}Fa.EMPTY=null,Fa.RED=!0,Fa.BLACK=!1;Fa.EMPTY=new class{constructor(){this.size=0}get key(){throw Ln(57766)}get value(){throw Ln(16141)}get color(){throw Ln(16727)}get left(){throw Ln(29726)}get right(){throw Ln(36894)}copy(n,i,s,l,p){return this}insert(n,i,s){return new Fa(n,i)}remove(n,i){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(n){this.comparator=n,this.data=new ls(this.comparator)}has(n){return this.data.get(n)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(n){return this.data.indexOf(n)}forEach(n){this.data.inorderTraversal((i,s)=>(n(i),!1))}forEachInRange(n,i){const s=this.data.getIteratorFrom(n[0]);for(;s.hasNext();){const l=s.getNext();if(this.comparator(l.key,n[1])>=0)return;i(l.key)}}forEachWhile(n,i){let s;for(s=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();s.hasNext();)if(!n(s.getNext().key))return}firstAfterOrEqual(n){const i=this.data.getIteratorFrom(n);return i.hasNext()?i.getNext().key:null}getIterator(){return new Y8(this.data.getIterator())}getIteratorFrom(n){return new Y8(this.data.getIteratorFrom(n))}add(n){return this.copy(this.data.remove(n).insert(n,!0))}delete(n){return this.has(n)?this.copy(this.data.remove(n)):this}isEmpty(){return this.data.isEmpty()}unionWith(n){let i=this;return i.size<n.size&&(i=n,n=this),n.forEach(s=>{i=i.add(s)}),i}isEqual(n){if(!(n instanceof da)||this.size!==n.size)return!1;const i=this.data.getIterator(),s=n.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,p=s.getNext().key;if(this.comparator(l,p)!==0)return!1}return!0}toArray(){const n=[];return this.forEach(i=>{n.push(i)}),n}toString(){const n=[];return this.forEach(i=>n.push(i)),"SortedSet("+n.toString()+")"}copy(n){const i=new da(this.comparator);return i.data=n,i}}class Y8{constructor(n){this.iter=n}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jc{constructor(n){this.fields=n,n.sort(Ba.comparator)}static empty(){return new jc([])}unionWith(n){let i=new da(Ba.comparator);for(const s of this.fields)i=i.add(s);for(const s of n)i=i.add(s);return new jc(i.toArray())}covers(n){for(const i of this.fields)if(i.isPrefixOf(n))return!0;return!1}isEqual(n){return Uv(this.fields,n.fields,(i,s)=>i.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qK extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ha{constructor(n){this.binaryString=n}static fromBase64String(n){const i=function(l){try{return atob(l)}catch(p){throw typeof DOMException<"u"&&p instanceof DOMException?new qK("Invalid base64 string: "+p):p}}(n);return new Ha(i)}static fromUint8Array(n){const i=function(l){let p="";for(let _=0;_<l.length;++_)p+=String.fromCharCode(l[_]);return p}(n);return new Ha(i)}[Symbol.iterator](){let n=0;return{next:()=>n<this.binaryString.length?{value:this.binaryString.charCodeAt(n++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const s=new Uint8Array(i.length);for(let l=0;l<i.length;l++)s[l]=i.charCodeAt(l);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(n){return pr(this.binaryString,n.binaryString)}isEqual(n){return this.binaryString===n.binaryString}}Ha.EMPTY_BYTE_STRING=new Ha("");const sge=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Jf(a){if(si(!!a,39018),typeof a=="string"){let n=0;const i=sge.exec(a);if(si(!!i,46558,{timestamp:a}),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),n=Number(l)}const s=new Date(a);return{seconds:Math.floor(s.getTime()/1e3),nanos:n}}return{seconds:js(a.seconds),nanos:js(a.nanos)}}function js(a){return typeof a=="number"?a:typeof a=="string"?Number(a):0}function Zf(a){return typeof a=="string"?Ha.fromBase64String(a):Ha.fromUint8Array(a)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KK="server_timestamp",XK="__type__",QK="__previous_value__",$K="__local_write_time__";function cj(a){var n,i;return((i=(((n=a==null?void 0:a.mapValue)===null||n===void 0?void 0:n.fields)||{})[XK])===null||i===void 0?void 0:i.stringValue)===KK}function _D(a){const n=a.mapValue.fields[QK];return cj(n)?_D(n):n}function sR(a){const n=Jf(a.mapValue.fields[$K].timestampValue);return new la(n.seconds,n.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class age{constructor(n,i,s,l,p,_,T,w,C){this.databaseId=n,this.appId=i,this.persistenceKey=s,this.host=l,this.ssl=p,this.forceLongPolling=_,this.autoDetectLongPolling=T,this.longPollingOptions=w,this.useFetchStreams=C}}const CO="(default)";class aR{constructor(n,i){this.projectId=n,this.database=i||CO}static empty(){return new aR("","")}get isDefaultDatabase(){return this.database===CO}isEqual(n){return n instanceof aR&&n.projectId===this.projectId&&n.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JK="__type__",oge="__max__",tN={mapValue:{}},ZK="__vector__",AO="value";function em(a){return"nullValue"in a?0:"booleanValue"in a?1:"integerValue"in a||"doubleValue"in a?2:"timestampValue"in a?3:"stringValue"in a?5:"bytesValue"in a?6:"referenceValue"in a?7:"geoPointValue"in a?8:"arrayValue"in a?9:"mapValue"in a?cj(a)?4:lge(a)?9007199254740991:cge(a)?10:11:Ln(28295,{value:a})}function Fu(a,n){if(a===n)return!0;const i=em(a);if(i!==em(n))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return a.booleanValue===n.booleanValue;case 4:return sR(a).isEqual(sR(n));case 3:return function(l,p){if(typeof l.timestampValue=="string"&&typeof p.timestampValue=="string"&&l.timestampValue.length===p.timestampValue.length)return l.timestampValue===p.timestampValue;const _=Jf(l.timestampValue),T=Jf(p.timestampValue);return _.seconds===T.seconds&&_.nanos===T.nanos}(a,n);case 5:return a.stringValue===n.stringValue;case 6:return function(l,p){return Zf(l.bytesValue).isEqual(Zf(p.bytesValue))}(a,n);case 7:return a.referenceValue===n.referenceValue;case 8:return function(l,p){return js(l.geoPointValue.latitude)===js(p.geoPointValue.latitude)&&js(l.geoPointValue.longitude)===js(p.geoPointValue.longitude)}(a,n);case 2:return function(l,p){if("integerValue"in l&&"integerValue"in p)return js(l.integerValue)===js(p.integerValue);if("doubleValue"in l&&"doubleValue"in p){const _=js(l.doubleValue),T=js(p.doubleValue);return _===T?RO(_)===RO(T):isNaN(_)&&isNaN(T)}return!1}(a,n);case 9:return Uv(a.arrayValue.values||[],n.arrayValue.values||[],Fu);case 10:case 11:return function(l,p){const _=l.mapValue.fields||{},T=p.mapValue.fields||{};if(z8(_)!==z8(T))return!1;for(const w in _)if(_.hasOwnProperty(w)&&(T[w]===void 0||!Fu(_[w],T[w])))return!1;return!0}(a,n);default:return Ln(52216,{left:a})}}function oR(a,n){return(a.values||[]).find(i=>Fu(i,n))!==void 0}function Vv(a,n){if(a===n)return 0;const i=em(a),s=em(n);if(i!==s)return pr(i,s);switch(i){case 0:case 9007199254740991:return 0;case 1:return pr(a.booleanValue,n.booleanValue);case 2:return function(p,_){const T=js(p.integerValue||p.doubleValue),w=js(_.integerValue||_.doubleValue);return T<w?-1:T>w?1:T===w?0:isNaN(T)?isNaN(w)?0:-1:1}(a,n);case 3:return q8(a.timestampValue,n.timestampValue);case 4:return q8(sR(a),sR(n));case 5:return o2(a.stringValue,n.stringValue);case 6:return function(p,_){const T=Zf(p),w=Zf(_);return T.compareTo(w)}(a.bytesValue,n.bytesValue);case 7:return function(p,_){const T=p.split("/"),w=_.split("/");for(let C=0;C<T.length&&C<w.length;C++){const O=pr(T[C],w[C]);if(O!==0)return O}return pr(T.length,w.length)}(a.referenceValue,n.referenceValue);case 8:return function(p,_){const T=pr(js(p.latitude),js(_.latitude));return T!==0?T:pr(js(p.longitude),js(_.longitude))}(a.geoPointValue,n.geoPointValue);case 9:return K8(a.arrayValue,n.arrayValue);case 10:return function(p,_){var T,w,C,O;const k=p.fields||{},U=_.fields||{},Y=(T=k[AO])===null||T===void 0?void 0:T.arrayValue,W=(w=U[AO])===null||w===void 0?void 0:w.arrayValue,ee=pr(((C=Y==null?void 0:Y.values)===null||C===void 0?void 0:C.length)||0,((O=W==null?void 0:W.values)===null||O===void 0?void 0:O.length)||0);return ee!==0?ee:K8(Y,W)}(a.mapValue,n.mapValue);case 11:return function(p,_){if(p===tN.mapValue&&_===tN.mapValue)return 0;if(p===tN.mapValue)return 1;if(_===tN.mapValue)return-1;const T=p.fields||{},w=Object.keys(T),C=_.fields||{},O=Object.keys(C);w.sort(),O.sort();for(let k=0;k<w.length&&k<O.length;++k){const U=o2(w[k],O[k]);if(U!==0)return U;const Y=Vv(T[w[k]],C[O[k]]);if(Y!==0)return Y}return pr(w.length,O.length)}(a.mapValue,n.mapValue);default:throw Ln(23264,{Pe:i})}}function q8(a,n){if(typeof a=="string"&&typeof n=="string"&&a.length===n.length)return pr(a,n);const i=Jf(a),s=Jf(n),l=pr(i.seconds,s.seconds);return l!==0?l:pr(i.nanos,s.nanos)}function K8(a,n){const i=a.values||[],s=n.values||[];for(let l=0;l<i.length&&l<s.length;++l){const p=Vv(i[l],s[l]);if(p)return p}return pr(i.length,s.length)}function Fv(a){return c2(a)}function c2(a){return"nullValue"in a?"null":"booleanValue"in a?""+a.booleanValue:"integerValue"in a?""+a.integerValue:"doubleValue"in a?""+a.doubleValue:"timestampValue"in a?function(i){const s=Jf(i);return`time(${s.seconds},${s.nanos})`}(a.timestampValue):"stringValue"in a?a.stringValue:"bytesValue"in a?function(i){return Zf(i).toBase64()}(a.bytesValue):"referenceValue"in a?function(i){return En.fromName(i).toString()}(a.referenceValue):"geoPointValue"in a?function(i){return`geo(${i.latitude},${i.longitude})`}(a.geoPointValue):"arrayValue"in a?function(i){let s="[",l=!0;for(const p of i.values||[])l?l=!1:s+=",",s+=c2(p);return s+"]"}(a.arrayValue):"mapValue"in a?function(i){const s=Object.keys(i.fields||{}).sort();let l="{",p=!0;for(const _ of s)p?p=!1:l+=",",l+=`${_}:${c2(i.fields[_])}`;return l+"}"}(a.mapValue):Ln(61005,{value:a})}function QN(a){switch(em(a)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const n=_D(a);return n?16+QN(n):16;case 5:return 2*a.stringValue.length;case 6:return Zf(a.bytesValue).approximateByteSize();case 7:return a.referenceValue.length;case 9:return function(s){return(s.values||[]).reduce((l,p)=>l+QN(p),0)}(a.arrayValue);case 10:case 11:return function(s){let l=0;return am(s.fields,(p,_)=>{l+=p.length+QN(_)}),l}(a.mapValue);default:throw Ln(13486,{value:a})}}function X8(a,n){return{referenceValue:`projects/${a.projectId}/databases/${a.database}/documents/${n.path.canonicalString()}`}}function l2(a){return!!a&&"integerValue"in a}function lj(a){return!!a&&"arrayValue"in a}function Q8(a){return!!a&&"nullValue"in a}function $8(a){return!!a&&"doubleValue"in a&&isNaN(Number(a.doubleValue))}function $N(a){return!!a&&"mapValue"in a}function cge(a){var n,i;return((i=(((n=a==null?void 0:a.mapValue)===null||n===void 0?void 0:n.fields)||{})[JK])===null||i===void 0?void 0:i.stringValue)===ZK}function Yw(a){if(a.geoPointValue)return{geoPointValue:Object.assign({},a.geoPointValue)};if(a.timestampValue&&typeof a.timestampValue=="object")return{timestampValue:Object.assign({},a.timestampValue)};if(a.mapValue){const n={mapValue:{fields:{}}};return am(a.mapValue.fields,(i,s)=>n.mapValue.fields[i]=Yw(s)),n}if(a.arrayValue){const n={arrayValue:{values:[]}};for(let i=0;i<(a.arrayValue.values||[]).length;++i)n.arrayValue.values[i]=Yw(a.arrayValue.values[i]);return n}return Object.assign({},a)}function lge(a){return(((a.mapValue||{}).fields||{}).__type__||{}).stringValue===oge}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{constructor(n){this.value=n}static empty(){return new lc({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let i=this.value;for(let s=0;s<n.length-1;++s)if(i=(i.mapValue.fields||{})[n.get(s)],!$N(i))return null;return i=(i.mapValue.fields||{})[n.lastSegment()],i||null}}set(n,i){this.getFieldsMap(n.popLast())[n.lastSegment()]=Yw(i)}setAll(n){let i=Ba.emptyPath(),s={},l=[];n.forEach((_,T)=>{if(!i.isImmediateParentOf(T)){const w=this.getFieldsMap(i);this.applyChanges(w,s,l),s={},l=[],i=T.popLast()}_?s[T.lastSegment()]=Yw(_):l.push(T.lastSegment())});const p=this.getFieldsMap(i);this.applyChanges(p,s,l)}delete(n){const i=this.field(n.popLast());$N(i)&&i.mapValue.fields&&delete i.mapValue.fields[n.lastSegment()]}isEqual(n){return Fu(this.value,n.value)}getFieldsMap(n){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let s=0;s<n.length;++s){let l=i.mapValue.fields[n.get(s)];$N(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[n.get(s)]=l),i=l}return i.mapValue.fields}applyChanges(n,i,s){am(i,(l,p)=>n[l]=p);for(const l of s)delete n[l]}clone(){return new lc(Yw(this.value))}}function e7(a){const n=[];return am(a.fields,(i,s)=>{const l=new Ba([i]);if($N(s)){const p=e7(s.mapValue).fields;if(p.length===0)n.push(l);else for(const _ of p)n.push(l.child(_))}else n.push(l)}),new jc(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(n,i,s,l,p,_,T){this.key=n,this.documentType=i,this.version=s,this.readTime=l,this.createTime=p,this.data=_,this.documentState=T}static newInvalidDocument(n){return new lo(n,0,Gn.min(),Gn.min(),Gn.min(),lc.empty(),0)}static newFoundDocument(n,i,s,l){return new lo(n,1,i,Gn.min(),s,l,0)}static newNoDocument(n,i){return new lo(n,2,i,Gn.min(),Gn.min(),lc.empty(),0)}static newUnknownDocument(n,i){return new lo(n,3,i,Gn.min(),Gn.min(),lc.empty(),2)}convertToFoundDocument(n,i){return!this.createTime.isEqual(Gn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=n),this.version=n,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(n){return this.version=n,this.documentType=2,this.data=lc.empty(),this.documentState=0,this}convertToUnknownDocument(n){return this.version=n,this.documentType=3,this.data=lc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Gn.min(),this}setReadTime(n){return this.readTime=n,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(n){return n instanceof lo&&this.key.isEqual(n.key)&&this.version.isEqual(n.version)&&this.documentType===n.documentType&&this.documentState===n.documentState&&this.data.isEqual(n.data)}mutableCopy(){return new lo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IO{constructor(n,i){this.position=n,this.inclusive=i}}function J8(a,n,i){let s=0;for(let l=0;l<a.position.length;l++){const p=n[l],_=a.position[l];if(p.field.isKeyField()?s=En.comparator(En.fromName(_.referenceValue),i.key):s=Vv(_,i.data.field(p.field)),p.dir==="desc"&&(s*=-1),s!==0)break}return s}function Z8(a,n){if(a===null)return n===null;if(n===null||a.inclusive!==n.inclusive||a.position.length!==n.position.length)return!1;for(let i=0;i<a.position.length;i++)if(!Fu(a.position[i],n.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cR{constructor(n,i="asc"){this.field=n,this.dir=i}}function dge(a,n){return a.dir===n.dir&&a.field.isEqual(n.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t7{}class ea extends t7{constructor(n,i,s){super(),this.field=n,this.op=i,this.value=s}static create(n,i,s){return n.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(n,i,s):new hge(n,i,s):i==="array-contains"?new mge(n,s):i==="in"?new gge(n,s):i==="not-in"?new _ge(n,s):i==="array-contains-any"?new Ege(n,s):new ea(n,i,s)}static createKeyFieldInFilter(n,i,s){return i==="in"?new pge(n,s):new fge(n,s)}matches(n){const i=n.data.field(this.field);return this.op==="!="?i!==null&&i.nullValue===void 0&&this.matchesComparison(Vv(i,this.value)):i!==null&&em(this.value)===em(i)&&this.matchesComparison(Vv(i,this.value))}matchesComparison(n){switch(this.op){case"<":return n<0;case"<=":return n<=0;case"==":return n===0;case"!=":return n!==0;case">":return n>0;case">=":return n>=0;default:return Ln(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class bd extends t7{constructor(n,i){super(),this.filters=n,this.op=i,this.Te=null}static create(n,i){return new bd(n,i)}matches(n){return n7(this)?this.filters.find(i=>!i.matches(n))===void 0:this.filters.find(i=>i.matches(n))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((n,i)=>n.concat(i.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function n7(a){return a.op==="and"}function r7(a){return uge(a)&&n7(a)}function uge(a){for(const n of a.filters)if(n instanceof bd)return!1;return!0}function d2(a){if(a instanceof ea)return a.field.canonicalString()+a.op.toString()+Fv(a.value);if(r7(a))return a.filters.map(n=>d2(n)).join(",");{const n=a.filters.map(i=>d2(i)).join(",");return`${a.op}(${n})`}}function i7(a,n){return a instanceof ea?function(s,l){return l instanceof ea&&s.op===l.op&&s.field.isEqual(l.field)&&Fu(s.value,l.value)}(a,n):a instanceof bd?function(s,l){return l instanceof bd&&s.op===l.op&&s.filters.length===l.filters.length?s.filters.reduce((p,_,T)=>p&&i7(_,l.filters[T]),!0):!1}(a,n):void Ln(19439)}function s7(a){return a instanceof ea?function(i){return`${i.field.canonicalString()} ${i.op} ${Fv(i.value)}`}(a):a instanceof bd?function(i){return i.op.toString()+" {"+i.getFilters().map(s7).join(" ,")+"}"}(a):"Filter"}class hge extends ea{constructor(n,i,s){super(n,i,s),this.key=En.fromName(s.referenceValue)}matches(n){const i=En.comparator(n.key,this.key);return this.matchesComparison(i)}}class pge extends ea{constructor(n,i){super(n,"in",i),this.keys=a7("in",i)}matches(n){return this.keys.some(i=>i.isEqual(n.key))}}class fge extends ea{constructor(n,i){super(n,"not-in",i),this.keys=a7("not-in",i)}matches(n){return!this.keys.some(i=>i.isEqual(n.key))}}function a7(a,n){var i;return(((i=n.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(s=>En.fromName(s.referenceValue))}class mge extends ea{constructor(n,i){super(n,"array-contains",i)}matches(n){const i=n.data.field(this.field);return lj(i)&&oR(i.arrayValue,this.value)}}class gge extends ea{constructor(n,i){super(n,"in",i)}matches(n){const i=n.data.field(this.field);return i!==null&&oR(this.value.arrayValue,i)}}class _ge extends ea{constructor(n,i){super(n,"not-in",i)}matches(n){if(oR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=n.data.field(this.field);return i!==null&&i.nullValue===void 0&&!oR(this.value.arrayValue,i)}}class Ege extends ea{constructor(n,i){super(n,"array-contains-any",i)}matches(n){const i=n.data.field(this.field);return!(!lj(i)||!i.arrayValue.values)&&i.arrayValue.values.some(s=>oR(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yge{constructor(n,i=null,s=[],l=[],p=null,_=null,T=null){this.path=n,this.collectionGroup=i,this.orderBy=s,this.filters=l,this.limit=p,this.startAt=_,this.endAt=T,this.Ie=null}}function ez(a,n=null,i=[],s=[],l=null,p=null,_=null){return new yge(a,n,i,s,l,p,_)}function dj(a){const n=zn(a);if(n.Ie===null){let i=n.path.canonicalString();n.collectionGroup!==null&&(i+="|cg:"+n.collectionGroup),i+="|f:",i+=n.filters.map(s=>d2(s)).join(","),i+="|ob:",i+=n.orderBy.map(s=>function(p){return p.field.canonicalString()+p.dir}(s)).join(","),gD(n.limit)||(i+="|l:",i+=n.limit),n.startAt&&(i+="|lb:",i+=n.startAt.inclusive?"b:":"a:",i+=n.startAt.position.map(s=>Fv(s)).join(",")),n.endAt&&(i+="|ub:",i+=n.endAt.inclusive?"a:":"b:",i+=n.endAt.position.map(s=>Fv(s)).join(",")),n.Ie=i}return n.Ie}function uj(a,n){if(a.limit!==n.limit||a.orderBy.length!==n.orderBy.length)return!1;for(let i=0;i<a.orderBy.length;i++)if(!dge(a.orderBy[i],n.orderBy[i]))return!1;if(a.filters.length!==n.filters.length)return!1;for(let i=0;i<a.filters.length;i++)if(!i7(a.filters[i],n.filters[i]))return!1;return a.collectionGroup===n.collectionGroup&&!!a.path.isEqual(n.path)&&!!Z8(a.startAt,n.startAt)&&Z8(a.endAt,n.endAt)}function u2(a){return En.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oS{constructor(n,i=null,s=[],l=[],p=null,_="F",T=null,w=null){this.path=n,this.collectionGroup=i,this.explicitOrderBy=s,this.filters=l,this.limit=p,this.limitType=_,this.startAt=T,this.endAt=w,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function vge(a,n,i,s,l,p,_,T){return new oS(a,n,i,s,l,p,_,T)}function hj(a){return new oS(a)}function tz(a){return a.filters.length===0&&a.limit===null&&a.startAt==null&&a.endAt==null&&(a.explicitOrderBy.length===0||a.explicitOrderBy.length===1&&a.explicitOrderBy[0].field.isKeyField())}function o7(a){return a.collectionGroup!==null}function qw(a){const n=zn(a);if(n.Ee===null){n.Ee=[];const i=new Set;for(const p of n.explicitOrderBy)n.Ee.push(p),i.add(p.field.canonicalString());const s=n.explicitOrderBy.length>0?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";(function(_){let T=new da(Ba.comparator);return _.filters.forEach(w=>{w.getFlattenedFilters().forEach(C=>{C.isInequality()&&(T=T.add(C.field))})}),T})(n).forEach(p=>{i.has(p.canonicalString())||p.isKeyField()||n.Ee.push(new cR(p,s))}),i.has(Ba.keyField().canonicalString())||n.Ee.push(new cR(Ba.keyField(),s))}return n.Ee}function ju(a){const n=zn(a);return n.de||(n.de=Sge(n,qw(a))),n.de}function Sge(a,n){if(a.limitType==="F")return ez(a.path,a.collectionGroup,n,a.filters,a.limit,a.startAt,a.endAt);{n=n.map(l=>{const p=l.dir==="desc"?"asc":"desc";return new cR(l.field,p)});const i=a.endAt?new IO(a.endAt.position,a.endAt.inclusive):null,s=a.startAt?new IO(a.startAt.position,a.startAt.inclusive):null;return ez(a.path,a.collectionGroup,n,a.filters,a.limit,i,s)}}function h2(a,n){const i=a.filters.concat([n]);return new oS(a.path,a.collectionGroup,a.explicitOrderBy.slice(),i,a.limit,a.limitType,a.startAt,a.endAt)}function p2(a,n,i){return new oS(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),n,i,a.startAt,a.endAt)}function ED(a,n){return uj(ju(a),ju(n))&&a.limitType===n.limitType}function c7(a){return`${dj(ju(a))}|lt:${a.limitType}`}function Tv(a){return`Query(target=${function(i){let s=i.path.canonicalString();return i.collectionGroup!==null&&(s+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(s+=`, filters: [${i.filters.map(l=>s7(l)).join(", ")}]`),gD(i.limit)||(s+=", limit: "+i.limit),i.orderBy.length>0&&(s+=`, orderBy: [${i.orderBy.map(l=>function(_){return`${_.field.canonicalString()} (${_.dir})`}(l)).join(", ")}]`),i.startAt&&(s+=", startAt: ",s+=i.startAt.inclusive?"b:":"a:",s+=i.startAt.position.map(l=>Fv(l)).join(",")),i.endAt&&(s+=", endAt: ",s+=i.endAt.inclusive?"a:":"b:",s+=i.endAt.position.map(l=>Fv(l)).join(",")),`Target(${s})`}(ju(a))}; limitType=${a.limitType})`}function yD(a,n){return n.isFoundDocument()&&function(s,l){const p=l.key.path;return s.collectionGroup!==null?l.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(p):En.isDocumentKey(s.path)?s.path.isEqual(p):s.path.isImmediateParentOf(p)}(a,n)&&function(s,l){for(const p of qw(s))if(!p.field.isKeyField()&&l.data.field(p.field)===null)return!1;return!0}(a,n)&&function(s,l){for(const p of s.filters)if(!p.matches(l))return!1;return!0}(a,n)&&function(s,l){return!(s.startAt&&!function(_,T,w){const C=J8(_,T,w);return _.inclusive?C<=0:C<0}(s.startAt,qw(s),l)||s.endAt&&!function(_,T,w){const C=J8(_,T,w);return _.inclusive?C>=0:C>0}(s.endAt,qw(s),l))}(a,n)}function Tge(a){return a.collectionGroup||(a.path.length%2==1?a.path.lastSegment():a.path.get(a.path.length-2))}function l7(a){return(n,i)=>{let s=!1;for(const l of qw(a)){const p=bge(l,n,i);if(p!==0)return p;s=s||l.field.isKeyField()}return 0}}function bge(a,n,i){const s=a.field.isKeyField()?En.comparator(n.key,i.key):function(p,_,T){const w=_.data.field(p),C=T.data.field(p);return w!==null&&C!==null?Vv(w,C):Ln(42886)}(a.field,n,i);switch(a.dir){case"asc":return s;case"desc":return-1*s;default:return Ln(19790,{direction:a.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j_{constructor(n,i){this.mapKeyFn=n,this.equalsFn=i,this.inner={},this.innerSize=0}get(n){const i=this.mapKeyFn(n),s=this.inner[i];if(s!==void 0){for(const[l,p]of s)if(this.equalsFn(l,n))return p}}has(n){return this.get(n)!==void 0}set(n,i){const s=this.mapKeyFn(n),l=this.inner[s];if(l===void 0)return this.inner[s]=[[n,i]],void this.innerSize++;for(let p=0;p<l.length;p++)if(this.equalsFn(l[p][0],n))return void(l[p]=[n,i]);l.push([n,i]),this.innerSize++}delete(n){const i=this.mapKeyFn(n),s=this.inner[i];if(s===void 0)return!1;for(let l=0;l<s.length;l++)if(this.equalsFn(s[l][0],n))return s.length===1?delete this.inner[i]:s.splice(l,1),this.innerSize--,!0;return!1}forEach(n){am(this.inner,(i,s)=>{for(const[l,p]of s)n(l,p)})}isEmpty(){return YK(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wge=new ls(En.comparator);function pp(){return wge}const d7=new ls(En.comparator);function Dw(...a){let n=d7;for(const i of a)n=n.insert(i.key,i);return n}function u7(a){let n=d7;return a.forEach((i,s)=>n=n.insert(i,s.overlayedDocument)),n}function m_(){return Kw()}function h7(){return Kw()}function Kw(){return new j_(a=>a.toString(),(a,n)=>a.isEqual(n))}const Rge=new ls(En.comparator),Cge=new da(En.comparator);function wr(...a){let n=Cge;for(const i of a)n=n.add(i);return n}const Age=new da(pr);function Ige(){return Age}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pj(a,n){if(a.useProto3Json){if(isNaN(n))return{doubleValue:"NaN"};if(n===1/0)return{doubleValue:"Infinity"};if(n===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:RO(n)?"-0":n}}function p7(a){return{integerValue:""+a}}function Nge(a,n){return nge(n)?p7(n):pj(a,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vD{constructor(){this._=void 0}}function Oge(a,n,i){return a instanceof NO?function(l,p){const _={fields:{[XK]:{stringValue:KK},[$K]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return p&&cj(p)&&(p=_D(p)),p&&(_.fields[QK]=p),{mapValue:_}}(i,n):a instanceof lR?m7(a,n):a instanceof dR?g7(a,n):function(l,p){const _=f7(l,p),T=nz(_)+nz(l.Re);return l2(_)&&l2(l.Re)?p7(T):pj(l.serializer,T)}(a,n)}function Dge(a,n,i){return a instanceof lR?m7(a,n):a instanceof dR?g7(a,n):i}function f7(a,n){return a instanceof OO?function(s){return l2(s)||function(p){return!!p&&"doubleValue"in p}(s)}(n)?n:{integerValue:0}:null}class NO extends vD{}class lR extends vD{constructor(n){super(),this.elements=n}}function m7(a,n){const i=_7(n);for(const s of a.elements)i.some(l=>Fu(l,s))||i.push(s);return{arrayValue:{values:i}}}class dR extends vD{constructor(n){super(),this.elements=n}}function g7(a,n){let i=_7(n);for(const s of a.elements)i=i.filter(l=>!Fu(l,s));return{arrayValue:{values:i}}}class OO extends vD{constructor(n,i){super(),this.serializer=n,this.Re=i}}function nz(a){return js(a.integerValue||a.doubleValue)}function _7(a){return lj(a)&&a.arrayValue.values?a.arrayValue.values.slice():[]}function xge(a,n){return a.field.isEqual(n.field)&&function(s,l){return s instanceof lR&&l instanceof lR||s instanceof dR&&l instanceof dR?Uv(s.elements,l.elements,Fu):s instanceof OO&&l instanceof OO?Fu(s.Re,l.Re):s instanceof NO&&l instanceof NO}(a.transform,n.transform)}class Pge{constructor(n,i){this.version=n,this.transformResults=i}}class Pl{constructor(n,i){this.updateTime=n,this.exists=i}static none(){return new Pl}static exists(n){return new Pl(void 0,n)}static updateTime(n){return new Pl(n)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(n){return this.exists===n.exists&&(this.updateTime?!!n.updateTime&&this.updateTime.isEqual(n.updateTime):!n.updateTime)}}function JN(a,n){return a.updateTime!==void 0?n.isFoundDocument()&&n.version.isEqual(a.updateTime):a.exists===void 0||a.exists===n.isFoundDocument()}class SD{}function E7(a,n){if(!a.hasLocalMutations||n&&n.fields.length===0)return null;if(n===null)return a.isNoDocument()?new fj(a.key,Pl.none()):new TR(a.key,a.data,Pl.none());{const i=a.data,s=lc.empty();let l=new da(Ba.comparator);for(let p of n.fields)if(!l.has(p)){let _=i.field(p);_===null&&p.length>1&&(p=p.popLast(),_=i.field(p)),_===null?s.delete(p):s.set(p,_),l=l.add(p)}return new om(a.key,s,new jc(l.toArray()),Pl.none())}}function kge(a,n,i){a instanceof TR?function(l,p,_){const T=l.value.clone(),w=iz(l.fieldTransforms,p,_.transformResults);T.setAll(w),p.convertToFoundDocument(_.version,T).setHasCommittedMutations()}(a,n,i):a instanceof om?function(l,p,_){if(!JN(l.precondition,p))return void p.convertToUnknownDocument(_.version);const T=iz(l.fieldTransforms,p,_.transformResults),w=p.data;w.setAll(y7(l)),w.setAll(T),p.convertToFoundDocument(_.version,w).setHasCommittedMutations()}(a,n,i):function(l,p,_){p.convertToNoDocument(_.version).setHasCommittedMutations()}(0,n,i)}function Xw(a,n,i,s){return a instanceof TR?function(p,_,T,w){if(!JN(p.precondition,_))return T;const C=p.value.clone(),O=sz(p.fieldTransforms,w,_);return C.setAll(O),_.convertToFoundDocument(_.version,C).setHasLocalMutations(),null}(a,n,i,s):a instanceof om?function(p,_,T,w){if(!JN(p.precondition,_))return T;const C=sz(p.fieldTransforms,w,_),O=_.data;return O.setAll(y7(p)),O.setAll(C),_.convertToFoundDocument(_.version,O).setHasLocalMutations(),T===null?null:T.unionWith(p.fieldMask.fields).unionWith(p.fieldTransforms.map(k=>k.field))}(a,n,i,s):function(p,_,T){return JN(p.precondition,_)?(_.convertToNoDocument(_.version).setHasLocalMutations(),null):T}(a,n,i)}function Lge(a,n){let i=null;for(const s of a.fieldTransforms){const l=n.data.field(s.field),p=f7(s.transform,l||null);p!=null&&(i===null&&(i=lc.empty()),i.set(s.field,p))}return i||null}function rz(a,n){return a.type===n.type&&!!a.key.isEqual(n.key)&&!!a.precondition.isEqual(n.precondition)&&!!function(s,l){return s===void 0&&l===void 0||!(!s||!l)&&Uv(s,l,(p,_)=>xge(p,_))}(a.fieldTransforms,n.fieldTransforms)&&(a.type===0?a.value.isEqual(n.value):a.type!==1||a.data.isEqual(n.data)&&a.fieldMask.isEqual(n.fieldMask))}class TR extends SD{constructor(n,i,s,l=[]){super(),this.key=n,this.value=i,this.precondition=s,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class om extends SD{constructor(n,i,s,l,p=[]){super(),this.key=n,this.data=i,this.fieldMask=s,this.precondition=l,this.fieldTransforms=p,this.type=1}getFieldMask(){return this.fieldMask}}function y7(a){const n=new Map;return a.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const s=a.data.field(i);n.set(i,s)}}),n}function iz(a,n,i){const s=new Map;si(a.length===i.length,32656,{Ve:i.length,me:a.length});for(let l=0;l<i.length;l++){const p=a[l],_=p.transform,T=n.data.field(p.field);s.set(p.field,Dge(_,T,i[l]))}return s}function sz(a,n,i){const s=new Map;for(const l of a){const p=l.transform,_=i.data.field(l.field);s.set(l.field,Oge(p,_,n))}return s}class fj extends SD{constructor(n,i){super(),this.key=n,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Mge extends SD{constructor(n,i){super(),this.key=n,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jge{constructor(n,i,s,l){this.batchId=n,this.localWriteTime=i,this.baseMutations=s,this.mutations=l}applyToRemoteDocument(n,i){const s=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const p=this.mutations[l];p.key.isEqual(n.key)&&kge(p,n,s[l])}}applyToLocalView(n,i){for(const s of this.baseMutations)s.key.isEqual(n.key)&&(i=Xw(s,n,i,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(n.key)&&(i=Xw(s,n,i,this.localWriteTime));return i}applyToLocalDocumentSet(n,i){const s=h7();return this.mutations.forEach(l=>{const p=n.get(l.key),_=p.overlayedDocument;let T=this.applyToLocalView(_,p.mutatedFields);T=i.has(l.key)?null:T;const w=E7(_,T);w!==null&&s.set(l.key,w),_.isValidDocument()||_.convertToNoDocument(Gn.min())}),s}keys(){return this.mutations.reduce((n,i)=>n.add(i.key),wr())}isEqual(n){return this.batchId===n.batchId&&Uv(this.mutations,n.mutations,(i,s)=>rz(i,s))&&Uv(this.baseMutations,n.baseMutations,(i,s)=>rz(i,s))}}class mj{constructor(n,i,s,l){this.batch=n,this.commitVersion=i,this.mutationResults=s,this.docVersions=l}static from(n,i,s){si(n.mutations.length===s.length,58842,{fe:n.mutations.length,ge:s.length});let l=function(){return Rge}();const p=n.mutations;for(let _=0;_<p.length;_++)l=l.insert(p[_].key,s[_].version);return new mj(n,i,s,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uge{constructor(n,i){this.largestBatchId=n,this.mutation=i}getKey(){return this.mutation.key}isEqual(n){return n!==null&&this.mutation===n.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vge{constructor(n,i){this.count=n,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Zs,kr;function Fge(a){switch(a){case Et.OK:return Ln(64938);case Et.CANCELLED:case Et.UNKNOWN:case Et.DEADLINE_EXCEEDED:case Et.RESOURCE_EXHAUSTED:case Et.INTERNAL:case Et.UNAVAILABLE:case Et.UNAUTHENTICATED:return!1;case Et.INVALID_ARGUMENT:case Et.NOT_FOUND:case Et.ALREADY_EXISTS:case Et.PERMISSION_DENIED:case Et.FAILED_PRECONDITION:case Et.ABORTED:case Et.OUT_OF_RANGE:case Et.UNIMPLEMENTED:case Et.DATA_LOSS:return!0;default:return Ln(15467,{code:a})}}function v7(a){if(a===void 0)return hp("GRPC error has no .code"),Et.UNKNOWN;switch(a){case Zs.OK:return Et.OK;case Zs.CANCELLED:return Et.CANCELLED;case Zs.UNKNOWN:return Et.UNKNOWN;case Zs.DEADLINE_EXCEEDED:return Et.DEADLINE_EXCEEDED;case Zs.RESOURCE_EXHAUSTED:return Et.RESOURCE_EXHAUSTED;case Zs.INTERNAL:return Et.INTERNAL;case Zs.UNAVAILABLE:return Et.UNAVAILABLE;case Zs.UNAUTHENTICATED:return Et.UNAUTHENTICATED;case Zs.INVALID_ARGUMENT:return Et.INVALID_ARGUMENT;case Zs.NOT_FOUND:return Et.NOT_FOUND;case Zs.ALREADY_EXISTS:return Et.ALREADY_EXISTS;case Zs.PERMISSION_DENIED:return Et.PERMISSION_DENIED;case Zs.FAILED_PRECONDITION:return Et.FAILED_PRECONDITION;case Zs.ABORTED:return Et.ABORTED;case Zs.OUT_OF_RANGE:return Et.OUT_OF_RANGE;case Zs.UNIMPLEMENTED:return Et.UNIMPLEMENTED;case Zs.DATA_LOSS:return Et.DATA_LOSS;default:return Ln(39323,{code:a})}}(kr=Zs||(Zs={}))[kr.OK=0]="OK",kr[kr.CANCELLED=1]="CANCELLED",kr[kr.UNKNOWN=2]="UNKNOWN",kr[kr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",kr[kr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",kr[kr.NOT_FOUND=5]="NOT_FOUND",kr[kr.ALREADY_EXISTS=6]="ALREADY_EXISTS",kr[kr.PERMISSION_DENIED=7]="PERMISSION_DENIED",kr[kr.UNAUTHENTICATED=16]="UNAUTHENTICATED",kr[kr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",kr[kr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",kr[kr.ABORTED=10]="ABORTED",kr[kr.OUT_OF_RANGE=11]="OUT_OF_RANGE",kr[kr.UNIMPLEMENTED=12]="UNIMPLEMENTED",kr[kr.INTERNAL=13]="INTERNAL",kr[kr.UNAVAILABLE=14]="UNAVAILABLE",kr[kr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bge=new Yf([4294967295,4294967295],0);function az(a){const n=GK().encode(a),i=new LK;return i.update(n),new Uint8Array(i.digest())}function oz(a){const n=new DataView(a.buffer),i=n.getUint32(0,!0),s=n.getUint32(4,!0),l=n.getUint32(8,!0),p=n.getUint32(12,!0);return[new Yf([i,s],0),new Yf([l,p],0)]}class gj{constructor(n,i,s){if(this.bitmap=n,this.padding=i,this.hashCount=s,i<0||i>=8)throw new xw(`Invalid padding: ${i}`);if(s<0)throw new xw(`Invalid hash count: ${s}`);if(n.length>0&&this.hashCount===0)throw new xw(`Invalid hash count: ${s}`);if(n.length===0&&i!==0)throw new xw(`Invalid padding when bitmap length is 0: ${i}`);this.pe=8*n.length-i,this.ye=Yf.fromNumber(this.pe)}we(n,i,s){let l=n.add(i.multiply(Yf.fromNumber(s)));return l.compare(Bge)===1&&(l=new Yf([l.getBits(0),l.getBits(1)],0)),l.modulo(this.ye).toNumber()}be(n){return!!(this.bitmap[Math.floor(n/8)]&1<<n%8)}mightContain(n){if(this.pe===0)return!1;const i=az(n),[s,l]=oz(i);for(let p=0;p<this.hashCount;p++){const _=this.we(s,l,p);if(!this.be(_))return!1}return!0}static create(n,i,s){const l=n%8==0?0:8-n%8,p=new Uint8Array(Math.ceil(n/8)),_=new gj(p,l,i);return s.forEach(T=>_.insert(T)),_}insert(n){if(this.pe===0)return;const i=az(n),[s,l]=oz(i);for(let p=0;p<this.hashCount;p++){const _=this.we(s,l,p);this.Se(_)}}Se(n){const i=Math.floor(n/8),s=n%8;this.bitmap[i]|=1<<s}}class xw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TD{constructor(n,i,s,l,p){this.snapshotVersion=n,this.targetChanges=i,this.targetMismatches=s,this.documentUpdates=l,this.resolvedLimboDocuments=p}static createSynthesizedRemoteEventForCurrentChange(n,i,s){const l=new Map;return l.set(n,bR.createSynthesizedTargetChangeForCurrentChange(n,i,s)),new TD(Gn.min(),l,new ls(pr),pp(),wr())}}class bR{constructor(n,i,s,l,p){this.resumeToken=n,this.current=i,this.addedDocuments=s,this.modifiedDocuments=l,this.removedDocuments=p}static createSynthesizedTargetChangeForCurrentChange(n,i,s){return new bR(s,i,wr(),wr(),wr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZN{constructor(n,i,s,l){this.De=n,this.removedTargetIds=i,this.key=s,this.ve=l}}class S7{constructor(n,i){this.targetId=n,this.Ce=i}}class T7{constructor(n,i,s=Ha.EMPTY_BYTE_STRING,l=null){this.state=n,this.targetIds=i,this.resumeToken=s,this.cause=l}}class cz{constructor(){this.Fe=0,this.Me=lz(),this.xe=Ha.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(n){n.approximateByteSize()>0&&(this.Ne=!0,this.xe=n)}qe(){let n=wr(),i=wr(),s=wr();return this.Me.forEach((l,p)=>{switch(p){case 0:n=n.add(l);break;case 2:i=i.add(l);break;case 1:s=s.add(l);break;default:Ln(38017,{changeType:p})}}),new bR(this.xe,this.Oe,n,i,s)}Qe(){this.Ne=!1,this.Me=lz()}$e(n,i){this.Ne=!0,this.Me=this.Me.insert(n,i)}Ue(n){this.Ne=!0,this.Me=this.Me.remove(n)}Ke(){this.Fe+=1}We(){this.Fe-=1,si(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class Hge{constructor(n){this.ze=n,this.je=new Map,this.He=pp(),this.Je=nN(),this.Ye=nN(),this.Ze=new ls(pr)}Xe(n){for(const i of n.De)n.ve&&n.ve.isFoundDocument()?this.et(i,n.ve):this.tt(i,n.key,n.ve);for(const i of n.removedTargetIds)this.tt(i,n.key,n.ve)}nt(n){this.forEachTarget(n,i=>{const s=this.rt(i);switch(n.state){case 0:this.it(i)&&s.ke(n.resumeToken);break;case 1:s.We(),s.Be||s.Qe(),s.ke(n.resumeToken);break;case 2:s.We(),s.Be||this.removeTarget(i);break;case 3:this.it(i)&&(s.Ge(),s.ke(n.resumeToken));break;case 4:this.it(i)&&(this.st(i),s.ke(n.resumeToken));break;default:Ln(56790,{state:n.state})}})}forEachTarget(n,i){n.targetIds.length>0?n.targetIds.forEach(i):this.je.forEach((s,l)=>{this.it(l)&&i(l)})}ot(n){const i=n.targetId,s=n.Ce.count,l=this._t(i);if(l){const p=l.target;if(u2(p))if(s===0){const _=new En(p.path);this.tt(i,_,lo.newNoDocument(_,Gn.min()))}else si(s===1,20013,{expectedCount:s});else{const _=this.ut(i);if(_!==s){const T=this.ct(n),w=T?this.lt(T,n,_):1;if(w!==0){this.st(i);const C=w===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(i,C)}}}}}ct(n){const i=n.Ce.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:s="",padding:l=0},hashCount:p=0}=i;let _,T;try{_=Zf(s).toUint8Array()}catch(w){if(w instanceof qK)return jv("Decoding the base64 bloom filter in existence filter failed ("+w.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw w}try{T=new gj(_,l,p)}catch(w){return jv(w instanceof xw?"BloomFilter error: ":"Applying bloom filter failed: ",w),null}return T.pe===0?null:T}lt(n,i,s){return i.Ce.count===s-this.Tt(n,i.targetId)?0:2}Tt(n,i){const s=this.ze.getRemoteKeysForTarget(i);let l=0;return s.forEach(p=>{const _=this.ze.Pt(),T=`projects/${_.projectId}/databases/${_.database}/documents/${p.path.canonicalString()}`;n.mightContain(T)||(this.tt(i,p,null),l++)}),l}It(n){const i=new Map;this.je.forEach((p,_)=>{const T=this._t(_);if(T){if(p.current&&u2(T.target)){const w=new En(T.target.path);this.Et(w).has(_)||this.dt(_,w)||this.tt(_,w,lo.newNoDocument(w,n))}p.Le&&(i.set(_,p.qe()),p.Qe())}});let s=wr();this.Ye.forEach((p,_)=>{let T=!0;_.forEachWhile(w=>{const C=this._t(w);return!C||C.purpose==="TargetPurposeLimboResolution"||(T=!1,!1)}),T&&(s=s.add(p))}),this.He.forEach((p,_)=>_.setReadTime(n));const l=new TD(n,i,this.Ze,this.He,s);return this.He=pp(),this.Je=nN(),this.Ye=nN(),this.Ze=new ls(pr),l}et(n,i){if(!this.it(n))return;const s=this.dt(n,i.key)?2:0;this.rt(n).$e(i.key,s),this.He=this.He.insert(i.key,i),this.Je=this.Je.insert(i.key,this.Et(i.key).add(n)),this.Ye=this.Ye.insert(i.key,this.At(i.key).add(n))}tt(n,i,s){if(!this.it(n))return;const l=this.rt(n);this.dt(n,i)?l.$e(i,1):l.Ue(i),this.Ye=this.Ye.insert(i,this.At(i).delete(n)),this.Ye=this.Ye.insert(i,this.At(i).add(n)),s&&(this.He=this.He.insert(i,s))}removeTarget(n){this.je.delete(n)}ut(n){const i=this.rt(n).qe();return this.ze.getRemoteKeysForTarget(n).size+i.addedDocuments.size-i.removedDocuments.size}Ke(n){this.rt(n).Ke()}rt(n){let i=this.je.get(n);return i||(i=new cz,this.je.set(n,i)),i}At(n){let i=this.Ye.get(n);return i||(i=new da(pr),this.Ye=this.Ye.insert(n,i)),i}Et(n){let i=this.Je.get(n);return i||(i=new da(pr),this.Je=this.Je.insert(n,i)),i}it(n){const i=this._t(n)!==null;return i||Xt("WatchChangeAggregator","Detected inactive target",n),i}_t(n){const i=this.je.get(n);return i&&i.Be?null:this.ze.Rt(n)}st(n){this.je.set(n,new cz),this.ze.getRemoteKeysForTarget(n).forEach(i=>{this.tt(n,i,null)})}dt(n,i){return this.ze.getRemoteKeysForTarget(n).has(i)}}function nN(){return new ls(En.comparator)}function lz(){return new ls(En.comparator)}const Gge={asc:"ASCENDING",desc:"DESCENDING"},Wge={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},zge={and:"AND",or:"OR"};class Yge{constructor(n,i){this.databaseId=n,this.useProto3Json=i}}function f2(a,n){return a.useProto3Json||gD(n)?n:{value:n}}function DO(a,n){return a.useProto3Json?`${new Date(1e3*n.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+n.nanoseconds).slice(-9)}Z`:{seconds:""+n.seconds,nanos:n.nanoseconds}}function b7(a,n){return a.useProto3Json?n.toBase64():n.toUint8Array()}function qge(a,n){return DO(a,n.toTimestamp())}function Uu(a){return si(!!a,49232),Gn.fromTimestamp(function(i){const s=Jf(i);return new la(s.seconds,s.nanos)}(a))}function _j(a,n){return m2(a,n).canonicalString()}function m2(a,n){const i=function(l){return new Gi(["projects",l.projectId,"databases",l.database])}(a).child("documents");return n===void 0?i:i.child(n)}function w7(a){const n=Gi.fromString(a);return si(N7(n),10190,{key:n.toString()}),n}function g2(a,n){return _j(a.databaseId,n.path)}function iM(a,n){const i=w7(n);if(i.get(1)!==a.databaseId.projectId)throw new Qt(Et.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+a.databaseId.projectId);if(i.get(3)!==a.databaseId.database)throw new Qt(Et.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+a.databaseId.database);return new En(C7(i))}function R7(a,n){return _j(a.databaseId,n)}function Kge(a){const n=w7(a);return n.length===4?Gi.emptyPath():C7(n)}function _2(a){return new Gi(["projects",a.databaseId.projectId,"databases",a.databaseId.database]).canonicalString()}function C7(a){return si(a.length>4&&a.get(4)==="documents",29091,{key:a.toString()}),a.popFirst(5)}function dz(a,n,i){return{name:g2(a,n),fields:i.value.mapValue.fields}}function Xge(a,n){let i;if("targetChange"in n){n.targetChange;const s=function(C){return C==="NO_CHANGE"?0:C==="ADD"?1:C==="REMOVE"?2:C==="CURRENT"?3:C==="RESET"?4:Ln(39313,{state:C})}(n.targetChange.targetChangeType||"NO_CHANGE"),l=n.targetChange.targetIds||[],p=function(C,O){return C.useProto3Json?(si(O===void 0||typeof O=="string",58123),Ha.fromBase64String(O||"")):(si(O===void 0||O instanceof Buffer||O instanceof Uint8Array,16193),Ha.fromUint8Array(O||new Uint8Array))}(a,n.targetChange.resumeToken),_=n.targetChange.cause,T=_&&function(C){const O=C.code===void 0?Et.UNKNOWN:v7(C.code);return new Qt(O,C.message||"")}(_);i=new T7(s,l,p,T||null)}else if("documentChange"in n){n.documentChange;const s=n.documentChange;s.document,s.document.name,s.document.updateTime;const l=iM(a,s.document.name),p=Uu(s.document.updateTime),_=s.document.createTime?Uu(s.document.createTime):Gn.min(),T=new lc({mapValue:{fields:s.document.fields}}),w=lo.newFoundDocument(l,p,_,T),C=s.targetIds||[],O=s.removedTargetIds||[];i=new ZN(C,O,w.key,w)}else if("documentDelete"in n){n.documentDelete;const s=n.documentDelete;s.document;const l=iM(a,s.document),p=s.readTime?Uu(s.readTime):Gn.min(),_=lo.newNoDocument(l,p),T=s.removedTargetIds||[];i=new ZN([],T,_.key,_)}else if("documentRemove"in n){n.documentRemove;const s=n.documentRemove;s.document;const l=iM(a,s.document),p=s.removedTargetIds||[];i=new ZN([],p,l,null)}else{if(!("filter"in n))return Ln(11601,{Vt:n});{n.filter;const s=n.filter;s.targetId;const{count:l=0,unchangedNames:p}=s,_=new Vge(l,p),T=s.targetId;i=new S7(T,_)}}return i}function Qge(a,n){let i;if(n instanceof TR)i={update:dz(a,n.key,n.value)};else if(n instanceof fj)i={delete:g2(a,n.key)};else if(n instanceof om)i={update:dz(a,n.key,n.data),updateMask:s_e(n.fieldMask)};else{if(!(n instanceof Mge))return Ln(16599,{ft:n.type});i={verify:g2(a,n.key)}}return n.fieldTransforms.length>0&&(i.updateTransforms=n.fieldTransforms.map(s=>function(p,_){const T=_.transform;if(T instanceof NO)return{fieldPath:_.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(T instanceof lR)return{fieldPath:_.field.canonicalString(),appendMissingElements:{values:T.elements}};if(T instanceof dR)return{fieldPath:_.field.canonicalString(),removeAllFromArray:{values:T.elements}};if(T instanceof OO)return{fieldPath:_.field.canonicalString(),increment:T.Re};throw Ln(20930,{transform:_.transform})}(0,s))),n.precondition.isNone||(i.currentDocument=function(l,p){return p.updateTime!==void 0?{updateTime:qge(l,p.updateTime)}:p.exists!==void 0?{exists:p.exists}:Ln(27497)}(a,n.precondition)),i}function $ge(a,n){return a&&a.length>0?(si(n!==void 0,14353),a.map(i=>function(l,p){let _=l.updateTime?Uu(l.updateTime):Uu(p);return _.isEqual(Gn.min())&&(_=Uu(p)),new Pge(_,l.transformResults||[])}(i,n))):[]}function Jge(a,n){return{documents:[R7(a,n.path)]}}function Zge(a,n){const i={structuredQuery:{}},s=n.path;let l;n.collectionGroup!==null?(l=s,i.structuredQuery.from=[{collectionId:n.collectionGroup,allDescendants:!0}]):(l=s.popLast(),i.structuredQuery.from=[{collectionId:s.lastSegment()}]),i.parent=R7(a,l);const p=function(C){if(C.length!==0)return I7(bd.create(C,"and"))}(n.filters);p&&(i.structuredQuery.where=p);const _=function(C){if(C.length!==0)return C.map(O=>function(U){return{field:bv(U.field),direction:n_e(U.dir)}}(O))}(n.orderBy);_&&(i.structuredQuery.orderBy=_);const T=f2(a,n.limit);return T!==null&&(i.structuredQuery.limit=T),n.startAt&&(i.structuredQuery.startAt=function(C){return{before:C.inclusive,values:C.position}}(n.startAt)),n.endAt&&(i.structuredQuery.endAt=function(C){return{before:!C.inclusive,values:C.position}}(n.endAt)),{gt:i,parent:l}}function e_e(a){let n=Kge(a.parent);const i=a.structuredQuery,s=i.from?i.from.length:0;let l=null;if(s>0){si(s===1,65062);const O=i.from[0];O.allDescendants?l=O.collectionId:n=n.child(O.collectionId)}let p=[];i.where&&(p=function(k){const U=A7(k);return U instanceof bd&&r7(U)?U.getFilters():[U]}(i.where));let _=[];i.orderBy&&(_=function(k){return k.map(U=>function(W){return new cR(wv(W.field),function(K){switch(K){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(W.direction))}(U))}(i.orderBy));let T=null;i.limit&&(T=function(k){let U;return U=typeof k=="object"?k.value:k,gD(U)?null:U}(i.limit));let w=null;i.startAt&&(w=function(k){const U=!!k.before,Y=k.values||[];return new IO(Y,U)}(i.startAt));let C=null;return i.endAt&&(C=function(k){const U=!k.before,Y=k.values||[];return new IO(Y,U)}(i.endAt)),vge(n,l,_,p,T,"F",w,C)}function t_e(a,n){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ln(28987,{purpose:l})}}(n.purpose);return i==null?null:{"goog-listen-tags":i}}function A7(a){return a.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const s=wv(i.unaryFilter.field);return ea.create(s,"==",{doubleValue:NaN});case"IS_NULL":const l=wv(i.unaryFilter.field);return ea.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const p=wv(i.unaryFilter.field);return ea.create(p,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const _=wv(i.unaryFilter.field);return ea.create(_,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ln(61313);default:return Ln(60726)}}(a):a.fieldFilter!==void 0?function(i){return ea.create(wv(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ln(58110);default:return Ln(50506)}}(i.fieldFilter.op),i.fieldFilter.value)}(a):a.compositeFilter!==void 0?function(i){return bd.create(i.compositeFilter.filters.map(s=>A7(s)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Ln(1026)}}(i.compositeFilter.op))}(a):Ln(30097,{filter:a})}function n_e(a){return Gge[a]}function r_e(a){return Wge[a]}function i_e(a){return zge[a]}function bv(a){return{fieldPath:a.canonicalString()}}function wv(a){return Ba.fromServerFormat(a.fieldPath)}function I7(a){return a instanceof ea?function(i){if(i.op==="=="){if($8(i.value))return{unaryFilter:{field:bv(i.field),op:"IS_NAN"}};if(Q8(i.value))return{unaryFilter:{field:bv(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if($8(i.value))return{unaryFilter:{field:bv(i.field),op:"IS_NOT_NAN"}};if(Q8(i.value))return{unaryFilter:{field:bv(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bv(i.field),op:r_e(i.op),value:i.value}}}(a):a instanceof bd?function(i){const s=i.getFilters().map(l=>I7(l));return s.length===1?s[0]:{compositeFilter:{op:i_e(i.op),filters:s}}}(a):Ln(54877,{filter:a})}function s_e(a){const n=[];return a.fields.forEach(i=>n.push(i.canonicalString())),{fieldPaths:n}}function N7(a){return a.length>=4&&a.get(0)==="projects"&&a.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(n,i,s,l,p=Gn.min(),_=Gn.min(),T=Ha.EMPTY_BYTE_STRING,w=null){this.target=n,this.targetId=i,this.purpose=s,this.sequenceNumber=l,this.snapshotVersion=p,this.lastLimboFreeSnapshotVersion=_,this.resumeToken=T,this.expectedCount=w}withSequenceNumber(n){return new Bf(this.target,this.targetId,this.purpose,n,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(n,i){return new Bf(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,n,null)}withExpectedCount(n){return new Bf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,n)}withLastLimboFreeSnapshotVersion(n){return new Bf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,n,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a_e{constructor(n){this.wt=n}}function o_e(a){const n=e_e({parent:a.parent,structuredQuery:a.structuredQuery});return a.limitType==="LAST"?p2(n,n.limit,"L"):n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c_e{constructor(){this.yn=new l_e}addToCollectionParentIndex(n,i){return this.yn.add(i),yt.resolve()}getCollectionParents(n,i){return yt.resolve(this.yn.getEntries(i))}addFieldIndex(n,i){return yt.resolve()}deleteFieldIndex(n,i){return yt.resolve()}deleteAllFieldIndexes(n){return yt.resolve()}createTargetIndexes(n,i){return yt.resolve()}getDocumentsMatchingTarget(n,i){return yt.resolve(null)}getIndexType(n,i){return yt.resolve(0)}getFieldIndexes(n,i){return yt.resolve([])}getNextCollectionGroupToUpdate(n){return yt.resolve(null)}getMinOffset(n,i){return yt.resolve($f.min())}getMinOffsetFromCollectionGroup(n,i){return yt.resolve($f.min())}updateCollectionGroup(n,i,s){return yt.resolve()}updateIndexEntries(n,i){return yt.resolve()}}class l_e{constructor(){this.index={}}add(n){const i=n.lastSegment(),s=n.popLast(),l=this.index[i]||new da(Gi.comparator),p=!l.has(s);return this.index[i]=l.add(s),p}has(n){const i=n.lastSegment(),s=n.popLast(),l=this.index[i];return l&&l.has(s)}getEntries(n){return(this.index[n]||new da(Gi.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uz={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},O7=41943040;class cc{static withCacheSize(n){return new cc(n,cc.DEFAULT_COLLECTION_PERCENTILE,cc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(n,i,s){this.cacheSizeCollectionThreshold=n,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */cc.DEFAULT_COLLECTION_PERCENTILE=10,cc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,cc.DEFAULT=new cc(O7,cc.DEFAULT_COLLECTION_PERCENTILE,cc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),cc.DISABLED=new cc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bv{constructor(n){this.nr=n}next(){return this.nr+=2,this.nr}static rr(){return new Bv(0)}static ir(){return new Bv(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hz="LruGarbageCollector",d_e=1048576;function pz([a,n],[i,s]){const l=pr(a,i);return l===0?pr(n,s):l}class u_e{constructor(n){this.cr=n,this.buffer=new da(pz),this.lr=0}hr(){return++this.lr}Pr(n){const i=[n,this.hr()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(i);else{const s=this.buffer.last();pz(i,s)<0&&(this.buffer=this.buffer.delete(s).add(i))}}get maxValue(){return this.buffer.last()[0]}}class h_e{constructor(n,i,s){this.garbageCollector=n,this.asyncQueue=i,this.localStore=s,this.Tr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ir(6e4)}stop(){this.Tr&&(this.Tr.cancel(),this.Tr=null)}get started(){return this.Tr!==null}Ir(n){Xt(hz,`Garbage collection scheduled in ${n}ms`),this.Tr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,async()=>{this.Tr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){aS(i)?Xt(hz,"Ignoring IndexedDB error during garbage collection: ",i):await sS(i)}await this.Ir(3e5)})}}class p_e{constructor(n,i){this.Er=n,this.params=i}calculateTargetCount(n,i){return this.Er.dr(n).next(s=>Math.floor(i/100*s))}nthSequenceNumber(n,i){if(i===0)return yt.resolve(mD.le);const s=new u_e(i);return this.Er.forEachTarget(n,l=>s.Pr(l.sequenceNumber)).next(()=>this.Er.Ar(n,l=>s.Pr(l))).next(()=>s.maxValue)}removeTargets(n,i,s){return this.Er.removeTargets(n,i,s)}removeOrphanedDocuments(n,i){return this.Er.removeOrphanedDocuments(n,i)}collect(n,i){return this.params.cacheSizeCollectionThreshold===-1?(Xt("LruGarbageCollector","Garbage collection skipped; disabled"),yt.resolve(uz)):this.getCacheSize(n).next(s=>s<this.params.cacheSizeCollectionThreshold?(Xt("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),uz):this.Rr(n,i))}getCacheSize(n){return this.Er.getCacheSize(n)}Rr(n,i){let s,l,p,_,T,w,C;const O=Date.now();return this.calculateTargetCount(n,this.params.percentileToCollect).next(k=>(k>this.params.maximumSequenceNumbersToCollect?(Xt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${k}`),l=this.params.maximumSequenceNumbersToCollect):l=k,_=Date.now(),this.nthSequenceNumber(n,l))).next(k=>(s=k,T=Date.now(),this.removeTargets(n,s,i))).next(k=>(p=k,w=Date.now(),this.removeOrphanedDocuments(n,s))).next(k=>(C=Date.now(),Sv()<=Lr.DEBUG&&Xt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${_-O}ms
	Determined least recently used ${l} in `+(T-_)+`ms
	Removed ${p} targets in `+(w-T)+`ms
	Removed ${k} documents in `+(C-w)+`ms
Total Duration: ${C-O}ms`),yt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:p,documentsRemoved:k})))}}function f_e(a,n){return new p_e(a,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m_e{constructor(){this.changes=new j_(n=>n.toString(),(n,i)=>n.isEqual(i)),this.changesApplied=!1}addEntry(n){this.assertNotApplied(),this.changes.set(n.key,n)}removeEntry(n,i){this.assertNotApplied(),this.changes.set(n,lo.newInvalidDocument(n).setReadTime(i))}getEntry(n,i){this.assertNotApplied();const s=this.changes.get(i);return s!==void 0?yt.resolve(s):this.getFromCache(n,i)}getEntries(n,i){return this.getAllFromCache(n,i)}apply(n){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(n)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g_e{constructor(n,i){this.overlayedDocument=n,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __e{constructor(n,i,s,l){this.remoteDocumentCache=n,this.mutationQueue=i,this.documentOverlayCache=s,this.indexManager=l}getDocument(n,i){let s=null;return this.documentOverlayCache.getOverlay(n,i).next(l=>(s=l,this.remoteDocumentCache.getEntry(n,i))).next(l=>(s!==null&&Xw(s.mutation,l,jc.empty(),la.now()),l))}getDocuments(n,i){return this.remoteDocumentCache.getEntries(n,i).next(s=>this.getLocalViewOfDocuments(n,s,wr()).next(()=>s))}getLocalViewOfDocuments(n,i,s=wr()){const l=m_();return this.populateOverlays(n,l,i).next(()=>this.computeViews(n,i,l,s).next(p=>{let _=Dw();return p.forEach((T,w)=>{_=_.insert(T,w.overlayedDocument)}),_}))}getOverlayedDocuments(n,i){const s=m_();return this.populateOverlays(n,s,i).next(()=>this.computeViews(n,i,s,wr()))}populateOverlays(n,i,s){const l=[];return s.forEach(p=>{i.has(p)||l.push(p)}),this.documentOverlayCache.getOverlays(n,l).next(p=>{p.forEach((_,T)=>{i.set(_,T)})})}computeViews(n,i,s,l){let p=pp();const _=Kw(),T=function(){return Kw()}();return i.forEach((w,C)=>{const O=s.get(C.key);l.has(C.key)&&(O===void 0||O.mutation instanceof om)?p=p.insert(C.key,C):O!==void 0?(_.set(C.key,O.mutation.getFieldMask()),Xw(O.mutation,C,O.mutation.getFieldMask(),la.now())):_.set(C.key,jc.empty())}),this.recalculateAndSaveOverlays(n,p).next(w=>(w.forEach((C,O)=>_.set(C,O)),i.forEach((C,O)=>{var k;return T.set(C,new g_e(O,(k=_.get(C))!==null&&k!==void 0?k:null))}),T))}recalculateAndSaveOverlays(n,i){const s=Kw();let l=new ls((_,T)=>_-T),p=wr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(n,i).next(_=>{for(const T of _)T.keys().forEach(w=>{const C=i.get(w);if(C===null)return;let O=s.get(w)||jc.empty();O=T.applyToLocalView(C,O),s.set(w,O);const k=(l.get(T.batchId)||wr()).add(w);l=l.insert(T.batchId,k)})}).next(()=>{const _=[],T=l.getReverseIterator();for(;T.hasNext();){const w=T.getNext(),C=w.key,O=w.value,k=h7();O.forEach(U=>{if(!p.has(U)){const Y=E7(i.get(U),s.get(U));Y!==null&&k.set(U,Y),p=p.add(U)}}),_.push(this.documentOverlayCache.saveOverlays(n,C,k))}return yt.waitFor(_)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(n,i){return this.remoteDocumentCache.getEntries(n,i).next(s=>this.recalculateAndSaveOverlays(n,s))}getDocumentsMatchingQuery(n,i,s,l){return function(_){return En.isDocumentKey(_.path)&&_.collectionGroup===null&&_.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(n,i.path):o7(i)?this.getDocumentsMatchingCollectionGroupQuery(n,i,s,l):this.getDocumentsMatchingCollectionQuery(n,i,s,l)}getNextDocuments(n,i,s,l){return this.remoteDocumentCache.getAllFromCollectionGroup(n,i,s,l).next(p=>{const _=l-p.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(n,i,s.largestBatchId,l-p.size):yt.resolve(m_());let T=iR,w=p;return _.next(C=>yt.forEach(C,(O,k)=>(T<k.largestBatchId&&(T=k.largestBatchId),p.get(O)?yt.resolve():this.remoteDocumentCache.getEntry(n,O).next(U=>{w=w.insert(O,U)}))).next(()=>this.populateOverlays(n,C,p)).next(()=>this.computeViews(n,w,C,wr())).next(O=>({batchId:T,changes:u7(O)})))})}getDocumentsMatchingDocumentQuery(n,i){return this.getDocument(n,new En(i)).next(s=>{let l=Dw();return s.isFoundDocument()&&(l=l.insert(s.key,s)),l})}getDocumentsMatchingCollectionGroupQuery(n,i,s,l){const p=i.collectionGroup;let _=Dw();return this.indexManager.getCollectionParents(n,p).next(T=>yt.forEach(T,w=>{const C=function(k,U){return new oS(U,null,k.explicitOrderBy.slice(),k.filters.slice(),k.limit,k.limitType,k.startAt,k.endAt)}(i,w.child(p));return this.getDocumentsMatchingCollectionQuery(n,C,s,l).next(O=>{O.forEach((k,U)=>{_=_.insert(k,U)})})}).next(()=>_))}getDocumentsMatchingCollectionQuery(n,i,s,l){let p;return this.documentOverlayCache.getOverlaysForCollection(n,i.path,s.largestBatchId).next(_=>(p=_,this.remoteDocumentCache.getDocumentsMatchingQuery(n,i,s,p,l))).next(_=>{p.forEach((w,C)=>{const O=C.getKey();_.get(O)===null&&(_=_.insert(O,lo.newInvalidDocument(O)))});let T=Dw();return _.forEach((w,C)=>{const O=p.get(w);O!==void 0&&Xw(O.mutation,C,jc.empty(),la.now()),yD(i,C)&&(T=T.insert(w,C))}),T})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E_e{constructor(n){this.serializer=n,this.Fr=new Map,this.Mr=new Map}getBundleMetadata(n,i){return yt.resolve(this.Fr.get(i))}saveBundleMetadata(n,i){return this.Fr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:Uu(l.createTime)}}(i)),yt.resolve()}getNamedQuery(n,i){return yt.resolve(this.Mr.get(i))}saveNamedQuery(n,i){return this.Mr.set(i.name,function(l){return{name:l.name,query:o_e(l.bundledQuery),readTime:Uu(l.readTime)}}(i)),yt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y_e{constructor(){this.overlays=new ls(En.comparator),this.Or=new Map}getOverlay(n,i){return yt.resolve(this.overlays.get(i))}getOverlays(n,i){const s=m_();return yt.forEach(i,l=>this.getOverlay(n,l).next(p=>{p!==null&&s.set(l,p)})).next(()=>s)}saveOverlays(n,i,s){return s.forEach((l,p)=>{this.St(n,i,p)}),yt.resolve()}removeOverlaysForBatchId(n,i,s){const l=this.Or.get(s);return l!==void 0&&(l.forEach(p=>this.overlays=this.overlays.remove(p)),this.Or.delete(s)),yt.resolve()}getOverlaysForCollection(n,i,s){const l=m_(),p=i.length+1,_=new En(i.child("")),T=this.overlays.getIteratorFrom(_);for(;T.hasNext();){const w=T.getNext().value,C=w.getKey();if(!i.isPrefixOf(C.path))break;C.path.length===p&&w.largestBatchId>s&&l.set(w.getKey(),w)}return yt.resolve(l)}getOverlaysForCollectionGroup(n,i,s,l){let p=new ls((C,O)=>C-O);const _=this.overlays.getIterator();for(;_.hasNext();){const C=_.getNext().value;if(C.getKey().getCollectionGroup()===i&&C.largestBatchId>s){let O=p.get(C.largestBatchId);O===null&&(O=m_(),p=p.insert(C.largestBatchId,O)),O.set(C.getKey(),C)}}const T=m_(),w=p.getIterator();for(;w.hasNext()&&(w.getNext().value.forEach((C,O)=>T.set(C,O)),!(T.size()>=l)););return yt.resolve(T)}St(n,i,s){const l=this.overlays.get(s.key);if(l!==null){const _=this.Or.get(l.largestBatchId).delete(s.key);this.Or.set(l.largestBatchId,_)}this.overlays=this.overlays.insert(s.key,new Uge(i,s));let p=this.Or.get(i);p===void 0&&(p=wr(),this.Or.set(i,p)),this.Or.set(i,p.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v_e{constructor(){this.sessionToken=Ha.EMPTY_BYTE_STRING}getSessionToken(n){return yt.resolve(this.sessionToken)}setSessionToken(n,i){return this.sessionToken=i,yt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ej{constructor(){this.Nr=new da(ba.Br),this.Lr=new da(ba.kr)}isEmpty(){return this.Nr.isEmpty()}addReference(n,i){const s=new ba(n,i);this.Nr=this.Nr.add(s),this.Lr=this.Lr.add(s)}qr(n,i){n.forEach(s=>this.addReference(s,i))}removeReference(n,i){this.Qr(new ba(n,i))}$r(n,i){n.forEach(s=>this.removeReference(s,i))}Ur(n){const i=new En(new Gi([])),s=new ba(i,n),l=new ba(i,n+1),p=[];return this.Lr.forEachInRange([s,l],_=>{this.Qr(_),p.push(_.key)}),p}Kr(){this.Nr.forEach(n=>this.Qr(n))}Qr(n){this.Nr=this.Nr.delete(n),this.Lr=this.Lr.delete(n)}Wr(n){const i=new En(new Gi([])),s=new ba(i,n),l=new ba(i,n+1);let p=wr();return this.Lr.forEachInRange([s,l],_=>{p=p.add(_.key)}),p}containsKey(n){const i=new ba(n,0),s=this.Nr.firstAfterOrEqual(i);return s!==null&&n.isEqual(s.key)}}class ba{constructor(n,i){this.key=n,this.Gr=i}static Br(n,i){return En.comparator(n.key,i.key)||pr(n.Gr,i.Gr)}static kr(n,i){return pr(n.Gr,i.Gr)||En.comparator(n.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S_e{constructor(n,i){this.indexManager=n,this.referenceDelegate=i,this.mutationQueue=[],this.Jn=1,this.zr=new da(ba.Br)}checkEmpty(n){return yt.resolve(this.mutationQueue.length===0)}addMutationBatch(n,i,s,l){const p=this.Jn;this.Jn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const _=new jge(p,i,s,l);this.mutationQueue.push(_);for(const T of l)this.zr=this.zr.add(new ba(T.key,p)),this.indexManager.addToCollectionParentIndex(n,T.key.path.popLast());return yt.resolve(_)}lookupMutationBatch(n,i){return yt.resolve(this.jr(i))}getNextMutationBatchAfterBatchId(n,i){const s=i+1,l=this.Hr(s),p=l<0?0:l;return yt.resolve(this.mutationQueue.length>p?this.mutationQueue[p]:null)}getHighestUnacknowledgedBatchId(){return yt.resolve(this.mutationQueue.length===0?oj:this.Jn-1)}getAllMutationBatches(n){return yt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(n,i){const s=new ba(i,0),l=new ba(i,Number.POSITIVE_INFINITY),p=[];return this.zr.forEachInRange([s,l],_=>{const T=this.jr(_.Gr);p.push(T)}),yt.resolve(p)}getAllMutationBatchesAffectingDocumentKeys(n,i){let s=new da(pr);return i.forEach(l=>{const p=new ba(l,0),_=new ba(l,Number.POSITIVE_INFINITY);this.zr.forEachInRange([p,_],T=>{s=s.add(T.Gr)})}),yt.resolve(this.Jr(s))}getAllMutationBatchesAffectingQuery(n,i){const s=i.path,l=s.length+1;let p=s;En.isDocumentKey(p)||(p=p.child(""));const _=new ba(new En(p),0);let T=new da(pr);return this.zr.forEachWhile(w=>{const C=w.key.path;return!!s.isPrefixOf(C)&&(C.length===l&&(T=T.add(w.Gr)),!0)},_),yt.resolve(this.Jr(T))}Jr(n){const i=[];return n.forEach(s=>{const l=this.jr(s);l!==null&&i.push(l)}),i}removeMutationBatch(n,i){si(this.Yr(i.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.zr;return yt.forEach(i.mutations,l=>{const p=new ba(l.key,i.batchId);return s=s.delete(p),this.referenceDelegate.markPotentiallyOrphaned(n,l.key)}).next(()=>{this.zr=s})}Xn(n){}containsKey(n,i){const s=new ba(i,0),l=this.zr.firstAfterOrEqual(s);return yt.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(n){return this.mutationQueue.length,yt.resolve()}Yr(n,i){return this.Hr(n)}Hr(n){return this.mutationQueue.length===0?0:n-this.mutationQueue[0].batchId}jr(n){const i=this.Hr(n);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T_e{constructor(n){this.Zr=n,this.docs=function(){return new ls(En.comparator)}(),this.size=0}setIndexManager(n){this.indexManager=n}addEntry(n,i){const s=i.key,l=this.docs.get(s),p=l?l.size:0,_=this.Zr(i);return this.docs=this.docs.insert(s,{document:i.mutableCopy(),size:_}),this.size+=_-p,this.indexManager.addToCollectionParentIndex(n,s.path.popLast())}removeEntry(n){const i=this.docs.get(n);i&&(this.docs=this.docs.remove(n),this.size-=i.size)}getEntry(n,i){const s=this.docs.get(i);return yt.resolve(s?s.document.mutableCopy():lo.newInvalidDocument(i))}getEntries(n,i){let s=pp();return i.forEach(l=>{const p=this.docs.get(l);s=s.insert(l,p?p.document.mutableCopy():lo.newInvalidDocument(l))}),yt.resolve(s)}getDocumentsMatchingQuery(n,i,s,l){let p=pp();const _=i.path,T=new En(_.child("__id-9223372036854775808__")),w=this.docs.getIteratorFrom(T);for(;w.hasNext();){const{key:C,value:{document:O}}=w.getNext();if(!_.isPrefixOf(C.path))break;C.path.length>_.length+1||Jme($me(O),s)<=0||(l.has(O.key)||yD(i,O))&&(p=p.insert(O.key,O.mutableCopy()))}return yt.resolve(p)}getAllFromCollectionGroup(n,i,s,l){Ln(9500)}Xr(n,i){return yt.forEach(this.docs,s=>i(s))}newChangeBuffer(n){return new b_e(this)}getSize(n){return yt.resolve(this.size)}}class b_e extends m_e{constructor(n){super(),this.vr=n}applyChanges(n){const i=[];return this.changes.forEach((s,l)=>{l.isValidDocument()?i.push(this.vr.addEntry(n,l)):this.vr.removeEntry(s)}),yt.waitFor(i)}getFromCache(n,i){return this.vr.getEntry(n,i)}getAllFromCache(n,i){return this.vr.getEntries(n,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w_e{constructor(n){this.persistence=n,this.ei=new j_(i=>dj(i),uj),this.lastRemoteSnapshotVersion=Gn.min(),this.highestTargetId=0,this.ti=0,this.ni=new Ej,this.targetCount=0,this.ri=Bv.rr()}forEachTarget(n,i){return this.ei.forEach((s,l)=>i(l)),yt.resolve()}getLastRemoteSnapshotVersion(n){return yt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(n){return yt.resolve(this.ti)}allocateTargetId(n){return this.highestTargetId=this.ri.next(),yt.resolve(this.highestTargetId)}setTargetsMetadata(n,i,s){return s&&(this.lastRemoteSnapshotVersion=s),i>this.ti&&(this.ti=i),yt.resolve()}ar(n){this.ei.set(n.target,n);const i=n.targetId;i>this.highestTargetId&&(this.ri=new Bv(i),this.highestTargetId=i),n.sequenceNumber>this.ti&&(this.ti=n.sequenceNumber)}addTargetData(n,i){return this.ar(i),this.targetCount+=1,yt.resolve()}updateTargetData(n,i){return this.ar(i),yt.resolve()}removeTargetData(n,i){return this.ei.delete(i.target),this.ni.Ur(i.targetId),this.targetCount-=1,yt.resolve()}removeTargets(n,i,s){let l=0;const p=[];return this.ei.forEach((_,T)=>{T.sequenceNumber<=i&&s.get(T.targetId)===null&&(this.ei.delete(_),p.push(this.removeMatchingKeysForTargetId(n,T.targetId)),l++)}),yt.waitFor(p).next(()=>l)}getTargetCount(n){return yt.resolve(this.targetCount)}getTargetData(n,i){const s=this.ei.get(i)||null;return yt.resolve(s)}addMatchingKeys(n,i,s){return this.ni.qr(i,s),yt.resolve()}removeMatchingKeys(n,i,s){this.ni.$r(i,s);const l=this.persistence.referenceDelegate,p=[];return l&&i.forEach(_=>{p.push(l.markPotentiallyOrphaned(n,_))}),yt.waitFor(p)}removeMatchingKeysForTargetId(n,i){return this.ni.Ur(i),yt.resolve()}getMatchingKeysForTargetId(n,i){const s=this.ni.Wr(i);return yt.resolve(s)}containsKey(n,i){return yt.resolve(this.ni.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D7{constructor(n,i){this.ii={},this.overlays={},this.si=new mD(0),this.oi=!1,this.oi=!0,this._i=new v_e,this.referenceDelegate=n(this),this.ai=new w_e(this),this.indexManager=new c_e,this.remoteDocumentCache=function(l){return new T_e(l)}(s=>this.referenceDelegate.ui(s)),this.serializer=new a_e(i),this.ci=new E_e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.oi=!1,Promise.resolve()}get started(){return this.oi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(n){return this.indexManager}getDocumentOverlayCache(n){let i=this.overlays[n.toKey()];return i||(i=new y_e,this.overlays[n.toKey()]=i),i}getMutationQueue(n,i){let s=this.ii[n.toKey()];return s||(s=new S_e(i,this.referenceDelegate),this.ii[n.toKey()]=s),s}getGlobalsCache(){return this._i}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.ci}runTransaction(n,i,s){Xt("MemoryPersistence","Starting transaction:",n);const l=new R_e(this.si.next());return this.referenceDelegate.li(),s(l).next(p=>this.referenceDelegate.hi(l).next(()=>p)).toPromise().then(p=>(l.raiseOnCommittedEvent(),p))}Pi(n,i){return yt.or(Object.values(this.ii).map(s=>()=>s.containsKey(n,i)))}}class R_e extends ege{constructor(n){super(),this.currentSequenceNumber=n}}class yj{constructor(n){this.persistence=n,this.Ti=new Ej,this.Ii=null}static Ei(n){return new yj(n)}get di(){if(this.Ii)return this.Ii;throw Ln(60996)}addReference(n,i,s){return this.Ti.addReference(s,i),this.di.delete(s.toString()),yt.resolve()}removeReference(n,i,s){return this.Ti.removeReference(s,i),this.di.add(s.toString()),yt.resolve()}markPotentiallyOrphaned(n,i){return this.di.add(i.toString()),yt.resolve()}removeTarget(n,i){this.Ti.Ur(i.targetId).forEach(l=>this.di.add(l.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(n,i.targetId).next(l=>{l.forEach(p=>this.di.add(p.toString()))}).next(()=>s.removeTargetData(n,i))}li(){this.Ii=new Set}hi(n){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return yt.forEach(this.di,s=>{const l=En.fromPath(s);return this.Ai(n,l).next(p=>{p||i.removeEntry(l,Gn.min())})}).next(()=>(this.Ii=null,i.apply(n)))}updateLimboDocument(n,i){return this.Ai(n,i).next(s=>{s?this.di.delete(i.toString()):this.di.add(i.toString())})}ui(n){return 0}Ai(n,i){return yt.or([()=>yt.resolve(this.Ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(n,i),()=>this.persistence.Pi(n,i)])}}class xO{constructor(n,i){this.persistence=n,this.Ri=new j_(s=>rge(s.path),(s,l)=>s.isEqual(l)),this.garbageCollector=f_e(this,i)}static Ei(n,i){return new xO(n,i)}li(){}hi(n){return yt.resolve()}forEachTarget(n,i){return this.persistence.getTargetCache().forEachTarget(n,i)}dr(n){const i=this.Vr(n);return this.persistence.getTargetCache().getTargetCount(n).next(s=>i.next(l=>s+l))}Vr(n){let i=0;return this.Ar(n,s=>{i++}).next(()=>i)}Ar(n,i){return yt.forEach(this.Ri,(s,l)=>this.gr(n,s,l).next(p=>p?yt.resolve():i(l)))}removeTargets(n,i,s){return this.persistence.getTargetCache().removeTargets(n,i,s)}removeOrphanedDocuments(n,i){let s=0;const l=this.persistence.getRemoteDocumentCache(),p=l.newChangeBuffer();return l.Xr(n,_=>this.gr(n,_,i).next(T=>{T||(s++,p.removeEntry(_,Gn.min()))})).next(()=>p.apply(n)).next(()=>s)}markPotentiallyOrphaned(n,i){return this.Ri.set(i,n.currentSequenceNumber),yt.resolve()}removeTarget(n,i){const s=i.withSequenceNumber(n.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(n,s)}addReference(n,i,s){return this.Ri.set(s,n.currentSequenceNumber),yt.resolve()}removeReference(n,i,s){return this.Ri.set(s,n.currentSequenceNumber),yt.resolve()}updateLimboDocument(n,i){return this.Ri.set(i,n.currentSequenceNumber),yt.resolve()}ui(n){let i=n.key.toString().length;return n.isFoundDocument()&&(i+=QN(n.data.value)),i}gr(n,i,s){return yt.or([()=>this.persistence.Pi(n,i),()=>this.persistence.getTargetCache().containsKey(n,i),()=>{const l=this.Ri.get(i);return yt.resolve(l!==void 0&&l>s)}])}getCacheSize(n){return this.persistence.getRemoteDocumentCache().getSize(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vj{constructor(n,i,s,l){this.targetId=n,this.fromCache=i,this.ls=s,this.hs=l}static Ps(n,i){let s=wr(),l=wr();for(const p of i.docChanges)switch(p.type){case 0:s=s.add(p.doc.key);break;case 1:l=l.add(p.doc.key)}return new vj(n,i.fromCache,s,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C_e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(n){this._documentReadCount+=n}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A_e{constructor(){this.Ts=!1,this.Is=!1,this.Es=100,this.ds=function(){return Afe()?8:tge(Rfe())>0?6:4}()}initialize(n,i){this.As=n,this.indexManager=i,this.Ts=!0}getDocumentsMatchingQuery(n,i,s,l){const p={result:null};return this.Rs(n,i).next(_=>{p.result=_}).next(()=>{if(!p.result)return this.Vs(n,i,l,s).next(_=>{p.result=_})}).next(()=>{if(p.result)return;const _=new C_e;return this.fs(n,i,_).next(T=>{if(p.result=T,this.Is)return this.gs(n,i,_,T.size)})}).next(()=>p.result)}gs(n,i,s,l){return s.documentReadCount<this.Es?(Sv()<=Lr.DEBUG&&Xt("QueryEngine","SDK will not create cache indexes for query:",Tv(i),"since it only creates cache indexes for collection contains","more than or equal to",this.Es,"documents"),yt.resolve()):(Sv()<=Lr.DEBUG&&Xt("QueryEngine","Query:",Tv(i),"scans",s.documentReadCount,"local documents and returns",l,"documents as results."),s.documentReadCount>this.ds*l?(Sv()<=Lr.DEBUG&&Xt("QueryEngine","The SDK decides to create cache indexes for query:",Tv(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(n,ju(i))):yt.resolve())}Rs(n,i){if(tz(i))return yt.resolve(null);let s=ju(i);return this.indexManager.getIndexType(n,s).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=p2(i,null,"F"),s=ju(i)),this.indexManager.getDocumentsMatchingTarget(n,s).next(p=>{const _=wr(...p);return this.As.getDocuments(n,_).next(T=>this.indexManager.getMinOffset(n,s).next(w=>{const C=this.ps(i,T);return this.ys(i,C,_,w.readTime)?this.Rs(n,p2(i,null,"F")):this.ws(n,C,i,w)}))})))}Vs(n,i,s,l){return tz(i)||l.isEqual(Gn.min())?yt.resolve(null):this.As.getDocuments(n,s).next(p=>{const _=this.ps(i,p);return this.ys(i,_,s,l)?yt.resolve(null):(Sv()<=Lr.DEBUG&&Xt("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),Tv(i)),this.ws(n,_,i,Qme(l,iR)).next(T=>T))})}ps(n,i){let s=new da(l7(n));return i.forEach((l,p)=>{yD(n,p)&&(s=s.add(p))}),s}ys(n,i,s,l){if(n.limit===null)return!1;if(s.size!==i.size)return!0;const p=n.limitType==="F"?i.last():i.first();return!!p&&(p.hasPendingWrites||p.version.compareTo(l)>0)}fs(n,i,s){return Sv()<=Lr.DEBUG&&Xt("QueryEngine","Using full collection scan to execute query:",Tv(i)),this.As.getDocumentsMatchingQuery(n,i,$f.min(),s)}ws(n,i,s,l){return this.As.getDocumentsMatchingQuery(n,s,l).next(p=>(i.forEach(_=>{p=p.insert(_.key,_)}),p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sj="LocalStore",I_e=3e8;class N_e{constructor(n,i,s,l){this.persistence=n,this.bs=i,this.serializer=l,this.Ss=new ls(pr),this.Ds=new j_(p=>dj(p),uj),this.vs=new Map,this.Cs=n.getRemoteDocumentCache(),this.ai=n.getTargetCache(),this.ci=n.getBundleCache(),this.Fs(s)}Fs(n){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(n),this.indexManager=this.persistence.getIndexManager(n),this.mutationQueue=this.persistence.getMutationQueue(n,this.indexManager),this.localDocuments=new __e(this.Cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Cs.setIndexManager(this.indexManager),this.bs.initialize(this.localDocuments,this.indexManager)}collectGarbage(n){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>n.collect(i,this.Ss))}}function O_e(a,n,i,s){return new N_e(a,n,i,s)}async function x7(a,n){const i=zn(a);return await i.persistence.runTransaction("Handle user change","readonly",s=>{let l;return i.mutationQueue.getAllMutationBatches(s).next(p=>(l=p,i.Fs(n),i.mutationQueue.getAllMutationBatches(s))).next(p=>{const _=[],T=[];let w=wr();for(const C of l){_.push(C.batchId);for(const O of C.mutations)w=w.add(O.key)}for(const C of p){T.push(C.batchId);for(const O of C.mutations)w=w.add(O.key)}return i.localDocuments.getDocuments(s,w).next(C=>({Ms:C,removedBatchIds:_,addedBatchIds:T}))})})}function D_e(a,n){const i=zn(a);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const l=n.batch.keys(),p=i.Cs.newChangeBuffer({trackRemovals:!0});return function(T,w,C,O){const k=C.batch,U=k.keys();let Y=yt.resolve();return U.forEach(W=>{Y=Y.next(()=>O.getEntry(w,W)).next(ee=>{const K=C.docVersions.get(W);si(K!==null,48541),ee.version.compareTo(K)<0&&(k.applyToRemoteDocument(ee,C),ee.isValidDocument()&&(ee.setReadTime(C.commitVersion),O.addEntry(ee)))})}),Y.next(()=>T.mutationQueue.removeMutationBatch(w,k))}(i,s,n,p).next(()=>p.apply(s)).next(()=>i.mutationQueue.performConsistencyCheck(s)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(s,l,n.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(T){let w=wr();for(let C=0;C<T.mutationResults.length;++C)T.mutationResults[C].transformResults.length>0&&(w=w.add(T.batch.mutations[C].key));return w}(n))).next(()=>i.localDocuments.getDocuments(s,l))})}function P7(a){const n=zn(a);return n.persistence.runTransaction("Get last remote snapshot version","readonly",i=>n.ai.getLastRemoteSnapshotVersion(i))}function x_e(a,n){const i=zn(a),s=n.snapshotVersion;let l=i.Ss;return i.persistence.runTransaction("Apply remote event","readwrite-primary",p=>{const _=i.Cs.newChangeBuffer({trackRemovals:!0});l=i.Ss;const T=[];n.targetChanges.forEach((O,k)=>{const U=l.get(k);if(!U)return;T.push(i.ai.removeMatchingKeys(p,O.removedDocuments,k).next(()=>i.ai.addMatchingKeys(p,O.addedDocuments,k)));let Y=U.withSequenceNumber(p.currentSequenceNumber);n.targetMismatches.get(k)!==null?Y=Y.withResumeToken(Ha.EMPTY_BYTE_STRING,Gn.min()).withLastLimboFreeSnapshotVersion(Gn.min()):O.resumeToken.approximateByteSize()>0&&(Y=Y.withResumeToken(O.resumeToken,s)),l=l.insert(k,Y),function(ee,K,ie){return ee.resumeToken.approximateByteSize()===0||K.snapshotVersion.toMicroseconds()-ee.snapshotVersion.toMicroseconds()>=I_e?!0:ie.addedDocuments.size+ie.modifiedDocuments.size+ie.removedDocuments.size>0}(U,Y,O)&&T.push(i.ai.updateTargetData(p,Y))});let w=pp(),C=wr();if(n.documentUpdates.forEach(O=>{n.resolvedLimboDocuments.has(O)&&T.push(i.persistence.referenceDelegate.updateLimboDocument(p,O))}),T.push(P_e(p,_,n.documentUpdates).next(O=>{w=O.xs,C=O.Os})),!s.isEqual(Gn.min())){const O=i.ai.getLastRemoteSnapshotVersion(p).next(k=>i.ai.setTargetsMetadata(p,p.currentSequenceNumber,s));T.push(O)}return yt.waitFor(T).next(()=>_.apply(p)).next(()=>i.localDocuments.getLocalViewOfDocuments(p,w,C)).next(()=>w)}).then(p=>(i.Ss=l,p))}function P_e(a,n,i){let s=wr(),l=wr();return i.forEach(p=>s=s.add(p)),n.getEntries(a,s).next(p=>{let _=pp();return i.forEach((T,w)=>{const C=p.get(T);w.isFoundDocument()!==C.isFoundDocument()&&(l=l.add(T)),w.isNoDocument()&&w.version.isEqual(Gn.min())?(n.removeEntry(T,w.readTime),_=_.insert(T,w)):!C.isValidDocument()||w.version.compareTo(C.version)>0||w.version.compareTo(C.version)===0&&C.hasPendingWrites?(n.addEntry(w),_=_.insert(T,w)):Xt(Sj,"Ignoring outdated watch update for ",T,". Current version:",C.version," Watch version:",w.version)}),{xs:_,Os:l}})}function k_e(a,n){const i=zn(a);return i.persistence.runTransaction("Get next mutation batch","readonly",s=>(n===void 0&&(n=oj),i.mutationQueue.getNextMutationBatchAfterBatchId(s,n)))}function L_e(a,n){const i=zn(a);return i.persistence.runTransaction("Allocate target","readwrite",s=>{let l;return i.ai.getTargetData(s,n).next(p=>p?(l=p,yt.resolve(l)):i.ai.allocateTargetId(s).next(_=>(l=new Bf(n,_,"TargetPurposeListen",s.currentSequenceNumber),i.ai.addTargetData(s,l).next(()=>l))))}).then(s=>{const l=i.Ss.get(s.targetId);return(l===null||s.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ss=i.Ss.insert(s.targetId,s),i.Ds.set(n,s.targetId)),s})}async function E2(a,n,i){const s=zn(a),l=s.Ss.get(n),p=i?"readwrite":"readwrite-primary";try{i||await s.persistence.runTransaction("Release target",p,_=>s.persistence.referenceDelegate.removeTarget(_,l))}catch(_){if(!aS(_))throw _;Xt(Sj,`Failed to update sequence numbers for target ${n}: ${_}`)}s.Ss=s.Ss.remove(n),s.Ds.delete(l.target)}function fz(a,n,i){const s=zn(a);let l=Gn.min(),p=wr();return s.persistence.runTransaction("Execute query","readwrite",_=>function(w,C,O){const k=zn(w),U=k.Ds.get(O);return U!==void 0?yt.resolve(k.Ss.get(U)):k.ai.getTargetData(C,O)}(s,_,ju(n)).next(T=>{if(T)return l=T.lastLimboFreeSnapshotVersion,s.ai.getMatchingKeysForTargetId(_,T.targetId).next(w=>{p=w})}).next(()=>s.bs.getDocumentsMatchingQuery(_,n,i?l:Gn.min(),i?p:wr())).next(T=>(M_e(s,Tge(n),T),{documents:T,Ns:p})))}function M_e(a,n,i){let s=a.vs.get(n)||Gn.min();i.forEach((l,p)=>{p.readTime.compareTo(s)>0&&(s=p.readTime)}),a.vs.set(n,s)}class mz{constructor(){this.activeTargetIds=Ige()}$s(n){this.activeTargetIds=this.activeTargetIds.add(n)}Us(n){this.activeTargetIds=this.activeTargetIds.delete(n)}Qs(){const n={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(n)}}class j_e{constructor(){this.So=new mz,this.Do={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(n){}updateMutationState(n,i,s){}addLocalQueryTarget(n,i=!0){return i&&this.So.$s(n),this.Do[n]||"not-current"}updateQueryState(n,i,s){this.Do[n]=i}removeLocalQueryTarget(n){this.So.Us(n)}isLocalQueryTarget(n){return this.So.activeTargetIds.has(n)}clearQueryState(n){delete this.Do[n]}getAllActiveQueryTargets(){return this.So.activeTargetIds}isActiveQueryTarget(n){return this.So.activeTargetIds.has(n)}start(){return this.So=new mz,Promise.resolve()}handleUserChange(n,i,s){}setOnlineState(n){}shutdown(){}writeSequenceNumber(n){}notifyBundleLoaded(n){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U_e{vo(n){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gz="ConnectivityMonitor";class _z{constructor(){this.Co=()=>this.Fo(),this.Mo=()=>this.xo(),this.Oo=[],this.No()}vo(n){this.Oo.push(n)}shutdown(){window.removeEventListener("online",this.Co),window.removeEventListener("offline",this.Mo)}No(){window.addEventListener("online",this.Co),window.addEventListener("offline",this.Mo)}Fo(){Xt(gz,"Network connectivity changed: AVAILABLE");for(const n of this.Oo)n(0)}xo(){Xt(gz,"Network connectivity changed: UNAVAILABLE");for(const n of this.Oo)n(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rN=null;function y2(){return rN===null?rN=function(){return 268435456+Math.round(2147483648*Math.random())}():rN++,"0x"+rN.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sM="RestConnection",V_e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class F_e{get Bo(){return!1}constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const i=n.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.Lo=i+"://"+n.host,this.ko=`projects/${s}/databases/${l}`,this.qo=this.databaseId.database===CO?`project_id=${s}`:`project_id=${s}&database_id=${l}`}Qo(n,i,s,l,p){const _=y2(),T=this.$o(n,i.toUriEncodedString());Xt(sM,`Sending RPC '${n}' ${_}:`,T,s);const w={"google-cloud-resource-prefix":this.ko,"x-goog-request-params":this.qo};return this.Uo(w,l,p),this.Ko(n,T,w,s).then(C=>(Xt(sM,`Received RPC '${n}' ${_}: `,C),C),C=>{throw jv(sM,`RPC '${n}' ${_} failed with error: `,C,"url: ",T,"request:",s),C})}Wo(n,i,s,l,p,_){return this.Qo(n,i,s,l,p)}Uo(n,i,s){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+iS}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,p)=>n[p]=l),s&&s.headers.forEach((l,p)=>n[p]=l)}$o(n,i){const s=V_e[n];return`${this.Lo}/v1/${i}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B_e{constructor(n){this.Go=n.Go,this.zo=n.zo}jo(n){this.Ho=n}Jo(n){this.Yo=n}Zo(n){this.Xo=n}onMessage(n){this.e_=n}close(){this.zo()}send(n){this.Go(n)}t_(){this.Ho()}n_(){this.Yo()}r_(n){this.Xo(n)}i_(n){this.e_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oo="WebChannelConnection";class H_e extends F_e{constructor(n){super(n),this.forceLongPolling=n.forceLongPolling,this.autoDetectLongPolling=n.autoDetectLongPolling,this.useFetchStreams=n.useFetchStreams,this.longPollingOptions=n.longPollingOptions}Ko(n,i,s,l){const p=y2();return new Promise((_,T)=>{const w=new MK;w.setWithCredentials(!0),w.listenOnce(jK.COMPLETE,()=>{try{switch(w.getLastErrorCode()){case XN.NO_ERROR:const O=w.getResponseJson();Xt(oo,`XHR for RPC '${n}' ${p} received:`,JSON.stringify(O)),_(O);break;case XN.TIMEOUT:Xt(oo,`RPC '${n}' ${p} timed out`),T(new Qt(Et.DEADLINE_EXCEEDED,"Request time out"));break;case XN.HTTP_ERROR:const k=w.getStatus();if(Xt(oo,`RPC '${n}' ${p} failed with status:`,k,"response text:",w.getResponseText()),k>0){let U=w.getResponseJson();Array.isArray(U)&&(U=U[0]);const Y=U==null?void 0:U.error;if(Y&&Y.status&&Y.message){const W=function(K){const ie=K.toLowerCase().replace(/_/g,"-");return Object.values(Et).indexOf(ie)>=0?ie:Et.UNKNOWN}(Y.status);T(new Qt(W,Y.message))}else T(new Qt(Et.UNKNOWN,"Server responded with status "+w.getStatus()))}else T(new Qt(Et.UNAVAILABLE,"Connection failed."));break;default:Ln(9055,{s_:n,streamId:p,o_:w.getLastErrorCode(),__:w.getLastError()})}}finally{Xt(oo,`RPC '${n}' ${p} completed.`)}});const C=JSON.stringify(l);Xt(oo,`RPC '${n}' ${p} sending request:`,l),w.send(i,"POST",C,s,15)})}a_(n,i,s){const l=y2(),p=[this.Lo,"/","google.firestore.v1.Firestore","/",n,"/channel"],_=FK(),T=VK(),w={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},C=this.longPollingOptions.timeoutSeconds;C!==void 0&&(w.longPollingTimeout=Math.round(1e3*C)),this.useFetchStreams&&(w.useFetchStreams=!0),this.Uo(w.initMessageHeaders,i,s),w.encodeInitMessageHeaders=!0;const O=p.join("");Xt(oo,`Creating RPC '${n}' stream ${l}: ${O}`,w);const k=_.createWebChannel(O,w);let U=!1,Y=!1;const W=new B_e({Go:K=>{Y?Xt(oo,`Not sending because RPC '${n}' stream ${l} is closed:`,K):(U||(Xt(oo,`Opening RPC '${n}' stream ${l} transport.`),k.open(),U=!0),Xt(oo,`RPC '${n}' stream ${l} sending:`,K),k.send(K))},zo:()=>k.close()}),ee=(K,ie,se)=>{K.listen(ie,ue=>{try{se(ue)}catch(ye){setTimeout(()=>{throw ye},0)}})};return ee(k,Ow.EventType.OPEN,()=>{Y||(Xt(oo,`RPC '${n}' stream ${l} transport opened.`),W.t_())}),ee(k,Ow.EventType.CLOSE,()=>{Y||(Y=!0,Xt(oo,`RPC '${n}' stream ${l} transport closed`),W.r_())}),ee(k,Ow.EventType.ERROR,K=>{Y||(Y=!0,jv(oo,`RPC '${n}' stream ${l} transport errored. Name:`,K.name,"Message:",K.message),W.r_(new Qt(Et.UNAVAILABLE,"The operation could not be completed")))}),ee(k,Ow.EventType.MESSAGE,K=>{var ie;if(!Y){const se=K.data[0];si(!!se,16349);const ue=se,ye=(ue==null?void 0:ue.error)||((ie=ue[0])===null||ie===void 0?void 0:ie.error);if(ye){Xt(oo,`RPC '${n}' stream ${l} received error:`,ye);const ae=ye.status;let ve=function(te){const oe=Zs[te];if(oe!==void 0)return v7(oe)}(ae),$=ye.message;ve===void 0&&(ve=Et.INTERNAL,$="Unknown error status: "+ae+" with message "+ye.message),Y=!0,W.r_(new Qt(ve,$)),k.close()}else Xt(oo,`RPC '${n}' stream ${l} received:`,se),W.i_(se)}}),ee(T,UK.STAT_EVENT,K=>{K.stat===a2.PROXY?Xt(oo,`RPC '${n}' stream ${l} detected buffering proxy`):K.stat===a2.NOPROXY&&Xt(oo,`RPC '${n}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{W.n_()},0),W}}function aM(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bD(a){return new Yge(a,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k7{constructor(n,i,s=1e3,l=1.5,p=6e4){this.bi=n,this.timerId=i,this.u_=s,this.c_=l,this.l_=p,this.h_=0,this.P_=null,this.T_=Date.now(),this.reset()}reset(){this.h_=0}I_(){this.h_=this.l_}E_(n){this.cancel();const i=Math.floor(this.h_+this.d_()),s=Math.max(0,Date.now()-this.T_),l=Math.max(0,i-s);l>0&&Xt("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.h_} ms, delay with jitter: ${i} ms, last attempt: ${s} ms ago)`),this.P_=this.bi.enqueueAfterDelay(this.timerId,l,()=>(this.T_=Date.now(),n())),this.h_*=this.c_,this.h_<this.u_&&(this.h_=this.u_),this.h_>this.l_&&(this.h_=this.l_)}A_(){this.P_!==null&&(this.P_.skipDelay(),this.P_=null)}cancel(){this.P_!==null&&(this.P_.cancel(),this.P_=null)}d_(){return(Math.random()-.5)*this.h_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ez="PersistentStream";class L7{constructor(n,i,s,l,p,_,T,w){this.bi=n,this.R_=s,this.V_=l,this.connection=p,this.authCredentialsProvider=_,this.appCheckCredentialsProvider=T,this.listener=w,this.state=0,this.m_=0,this.f_=null,this.g_=null,this.stream=null,this.p_=0,this.y_=new k7(n,i)}w_(){return this.state===1||this.state===5||this.b_()}b_(){return this.state===2||this.state===3}start(){this.p_=0,this.state!==4?this.auth():this.S_()}async stop(){this.w_()&&await this.close(0)}D_(){this.state=0,this.y_.reset()}v_(){this.b_()&&this.f_===null&&(this.f_=this.bi.enqueueAfterDelay(this.R_,6e4,()=>this.C_()))}F_(n){this.M_(),this.stream.send(n)}async C_(){if(this.b_())return this.close(0)}M_(){this.f_&&(this.f_.cancel(),this.f_=null)}x_(){this.g_&&(this.g_.cancel(),this.g_=null)}async close(n,i){this.M_(),this.x_(),this.y_.cancel(),this.m_++,n!==4?this.y_.reset():i&&i.code===Et.RESOURCE_EXHAUSTED?(hp(i.toString()),hp("Using maximum backoff delay to prevent overloading the backend."),this.y_.I_()):i&&i.code===Et.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.O_(),this.stream.close(),this.stream=null),this.state=n,await this.listener.Zo(i)}O_(){}auth(){this.state=1;const n=this.N_(this.m_),i=this.m_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,l])=>{this.m_===i&&this.B_(s,l)},s=>{n(()=>{const l=new Qt(Et.UNKNOWN,"Fetching auth token failed: "+s.message);return this.L_(l)})})}B_(n,i){const s=this.N_(this.m_);this.stream=this.k_(n,i),this.stream.jo(()=>{s(()=>this.listener.jo())}),this.stream.Jo(()=>{s(()=>(this.state=2,this.g_=this.bi.enqueueAfterDelay(this.V_,1e4,()=>(this.b_()&&(this.state=3),Promise.resolve())),this.listener.Jo()))}),this.stream.Zo(l=>{s(()=>this.L_(l))}),this.stream.onMessage(l=>{s(()=>++this.p_==1?this.q_(l):this.onNext(l))})}S_(){this.state=5,this.y_.E_(async()=>{this.state=0,this.start()})}L_(n){return Xt(Ez,`close with error: ${n}`),this.stream=null,this.close(4,n)}N_(n){return i=>{this.bi.enqueueAndForget(()=>this.m_===n?i():(Xt(Ez,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class G_e extends L7{constructor(n,i,s,l,p,_){super(n,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,s,l,_),this.serializer=p}k_(n,i){return this.connection.a_("Listen",n,i)}q_(n){return this.onNext(n)}onNext(n){this.y_.reset();const i=Xge(this.serializer,n),s=function(p){if(!("targetChange"in p))return Gn.min();const _=p.targetChange;return _.targetIds&&_.targetIds.length?Gn.min():_.readTime?Uu(_.readTime):Gn.min()}(n);return this.listener.Q_(i,s)}U_(n){const i={};i.database=_2(this.serializer),i.addTarget=function(p,_){let T;const w=_.target;if(T=u2(w)?{documents:Jge(p,w)}:{query:Zge(p,w).gt},T.targetId=_.targetId,_.resumeToken.approximateByteSize()>0){T.resumeToken=b7(p,_.resumeToken);const C=f2(p,_.expectedCount);C!==null&&(T.expectedCount=C)}else if(_.snapshotVersion.compareTo(Gn.min())>0){T.readTime=DO(p,_.snapshotVersion.toTimestamp());const C=f2(p,_.expectedCount);C!==null&&(T.expectedCount=C)}return T}(this.serializer,n);const s=t_e(this.serializer,n);s&&(i.labels=s),this.F_(i)}K_(n){const i={};i.database=_2(this.serializer),i.removeTarget=n,this.F_(i)}}class W_e extends L7{constructor(n,i,s,l,p,_){super(n,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,s,l,_),this.serializer=p}get W_(){return this.p_>0}start(){this.lastStreamToken=void 0,super.start()}O_(){this.W_&&this.G_([])}k_(n,i){return this.connection.a_("Write",n,i)}q_(n){return si(!!n.streamToken,31322),this.lastStreamToken=n.streamToken,si(!n.writeResults||n.writeResults.length===0,55816),this.listener.z_()}onNext(n){si(!!n.streamToken,12678),this.lastStreamToken=n.streamToken,this.y_.reset();const i=$ge(n.writeResults,n.commitTime),s=Uu(n.commitTime);return this.listener.j_(s,i)}H_(){const n={};n.database=_2(this.serializer),this.F_(n)}G_(n){const i={streamToken:this.lastStreamToken,writes:n.map(s=>Qge(this.serializer,s))};this.F_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z_e{}class Y_e extends z_e{constructor(n,i,s,l){super(),this.authCredentials=n,this.appCheckCredentials=i,this.connection=s,this.serializer=l,this.J_=!1}Y_(){if(this.J_)throw new Qt(Et.FAILED_PRECONDITION,"The client has already been terminated.")}Qo(n,i,s,l){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,_])=>this.connection.Qo(n,m2(i,s),l,p,_)).catch(p=>{throw p.name==="FirebaseError"?(p.code===Et.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new Qt(Et.UNKNOWN,p.toString())})}Wo(n,i,s,l,p){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([_,T])=>this.connection.Wo(n,m2(i,s),l,_,T,p)).catch(_=>{throw _.name==="FirebaseError"?(_.code===Et.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),_):new Qt(Et.UNKNOWN,_.toString())})}terminate(){this.J_=!0,this.connection.terminate()}}class q_e{constructor(n,i){this.asyncQueue=n,this.onlineStateHandler=i,this.state="Unknown",this.Z_=0,this.X_=null,this.ea=!0}ta(){this.Z_===0&&(this.na("Unknown"),this.X_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.X_=null,this.ra("Backend didn't respond within 10 seconds."),this.na("Offline"),Promise.resolve())))}ia(n){this.state==="Online"?this.na("Unknown"):(this.Z_++,this.Z_>=1&&(this.sa(),this.ra(`Connection failed 1 times. Most recent error: ${n.toString()}`),this.na("Offline")))}set(n){this.sa(),this.Z_=0,n==="Online"&&(this.ea=!1),this.na(n)}na(n){n!==this.state&&(this.state=n,this.onlineStateHandler(n))}ra(n){const i=`Could not reach Cloud Firestore backend. ${n}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ea?(hp(i),this.ea=!1):Xt("OnlineStateTracker",i)}sa(){this.X_!==null&&(this.X_.cancel(),this.X_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D_="RemoteStore";class K_e{constructor(n,i,s,l,p){this.localStore=n,this.datastore=i,this.asyncQueue=s,this.remoteSyncer={},this.oa=[],this._a=new Map,this.aa=new Set,this.ua=[],this.ca=p,this.ca.vo(_=>{s.enqueueAndForget(async()=>{U_(this)&&(Xt(D_,"Restarting streams for network reachability change."),await async function(w){const C=zn(w);C.aa.add(4),await wR(C),C.la.set("Unknown"),C.aa.delete(4),await wD(C)}(this))})}),this.la=new q_e(s,l)}}async function wD(a){if(U_(a))for(const n of a.ua)await n(!0)}async function wR(a){for(const n of a.ua)await n(!1)}function M7(a,n){const i=zn(a);i._a.has(n.targetId)||(i._a.set(n.targetId,n),Rj(i)?wj(i):cS(i).b_()&&bj(i,n))}function Tj(a,n){const i=zn(a),s=cS(i);i._a.delete(n),s.b_()&&j7(i,n),i._a.size===0&&(s.b_()?s.v_():U_(i)&&i.la.set("Unknown"))}function bj(a,n){if(a.ha.Ke(n.targetId),n.resumeToken.approximateByteSize()>0||n.snapshotVersion.compareTo(Gn.min())>0){const i=a.remoteSyncer.getRemoteKeysForTarget(n.targetId).size;n=n.withExpectedCount(i)}cS(a).U_(n)}function j7(a,n){a.ha.Ke(n),cS(a).K_(n)}function wj(a){a.ha=new Hge({getRemoteKeysForTarget:n=>a.remoteSyncer.getRemoteKeysForTarget(n),Rt:n=>a._a.get(n)||null,Pt:()=>a.datastore.serializer.databaseId}),cS(a).start(),a.la.ta()}function Rj(a){return U_(a)&&!cS(a).w_()&&a._a.size>0}function U_(a){return zn(a).aa.size===0}function U7(a){a.ha=void 0}async function X_e(a){a.la.set("Online")}async function Q_e(a){a._a.forEach((n,i)=>{bj(a,n)})}async function $_e(a,n){U7(a),Rj(a)?(a.la.ia(n),wj(a)):a.la.set("Unknown")}async function J_e(a,n,i){if(a.la.set("Online"),n instanceof T7&&n.state===2&&n.cause)try{await async function(l,p){const _=p.cause;for(const T of p.targetIds)l._a.has(T)&&(await l.remoteSyncer.rejectListen(T,_),l._a.delete(T),l.ha.removeTarget(T))}(a,n)}catch(s){Xt(D_,"Failed to remove targets %s: %s ",n.targetIds.join(","),s),await PO(a,s)}else if(n instanceof ZN?a.ha.Xe(n):n instanceof S7?a.ha.ot(n):a.ha.nt(n),!i.isEqual(Gn.min()))try{const s=await P7(a.localStore);i.compareTo(s)>=0&&await function(p,_){const T=p.ha.It(_);return T.targetChanges.forEach((w,C)=>{if(w.resumeToken.approximateByteSize()>0){const O=p._a.get(C);O&&p._a.set(C,O.withResumeToken(w.resumeToken,_))}}),T.targetMismatches.forEach((w,C)=>{const O=p._a.get(w);if(!O)return;p._a.set(w,O.withResumeToken(Ha.EMPTY_BYTE_STRING,O.snapshotVersion)),j7(p,w);const k=new Bf(O.target,w,C,O.sequenceNumber);bj(p,k)}),p.remoteSyncer.applyRemoteEvent(T)}(a,i)}catch(s){Xt(D_,"Failed to raise snapshot:",s),await PO(a,s)}}async function PO(a,n,i){if(!aS(n))throw n;a.aa.add(1),await wR(a),a.la.set("Offline"),i||(i=()=>P7(a.localStore)),a.asyncQueue.enqueueRetryable(async()=>{Xt(D_,"Retrying IndexedDB access"),await i(),a.aa.delete(1),await wD(a)})}function V7(a,n){return n().catch(i=>PO(a,i,n))}async function RD(a){const n=zn(a),i=tm(n);let s=n.oa.length>0?n.oa[n.oa.length-1].batchId:oj;for(;Z_e(n);)try{const l=await k_e(n.localStore,s);if(l===null){n.oa.length===0&&i.v_();break}s=l.batchId,eEe(n,l)}catch(l){await PO(n,l)}F7(n)&&B7(n)}function Z_e(a){return U_(a)&&a.oa.length<10}function eEe(a,n){a.oa.push(n);const i=tm(a);i.b_()&&i.W_&&i.G_(n.mutations)}function F7(a){return U_(a)&&!tm(a).w_()&&a.oa.length>0}function B7(a){tm(a).start()}async function tEe(a){tm(a).H_()}async function nEe(a){const n=tm(a);for(const i of a.oa)n.G_(i.mutations)}async function rEe(a,n,i){const s=a.oa.shift(),l=mj.from(s,n,i);await V7(a,()=>a.remoteSyncer.applySuccessfulWrite(l)),await RD(a)}async function iEe(a,n){n&&tm(a).W_&&await async function(s,l){if(function(_){return Fge(_)&&_!==Et.ABORTED}(l.code)){const p=s.oa.shift();tm(s).D_(),await V7(s,()=>s.remoteSyncer.rejectFailedWrite(p.batchId,l)),await RD(s)}}(a,n),F7(a)&&B7(a)}async function yz(a,n){const i=zn(a);i.asyncQueue.verifyOperationInProgress(),Xt(D_,"RemoteStore received new credentials");const s=U_(i);i.aa.add(3),await wR(i),s&&i.la.set("Unknown"),await i.remoteSyncer.handleCredentialChange(n),i.aa.delete(3),await wD(i)}async function sEe(a,n){const i=zn(a);n?(i.aa.delete(2),await wD(i)):n||(i.aa.add(2),await wR(i),i.la.set("Unknown"))}function cS(a){return a.Pa||(a.Pa=function(i,s,l){const p=zn(i);return p.Y_(),new G_e(s,p.connection,p.authCredentials,p.appCheckCredentials,p.serializer,l)}(a.datastore,a.asyncQueue,{jo:X_e.bind(null,a),Jo:Q_e.bind(null,a),Zo:$_e.bind(null,a),Q_:J_e.bind(null,a)}),a.ua.push(async n=>{n?(a.Pa.D_(),Rj(a)?wj(a):a.la.set("Unknown")):(await a.Pa.stop(),U7(a))})),a.Pa}function tm(a){return a.Ta||(a.Ta=function(i,s,l){const p=zn(i);return p.Y_(),new W_e(s,p.connection,p.authCredentials,p.appCheckCredentials,p.serializer,l)}(a.datastore,a.asyncQueue,{jo:()=>Promise.resolve(),Jo:tEe.bind(null,a),Zo:iEe.bind(null,a),z_:nEe.bind(null,a),j_:rEe.bind(null,a)}),a.ua.push(async n=>{n?(a.Ta.D_(),await RD(a)):(await a.Ta.stop(),a.oa.length>0&&(Xt(D_,`Stopping write stream with ${a.oa.length} pending writes`),a.oa=[]))})),a.Ta}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cj{constructor(n,i,s,l,p){this.asyncQueue=n,this.timerId=i,this.targetTimeMs=s,this.op=l,this.removalCallback=p,this.deferred=new S_,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(_=>{})}get promise(){return this.deferred.promise}static createAndSchedule(n,i,s,l,p){const _=Date.now()+s,T=new Cj(n,i,_,l,p);return T.start(s),T}start(n){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),n)}skipDelay(){return this.handleDelayElapsed()}cancel(n){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Qt(Et.CANCELLED,"Operation cancelled"+(n?": "+n:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(n=>this.deferred.resolve(n))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Aj(a,n){if(hp("AsyncQueue",`${n}: ${a}`),aS(a))return new Qt(Et.UNAVAILABLE,`${n}: ${a}`);throw a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dv{static emptySet(n){return new Dv(n.comparator)}constructor(n){this.comparator=n?(i,s)=>n(i,s)||En.comparator(i.key,s.key):(i,s)=>En.comparator(i.key,s.key),this.keyedMap=Dw(),this.sortedSet=new ls(this.comparator)}has(n){return this.keyedMap.get(n)!=null}get(n){return this.keyedMap.get(n)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(n){const i=this.keyedMap.get(n);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((i,s)=>(n(i),!1))}add(n){const i=this.delete(n.key);return i.copy(i.keyedMap.insert(n.key,n),i.sortedSet.insert(n,null))}delete(n){const i=this.get(n);return i?this.copy(this.keyedMap.remove(n),this.sortedSet.remove(i)):this}isEqual(n){if(!(n instanceof Dv)||this.size!==n.size)return!1;const i=this.sortedSet.getIterator(),s=n.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,p=s.getNext().key;if(!l.isEqual(p))return!1}return!0}toString(){const n=[];return this.forEach(i=>{n.push(i.toString())}),n.length===0?"DocumentSet ()":`DocumentSet (
  `+n.join(`  
`)+`
)`}copy(n,i){const s=new Dv;return s.comparator=this.comparator,s.keyedMap=n,s.sortedSet=i,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vz{constructor(){this.Ia=new ls(En.comparator)}track(n){const i=n.doc.key,s=this.Ia.get(i);s?n.type!==0&&s.type===3?this.Ia=this.Ia.insert(i,n):n.type===3&&s.type!==1?this.Ia=this.Ia.insert(i,{type:s.type,doc:n.doc}):n.type===2&&s.type===2?this.Ia=this.Ia.insert(i,{type:2,doc:n.doc}):n.type===2&&s.type===0?this.Ia=this.Ia.insert(i,{type:0,doc:n.doc}):n.type===1&&s.type===0?this.Ia=this.Ia.remove(i):n.type===1&&s.type===2?this.Ia=this.Ia.insert(i,{type:1,doc:s.doc}):n.type===0&&s.type===1?this.Ia=this.Ia.insert(i,{type:2,doc:n.doc}):Ln(63341,{Vt:n,Ea:s}):this.Ia=this.Ia.insert(i,n)}da(){const n=[];return this.Ia.inorderTraversal((i,s)=>{n.push(s)}),n}}class Hv{constructor(n,i,s,l,p,_,T,w,C){this.query=n,this.docs=i,this.oldDocs=s,this.docChanges=l,this.mutatedKeys=p,this.fromCache=_,this.syncStateChanged=T,this.excludesMetadataChanges=w,this.hasCachedResults=C}static fromInitialDocuments(n,i,s,l,p){const _=[];return i.forEach(T=>{_.push({type:0,doc:T})}),new Hv(n,i,Dv.emptySet(i),_,s,l,!0,!1,p)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(n){if(!(this.fromCache===n.fromCache&&this.hasCachedResults===n.hasCachedResults&&this.syncStateChanged===n.syncStateChanged&&this.mutatedKeys.isEqual(n.mutatedKeys)&&ED(this.query,n.query)&&this.docs.isEqual(n.docs)&&this.oldDocs.isEqual(n.oldDocs)))return!1;const i=this.docChanges,s=n.docChanges;if(i.length!==s.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==s[l].type||!i[l].doc.isEqual(s[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aEe{constructor(){this.Aa=void 0,this.Ra=[]}Va(){return this.Ra.some(n=>n.ma())}}class oEe{constructor(){this.queries=Sz(),this.onlineState="Unknown",this.fa=new Set}terminate(){(function(i,s){const l=zn(i),p=l.queries;l.queries=Sz(),p.forEach((_,T)=>{for(const w of T.Ra)w.onError(s)})})(this,new Qt(Et.ABORTED,"Firestore shutting down"))}}function Sz(){return new j_(a=>c7(a),ED)}async function cEe(a,n){const i=zn(a);let s=3;const l=n.query;let p=i.queries.get(l);p?!p.Va()&&n.ma()&&(s=2):(p=new aEe,s=n.ma()?0:1);try{switch(s){case 0:p.Aa=await i.onListen(l,!0);break;case 1:p.Aa=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(_){const T=Aj(_,`Initialization of query '${Tv(n.query)}' failed`);return void n.onError(T)}i.queries.set(l,p),p.Ra.push(n),n.ga(i.onlineState),p.Aa&&n.pa(p.Aa)&&Ij(i)}async function lEe(a,n){const i=zn(a),s=n.query;let l=3;const p=i.queries.get(s);if(p){const _=p.Ra.indexOf(n);_>=0&&(p.Ra.splice(_,1),p.Ra.length===0?l=n.ma()?0:1:!p.Va()&&n.ma()&&(l=2))}switch(l){case 0:return i.queries.delete(s),i.onUnlisten(s,!0);case 1:return i.queries.delete(s),i.onUnlisten(s,!1);case 2:return i.onLastRemoteStoreUnlisten(s);default:return}}function dEe(a,n){const i=zn(a);let s=!1;for(const l of n){const p=l.query,_=i.queries.get(p);if(_){for(const T of _.Ra)T.pa(l)&&(s=!0);_.Aa=l}}s&&Ij(i)}function uEe(a,n,i){const s=zn(a),l=s.queries.get(n);if(l)for(const p of l.Ra)p.onError(i);s.queries.delete(n)}function Ij(a){a.fa.forEach(n=>{n.next()})}var v2,Tz;(Tz=v2||(v2={})).ya="default",Tz.Cache="cache";class hEe{constructor(n,i,s){this.query=n,this.wa=i,this.ba=!1,this.Sa=null,this.onlineState="Unknown",this.options=s||{}}pa(n){if(!this.options.includeMetadataChanges){const s=[];for(const l of n.docChanges)l.type!==3&&s.push(l);n=new Hv(n.query,n.docs,n.oldDocs,s,n.mutatedKeys,n.fromCache,n.syncStateChanged,!0,n.hasCachedResults)}let i=!1;return this.ba?this.Da(n)&&(this.wa.next(n),i=!0):this.va(n,this.onlineState)&&(this.Ca(n),i=!0),this.Sa=n,i}onError(n){this.wa.error(n)}ga(n){this.onlineState=n;let i=!1;return this.Sa&&!this.ba&&this.va(this.Sa,n)&&(this.Ca(this.Sa),i=!0),i}va(n,i){if(!n.fromCache||!this.ma())return!0;const s=i!=="Offline";return(!this.options.Fa||!s)&&(!n.docs.isEmpty()||n.hasCachedResults||i==="Offline")}Da(n){if(n.docChanges.length>0)return!0;const i=this.Sa&&this.Sa.hasPendingWrites!==n.hasPendingWrites;return!(!n.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Ca(n){n=Hv.fromInitialDocuments(n.query,n.docs,n.mutatedKeys,n.fromCache,n.hasCachedResults),this.ba=!0,this.wa.next(n)}ma(){return this.options.source!==v2.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H7{constructor(n){this.key=n}}class G7{constructor(n){this.key=n}}class pEe{constructor(n,i){this.query=n,this.qa=i,this.Qa=null,this.hasCachedResults=!1,this.current=!1,this.$a=wr(),this.mutatedKeys=wr(),this.Ua=l7(n),this.Ka=new Dv(this.Ua)}get Wa(){return this.qa}Ga(n,i){const s=i?i.za:new vz,l=i?i.Ka:this.Ka;let p=i?i.mutatedKeys:this.mutatedKeys,_=l,T=!1;const w=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,C=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(n.inorderTraversal((O,k)=>{const U=l.get(O),Y=yD(this.query,k)?k:null,W=!!U&&this.mutatedKeys.has(U.key),ee=!!Y&&(Y.hasLocalMutations||this.mutatedKeys.has(Y.key)&&Y.hasCommittedMutations);let K=!1;U&&Y?U.data.isEqual(Y.data)?W!==ee&&(s.track({type:3,doc:Y}),K=!0):this.ja(U,Y)||(s.track({type:2,doc:Y}),K=!0,(w&&this.Ua(Y,w)>0||C&&this.Ua(Y,C)<0)&&(T=!0)):!U&&Y?(s.track({type:0,doc:Y}),K=!0):U&&!Y&&(s.track({type:1,doc:U}),K=!0,(w||C)&&(T=!0)),K&&(Y?(_=_.add(Y),p=ee?p.add(O):p.delete(O)):(_=_.delete(O),p=p.delete(O)))}),this.query.limit!==null)for(;_.size>this.query.limit;){const O=this.query.limitType==="F"?_.last():_.first();_=_.delete(O.key),p=p.delete(O.key),s.track({type:1,doc:O})}return{Ka:_,za:s,ys:T,mutatedKeys:p}}ja(n,i){return n.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(n,i,s,l){const p=this.Ka;this.Ka=n.Ka,this.mutatedKeys=n.mutatedKeys;const _=n.za.da();_.sort((O,k)=>function(Y,W){const ee=K=>{switch(K){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ln(20277,{Vt:K})}};return ee(Y)-ee(W)}(O.type,k.type)||this.Ua(O.doc,k.doc)),this.Ha(s),l=l!=null&&l;const T=i&&!l?this.Ja():[],w=this.$a.size===0&&this.current&&!l?1:0,C=w!==this.Qa;return this.Qa=w,_.length!==0||C?{snapshot:new Hv(this.query,n.Ka,p,_,n.mutatedKeys,w===0,C,!1,!!s&&s.resumeToken.approximateByteSize()>0),Ya:T}:{Ya:T}}ga(n){return this.current&&n==="Offline"?(this.current=!1,this.applyChanges({Ka:this.Ka,za:new vz,mutatedKeys:this.mutatedKeys,ys:!1},!1)):{Ya:[]}}Za(n){return!this.qa.has(n)&&!!this.Ka.has(n)&&!this.Ka.get(n).hasLocalMutations}Ha(n){n&&(n.addedDocuments.forEach(i=>this.qa=this.qa.add(i)),n.modifiedDocuments.forEach(i=>{}),n.removedDocuments.forEach(i=>this.qa=this.qa.delete(i)),this.current=n.current)}Ja(){if(!this.current)return[];const n=this.$a;this.$a=wr(),this.Ka.forEach(s=>{this.Za(s.key)&&(this.$a=this.$a.add(s.key))});const i=[];return n.forEach(s=>{this.$a.has(s)||i.push(new G7(s))}),this.$a.forEach(s=>{n.has(s)||i.push(new H7(s))}),i}Xa(n){this.qa=n.Ns,this.$a=wr();const i=this.Ga(n.documents);return this.applyChanges(i,!0)}eu(){return Hv.fromInitialDocuments(this.query,this.Ka,this.mutatedKeys,this.Qa===0,this.hasCachedResults)}}const Nj="SyncEngine";class fEe{constructor(n,i,s){this.query=n,this.targetId=i,this.view=s}}class mEe{constructor(n){this.key=n,this.tu=!1}}class gEe{constructor(n,i,s,l,p,_){this.localStore=n,this.remoteStore=i,this.eventManager=s,this.sharedClientState=l,this.currentUser=p,this.maxConcurrentLimboResolutions=_,this.nu={},this.ru=new j_(T=>c7(T),ED),this.iu=new Map,this.su=new Set,this.ou=new ls(En.comparator),this._u=new Map,this.au=new Ej,this.uu={},this.cu=new Map,this.lu=Bv.ir(),this.onlineState="Unknown",this.hu=void 0}get isPrimaryClient(){return this.hu===!0}}async function _Ee(a,n,i=!0){const s=X7(a);let l;const p=s.ru.get(n);return p?(s.sharedClientState.addLocalQueryTarget(p.targetId),l=p.view.eu()):l=await W7(s,n,i,!0),l}async function EEe(a,n){const i=X7(a);await W7(i,n,!0,!1)}async function W7(a,n,i,s){const l=await L_e(a.localStore,ju(n)),p=l.targetId,_=a.sharedClientState.addLocalQueryTarget(p,i);let T;return s&&(T=await yEe(a,n,p,_==="current",l.resumeToken)),a.isPrimaryClient&&i&&M7(a.remoteStore,l),T}async function yEe(a,n,i,s,l){a.Pu=(k,U,Y)=>async function(ee,K,ie,se){let ue=K.view.Ga(ie);ue.ys&&(ue=await fz(ee.localStore,K.query,!1).then(({documents:$})=>K.view.Ga($,ue)));const ye=se&&se.targetChanges.get(K.targetId),ae=se&&se.targetMismatches.get(K.targetId)!=null,ve=K.view.applyChanges(ue,ee.isPrimaryClient,ye,ae);return wz(ee,K.targetId,ve.Ya),ve.snapshot}(a,k,U,Y);const p=await fz(a.localStore,n,!0),_=new pEe(n,p.Ns),T=_.Ga(p.documents),w=bR.createSynthesizedTargetChangeForCurrentChange(i,s&&a.onlineState!=="Offline",l),C=_.applyChanges(T,a.isPrimaryClient,w);wz(a,i,C.Ya);const O=new fEe(n,i,_);return a.ru.set(n,O),a.iu.has(i)?a.iu.get(i).push(n):a.iu.set(i,[n]),C.snapshot}async function vEe(a,n,i){const s=zn(a),l=s.ru.get(n),p=s.iu.get(l.targetId);if(p.length>1)return s.iu.set(l.targetId,p.filter(_=>!ED(_,n))),void s.ru.delete(n);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(l.targetId),s.sharedClientState.isActiveQueryTarget(l.targetId)||await E2(s.localStore,l.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(l.targetId),i&&Tj(s.remoteStore,l.targetId),S2(s,l.targetId)}).catch(sS)):(S2(s,l.targetId),await E2(s.localStore,l.targetId,!0))}async function SEe(a,n){const i=zn(a),s=i.ru.get(n),l=i.iu.get(s.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(s.targetId),Tj(i.remoteStore,s.targetId))}async function TEe(a,n,i){const s=NEe(a);try{const l=await function(_,T){const w=zn(_),C=la.now(),O=T.reduce((Y,W)=>Y.add(W.key),wr());let k,U;return w.persistence.runTransaction("Locally write mutations","readwrite",Y=>{let W=pp(),ee=wr();return w.Cs.getEntries(Y,O).next(K=>{W=K,W.forEach((ie,se)=>{se.isValidDocument()||(ee=ee.add(ie))})}).next(()=>w.localDocuments.getOverlayedDocuments(Y,W)).next(K=>{k=K;const ie=[];for(const se of T){const ue=Lge(se,k.get(se.key).overlayedDocument);ue!=null&&ie.push(new om(se.key,ue,e7(ue.value.mapValue),Pl.exists(!0)))}return w.mutationQueue.addMutationBatch(Y,C,ie,T)}).next(K=>{U=K;const ie=K.applyToLocalDocumentSet(k,ee);return w.documentOverlayCache.saveOverlays(Y,K.batchId,ie)})}).then(()=>({batchId:U.batchId,changes:u7(k)}))}(s.localStore,n);s.sharedClientState.addPendingMutation(l.batchId),function(_,T,w){let C=_.uu[_.currentUser.toKey()];C||(C=new ls(pr)),C=C.insert(T,w),_.uu[_.currentUser.toKey()]=C}(s,l.batchId,i),await RR(s,l.changes),await RD(s.remoteStore)}catch(l){const p=Aj(l,"Failed to persist write");i.reject(p)}}async function z7(a,n){const i=zn(a);try{const s=await x_e(i.localStore,n);n.targetChanges.forEach((l,p)=>{const _=i._u.get(p);_&&(si(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1,22616),l.addedDocuments.size>0?_.tu=!0:l.modifiedDocuments.size>0?si(_.tu,14607):l.removedDocuments.size>0&&(si(_.tu,42227),_.tu=!1))}),await RR(i,s,n)}catch(s){await sS(s)}}function bz(a,n,i){const s=zn(a);if(s.isPrimaryClient&&i===0||!s.isPrimaryClient&&i===1){const l=[];s.ru.forEach((p,_)=>{const T=_.view.ga(n);T.snapshot&&l.push(T.snapshot)}),function(_,T){const w=zn(_);w.onlineState=T;let C=!1;w.queries.forEach((O,k)=>{for(const U of k.Ra)U.ga(T)&&(C=!0)}),C&&Ij(w)}(s.eventManager,n),l.length&&s.nu.Q_(l),s.onlineState=n,s.isPrimaryClient&&s.sharedClientState.setOnlineState(n)}}async function bEe(a,n,i){const s=zn(a);s.sharedClientState.updateQueryState(n,"rejected",i);const l=s._u.get(n),p=l&&l.key;if(p){let _=new ls(En.comparator);_=_.insert(p,lo.newNoDocument(p,Gn.min()));const T=wr().add(p),w=new TD(Gn.min(),new Map,new ls(pr),_,T);await z7(s,w),s.ou=s.ou.remove(p),s._u.delete(n),Oj(s)}else await E2(s.localStore,n,!1).then(()=>S2(s,n,i)).catch(sS)}async function wEe(a,n){const i=zn(a),s=n.batch.batchId;try{const l=await D_e(i.localStore,n);q7(i,s,null),Y7(i,s),i.sharedClientState.updateMutationState(s,"acknowledged"),await RR(i,l)}catch(l){await sS(l)}}async function REe(a,n,i){const s=zn(a);try{const l=await function(_,T){const w=zn(_);return w.persistence.runTransaction("Reject batch","readwrite-primary",C=>{let O;return w.mutationQueue.lookupMutationBatch(C,T).next(k=>(si(k!==null,37113),O=k.keys(),w.mutationQueue.removeMutationBatch(C,k))).next(()=>w.mutationQueue.performConsistencyCheck(C)).next(()=>w.documentOverlayCache.removeOverlaysForBatchId(C,O,T)).next(()=>w.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(C,O)).next(()=>w.localDocuments.getDocuments(C,O))})}(s.localStore,n);q7(s,n,i),Y7(s,n),s.sharedClientState.updateMutationState(n,"rejected",i),await RR(s,l)}catch(l){await sS(l)}}function Y7(a,n){(a.cu.get(n)||[]).forEach(i=>{i.resolve()}),a.cu.delete(n)}function q7(a,n,i){const s=zn(a);let l=s.uu[s.currentUser.toKey()];if(l){const p=l.get(n);p&&(i?p.reject(i):p.resolve(),l=l.remove(n)),s.uu[s.currentUser.toKey()]=l}}function S2(a,n,i=null){a.sharedClientState.removeLocalQueryTarget(n);for(const s of a.iu.get(n))a.ru.delete(s),i&&a.nu.Tu(s,i);a.iu.delete(n),a.isPrimaryClient&&a.au.Ur(n).forEach(s=>{a.au.containsKey(s)||K7(a,s)})}function K7(a,n){a.su.delete(n.path.canonicalString());const i=a.ou.get(n);i!==null&&(Tj(a.remoteStore,i),a.ou=a.ou.remove(n),a._u.delete(i),Oj(a))}function wz(a,n,i){for(const s of i)s instanceof H7?(a.au.addReference(s.key,n),CEe(a,s)):s instanceof G7?(Xt(Nj,"Document no longer in limbo: "+s.key),a.au.removeReference(s.key,n),a.au.containsKey(s.key)||K7(a,s.key)):Ln(19791,{Iu:s})}function CEe(a,n){const i=n.key,s=i.path.canonicalString();a.ou.get(i)||a.su.has(s)||(Xt(Nj,"New document in limbo: "+i),a.su.add(s),Oj(a))}function Oj(a){for(;a.su.size>0&&a.ou.size<a.maxConcurrentLimboResolutions;){const n=a.su.values().next().value;a.su.delete(n);const i=new En(Gi.fromString(n)),s=a.lu.next();a._u.set(s,new mEe(i)),a.ou=a.ou.insert(i,s),M7(a.remoteStore,new Bf(ju(hj(i.path)),s,"TargetPurposeLimboResolution",mD.le))}}async function RR(a,n,i){const s=zn(a),l=[],p=[],_=[];s.ru.isEmpty()||(s.ru.forEach((T,w)=>{_.push(s.Pu(w,n,i).then(C=>{var O;if((C||i)&&s.isPrimaryClient){const k=C?!C.fromCache:(O=i==null?void 0:i.targetChanges.get(w.targetId))===null||O===void 0?void 0:O.current;s.sharedClientState.updateQueryState(w.targetId,k?"current":"not-current")}if(C){l.push(C);const k=vj.Ps(w.targetId,C);p.push(k)}}))}),await Promise.all(_),s.nu.Q_(l),await async function(w,C){const O=zn(w);try{await O.persistence.runTransaction("notifyLocalViewChanges","readwrite",k=>yt.forEach(C,U=>yt.forEach(U.ls,Y=>O.persistence.referenceDelegate.addReference(k,U.targetId,Y)).next(()=>yt.forEach(U.hs,Y=>O.persistence.referenceDelegate.removeReference(k,U.targetId,Y)))))}catch(k){if(!aS(k))throw k;Xt(Sj,"Failed to update sequence numbers: "+k)}for(const k of C){const U=k.targetId;if(!k.fromCache){const Y=O.Ss.get(U),W=Y.snapshotVersion,ee=Y.withLastLimboFreeSnapshotVersion(W);O.Ss=O.Ss.insert(U,ee)}}}(s.localStore,p))}async function AEe(a,n){const i=zn(a);if(!i.currentUser.isEqual(n)){Xt(Nj,"User change. New user:",n.toKey());const s=await x7(i.localStore,n);i.currentUser=n,function(p,_){p.cu.forEach(T=>{T.forEach(w=>{w.reject(new Qt(Et.CANCELLED,_))})}),p.cu.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(n,s.removedBatchIds,s.addedBatchIds),await RR(i,s.Ms)}}function IEe(a,n){const i=zn(a),s=i._u.get(n);if(s&&s.tu)return wr().add(s.key);{let l=wr();const p=i.iu.get(n);if(!p)return l;for(const _ of p){const T=i.ru.get(_);l=l.unionWith(T.view.Wa)}return l}}function X7(a){const n=zn(a);return n.remoteStore.remoteSyncer.applyRemoteEvent=z7.bind(null,n),n.remoteStore.remoteSyncer.getRemoteKeysForTarget=IEe.bind(null,n),n.remoteStore.remoteSyncer.rejectListen=bEe.bind(null,n),n.nu.Q_=dEe.bind(null,n.eventManager),n.nu.Tu=uEe.bind(null,n.eventManager),n}function NEe(a){const n=zn(a);return n.remoteStore.remoteSyncer.applySuccessfulWrite=wEe.bind(null,n),n.remoteStore.remoteSyncer.rejectFailedWrite=REe.bind(null,n),n}class kO{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(n){this.serializer=bD(n.databaseInfo.databaseId),this.sharedClientState=this.Au(n),this.persistence=this.Ru(n),await this.persistence.start(),this.localStore=this.Vu(n),this.gcScheduler=this.mu(n,this.localStore),this.indexBackfillerScheduler=this.fu(n,this.localStore)}mu(n,i){return null}fu(n,i){return null}Vu(n){return O_e(this.persistence,new A_e,n.initialUser,this.serializer)}Ru(n){return new D7(yj.Ei,this.serializer)}Au(n){return new j_e}async terminate(){var n,i;(n=this.gcScheduler)===null||n===void 0||n.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}kO.provider={build:()=>new kO};class OEe extends kO{constructor(n){super(),this.cacheSizeBytes=n}mu(n,i){si(this.persistence.referenceDelegate instanceof xO,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new h_e(s,n.asyncQueue,i)}Ru(n){const i=this.cacheSizeBytes!==void 0?cc.withCacheSize(this.cacheSizeBytes):cc.DEFAULT;return new D7(s=>xO.Ei(s,i),this.serializer)}}class T2{async initialize(n,i){this.localStore||(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>bz(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=AEe.bind(null,this.syncEngine),await sEe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(n){return function(){return new oEe}()}createDatastore(n){const i=bD(n.databaseInfo.databaseId),s=function(p){return new H_e(p)}(n.databaseInfo);return function(p,_,T,w){return new Y_e(p,_,T,w)}(n.authCredentials,n.appCheckCredentials,s,i)}createRemoteStore(n){return function(s,l,p,_,T){return new K_e(s,l,p,_,T)}(this.localStore,this.datastore,n.asyncQueue,i=>bz(this.syncEngine,i,0),function(){return _z.C()?new _z:new U_e}())}createSyncEngine(n,i){return function(l,p,_,T,w,C,O){const k=new gEe(l,p,_,T,w,C);return O&&(k.hu=!0),k}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,n.initialUser,n.maxConcurrentLimboResolutions,i)}async terminate(){var n,i;await async function(l){const p=zn(l);Xt(D_,"RemoteStore shutting down."),p.aa.add(5),await wR(p),p.ca.shutdown(),p.la.set("Unknown")}(this.remoteStore),(n=this.datastore)===null||n===void 0||n.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}T2.provider={build:()=>new T2};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DEe{constructor(n){this.observer=n,this.muted=!1}next(n){this.muted||this.observer.next&&this.pu(this.observer.next,n)}error(n){this.muted||(this.observer.error?this.pu(this.observer.error,n):hp("Uncaught Error in snapshot listener:",n.toString()))}yu(){this.muted=!0}pu(n,i){setTimeout(()=>{this.muted||n(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nm="FirestoreClient";class xEe{constructor(n,i,s,l,p){this.authCredentials=n,this.appCheckCredentials=i,this.asyncQueue=s,this.databaseInfo=l,this.user=co.UNAUTHENTICATED,this.clientId=WK.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=p,this.authCredentials.start(s,async _=>{Xt(nm,"Received user=",_.uid),await this.authCredentialListener(_),this.user=_}),this.appCheckCredentials.start(s,_=>(Xt(nm,"Received new app check token=",_),this.appCheckCredentialListener(_,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(n){this.authCredentialListener=n}setAppCheckTokenChangeListener(n){this.appCheckCredentialListener=n}terminate(){this.asyncQueue.enterRestrictedMode();const n=new S_;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(i){const s=Aj(i,"Failed to shutdown persistence");n.reject(s)}}),n.promise}}async function oM(a,n){a.asyncQueue.verifyOperationInProgress(),Xt(nm,"Initializing OfflineComponentProvider");const i=a.configuration;await n.initialize(i);let s=i.initialUser;a.setCredentialChangeListener(async l=>{s.isEqual(l)||(await x7(n.localStore,l),s=l)}),n.persistence.setDatabaseDeletedListener(()=>a.terminate()),a._offlineComponents=n}async function Rz(a,n){a.asyncQueue.verifyOperationInProgress();const i=await PEe(a);Xt(nm,"Initializing OnlineComponentProvider"),await n.initialize(i,a.configuration),a.setCredentialChangeListener(s=>yz(n.remoteStore,s)),a.setAppCheckTokenChangeListener((s,l)=>yz(n.remoteStore,l)),a._onlineComponents=n}async function PEe(a){if(!a._offlineComponents)if(a._uninitializedComponentsProvider){Xt(nm,"Using user provided OfflineComponentProvider");try{await oM(a,a._uninitializedComponentsProvider._offline)}catch(n){const i=n;if(!function(l){return l.name==="FirebaseError"?l.code===Et.FAILED_PRECONDITION||l.code===Et.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;jv("Error using user provided cache. Falling back to memory cache: "+i),await oM(a,new kO)}}else Xt(nm,"Using default OfflineComponentProvider"),await oM(a,new OEe(void 0));return a._offlineComponents}async function Q7(a){return a._onlineComponents||(a._uninitializedComponentsProvider?(Xt(nm,"Using user provided OnlineComponentProvider"),await Rz(a,a._uninitializedComponentsProvider._online)):(Xt(nm,"Using default OnlineComponentProvider"),await Rz(a,new T2))),a._onlineComponents}function kEe(a){return Q7(a).then(n=>n.syncEngine)}async function Cz(a){const n=await Q7(a),i=n.eventManager;return i.onListen=_Ee.bind(null,n.syncEngine),i.onUnlisten=vEe.bind(null,n.syncEngine),i.onFirstRemoteStoreListen=EEe.bind(null,n.syncEngine),i.onLastRemoteStoreUnlisten=SEe.bind(null,n.syncEngine),i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $7(a){const n={};return a.timeoutSeconds!==void 0&&(n.timeoutSeconds=a.timeoutSeconds),n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Az=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J7(a,n,i){if(!i)throw new Qt(Et.INVALID_ARGUMENT,`Function ${a}() cannot be called with an empty ${n}.`)}function LEe(a,n,i,s){if(n===!0&&s===!0)throw new Qt(Et.INVALID_ARGUMENT,`${a} and ${i} cannot be used together.`)}function Iz(a){if(!En.isDocumentKey(a))throw new Qt(Et.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${a} has ${a.length}.`)}function Nz(a){if(En.isDocumentKey(a))throw new Qt(Et.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${a} has ${a.length}.`)}function CD(a){if(a===void 0)return"undefined";if(a===null)return"null";if(typeof a=="string")return a.length>20&&(a=`${a.substring(0,20)}...`),JSON.stringify(a);if(typeof a=="number"||typeof a=="boolean")return""+a;if(typeof a=="object"){if(a instanceof Array)return"an array";{const n=function(s){return s.constructor?s.constructor.name:null}(a);return n?`a custom ${n} object`:"an object"}}return typeof a=="function"?"a function":Ln(12329,{type:typeof a})}function xv(a,n){if("_delegate"in a&&(a=a._delegate),!(a instanceof n)){if(n.name===a.constructor.name)throw new Qt(Et.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=CD(a);throw new Qt(Et.INVALID_ARGUMENT,`Expected type '${n.name}', but it was: ${i}`)}}return a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z7="firestore.googleapis.com",Oz=!0;class Dz{constructor(n){var i,s;if(n.host===void 0){if(n.ssl!==void 0)throw new Qt(Et.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Z7,this.ssl=Oz}else this.host=n.host,this.ssl=(i=n.ssl)!==null&&i!==void 0?i:Oz;if(this.credentials=n.credentials,this.ignoreUndefinedProperties=!!n.ignoreUndefinedProperties,this.localCache=n.localCache,n.cacheSizeBytes===void 0)this.cacheSizeBytes=O7;else{if(n.cacheSizeBytes!==-1&&n.cacheSizeBytes<d_e)throw new Qt(Et.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=n.cacheSizeBytes}LEe("experimentalForceLongPolling",n.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",n.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!n.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:n.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!n.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=$7((s=n.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(p){if(p.timeoutSeconds!==void 0){if(isNaN(p.timeoutSeconds))throw new Qt(Et.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (must not be NaN)`);if(p.timeoutSeconds<5)throw new Qt(Et.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (minimum allowed value is 5)`);if(p.timeoutSeconds>30)throw new Qt(Et.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!n.useFetchStreams}isEqual(n){return this.host===n.host&&this.ssl===n.ssl&&this.credentials===n.credentials&&this.cacheSizeBytes===n.cacheSizeBytes&&this.experimentalForceLongPolling===n.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===n.experimentalAutoDetectLongPolling&&function(s,l){return s.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,n.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===n.ignoreUndefinedProperties&&this.useFetchStreams===n.useFetchStreams}}class AD{constructor(n,i,s,l){this._authCredentials=n,this._appCheckCredentials=i,this._databaseId=s,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Dz({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Qt(Et.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(n){if(this._settingsFrozen)throw new Qt(Et.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Dz(n),this._emulatorOptions=n.emulatorOptions||{},n.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new Bme;switch(s.type){case"firstParty":return new zme(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new Qt(Et.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(n.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const s=Az.get(i);s&&(Xt("ComponentProvider","Removing Datastore"),Az.delete(i),s.terminate())}(this),Promise.resolve()}}function MEe(a,n,i,s={}){var l;const p=(a=xv(a,AD))._getSettings(),_=Object.assign(Object.assign({},p),{emulatorOptions:a._getEmulatorOptions()}),T=`${n}:${i}`;p.host!==Z7&&p.host!==T&&jv("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const w=Object.assign(Object.assign({},p),{host:T,ssl:!1,emulatorOptions:s});if(!bO(w,_)&&(a._setSettings(w),s.mockUserToken)){let C,O;if(typeof s.mockUserToken=="string")C=s.mockUserToken,O=co.MOCK_USER;else{C=bK(s.mockUserToken,(l=a._app)===null||l===void 0?void 0:l.options.projectId);const k=s.mockUserToken.sub||s.mockUserToken.user_id;if(!k)throw new Qt(Et.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");O=new co(k)}a._authCredentials=new Hme(new HK(C,O))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V_{constructor(n,i,s){this.converter=i,this._query=s,this.type="query",this.firestore=n}withConverter(n){return new V_(this.firestore,n,this._query)}}class Vc{constructor(n,i,s){this.converter=i,this._key=s,this.type="document",this.firestore=n}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qf(this.firestore,this.converter,this._key.path.popLast())}withConverter(n){return new Vc(this.firestore,n,this._key)}}class qf extends V_{constructor(n,i,s){super(n,i,hj(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const n=this._path.popLast();return n.isEmpty()?null:new Vc(this.firestore,null,new En(n))}withConverter(n){return new qf(this.firestore,n,this._path)}}function cM(a,n,...i){if(a=jo(a),J7("collection","path",n),a instanceof AD){const s=Gi.fromString(n,...i);return Nz(s),new qf(a,null,s)}{if(!(a instanceof Vc||a instanceof qf))throw new Qt(Et.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=a._path.child(Gi.fromString(n,...i));return Nz(s),new qf(a.firestore,null,s)}}function eX(a,n,...i){if(a=jo(a),arguments.length===1&&(n=WK.newId()),J7("doc","path",n),a instanceof AD){const s=Gi.fromString(n,...i);return Iz(s),new Vc(a,null,new En(s))}{if(!(a instanceof Vc||a instanceof qf))throw new Qt(Et.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=a._path.child(Gi.fromString(n,...i));return Iz(s),new Vc(a.firestore,a instanceof qf?a.converter:null,new En(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xz="AsyncQueue";class Pz{constructor(n=Promise.resolve()){this.Qu=[],this.$u=!1,this.Uu=[],this.Ku=null,this.Wu=!1,this.Gu=!1,this.zu=[],this.y_=new k7(this,"async_queue_retry"),this.ju=()=>{const s=aM();s&&Xt(xz,"Visibility state changed to "+s.visibilityState),this.y_.A_()},this.Hu=n;const i=aM();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.ju)}get isShuttingDown(){return this.$u}enqueueAndForget(n){this.enqueue(n)}enqueueAndForgetEvenWhileRestricted(n){this.Ju(),this.Yu(n)}enterRestrictedMode(n){if(!this.$u){this.$u=!0,this.Gu=n||!1;const i=aM();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.ju)}}enqueue(n){if(this.Ju(),this.$u)return new Promise(()=>{});const i=new S_;return this.Yu(()=>this.$u&&this.Gu?Promise.resolve():(n().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(n){this.enqueueAndForget(()=>(this.Qu.push(n),this.Zu()))}async Zu(){if(this.Qu.length!==0){try{await this.Qu[0](),this.Qu.shift(),this.y_.reset()}catch(n){if(!aS(n))throw n;Xt(xz,"Operation failed with retryable error: "+n)}this.Qu.length>0&&this.y_.E_(()=>this.Zu())}}Yu(n){const i=this.Hu.then(()=>(this.Wu=!0,n().catch(s=>{throw this.Ku=s,this.Wu=!1,hp("INTERNAL UNHANDLED ERROR: ",kz(s)),s}).then(s=>(this.Wu=!1,s))));return this.Hu=i,i}enqueueAfterDelay(n,i,s){this.Ju(),this.zu.indexOf(n)>-1&&(i=0);const l=Cj.createAndSchedule(this,n,i,s,p=>this.Xu(p));return this.Uu.push(l),l}Ju(){this.Ku&&Ln(47125,{ec:kz(this.Ku)})}verifyOperationInProgress(){}async tc(){let n;do n=this.Hu,await n;while(n!==this.Hu)}nc(n){for(const i of this.Uu)if(i.timerId===n)return!0;return!1}rc(n){return this.tc().then(()=>{this.Uu.sort((i,s)=>i.targetTimeMs-s.targetTimeMs);for(const i of this.Uu)if(i.skipDelay(),n!=="all"&&i.timerId===n)break;return this.tc()})}sc(n){this.zu.push(n)}Xu(n){const i=this.Uu.indexOf(n);this.Uu.splice(i,1)}}function kz(a){let n=a.message||"";return a.stack&&(n=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lz(a){return function(i,s){if(typeof i!="object"||i===null)return!1;const l=i;for(const p of s)if(p in l&&typeof l[p]=="function")return!0;return!1}(a,["next","error","complete"])}class uR extends AD{constructor(n,i,s,l){super(n,i,s,l),this.type="firestore",this._queue=new Pz,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const n=this._firestoreClient.terminate();this._queue=new Pz(n),this._firestoreClient=void 0,await n}}}function jEe(a,n){const i=typeof a=="object"?a:xK(),s=typeof a=="string"?a:CO,l=IK(i,"firestore").getImmediate({identifier:s});if(!l._initialized){const p=SK("firestore");p&&MEe(l,...p)}return l}function Dj(a){if(a._terminated)throw new Qt(Et.FAILED_PRECONDITION,"The client has already been terminated.");return a._firestoreClient||UEe(a),a._firestoreClient}function UEe(a){var n,i,s;const l=a._freezeSettings(),p=function(T,w,C,O){return new age(T,w,C,O.host,O.ssl,O.experimentalForceLongPolling,O.experimentalAutoDetectLongPolling,$7(O.experimentalLongPollingOptions),O.useFetchStreams)}(a._databaseId,((n=a._app)===null||n===void 0?void 0:n.options.appId)||"",a._persistenceKey,l);a._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((s=l.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(a._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),a._firestoreClient=new xEe(a._authCredentials,a._appCheckCredentials,a._queue,p,a._componentsProvider&&function(T){const w=T==null?void 0:T._online.build();return{_offline:T==null?void 0:T._offline.build(w),_online:w}}(a._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gv{constructor(n){this._byteString=n}static fromBase64String(n){try{return new Gv(Ha.fromBase64String(n))}catch(i){throw new Qt(Et.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(n){return new Gv(Ha.fromUint8Array(n))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(n){return this._byteString.isEqual(n._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ID{constructor(...n){for(let i=0;i<n.length;++i)if(n[i].length===0)throw new Qt(Et.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ba(n)}isEqual(n){return this._internalPath.isEqual(n._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xj{constructor(n){this._methodName=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pj{constructor(n,i){if(!isFinite(n)||n<-90||n>90)throw new Qt(Et.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+n);if(!isFinite(i)||i<-180||i>180)throw new Qt(Et.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=n,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(n){return this._lat===n._lat&&this._long===n._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(n){return pr(this._lat,n._lat)||pr(this._long,n._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kj{constructor(n){this._values=(n||[]).map(i=>i)}toArray(){return this._values.map(n=>n)}isEqual(n){return function(s,l){if(s.length!==l.length)return!1;for(let p=0;p<s.length;++p)if(s[p]!==l[p])return!1;return!0}(this._values,n._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VEe=/^__.*__$/;class FEe{constructor(n,i,s){this.data=n,this.fieldMask=i,this.fieldTransforms=s}toMutation(n,i){return this.fieldMask!==null?new om(n,this.data,this.fieldMask,i,this.fieldTransforms):new TR(n,this.data,i,this.fieldTransforms)}}class tX{constructor(n,i,s){this.data=n,this.fieldMask=i,this.fieldTransforms=s}toMutation(n,i){return new om(n,this.data,this.fieldMask,i,this.fieldTransforms)}}function nX(a){switch(a){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ln(40011,{oc:a})}}class Lj{constructor(n,i,s,l,p,_){this.settings=n,this.databaseId=i,this.serializer=s,this.ignoreUndefinedProperties=l,p===void 0&&this._c(),this.fieldTransforms=p||[],this.fieldMask=_||[]}get path(){return this.settings.path}get oc(){return this.settings.oc}ac(n){return new Lj(Object.assign(Object.assign({},this.settings),n),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}uc(n){var i;const s=(i=this.path)===null||i===void 0?void 0:i.child(n),l=this.ac({path:s,cc:!1});return l.lc(n),l}hc(n){var i;const s=(i=this.path)===null||i===void 0?void 0:i.child(n),l=this.ac({path:s,cc:!1});return l._c(),l}Pc(n){return this.ac({path:void 0,cc:!0})}Tc(n){return LO(n,this.settings.methodName,this.settings.Ic||!1,this.path,this.settings.Ec)}contains(n){return this.fieldMask.find(i=>n.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>n.isPrefixOf(i.field))!==void 0}_c(){if(this.path)for(let n=0;n<this.path.length;n++)this.lc(this.path.get(n))}lc(n){if(n.length===0)throw this.Tc("Document fields must not be empty");if(nX(this.oc)&&VEe.test(n))throw this.Tc('Document fields cannot begin and end with "__"')}}class BEe{constructor(n,i,s){this.databaseId=n,this.ignoreUndefinedProperties=i,this.serializer=s||bD(n)}dc(n,i,s,l=!1){return new Lj({oc:n,methodName:i,Ec:s,path:Ba.emptyPath(),cc:!1,Ic:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Mj(a){const n=a._freezeSettings(),i=bD(a._databaseId);return new BEe(a._databaseId,!!n.ignoreUndefinedProperties,i)}function rX(a,n,i,s,l,p={}){const _=a.dc(p.merge||p.mergeFields?2:0,n,i,l);jj("Data must be an object, but it was:",_,s);const T=iX(s,_);let w,C;if(p.merge)w=new jc(_.fieldMask),C=_.fieldTransforms;else if(p.mergeFields){const O=[];for(const k of p.mergeFields){const U=b2(n,k,i);if(!_.contains(U))throw new Qt(Et.INVALID_ARGUMENT,`Field '${U}' is specified in your field mask but missing from your input data.`);aX(O,U)||O.push(U)}w=new jc(O),C=_.fieldTransforms.filter(k=>w.covers(k.field))}else w=null,C=_.fieldTransforms;return new FEe(new lc(T),w,C)}class ND extends xj{_toFieldTransform(n){if(n.oc!==2)throw n.oc===1?n.Tc(`${this._methodName}() can only appear at the top level of your update data`):n.Tc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return n.fieldMask.push(n.path),null}isEqual(n){return n instanceof ND}}function HEe(a,n,i,s){const l=a.dc(1,n,i);jj("Data must be an object, but it was:",l,s);const p=[],_=lc.empty();am(s,(w,C)=>{const O=Uj(n,w,i);C=jo(C);const k=l.hc(O);if(C instanceof ND)p.push(O);else{const U=CR(C,k);U!=null&&(p.push(O),_.set(O,U))}});const T=new jc(p);return new tX(_,T,l.fieldTransforms)}function GEe(a,n,i,s,l,p){const _=a.dc(1,n,i),T=[b2(n,s,i)],w=[l];if(p.length%2!=0)throw new Qt(Et.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let U=0;U<p.length;U+=2)T.push(b2(n,p[U])),w.push(p[U+1]);const C=[],O=lc.empty();for(let U=T.length-1;U>=0;--U)if(!aX(C,T[U])){const Y=T[U];let W=w[U];W=jo(W);const ee=_.hc(Y);if(W instanceof ND)C.push(Y);else{const K=CR(W,ee);K!=null&&(C.push(Y),O.set(Y,K))}}const k=new jc(C);return new tX(O,k,_.fieldTransforms)}function WEe(a,n,i,s=!1){return CR(i,a.dc(s?4:3,n))}function CR(a,n){if(sX(a=jo(a)))return jj("Unsupported field value:",n,a),iX(a,n);if(a instanceof xj)return function(s,l){if(!nX(l.oc))throw l.Tc(`${s._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Tc(`${s._methodName}() is not currently supported inside arrays`);const p=s._toFieldTransform(l);p&&l.fieldTransforms.push(p)}(a,n),null;if(a===void 0&&n.ignoreUndefinedProperties)return null;if(n.path&&n.fieldMask.push(n.path),a instanceof Array){if(n.settings.cc&&n.oc!==4)throw n.Tc("Nested arrays are not supported");return function(s,l){const p=[];let _=0;for(const T of s){let w=CR(T,l.Pc(_));w==null&&(w={nullValue:"NULL_VALUE"}),p.push(w),_++}return{arrayValue:{values:p}}}(a,n)}return function(s,l){if((s=jo(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return Nge(l.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const p=la.fromDate(s);return{timestampValue:DO(l.serializer,p)}}if(s instanceof la){const p=new la(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:DO(l.serializer,p)}}if(s instanceof Pj)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Gv)return{bytesValue:b7(l.serializer,s._byteString)};if(s instanceof Vc){const p=l.databaseId,_=s.firestore._databaseId;if(!_.isEqual(p))throw l.Tc(`Document reference is for database ${_.projectId}/${_.database} but should be for database ${p.projectId}/${p.database}`);return{referenceValue:_j(s.firestore._databaseId||l.databaseId,s._key.path)}}if(s instanceof kj)return function(_,T){return{mapValue:{fields:{[JK]:{stringValue:ZK},[AO]:{arrayValue:{values:_.toArray().map(C=>{if(typeof C!="number")throw T.Tc("VectorValues must only contain numeric values.");return pj(T.serializer,C)})}}}}}}(s,l);throw l.Tc(`Unsupported field value: ${CD(s)}`)}(a,n)}function iX(a,n){const i={};return YK(a)?n.path&&n.path.length>0&&n.fieldMask.push(n.path):am(a,(s,l)=>{const p=CR(l,n.uc(s));p!=null&&(i[s]=p)}),{mapValue:{fields:i}}}function sX(a){return!(typeof a!="object"||a===null||a instanceof Array||a instanceof Date||a instanceof la||a instanceof Pj||a instanceof Gv||a instanceof Vc||a instanceof xj||a instanceof kj)}function jj(a,n,i){if(!sX(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const s=CD(i);throw s==="an object"?n.Tc(a+" a custom object"):n.Tc(a+" "+s)}}function b2(a,n,i){if((n=jo(n))instanceof ID)return n._internalPath;if(typeof n=="string")return Uj(a,n);throw LO("Field path arguments must be of type string or ",a,!1,void 0,i)}const zEe=new RegExp("[~\\*/\\[\\]]");function Uj(a,n,i){if(n.search(zEe)>=0)throw LO(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,a,!1,void 0,i);try{return new ID(...n.split("."))._internalPath}catch{throw LO(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,a,!1,void 0,i)}}function LO(a,n,i,s,l){const p=s&&!s.isEmpty(),_=l!==void 0;let T=`Function ${n}() called with invalid data`;i&&(T+=" (via `toFirestore()`)"),T+=". ";let w="";return(p||_)&&(w+=" (found",p&&(w+=` in field ${s}`),_&&(w+=` in document ${l}`),w+=")"),new Qt(Et.INVALID_ARGUMENT,T+a+w)}function aX(a,n){return a.some(i=>i.isEqual(n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oX{constructor(n,i,s,l,p){this._firestore=n,this._userDataWriter=i,this._key=s,this._document=l,this._converter=p}get id(){return this._key.path.lastSegment()}get ref(){return new Vc(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const n=new YEe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(n)}return this._userDataWriter.convertValue(this._document.data.value)}}get(n){if(this._document){const i=this._document.data.field(OD("DocumentSnapshot.get",n));if(i!==null)return this._userDataWriter.convertValue(i)}}}class YEe extends oX{data(){return super.data()}}function OD(a,n){return typeof n=="string"?Uj(a,n):n instanceof ID?n._internalPath:n._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qEe(a){if(a.limitType==="L"&&a.explicitOrderBy.length===0)throw new Qt(Et.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Vj{}class cX extends Vj{}function Mz(a,n,...i){let s=[];n instanceof Vj&&s.push(n),s=s.concat(i),function(p){const _=p.filter(w=>w instanceof Fj).length,T=p.filter(w=>w instanceof DD).length;if(_>1||_>0&&T>0)throw new Qt(Et.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const l of s)a=l._apply(a);return a}class DD extends cX{constructor(n,i,s){super(),this._field=n,this._op=i,this._value=s,this.type="where"}static _create(n,i,s){return new DD(n,i,s)}_apply(n){const i=this._parse(n);return lX(n._query,i),new V_(n.firestore,n.converter,h2(n._query,i))}_parse(n){const i=Mj(n.firestore);return function(p,_,T,w,C,O,k){let U;if(C.isKeyField()){if(O==="array-contains"||O==="array-contains-any")throw new Qt(Et.INVALID_ARGUMENT,`Invalid Query. You can't perform '${O}' queries on documentId().`);if(O==="in"||O==="not-in"){Vz(k,O);const W=[];for(const ee of k)W.push(Uz(w,p,ee));U={arrayValue:{values:W}}}else U=Uz(w,p,k)}else O!=="in"&&O!=="not-in"&&O!=="array-contains-any"||Vz(k,O),U=WEe(T,_,k,O==="in"||O==="not-in");return ea.create(C,O,U)}(n._query,"where",i,n.firestore._databaseId,this._field,this._op,this._value)}}function jz(a,n,i){const s=n,l=OD("where",a);return DD._create(l,s,i)}class Fj extends Vj{constructor(n,i){super(),this.type=n,this._queryConstraints=i}static _create(n,i){return new Fj(n,i)}_parse(n){const i=this._queryConstraints.map(s=>s._parse(n)).filter(s=>s.getFilters().length>0);return i.length===1?i[0]:bd.create(i,this._getOperator())}_apply(n){const i=this._parse(n);return i.getFilters().length===0?n:(function(l,p){let _=l;const T=p.getFlattenedFilters();for(const w of T)lX(_,w),_=h2(_,w)}(n._query,i),new V_(n.firestore,n.converter,h2(n._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Bj extends cX{constructor(n,i){super(),this._field=n,this._direction=i,this.type="orderBy"}static _create(n,i){return new Bj(n,i)}_apply(n){const i=function(l,p,_){if(l.startAt!==null)throw new Qt(Et.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new Qt(Et.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new cR(p,_)}(n._query,this._field,this._direction);return new V_(n.firestore,n.converter,function(l,p){const _=l.explicitOrderBy.concat([p]);return new oS(l.path,l.collectionGroup,_,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(n._query,i))}}function KEe(a,n="asc"){const i=n,s=OD("orderBy",a);return Bj._create(s,i)}function Uz(a,n,i){if(typeof(i=jo(i))=="string"){if(i==="")throw new Qt(Et.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!o7(n)&&i.indexOf("/")!==-1)throw new Qt(Et.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const s=n.path.child(Gi.fromString(i));if(!En.isDocumentKey(s))throw new Qt(Et.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return X8(a,new En(s))}if(i instanceof Vc)return X8(a,i._key);throw new Qt(Et.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${CD(i)}.`)}function Vz(a,n){if(!Array.isArray(a)||a.length===0)throw new Qt(Et.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${n.toString()}' filters.`)}function lX(a,n){const i=function(l,p){for(const _ of l)for(const T of _.getFlattenedFilters())if(p.indexOf(T.op)>=0)return T.op;return null}(a.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(n.op));if(i!==null)throw i===n.op?new Qt(Et.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${n.op.toString()}' filter.`):new Qt(Et.INVALID_ARGUMENT,`Invalid query. You cannot use '${n.op.toString()}' filters with '${i.toString()}' filters.`)}class XEe{convertValue(n,i="none"){switch(em(n)){case 0:return null;case 1:return n.booleanValue;case 2:return js(n.integerValue||n.doubleValue);case 3:return this.convertTimestamp(n.timestampValue);case 4:return this.convertServerTimestamp(n,i);case 5:return n.stringValue;case 6:return this.convertBytes(Zf(n.bytesValue));case 7:return this.convertReference(n.referenceValue);case 8:return this.convertGeoPoint(n.geoPointValue);case 9:return this.convertArray(n.arrayValue,i);case 11:return this.convertObject(n.mapValue,i);case 10:return this.convertVectorValue(n.mapValue);default:throw Ln(62114,{value:n})}}convertObject(n,i){return this.convertObjectMap(n.fields,i)}convertObjectMap(n,i="none"){const s={};return am(n,(l,p)=>{s[l]=this.convertValue(p,i)}),s}convertVectorValue(n){var i,s,l;const p=(l=(s=(i=n.fields)===null||i===void 0?void 0:i[AO].arrayValue)===null||s===void 0?void 0:s.values)===null||l===void 0?void 0:l.map(_=>js(_.doubleValue));return new kj(p)}convertGeoPoint(n){return new Pj(js(n.latitude),js(n.longitude))}convertArray(n,i){return(n.values||[]).map(s=>this.convertValue(s,i))}convertServerTimestamp(n,i){switch(i){case"previous":const s=_D(n);return s==null?null:this.convertValue(s,i);case"estimate":return this.convertTimestamp(sR(n));default:return null}}convertTimestamp(n){const i=Jf(n);return new la(i.seconds,i.nanos)}convertDocumentKey(n,i){const s=Gi.fromString(n);si(N7(s),9688,{name:n});const l=new aR(s.get(1),s.get(3)),p=new En(s.popFirst(5));return l.isEqual(i)||hp(`Document ${p} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dX(a,n,i){let s;return s=a?i&&(i.merge||i.mergeFields)?a.toFirestore(n,i):a.toFirestore(n):n,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pw{constructor(n,i){this.hasPendingWrites=n,this.fromCache=i}isEqual(n){return this.hasPendingWrites===n.hasPendingWrites&&this.fromCache===n.fromCache}}class uX extends oX{constructor(n,i,s,l,p,_){super(n,i,s,l,_),this._firestore=n,this._firestoreImpl=n,this.metadata=p}exists(){return super.exists()}data(n={}){if(this._document){if(this._converter){const i=new eO(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,n)}return this._userDataWriter.convertValue(this._document.data.value,n.serverTimestamps)}}get(n,i={}){if(this._document){const s=this._document.data.field(OD("DocumentSnapshot.get",n));if(s!==null)return this._userDataWriter.convertValue(s,i.serverTimestamps)}}}class eO extends uX{data(n={}){return super.data(n)}}class QEe{constructor(n,i,s,l){this._firestore=n,this._userDataWriter=i,this._snapshot=l,this.metadata=new Pw(l.hasPendingWrites,l.fromCache),this.query=s}get docs(){const n=[];return this.forEach(i=>n.push(i)),n}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(n,i){this._snapshot.docs.forEach(s=>{n.call(i,new eO(this._firestore,this._userDataWriter,s.key,s,new Pw(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(n={}){const i=!!n.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new Qt(Et.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,p){if(l._snapshot.oldDocs.isEmpty()){let _=0;return l._snapshot.docChanges.map(T=>{const w=new eO(l._firestore,l._userDataWriter,T.doc.key,T.doc,new Pw(l._snapshot.mutatedKeys.has(T.doc.key),l._snapshot.fromCache),l.query.converter);return T.doc,{type:"added",doc:w,oldIndex:-1,newIndex:_++}})}{let _=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(T=>p||T.type!==3).map(T=>{const w=new eO(l._firestore,l._userDataWriter,T.doc.key,T.doc,new Pw(l._snapshot.mutatedKeys.has(T.doc.key),l._snapshot.fromCache),l.query.converter);let C=-1,O=-1;return T.type!==0&&(C=_.indexOf(T.doc.key),_=_.delete(T.doc.key)),T.type!==1&&(_=_.add(T.doc),O=_.indexOf(T.doc.key)),{type:$Ee(T.type),doc:w,oldIndex:C,newIndex:O}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function $Ee(a){switch(a){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ln(61501,{type:a})}}class hX extends XEe{constructor(n){super(),this.firestore=n}convertBytes(n){return new Gv(n)}convertReference(n){const i=this.convertDocumentKey(n,this.firestore._databaseId);return new Vc(this.firestore,null,i)}}function JEe(a,n){const i=xv(a.firestore,uR),s=eX(a),l=dX(a.converter,n);return pX(i,[rX(Mj(a.firestore),"addDoc",s._key,l,a.converter!==null,{}).toMutation(s._key,Pl.exists(!1))]).then(()=>s)}function Fz(a,...n){var i,s,l;a=jo(a);let p={includeMetadataChanges:!1,source:"default"},_=0;typeof n[_]!="object"||Lz(n[_])||(p=n[_],_++);const T={includeMetadataChanges:p.includeMetadataChanges,source:p.source};if(Lz(n[_])){const k=n[_];n[_]=(i=k.next)===null||i===void 0?void 0:i.bind(k),n[_+1]=(s=k.error)===null||s===void 0?void 0:s.bind(k),n[_+2]=(l=k.complete)===null||l===void 0?void 0:l.bind(k)}let w,C,O;if(a instanceof Vc)C=xv(a.firestore,uR),O=hj(a._key.path),w={next:k=>{n[_]&&n[_](ZEe(C,a,k))},error:n[_+1],complete:n[_+2]};else{const k=xv(a,V_);C=xv(k.firestore,uR),O=k._query;const U=new hX(C);w={next:Y=>{n[_]&&n[_](new QEe(C,U,k,Y))},error:n[_+1],complete:n[_+2]},qEe(a._query)}return function(U,Y,W,ee){const K=new DEe(ee),ie=new hEe(Y,K,W);return U.asyncQueue.enqueueAndForget(async()=>cEe(await Cz(U),ie)),()=>{K.yu(),U.asyncQueue.enqueueAndForget(async()=>lEe(await Cz(U),ie))}}(Dj(C),O,T,w)}function pX(a,n){return function(s,l){const p=new S_;return s.asyncQueue.enqueueAndForget(async()=>TEe(await kEe(s),l,p)),p.promise}(Dj(a),n)}function ZEe(a,n,i){const s=i.docs.get(n._key),l=new hX(a);return new uX(a,l,n._key,s,new Pw(i.hasPendingWrites,i.fromCache),n.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eye{constructor(n,i){this._firestore=n,this._commitHandler=i,this._mutations=[],this._committed=!1,this._dataReader=Mj(n)}set(n,i,s){this._verifyNotCommitted();const l=lM(n,this._firestore),p=dX(l.converter,i,s),_=rX(this._dataReader,"WriteBatch.set",l._key,p,l.converter!==null,s);return this._mutations.push(_.toMutation(l._key,Pl.none())),this}update(n,i,s,...l){this._verifyNotCommitted();const p=lM(n,this._firestore);let _;return _=typeof(i=jo(i))=="string"||i instanceof ID?GEe(this._dataReader,"WriteBatch.update",p._key,i,s,l):HEe(this._dataReader,"WriteBatch.update",p._key,i),this._mutations.push(_.toMutation(p._key,Pl.exists(!0))),this}delete(n){this._verifyNotCommitted();const i=lM(n,this._firestore);return this._mutations=this._mutations.concat(new fj(i._key,Pl.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Qt(Et.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function lM(a,n){if((a=jo(a)).firestore!==n)throw new Qt(Et.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tye(a){return Dj(a=xv(a,uR)),new eye(a,n=>pX(a,n))}(function(n,i=!0){(function(l){iS=l})(OK),nR(new Mv("firestore",(s,{instanceIdentifier:l,options:p})=>{const _=s.getProvider("app").getImmediate(),T=new uR(new Gme(s.getProvider("auth-internal")),new Yme(_,s.getProvider("app-check-internal")),function(C,O){if(!Object.prototype.hasOwnProperty.apply(C.options,["projectId"]))throw new Qt(Et.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new aR(C.options.projectId,O)}(_,l),_);return p=Object.assign({useFetchStreams:i},p),T._setSettings(p),T},"PUBLIC").setMultipleInstances(!0)),zf(j8,U8,n),zf(j8,U8,"esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fX="firebasestorage.googleapis.com",mX="storageBucket",nye=2*60*1e3,rye=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts extends M_{constructor(n,i,s=0){super(dM(n),`Firebase Storage: ${i} (${dM(n)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ts.prototype)}get status(){return this.status_}set status(n){this.status_=n}_codeEquals(n){return dM(n)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(n){this.customData.serverResponse=n,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var vs;(function(a){a.UNKNOWN="unknown",a.OBJECT_NOT_FOUND="object-not-found",a.BUCKET_NOT_FOUND="bucket-not-found",a.PROJECT_NOT_FOUND="project-not-found",a.QUOTA_EXCEEDED="quota-exceeded",a.UNAUTHENTICATED="unauthenticated",a.UNAUTHORIZED="unauthorized",a.UNAUTHORIZED_APP="unauthorized-app",a.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",a.INVALID_CHECKSUM="invalid-checksum",a.CANCELED="canceled",a.INVALID_EVENT_NAME="invalid-event-name",a.INVALID_URL="invalid-url",a.INVALID_DEFAULT_BUCKET="invalid-default-bucket",a.NO_DEFAULT_BUCKET="no-default-bucket",a.CANNOT_SLICE_BLOB="cannot-slice-blob",a.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",a.NO_DOWNLOAD_URL="no-download-url",a.INVALID_ARGUMENT="invalid-argument",a.INVALID_ARGUMENT_COUNT="invalid-argument-count",a.APP_DELETED="app-deleted",a.INVALID_ROOT_OPERATION="invalid-root-operation",a.INVALID_FORMAT="invalid-format",a.INTERNAL_ERROR="internal-error",a.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(vs||(vs={}));function dM(a){return"storage/"+a}function Hj(){const a="An unknown error occurred, please check the error payload for server response.";return new Ts(vs.UNKNOWN,a)}function iye(a){return new Ts(vs.OBJECT_NOT_FOUND,"Object '"+a+"' does not exist.")}function sye(a){return new Ts(vs.QUOTA_EXCEEDED,"Quota for bucket '"+a+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function aye(){const a="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Ts(vs.UNAUTHENTICATED,a)}function oye(){return new Ts(vs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function cye(a){return new Ts(vs.UNAUTHORIZED,"User does not have permission to access '"+a+"'.")}function lye(){return new Ts(vs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function dye(){return new Ts(vs.CANCELED,"User canceled the upload/download.")}function uye(a){return new Ts(vs.INVALID_URL,"Invalid URL '"+a+"'.")}function hye(a){return new Ts(vs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+a+"'.")}function pye(){return new Ts(vs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+mX+"' property when initializing the app?")}function fye(){return new Ts(vs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function mye(){return new Ts(vs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function gye(a){return new Ts(vs.UNSUPPORTED_ENVIRONMENT,`${a} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function w2(a){return new Ts(vs.INVALID_ARGUMENT,a)}function gX(){return new Ts(vs.APP_DELETED,"The Firebase app was deleted.")}function _ye(a){return new Ts(vs.INVALID_ROOT_OPERATION,"The operation '"+a+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Qw(a,n){return new Ts(vs.INVALID_FORMAT,"String does not match format '"+a+"': "+n)}function Tw(a){throw new Ts(vs.INTERNAL_ERROR,"Internal error: "+a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{constructor(n,i){this.bucket=n,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const n=encodeURIComponent;return"/b/"+n(this.bucket)+"/o/"+n(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(n,i){let s;try{s=Uc.makeFromUrl(n,i)}catch{return new Uc(n,"")}if(s.path==="")return s;throw hye(n)}static makeFromUrl(n,i){let s=null;const l="([A-Za-z0-9.\\-_]+)";function p(ye){ye.path.charAt(ye.path.length-1)==="/"&&(ye.path_=ye.path_.slice(0,-1))}const _="(/(.*))?$",T=new RegExp("^gs://"+l+_,"i"),w={bucket:1,path:3};function C(ye){ye.path_=decodeURIComponent(ye.path)}const O="v[A-Za-z0-9_]+",k=i.replace(/[.]/g,"\\."),U="(/([^?#]*).*)?$",Y=new RegExp(`^https?://${k}/${O}/b/${l}/o${U}`,"i"),W={bucket:1,path:3},ee=i===fX?"(?:storage.googleapis.com|storage.cloud.google.com)":i,K="([^?#]*)",ie=new RegExp(`^https?://${ee}/${l}/${K}`,"i"),ue=[{regex:T,indices:w,postModify:p},{regex:Y,indices:W,postModify:C},{regex:ie,indices:{bucket:1,path:2},postModify:C}];for(let ye=0;ye<ue.length;ye++){const ae=ue[ye],ve=ae.regex.exec(n);if(ve){const $=ve[ae.indices.bucket];let Q=ve[ae.indices.path];Q||(Q=""),s=new Uc($,Q),ae.postModify(s);break}}if(s==null)throw uye(n);return s}}class Eye{constructor(n){this.promise_=Promise.reject(n)}getPromise(){return this.promise_}cancel(n=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yye(a,n,i){let s=1,l=null,p=null,_=!1,T=0;function w(){return T===2}let C=!1;function O(...K){C||(C=!0,n.apply(null,K))}function k(K){l=setTimeout(()=>{l=null,a(Y,w())},K)}function U(){p&&clearTimeout(p)}function Y(K,...ie){if(C){U();return}if(K){U(),O.call(null,K,...ie);return}if(w()||_){U(),O.call(null,K,...ie);return}s<64&&(s*=2);let ue;T===1?(T=2,ue=0):ue=(s+Math.random())*1e3,k(ue)}let W=!1;function ee(K){W||(W=!0,U(),!C&&(l!==null?(K||(T=2),clearTimeout(l),k(0)):K||(T=1)))}return k(0),p=setTimeout(()=>{_=!0,ee(!0)},i),ee}function vye(a){a(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sye(a){return a!==void 0}function Tye(a){return typeof a=="object"&&!Array.isArray(a)}function Gj(a){return typeof a=="string"||a instanceof String}function Bz(a){return Wj()&&a instanceof Blob}function Wj(){return typeof Blob<"u"}function Hz(a,n,i,s){if(s<n)throw w2(`Invalid value for '${a}'. Expected ${n} or greater.`);if(s>i)throw w2(`Invalid value for '${a}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zj(a,n,i){let s=n;return i==null&&(s=`https://${n}`),`${i}://${s}/v0${a}`}function _X(a){const n=encodeURIComponent;let i="?";for(const s in a)if(a.hasOwnProperty(s)){const l=n(s)+"="+n(a[s]);i=i+l+"&"}return i=i.slice(0,-1),i}var T_;(function(a){a[a.NO_ERROR=0]="NO_ERROR",a[a.NETWORK_ERROR=1]="NETWORK_ERROR",a[a.ABORT=2]="ABORT"})(T_||(T_={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bye(a,n){const i=a>=500&&a<600,l=[408,429].indexOf(a)!==-1,p=n.indexOf(a)!==-1;return i||l||p}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wye{constructor(n,i,s,l,p,_,T,w,C,O,k,U=!0){this.url_=n,this.method_=i,this.headers_=s,this.body_=l,this.successCodes_=p,this.additionalRetryCodes_=_,this.callback_=T,this.errorCallback_=w,this.timeout_=C,this.progressCallback_=O,this.connectionFactory_=k,this.retry=U,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((Y,W)=>{this.resolve_=Y,this.reject_=W,this.start_()})}start_(){const n=(s,l)=>{if(l){s(!1,new iN(!1,null,!0));return}const p=this.connectionFactory_();this.pendingConnection_=p;const _=T=>{const w=T.loaded,C=T.lengthComputable?T.total:-1;this.progressCallback_!==null&&this.progressCallback_(w,C)};this.progressCallback_!==null&&p.addUploadProgressListener(_),p.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&p.removeUploadProgressListener(_),this.pendingConnection_=null;const T=p.getErrorCode()===T_.NO_ERROR,w=p.getStatus();if(!T||bye(w,this.additionalRetryCodes_)&&this.retry){const O=p.getErrorCode()===T_.ABORT;s(!1,new iN(!1,null,O));return}const C=this.successCodes_.indexOf(w)!==-1;s(!0,new iN(C,p))})},i=(s,l)=>{const p=this.resolve_,_=this.reject_,T=l.connection;if(l.wasSuccessCode)try{const w=this.callback_(T,T.getResponse());Sye(w)?p(w):p()}catch(w){_(w)}else if(T!==null){const w=Hj();w.serverResponse=T.getErrorText(),this.errorCallback_?_(this.errorCallback_(T,w)):_(w)}else if(l.canceled){const w=this.appDelete_?gX():dye();_(w)}else{const w=lye();_(w)}};this.canceled_?i(!1,new iN(!1,null,!0)):this.backoffId_=yye(n,i,this.timeout_)}getPromise(){return this.promise_}cancel(n){this.canceled_=!0,this.appDelete_=n||!1,this.backoffId_!==null&&vye(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class iN{constructor(n,i,s){this.wasSuccessCode=n,this.connection=i,this.canceled=!!s}}function Rye(a,n){n!==null&&n.length>0&&(a.Authorization="Firebase "+n)}function Cye(a,n){a["X-Firebase-Storage-Version"]="webjs/"+(n??"AppManager")}function Aye(a,n){n&&(a["X-Firebase-GMPID"]=n)}function Iye(a,n){n!==null&&(a["X-Firebase-AppCheck"]=n)}function Nye(a,n,i,s,l,p,_=!0){const T=_X(a.urlParams),w=a.url+T,C=Object.assign({},a.headers);return Aye(C,n),Rye(C,i),Cye(C,p),Iye(C,s),new wye(w,a.method,C,a.body,a.successCodes,a.additionalRetryCodes,a.handler,a.errorHandler,a.timeout,a.progressCallback,l,_)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oye(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function Dye(...a){const n=Oye();if(n!==void 0){const i=new n;for(let s=0;s<a.length;s++)i.append(a[s]);return i.getBlob()}else{if(Wj())return new Blob(a);throw new Ts(vs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function xye(a,n,i){return a.webkitSlice?a.webkitSlice(n,i):a.mozSlice?a.mozSlice(n,i):a.slice?a.slice(n,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pye(a){if(typeof atob>"u")throw gye("base-64");return atob(a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lu={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class uM{constructor(n,i){this.data=n,this.contentType=i||null}}function kye(a,n){switch(a){case Lu.RAW:return new uM(EX(n));case Lu.BASE64:case Lu.BASE64URL:return new uM(yX(a,n));case Lu.DATA_URL:return new uM(Mye(n),jye(n))}throw Hj()}function EX(a){const n=[];for(let i=0;i<a.length;i++){let s=a.charCodeAt(i);if(s<=127)n.push(s);else if(s<=2047)n.push(192|s>>6,128|s&63);else if((s&64512)===55296)if(!(i<a.length-1&&(a.charCodeAt(i+1)&64512)===56320))n.push(239,191,189);else{const p=s,_=a.charCodeAt(++i);s=65536|(p&1023)<<10|_&1023,n.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63)}else(s&64512)===56320?n.push(239,191,189):n.push(224|s>>12,128|s>>6&63,128|s&63)}return new Uint8Array(n)}function Lye(a){let n;try{n=decodeURIComponent(a)}catch{throw Qw(Lu.DATA_URL,"Malformed data URL.")}return EX(n)}function yX(a,n){switch(a){case Lu.BASE64:{const l=n.indexOf("-")!==-1,p=n.indexOf("_")!==-1;if(l||p)throw Qw(a,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Lu.BASE64URL:{const l=n.indexOf("+")!==-1,p=n.indexOf("/")!==-1;if(l||p)throw Qw(a,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");n=n.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=Pye(n)}catch(l){throw l.message.includes("polyfill")?l:Qw(a,"Invalid character found")}const s=new Uint8Array(i.length);for(let l=0;l<i.length;l++)s[l]=i.charCodeAt(l);return s}class vX{constructor(n){this.base64=!1,this.contentType=null;const i=n.match(/^data:([^,]+)?,/);if(i===null)throw Qw(Lu.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const s=i[1]||null;s!=null&&(this.base64=Uye(s,";base64"),this.contentType=this.base64?s.substring(0,s.length-7):s),this.rest=n.substring(n.indexOf(",")+1)}}function Mye(a){const n=new vX(a);return n.base64?yX(Lu.BASE64,n.rest):Lye(n.rest)}function jye(a){return new vX(a).contentType}function Uye(a,n){return a.length>=n.length?a.substring(a.length-n.length)===n:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{constructor(n,i){let s=0,l="";Bz(n)?(this.data_=n,s=n.size,l=n.type):n instanceof ArrayBuffer?(i?this.data_=new Uint8Array(n):(this.data_=new Uint8Array(n.byteLength),this.data_.set(new Uint8Array(n))),s=this.data_.length):n instanceof Uint8Array&&(i?this.data_=n:(this.data_=new Uint8Array(n.length),this.data_.set(n)),s=n.length),this.size_=s,this.type_=l}size(){return this.size_}type(){return this.type_}slice(n,i){if(Bz(this.data_)){const s=this.data_,l=xye(s,n,i);return l===null?null:new Ff(l)}else{const s=new Uint8Array(this.data_.buffer,n,i-n);return new Ff(s,!0)}}static getBlob(...n){if(Wj()){const i=n.map(s=>s instanceof Ff?s.data_:s);return new Ff(Dye.apply(null,i))}else{const i=n.map(_=>Gj(_)?kye(Lu.RAW,_).data:_.data_);let s=0;i.forEach(_=>{s+=_.byteLength});const l=new Uint8Array(s);let p=0;return i.forEach(_=>{for(let T=0;T<_.length;T++)l[p++]=_[T]}),new Ff(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SX(a){let n;try{n=JSON.parse(a)}catch{return null}return Tye(n)?n:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vye(a){if(a.length===0)return null;const n=a.lastIndexOf("/");return n===-1?"":a.slice(0,n)}function Fye(a,n){const i=n.split("/").filter(s=>s.length>0).join("/");return a.length===0?i:a+"/"+i}function TX(a){const n=a.lastIndexOf("/",a.length-2);return n===-1?a:a.slice(n+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bye(a,n){return n}class Po{constructor(n,i,s,l){this.server=n,this.local=i||n,this.writable=!!s,this.xform=l||Bye}}let sN=null;function Hye(a){return!Gj(a)||a.length<2?a:TX(a)}function bX(){if(sN)return sN;const a=[];a.push(new Po("bucket")),a.push(new Po("generation")),a.push(new Po("metageneration")),a.push(new Po("name","fullPath",!0));function n(p,_){return Hye(_)}const i=new Po("name");i.xform=n,a.push(i);function s(p,_){return _!==void 0?Number(_):_}const l=new Po("size");return l.xform=s,a.push(l),a.push(new Po("timeCreated")),a.push(new Po("updated")),a.push(new Po("md5Hash",null,!0)),a.push(new Po("cacheControl",null,!0)),a.push(new Po("contentDisposition",null,!0)),a.push(new Po("contentEncoding",null,!0)),a.push(new Po("contentLanguage",null,!0)),a.push(new Po("contentType",null,!0)),a.push(new Po("metadata","customMetadata",!0)),sN=a,sN}function Gye(a,n){function i(){const s=a.bucket,l=a.fullPath,p=new Uc(s,l);return n._makeStorageReference(p)}Object.defineProperty(a,"ref",{get:i})}function Wye(a,n,i){const s={};s.type="file";const l=i.length;for(let p=0;p<l;p++){const _=i[p];s[_.local]=_.xform(s,n[_.server])}return Gye(s,a),s}function wX(a,n,i){const s=SX(n);return s===null?null:Wye(a,s,i)}function zye(a,n,i,s){const l=SX(n);if(l===null||!Gj(l.downloadTokens))return null;const p=l.downloadTokens;if(p.length===0)return null;const _=encodeURIComponent;return p.split(",").map(C=>{const O=a.bucket,k=a.fullPath,U="/b/"+_(O)+"/o/"+_(k),Y=zj(U,i,s),W=_X({alt:"media",token:C});return Y+W})[0]}function Yye(a,n){const i={},s=n.length;for(let l=0;l<s;l++){const p=n[l];p.writable&&(i[p.server]=a[p.local])}return JSON.stringify(i)}class RX{constructor(n,i,s,l){this.url=n,this.method=i,this.handler=s,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CX(a){if(!a)throw Hj()}function qye(a,n){function i(s,l){const p=wX(a,l,n);return CX(p!==null),p}return i}function Kye(a,n){function i(s,l){const p=wX(a,l,n);return CX(p!==null),zye(p,l,a.host,a._protocol)}return i}function AX(a){function n(i,s){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=oye():l=aye():i.getStatus()===402?l=sye(a.bucket):i.getStatus()===403?l=cye(a.path):l=s,l.status=i.getStatus(),l.serverResponse=s.serverResponse,l}return n}function Xye(a){const n=AX(a);function i(s,l){let p=n(s,l);return s.getStatus()===404&&(p=iye(a.path)),p.serverResponse=l.serverResponse,p}return i}function Qye(a,n,i){const s=n.fullServerUrl(),l=zj(s,a.host,a._protocol),p="GET",_=a.maxOperationRetryTime,T=new RX(l,p,Kye(a,i),_);return T.errorHandler=Xye(n),T}function $ye(a,n){return a&&a.contentType||n&&n.type()||"application/octet-stream"}function Jye(a,n,i){const s=Object.assign({},i);return s.fullPath=a.path,s.size=n.size(),s.contentType||(s.contentType=$ye(null,n)),s}function Zye(a,n,i,s,l){const p=n.bucketOnlyServerUrl(),_={"X-Goog-Upload-Protocol":"multipart"};function T(){let ue="";for(let ye=0;ye<2;ye++)ue=ue+Math.random().toString().slice(2);return ue}const w=T();_["Content-Type"]="multipart/related; boundary="+w;const C=Jye(n,s,l),O=Yye(C,i),k="--"+w+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+O+`\r
--`+w+`\r
Content-Type: `+C.contentType+`\r
\r
`,U=`\r
--`+w+"--",Y=Ff.getBlob(k,s,U);if(Y===null)throw fye();const W={name:C.fullPath},ee=zj(p,a.host,a._protocol),K="POST",ie=a.maxUploadRetryTime,se=new RX(ee,K,qye(a,i),ie);return se.urlParams=W,se.headers=_,se.body=Y.uploadData(),se.errorHandler=AX(n),se}class eve{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=T_.NO_ERROR,this.sendPromise_=new Promise(n=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=T_.ABORT,n()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=T_.NETWORK_ERROR,n()}),this.xhr_.addEventListener("load",()=>{n()})})}send(n,i,s,l){if(this.sent_)throw Tw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,n,!0),l!==void 0)for(const p in l)l.hasOwnProperty(p)&&this.xhr_.setRequestHeader(p,l[p].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Tw("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Tw("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Tw("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Tw("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(n){return this.xhr_.getResponseHeader(n)}addUploadProgressListener(n){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",n)}removeUploadProgressListener(n){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",n)}}class tve extends eve{initXhr(){this.xhr_.responseType="text"}}function IX(){return new tve}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x_{constructor(n,i){this._service=n,i instanceof Uc?this._location=i:this._location=Uc.makeFromUrl(i,n.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(n,i){return new x_(n,i)}get root(){const n=new Uc(this._location.bucket,"");return this._newRef(this._service,n)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return TX(this._location.path)}get storage(){return this._service}get parent(){const n=Vye(this._location.path);if(n===null)return null;const i=new Uc(this._location.bucket,n);return new x_(this._service,i)}_throwIfRoot(n){if(this._location.path==="")throw _ye(n)}}function nve(a,n,i){a._throwIfRoot("uploadBytes");const s=Zye(a.storage,a._location,bX(),new Ff(n,!0),i);return a.storage.makeRequestWithTokens(s,IX).then(l=>({metadata:l,ref:a}))}function rve(a){a._throwIfRoot("getDownloadURL");const n=Qye(a.storage,a._location,bX());return a.storage.makeRequestWithTokens(n,IX).then(i=>{if(i===null)throw mye();return i})}function ive(a,n){const i=Fye(a._location.path,n),s=new Uc(a._location.bucket,i);return new x_(a.storage,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sve(a){return/^[A-Za-z]+:\/\//.test(a)}function ave(a,n){return new x_(a,n)}function NX(a,n){if(a instanceof Yj){const i=a;if(i._bucket==null)throw pye();const s=new x_(i,i._bucket);return n!=null?NX(s,n):s}else return n!==void 0?ive(a,n):a}function ove(a,n){if(n&&sve(n)){if(a instanceof Yj)return ave(a,n);throw w2("To use ref(service, url), the first argument must be a Storage instance.")}else return NX(a,n)}function Gz(a,n){const i=n==null?void 0:n[mX];return i==null?null:Uc.makeFromBucketSpec(i,a)}function cve(a,n,i,s={}){a.host=`${n}:${i}`,a._protocol="http";const{mockUserToken:l}=s;l&&(a._overrideAuthToken=typeof l=="string"?l:bK(l,a.app.options.projectId))}class Yj{constructor(n,i,s,l,p){this.app=n,this._authProvider=i,this._appCheckProvider=s,this._url=l,this._firebaseVersion=p,this._bucket=null,this._host=fX,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=nye,this._maxUploadRetryTime=rye,this._requests=new Set,l!=null?this._bucket=Uc.makeFromBucketSpec(l,this._host):this._bucket=Gz(this._host,this.app.options)}get host(){return this._host}set host(n){this._host=n,this._url!=null?this._bucket=Uc.makeFromBucketSpec(this._url,n):this._bucket=Gz(n,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(n){Hz("time",0,Number.POSITIVE_INFINITY,n),this._maxUploadRetryTime=n}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(n){Hz("time",0,Number.POSITIVE_INFINITY,n),this._maxOperationRetryTime=n}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const n=this._authProvider.getImmediate({optional:!0});if(n){const i=await n.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(NK(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=this._appCheckProvider.getImmediate({optional:!0});return n?(await n.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(n=>n.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(n){return new x_(this,n)}_makeRequest(n,i,s,l,p=!0){if(this._deleted)return new Eye(gX());{const _=Nye(n,this._appId,s,l,i,this._firebaseVersion,p);return this._requests.add(_),_.getPromise().then(()=>this._requests.delete(_),()=>this._requests.delete(_)),_}}async makeRequestWithTokens(n,i){const[s,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(n,i,s,l).getPromise()}}const Wz="@firebase/storage",zz="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OX="storage";function lve(a,n,i){return a=jo(a),nve(a,n,i)}function dve(a){return a=jo(a),rve(a)}function uve(a,n){return a=jo(a),ove(a,n)}function hve(a=xK(),n){a=jo(a);const s=IK(a,OX).getImmediate({identifier:n}),l=SK("storage");return l&&pve(s,...l),s}function pve(a,n,i,s={}){cve(a,n,i,s)}function fve(a,{instanceIdentifier:n}){const i=a.getProvider("app").getImmediate(),s=a.getProvider("auth-internal"),l=a.getProvider("app-check-internal");return new Yj(i,s,l,n,OK)}function mve(){nR(new Mv(OX,fve,"PUBLIC").setMultipleInstances(!0)),zf(Wz,zz,""),zf(Wz,zz,"esm2017")}mve();const Ua=[];for(let a=0;a<256;++a)Ua.push((a+256).toString(16).slice(1));function gve(a,n=0){return(Ua[a[n+0]]+Ua[a[n+1]]+Ua[a[n+2]]+Ua[a[n+3]]+"-"+Ua[a[n+4]]+Ua[a[n+5]]+"-"+Ua[a[n+6]]+Ua[a[n+7]]+"-"+Ua[a[n+8]]+Ua[a[n+9]]+"-"+Ua[a[n+10]]+Ua[a[n+11]]+Ua[a[n+12]]+Ua[a[n+13]]+Ua[a[n+14]]+Ua[a[n+15]]).toLowerCase()}let hM;const _ve=new Uint8Array(16);function Eve(){if(!hM){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");hM=crypto.getRandomValues.bind(crypto)}return hM(_ve)}const yve=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Yz={randomUUID:yve};function vve(a,n,i){var l;if(Yz.randomUUID&&!a)return Yz.randomUUID();a=a||{};const s=a.random??((l=a.rng)==null?void 0:l.call(a))??Eve();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,gve(s)}var Sve="firebase",Tve="11.6.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zf(Sve,Tve,"app");const bve={apiKey:"AIzaSyCiNsVroKUMWkDhkJHsAZOzWk1LRJ7xhwc",authDomain:"awpl-connect.firebaseapp.com",projectId:"awpl-connect",storageBucket:"awpl-connect.firebasestorage.app",messagingSenderId:"112089804788",appId:"1:112089804788:web:46a038ed92ca81d91413a1",measurementId:"G-NYP0G4B40L"},DX=DK(bve),bw=jEe(DX),wve=hve(DX),Rve=a=>{if(typeof a!="string")return!1;const n=/\.(jpg|jpeg|png|gif|webp|bmp|tiff|svg)(\?.*)?(#.*)?$/i;return(a.startsWith("http://")||a.startsWith("https://"))&&n.test(a)};function Cve({chat_id:a,senderImg:n,receiverImg:i}){const[s,l]=F.useState([]),[p,_]=F.useState(""),[T,w]=F.useState(null),[C,O]=F.useState(!1),k=F.useRef(null),U=a,Y=a.split("_"),W=Y[1],ee=Y[2],K=ae=>ae?new Date(ae).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}):"",ie=(ae,ve)=>{if(!ae||!ve)return!1;const $=new Date(ae),Q=new Date(ve);return $.getFullYear()===Q.getFullYear()&&$.getMonth()===Q.getMonth()&&$.getDate()===Q.getDate()};F.useEffect(()=>{if(!U){console.warn("chatId is missing, skipping message fetch.");return}const ae=Mz(cM(bw,"chats",U,"messages"),KEe("timestamp","asc")),ve=Fz(ae,$=>{const Q=$.docs.map(te=>({id:te.id,...te.data()}));l(Q)});return()=>ve()},[U]),F.useEffect(()=>{k.current&&(k.current.scrollTop=k.current.scrollHeight)},[s]),F.useEffect(()=>{if(!U||!W||!ee)return;const ae=Mz(cM(bw,"chats",U,"messages"),jz("senderId","==",ee),jz("seen","==",!1)),ve=Fz(ae,$=>{if(!$.empty){const Q=tye(bw);$.docs.forEach(te=>{const oe=eX(bw,"chats",U,"messages",te.id);Q.update(oe,{seen:!0})}),Q.commit().then(()=>{}).catch(te=>{console.error("Error marking messages as seen:",te)})}});return()=>ve()},[U,W,ee]);const se=ae=>{ae.target.files[0]&&w(ae.target.files[0])},ue=()=>{w(null);const ae=document.getElementById("fileInput");ae&&(ae.value="")},ye=async ae=>{if(ae.preventDefault(),!p.trim()&&!T)return;O(!0);const ve=Date.now();let $={senderId:W,receiverId:ee,timestamp:ve,seen:!1,type:"text"};try{if(T){const Q=`chat_images/${U}/${vve()}-${T.name}`,te=uve(wve,Q),oe=await lve(te,T),re=await dve(oe.ref);$={...$,type:"image",message:re}}else $={...$,type:"text",message:p};await JEe(cM(bw,"chats",U,"messages"),$),_(""),w(null),ue()}catch(Q){console.error("Error sending message:",Q)}finally{O(!1)}};return m.jsx("div",{className:"completed-appoint-scrn-right col-lg-6",children:m.jsx("div",{className:"completed-appoint-chat-scrn",children:m.jsxs("div",{className:"chat-container",style:{padding:"20px",maxHeight:"600px"},children:[m.jsx("div",{className:"chat-messages",ref:k,style:{height:"400px",overflowY:"scroll",marginBottom:"10px",WebkitOverflowScrolling:"touch",overflowX:"hidden"},children:s.map((ae,ve)=>{var pe,Ne,Je,be;const $=ae.senderId===W,Q="#DAEFF9",te=$?"flex-end":"flex-start",oe={borderTopLeftRadius:"12px",borderTopRightRadius:"4px",borderBottomLeftRadius:"12px",borderBottomRightRadius:"12px"},re={borderTopLeftRadius:"4px",borderTopRightRadius:"12px",borderBottomLeftRadius:"12px",borderBottomRightRadius:"12px"};let fe=!1;if(ae.timestamp)if(ve===0)fe=!0;else{const Ie=s[ve-1],Re=(pe=Ie.timestamp)!=null&&pe.toDate?Ie.timestamp.toDate().getTime():Ie.timestamp,Me=(Ne=ae.timestamp)!=null&&Ne.toDate?ae.timestamp.toDate().getTime():ae.timestamp;Ie&&Re?fe=!ie(Me,Re):fe=!0}return m.jsxs(Ge.Fragment,{children:[fe&&m.jsxs("div",{style:{textAlign:"center",margin:"20px 0 10px",position:"relative",fontSize:"13px",color:"#666"},children:[m.jsx("span",{style:{backgroundColor:"#f0f2f5",padding:"5px 12px",borderRadius:"15px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:K((Je=ae.timestamp)!=null&&Je.toDate?ae.timestamp.toDate().getTime():ae.timestamp)}),m.jsx("div",{style:{position:"absolute",top:"50%",left:"0",right:"0",height:"1px",backgroundColor:"#e0e0e0",zIndex:-1}})]}),m.jsxs("div",{style:{display:"flex",justifyContent:te,margin:"8px 0",alignItems:"flex-end"},children:[!$&&m.jsx("div",{style:{marginRight:"8px"},children:m.jsx("img",{src:i,alt:"Receiver Avatar",style:{width:"40px",height:"40px",borderRadius:"50%",objectFit:"cover"}})}),m.jsxs("div",{style:{padding:"10px 14px",backgroundColor:Q,maxWidth:"70%",fontSize:"14px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",wordBreak:"break-word",...$?oe:re},children:[Rve(ae.message)?m.jsx("img",{src:ae.message,alt:"Message attachment",style:{maxWidth:"100%",width:"200px",height:"250px",objectFit:"cover",borderRadius:"8px",display:"block"},onError:Ie=>{console.error("Error loading image from URL:",Ie.target.src),Ie.target.style.display="none"}}):ae.message&&m.jsx("div",{children:ae.message}),m.jsxs("div",{style:{fontSize:"10px",color:"#666",marginTop:"6px",textAlign:$?"right":"left",display:"flex",alignItems:"center",justifyContent:$?"flex-end":"flex-start",gap:"4px",alignSelf:"flex-end"},children:[ae.timestamp?new Date((be=ae.timestamp)!=null&&be.toDate?ae.timestamp.toDate().getTime():ae.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",$&&(ae.seen?m.jsx("span",{style:{color:"#007bff",marginLeft:"4px"},children:""}):m.jsx("span",{style:{color:"#888",marginLeft:"4px"},children:""}))]})]}),$&&m.jsx("div",{style:{marginLeft:"8px"},children:m.jsx("img",{src:n,alt:"Sender Avatar",style:{width:"40px",height:"40px",borderRadius:"50%",objectFit:"cover"}})})]})]},ae.id)})}),T&&m.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px",backgroundColor:"#f9f9f9",borderRadius:"8px",marginBottom:"10px",border:"1px solid #eee"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[m.jsx("img",{src:URL.createObjectURL(T),alt:"Selected preview",style:{width:"50px",height:"50px",objectFit:"cover",borderRadius:"4px",marginRight:"10px"}}),m.jsx("span",{style:{fontSize:"13px",color:"#555"},children:T.name})]}),m.jsx("button",{type:"button",onClick:ue,style:{background:"none",border:"none",color:"#ff4d4d",fontSize:"20px",cursor:"pointer",padding:"5px",lineHeight:"1"},disabled:C,children:""})]}),m.jsxs("form",{onSubmit:ye,className:"chat-footer",style:{display:"flex",alignItems:"center",gap:"10px"},children:[m.jsxs("div",{className:"chat-input",style:{flex:1,position:"relative"},children:[m.jsx("input",{type:"text",value:p,onChange:ae=>_(ae.target.value),placeholder:C?"Uploading image...":"Type a message",style:{width:"100%",padding:"10px 45px 10px 15px",borderRadius:"30px",border:"1px solid #ccc"},disabled:C}),m.jsxs("div",{className:"chat-file-upld",style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)"},children:[m.jsx("input",{type:"file",style:{display:"none"},id:"fileInput",accept:"image/*",onChange:se,disabled:C}),m.jsx("label",{htmlFor:"fileInput",className:"attach-btn",style:{cursor:"pointer"},children:m.jsx("img",{src:"./images/attach-icon.svg",alt:"Attach"})})]})]}),m.jsx("button",{type:"submit",className:"send-btn",disabled:C||!p.trim()&&!T,children:m.jsx("img",{src:"./images/send-icon.svg",alt:"Icon"})})]})]})})})}const Ave=()=>{var ee,K,ie,se,ue,ye,ae,ve,$,Q,te;const a=Wi();ds();const{id:n,patientId:i,appointmentId:s,chat_id:l,ds_code:p,referred:_,prescription_id:T}=a.state||{},{user:w}=Tr(({user:oe})=>oe),C=Li(),{completeAppointmentPatientDetail:O,prescription_Download:k,loading:U,error:Y}=Tr(oe=>oe.prescriptions);F.useEffect(()=>{n&&C(qN({appointmentId:n}))},[C,n]),F.useEffect(()=>{C(ep())},[]);const W=()=>{C(zw({prescriptionId:T})).then(oe=>{if(zw.fulfilled.match(oe)){const re=new Blob([oe.payload],{type:"application/pdf"}),fe=window.URL.createObjectURL(re),pe=document.createElement("a");pe.href=fe,pe.setAttribute("download",`prescription-${n}.pdf`),document.body.appendChild(pe),pe.click(),document.body.removeChild(pe),window.URL.revokeObjectURL(fe)}})};return m.jsx(m.Fragment,{children:m.jsx("main",{className:"doctor-panel",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(Ga,{})}),U?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsx("div",{className:"doc-panel-body appoint-details-pg",children:m.jsxs("div",{className:"completed-appoint-scrn",children:[m.jsxs("div",{className:"docpnl-sec-head",children:[m.jsx("h1",{className:"h2-title",children:"Prescription Details"}),m.jsx("div",{className:"back-btn",children:m.jsx(dn,{to:"#",onClick:oe=>{oe.preventDefault(),window.history.back()},children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),console.log(T,"****************"),m.jsxs("div",{className:"row",children:[m.jsx("div",{className:"col-lg-6"}),m.jsx("div",{className:"col-lg-6",children:m.jsx("div",{className:"chat-header",children:m.jsx(Pi,{style:{backgroundColor:"#f47820",border:"none"},disabled:!T,className:"orange-btn",onClick:()=>W(),children:"Download Prescription"})})})]}),m.jsxs("div",{className:"completed-appoint-scrn-inr row",children:[m.jsxs("div",{className:"completed-appoint-scrn-left col-lg-6",style:{marginTop:"-100px"},children:[m.jsxs("div",{className:"apointment-detail-card cmn-mb2 mb-4",children:[m.jsx("div",{className:"apoint-dtl-img",children:m.jsx("img",{src:`${mi}/${(ee=O==null?void 0:O.patientData)==null?void 0:ee.patient_image}`,alt:"Client",style:{height:120}})}),m.jsxs("div",{className:"appoint-dtl-content",children:[m.jsxs("div",{className:"appoint-dtl-left",children:[m.jsxs("div",{className:"appoint-dtl-head",children:[m.jsx("h2",{className:"h4-title",children:(K=O==null?void 0:O.patientData)==null?void 0:K.patient_name}),_==!0?m.jsxs("p",{children:["(Referred by DS Code:"," ",m.jsx("span",{style:{color:"#199FD9"},children:p}),")"]}):m.jsxs("p",{style:{fontWeight:"bold"},children:["(DS Code:"," ",m.jsx("span",{style:{color:"#199FD9"},children:p}),")"]})]}),m.jsx("div",{className:"date h3-title",children:(ie=O==null?void 0:O.patientData)==null?void 0:ie.dayDate}),m.jsx("div",{className:"time",children:(se=O==null?void 0:O.patientData)==null?void 0:se.time})]}),m.jsx(dn,{to:"/patient-profile",state:{patientId:i,source:"completed",hideSchedule:!1},className:"cmn-btn",children:"View profile"})]})]}),m.jsx("div",{className:"patient-details-wrp",children:m.jsx("form",{children:m.jsx("div",{className:"patient-dtl-form",children:m.jsxs("div",{className:"patient-basic-info",children:[m.jsx("h2",{children:"Basic Information"}),m.jsxs("div",{className:"row",children:[m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Full Name"}),m.jsx("input",{type:"text",value:((ue=O==null?void 0:O.basicInformation)==null?void 0:ue.patient_fullname)||"",readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Height"}),m.jsx("input",{type:"text",value:((ye=O==null?void 0:O.basicInformation)==null?void 0:ye.Patient_height)||"",readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Weight"}),m.jsx("input",{type:"text",value:((ae=O==null?void 0:O.basicInformation)==null?void 0:ae.Patient_weight)||"",readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Gender"}),m.jsx("input",{type:"text",value:((ve=O==null?void 0:O.basicInformation)==null?void 0:ve.Patient_gender.charAt(0).toUpperCase())+(($=O==null?void 0:O.basicInformation)==null?void 0:$.Patient_gender.slice(1))||"",readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Age"}),m.jsx("input",{type:"text",value:((Q=O==null?void 0:O.basicInformation)==null?void 0:Q.patient_age)||"",readOnly:!0})]})})]})]})})})})]}),m.jsx(Cve,{chat_id:l,senderImg:Mc.BaseUrl+(w==null?void 0:w.profile_path),receiverImg:`${mi}/${(te=O==null?void 0:O.patientData)==null?void 0:te.patient_image}`})]})]})}),m.jsx(po,{})]})})})};var tO={exports:{}},Ive=tO.exports,qz;function Nve(){return qz||(qz=1,function(a,n){(function(i,s){a.exports=s()})(Ive,function(){function i(e,t){return t.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(r,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return r[o]}})}})}),Object.freeze(e)}var s=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof mL<"u"?mL:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var p=function(e){try{return!!e()}catch{return!0}},_=!p(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),T=_,w=Function.prototype,C=w.call,O=T&&w.bind.bind(C,C),k=T?O:function(e){return function(){return C.apply(e,arguments)}},U=k({}.isPrototypeOf),Y=function(e){return e&&e.Math===Math&&e},W=Y(typeof globalThis=="object"&&globalThis)||Y(typeof window=="object"&&window)||Y(typeof self=="object"&&self)||Y(typeof s=="object"&&s)||Y(typeof s=="object"&&s)||function(){return this}()||Function("return this")(),ee=_,K=Function.prototype,ie=K.apply,se=K.call,ue=typeof Reflect=="object"&&Reflect.apply||(ee?se.bind(ie):function(){return se.apply(ie,arguments)}),ye=k,ae=ye({}.toString),ve=ye("".slice),$=function(e){return ve(ae(e),8,-1)},Q=$,te=k,oe=function(e){if(Q(e)==="Function")return te(e)},re=typeof document=="object"&&document.all,fe=re===void 0&&re!==void 0?function(e){return typeof e=="function"||e===re}:function(e){return typeof e=="function"},pe={},Ne=!p(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Je=_,be=Function.prototype.call,Ie=Je?be.bind(be):function(){return be.apply(be,arguments)},Re={},Me={}.propertyIsEnumerable,he=Object.getOwnPropertyDescriptor,De=he&&!Me.call({1:2},1);Re.f=De?function(e){var t=he(this,e);return!!t&&t.enumerable}:Me;var qe,We,Be=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},bt=p,St=$,Tt=Object,ut=k("".split),tn=bt(function(){return!Tt("z").propertyIsEnumerable(0)})?function(e){return St(e)==="String"?ut(e,""):Tt(e)}:Tt,Mt=function(e){return e==null},wn=Mt,Yt=TypeError,Xn=function(e){if(wn(e))throw new Yt("Can't call method on "+e);return e},Ot=tn,en=Xn,Dt=function(e){return Ot(en(e))},mt=fe,kt=function(e){return typeof e=="object"?e!==null:mt(e)},Gt={},Mn=Gt,Ci=W,bs=fe,Rr=function(e){return bs(e)?e:void 0},kn=function(e,t){return arguments.length<2?Rr(Mn[e])||Rr(Ci[e]):Mn[e]&&Mn[e][t]||Ci[e]&&Ci[e][t]},Mi=W.navigator,Ht=Mi&&Mi.userAgent,sn=Ht?String(Ht):"",wt=W,mn=sn,jn=wt.process,Ei=wt.Deno,ai=jn&&jn.versions||Ei&&Ei.version,Cr=ai&&ai.v8;Cr&&(We=(qe=Cr.split("."))[0]>0&&qe[0]<4?1:+(qe[0]+qe[1])),!We&&mn&&(!(qe=mn.match(/Edge\/(\d+)/))||qe[1]>=74)&&(qe=mn.match(/Chrome\/(\d+)/))&&(We=+qe[1]);var ji=We,zi=ji,ws=p,ua=W.String,Fs=!!Object.getOwnPropertySymbols&&!ws(function(){var e=Symbol("symbol detection");return!ua(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&zi&&zi<41}),Wa=Fs&&!Symbol.sham&&typeof Symbol.iterator=="symbol",je=kn,nn=fe,yn=U,nr=Object,Qe=Wa?function(e){return typeof e=="symbol"}:function(e){var t=je("Symbol");return nn(t)&&yn(t.prototype,nr(e))},Kt=String,un=function(e){try{return Kt(e)}catch{return"Object"}},rn=fe,Dn=un,Ai=TypeError,ln=function(e){if(rn(e))return e;throw new Ai(Dn(e)+" is not a function")},mr=ln,yr=Mt,oi=function(e,t){var r=e[t];return yr(r)?void 0:mr(r)},Bs=Ie,fo=fe,Hs=kt,Gc=TypeError,za={exports:{}},Ra=W,Uo=Object.defineProperty,mo=W,go=function(e,t){try{Uo(Ra,e,{value:t,configurable:!0,writable:!0})}catch{Ra[e]=t}return t},Rs="__core-js_shared__",Ui=za.exports=mo[Rs]||go(Rs,{});(Ui.versions||(Ui.versions=[])).push({version:"3.41.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.41.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Wu=za.exports,zu=Wu,ha=function(e,t){return zu[e]||(zu[e]=t||{})},Ll=Xn,B_=Object,_o=function(e){return B_(Ll(e))},Yu=_o,H_=k({}.hasOwnProperty),ci=Object.hasOwn||function(e,t){return H_(Yu(e),t)},Wc=k,ta=0,qu=Math.random(),G_=Wc(1 .toString),hc=function(e){return"Symbol("+(e===void 0?"":e)+")_"+G_(++ta+qu,36)},_p=ha,Ku=ci,cm=hc,Ep=Fs,Ca=Wa,zc=W.Symbol,lm=_p("wks"),yp=Ca?zc.for||zc:zc&&zc.withoutSetter||cm,Mr=function(e){return Ku(lm,e)||(lm[e]=Ep&&Ku(zc,e)?zc[e]:yp("Symbol."+e)),lm[e]},Xu=Ie,W_=kt,es=Qe,Eo=oi,Qu=function(e,t){var r,o;if(fo(r=e.toString)&&!Hs(o=Bs(r,e))||fo(r=e.valueOf)&&!Hs(o=Bs(r,e)))return o;throw new Gc("Can't convert object to primitive value")},Ad=TypeError,Ml=Mr("toPrimitive"),Zr=function(e,t){if(!W_(e)||es(e))return e;var r,o=Eo(e,Ml);if(o){if(r=Xu(o,e,t),!W_(r)||es(r))return r;throw new Ad("Can't convert object to primitive value")}return Qu(e)},$u=Qe,Ya=function(e){var t=Zr(e,"string");return $u(t)?t:t+""},Id=kt,vp=W.document,dm=Id(vp)&&Id(vp.createElement),Ju=function(e){return dm?vp.createElement(e):{}},dS=Ju,z_=!Ne&&!p(function(){return Object.defineProperty(dS("div"),"a",{get:function(){return 7}}).a!==7}),Sp=Ne,jl=Ie,Vo=Re,Ul=Be,Vl=Dt,um=Ya,Yc=ci,Y_=z_,Nd=Object.getOwnPropertyDescriptor;pe.f=Sp?Nd:function(e,t){if(e=Vl(e),t=um(t),Y_)try{return Nd(e,t)}catch{}if(Yc(e,t))return Ul(!jl(Vo.f,e,t),e[t])};var pc=p,Fo=fe,Zu=/#|\.prototype\./,qa=function(e,t){var r=Fl[Od(e)];return r===qc||r!==hm&&(Fo(t)?pc(t):!!t)},Od=qa.normalize=function(e){return String(e).replace(Zu,".").toLowerCase()},Fl=qa.data={},hm=qa.NATIVE="N",qc=qa.POLYFILL="P",fc=qa,pm=ln,Gs=_,Yr=oe(oe.bind),yo=function(e,t){return pm(e),t===void 0?e:Gs?Yr(e,t):function(){return e.apply(t,arguments)}},Ws={},fm=Ne&&p(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Tp=kt,bp=String,Kc=TypeError,ts=function(e){if(Tp(e))return e;throw new Kc(bp(e)+" is not an object")},Bo=Ne,q_=z_,uS=fm,Xc=ts,eh=Ya,mm=TypeError,Dd=Object.defineProperty,K_=Object.getOwnPropertyDescriptor,xd="enumerable",gm="configurable",th="writable";Ws.f=Bo?uS?function(e,t,r){if(Xc(e),t=eh(t),Xc(r),typeof e=="function"&&t==="prototype"&&"value"in r&&th in r&&!r[th]){var o=K_(e,t);o&&o[th]&&(e[t]=r.value,r={configurable:gm in r?r[gm]:o[gm],enumerable:xd in r?r[xd]:o[xd],writable:!1})}return Dd(e,t,r)}:Dd:function(e,t,r){if(Xc(e),t=eh(t),Xc(r),q_)try{return Dd(e,t,r)}catch{}if("get"in r||"set"in r)throw new mm("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var nh=Ws,X_=Be,Qc=Ne?function(e,t,r){return nh.f(e,t,X_(1,r))}:function(e,t,r){return e[t]=r,e},Bl=W,rh=ue,Q_=oe,wp=fe,$_=pe.f,_m=fc,Ka=Gt,J_=yo,Hl=Qc,Em=ci,Z_=function(e){var t=function(r,o,c){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,o)}return new e(r,o,c)}return rh(e,this,arguments)};return t.prototype=e.prototype,t},xn=function(e,t){var r,o,c,u,f,g,E,v,S,R=e.target,I=e.global,D=e.stat,V=e.proto,M=I?Bl:D?Bl[R]:Bl[R]&&Bl[R].prototype,j=I?Ka:Ka[R]||Hl(Ka,R,{})[R],G=j.prototype;for(u in t)o=!(r=_m(I?u:R+(D?".":"#")+u,e.forced))&&M&&Em(M,u),g=j[u],o&&(E=e.dontCallGetSet?(S=$_(M,u))&&S.value:M[u]),f=o&&E?E:t[u],(r||V||typeof g!=typeof f)&&(v=e.bind&&o?J_(f,Bl):e.wrap&&o?Z_(f):V&&wp(f)?Q_(f):f,(e.sham||f&&f.sham||g&&g.sham)&&Hl(v,"sham",!0),Hl(j,u,v),V&&(Em(Ka,c=R+"Prototype")||Hl(Ka,c,{}),Hl(Ka[c],u,f),e.real&&G&&(r||!G[u])&&Hl(G,u,f)))},Aa=Math.ceil,eE=Math.floor,tE=Math.trunc||function(e){var t=+e;return(t>0?eE:Aa)(t)},$c=tE,A=function(e){var t=+e;return t!=t||t===0?0:$c(t)},B=A,X=Math.max,ge=Math.min,Ue=function(e,t){var r=B(e);return r<0?X(r+t,0):ge(r,t)},Ze=A,It=Math.min,vr=function(e){var t=Ze(e);return t>0?It(t,9007199254740991):0},Cs=vr,Yn=function(e){return Cs(e.length)},zs=Dt,As=Ue,Gl=Yn,Ys=function(e){return function(t,r,o){var c=zs(t),u=Gl(c);if(u===0)return!e&&-1;var f,g=As(o,u);if(e&&r!=r){for(;u>g;)if((f=c[g++])!=f)return!0}else for(;u>g;g++)if((e||g in c)&&c[g]===r)return e||g||0;return!e&&-1}},Ho={includes:Ys(!0),indexOf:Ys(!1)},ym=Ho.includes;xn({target:"Array",proto:!0,forced:p(function(){return!Array(1).includes()})},{includes:function(e){return ym(this,e,arguments.length>1?arguments[1]:void 0)}});var nE=W,DR=Gt,vo=function(e,t){var r=DR[e+"Prototype"],o=r&&r[t];if(o)return o;var c=nE[e],u=c&&c.prototype;return u&&u[t]},hS=vo("Array","includes"),pS=kt,xR=$,PR=Mr("match"),fS=function(e){var t;return pS(e)&&((t=e[PR])!==void 0?!!t:xR(e)==="RegExp")},BD=fS,HD=TypeError,kR={};kR[Mr("toStringTag")]="z";var mS=String(kR)==="[object z]",GD=mS,So=fe,Pd=$,LR=Mr("toStringTag"),MR=Object,jR=Pd(function(){return arguments}())==="Arguments",Wl=GD?Pd:function(e){var t,r,o;return e===void 0?"Undefined":e===null?"Null":typeof(r=function(c,u){try{return c[u]}catch{}}(t=MR(e),LR))=="string"?r:jR?Pd(t):(o=Pd(t))==="Object"&&So(t.callee)?"Arguments":o},gS=Wl,WD=String,Is=function(e){if(gS(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return WD(e)},_S=Mr("match"),vm=xn,ES=function(e){if(BD(e))throw new HD("The method doesn't accept regular expressions");return e},UR=Xn,kd=Is,Rp=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[_S]=!1,"/./"[e](t)}catch{}}return!1},yS=k("".indexOf);vm({target:"String",proto:!0,forced:!Rp("includes")},{includes:function(e){return!!~yS(kd(UR(this)),kd(ES(e)),arguments.length>1?arguments[1]:void 0)}});var VR=vo("String","includes"),Ld=U,FR=hS,BR=VR,rE=Array.prototype,vS=String.prototype,zD=function(e){var t=e.includes;return e===rE||Ld(rE,e)&&t===rE.includes?FR:typeof e=="string"||e===vS||Ld(vS,e)&&t===vS.includes?BR:t},et=l(zD),HR=ln,GR=_o,SS=tn,mc=Yn,TS=TypeError,To="Reduce of empty array with no initial value",Go=function(e){return function(t,r,o,c){var u=GR(t),f=SS(u),g=mc(u);if(HR(r),g===0&&o<2)throw new TS(To);var E=e?g-1:0,v=e?-1:1;if(o<2)for(;;){if(E in f){c=f[E],E+=v;break}if(E+=v,e?E<0:g<=E)throw new TS(To)}for(;e?E>=0:g>E;E+=v)E in f&&(c=r(c,f[E],E,u));return c}},Cp={left:Go(!1)},bS=p,ih=function(e,t){var r=[][e];return!!r&&bS(function(){r.call(null,t||function(){return 1},1)})},Md=W,wS=sn,Ap=$,Sm=function(e){return wS.slice(0,e.length)===e},Ip=Sm("Bun/")?"BUN":Sm("Cloudflare-Workers")?"CLOUDFLARE":Sm("Deno/")?"DENO":Sm("Node.js/")?"NODE":Md.Bun&&typeof Bun.version=="string"?"BUN":Md.Deno&&typeof Deno.version=="object"?"DENO":Ap(Md.process)==="process"?"NODE":Md.window&&Md.document?"BROWSER":"REST",zl=Ip==="NODE",YD=Cp.left;xn({target:"Array",proto:!0,forced:!zl&&ji>79&&ji<83||!ih("reduce")},{reduce:function(e){var t=arguments.length;return YD(this,e,t,t>1?arguments[1]:void 0)}});var bo=vo("Array","reduce"),RS=U,Yl=bo,iE=Array.prototype,sE=function(e){var t=e.reduce;return e===iE||RS(iE,e)&&t===iE.reduce?Yl:t},jd=sE,Xa=l(jd),CS=$,Jc=Array.isArray||function(e){return CS(e)==="Array"},Np=xn,aE=Jc,oE=k([].reverse),wo=[1,2];Np({target:"Array",proto:!0,forced:String(wo)===String(wo.reverse())},{reverse:function(){return aE(this)&&(this.length=this.length),oE(this)}});var Wo=vo("Array","reverse"),sh=U,ql=Wo,gc=Array.prototype,ah=function(e){var t=e.reverse;return e===gc||sh(gc,e)&&t===gc.reverse?ql:t},AS=ah,cE=l(AS),IS=hc,pa=ha("keys"),Ii=function(e){return pa[e]||(pa[e]=IS(e))},jr=!p(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),oh=ci,Zc=fe,NS=_o,ch=jr,OS=Ii("IE_PROTO"),lE=Object,Tm=lE.prototype,lh=ch?lE.getPrototypeOf:function(e){var t=NS(e);if(oh(t,OS))return t[OS];var r=t.constructor;return Zc(r)&&t instanceof r?r.prototype:t instanceof lE?Tm:null},WR=k,bm=ln,DS=kt,dh=function(e){return DS(e)||e===null},Kl=String,Ud=TypeError,Xl=function(e,t,r){try{return WR(bm(Object.getOwnPropertyDescriptor(e,t)[r]))}catch{}},xS=kt,PS=Xn,wm=function(e){if(dh(e))return e;throw new Ud("Can't set "+Kl(e)+" as a prototype")},dE=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Xl(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch{}return function(o,c){return PS(o),wm(c),xS(o)&&(t?e(o,c):o.__proto__=c),o}}():void 0),el={},Ns={},Op=ci,zR=Dt,qD=Ho.indexOf,KD=Ns,YR=k([].push),us=function(e,t){var r,o=zR(e),c=0,u=[];for(r in o)!Op(KD,r)&&Op(o,r)&&YR(u,r);for(;t.length>c;)Op(o,r=t[c++])&&(~qD(u,r)||YR(u,r));return u},Rm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Cm=us,Am=Rm.concat("length","prototype");el.f=Object.getOwnPropertyNames||function(e){return Cm(e,Am)};var uh={};uh.f=Object.getOwnPropertySymbols;var Dp=kn,xp=el,XD=uh,qR=ts,QD=k([].concat),KR=Dp("Reflect","ownKeys")||function(e){var t=xp.f(qR(e)),r=XD.f;return r?QD(t,r(e)):t},Vd=ci,kS=KR,uE=pe,XR=Ws,hh={},QR=us,hE=Rm,Pp=Object.keys||function(e){return QR(e,hE)},$R=Ne,pE=fm,JR=Ws,Im=ts,ZR=Dt,e0=Pp;hh.f=$R&&!pE?Object.defineProperties:function(e,t){Im(e);for(var r,o=ZR(t),c=e0(t),u=c.length,f=0;u>f;)JR.f(e,r=c[f++],o[r]);return e};var _c,fE=kn("document","documentElement"),LS=ts,Fd=hh,Ql=Rm,Nm=Ns,MS=fE,jS=Ju,ph="prototype",fh="script",US=Ii("IE_PROTO"),mE=function(){},mh=function(e){return"<"+fh+">"+e+"</"+fh+">"},Om=function(e){e.write(mh("")),e.close();var t=e.parentWindow.Object;return e=null,t},Dm=function(){try{_c=new ActiveXObject("htmlfile")}catch{}var e,t,r;Dm=typeof document<"u"?document.domain&&_c?Om(_c):(t=jS("iframe"),r="java"+fh+":",t.style.display="none",MS.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(mh("document.F=Object")),e.close(),e.F):Om(_c);for(var o=Ql.length;o--;)delete Dm[ph][Ql[o]];return Dm()};Nm[US]=!0;var gh=Object.create||function(e,t){var r;return e!==null?(mE[ph]=LS(e),r=new mE,mE[ph]=null,r[US]=e):r=Dm(),t===void 0?r:Fd.f(r,t)},VS=kt,Bd=Qc,Qn=Error,ei=k("".replace),hs=String(new Qn("zxcasd").stack),xm=/\n\s*at [^:]*:[^\n]*/,kp=xm.test(hs),_h=Be,gE=!p(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",_h(1,7)),e.stack!==7)}),Pm=Qc,Lp=function(e,t){if(kp&&typeof e=="string"&&!Qn.prepareStackTrace)for(;t--;)e=ei(e,xm,"");return e},$D=gE,Yi=Error.captureStackTrace,Hd={},FS=Hd,t0=Mr("iterator"),n0=Array.prototype,r0=function(e){return e!==void 0&&(FS.Array===e||n0[t0]===e)},BS=Wl,_E=oi,HS=Mt,Qa=Hd,ps=Mr("iterator"),Mp=function(e){if(!HS(e))return _E(e,ps)||_E(e,"@@iterator")||Qa[BS(e)]},km=Ie,EE=ln,GS=ts,$l=un,yE=Mp,WS=TypeError,Lm=function(e,t){var r=arguments.length<2?yE(e):t;if(EE(r))return GS(km(r,e));throw new WS($l(e)+" is not iterable")},i0=Ie,zS=ts,s0=oi,YS=function(e,t,r){var o,c;zS(e);try{if(!(o=s0(e,"return"))){if(t==="throw")throw r;return r}o=i0(o,e)}catch(u){c=!0,o=u}if(t==="throw")throw r;if(c)throw o;return zS(o),r},a0=yo,o0=Ie,qS=ts,c0=un,JD=r0,l0=Yn,KS=U,d0=Lm,XS=Mp,QS=YS,u0=TypeError,Mm=function(e,t){this.stopped=e,this.result=t},$S=Mm.prototype,jp=function(e,t,r){var o,c,u,f,g,E,v,S=r&&r.that,R=!(!r||!r.AS_ENTRIES),I=!(!r||!r.IS_RECORD),D=!(!r||!r.IS_ITERATOR),V=!(!r||!r.INTERRUPTED),M=a0(t,S),j=function(z){return o&&QS(o,"normal",z),new Mm(!0,z)},G=function(z){return R?(qS(z),V?M(z[0],z[1],j):M(z[0],z[1])):V?M(z,j):M(z)};if(I)o=e.iterator;else if(D)o=e;else{if(!(c=XS(e)))throw new u0(c0(e)+" is not iterable");if(JD(c)){for(u=0,f=l0(e);f>u;u++)if((g=G(e[u]))&&KS($S,g))return g;return new Mm(!1)}o=d0(e,c)}for(E=I?e.next:o.next;!(v=o0(E,o)).done;){try{g=G(v.value)}catch(z){QS(o,"throw",z)}if(typeof g=="object"&&g&&KS($S,g))return g}return new Mm(!1)},ZD=Is,h0=xn,Up=U,vE=lh,jm=dE,SE=function(e,t,r){for(var o=kS(t),c=XR.f,u=uE.f,f=0;f<o.length;f++){var g=o[f];Vd(e,g)||r&&Vd(r,g)||c(e,g,u(t,g))}},Vp=gh,TE=Qc,bE=Be,p0=function(e,t){VS(t)&&"cause"in t&&Bd(e,"cause",t.cause)},f0=function(e,t,r,o){$D&&(Yi?Yi(e,t):Pm(e,"stack",Lp(r,o)))},m0=jp,g0=function(e,t){return e===void 0?arguments.length<2?"":t:ZD(e)},JS=Mr("toStringTag"),Um=Error,_0=[].push,Gd=function(e,t){var r,o=Up(wE,this);jm?r=jm(new Um,o?vE(this):wE):(r=o?this:Vp(wE),TE(r,JS,"Error")),t!==void 0&&TE(r,"message",g0(t)),f0(r,Gd,r.stack,1),arguments.length>2&&p0(r,arguments[2]);var c=[];return m0(e,_0,{that:c}),TE(r,"errors",c),r};jm?jm(Gd,Um):SE(Gd,Um,{name:!0});var wE=Gd.prototype=Vp(Um.prototype,{constructor:bE(1,Gd),message:bE(1,""),name:bE(1,"AggregateError")});h0({global:!0},{AggregateError:Gd});var Vm,Fm,Fp,E0=fe,ZS=W.WeakMap,eT=E0(ZS)&&/native code/.test(String(ZS)),tT=W,y0=kt,ex=Qc,nT=ci,RE=Wu,Bm=Ii,rT=Ns,Hm="Object already initialized",CE=tT.TypeError,v0=tT.WeakMap;if(eT||RE.state){var Ro=RE.state||(RE.state=new v0);Ro.get=Ro.get,Ro.has=Ro.has,Ro.set=Ro.set,Vm=function(e,t){if(Ro.has(e))throw new CE(Hm);return t.facade=e,Ro.set(e,t),t},Fm=function(e){return Ro.get(e)||{}},Fp=function(e){return Ro.has(e)}}else{var Eh=Bm("state");rT[Eh]=!0,Vm=function(e,t){if(nT(e,Eh))throw new CE(Hm);return t.facade=e,ex(e,Eh,t),t},Fm=function(e){return nT(e,Eh)?e[Eh]:{}},Fp=function(e){return nT(e,Eh)}}var Wd,S0,yh,Ec={set:Vm,get:Fm,has:Fp,enforce:function(e){return Fp(e)?Fm(e):Vm(e,{})},getterFor:function(e){return function(t){var r;if(!y0(t)||(r=Fm(t)).type!==e)throw new CE("Incompatible receiver, "+e+" required");return r}}},Bp=Ne,Gm=ci,Wm=Function.prototype,T0=Bp&&Object.getOwnPropertyDescriptor,iT=Gm(Wm,"name"),vh={PROPER:iT&&(function(){}).name==="something",CONFIGURABLE:iT&&(!Bp||Bp&&T0(Wm,"name").configurable)},b0=Qc,Os=function(e,t,r,o){return o&&o.enumerable?e[t]=r:b0(e,t,r),e},tl=p,zd=fe,w0=kt,Yd=gh,nl=lh,Ds=Os,Hp=Mr("iterator"),AE=!1;[].keys&&("next"in(yh=[].keys())?(S0=nl(nl(yh)))!==Object.prototype&&(Wd=S0):AE=!0);var sT=!w0(Wd)||tl(function(){var e={};return Wd[Hp].call(e)!==e});zd((Wd=sT?{}:Yd(Wd))[Hp])||Ds(Wd,Hp,function(){return this});var aT={IteratorPrototype:Wd,BUGGY_SAFARI_ITERATORS:AE},R0=Wl,Sh=mS?{}.toString:function(){return"[object "+R0(this)+"]"},IE=mS,C0=Ws.f,A0=Qc,I0=ci,NE=Sh,oT=Mr("toStringTag"),yc=function(e,t,r,o){var c=r?e:e&&e.prototype;c&&(I0(c,oT)||C0(c,oT,{configurable:!0,value:t}),o&&!IE&&A0(c,"toString",NE))},N0=aT.IteratorPrototype,O0=gh,tx=Be,D0=yc,qs=Hd,na=function(){return this},OE=function(e,t,r,o){var c=t+" Iterator";return e.prototype=O0(N0,{next:tx(+!o,r)}),D0(e,c,!1,!0),qs[c]=na,e},x0=xn,P0=Ie,k0=vh,L0=OE,DE=lh,cT=yc,lT=Os,dT=Hd,M0=aT,uT=k0.PROPER,Gp=M0.BUGGY_SAFARI_ITERATORS,zm=Mr("iterator"),hT="keys",Wp="values",Ym="entries",pT=function(){return this},fT=function(e,t,r,o,c,u,f){L0(r,t,o);var g,E,v,S=function(G){if(G===c&&M)return M;if(!Gp&&G&&G in D)return D[G];switch(G){case hT:case Wp:case Ym:return function(){return new r(this,G)}}return function(){return new r(this)}},R=t+" Iterator",I=!1,D=e.prototype,V=D[zm]||D["@@iterator"]||c&&D[c],M=!Gp&&V||S(c),j=t==="Array"&&D.entries||V;if(j&&(g=DE(j.call(new e)))!==Object.prototype&&g.next&&(cT(g,R,!0,!0),dT[R]=pT),uT&&c===Wp&&V&&V.name!==Wp&&(I=!0,M=function(){return P0(V,this)}),c)if(E={values:S(Wp),keys:u?M:S(hT),entries:S(Ym)},f)for(v in E)(Gp||I||!(v in D))&&lT(D,v,E[v]);else x0({target:t,proto:!0,forced:Gp||I},E);return f&&D[zm]!==M&&lT(D,zm,M,{}),dT[t]=M,E},zp=function(e,t){return{value:e,done:t}},j0=Dt,rl=Hd,xE=Ec;Ws.f;var nx=fT,qm=zp,il="Array Iterator",U0=xE.set,PE=xE.getterFor(il);nx(Array,"Array",function(e,t){U0(this,{type:il,target:j0(e),index:0,kind:t})},function(){var e=PE(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,qm(void 0,!0);switch(e.kind){case"keys":return qm(r,!1);case"values":return qm(t[r],!1)}return qm([r,t[r]],!1)},"values"),rl.Arguments=rl.Array;var Km=Ws,yi=function(e,t,r){return Km.f(e,t,r)},rx=kn,ix=yi,V0=Ne,Yp=Mr("species"),qd=U,F0=TypeError,kE=function(e,t){if(qd(t,e))return e;throw new F0("Incorrect invocation")},Xm=fe,zo=Wu,B0=k(Function.toString);Xm(zo.inspectSource)||(zo.inspectSource=function(e){return B0(e)});var LE=zo.inspectSource,H0=k,mT=p,ME=fe,jE=Wl,G0=LE,sl=function(){},qi=kn("Reflect","construct"),Qm=/^\s*(?:class|function)\b/,W0=H0(Qm.exec),Ks=!Qm.test(sl),$m=function(e){if(!ME(e))return!1;try{return qi(sl,[],e),!0}catch{return!1}},gT=function(e){if(!ME(e))return!1;switch(jE(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ks||!!W0(Qm,G0(e))}catch{return!0}};gT.sham=!0;var qp,Kr,Ia,vc,Jm=!qi||mT(function(){var e;return $m($m.call)||!$m(Object)||!$m(function(){e=!0})||e})?gT:$m,z0=Jm,sx=un,_T=TypeError,$a=ts,Sc=function(e){if(z0(e))return e;throw new _T(sx(e)+" is not a constructor")},Y0=Mt,Co=Mr("species"),UE=function(e,t){var r,o=$a(e).constructor;return o===void 0||Y0(r=$a(o)[Co])?t:Sc(r)},Na=k([].slice),Th=TypeError,Ja=function(e,t){if(e<t)throw new Th("Not enough arguments");return e},VE=/(?:ipad|iphone|ipod).*applewebkit/i.test(sn),Oa=W,al=ue,q0=yo,bh=fe,Zm=ci,Kp=p,wh=fE,K0=Na,ET=Ju,eg=Ja,X0=VE,FE=zl,BE=Oa.setImmediate,yT=Oa.clearImmediate,ax=Oa.process,Ur=Oa.Dispatch,vi=Oa.Function,or=Oa.MessageChannel,br=Oa.String,Vr=0,ra={},Jl="onreadystatechange";Kp(function(){qp=Oa.location});var Kd=function(e){if(Zm(ra,e)){var t=ra[e];delete ra[e],t()}},tg=function(e){return function(){Kd(e)}},ol=function(e){Kd(e.data)},Vi=function(e){Oa.postMessage(br(e),qp.protocol+"//"+qp.host)};BE&&yT||(BE=function(e){eg(arguments.length,1);var t=bh(e)?e:vi(e),r=K0(arguments,1);return ra[++Vr]=function(){al(t,void 0,r)},Kr(Vr),Vr},yT=function(e){delete ra[e]},FE?Kr=function(e){ax.nextTick(tg(e))}:Ur&&Ur.now?Kr=function(e){Ur.now(tg(e))}:or&&!X0?(vc=(Ia=new or).port2,Ia.port1.onmessage=ol,Kr=q0(vc.postMessage,vc)):Oa.addEventListener&&bh(Oa.postMessage)&&!Oa.importScripts&&qp&&qp.protocol!=="file:"&&!Kp(Vi)?(Kr=Vi,Oa.addEventListener("message",ol,!1)):Kr=Jl in ET("script")?function(e){wh.appendChild(ET("script"))[Jl]=function(){wh.removeChild(this),Kd(e)}}:function(e){setTimeout(tg(e),0)});var Tc={set:BE,clear:yT},Xd=W,vT=Ne,Yo=Object.getOwnPropertyDescriptor,Rh=function(e){if(!vT)return Xd[e];var t=Yo(Xd,e);return t&&t.value},Xp=function(){this.head=null,this.tail=null};Xp.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var xs,ng,rg,Qp,ig,Zl=Xp,ia=/ipad|iphone|ipod/i.test(sn)&&typeof Pebble<"u",Qd=/web0s(?!.*chrome)/i.test(sn),bc=W,$p=Rh,HE=yo,sg=Tc.set,Q0=Zl,ag=VE,ST=ia,Ao=Qd,GE=zl,Za=bc.MutationObserver||bc.WebKitMutationObserver,TT=bc.document,bT=bc.process,WE=bc.Promise,cl=$p("queueMicrotask");if(!cl){var Ch=new Q0,Jp=function(){var e,t;for(GE&&(e=bT.domain)&&e.exit();t=Ch.get();)try{t()}catch(r){throw Ch.head&&xs(),r}e&&e.enter()};ag||GE||Ao||!Za||!TT?!ST&&WE&&WE.resolve?((Qp=WE.resolve(void 0)).constructor=WE,ig=HE(Qp.then,Qp),xs=function(){ig(Jp)}):GE?xs=function(){bT.nextTick(Jp)}:(sg=HE(sg,bc),xs=function(){sg(Jp)}):(ng=!0,rg=TT.createTextNode(""),new Za(Jp).observe(rg,{characterData:!0}),xs=function(){rg.data=ng=!ng}),cl=function(e){Ch.head||xs(),Ch.add(e)}}var Ah=cl,Ih=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},$d=W.Promise,$0=W,Nh=$d,wT=fe,ox=fc,cx=LE,lx=Mr,RT=Ip,zE=ji,Oh=Nh&&Nh.prototype,YE=lx("species"),CT=wT($0.PromiseRejectionEvent),J0=ox("Promise",function(){var e=cx(Nh),t=e!==String(Nh);if(!t&&zE===66||!Oh.catch||!Oh.finally)return!0;if(!zE||zE<51||!/native code/.test(e)){var r=new Nh(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((r.constructor={})[YE]=o,!(r.then(function(){})instanceof o))return!0}return!(t||RT!=="BROWSER"&&RT!=="DENO"||CT)}),Zp={CONSTRUCTOR:J0,REJECTION_EVENT:CT},wc={},AT=ln,Z0=TypeError,qE=function(e){var t,r;this.promise=new e(function(o,c){if(t!==void 0||r!==void 0)throw new Z0("Bad Promise constructor");t=o,r=c}),this.resolve=AT(t),this.reject=AT(r)};wc.f=function(e){return new qE(e)};var KE,IT,li=xn,ef=zl,Jd=W,tf=Ie,dx=Os,ux=yc,hx=function(e){var t=rx(e);V0&&t&&!t[Yp]&&ix(t,Yp,{configurable:!0,get:function(){return this}})},XE=ln,Zd=fe,NT=kt,QE=kE,OT=UE,eu=Tc.set,qo=Ah,og=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},px=Ih,eC=Zl,DT=Ec,$E=$d,xT=Zp,tC=wc,nf="Promise",PT=xT.CONSTRUCTOR,nC=xT.REJECTION_EVENT,kT=DT.getterFor(nf),LT=DT.set,MT=$E&&$E.prototype,cg=$E,jT=MT,rf=Jd.TypeError,UT=Jd.document,JE=Jd.process,rr=tC.f,VT=rr,ZE=!!(UT&&UT.createEvent&&Jd.dispatchEvent),ey="unhandledrejection",FT=function(e){var t;return!(!NT(e)||!Zd(t=e.then))&&t},ty=function(e,t){var r,o,c,u=t.value,f=t.state===1,g=f?e.ok:e.fail,E=e.resolve,v=e.reject,S=e.domain;try{g?(f||(t.rejection===2&&fx(t),t.rejection=1),g===!0?r=u:(S&&S.enter(),r=g(u),S&&(S.exit(),c=!0)),r===e.promise?v(new rf("Promise-chain cycle")):(o=FT(r))?tf(o,r,E,v):E(r)):v(u)}catch(R){S&&!c&&S.exit(),v(R)}},sf=function(e,t){e.notified||(e.notified=!0,qo(function(){for(var r,o=e.reactions;r=o.get();)ty(r,e);e.notified=!1,t&&!e.rejection&&af(e)}))},lg=function(e,t,r){var o,c;ZE?((o=UT.createEvent("Event")).promise=t,o.reason=r,o.initEvent(e,!1,!0),Jd.dispatchEvent(o)):o={promise:t,reason:r},!nC&&(c=Jd["on"+e])?c(o):e===ey&&og("Unhandled promise rejection",r)},af=function(e){tf(eu,Jd,function(){var t,r=e.facade,o=e.value;if(BT(e)&&(t=px(function(){ef?JE.emit("unhandledRejection",o,r):lg(ey,r,o)}),e.rejection=ef||BT(e)?2:1,t.error))throw t.value})},BT=function(e){return e.rejection!==1&&!e.parent},fx=function(e){tf(eu,Jd,function(){var t=e.facade;ef?JE.emit("rejectionHandled",t):lg("rejectionhandled",t,e.value)})},of=function(e,t,r){return function(o){e(t,o,r)}},Dh=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,sf(e,!0))},ny=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw new rf("Promise can't be resolved itself");var o=FT(t);o?qo(function(){var c={done:!1};try{tf(o,t,of(ny,c,e),of(Dh,c,e))}catch(u){Dh(c,u,e)}}):(e.value=t,e.state=1,sf(e,!1))}catch(c){Dh({done:!1},c,e)}}};PT&&(jT=(cg=function(e){QE(this,jT),XE(e),tf(KE,this);var t=kT(this);try{e(of(ny,t),of(Dh,t))}catch(r){Dh(t,r)}}).prototype,(KE=function(e){LT(this,{type:nf,done:!1,notified:!1,parent:!1,reactions:new eC,rejection:!1,state:0,value:null})}).prototype=dx(jT,"then",function(e,t){var r=kT(this),o=rr(OT(this,cg));return r.parent=!0,o.ok=!Zd(e)||e,o.fail=Zd(t)&&t,o.domain=ef?JE.domain:void 0,r.state===0?r.reactions.add(o):qo(function(){ty(o,r)}),o.promise}),IT=function(){var e=new KE,t=kT(e);this.promise=e,this.resolve=of(ny,t),this.reject=of(Dh,t)},tC.f=rr=function(e){return e===cg||e===void 0?new IT(e):VT(e)}),li({global:!0,wrap:!0,forced:PT},{Promise:cg}),ux(cg,nf,!1,!0),hx(nf);var dg=Mr("iterator"),Xr=!1;try{var HT=0,Xs={next:function(){return{done:!!HT++}},return:function(){Xr=!0}};Xs[dg]=function(){return this},Array.from(Xs,function(){throw 2})}catch{}var mx=$d,GT=function(e,t){try{if(!t&&!Xr)return!1}catch{return!1}var r=!1;try{var o={};o[dg]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch{}return r},cf=Zp.CONSTRUCTOR||!GT(function(e){mx.all(e).then(void 0,function(){})}),ry=Ie,rC=ln,iC=wc,WT=Ih,zT=jp;xn({target:"Promise",stat:!0,forced:cf},{all:function(e){var t=this,r=iC.f(t),o=r.resolve,c=r.reject,u=WT(function(){var f=rC(t.resolve),g=[],E=0,v=1;zT(e,function(S){var R=E++,I=!1;v++,ry(f,t,S).then(function(D){I||(I=!0,g[R]=D,--v||o(g))},c)}),--v||o(g)});return u.error&&c(u.value),r.promise}});var gx=xn,sC=Zp.CONSTRUCTOR;$d&&$d.prototype,gx({target:"Promise",proto:!0,forced:sC,real:!0},{catch:function(e){return this.then(void 0,e)}});var _x=Ie,aC=ln,Ex=wc,yx=Ih,tu=jp;xn({target:"Promise",stat:!0,forced:cf},{race:function(e){var t=this,r=Ex.f(t),o=r.reject,c=yx(function(){var u=aC(t.resolve);tu(e,function(f){_x(u,t,f).then(r.resolve,o)})});return c.error&&o(c.value),r.promise}});var oC=wc;xn({target:"Promise",stat:!0,forced:Zp.CONSTRUCTOR},{reject:function(e){var t=oC.f(this);return(0,t.reject)(e),t.promise}});var YT=ts,vx=kt,Sx=wc,iy=function(e,t){if(YT(e),vx(t)&&t.constructor===e)return t;var r=Sx.f(e);return(0,r.resolve)(t),r.promise},Tx=xn,Rc=$d,qT=Zp.CONSTRUCTOR,cC=iy,lC=kn("Promise"),ug=!qT;Tx({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return cC(ug&&this===lC?Rc:this,e)}});var Ko=Ie,dC=ln,sy=wc,ed=Ih,bx=jp;xn({target:"Promise",stat:!0,forced:cf},{allSettled:function(e){var t=this,r=sy.f(t),o=r.resolve,c=r.reject,u=ed(function(){var f=dC(t.resolve),g=[],E=0,v=1;bx(e,function(S){var R=E++,I=!1;v++,Ko(f,t,S).then(function(D){I||(I=!0,g[R]={status:"fulfilled",value:D},--v||o(g))},function(D){I||(I=!0,g[R]={status:"rejected",reason:D},--v||o(g))})}),--v||o(g)});return u.error&&c(u.value),r.promise}});var wx=Ie,lf=ln,uC=kn,Rx=wc,Cx=Ih,Ax=jp,hC="No one promise resolved";xn({target:"Promise",stat:!0,forced:cf},{any:function(e){var t=this,r=uC("AggregateError"),o=Rx.f(t),c=o.resolve,u=o.reject,f=Cx(function(){var g=lf(t.resolve),E=[],v=0,S=1,R=!1;Ax(e,function(I){var D=v++,V=!1;S++,wx(g,t,I).then(function(M){V||R||(R=!0,c(M))},function(M){V||R||(V=!0,E[D]=M,--S||u(new r(E,hC)))})}),--S||u(new r(E,hC))});return f.error&&u(f.value),o.promise}});var Ix=xn,Nx=ue,Ox=Na,pC=wc,df=ln,uf=Ih,ay=W.Promise,fC=!1;Ix({target:"Promise",stat:!0,forced:!ay||!ay.try||uf(function(){ay.try(function(e){fC=e===8},8)}).error||!fC},{try:function(e){var t=arguments.length>1?Ox(arguments,1):[],r=pC.f(this),o=uf(function(){return Nx(df(e),void 0,t)});return(o.error?r.reject:r.resolve)(o.value),r.promise}});var hf=wc;xn({target:"Promise",stat:!0},{withResolvers:function(){var e=hf.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var hg=xn,oy=$d,cy=p,KT=kn,XT=fe,ly=UE,QT=iy,mC=oy&&oy.prototype;hg({target:"Promise",proto:!0,real:!0,forced:!!oy&&cy(function(){mC.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=ly(this,KT("Promise")),r=XT(e);return this.then(r?function(o){return QT(t,e()).then(function(){return o})}:e,r?function(o){return QT(t,e()).then(function(){throw o})}:e)}});var $T=k,gC=A,pg=Is,Dx=Xn,xx=$T("".charAt),_C=$T("".charCodeAt),dy=$T("".slice),fg=function(e){return function(t,r){var o,c,u=pg(Dx(t)),f=gC(r),g=u.length;return f<0||f>=g?e?"":void 0:(o=_C(u,f))<55296||o>56319||f+1===g||(c=_C(u,f+1))<56320||c>57343?e?xx(u,f):o:e?dy(u,f,f+2):c-56320+(o-55296<<10)+65536}},mg={codeAt:fg(!1),charAt:fg(!0)},Px=mg.charAt,gg=Is,EC=Ec,yC=fT,JT=zp,ZT="String Iterator",vC=EC.set,eb=EC.getterFor(ZT);yC(String,"String",function(e){vC(this,{type:ZT,string:gg(e),index:0})},function(){var e,t=eb(this),r=t.string,o=t.index;return o>=r.length?JT(void 0,!0):(e=Px(r,o),t.index+=e.length,JT(e,!1))});var SC=Gt.Promise,uy={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},kx=W,Lx=yc,hy=Hd;for(var _g in uy)Lx(kx[_g],_g),hy[_g]=hy.Array;var Eg=SC,nt=l(Eg),TC=vo("Array","values"),tb=Wl,nu=ci,ru=U,iu=TC,xh=Array.prototype,yg={DOMTokenList:!0,NodeList:!0},su=function(e){var t=e.values;return e===xh||ru(xh,e)&&t===xh.values||nu(yg,tb(e))?iu:t},Da=l(su),nb=un,vg=TypeError,bC=Na,wC=Math.floor,pf=function(e,t){var r=e.length;if(r<8)for(var o,c,u=1;u<r;){for(c=u,o=e[u];c&&t(e[c-1],o)>0;)e[c]=e[--c];c!==u++&&(e[c]=o)}else for(var f=wC(r/2),g=pf(bC(e,0,f),t),E=pf(bC(e,f),t),v=g.length,S=E.length,R=0,I=0;R<v||I<S;)e[R+I]=R<v&&I<S?t(g[R],E[I])<=0?g[R++]:E[I++]:R<v?g[R++]:E[I++];return e},rb=pf,RC=sn.match(/firefox\/(\d+)/i),py=!!RC&&+RC[1],fy=/MSIE|Trident/.test(sn),ib=sn.match(/AppleWebKit\/(\d+)\./),Sg=!!ib&&+ib[1],sb=xn,Tg=k,CC=ln,Mx=_o,bg=Yn,d=function(e,t){if(!delete e[t])throw new vg("Cannot delete property "+nb(t)+" of "+nb(e))},h=Is,y=p,b=rb,N=ih,P=py,J=fy,le=ji,we=Sg,Fe=[],it=Tg(Fe.sort),gt=Tg(Fe.push),Ke=y(function(){Fe.sort(void 0)}),Xe=y(function(){Fe.sort(null)}),Pn=N("sort"),gn=!y(function(){if(le)return le<70;if(!(P&&P>3)){if(J)return!0;if(we)return we<603;var e,t,r,o,c="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(o=0;o<47;o++)Fe.push({k:t+o,v:r})}for(Fe.sort(function(u,f){return f.v-u.v}),o=0;o<Fe.length;o++)t=Fe[o].k.charAt(0),c.charAt(c.length-1)!==t&&(c+=t);return c!=="DGBEFHACIJK"}});sb({target:"Array",proto:!0,forced:Ke||!Xe||!Pn||!gn},{sort:function(e){e!==void 0&&CC(e);var t=Mx(this);if(gn)return e===void 0?it(t):it(t,e);var r,o,c=[],u=bg(t);for(o=0;o<u;o++)o in t&&gt(c,t[o]);for(b(c,function(f){return function(g,E){return E===void 0?-1:g===void 0?1:f!==void 0?+f(g,E)||0:h(g)>h(E)?1:-1}}(e)),r=bg(c),o=0;o<r;)t[o]=c[o++];for(;o<u;)d(t,o++);return t}});var ti=vo("Array","sort"),Le=U,Oe=ti,He=Array.prototype,ht=function(e){var t=e.sort;return e===He||Le(He,e)&&t===He.sort?Oe:t},Ft=l(ht),cr=xn,on=k,Rn=Ue,Qs=RangeError,Ar=String.fromCharCode,td=String.fromCodePoint,jx=on([].join);cr({target:"String",stat:!0,forced:!!td&&td.length!==1},{fromCodePoint:function(e){for(var t,r=[],o=arguments.length,c=0;o>c;){if(t=+arguments[c++],Rn(t,1114111)!==t)throw new Qs(t+" is not a valid code point");r[c]=t<65536?Ar(t):Ar(55296+((t-=65536)>>10),t%1024+56320)}return jx(r,"")}});var _Q=p,EQ=Mr("iterator"),AC=!_Q(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),o="";return e.pathname="c%20d",t.forEach(function(c,u){t.delete("b"),o+=u+c}),r.delete("a",2),r.delete("b",void 0),!e.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[EQ]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("https://x",void 0).host!=="x"}),yQ=Os,Ux=xn,oU=W,Vx=Rh,vQ=kn,IC=Ie,nd=k,ab=Ne,cU=AC,lU=Os,SQ=yi,TQ=function(e,t,r){for(var o in t)r&&r.unsafe&&e[o]?e[o]=t[o]:yQ(e,o,t[o],r);return e},bQ=yc,wQ=OE,Fx=Ec,dU=kE,Bx=fe,RQ=ci,CQ=yo,AQ=Wl,IQ=ts,uU=kt,Io=Is,NQ=gh,hU=Be,pU=Lm,OQ=Mp,NC=zp,my=Ja,DQ=rb,xQ=Mr("iterator"),gy="URLSearchParams",fU=gy+"Iterator",mU=Fx.set,ll=Fx.getterFor(gy),PQ=Fx.getterFor(fU),gU=Vx("fetch"),OC=Vx("Request"),ob=Vx("Headers"),Hx=OC&&OC.prototype,_U=ob&&ob.prototype,kQ=oU.TypeError,LQ=oU.encodeURIComponent,MQ=String.fromCharCode,jQ=vQ("String","fromCodePoint"),UQ=parseInt,DC=nd("".charAt),EU=nd([].join),ff=nd([].push),yU=nd("".replace),VQ=nd([].shift),vU=nd([].splice),SU=nd("".split),TU=nd("".slice),FQ=nd(/./.exec),BQ=/\+/g,HQ=/^[0-9a-f]+$/i,bU=function(e,t){var r=TU(e,t,t+2);return FQ(HQ,r)?UQ(r,16):NaN},GQ=function(e){for(var t=0,r=128;r>0&&(e&r)!=0;r>>=1)t++;return t},WQ=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},wU=function(e){for(var t=(e=yU(e,BQ," ")).length,r="",o=0;o<t;){var c=DC(e,o);if(c==="%"){if(DC(e,o+1)==="%"||o+3>t){r+="%",o++;continue}var u=bU(e,o+1);if(u!=u){r+=c,o++;continue}o+=2;var f=GQ(u);if(f===0)c=MQ(u);else{if(f===1||f>4){r+="",o++;continue}for(var g=[u],E=1;E<f&&!(++o+3>t||DC(e,o)!=="%");){var v=bU(e,o+1);if(v!=v){o+=3;break}if(v>191||v<128)break;ff(g,v),o+=2,E++}if(g.length!==f){r+="";continue}var S=WQ(g);S===null?r+="":c=jQ(S)}}r+=c,o++}return r},zQ=/[!'()~]|%20/g,YQ={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},qQ=function(e){return YQ[e]},RU=function(e){return yU(LQ(e),zQ,qQ)},Gx=wQ(function(e,t){mU(this,{type:fU,target:ll(e).entries,index:0,kind:t})},gy,function(){var e=PQ(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,NC(void 0,!0);var o=t[r];switch(e.kind){case"keys":return NC(o.key,!1);case"values":return NC(o.value,!1)}return NC([o.key,o.value],!1)},!0),CU=function(e){this.entries=[],this.url=null,e!==void 0&&(uU(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?DC(e,0)==="?"?TU(e,1):e:Io(e)))};CU.prototype={type:gy,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,o,c,u,f,g,E=this.entries,v=OQ(e);if(v)for(r=(t=pU(e,v)).next;!(o=IC(r,t)).done;){if(u=(c=pU(IQ(o.value))).next,(f=IC(u,c)).done||(g=IC(u,c)).done||!IC(u,c).done)throw new kQ("Expected sequence with length 2");ff(E,{key:Io(f.value),value:Io(g.value)})}else for(var S in e)RQ(e,S)&&ff(E,{key:S,value:Io(e[S])})},parseQuery:function(e){if(e)for(var t,r,o=this.entries,c=SU(e,"&"),u=0;u<c.length;)(t=c[u++]).length&&(r=SU(t,"="),ff(o,{key:wU(VQ(r)),value:wU(EU(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],o=0;o<t.length;)e=t[o++],ff(r,RU(e.key)+"="+RU(e.value));return EU(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var xC=function(){dU(this,_y);var e=mU(this,new CU(arguments.length>0?arguments[0]:void 0));ab||(this.size=e.entries.length)},_y=xC.prototype;if(TQ(_y,{append:function(e,t){var r=ll(this);my(arguments.length,2),ff(r.entries,{key:Io(e),value:Io(t)}),ab||this.length++,r.updateURL()},delete:function(e){for(var t=ll(this),r=my(arguments.length,1),o=t.entries,c=Io(e),u=r<2?void 0:arguments[1],f=u===void 0?u:Io(u),g=0;g<o.length;){var E=o[g];if(E.key!==c||f!==void 0&&E.value!==f)g++;else if(vU(o,g,1),f!==void 0)break}ab||(this.size=o.length),t.updateURL()},get:function(e){var t=ll(this).entries;my(arguments.length,1);for(var r=Io(e),o=0;o<t.length;o++)if(t[o].key===r)return t[o].value;return null},getAll:function(e){var t=ll(this).entries;my(arguments.length,1);for(var r=Io(e),o=[],c=0;c<t.length;c++)t[c].key===r&&ff(o,t[c].value);return o},has:function(e){for(var t=ll(this).entries,r=my(arguments.length,1),o=Io(e),c=r<2?void 0:arguments[1],u=c===void 0?c:Io(c),f=0;f<t.length;){var g=t[f++];if(g.key===o&&(u===void 0||g.value===u))return!0}return!1},set:function(e,t){var r=ll(this);my(arguments.length,1);for(var o,c=r.entries,u=!1,f=Io(e),g=Io(t),E=0;E<c.length;E++)(o=c[E]).key===f&&(u?vU(c,E--,1):(u=!0,o.value=g));u||ff(c,{key:f,value:g}),ab||(this.size=c.length),r.updateURL()},sort:function(){var e=ll(this);DQ(e.entries,function(t,r){return t.key>r.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,r=ll(this).entries,o=CQ(e,arguments.length>1?arguments[1]:void 0),c=0;c<r.length;)o((t=r[c++]).value,t.key,this)},keys:function(){return new Gx(this,"keys")},values:function(){return new Gx(this,"values")},entries:function(){return new Gx(this,"entries")}},{enumerable:!0}),lU(_y,xQ,_y.entries,{}),lU(_y,"toString",function(){return ll(this).serialize()},{enumerable:!0}),ab&&SQ(_y,"size",{get:function(){return ll(this).entries.length},configurable:!0,enumerable:!0}),bQ(xC,gy),Ux({global:!0,forced:!cU},{URLSearchParams:xC}),!cU&&Bx(ob)){var KQ=nd(_U.has),XQ=nd(_U.set),AU=function(e){if(uU(e)){var t,r=e.body;if(AQ(r)===gy)return t=e.headers?new ob(e.headers):new ob,KQ(t,"content-type")||XQ(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),NQ(e,{body:hU(0,Io(r)),headers:hU(0,t)})}return e};if(Bx(gU)&&Ux({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return gU(e,arguments.length>1?AU(arguments[1]):{})}}),Bx(OC)){var Wx=function(e){return dU(this,Hx),new OC(e,arguments.length>1?AU(arguments[1]):{})};Hx.constructor=Wx,Wx.prototype=Hx,Ux({global:!0,dontCallGetSet:!0,forced:!0},{Request:Wx})}}var dl,QQ={URLSearchParams:xC,getState:ll},$Q=Gt.URLSearchParams,IU=Ne,JQ=k,ZQ=Ie,e$=p,zx=Pp,t$=uh,n$=Re,r$=_o,i$=tn,Ey=Object.assign,NU=Object.defineProperty,s$=JQ([].concat),a$=!Ey||e$(function(){if(IU&&Ey({b:1},Ey(NU({},"a",{enumerable:!0,get:function(){NU(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol("assign detection"),o="abcdefghijklmnopqrst";return e[r]=7,o.split("").forEach(function(c){t[c]=c}),Ey({},e)[r]!==7||zx(Ey({},t)).join("")!==o})?function(e,t){for(var r=r$(e),o=arguments.length,c=1,u=t$.f,f=n$.f;o>c;)for(var g,E=i$(arguments[c++]),v=u?s$(zx(E),u(E)):zx(E),S=v.length,R=0;S>R;)g=v[R++],IU&&!ZQ(f,E,g)||(r[g]=E[g]);return r}:Ey,o$=ts,c$=YS,l$=Ne,d$=Ws,u$=Be,Yx=function(e,t,r){l$?d$.f(e,t,u$(0,r)):e[t]=r},h$=yo,p$=Ie,f$=_o,m$=function(e,t,r,o){try{return o?t(o$(r)[0],r[1]):t(r)}catch(c){c$(e,"throw",c)}},g$=r0,_$=Jm,E$=Yn,OU=Yx,y$=Lm,v$=Mp,DU=Array,wg=k,qx=2147483647,S$=/[^\0-\u007E]/,xU=/[.\u3002\uFF0E\uFF61]/g,PU="Overflow: input needs wider integers to process",kU=RangeError,T$=wg(xU.exec),yy=Math.floor,Kx=String.fromCharCode,LU=wg("".charCodeAt),MU=wg([].join),mf=wg([].push),b$=wg("".replace),w$=wg("".split),R$=wg("".toLowerCase),jU=function(e){return e+22+75*(e<26)},C$=function(e,t,r){var o=0;for(e=r?yy(e/700):e>>1,e+=yy(e/t);e>455;)e=yy(e/35),o+=36;return yy(o+36*e/(e+38))},A$=function(e){var t=[];e=function(G){for(var z=[],ce=0,Ee=G.length;ce<Ee;){var _e=LU(G,ce++);if(_e>=55296&&_e<=56319&&ce<Ee){var me=LU(G,ce++);(64512&me)==56320?mf(z,((1023&_e)<<10)+(1023&me)+65536):(mf(z,_e),ce--)}else mf(z,_e)}return z}(e);var r,o,c=e.length,u=128,f=0,g=72;for(r=0;r<e.length;r++)(o=e[r])<128&&mf(t,Kx(o));var E=t.length,v=E;for(E&&mf(t,"-");v<c;){var S=qx;for(r=0;r<e.length;r++)(o=e[r])>=u&&o<S&&(S=o);var R=v+1;if(S-u>yy((qx-f)/R))throw new kU(PU);for(f+=(S-u)*R,u=S,r=0;r<e.length;r++){if((o=e[r])<u&&++f>qx)throw new kU(PU);if(o===u){for(var I=f,D=36;;){var V=D<=g?1:D>=g+26?26:D-g;if(I<V)break;var M=I-V,j=36-V;mf(t,Kx(jU(V+M%j))),I=yy(M/j),D+=36}mf(t,Kx(jU(I))),g=C$(f,R,v===E),f=0,v++}}f++,u++}return MU(t,"")},I$=xn,Xx=Ne,N$=AC,Qx=W,UU=yo,ul=k,PC=Os,hl=yi,O$=kE,$x=ci,Jx=a$,vy=function(e){var t=f$(e),r=_$(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=h$(c,o>2?arguments[2]:void 0));var f,g,E,v,S,R,I=v$(t),D=0;if(!I||this===DU&&g$(I))for(f=E$(t),g=r?new this(f):DU(f);f>D;D++)R=u?c(t[D],D):t[D],OU(g,D,R);else for(g=r?new this:[],S=(v=y$(t,I)).next;!(E=p$(S,v)).done;D++)R=u?m$(v,c,[E.value,D],!0):E.value,OU(g,D,R);return g.length=D,g},rd=Na,D$=mg.codeAt,x$=function(e){var t,r,o=[],c=w$(b$(R$(e),xU,"."),".");for(t=0;t<c.length;t++)r=c[t],mf(o,T$(S$,r)?"xn--"+A$(r):r);return MU(o,".")},Ph=Is,P$=yc,k$=Ja,VU=QQ,FU=Ec,L$=FU.set,kC=FU.getterFor("URL"),M$=VU.URLSearchParams,j$=VU.getState,cb=Qx.URL,Zx=Qx.TypeError,LC=Qx.parseInt,U$=Math.floor,BU=Math.pow,pl=ul("".charAt),id=ul(/./.exec),lb=ul([].join),V$=ul(1 .toString),F$=ul([].pop),Sy=ul([].push),eP=ul("".replace),B$=ul([].shift),H$=ul("".split),db=ul("".slice),MC=ul("".toLowerCase),G$=ul([].unshift),tP="Invalid scheme",Rg="Invalid host",HU="Invalid port",GU=/[a-z]/i,W$=/[\d+-.a-z]/i,nP=/\d/,z$=/^0x/i,Y$=/^[0-7]+$/,q$=/^\d+$/,WU=/^[\da-f]+$/i,K$=/[\0\t\n\r #%/:<>?@[\\\]^|]/,X$=/[\0\t\n\r #/:<>?@[\\\]^|]/,Q$=/^[\u0000-\u0020]+/,$$=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,J$=/[\t\n\r]/g,ub=function(e){var t,r,o,c;if(typeof e=="number"){for(t=[],r=0;r<4;r++)G$(t,e%256),e=U$(e/256);return lb(t,".")}if(typeof e=="object"){for(t="",o=function(u){for(var f=null,g=1,E=null,v=0,S=0;S<8;S++)u[S]!==0?(v>g&&(f=E,g=v),E=null,v=0):(E===null&&(E=S),++v);return v>g?E:f}(e),r=0;r<8;r++)c&&e[r]===0||(c&&(c=!1),o===r?(t+=r?":":"::",c=!0):(t+=V$(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},jC={},zU=Jx({},jC,{" ":1,'"':1,"<":1,">":1,"`":1}),YU=Jx({},zU,{"#":1,"?":1,"{":1,"}":1}),rP=Jx({},YU,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),gf=function(e,t){var r=D$(e,0);return r>32&&r<127&&!$x(t,e)?e:encodeURIComponent(e)},UC={ftp:21,file:null,http:80,https:443,ws:80,wss:443},hb=function(e,t){var r;return e.length===2&&id(GU,pl(e,0))&&((r=pl(e,1))===":"||!t&&r==="|")},qU=function(e){var t;return e.length>1&&hb(db(e,0,2))&&(e.length===2||(t=pl(e,2))==="/"||t==="\\"||t==="?"||t==="#")},Z$=function(e){return e==="."||MC(e)==="%2e"},iP={},KU={},sP={},XU={},QU={},aP={},$U={},JU={},VC={},FC={},oP={},cP={},lP={},dP={},ZU={},uP={},Ty={},au={},eV={},Cg={},kh={},hP=function(e,t,r){var o,c,u,f=Ph(e);if(t){if(c=this.parse(f))throw new Zx(c);this.searchParams=null}else{if(r!==void 0&&(o=new hP(r,!0)),c=this.parse(f,null,o))throw new Zx(c);(u=j$(new M$)).bindURL(this),this.searchParams=u}};hP.prototype={type:"URL",parse:function(e,t,r){var o,c,u,f,g,E=this,v=t||iP,S=0,R="",I=!1,D=!1,V=!1;for(e=Ph(e),t||(E.scheme="",E.username="",E.password="",E.host=null,E.port=null,E.path=[],E.query=null,E.fragment=null,E.cannotBeABaseURL=!1,e=eP(e,Q$,""),e=eP(e,$$,"$1")),e=eP(e,J$,""),o=vy(e);S<=o.length;){switch(c=o[S],v){case iP:if(!c||!id(GU,c)){if(t)return tP;v=sP;continue}R+=MC(c),v=KU;break;case KU:if(c&&(id(W$,c)||c==="+"||c==="-"||c==="."))R+=MC(c);else{if(c!==":"){if(t)return tP;R="",v=sP,S=0;continue}if(t&&(E.isSpecial()!==$x(UC,R)||R==="file"&&(E.includesCredentials()||E.port!==null)||E.scheme==="file"&&!E.host))return;if(E.scheme=R,t)return void(E.isSpecial()&&UC[E.scheme]===E.port&&(E.port=null));R="",E.scheme==="file"?v=dP:E.isSpecial()&&r&&r.scheme===E.scheme?v=XU:E.isSpecial()?v=JU:o[S+1]==="/"?(v=QU,S++):(E.cannotBeABaseURL=!0,Sy(E.path,""),v=eV)}break;case sP:if(!r||r.cannotBeABaseURL&&c!=="#")return tP;if(r.cannotBeABaseURL&&c==="#"){E.scheme=r.scheme,E.path=rd(r.path),E.query=r.query,E.fragment="",E.cannotBeABaseURL=!0,v=kh;break}v=r.scheme==="file"?dP:aP;continue;case XU:if(c!=="/"||o[S+1]!=="/"){v=aP;continue}v=VC,S++;break;case QU:if(c==="/"){v=FC;break}v=au;continue;case aP:if(E.scheme=r.scheme,c===dl)E.username=r.username,E.password=r.password,E.host=r.host,E.port=r.port,E.path=rd(r.path),E.query=r.query;else if(c==="/"||c==="\\"&&E.isSpecial())v=$U;else if(c==="?")E.username=r.username,E.password=r.password,E.host=r.host,E.port=r.port,E.path=rd(r.path),E.query="",v=Cg;else{if(c!=="#"){E.username=r.username,E.password=r.password,E.host=r.host,E.port=r.port,E.path=rd(r.path),E.path.length--,v=au;continue}E.username=r.username,E.password=r.password,E.host=r.host,E.port=r.port,E.path=rd(r.path),E.query=r.query,E.fragment="",v=kh}break;case $U:if(!E.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){E.username=r.username,E.password=r.password,E.host=r.host,E.port=r.port,v=au;continue}v=FC}else v=VC;break;case JU:if(v=VC,c!=="/"||pl(R,S+1)!=="/")continue;S++;break;case VC:if(c!=="/"&&c!=="\\"){v=FC;continue}break;case FC:if(c==="@"){I&&(R="%40"+R),I=!0,u=vy(R);for(var M=0;M<u.length;M++){var j=u[M];if(j!==":"||V){var G=gf(j,rP);V?E.password+=G:E.username+=G}else V=!0}R=""}else if(c===dl||c==="/"||c==="?"||c==="#"||c==="\\"&&E.isSpecial()){if(I&&R==="")return"Invalid authority";S-=vy(R).length+1,R="",v=oP}else R+=c;break;case oP:case cP:if(t&&E.scheme==="file"){v=uP;continue}if(c!==":"||D){if(c===dl||c==="/"||c==="?"||c==="#"||c==="\\"&&E.isSpecial()){if(E.isSpecial()&&R==="")return Rg;if(t&&R===""&&(E.includesCredentials()||E.port!==null))return;if(f=E.parseHost(R))return f;if(R="",v=Ty,t)return;continue}c==="["?D=!0:c==="]"&&(D=!1),R+=c}else{if(R==="")return Rg;if(f=E.parseHost(R))return f;if(R="",v=lP,t===cP)return}break;case lP:if(!id(nP,c)){if(c===dl||c==="/"||c==="?"||c==="#"||c==="\\"&&E.isSpecial()||t){if(R!==""){var z=LC(R,10);if(z>65535)return HU;E.port=E.isSpecial()&&z===UC[E.scheme]?null:z,R=""}if(t)return;v=Ty;continue}return HU}R+=c;break;case dP:if(E.scheme="file",c==="/"||c==="\\")v=ZU;else{if(!r||r.scheme!=="file"){v=au;continue}switch(c){case dl:E.host=r.host,E.path=rd(r.path),E.query=r.query;break;case"?":E.host=r.host,E.path=rd(r.path),E.query="",v=Cg;break;case"#":E.host=r.host,E.path=rd(r.path),E.query=r.query,E.fragment="",v=kh;break;default:qU(lb(rd(o,S),""))||(E.host=r.host,E.path=rd(r.path),E.shortenPath()),v=au;continue}}break;case ZU:if(c==="/"||c==="\\"){v=uP;break}r&&r.scheme==="file"&&!qU(lb(rd(o,S),""))&&(hb(r.path[0],!0)?Sy(E.path,r.path[0]):E.host=r.host),v=au;continue;case uP:if(c===dl||c==="/"||c==="\\"||c==="?"||c==="#"){if(!t&&hb(R))v=au;else if(R===""){if(E.host="",t)return;v=Ty}else{if(f=E.parseHost(R))return f;if(E.host==="localhost"&&(E.host=""),t)return;R="",v=Ty}continue}R+=c;break;case Ty:if(E.isSpecial()){if(v=au,c!=="/"&&c!=="\\")continue}else if(t||c!=="?")if(t||c!=="#"){if(c!==dl&&(v=au,c!=="/"))continue}else E.fragment="",v=kh;else E.query="",v=Cg;break;case au:if(c===dl||c==="/"||c==="\\"&&E.isSpecial()||!t&&(c==="?"||c==="#")){if((g=MC(g=R))===".."||g==="%2e."||g===".%2e"||g==="%2e%2e"?(E.shortenPath(),c==="/"||c==="\\"&&E.isSpecial()||Sy(E.path,"")):Z$(R)?c==="/"||c==="\\"&&E.isSpecial()||Sy(E.path,""):(E.scheme==="file"&&!E.path.length&&hb(R)&&(E.host&&(E.host=""),R=pl(R,0)+":"),Sy(E.path,R)),R="",E.scheme==="file"&&(c===dl||c==="?"||c==="#"))for(;E.path.length>1&&E.path[0]==="";)B$(E.path);c==="?"?(E.query="",v=Cg):c==="#"&&(E.fragment="",v=kh)}else R+=gf(c,YU);break;case eV:c==="?"?(E.query="",v=Cg):c==="#"?(E.fragment="",v=kh):c!==dl&&(E.path[0]+=gf(c,jC));break;case Cg:t||c!=="#"?c!==dl&&(c==="'"&&E.isSpecial()?E.query+="%27":E.query+=c==="#"?"%23":gf(c,jC)):(E.fragment="",v=kh);break;case kh:c!==dl&&(E.fragment+=gf(c,zU))}S++}},parseHost:function(e){var t,r,o;if(pl(e,0)==="["){if(pl(e,e.length-1)!=="]"||(t=function(c){var u,f,g,E,v,S,R,I=[0,0,0,0,0,0,0,0],D=0,V=null,M=0,j=function(){return pl(c,M)};if(j()===":"){if(pl(c,1)!==":")return;M+=2,V=++D}for(;j();){if(D===8)return;if(j()!==":"){for(u=f=0;f<4&&id(WU,j());)u=16*u+LC(j(),16),M++,f++;if(j()==="."){if(f===0||(M-=f,D>6))return;for(g=0;j();){if(E=null,g>0){if(!(j()==="."&&g<4))return;M++}if(!id(nP,j()))return;for(;id(nP,j());){if(v=LC(j(),10),E===null)E=v;else{if(E===0)return;E=10*E+v}if(E>255)return;M++}I[D]=256*I[D]+E,++g!=2&&g!==4||D++}if(g!==4)return;break}if(j()===":"){if(M++,!j())return}else if(j())return;I[D++]=u}else{if(V!==null)return;M++,V=++D}}if(V!==null)for(S=D-V,D=7;D!==0&&S>0;)R=I[D],I[D--]=I[V+S-1],I[V+--S]=R;else if(D!==8)return;return I}(db(e,1,-1)),!t))return Rg;this.host=t}else if(this.isSpecial()){if(e=x$(e),id(K$,e)||(t=function(c){var u,f,g,E,v,S,R,I=H$(c,".");if(I.length&&I[I.length-1]===""&&I.length--,(u=I.length)>4)return c;for(f=[],g=0;g<u;g++){if((E=I[g])==="")return c;if(v=10,E.length>1&&pl(E,0)==="0"&&(v=id(z$,E)?16:8,E=db(E,v===8?1:2)),E==="")S=0;else{if(!id(v===10?q$:v===8?Y$:WU,E))return c;S=LC(E,v)}Sy(f,S)}for(g=0;g<u;g++)if(S=f[g],g===u-1){if(S>=BU(256,5-u))return null}else if(S>255)return null;for(R=F$(f),g=0;g<f.length;g++)R+=f[g]*BU(256,3-g);return R}(e),t===null))return Rg;this.host=t}else{if(id(X$,e))return Rg;for(t="",r=vy(e),o=0;o<r.length;o++)t+=gf(r[o],jC);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return $x(UC,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&hb(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,o=e.password,c=e.host,u=e.port,f=e.path,g=e.query,E=e.fragment,v=t+":";return c!==null?(v+="//",e.includesCredentials()&&(v+=r+(o?":"+o:"")+"@"),v+=ub(c),u!==null&&(v+=":"+u)):t==="file"&&(v+="//"),v+=e.cannotBeABaseURL?f[0]:f.length?"/"+lb(f,"/"):"",g!==null&&(v+="?"+g),E!==null&&(v+="#"+E),v},setHref:function(e){var t=this.parse(e);if(t)throw new Zx(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new by(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+ub(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Ph(e)+":",iP)},getUsername:function(){return this.username},setUsername:function(e){var t=vy(Ph(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=gf(t[r],rP)}},getPassword:function(){return this.password},setPassword:function(e){var t=vy(Ph(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=gf(t[r],rP)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?ub(e):ub(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,oP)},getHostname:function(){var e=this.host;return e===null?"":ub(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,cP)},getPort:function(){var e=this.port;return e===null?"":Ph(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Ph(e))===""?this.port=null:this.parse(e,lP))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+lb(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Ty))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Ph(e))===""?this.query=null:(pl(e,0)==="?"&&(e=db(e,1)),this.query="",this.parse(e,Cg)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Ph(e))!==""?(pl(e,0)==="#"&&(e=db(e,1)),this.fragment="",this.parse(e,kh)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var by=function(e){var t=O$(this,No),r=k$(arguments.length,1)>1?arguments[1]:void 0,o=L$(t,new hP(e,!1,r));Xx||(t.href=o.serialize(),t.origin=o.getOrigin(),t.protocol=o.getProtocol(),t.username=o.getUsername(),t.password=o.getPassword(),t.host=o.getHost(),t.hostname=o.getHostname(),t.port=o.getPort(),t.pathname=o.getPathname(),t.search=o.getSearch(),t.searchParams=o.getSearchParams(),t.hash=o.getHash())},No=by.prototype,fl=function(e,t){return{get:function(){return kC(this)[e]()},set:t&&function(r){return kC(this)[t](r)},configurable:!0,enumerable:!0}};if(Xx&&(hl(No,"href",fl("serialize","setHref")),hl(No,"origin",fl("getOrigin")),hl(No,"protocol",fl("getProtocol","setProtocol")),hl(No,"username",fl("getUsername","setUsername")),hl(No,"password",fl("getPassword","setPassword")),hl(No,"host",fl("getHost","setHost")),hl(No,"hostname",fl("getHostname","setHostname")),hl(No,"port",fl("getPort","setPort")),hl(No,"pathname",fl("getPathname","setPathname")),hl(No,"search",fl("getSearch","setSearch")),hl(No,"searchParams",fl("getSearchParams")),hl(No,"hash",fl("getHash","setHash"))),PC(No,"toJSON",function(){return kC(this).serialize()},{enumerable:!0}),PC(No,"toString",function(){return kC(this).serialize()},{enumerable:!0}),cb){var tV=cb.createObjectURL,nV=cb.revokeObjectURL;tV&&PC(by,"createObjectURL",UU(tV,cb)),nV&&PC(by,"revokeObjectURL",UU(nV,cb))}P$(by,"URL"),I$({global:!0,forced:!N$,sham:!Xx},{URL:by});var eJ=xn,rV=p,tJ=Ja,iV=Is,nJ=AC,pP=kn("URL"),rJ=nJ&&rV(function(){pP.canParse()}),iJ=rV(function(){return pP.canParse.length!==1});eJ({target:"URL",stat:!0,forced:!rJ||iJ},{canParse:function(e){var t=tJ(arguments.length,1),r=iV(e),o=t<2||arguments[1]===void 0?void 0:iV(arguments[1]);try{return!!new pP(r,o)}catch{return!1}}});var sJ=xn,aJ=Ja,sV=Is,oJ=AC,cJ=kn("URL");sJ({target:"URL",stat:!0,forced:!oJ},{parse:function(e){var t=aJ(arguments.length,1),r=sV(e),o=t<2||arguments[1]===void 0?void 0:sV(arguments[1]);try{return new cJ(r,o)}catch{return null}}});var BC=l(Gt.URL);let aV=!0,oV=!0;function HC(e,t,r){const o=e.match(t);return o&&o.length>=r&&parseInt(o[r],10)}function Ag(e,t,r){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(f,g){if(f!==t)return c.apply(this,arguments);const E=v=>{const S=r(v);S&&(g.handleEvent?g.handleEvent(S):g(S))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(g,E),c.apply(this,[f,E])};const u=o.removeEventListener;o.removeEventListener=function(f,g){if(f!==t||!this._eventMap||!this._eventMap[t])return u.apply(this,arguments);if(!this._eventMap[t].has(g))return u.apply(this,arguments);const E=this._eventMap[t].get(g);return this._eventMap[t].delete(g),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[f,E])},Object.defineProperty(o,"on"+t,{get(){return this["_on"+t]},set(f){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),f&&this.addEventListener(t,this["_on"+t]=f)},enumerable:!0,configurable:!0})}function lJ(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(aV=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function dJ(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(oV=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function cV(){if(typeof window=="object"){if(aV)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function fP(e,t){oV&&console.warn(e+" is deprecated, please use "+t+" instead.")}function lV(e){return Object.prototype.toString.call(e)==="[object Object]"}function dV(e){var t;return lV(e)?Xa(t=Object.keys(e)).call(t,function(r,o){const c=lV(e[o]),u=c?dV(e[o]):e[o],f=c&&!Object.keys(u).length;return u===void 0||f?r:Object.assign(r,{[o]:u})},{}):e}function mP(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(o=>{o.endsWith("Id")?mP(e,e.get(t[o]),r):o.endsWith("Ids")&&t[o].forEach(c=>{mP(e,e.get(c),r)})}))}function uV(e,t,r){const o=r?"outbound-rtp":"inbound-rtp",c=new Map;if(t===null)return c;const u=[];return e.forEach(f=>{f.type==="track"&&f.trackIdentifier===t.id&&u.push(f)}),u.forEach(f=>{e.forEach(g=>{g.type===o&&g.trackId===f.id&&mP(e,g,c)})}),c}const hV=cV;function pV(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const o=function(f){if(typeof f!="object"||f.mandatory||f.optional)return f;const g={};return Object.keys(f).forEach(E=>{if(E==="require"||E==="advanced"||E==="mediaSource")return;const v=typeof f[E]=="object"?f[E]:{ideal:f[E]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const S=function(R,I){return R?R+I.charAt(0).toUpperCase()+I.slice(1):I==="deviceId"?"sourceId":I};if(v.ideal!==void 0){g.optional=g.optional||[];let R={};typeof v.ideal=="number"?(R[S("min",E)]=v.ideal,g.optional.push(R),R={},R[S("max",E)]=v.ideal,g.optional.push(R)):(R[S("",E)]=v.ideal,g.optional.push(R))}v.exact!==void 0&&typeof v.exact!="number"?(g.mandatory=g.mandatory||{},g.mandatory[S("",E)]=v.exact):["min","max"].forEach(R=>{v[R]!==void 0&&(g.mandatory=g.mandatory||{},g.mandatory[S(R,E)]=v[R])})}),f.advanced&&(g.optional=(g.optional||[]).concat(f.advanced)),g},c=function(f,g){if(t.version>=61)return g(f);if((f=JSON.parse(JSON.stringify(f)))&&typeof f.audio=="object"){const E=function(v,S,R){S in v&&!(R in v)&&(v[R]=v[S],delete v[S])};E((f=JSON.parse(JSON.stringify(f))).audio,"autoGainControl","googAutoGainControl"),E(f.audio,"noiseSuppression","googNoiseSuppression"),f.audio=o(f.audio)}if(f&&typeof f.video=="object"){let E=f.video.facingMode;E=E&&(typeof E=="object"?E:{ideal:E});const v=t.version<66;if(E&&(E.exact==="user"||E.exact==="environment"||E.ideal==="user"||E.ideal==="environment")&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||v)){let S;if(delete f.video.facingMode,E.exact==="environment"||E.ideal==="environment"?S=["back","rear"]:E.exact!=="user"&&E.ideal!=="user"||(S=["front"]),S)return r.mediaDevices.enumerateDevices().then(R=>{let I=(R=R.filter(D=>D.kind==="videoinput")).find(D=>S.some(V=>{var M;return et(M=D.label.toLowerCase()).call(M,V)}));return!I&&R.length&&et(S).call(S,"back")&&(I=R[R.length-1]),I&&(f.video.deviceId=E.exact?{exact:I.deviceId}:{ideal:I.deviceId}),f.video=o(f.video),hV("chrome: "+JSON.stringify(f)),g(f)})}f.video=o(f.video)}return hV("chrome: "+JSON.stringify(f)),g(f)},u=function(f){return t.version>=64?f:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[f.name]||f.name,message:f.message,constraint:f.constraint||f.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(f,g,E){c(f,v=>{r.webkitGetUserMedia(v,g,S=>{E&&E(u(S))})})}).bind(r),r.mediaDevices.getUserMedia){const f=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(g){return c(g,E=>f(E).then(v=>{if(E.audio&&!v.getAudioTracks().length||E.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return v},v=>nt.reject(u(v))))}}}function fV(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function mV(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(f=>f.track&&f.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[r.stream],this.dispatchEvent(u)}),r.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(f=>f.track&&f.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[r.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ag(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function gV(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(f,g){let E=c.apply(this,arguments);return E||(E=t(this,f),this._senders.push(E)),E};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(f){u.apply(this,arguments);const g=this._senders.indexOf(f);g!==-1&&this._senders.splice(g,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],r.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(t(this,u))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const f=this._senders.find(g=>g.track===u);f&&this._senders.splice(this._senders.indexOf(f),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function _V(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,o,c]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const u=function(g){const E={};return g.result().forEach(v=>{const S={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(R=>{S[R]=v.stat(R)}),E[S.id]=S}),E},f=function(g){return new Map(Object.keys(g).map(E=>[E,g[E]]))};if(arguments.length>=2){const g=function(E){o(f(u(E)))};return t.apply(this,[g,r])}return new nt((g,E)=>{t.apply(this,[function(v){g(f(u(v)))},E])}).then(o,c)}}function EV(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=r.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>uV(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o}),Ag(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>uV(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let o,c,u;return this.getSenders().forEach(f=>{f.track===r&&(o?u=!0:o=f)}),this.getReceivers().forEach(f=>(f.track===r&&(c?u=!0:c=f),f.track===r)),u||o&&c?nt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():nt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function yV(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,f){if(!f)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const g=t.apply(this,arguments);return this._shimmedLocalStreams[f.id]?this._shimmedLocalStreams[f.id].indexOf(g)===-1&&this._shimmedLocalStreams[f.id].push(g):this._shimmedLocalStreams[f.id]=[f,g],g};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(E=>{if(this.getSenders().find(S=>S.track===E))throw new DOMException("Track already exists.","InvalidAccessError")});const f=this.getSenders();r.apply(this,arguments);const g=this.getSenders().filter(E=>f.indexOf(E)===-1);this._shimmedLocalStreams[u.id]=[u].concat(g)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(f=>{const g=this._shimmedLocalStreams[f].indexOf(u);g!==-1&&this._shimmedLocalStreams[f].splice(g,1),this._shimmedLocalStreams[f].length===1&&delete this._shimmedLocalStreams[f]}),c.apply(this,arguments)}}function vV(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return yV(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const E=r.apply(this);return this._reverseStreams=this._reverseStreams||{},E.map(v=>this._reverseStreams[v.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(E){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},E.getTracks().forEach(v=>{if(this.getSenders().find(R=>R.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[E.id]){const v=new e.MediaStream(E.getTracks());this._streams[E.id]=v,this._reverseStreams[v.id]=E,E=v}o.apply(this,[E])};const c=e.RTCPeerConnection.prototype.removeStream;function u(E,v){let S=v.sdp;return Object.keys(E._reverseStreams||[]).forEach(R=>{const I=E._reverseStreams[R],D=E._streams[I.id];S=S.replace(new RegExp(D.id,"g"),I.id)}),new RTCSessionDescription({type:v.type,sdp:S})}e.RTCPeerConnection.prototype.removeStream=function(E){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[E.id]||E]),delete this._reverseStreams[this._streams[E.id]?this._streams[E.id].id:E.id],delete this._streams[E.id]},e.RTCPeerConnection.prototype.addTrack=function(E,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(D=>D===E))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(D=>D.track===E))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const I=this._streams[v.id];if(I)I.addTrack(E),nt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const D=new e.MediaStream([E]);this._streams[v.id]=D,this._reverseStreams[D.id]=v,this.addStream(D)}return this.getSenders().find(D=>D.track===E)},["createOffer","createAnswer"].forEach(function(E){const v=e.RTCPeerConnection.prototype[E],S={[E](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[I=>{const D=u(this,I);R[0].apply(null,[D])},I=>{R[1]&&R[1].apply(null,I)},arguments[2]]):v.apply(this,arguments).then(I=>u(this,I))}};e.RTCPeerConnection.prototype[E]=S[E]});const f=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(E,v){let S=v.sdp;return Object.keys(E._reverseStreams||[]).forEach(R=>{const I=E._reverseStreams[R],D=E._streams[I.id];S=S.replace(new RegExp(I.id,"g"),D.id)}),new RTCSessionDescription({type:v.type,sdp:S})}(this,arguments[0]),f.apply(this,arguments)):f.apply(this,arguments)};const g=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const E=g.get.apply(this);return E.type===""?E:u(this,E)}}),e.RTCPeerConnection.prototype.removeTrack=function(E){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!E._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(E._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(R=>E.track===R)&&(v=this._streams[S])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(E.track),this.dispatchEvent(new Event("negotiationneeded")))}}function gP(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=e.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=c[r]})}function SV(e,t){Ag(e,"negotiationneeded",r=>{const o=r.target;if(!(t.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return r})}var TV=Object.freeze({__proto__:null,fixNegotiationNeeded:SV,shimAddTrackRemoveTrack:vV,shimAddTrackRemoveTrackWithNative:yV,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(o=>{const c=r.video&&r.video.width,u=r.video&&r.video.height,f=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:f||3}},c&&(r.video.mandatory.maxWidth=c),u&&(r.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:gV,shimGetStats:_V,shimGetUserMedia:pV,shimMediaStream:fV,shimOnTrack:mV,shimPeerConnection:gP,shimSenderReceiverGetStats:EV});function bV(e,t){const r=e&&e.navigator,o=e&&e.MediaStreamTrack;if(r.getUserMedia=function(c,u,f){fP("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(c).then(u,f)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const c=function(f,g,E){g in f&&!(E in f)&&(f[E]=f[g],delete f[g])},u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(f){return typeof f=="object"&&typeof f.audio=="object"&&(f=JSON.parse(JSON.stringify(f)),c(f.audio,"autoGainControl","mozAutoGainControl"),c(f.audio,"noiseSuppression","mozNoiseSuppression")),u(f)},o&&o.prototype.getSettings){const f=o.prototype.getSettings;o.prototype.getSettings=function(){const g=f.apply(this,arguments);return c(g,"mozAutoGainControl","autoGainControl"),c(g,"mozNoiseSuppression","noiseSuppression"),g}}if(o&&o.prototype.applyConstraints){const f=o.prototype.applyConstraints;o.prototype.applyConstraints=function(g){return this.kind==="audio"&&typeof g=="object"&&(g=JSON.parse(JSON.stringify(g)),c(g,"autoGainControl","mozAutoGainControl"),c(g,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[g])}}}}function wV(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function _P(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],f={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=f[c]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,f]=arguments;return o.apply(this,[c||null]).then(g=>{if(t.version<53&&!u)try{g.forEach(E=>{E.type=r[E.type]||E.type})}catch(E){if(E.name!=="TypeError")throw E;g.forEach((v,S)=>{g.set(S,Object.assign({},v,{type:r[v.type]||v.type}))})}return g}).then(u,f)}}function RV(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(c=>c._pc=this),o});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=r.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):nt.resolve(new Map)}}function CV(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r}),Ag(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function AV(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){fP("removeStream","removeTrack"),this.getSenders().forEach(r=>{var o;r.track&&et(o=t.getTracks()).call(o,r.track)&&this.removeTrack(r)})})}function IV(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function NV(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const o=r.length>0;o&&r.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=t.apply(this,arguments);if(o){const{sender:u}=c,f=u.getParameters();(!("encodings"in f)||f.encodings.length===1&&Object.keys(f.encodings[0]).length===0)&&(f.encodings=r,u.sendEncodings=r,this.setParametersPromises.push(u.setParameters(f).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function OV(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function DV(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?nt.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function xV(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?nt.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var PV=Object.freeze({__proto__:null,shimAddTransceiver:NV,shimCreateAnswer:xV,shimCreateOffer:DV,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,nt.reject(o)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:OV,shimGetUserMedia:bV,shimOnTrack:wV,shimPeerConnection:_P,shimRTCDataChannel:IV,shimReceiverGetStats:CV,shimRemoveStream:AV,shimSenderGetStats:RV});function kV(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){var o;this._localStreams||(this._localStreams=[]),et(o=this._localStreams).call(o,r)||this._localStreams.push(r),r.getAudioTracks().forEach(c=>t.call(this,c,r)),r.getVideoTracks().forEach(c=>t.call(this,c,r))},e.RTCPeerConnection.prototype.addTrack=function(r){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(f=>{var g;this._localStreams?et(g=this._localStreams).call(g,f)||this._localStreams.push(f):this._localStreams=[f]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const o=t.getTracks();this.getSenders().forEach(c=>{et(o).call(o,c.track)&&this.removeTrack(c)})})}}function LV(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),et(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const f=new Event("addstream");f.stream=c,this.dispatchEvent(f)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(c)>=0)return;r._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,r.dispatchEvent(u)})}),t.apply(r,arguments)}}}function MV(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,o=t.createAnswer,c=t.setLocalDescription,u=t.setRemoteDescription,f=t.addIceCandidate;t.createOffer=function(E,v){const S=arguments.length>=2?arguments[2]:arguments[0],R=r.apply(this,[S]);return v?(R.then(E,v),nt.resolve()):R},t.createAnswer=function(E,v){const S=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[S]);return v?(R.then(E,v),nt.resolve()):R};let g=function(E,v,S){const R=c.apply(this,[E]);return S?(R.then(v,S),nt.resolve()):R};t.setLocalDescription=g,g=function(E,v,S){const R=u.apply(this,[E]);return S?(R.then(v,S),nt.resolve()):R},t.setRemoteDescription=g,g=function(E,v,S){const R=f.apply(this,[E]);return S?(R.then(v,S),nt.resolve()):R},t.addIceCandidate=g}function jV(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const r=t.mediaDevices,o=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=c=>o(UV(c))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,o,c){t.mediaDevices.getUserMedia(r).then(o,c)}).bind(t))}function UV(e){return e&&e.video!==void 0?Object.assign({},e,{video:dV(e.video)}):e}function VV(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,o){if(r&&r.iceServers){const c=[];for(let u=0;u<r.iceServers.length;u++){let f=r.iceServers[u];!f.hasOwnProperty("urls")&&f.hasOwnProperty("url")?(fP("RTCIceServer.url","RTCIceServer.urls"),f=JSON.parse(JSON.stringify(f)),f.urls=f.url,delete f.url,c.push(f)):c.push(r.iceServers[u])}r.iceServers=c}return new t(r,o)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function FV(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function BV(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):r.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function HV(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var GV=Object.freeze({__proto__:null,shimAudioContext:HV,shimCallbacksAPI:MV,shimConstraints:UV,shimCreateOfferLegacy:BV,shimGetUserMedia:jV,shimLocalStreamsAPI:kV,shimRTCIceServerUrls:VV,shimRemoteStreamsAPI:LV,shimTrackEventTransceiver:FV}),WV=`	
\v\f\r \u2028\u2029\uFEFF`,uJ=Xn,hJ=Is,EP=WV,zV=k("".replace),pJ=RegExp("^["+EP+"]+"),fJ=RegExp("(^|[^"+EP+"])["+EP+"]+$"),mJ=function(e){return function(t){var r=hJ(uJ(t));return 1&e&&(r=zV(r,pJ,"")),2&e&&(r=zV(r,fJ,"$1")),r}},gJ={trim:mJ(3)},_J=vh.PROPER,EJ=p,YV=WV,yJ=gJ.trim;xn({target:"String",proto:!0,forced:function(e){return EJ(function(){return!!YV[e]()||""[e]()!==""||_J&&YV[e].name!==e})}("trim")},{trim:function(){return yJ(this)}});var vJ=vo("String","trim"),SJ=U,TJ=vJ,yP=String.prototype,bJ=function(e){var t=e.trim;return typeof e=="string"||e===yP||SJ(yP,e)&&t===yP.trim?TJ:t},sa=l(bJ),qV={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(r){return r.trim().split(`
`).map(o=>o.trim())},t.splitSections=function(r){return r.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},t.getDescription=function(r){const o=t.splitSections(r);return o&&o[0]},t.getMediaSections=function(r){const o=t.splitSections(r);return o.shift(),o},t.matchPrefix=function(r,o){return t.splitLines(r).filter(c=>c.indexOf(o)===0)},t.parseCandidate=function(r){let o;o=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},t.writeCandidate=function(r){const o=[];o.push(r.foundation);const c=r.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(r.protocol.toUpperCase()),o.push(r.priority),o.push(r.address||r.ip),o.push(r.port);const u=r.type;return o.push("typ"),o.push(u),u!=="host"&&r.relatedAddress&&r.relatedPort&&(o.push("raddr"),o.push(r.relatedAddress),o.push("rport"),o.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(o.push("ufrag"),o.push(r.usernameFragment||r.ufrag)),"candidate:"+o.join(" ")},t.parseIceOptions=function(r){return r.substring(14).split(" ")},t.parseRtpMap=function(r){let o=r.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},t.writeRtpMap=function(r){let o=r.payloadType;r.preferredPayloadType!==void 0&&(o=r.preferredPayloadType);const c=r.channels||r.numChannels||1;return"a=rtpmap:"+o+" "+r.name+"/"+r.clockRate+(c!==1?"/"+c:"")+`\r
`},t.parseExtmap=function(r){const o=r.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},t.parseFmtp=function(r){const o={};let c;const u=r.substring(r.indexOf(" ")+1).split(";");for(let f=0;f<u.length;f++)c=u[f].trim().split("="),o[c[0].trim()]=c[1];return o},t.writeFmtp=function(r){let o="",c=r.payloadType;if(r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const u=[];Object.keys(r.parameters).forEach(f=>{r.parameters[f]!==void 0?u.push(f+"="+r.parameters[f]):u.push(f)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},t.parseRtcpFb=function(r){const o=r.substring(r.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},t.writeRtcpFb=function(r){let o="",c=r.payloadType;return r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},t.parseSsrcMedia=function(r){const o=r.indexOf(" "),c={ssrc:parseInt(r.substring(7,o),10)},u=r.indexOf(":",o);return u>-1?(c.attribute=r.substring(o+1,u),c.value=r.substring(u+1)):c.attribute=r.substring(o+1),c},t.parseSsrcGroup=function(r){const o=r.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},t.getMid=function(r){const o=t.matchPrefix(r,"a=mid:")[0];if(o)return o.substring(6)},t.parseFingerprint=function(r){const o=r.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},t.getDtlsParameters=function(r,o){return{role:"auto",fingerprints:t.matchPrefix(r+o,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(r,o){let c="a=setup:"+o+`\r
`;return r.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},t.parseCryptoLine=function(r){const o=r.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},t.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?t.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const o=r.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},t.getCryptoParameters=function(r,o){return t.matchPrefix(r+o,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(r,o){const c=t.matchPrefix(r+o,"a=ice-ufrag:")[0],u=t.matchPrefix(r+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},t.writeIceParameters=function(r){let o="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(o+=`a=ice-lite\r
`),o},t.parseRtpParameters=function(r){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=t.splitLines(r)[0].split(" ");o.profile=c[2];for(let f=3;f<c.length;f++){const g=c[f],E=t.matchPrefix(r,"a=rtpmap:"+g+" ")[0];if(E){const v=t.parseRtpMap(E),S=t.matchPrefix(r,"a=fmtp:"+g+" ");switch(v.parameters=S.length?t.parseFmtp(S[0]):{},v.rtcpFeedback=t.matchPrefix(r,"a=rtcp-fb:"+g+" ").map(t.parseRtcpFb),o.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(v.name.toUpperCase())}}}t.matchPrefix(r,"a=extmap:").forEach(f=>{o.headerExtensions.push(t.parseExtmap(f))});const u=t.matchPrefix(r,"a=rtcp-fb:* ").map(t.parseRtcpFb);return o.codecs.forEach(f=>{u.forEach(g=>{f.rtcpFeedback.find(E=>E.type===g.type&&E.parameter===g.parameter)||f.rtcpFeedback.push(g)})}),o},t.writeRtpDescription=function(r,o){let c="";c+="m="+r+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(f=>f.preferredPayloadType!==void 0?f.preferredPayloadType:f.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(f=>{c+=t.writeRtpMap(f),c+=t.writeFmtp(f),c+=t.writeRtcpFb(f)});let u=0;return o.codecs.forEach(f=>{f.maxptime>u&&(u=f.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(f=>{c+=t.writeExtmap(f)}),c},t.parseRtpEncodingParameters=function(r){const o=[],c=t.parseRtpParameters(r),u=c.fecMechanisms.indexOf("RED")!==-1,f=c.fecMechanisms.indexOf("ULPFEC")!==-1,g=t.matchPrefix(r,"a=ssrc:").map(I=>t.parseSsrcMedia(I)).filter(I=>I.attribute==="cname"),E=g.length>0&&g[0].ssrc;let v;const S=t.matchPrefix(r,"a=ssrc-group:FID").map(I=>I.substring(17).split(" ").map(D=>parseInt(D,10)));S.length>0&&S[0].length>1&&S[0][0]===E&&(v=S[0][1]),c.codecs.forEach(I=>{if(I.name.toUpperCase()==="RTX"&&I.parameters.apt){let D={ssrc:E,codecPayloadType:parseInt(I.parameters.apt,10)};E&&v&&(D.rtx={ssrc:v}),o.push(D),u&&(D=JSON.parse(JSON.stringify(D)),D.fec={ssrc:E,mechanism:f?"red+ulpfec":"red"},o.push(D))}}),o.length===0&&E&&o.push({ssrc:E});let R=t.matchPrefix(r,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,o.forEach(I=>{I.maxBitrate=R})),o},t.parseRtcpParameters=function(r){const o={},c=t.matchPrefix(r,"a=ssrc:").map(g=>t.parseSsrcMedia(g)).filter(g=>g.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=t.matchPrefix(r,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const f=t.matchPrefix(r,"a=rtcp-mux");return o.mux=f.length>0,o},t.writeRtcpParameters=function(r){let o="";return r.reducedSize&&(o+=`a=rtcp-rsize\r
`),r.mux&&(o+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(o+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),o},t.parseMsid=function(r){let o;const c=t.matchPrefix(r,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=t.matchPrefix(r,"a=ssrc:").map(f=>t.parseSsrcMedia(f)).filter(f=>f.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},t.parseSctpDescription=function(r){const o=t.parseMLine(r),c=t.matchPrefix(r,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const f=t.matchPrefix(r,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const g=t.matchPrefix(r,"a=sctpmap:");if(g.length>0){const E=g[0].substring(10).split(" ");return{port:parseInt(E[0],10),protocol:E[1],maxMessageSize:u}}},t.writeSctpDescription=function(r,o){let c=[];return c=r.protocol!=="DTLS/SCTP"?["m="+r.kind+" 9 "+r.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+r.kind+" 9 "+r.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(r,o,c){let u;const f=o!==void 0?o:2;return u=r||t.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+f+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(r,o){const c=t.splitLines(r);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?t.getDirection(o):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substring(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){const o=t.splitLines(r)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},t.parseOLine=function(r){const o=t.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const o=t.splitLines(r);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=t})(qV);var KV=qV.exports,wy=l(KV),wJ=i({__proto__:null,default:wy},[KV]);function GC(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const o=new t(r),c=wy.parseCandidate(r.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,Ag(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function vP(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Ag(e,"icecandidate",t=>{if(t.candidate){const r=wy.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t})}function WC(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const r=function(g){if(!g||!g.sdp)return!1;const E=wy.splitSections(g.sdp);return E.shift(),E.some(v=>{const S=wy.parseMLine(v);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(g){const E=g.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(E===null||E.length<2)return-1;const v=parseInt(E[1],10);return v!=v?-1:v},c=function(g){let E=65536;return t.browser==="firefox"&&(E=t.version<57?g===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),E},u=function(g,E){let v=65536;t.browser==="firefox"&&t.version===57&&(v=65535);const S=wy.matchPrefix(g.sdp,"a=max-message-size:");return S.length>0?v=parseInt(S[0].substr(19),10):t.browser==="firefox"&&E!==-1&&(v=2147483637),v},f=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:g}=this.getConfiguration();g==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const g=o(arguments[0]),E=c(g),v=u(arguments[0],g);let S;S=E===0&&v===0?Number.POSITIVE_INFINITY:E===0||v===0?Math.max(E,v):Math.min(E,v);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>S}),this._sctp=R}return f.apply(this,arguments)}}function zC(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(o,c){const u=o.send;o.send=function(){const f=arguments[0],g=f.length||f.size||f.byteLength;if(o.readyState==="open"&&c.sctp&&g>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=r.apply(this,arguments);return t(o,this),o},Ag(e,"datachannel",o=>(t(o.channel,o.target),o))}function SP(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const o=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const f=new Event("connectionstatechange",c);u.dispatchEvent(f)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function TP(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>sa(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return r.apply(this,arguments)}}function YC(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&r.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?nt.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),nt.resolve())})}function qC(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&r.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return r.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?r.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>r.apply(this,[c]))})}var RJ=Object.freeze({__proto__:null,removeExtmapAllowMixed:TP,shimAddIceCandidateNullOrEmpty:YC,shimConnectionState:SP,shimMaxMessageSize:WC,shimParameterlessSetLocalDescription:qC,shimRTCIceCandidate:GC,shimRTCIceCandidateRelayProtocol:vP,shimSendThrowTypeError:zC});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const r=cV,o=function(u){const f={browser:null,version:null};if(u===void 0||!u.navigator)return f.browser="Not a browser.",f;const{navigator:g}=u;if(g.mozGetUserMedia)f.browser="firefox",f.version=HC(g.userAgent,/Firefox\/(\d+)\./,1);else if(g.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)f.browser="chrome",f.version=HC(g.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!g.userAgent.match(/AppleWebKit\/(\d+)\./))return f.browser="Not a supported browser.",f;f.browser="safari",f.version=HC(g.userAgent,/AppleWebKit\/(\d+)\./,1),f.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return f}(e),c={browserDetails:o,commonShim:RJ,extractVersion:HC,disableLog:lJ,disableWarnings:dJ,sdp:wJ};switch(o.browser){case"chrome":if(!TV||!gP||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),c;if(o.version===null)return r("Chrome shim can not determine version, not shimming."),c;r("adapter.js shimming chrome."),c.browserShim=TV,YC(e,o),qC(e),pV(e,o),fV(e),gP(e,o),mV(e),vV(e,o),gV(e),_V(e),EV(e),SV(e,o),GC(e),vP(e),SP(e),WC(e,o),zC(e),TP(e,o);break;case"firefox":if(!PV||!_P||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),c;r("adapter.js shimming firefox."),c.browserShim=PV,YC(e,o),qC(e),bV(e,o),_P(e,o),wV(e),AV(e),RV(e),CV(e),IV(e),NV(e),OV(e),DV(e),xV(e),GC(e),SP(e),WC(e,o),zC(e);break;case"safari":if(!GV||!t.shimSafari)return r("Safari shim is not included in this adapter release."),c;r("adapter.js shimming safari."),c.browserShim=GV,YC(e,o),qC(e),VV(e),BV(e),MV(e),kV(e),LV(e),FV(e),jV(e),HV(e),GC(e),vP(e),WC(e,o),zC(e),TP(e,o);break;default:r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var bP=W;xn({global:!0,forced:bP.globalThis!==bP},{globalThis:bP});var XV=l(W),wP={exports:{}};(function(e,t){(function(r,o){var c="function",u="undefined",f="object",g="string",E="major",v="model",S="name",R="type",I="vendor",D="version",V="architecture",M="console",j="mobile",G="tablet",z="smarttv",ce="wearable",Ee="embedded",_e="Amazon",me="Apple",Ce="ASUS",xe="BlackBerry",$e="Browser",at="Chrome",Zt="Firefox",qt="Google",Pt="Huawei",hr="LG",er="Microsoft",ja="Motorola",Pe="Opera",Ye="Samsung",pt="Sharp",ke="Sony",L="Xiaomi",ne="Zebra",de="Facebook",ze="Chromium OS",Bt="Mac OS",dr=" Browser",Di=function(bi){for(var xi={},Er=0;Er<bi.length;Er++)xi[bi[Er].toUpperCase()]=bi[Er];return xi},kc=function(bi,xi){return typeof bi===g&&Nl(xi).indexOf(Nl(bi))!==-1},Nl=function(bi){return bi.toLowerCase()},_w=function(bi,xi){if(typeof bi===g)return bi=bi.replace(/^\s\s*/,""),typeof xi===u?bi:bi.substring(0,500)},t_=function(bi,xi){for(var Er,so,Ed,ri,Qh,Tn,yd=0;yd<xi.length&&!Qh;){var n_=xi[yd],Ru=xi[yd+1];for(Er=so=0;Er<n_.length&&!Qh&&n_[Er];)if(Qh=n_[Er++].exec(bi))for(Ed=0;Ed<Ru.length;Ed++)Tn=Qh[++so],typeof(ri=Ru[Ed])===f&&ri.length>0?ri.length===2?typeof ri[1]==c?this[ri[0]]=ri[1].call(this,Tn):this[ri[0]]=ri[1]:ri.length===3?typeof ri[1]!==c||ri[1].exec&&ri[1].test?this[ri[0]]=Tn?Tn.replace(ri[1],ri[2]):o:this[ri[0]]=Tn?ri[1].call(this,Tn,ri[2]):o:ri.length===4&&(this[ri[0]]=Tn?ri[3].call(this,Tn.replace(ri[1],ri[2])):o):this[ri]=Tn||o;yd+=2}},gv=function(bi,xi){for(var Er in xi)if(typeof xi[Er]===f&&xi[Er].length>0){for(var so=0;so<xi[Er].length;so++)if(kc(xi[Er][so],bi))return Er==="?"?o:Er}else if(kc(xi[Er],bi))return Er==="?"?o:Er;return xi.hasOwnProperty("*")?xi["*"]:bi},GI={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},WI={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[D,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[D,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,D],[/opios[\/ ]+([\w\.]+)/i],[D,[S,Pe+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[D,[S,Pe+" GX"]],[/\bopr\/([\w\.]+)/i],[D,[S,Pe]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[D,[S,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[D,[S,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[S,D],[/quark(?:pc)?\/([-\w\.]+)/i],[D,[S,"Quark"]],[/\bddg\/([\w\.]+)/i],[D,[S,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[D,[S,"UC"+$e]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[D,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[D,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[D,[S,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[D,[S,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[D,[S,"Smart Lenovo "+$e]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+$e],D],[/\bfocus\/([\w\.]+)/i],[D,[S,Zt+" Focus"]],[/\bopt\/([\w\.]+)/i],[D,[S,Pe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[D,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[D,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[D,[S,Pe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[D,[S,"MIUI"+dr]],[/fxios\/([\w\.-]+)/i],[D,[S,Zt]],[/\bqihoobrowser\/?([\w\.]*)/i],[D,[S,"360"]],[/\b(qq)\/([\w\.]+)/i],[[S,/(.+)/,"$1Browser"],D],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1"+dr],D],[/samsungbrowser\/([\w\.]+)/i],[D,[S,Ye+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[D,[S,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[S,"Sogou Mobile"],D],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[S,D],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[S],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[D,S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,de],D],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[S,D],[/\bgsa\/([\w\.]+) .*safari\//i],[D,[S,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[D,[S,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[D,[S,at+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,at+" WebView"],D],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[D,[S,"Android "+$e]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,D],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[D,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[D,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[D,gv,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,D],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],D],[/(wolvic|librewolf)\/([\w\.]+)/i],[S,D],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[D,[S,Zt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[S,[D,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[S,[D,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[V,"amd64"]],[/(ia32(?=;))/i],[[V,Nl]],[/((?:i[346]|x)86)[;\)]/i],[[V,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[V,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[V,"armhf"]],[/windows (ce|mobile); ppc;/i],[[V,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[V,/ower/,"",Nl]],[/(sun4\w)[;\)]/i],[[V,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[V,Nl]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[I,Ye],[R,G]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[v,[I,Ye],[R,j]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[v,[I,me],[R,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[I,me],[R,G]],[/(macintosh);/i],[v,[I,me]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[I,pt],[R,j]],[/(?:honor)([-\w ]+)[;\)]/i],[v,[I,"Honor"],[R,j]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[I,Pt],[R,G]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[I,Pt],[R,j]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[v,/_/g," "],[I,L],[R,j]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[I,L],[R,G]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[I,"OPPO"],[R,j]],[/\b(opd2\d{3}a?) bui/i],[v,[I,"OPPO"],[R,G]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[I,"Vivo"],[R,j]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[v,[I,"Realme"],[R,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[I,ja],[R,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[I,ja],[R,G]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[I,hr],[R,G]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[I,hr],[R,j]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[I,"Lenovo"],[R,G]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[I,"Nokia"],[R,j]],[/(pixel c)\b/i],[v,[I,qt],[R,G]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[I,qt],[R,j]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[I,ke],[R,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[I,ke],[R,G]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[I,"OnePlus"],[R,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[I,_e],[R,G]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[I,_e],[R,j]],[/(playbook);[-\w\),; ]+(rim)/i],[v,I,[R,G]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[I,xe],[R,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[I,Ce],[R,G]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[I,Ce],[R,j]],[/(nexus 9)/i],[v,[I,"HTC"],[R,G]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[I,[v,/_/g," "],[R,j]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[v,[I,"TCL"],[R,G]],[/(itel) ((\w+))/i],[[I,Nl],v,[R,gv,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[I,"Acer"],[R,G]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[I,"Meizu"],[R,j]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[v,[I,"Ulefone"],[R,j]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[v,[I,"Energizer"],[R,j]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[v,[I,"Cat"],[R,j]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[v,[I,"Smartfren"],[R,j]],[/droid.+; (a(?:015|06[35]|142p?))/i],[v,[I,"Nothing"],[R,j]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[I,v,[R,j]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[I,v,[R,G]],[/(surface duo)/i],[v,[I,er],[R,G]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[I,"Fairphone"],[R,j]],[/(u304aa)/i],[v,[I,"AT&T"],[R,j]],[/\bsie-(\w*)/i],[v,[I,"Siemens"],[R,j]],[/\b(rct\w+) b/i],[v,[I,"RCA"],[R,G]],[/\b(venue[\d ]{2,7}) b/i],[v,[I,"Dell"],[R,G]],[/\b(q(?:mv|ta)\w+) b/i],[v,[I,"Verizon"],[R,G]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[I,"Barnes & Noble"],[R,G]],[/\b(tm\d{3}\w+) b/i],[v,[I,"NuVision"],[R,G]],[/\b(k88) b/i],[v,[I,"ZTE"],[R,G]],[/\b(nx\d{3}j) b/i],[v,[I,"ZTE"],[R,j]],[/\b(gen\d{3}) b.+49h/i],[v,[I,"Swiss"],[R,j]],[/\b(zur\d{3}) b/i],[v,[I,"Swiss"],[R,G]],[/\b((zeki)?tb.*\b) b/i],[v,[I,"Zeki"],[R,G]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[I,"Dragon Touch"],v,[R,G]],[/\b(ns-?\w{0,9}) b/i],[v,[I,"Insignia"],[R,G]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[I,"NextBook"],[R,G]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[I,"Voice"],v,[R,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[I,"LvTel"],v,[R,j]],[/\b(ph-1) /i],[v,[I,"Essential"],[R,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[I,"Envizen"],[R,G]],[/\b(trio[-\w\. ]+) b/i],[v,[I,"MachSpeed"],[R,G]],[/\btu_(1491) b/i],[v,[I,"Rotor"],[R,G]],[/(shield[\w ]+) b/i],[v,[I,"Nvidia"],[R,G]],[/(sprint) (\w+)/i],[I,v,[R,j]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[I,er],[R,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[I,ne],[R,G]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[I,ne],[R,j]],[/smart-tv.+(samsung)/i],[I,[R,z]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[I,Ye],[R,z]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[I,hr],[R,z]],[/(apple) ?tv/i],[I,[v,me+" TV"],[R,z]],[/crkey/i],[[v,at+"cast"],[I,qt],[R,z]],[/droid.+aft(\w+)( bui|\))/i],[v,[I,_e],[R,z]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[I,pt],[R,z]],[/(bravia[\w ]+)( bui|\))/i],[v,[I,ke],[R,z]],[/(mitv-\w{5}) bui/i],[v,[I,L],[R,z]],[/Hbbtv.*(technisat) (.*);/i],[I,v,[R,z]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[I,_w],[v,_w],[R,z]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,z]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[I,v,[R,M]],[/droid.+; (shield) bui/i],[v,[I,"Nvidia"],[R,M]],[/(playstation [345portablevi]+)/i],[v,[I,ke],[R,M]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[I,er],[R,M]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[v,[I,Ye],[R,ce]],[/((pebble))app/i],[I,v,[R,ce]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[I,me],[R,ce]],[/droid.+; (glass) \d/i],[v,[I,qt],[R,ce]],[/droid.+; (wt63?0{2,3})\)/i],[v,[I,ne],[R,ce]],[/droid.+; (glass) \d/i],[v,[I,qt],[R,ce]],[/(pico) (4|neo3(?: link|pro)?)/i],[I,v,[R,ce]],[/; (quest( \d| pro)?)/i],[v,[I,de],[R,ce]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[I,[R,Ee]],[/(aeobc)\b/i],[v,[I,_e],[R,Ee]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[v,[R,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[R,G]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,G]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,j]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[I,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[D,[S,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[S,D],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[D,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[S,D],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[D,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,D],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[S,[D,gv,GI]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[D,gv,GI],[S,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[D,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,Bt],[D,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[D,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,D],[/\(bb(10);/i],[D,[S,xe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[D,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[D,[S,Zt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[D,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[D,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[D,[S,at+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,ze],D],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,D],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],D],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[S,D]]},Lc=function(bi,xi){if(typeof bi===f&&(xi=bi,bi=o),!(this instanceof Lc))return new Lc(bi,xi).getResult();var Er=typeof r!==u&&r.navigator?r.navigator:o,so=bi||(Er&&Er.userAgent?Er.userAgent:""),Ed=Er&&Er.userAgentData?Er.userAgentData:o,ri=xi?function(Tn,yd){var n_={};for(var Ru in Tn)yd[Ru]&&yd[Ru].length%2==0?n_[Ru]=yd[Ru].concat(Tn[Ru]):n_[Ru]=Tn[Ru];return n_}(WI,xi):WI,Qh=Er&&Er.userAgent==so;return this.getBrowser=function(){var Tn={};return Tn[S]=o,Tn[D]=o,t_.call(Tn,so,ri.browser),Tn[E]=function(yd){return typeof yd===g?yd.replace(/[^\d\.]/g,"").split(".")[0]:o}(Tn[D]),Qh&&Er&&Er.brave&&typeof Er.brave.isBrave==c&&(Tn[S]="Brave"),Tn},this.getCPU=function(){var Tn={};return Tn[V]=o,t_.call(Tn,so,ri.cpu),Tn},this.getDevice=function(){var Tn={};return Tn[I]=o,Tn[v]=o,Tn[R]=o,t_.call(Tn,so,ri.device),Qh&&!Tn[R]&&Ed&&Ed.mobile&&(Tn[R]=j),Qh&&Tn[v]=="Macintosh"&&Er&&typeof Er.standalone!==u&&Er.maxTouchPoints&&Er.maxTouchPoints>2&&(Tn[v]="iPad",Tn[R]=G),Tn},this.getEngine=function(){var Tn={};return Tn[S]=o,Tn[D]=o,t_.call(Tn,so,ri.engine),Tn},this.getOS=function(){var Tn={};return Tn[S]=o,Tn[D]=o,t_.call(Tn,so,ri.os),Qh&&!Tn[S]&&Ed&&Ed.platform&&Ed.platform!="Unknown"&&(Tn[S]=Ed.platform.replace(/chrome os/i,ze).replace(/macos/i,Bt)),Tn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return so},this.setUA=function(Tn){return so=typeof Tn===g&&Tn.length>500?_w(Tn,500):Tn,this},this.setUA(so),this};Lc.VERSION="0.7.40",Lc.BROWSER=Di([S,D,E]),Lc.CPU=Di([V]),Lc.DEVICE=Di([v,I,R,M,j,z,G,ce,Ee]),Lc.ENGINE=Lc.OS=Di([S,D]),e.exports&&(t=e.exports=Lc),t.UAParser=Lc;var Xh=typeof r!==u&&(r.jQuery||r.Zepto);if(Xh&&!Xh.ua){var zI=new Lc;Xh.ua=zI.getResult(),Xh.ua.get=function(){return zI.getUA()},Xh.ua.set=function(bi){zI.setUA(bi);var xi=zI.getResult();for(var Er in xi)Xh.ua[Er]=xi[Er]}}})(typeof window=="object"?window:s)})(wP,wP.exports);var CJ=l(wP.exports),QV=Tc.clear;xn({global:!0,bind:!0,forced:W.clearImmediate!==QV},{clearImmediate:QV});var $V=W,AJ=ue,IJ=fe,NJ=Ip,OJ=sn,DJ=Na,xJ=Ja,PJ=$V.Function,kJ=/MSIE .\./.test(OJ)||NJ==="BUN"&&function(){var e=$V.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),LJ=xn,JV=W,ZV=Tc.set,MJ=function(e,t){var r=1;return kJ?function(o,c){var u=xJ(arguments.length,1)>r,f=IJ(o)?o:PJ(o),g=u?DJ(arguments,r):[],E=u?function(){AJ(f,this,g)}:f;return e(E)}:e},eF=JV.setImmediate?MJ(ZV):ZV;LJ({global:!0,bind:!0,forced:JV.setImmediate!==eF},{setImmediate:eF});var tF=l(Gt.setImmediate),jJ=W,UJ=Ah,VJ=ln,FJ=Ja,BJ=Ne;xn({global:!0,dontCallGetSet:!0,forced:p(function(){return BJ&&Object.getOwnPropertyDescriptor(jJ,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){FJ(arguments.length,1),UJ(VJ(e))}});var nF=l(Gt.queueMicrotask);function rF(e,t){return function(){return e.apply(t,arguments)}}const{toString:HJ}=Object.prototype,{getPrototypeOf:RP}=Object,{iterator:KC,toStringTag:iF}=Symbol,XC=(CP=Object.create(null),e=>{const t=HJ.call(e);return CP[t]||(CP[t]=t.slice(8,-1).toLowerCase())});var CP;const sd=e=>(e=e.toLowerCase(),t=>XC(t)===e),QC=e=>t=>typeof t===e,{isArray:Ry}=Array,pb=QC("undefined"),sF=sd("ArrayBuffer"),GJ=QC("string"),Xo=QC("function"),aF=QC("number"),$C=e=>e!==null&&typeof e=="object",JC=e=>{if(XC(e)!=="object")return!1;const t=RP(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||iF in e||KC in e)},WJ=sd("Date"),zJ=sd("File"),YJ=sd("Blob"),qJ=sd("FileList"),KJ=sd("URLSearchParams"),[XJ,QJ,$J,JJ]=["ReadableStream","Request","Response","Headers"].map(sd);function fb(e,t){let r,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Ry(e))for(r=0,o=e.length;r<o;r++)t.call(null,e[r],r,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),f=u.length;let g;for(r=0;r<f;r++)g=u[r],t.call(null,e[g],g,e)}}function oF(e,t){t=t.toLowerCase();const r=Object.keys(e);let o,c=r.length;for(;c-- >0;)if(o=r[c],t===o.toLowerCase())return o;return null}const Ig=XV!==void 0?XV:typeof self<"u"?self:typeof window<"u"?window:mL,cF=e=>!pb(e)&&e!==Ig,ZJ=(AP=typeof Uint8Array<"u"&&RP(Uint8Array),e=>AP&&e instanceof AP);var AP;const eZ=sd("HTMLFormElement"),lF=(e=>{let{hasOwnProperty:t}=e;return(r,o)=>t.call(r,o)})(Object.prototype),tZ=sd("RegExp"),dF=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),o={};fb(r,(c,u)=>{let f;(f=t(c,u,e))!==!1&&(o[u]=f||c)}),Object.defineProperties(e,o)},nZ=sd("AsyncFunction"),uF=(hF=typeof tF=="function",pF=Xo(Ig.postMessage),hF?tF:pF?(IP="axios@".concat(Math.random()),ZC=[],Ig.addEventListener("message",e=>{let{source:t,data:r}=e;t===Ig&&r===IP&&ZC.length&&ZC.shift()()},!1),e=>{ZC.push(e),Ig.postMessage(IP,"*")}):e=>setTimeout(e));var hF,pF,IP,ZC;const rZ=nF!==void 0?nF.bind(Ig):typeof process<"u"&&process.nextTick||uF;var tt={isArray:Ry,isArrayBuffer:sF,isBuffer:function(e){return e!==null&&!pb(e)&&e.constructor!==null&&!pb(e.constructor)&&Xo(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Xo(e.append)&&((t=XC(e))==="formdata"||t==="object"&&Xo(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&sF(e.buffer),t},isString:GJ,isNumber:aF,isBoolean:e=>e===!0||e===!1,isObject:$C,isPlainObject:JC,isReadableStream:XJ,isRequest:QJ,isResponse:$J,isHeaders:JJ,isUndefined:pb,isDate:WJ,isFile:zJ,isBlob:YJ,isRegExp:tZ,isFunction:Xo,isStream:e=>$C(e)&&Xo(e.pipe),isURLSearchParams:KJ,isTypedArray:ZJ,isFileList:qJ,forEach:fb,merge:function e(){const{caseless:t}=cF(this)&&this||{},r={},o=(c,u)=>{const f=t&&oF(r,u)||u;JC(r[f])&&JC(c)?r[f]=e(r[f],c):JC(c)?r[f]=e({},c):Ry(c)?r[f]=c.slice():r[f]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&fb(arguments[c],o);return r},extend:function(e,t,r){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return fb(t,(c,u)=>{r&&Xo(c)?e[u]=rF(c,r):e[u]=c},{allOwnKeys:o}),e},trim:e=>sa(e)?sa(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,r,o)=>{e.prototype=Object.create(t.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,o)=>{let c,u,f;const g={};if(t=t||{},e==null)return t;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)f=c[u],o&&!o(f,e,t)||g[f]||(t[f]=e[f],g[f]=!0);e=r!==!1&&RP(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:XC,kindOfTest:sd,endsWith:(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const o=e.indexOf(t,r);return o!==-1&&o===r},toArray:e=>{if(!e)return null;if(Ry(e))return e;let t=e.length;if(!aF(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[KC]).call(e);let o;for(;(o=r.next())&&!o.done;){const c=o.value;t.call(e,c[0],c[1])}},matchAll:(e,t)=>{let r;const o=[];for(;(r=e.exec(t))!==null;)o.push(r);return o},isHTMLForm:eZ,hasOwnProperty:lF,hasOwnProp:lF,reduceDescriptors:dF,freezeMethods:e=>{dF(e,(t,r)=>{if(Xo(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const o=e[r];Xo(o)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{const r={},o=c=>{c.forEach(u=>{r[u]=!0})};return Ry(e)?o(e):o(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,o){return r.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:oF,global:Ig,isContextDefined:cF,isSpecCompliantForm:function(e){return!!(e&&Xo(e.append)&&e[iF]==="FormData"&&e[KC])},toJSONObject:e=>{const t=new Array(10),r=(o,c)=>{if($C(o)){if(t.indexOf(o)>=0)return;if(!("toJSON"in o)){t[c]=o;const u=Ry(o)?[]:{};return fb(o,(f,g)=>{const E=r(f,c+1);!pb(E)&&(u[g]=E)}),t[c]=void 0,u}}return o};return r(e,0)},isAsyncFn:nZ,isThenable:e=>e&&($C(e)||Xo(e))&&Xo(e.then)&&Xo(e.catch),setImmediate:uF,asap:rZ,isIterable:e=>e!=null&&Xo(e[KC])};function $n(e,t,r,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}tt.inherits($n,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:tt.toJSONObject(this.config),code:this.code,status:this.status}}});const fF=$n.prototype,mF={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{mF[e]={value:e}}),Object.defineProperties($n,mF),Object.defineProperty(fF,"isAxiosError",{value:!0}),$n.from=(e,t,r,o,c,u)=>{const f=Object.create(fF);return tt.toFlatObject(e,f,function(g){return g!==Error.prototype},g=>g!=="isAxiosError"),$n.call(f,e.message,t,r,o,c),f.cause=e,f.name=e.name,u&&Object.assign(f,u),f};function NP(e){return tt.isPlainObject(e)||tt.isArray(e)}function gF(e){return tt.endsWith(e,"[]")?e.slice(0,-2):e}function _F(e,t,r){return e?e.concat(t).map(function(o,c){return o=gF(o),!r&&c?"["+o+"]":o}).join(r?".":""):t}const iZ=tt.toFlatObject(tt,{},null,function(e){return/^is[A-Z]/.test(e)});function eA(e,t,r){if(!tt.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const o=(r=tt.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(I,D){return!tt.isUndefined(D[I])})).metaTokens,c=r.visitor||v,u=r.dots,f=r.indexes,g=(r.Blob||typeof Blob<"u"&&Blob)&&tt.isSpecCompliantForm(t);if(!tt.isFunction(c))throw new TypeError("visitor must be a function");function E(I){if(I===null)return"";if(tt.isDate(I))return I.toISOString();if(!g&&tt.isBlob(I))throw new $n("Blob is not supported. Use a Buffer instead.");return tt.isArrayBuffer(I)||tt.isTypedArray(I)?g&&typeof Blob=="function"?new Blob([I]):Buffer.from(I):I}function v(I,D,V){let M=I;if(I&&!V&&typeof I=="object"){if(tt.endsWith(D,"{}"))D=o?D:D.slice(0,-2),I=JSON.stringify(I);else if(tt.isArray(I)&&function(j){return tt.isArray(j)&&!j.some(NP)}(I)||(tt.isFileList(I)||tt.endsWith(D,"[]"))&&(M=tt.toArray(I)))return D=gF(D),M.forEach(function(j,G){!tt.isUndefined(j)&&j!==null&&t.append(f===!0?_F([D],G,u):f===null?D:D+"[]",E(j))}),!1}return!!NP(I)||(t.append(_F(V,D,u),E(I)),!1)}const S=[],R=Object.assign(iZ,{defaultVisitor:v,convertValue:E,isVisitable:NP});if(!tt.isObject(e))throw new TypeError("data must be an object");return function I(D,V){if(!tt.isUndefined(D)){if(S.indexOf(D)!==-1)throw Error("Circular reference detected in "+V.join("."));S.push(D),tt.forEach(D,function(M,j){(!(tt.isUndefined(M)||M===null)&&c.call(t,M,tt.isString(j)?sa(j).call(j):j,V,R))===!0&&I(M,V?V.concat(j):[j])}),S.pop()}}(e),t}function EF(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function OP(e,t){this._pairs=[],e&&eA(e,this,t)}const yF=OP.prototype;function sZ(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function vF(e,t,r){if(!t)return e;const o=r&&r.encode||sZ;tt.isFunction(r)&&(r={serialize:r});const c=r&&r.serialize;let u;if(u=c?c(t,r):tt.isURLSearchParams(t)?t.toString():new OP(t,r).toString(o),u){const f=e.indexOf("#");f!==-1&&(e=e.slice(0,f)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}yF.append=function(e,t){this._pairs.push([e,t])},yF.toString=function(e){const t=e?function(r){return e.call(this,r,EF)}:EF;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};var SF=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){tt.forEach(this.handlers,function(t){t!==null&&e(t)})}},TF={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},bF={exports:{}},aZ=xn,oZ=Ne,wF=Ws.f;aZ({target:"Object",stat:!0,forced:Object.defineProperty!==wF,sham:!oZ},{defineProperty:wF});var RF=Gt.Object,cZ=bF.exports=function(e,t,r){return RF.defineProperty(e,t,r)};RF.defineProperty.sham&&(cZ.sham=!0);var CF=l(bF.exports),lZ=TypeError,AF=Jc,dZ=Jm,uZ=kt,hZ=Mr("species"),IF=Array,pZ=function(e){var t;return AF(e)&&(t=e.constructor,(dZ(t)&&(t===IF||AF(t.prototype))||uZ(t)&&(t=t[hZ])===null)&&(t=void 0)),t===void 0?IF:t},NF=function(e,t){return new(pZ(e))(t===0?0:t)},fZ=p,mZ=ji,gZ=Mr("species"),OF=function(e){return mZ>=51||!fZ(function(){var t=[];return(t.constructor={})[gZ]=function(){return{foo:1}},t[e](Boolean).foo!==1})},_Z=xn,EZ=p,yZ=Jc,vZ=kt,SZ=_o,TZ=Yn,DF=function(e){if(e>9007199254740991)throw lZ("Maximum allowed index exceeded");return e},xF=Yx,bZ=NF,wZ=OF,RZ=ji,PF=Mr("isConcatSpreadable"),CZ=RZ>=51||!EZ(function(){var e=[];return e[PF]=!1,e.concat()[0]!==e}),AZ=function(e){if(!vZ(e))return!1;var t=e[PF];return t!==void 0?!!t:yZ(e)};_Z({target:"Array",proto:!0,forced:!CZ||!wZ("concat")},{concat:function(e){var t,r,o,c,u,f=SZ(this),g=bZ(f,0),E=0;for(t=-1,o=arguments.length;t<o;t++)if(AZ(u=t===-1?f:arguments[t]))for(c=TZ(u),DF(E+c),r=0;r<c;r++,E++)r in u&&xF(g,E,u[r]);else DF(E+1),xF(g,E++,u);return g.length=E,g}});var kF={},IZ=$,NZ=Dt,LF=el.f,OZ=Na,MF=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];kF.f=function(e){return MF&&IZ(e)==="Window"?function(t){try{return LF(t)}catch{return OZ(MF)}}(e):LF(NZ(e))};var Cy={},DZ=Mr;Cy.f=DZ;var jF=Gt,xZ=ci,PZ=Cy,kZ=Ws.f,ns=function(e){var t=jF.Symbol||(jF.Symbol={});xZ(t,e)||kZ(t,e,{value:PZ.f(e)})},LZ=Ie,MZ=kn,jZ=Mr,UZ=Os,UF=function(){var e=MZ("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,o=jZ("toPrimitive");t&&!t[o]&&UZ(t,o,function(c){return LZ(r,this)},{})},VZ=yo,FZ=tn,BZ=_o,HZ=Yn,GZ=NF,VF=k([].push),WZ=function(e){var t=e===1,r=e===2,o=e===3,c=e===4,u=e===6,f=e===7,g=e===5||u;return function(E,v,S,R){for(var I,D,V=BZ(E),M=FZ(V),j=HZ(M),G=VZ(v,S),z=0,ce=R||GZ,Ee=t?ce(E,j):r||f?ce(E,0):void 0;j>z;z++)if((g||z in M)&&(D=G(I=M[z],z,V),e))if(t)Ee[z]=D;else if(D)switch(e){case 3:return!0;case 5:return I;case 6:return z;case 2:VF(Ee,I)}else switch(e){case 4:return!1;case 7:VF(Ee,I)}return u?-1:o||c?c:Ee}},FF={forEach:WZ(0)},tA=xn,mb=W,DP=Ie,zZ=k,Ay=Ne,Iy=Fs,YZ=p,fa=ci,qZ=U,xP=ts,nA=Dt,PP=Ya,KZ=Is,kP=Be,Ny=gh,BF=Pp,XZ=el,HF=kF,QZ=uh,GF=pe,WF=Ws,$Z=hh,zF=Re,YF=Os,JZ=yi,LP=ha,qF=Ns,KF=hc,ZZ=Mr,eee=Cy,tee=ns,nee=UF,ree=yc,XF=Ec,rA=FF.forEach,Qo=Ii("hidden"),iA="Symbol",gb="prototype",iee=XF.set,QF=XF.getterFor(iA),ad=Object[gb],Ng=mb.Symbol,sA=Ng&&Ng[gb],see=mb.RangeError,aee=mb.TypeError,MP=mb.QObject,$F=GF.f,Og=WF.f,JF=HF.f,oee=zF.f,ZF=zZ([].push),Lh=LP("symbols"),_b=LP("op-symbols"),cee=LP("wks"),jP=!MP||!MP[gb]||!MP[gb].findChild,eB=function(e,t,r){var o=$F(ad,t);o&&delete ad[t],Og(e,t,r),o&&e!==ad&&Og(ad,t,o)},UP=Ay&&YZ(function(){return Ny(Og({},"a",{get:function(){return Og(this,"a",{value:7}).a}})).a!==7})?eB:Og,VP=function(e,t){var r=Lh[e]=Ny(sA);return iee(r,{type:iA,tag:e,description:t}),Ay||(r.description=t),r},aA=function(e,t,r){e===ad&&aA(_b,t,r),xP(e);var o=PP(t);return xP(r),fa(Lh,o)?(r.enumerable?(fa(e,Qo)&&e[Qo][o]&&(e[Qo][o]=!1),r=Ny(r,{enumerable:kP(0,!1)})):(fa(e,Qo)||Og(e,Qo,kP(1,Ny(null))),e[Qo][o]=!0),UP(e,o,r)):Og(e,o,r)},FP=function(e,t){xP(e);var r=nA(t),o=BF(r).concat(iB(r));return rA(o,function(c){Ay&&!DP(tB,r,c)||aA(e,c,r[c])}),e},tB=function(e){var t=PP(e),r=DP(oee,this,t);return!(this===ad&&fa(Lh,t)&&!fa(_b,t))&&(!(r||!fa(this,t)||!fa(Lh,t)||fa(this,Qo)&&this[Qo][t])||r)},nB=function(e,t){var r=nA(e),o=PP(t);if(r!==ad||!fa(Lh,o)||fa(_b,o)){var c=$F(r,o);return!c||!fa(Lh,o)||fa(r,Qo)&&r[Qo][o]||(c.enumerable=!0),c}},rB=function(e){var t=JF(nA(e)),r=[];return rA(t,function(o){fa(Lh,o)||fa(qF,o)||ZF(r,o)}),r},iB=function(e){var t=e===ad,r=JF(t?_b:nA(e)),o=[];return rA(r,function(c){!fa(Lh,c)||t&&!fa(ad,c)||ZF(o,Lh[c])}),o};Iy||(Ng=function(){if(qZ(sA,this))throw new aee("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?KZ(arguments[0]):void 0,t=KF(e),r=function(o){var c=this===void 0?mb:this;c===ad&&DP(r,_b,o),fa(c,Qo)&&fa(c[Qo],t)&&(c[Qo][t]=!1);var u=kP(1,o);try{UP(c,t,u)}catch(f){if(!(f instanceof see))throw f;eB(c,t,u)}};return Ay&&jP&&UP(ad,t,{configurable:!0,set:r}),VP(t,e)},YF(sA=Ng[gb],"toString",function(){return QF(this).tag}),YF(Ng,"withoutSetter",function(e){return VP(KF(e),e)}),zF.f=tB,WF.f=aA,$Z.f=FP,GF.f=nB,XZ.f=HF.f=rB,QZ.f=iB,eee.f=function(e){return VP(ZZ(e),e)},Ay&&JZ(sA,"description",{configurable:!0,get:function(){return QF(this).description}})),tA({global:!0,wrap:!0,forced:!Iy,sham:!Iy},{Symbol:Ng}),rA(BF(cee),function(e){tee(e)}),tA({target:iA,stat:!0,forced:!Iy},{useSetter:function(){jP=!0},useSimple:function(){jP=!1}}),tA({target:"Object",stat:!0,forced:!Iy,sham:!Ay},{create:function(e,t){return t===void 0?Ny(e):FP(Ny(e),t)},defineProperty:aA,defineProperties:FP,getOwnPropertyDescriptor:nB}),tA({target:"Object",stat:!0,forced:!Iy},{getOwnPropertyNames:rB}),nee(),ree(Ng,iA),qF[Qo]=!0;var sB=Fs&&!!Symbol.for&&!!Symbol.keyFor,lee=xn,dee=kn,uee=ci,hee=Is,aB=ha,pee=sB,BP=aB("string-to-symbol-registry"),fee=aB("symbol-to-string-registry");lee({target:"Symbol",stat:!0,forced:!pee},{for:function(e){var t=hee(e);if(uee(BP,t))return BP[t];var r=dee("Symbol")(t);return BP[t]=r,fee[r]=t,r}});var mee=xn,gee=ci,_ee=Qe,Eee=un,yee=sB,oB=ha("symbol-to-string-registry");mee({target:"Symbol",stat:!0,forced:!yee},{keyFor:function(e){if(!_ee(e))throw new TypeError(Eee(e)+" is not a symbol");if(gee(oB,e))return oB[e]}});var cB=Jc,vee=fe,lB=$,See=Is,dB=k([].push),Tee=xn,uB=kn,hB=ue,bee=Ie,Eb=k,pB=p,fB=fe,mB=Qe,gB=Na,wee=function(e){if(vee(e))return e;if(cB(e)){for(var t=e.length,r=[],o=0;o<t;o++){var c=e[o];typeof c=="string"?dB(r,c):typeof c!="number"&&lB(c)!=="Number"&&lB(c)!=="String"||dB(r,See(c))}var u=r.length,f=!0;return function(g,E){if(f)return f=!1,E;if(cB(this))return E;for(var v=0;v<u;v++)if(r[v]===g)return E}}},Ree=Fs,Cee=String,_f=uB("JSON","stringify"),oA=Eb(/./.exec),_B=Eb("".charAt),Aee=Eb("".charCodeAt),Iee=Eb("".replace),Nee=Eb(1 .toString),Oee=/[\uD800-\uDFFF]/g,EB=/^[\uD800-\uDBFF]$/,yB=/^[\uDC00-\uDFFF]$/,vB=!Ree||pB(function(){var e=uB("Symbol")("stringify detection");return _f([e])!=="[null]"||_f({a:e})!=="{}"||_f(Object(e))!=="{}"}),SB=pB(function(){return _f("\uDF06\uD834")!=='"\\udf06\\ud834"'||_f("\uDEAD")!=='"\\udead"'}),Dee=function(e,t){var r=gB(arguments),o=wee(t);if(fB(o)||e!==void 0&&!mB(e))return r[1]=function(c,u){if(fB(o)&&(u=bee(o,this,Cee(c),u)),!mB(u))return u},hB(_f,null,r)},xee=function(e,t,r){var o=_B(r,t-1),c=_B(r,t+1);return oA(EB,e)&&!oA(yB,c)||oA(yB,e)&&!oA(EB,o)?"\\u"+Nee(Aee(e,0),16):e};_f&&Tee({target:"JSON",stat:!0,forced:vB||SB},{stringify:function(e,t,r){var o=gB(arguments),c=hB(vB?Dee:_f,null,o);return SB&&typeof c=="string"?Iee(c,Oee,xee):c}});var TB=uh,Pee=_o;xn({target:"Object",stat:!0,forced:!Fs||p(function(){TB.f(1)})},{getOwnPropertySymbols:function(e){var t=TB.f;return t?t(Pee(e)):[]}}),ns("asyncIterator"),ns("hasInstance"),ns("isConcatSpreadable"),ns("iterator"),ns("match"),ns("matchAll"),ns("replace"),ns("search"),ns("species"),ns("split");var kee=UF;ns("toPrimitive"),kee();var Lee=kn,Mee=yc;ns("toStringTag"),Mee(Lee("Symbol"),"Symbol"),ns("unscopables"),yc(W.JSON,"JSON",!0);var jee=Gt.Symbol,Uee=Mr,Vee=Ws.f,bB=Uee("metadata"),wB=Function.prototype;wB[bB]===void 0&&Vee(wB,bB,{value:null}),ns("asyncDispose"),ns("dispose"),ns("metadata");var Fee=jee,Bee=k,HP=kn("Symbol"),Hee=HP.keyFor,Gee=Bee(HP.prototype.valueOf),RB=HP.isRegisteredSymbol||function(e){try{return Hee(Gee(e))!==void 0}catch{return!1}};xn({target:"Symbol",stat:!0},{isRegisteredSymbol:RB});for(var Wee=ha,CB=kn,zee=k,Yee=Qe,qee=Mr,cA=CB("Symbol"),AB=cA.isWellKnownSymbol,IB=CB("Object","getOwnPropertyNames"),Kee=zee(cA.prototype.valueOf),NB=Wee("wks"),GP=0,OB=IB(cA),Xee=OB.length;GP<Xee;GP++)try{var DB=OB[GP];Yee(cA[DB])&&qee(DB)}catch{}var xB=function(e){if(AB&&AB(e))return!0;try{for(var t=Kee(e),r=0,o=IB(NB),c=o.length;r<c;r++)if(NB[o[r]]==t)return!0}catch{}return!1};xn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:xB}),ns("customMatcher"),ns("observable"),xn({target:"Symbol",stat:!0},{isRegistered:RB}),xn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:xB}),ns("matcher"),ns("metadataKey"),ns("patternMatch"),ns("replaceAll");var Oy=l(Fee),PB=l(Cy.f("iterator"));function yb(e){return yb=typeof Oy=="function"&&typeof PB=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Oy=="function"&&t.constructor===Oy&&t!==Oy.prototype?"symbol":typeof t},yb(e)}var Qee=l(Cy.f("toPrimitive"));function $ee(e){var t=function(r,o){if(yb(r)!="object"||!r)return r;var c=r[Qee];if(c!==void 0){var u=c.call(r,o);if(yb(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(r)}(e,"string");return yb(t)=="symbol"?t:t+""}function H(e,t,r){return(t=$ee(t))in e?CF(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var kB=l($Q),Jee={isBrowser:!0,classes:{URLSearchParams:kB!==void 0?kB:OP,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const WP=typeof window<"u"&&typeof document<"u",zP=typeof navigator=="object"&&navigator||void 0,Zee=WP&&(!zP||["ReactNative","NativeScript","NS"].indexOf(zP.product)<0),ete=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",tte=WP&&window.location.href||"http://localhost";function LB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function MB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?LB(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):LB(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}var eo=MB(MB({},Object.freeze({__proto__:null,hasBrowserEnv:WP,hasStandardBrowserEnv:Zee,hasStandardBrowserWebWorkerEnv:ete,navigator:zP,origin:tte})),Jee),nte=ts,rte=Ie,ite=ci,ste=U,ate=function(){var e=nte(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},jB=RegExp.prototype,UB=function(e){var t=e.flags;return t!==void 0||"flags"in jB||ite(e,"flags")||!ste(jB,e)?t:rte(ate,e)},ote=mg.charAt,VB=Ie,cte=ts,lte=fe,dte=$,ute=/./.exec,hte=TypeError,pte=xn,FB=Ie,BB=oe,fte=OE,lA=zp,HB=Xn,GB=vr,vb=Is,mte=ts,gte=Mt,_te=$,Ete=fS,WB=UB,yte=oi,vte=p,Ste=UE,Tte=function(e,t,r){return t+(r?ote(e,t).length:1)},bte=function(e,t){var r=e.exec;if(lte(r)){var o=VB(r,e,t);return o!==null&&cte(o),o}if(dte(e)==="RegExp")return VB(ute,e,t);throw new hte("RegExp#exec called on incompatible receiver")},zB=Ec,wte=Mr("matchAll"),YB="RegExp String",qB=YB+" Iterator",Rte=zB.set,Cte=zB.getterFor(qB),Ate=TypeError,YP=BB("".indexOf),dA=BB("".matchAll),qP=!!dA&&!vte(function(){dA("a",/./)}),Ite=fte(function(e,t,r,o){Rte(this,{type:qB,regexp:e,string:t,global:r,unicode:o,done:!1})},YB,function(){var e=Cte(this);if(e.done)return lA(void 0,!0);var t=e.regexp,r=e.string,o=bte(t,r);return o===null?(e.done=!0,lA(void 0,!0)):e.global?(vb(o[0])===""&&(t.lastIndex=Tte(r,GB(t.lastIndex),e.unicode)),lA(o,!1)):(e.done=!0,lA(o,!1))}),KB=function(e){var t,r,o,c=mte(this),u=vb(e),f=Ste(c,RegExp),g=vb(WB(c));return t=new f(f===RegExp?c.source:c,g),r=!!~YP(g,"g"),o=!!~YP(g,"u"),t.lastIndex=GB(c.lastIndex),new Ite(t,u,r,o)};pte({target:"String",proto:!0,forced:qP},{matchAll:function(e){var t,r,o,c,u=HB(this);if(gte(e)){if(qP)return dA(u,e)}else{if(Ete(e)&&(t=vb(HB(WB(e))),!~YP(t,"g")))throw new Ate("`.matchAll` does not allow non-global regexes");if(qP)return dA(u,e);if((o=yte(e,wte))===void 0&&_te(e)==="RegExp"&&(o=KB),o)return FB(o,e,u)}return r=vb(u),c=new RegExp(e,"g"),FB(KB,c,r)}});var Nte=vo("String","matchAll"),Ote=U,Dte=Nte,KP=String.prototype,xte=function(e){var t=e.matchAll;return typeof e=="string"||e===KP||Ote(KP,e)&&t===KP.matchAll?Dte:t},Pte=l(xte);function XB(e){function t(r,o,c,u){let f=r[u++];if(f==="__proto__")return!0;const g=Number.isFinite(+f),E=u>=r.length;return f=!f&&tt.isArray(c)?c.length:f,E?(tt.hasOwnProp(c,f)?c[f]=[c[f],o]:c[f]=o,!g):(c[f]&&tt.isObject(c[f])||(c[f]=[]),t(r,o,c[f],u)&&tt.isArray(c[f])&&(c[f]=function(v){const S={},R=Object.keys(v);let I;const D=R.length;let V;for(I=0;I<D;I++)V=R[I],S[V]=v[V];return S}(c[f])),!g)}if(tt.isFormData(e)&&tt.isFunction(e.entries)){const r={};return tt.forEachEntry(e,(o,c)=>{t(function(u){return Pte(tt).call(tt,/\w+|\[(\w*)]/g,u).map(f=>f[0]==="[]"?"":f[1]||f[0])}(o),c,r,0)}),r}return null}const XP={transitional:TF,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",o=r.indexOf("application/json")>-1,c=tt.isObject(e);if(c&&tt.isHTMLForm(e)&&(e=new FormData(e)),tt.isFormData(e))return o?JSON.stringify(XB(e)):e;if(tt.isArrayBuffer(e)||tt.isBuffer(e)||tt.isStream(e)||tt.isFile(e)||tt.isBlob(e)||tt.isReadableStream(e))return e;if(tt.isArrayBufferView(e))return e.buffer;if(tt.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(f,g){return eA(f,new eo.classes.URLSearchParams,Object.assign({visitor:function(E,v,S,R){return eo.isNode&&tt.isBuffer(E)?(this.append(v,E.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},g))}(e,this.formSerializer).toString();if((u=tt.isFileList(e))||r.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return eA(u?{"files[]":e}:e,f&&new f,this.formSerializer)}}return c||o?(t.setContentType("application/json",!1),function(f,g,E){if(tt.isString(f))try{return(g||JSON.parse)(f),sa(tt).call(tt,f)}catch(v){if(v.name!=="SyntaxError")throw v}return(E||JSON.stringify)(f)}(e)):e}],transformResponse:[function(e){const t=this.transitional||XP.transitional,r=t&&t.forcedJSONParsing,o=this.responseType==="json";if(tt.isResponse(e)||tt.isReadableStream(e))return e;if(e&&tt.isString(e)&&(r&&!this.responseType||o)){const c=!(t&&t.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?$n.from(u,$n.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:eo.classes.FormData,Blob:eo.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};tt.forEach(["delete","get","head","post","put","patch"],e=>{XP.headers[e]={}});var QP=XP;const kte=tt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),QB=Symbol("internals");function Sb(e){var t;return e&&sa(t=String(e)).call(t).toLowerCase()}function uA(e){return e===!1||e==null?e:tt.isArray(e)?e.map(uA):String(e)}function $P(e,t,r,o,c){return tt.isFunction(o)?o.call(this,t,r):(c&&(t=r),tt.isString(t)?tt.isString(o)?t.indexOf(o)!==-1:tt.isRegExp(o)?o.test(t):void 0:void 0)}class hA{constructor(t){t&&this.set(t)}set(t,r,o){const c=this;function u(E,v,S){const R=Sb(v);if(!R)throw new Error("header name must be a non-empty string");const I=tt.findKey(c,R);(!I||c[I]===void 0||S===!0||S===void 0&&c[I]!==!1)&&(c[I||v]=uA(E))}const f=(E,v)=>tt.forEach(E,(S,R)=>u(S,R,v));if(tt.isPlainObject(t)||t instanceof this.constructor)f(t,r);else if(tt.isString(t)&&(t=sa(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(sa(g=t).call(g)))f((E=>{const v={};let S,R,I;return E&&E.split(`
`).forEach(function(D){var V,M;I=D.indexOf(":"),S=sa(V=D.substring(0,I)).call(V).toLowerCase(),R=sa(M=D.substring(I+1)).call(M),!S||v[S]&&kte[S]||(S==="set-cookie"?v[S]?v[S].push(R):v[S]=[R]:v[S]=v[S]?v[S]+", "+R:R)}),v})(t),r);else if(tt.isObject(t)&&tt.isIterable(t)){let E,v,S={};for(const R of t){if(!tt.isArray(R))throw TypeError("Object iterator must return a key-value pair");S[v=R[0]]=(E=S[v])?tt.isArray(E)?[...E,R[1]]:[E,R[1]]:R[1]}f(S,r)}else t!=null&&u(r,t,o);var g;return this}get(t,r){if(t=Sb(t)){const o=tt.findKey(this,t);if(o){const c=this[o];if(!r)return c;if(r===!0)return function(u){const f=Object.create(null),g=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let E;for(;E=g.exec(u);)f[E[1]]=E[2];return f}(c);if(tt.isFunction(r))return r.call(this,c,o);if(tt.isRegExp(r))return r.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=Sb(t)){const o=tt.findKey(this,t);return!(!o||this[o]===void 0||r&&!$P(0,this[o],o,r))}return!1}delete(t,r){const o=this;let c=!1;function u(f){if(f=Sb(f)){const g=tt.findKey(o,f);!g||r&&!$P(0,o[g],g,r)||(delete o[g],c=!0)}}return tt.isArray(t)?t.forEach(u):u(t),c}clear(t){const r=Object.keys(this);let o=r.length,c=!1;for(;o--;){const u=r[o];t&&!$P(0,this[u],u,t,!0)||(delete this[u],c=!0)}return c}normalize(t){const r=this,o={};return tt.forEach(this,(c,u)=>{var f;const g=tt.findKey(o,u);if(g)return r[g]=uA(c),void delete r[u];const E=t?function(v){return sa(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,R,I)=>R.toUpperCase()+I)}(u):sa(f=String(u)).call(f);E!==u&&delete r[u],r[E]=uA(c),o[E]=!0}),this}concat(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return this.constructor.concat(this,...r)}toJSON(t){const r=Object.create(null);return tt.forEach(this,(o,c)=>{o!=null&&o!==!1&&(r[c]=t&&tt.isArray(o)?o.join(", "):o)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[r,o]=t;return r+": "+o}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const r=new this(t);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(f=>r.set(f)),r}static accessor(t){const r=(this[QB]=this[QB]={accessors:{}}).accessors,o=this.prototype;function c(u){const f=Sb(u);r[f]||(function(g,E){const v=tt.toCamelCase(" "+E);["get","set","has"].forEach(S=>{Object.defineProperty(g,S+v,{value:function(R,I,D){return this[S].call(this,E,R,I,D)},configurable:!0})})}(o,u),r[f]=!0)}return tt.isArray(t)?t.forEach(c):c(t),this}}hA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),tt.reduceDescriptors(hA.prototype,(e,t)=>{let{value:r}=e,o=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(c){this[o]=c}}}),tt.freezeMethods(hA);var od=hA;function JP(e,t){const r=this||QP,o=t||r,c=od.from(o.headers);let u=o.data;return tt.forEach(e,function(f){u=f.call(r,u,c.normalize(),t?t.status:void 0)}),c.normalize(),u}function $B(e){return!(!e||!e.__CANCEL__)}function Dy(e,t,r){$n.call(this,e??"canceled",$n.ERR_CANCELED,t,r),this.name="CanceledError"}function JB(e,t,r){const o=r.config.validateStatus;r.status&&o&&!o(r.status)?t(new $n("Request failed with status code "+r.status,[$n.ERR_BAD_REQUEST,$n.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}tt.inherits(Dy,$n,{__CANCEL__:!0});const pA=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,f){u=u||10;const g=new Array(u),E=new Array(u);let v,S=0,R=0;return f=f!==void 0?f:1e3,function(I){const D=Date.now(),V=E[R];v||(v=D),g[S]=I,E[S]=D;let M=R,j=0;for(;M!==S;)j+=g[M++],M%=u;if(S=(S+1)%u,S===R&&(R=(R+1)%u),D-v<f)return;const G=V&&D-V;return G?Math.round(1e3*j/G):void 0}}(50,250);return function(u,f){let g,E,v=0,S=1e3/f;const R=function(I){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),g=null,E&&(clearTimeout(E),E=null),u.apply(null,I)};return[function(){const I=Date.now(),D=I-v;for(var V=arguments.length,M=new Array(V),j=0;j<V;j++)M[j]=arguments[j];D>=S?R(M,I):(g=M,E||(E=setTimeout(()=>{E=null,R(g)},S-D)))},()=>g&&R(g)]}(u=>{const f=u.loaded,g=u.lengthComputable?u.total:void 0,E=f-o,v=c(E);o=f,e({loaded:f,total:g,progress:g?f/g:void 0,bytes:E,rate:v||void 0,estimated:v&&g&&f<=g?(g-f)/v:void 0,event:u,lengthComputable:g!=null,[t?"download":"upload"]:!0})},r)},ZB=(e,t)=>{const r=e!=null;return[o=>t[0]({lengthComputable:r,total:e,loaded:o}),t[1]]},e3=e=>function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return tt.asap(()=>e(...r))};var Lte=eo.hasStandardBrowserEnv?((e,t)=>r=>(r=new BC(r,eo.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new BC(eo.origin),eo.navigator&&/(msie|trident)/i.test(eo.navigator.userAgent)):()=>!0,Mte=eo.hasStandardBrowserEnv?{write(e,t,r,o,c,u){const f=[e+"="+encodeURIComponent(t)];tt.isNumber(r)&&f.push("expires="+new Date(r).toGMTString()),tt.isString(o)&&f.push("path="+o),tt.isString(c)&&f.push("domain="+c),u===!0&&f.push("secure"),document.cookie=f.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function t3(e,t,r){let o=!function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}(t);return e&&(o||r==0)?function(c,u){return u?c.replace(/\/?\/$/,"")+"/"+u.replace(/^\/+/,""):c}(e,t):t}function n3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}const r3=e=>e instanceof od?function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?n3(Object(o),!0).forEach(function(c){H(t,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n3(Object(o)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(o,c))})}return t}({},e):e;function Dg(e,t){t=t||{};const r={};function o(v,S,R,I){return tt.isPlainObject(v)&&tt.isPlainObject(S)?tt.merge.call({caseless:I},v,S):tt.isPlainObject(S)?tt.merge({},S):tt.isArray(S)?S.slice():S}function c(v,S,R,I){return tt.isUndefined(S)?tt.isUndefined(v)?void 0:o(void 0,v,0,I):o(v,S,0,I)}function u(v,S){if(!tt.isUndefined(S))return o(void 0,S)}function f(v,S){return tt.isUndefined(S)?tt.isUndefined(v)?void 0:o(void 0,v):o(void 0,S)}function g(v,S,R){return R in t?o(v,S):R in e?o(void 0,v):void 0}const E={url:u,method:u,data:u,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,withXSRFToken:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:g,headers:(v,S,R)=>c(r3(v),r3(S),0,!0)};return tt.forEach(Object.keys(Object.assign({},e,t)),function(v){const S=E[v]||c,R=S(e[v],t[v],v);tt.isUndefined(R)&&S!==g||(r[v]=R)}),r}var i3=e=>{const t=Dg({},e);let r,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:f,headers:g,auth:E}=t;if(t.headers=g=od.from(g),t.url=vF(t3(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),E&&g.set("Authorization","Basic "+btoa((E.username||"")+":"+(E.password?unescape(encodeURIComponent(E.password)):""))),tt.isFormData(o)){if(eo.hasStandardBrowserEnv||eo.hasStandardBrowserWebWorkerEnv)g.setContentType(void 0);else if((r=g.getContentType())!==!1){const[v,...S]=r?r.split(";").map(R=>sa(R).call(R)).filter(Boolean):[];g.setContentType([v||"multipart/form-data",...S].join("; "))}}if(eo.hasStandardBrowserEnv&&(c&&tt.isFunction(c)&&(c=c(t)),c||c!==!1&&Lte(t.url))){const v=u&&f&&Mte.read(f);v&&g.set(u,v)}return t},jte=typeof XMLHttpRequest<"u"&&function(e){return new nt(function(t,r){const o=i3(e);let c=o.data;const u=od.from(o.headers).normalize();let f,g,E,v,S,{responseType:R,onUploadProgress:I,onDownloadProgress:D}=o;function V(){v&&v(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(f),o.signal&&o.signal.removeEventListener("abort",f)}let M=new XMLHttpRequest;function j(){if(!M)return;const z=od.from("getAllResponseHeaders"in M&&M.getAllResponseHeaders());JB(function(ce){t(ce),V()},function(ce){r(ce),V()},{data:R&&R!=="text"&&R!=="json"?M.response:M.responseText,status:M.status,statusText:M.statusText,headers:z,config:e,request:M}),M=null}M.open(o.method.toUpperCase(),o.url,!0),M.timeout=o.timeout,"onloadend"in M?M.onloadend=j:M.onreadystatechange=function(){M&&M.readyState===4&&(M.status!==0||M.responseURL&&M.responseURL.indexOf("file:")===0)&&setTimeout(j)},M.onabort=function(){M&&(r(new $n("Request aborted",$n.ECONNABORTED,e,M)),M=null)},M.onerror=function(){r(new $n("Network Error",$n.ERR_NETWORK,e,M)),M=null},M.ontimeout=function(){let z=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const ce=o.transitional||TF;o.timeoutErrorMessage&&(z=o.timeoutErrorMessage),r(new $n(z,ce.clarifyTimeoutError?$n.ETIMEDOUT:$n.ECONNABORTED,e,M)),M=null},c===void 0&&u.setContentType(null),"setRequestHeader"in M&&tt.forEach(u.toJSON(),function(z,ce){M.setRequestHeader(ce,z)}),tt.isUndefined(o.withCredentials)||(M.withCredentials=!!o.withCredentials),R&&R!=="json"&&(M.responseType=o.responseType),D&&([E,S]=pA(D,!0),M.addEventListener("progress",E)),I&&M.upload&&([g,v]=pA(I),M.upload.addEventListener("progress",g),M.upload.addEventListener("loadend",v)),(o.cancelToken||o.signal)&&(f=z=>{M&&(r(!z||z.type?new Dy(null,e,M):z),M.abort(),M=null)},o.cancelToken&&o.cancelToken.subscribe(f),o.signal&&(o.signal.aborted?f():o.signal.addEventListener("abort",f)));const G=function(z){const ce=/^([-+\w]{1,25})(:?\/\/|:)/.exec(z);return ce&&ce[1]||""}(o.url);G&&eo.protocols.indexOf(G)===-1?r(new $n("Unsupported protocol "+G+":",$n.ERR_BAD_REQUEST,e)):M.send(c||null)})},Ute=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let o,c=new AbortController;const u=function(v){if(!o){o=!0,g();const S=v instanceof Error?v:this.reason;c.abort(S instanceof $n?S:new Dy(S instanceof Error?S.message:S))}};let f=t&&setTimeout(()=>{f=null,u(new $n("timeout ".concat(t," of ms exceeded"),$n.ETIMEDOUT))},t);const g=()=>{e&&(f&&clearTimeout(f),f=null,e.forEach(v=>{v.unsubscribe?v.unsubscribe(u):v.removeEventListener("abort",u)}),e=null)};e.forEach(v=>v.addEventListener("abort",u));const{signal:E}=c;return E.unsubscribe=()=>tt.asap(g),E}},ZP=l(Eg),s3=Cy.f("asyncIterator"),Vte=l(s3);function ek(e,t){this.v=e,this.k=t}function Cc(e){return function(){return new Tb(e.apply(this,arguments))}}function Tb(e){var t,r;function o(u,f){try{var g=e[u](f),E=g.value,v=E instanceof ek;ZP.resolve(v?E.v:E).then(function(S){if(v){var R=u==="return"?"return":"next";if(!E.k||S.done)return o(R,S);S=e[R](S).value}c(g.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(u,f){switch(u){case"return":t.resolve({value:f,done:!0});break;case"throw":t.reject(f);break;default:t.resolve({value:f,done:!1})}(t=t.next)?o(t.key,t.arg):r=null}this._invoke=function(u,f){return new ZP(function(g,E){var v={key:u,arg:f,resolve:g,reject:E,next:null};r?r=r.next=v:(t=r=v,o(u,f))})},typeof e.return!="function"&&(this.return=void 0)}function Cn(e){return new ek(e,0)}function fA(e){var t={},r=!1;function o(c,u){return r=!0,u=new ZP(function(f){f(e[c](u))}),{done:!1,value:new ek(u,1)}}return t[Oy!==void 0&&PB||"@@iterator"]=function(){return this},t.next=function(c){return r?(r=!1,c):o("next",c)},typeof e.throw=="function"&&(t.throw=function(c){if(r)throw r=!1,c;return o("throw",c)}),typeof e.return=="function"&&(t.return=function(c){return r?(r=!1,c):o("return",c)}),t}Tb.prototype[typeof Oy=="function"&&Vte||"@@asyncIterator"]=function(){return this},Tb.prototype.next=function(e){return this._invoke("next",e)},Tb.prototype.throw=function(e){return this._invoke("throw",e)},Tb.prototype.return=function(e){return this._invoke("return",e)};var tk=l(s3);function nk(e){var t,r,o,c=2;for(typeof Symbol<"u"&&(r=tk,o=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(o&&(t=e[o])!=null)return new mA(t.call(e));r="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function mA(e){function t(r){if(Object(r)!==r)return nt.reject(new TypeError(r+" is not an object."));var o=r.done;return nt.resolve(r.value).then(function(c){return{value:c,done:o}})}return mA=function(r){this.s=r,this.n=r.next},mA.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var o=this.s.return;return o===void 0?nt.resolve({value:r,done:!0}):t(o.apply(this.s,arguments))},throw:function(r){var o=this.s.return;return o===void 0?nt.reject(r):t(o.apply(this.s,arguments))}},new mA(e)}const Fte=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let o,c=0;for(;c<r;)o=c+t,yield e.slice(c,o),c=o},Bte=function(){var e=Cc(function*(t,r){var o,c=!1,u=!1;try{for(var f,g=nk(Hte(t));c=!(f=yield Cn(g.next())).done;c=!1){const E=f.value;yield*fA(nk(Fte(E,r)))}}catch(E){u=!0,o=E}finally{try{c&&g.return!=null&&(yield Cn(g.return()))}finally{if(u)throw o}}});return function(t,r){return e.apply(this,arguments)}}(),Hte=function(){var e=Cc(function*(t){if(t[tk])return void(yield*fA(nk(t)));const r=t.getReader();try{for(;;){const{done:o,value:c}=yield Cn(r.read());if(o)break;yield c}}finally{yield Cn(r.cancel())}});return function(t){return e.apply(this,arguments)}}(),a3=(e,t,r,o)=>{const c=Bte(e,t);let u,f=0,g=E=>{u||(u=!0,o&&o(E))};return new ReadableStream({async pull(E){try{const{done:v,value:S}=await c.next();if(v)return g(),void E.close();let R=S.byteLength;if(r){let I=f+=R;r(I)}E.enqueue(new Uint8Array(S))}catch(v){throw g(v),v}},cancel:E=>(g(E),c.return())},{highWaterMark:2})};function o3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function c3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?o3(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o3(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const gA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",l3=gA&&typeof ReadableStream=="function",Gte=gA&&(typeof TextEncoder=="function"?(d3=new TextEncoder,e=>d3.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var d3;const u3=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];return!!e(...r)}catch{return!1}},Wte=l3&&u3(()=>{let e=!1;const t=new Request(eo.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),rk=l3&&u3(()=>tt.isReadableStream(new Response("").body)),_A={stream:rk&&(e=>e.body)};var h3;gA&&(h3=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!_A[e]&&(_A[e]=tt.isFunction(h3[e])?t=>t[e]():(t,r)=>{throw new $n("Response type '".concat(e,"' is not supported"),$n.ERR_NOT_SUPPORT,r)})}));const zte=async(e,t)=>{const r=tt.toFiniteNumber(e.getContentLength());return r??(async o=>o==null?0:tt.isBlob(o)?o.size:tt.isSpecCompliantForm(o)?(await new Request(eo.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:tt.isArrayBufferView(o)||tt.isArrayBuffer(o)?o.byteLength:(tt.isURLSearchParams(o)&&(o+=""),tt.isString(o)?(await Gte(o)).byteLength:void 0))(t)};var Yte=gA&&(async e=>{let{url:t,method:r,data:o,signal:c,cancelToken:u,timeout:f,onDownloadProgress:g,onUploadProgress:E,responseType:v,headers:S,withCredentials:R="same-origin",fetchOptions:I}=i3(e);v=v?(v+"").toLowerCase():"text";let D,V=Ute([c,u&&u.toAbortSignal()],f);const M=V&&V.unsubscribe&&(()=>{V.unsubscribe()});let j;try{if(E&&Wte&&r!=="get"&&r!=="head"&&(j=await zte(S,o))!==0){let _e,me=new Request(t,{method:"POST",body:o,duplex:"half"});if(tt.isFormData(o)&&(_e=me.headers.get("content-type"))&&S.setContentType(_e),me.body){const[Ce,xe]=ZB(j,pA(e3(E)));o=a3(me.body,65536,Ce,xe)}}tt.isString(R)||(R=R?"include":"omit");const G="credentials"in Request.prototype;D=new Request(t,c3(c3({},I),{},{signal:V,method:r.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:G?R:void 0}));let z=await fetch(D);const ce=rk&&(v==="stream"||v==="response");if(rk&&(g||ce&&M)){const _e={};["status","statusText","headers"].forEach($e=>{_e[$e]=z[$e]});const me=tt.toFiniteNumber(z.headers.get("content-length")),[Ce,xe]=g&&ZB(me,pA(e3(g),!0))||[];z=new Response(a3(z.body,65536,Ce,()=>{xe&&xe(),M&&M()}),_e)}v=v||"text";let Ee=await _A[tt.findKey(_A,v)||"text"](z,e);return!ce&&M&&M(),await new nt((_e,me)=>{JB(_e,me,{data:Ee,headers:od.from(z.headers),status:z.status,statusText:z.statusText,config:e,request:D})})}catch(G){throw M&&M(),G&&G.name==="TypeError"&&/Load failed|fetch/i.test(G.message)?Object.assign(new $n("Network Error",$n.ERR_NETWORK,e,D),{cause:G.cause||G}):$n.from(G,G&&G.code,e,D)}});const ik={http:null,xhr:jte,fetch:Yte};tt.forEach(ik,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const p3=e=>"- ".concat(e),qte=e=>tt.isFunction(e)||e===null||e===!1;var f3={getAdapter:e=>{e=tt.isArray(e)?e:[e];const{length:t}=e;let r,o;const c={};for(let u=0;u<t;u++){let f;if(r=e[u],o=r,!qte(r)&&(o=ik[(f=String(r)).toLowerCase()],o===void 0))throw new $n("Unknown adapter '".concat(f,"'"));if(o)break;c[f||"#"+u]=o}if(!o){const u=Object.entries(c).map(f=>{let[g,E]=f;return"adapter ".concat(g," ")+(E===!1?"is not supported by the environment":"is not available in the build")});throw new $n("There is no suitable adapter to dispatch the request "+(t?u.length>1?`since :
`+u.map(p3).join(`
`):" "+p3(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:ik};function sk(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Dy(null,e)}function m3(e){return sk(e),e.headers=od.from(e.headers),e.data=JP.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),f3.getAdapter(e.adapter||QP.adapter)(e).then(function(t){return sk(e),t.data=JP.call(e,e.transformResponse,t),t.headers=od.from(t.headers),t},function(t){return $B(t)||(sk(e),t&&t.response&&(t.response.data=JP.call(e,e.transformResponse,t.response),t.response.headers=od.from(t.response.headers))),nt.reject(t)})}const g3="1.9.0",EA={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{EA[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const _3={};EA.transitional=function(e,t,r){function o(c,u){return"[Axios v"+g3+"] Transitional option '"+c+"'"+u+(r?". "+r:"")}return(c,u,f)=>{if(e===!1)throw new $n(o(u," has been removed"+(t?" in "+t:"")),$n.ERR_DEPRECATED);return t&&!_3[u]&&(_3[u]=!0,console.warn(o(u," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(c,u,f)}},EA.spelling=function(e){return(t,r)=>(console.warn("".concat(r," is likely a misspelling of ").concat(e)),!0)};var yA={assertOptions:function(e,t,r){if(typeof e!="object")throw new $n("options must be an object",$n.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let c=o.length;for(;c-- >0;){const u=o[c],f=t[u];if(f){const g=e[u],E=g===void 0||f(g,u,e);if(E!==!0)throw new $n("option "+u+" must be "+E,$n.ERR_BAD_OPTION_VALUE)}else if(r!==!0)throw new $n("Unknown option "+u,$n.ERR_BAD_OPTION)}},validators:EA};const ou=yA.validators;let vA=class{constructor(e){this.defaults=e||{},this.interceptors={request:new SF,response:new SF}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{r.stack?c&&!String(r.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+c):r.stack=c}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Dg(this.defaults,t);const{transitional:r,paramsSerializer:o,headers:c}=t;r!==void 0&&yA.assertOptions(r,{silentJSONParsing:ou.transitional(ou.boolean),forcedJSONParsing:ou.transitional(ou.boolean),clarifyTimeoutError:ou.transitional(ou.boolean)},!1),o!=null&&(tt.isFunction(o)?t.paramsSerializer={serialize:o}:yA.assertOptions(o,{encode:ou.function,serialize:ou.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),yA.assertOptions(t,{baseUrl:ou.spelling("baseURL"),withXsrfToken:ou.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let u=c&&tt.merge(c.common,c[t.method]);c&&tt.forEach(["delete","get","head","post","put","patch","common"],D=>{delete c[D]}),t.headers=od.concat(u,c);const f=[];let g=!0;this.interceptors.request.forEach(function(D){typeof D.runWhen=="function"&&D.runWhen(t)===!1||(g=g&&D.synchronous,f.unshift(D.fulfilled,D.rejected))});const E=[];let v;this.interceptors.response.forEach(function(D){E.push(D.fulfilled,D.rejected)});let S,R=0;if(!g){const D=[m3.bind(this),void 0];for(D.unshift.apply(D,f),D.push.apply(D,E),S=D.length,v=nt.resolve(t);R<S;)v=v.then(D[R++],D[R++]);return v}S=f.length;let I=t;for(R=0;R<S;){const D=f[R++],V=f[R++];try{I=D(I)}catch(M){V.call(this,M);break}}try{v=m3.call(this,I)}catch(D){return nt.reject(D)}for(R=0,S=E.length;R<S;)v=v.then(E[R++],E[R++]);return v}getUri(e){return vF(t3((e=Dg(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};tt.forEach(["delete","get","head","options"],function(e){vA.prototype[e]=function(t,r){return this.request(Dg(r||{},{method:e,url:t,data:(r||{}).data}))}}),tt.forEach(["post","put","patch"],function(e){function t(r){return function(o,c,u){return this.request(Dg(u||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}vA.prototype[e]=t(),vA.prototype[e+"Form"]=t(!0)});var SA=vA;class ak{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new nt(function(c){r=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const f=new nt(g=>{o.subscribe(g),u=g}).then(c);return f.cancel=function(){o.unsubscribe(u)},f},t(function(c,u,f){o.reason||(o.reason=new Dy(c,u,f),r(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=o=>{t.abort(o)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new ak(function(o){t=o}),cancel:t}}}var Kte=ak;const ok={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ok).forEach(e=>{let[t,r]=e;ok[r]=t});var Xte=ok;const $s=function e(t){const r=new SA(t),o=rF(SA.prototype.request,r);return tt.extend(o,SA.prototype,r,{allOwnKeys:!0}),tt.extend(o,r,null,{allOwnKeys:!0}),o.create=function(c){return e(Dg(t,c))},o}(QP);$s.Axios=SA,$s.CanceledError=Dy,$s.CancelToken=Kte,$s.isCancel=$B,$s.VERSION=g3,$s.toFormData=eA,$s.AxiosError=$n,$s.Cancel=$s.CanceledError,$s.all=function(e){return nt.all(e)},$s.spread=function(e){return function(t){return e.apply(null,t)}},$s.isAxiosError=function(e){return tt.isObject(e)&&e.isAxiosError===!0},$s.mergeConfig=Dg,$s.AxiosHeaders=od,$s.formToJSON=e=>XB(tt.isHTMLForm(e)?new FormData(e):e),$s.getAdapter=f3.getAdapter,$s.HttpStatusCode=Xte,$s.default=$s;var xa=$s;const Qte=()=>{};function bb(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Qte};return e.promise=new nt((t,r)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(o))}}),e}const TA=new Map,bA=new Map,cu=new Map;let Fi=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Un=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const E3=new CJ;let cd=E3.getResult(),ck=null;function An(e){if(!ck){cd=E3.getResult();const t=function(g){if(g.engine.name==="Blink"&&g.browser.name!=="WeChat")return Un.CHROME;switch(g.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Un.CHROME;case"Safari":case"Mobile Safari":return Un.SAFARI;case"Edge":return Un.EDGE;case"Firefox":return Un.FIREFOX;case"QQ":case"QQBrowser":return Un.QQ;case"Opera":return Un.OPERA;case"WeChat":return Un.WECHAT;default:return g.browser.name||""}}(cd),r=y3(cd),o=function(g){return g.os.name==="Windows"?g.os.version?g.os.name+" "+g.os.version:g.os.name:g.os.name||""}(cd),c=cd.os.version,u=y3(cd,!1),f=cd.device.type;if(!(t&&r&&o&&c))return{name:t,version:r,os:o,osVersion:c,browserVersion:u,deviceType:f};ck={name:t,version:r,os:o,osVersion:c,browserVersion:u,deviceType:f}}return ck}function y3(e){let t,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function wA(){return An().os}function v3(){const e=An();return"".concat(e.os," ").concat(e.osVersion)}function RA(){const e=An();return!!(cd.engine.name==="WebKit"&&e.os===Fi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Un.SAFARI||ma()&&e.name!==Un.SAFARI)}function Mh(){return An().name===Un.CHROME}function fs(){return An().name===Un.SAFARI}function S3(){return An().name===Un.EDGE}function Fr(){return An().name===Un.FIREFOX}function ma(){return An().os===Fi.IOS}function wb(e){const t=An();return!(t.name!==Un.CHROME||!t.osVersion)&&Number(t.version)>=e}function T3(e){const t=An();return!(t.name!==Un.CHROME||!t.osVersion)&&Number(t.version)<e}function lk(e,t,r){const o=An();return!(o.name!==e||!o.osVersion)&&(r?Number(o.version)>=t&&Number(o.version)<=r:Number(o.version)===t)}function dk(e){const t=An();return!(t.name!==Un.EDGE||!t.osVersion)&&Number(t.version)>=e}function b3(e){const t=An();return!(t.name!==Un.SAFARI||!t.osVersion)&&Number(t.version)>=e}function w3(e,t,r){const o=An();if(o.os!==Fi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e}function R3(e,t,r){const o=An();if(o.name!==Un.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return r?t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e:t?Number(c[0])===e&&Number(c[1])<=t||Number(c[0])<e:Number(c[0])<=e}function uk(e){const t=An();return!(t.name!==Un.OPERA||!t.osVersion)&&Number(t.version)>=e}function C3(){const e=An();if(e.os!==Fi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function xy(){const e=An();if(e.os!==Fi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function hk(){const e=An();if(e.os!==Fi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function A3(){const e=An();if(e.os!==Fi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function ml(){return fs()&&navigator.maxTouchPoints>0}function I3(){return An().name===Un.WECHAT}function N3(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function pk(){const e=wA();return function(){const{deviceType:t}=An();return t==="mobile"||t==="tablet"}()||e===Fi.ANDROID||e===Fi.IOS||e===Fi.HARMONY_OS}function jh(){const e=An();return e.name!==Un.EDGE&&e.name!==Un.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function CA(){return wA()===Fi.ANDROID}function Rb(){const e=An();return CA()&&(e.name===Un.CHROME||e.name===Un.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function jt(e,t,r){return(t=function(o){var c=function(u,f){if(typeof u!="object"||!u)return u;var g=u[Symbol.toPrimitive];if(g!==void 0){var E=g.call(u,"string");if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function dt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?O3(Object(r),!0).forEach(function(o){jt(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O3(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let q=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Ae=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),jt(this,"code",void 0),jt(this,"message",void 0),jt(this,"data",void 0),jt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Uh(e,t){if(typeof e!="boolean")throw new Ae(q.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function ki(e,t,r){if(!et(r).call(r,e))throw new Ae(q.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function Jn(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<r||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new Ae(q.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(r,", ").concat(o,"]. integer only"))}function fk(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Ae(q.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Jn(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Jn(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Jn(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Jn(e.ideal,"".concat(t,".ideal"),1,1/0)}else Jn(e,t,1,1/0)}function rs(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Ae(q.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!D3(e,r,o,c))throw new Ae(q.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function Vh(e,t){if(!Array.isArray(e))throw new Ae(q.INVALID_PARAMS,"".concat(t," should be an array"))}function Br(e){return e==null}function D3(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=r&&e.length>=t&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const f=c.charCodeAt(u);if(f<0||f>255)return!1}return!0}(e))}var Cb=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Cb||{}),mk=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(mk||{});const x3=new class{constructor(){jt(this,"_clientSize",null),jt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),jt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),jt(this,"getStyle",e=>window.getComputedStyle(e,null)),jt(this,"checkCssVisibleProperty",e=>{var t;let r=!0;const o=this.getStyle(e),{display:c,visibility:u,opacity:f,filter:g}=o;return(c==="none"||et(t=["hidden","collapse"]).call(t,u)||Number(f)<.1)&&(r=!1),!!r&&(g&&g.split(" ").filter(E=>{var v;const S=E.split("(")[0];return et(v=["brightness","blur","opacity"]).call(v,S)}).map(E=>{const[v,S]=E.split(/\(|\)/);return[v,Number(S.match(/^[0-9\.]+/))]}).forEach(E=>{const[v,S]=E;switch(v){case"brightness":(S<.1||S>3)&&(r=!1);break;case"blur":S>3&&(r=!1);break;case"opacity":S<.1&&(r=!1)}}),r)}),jt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let r=!0,o=!0;const c=f=>t(f);let u=e;for(;u&&o;)c(u)||(r=!1,o=!1),u=u.parentElement,u||(o=!1);return r}),jt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),jt(this,"getSizeAboutClient",e=>{const{width:t,height:r,left:o,right:c,top:u,bottom:f}=e.getBoundingClientRect(),g=this.getClientWidth(),E=this.getClientHeight();return{width:t,height:r,left:o,right:c,top:u,bottom:f,clientWidth:g,clientHeight:E,clientMin:Math.min(g,E)}}),jt(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)}),jt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),jt(this,"checkCoverForAPoint",(e,t,r)=>{const o=this.elementFromPoint(e,t);return o!==null&&o!==r}),jt(this,"getPointPositionList",()=>{const{width:e,height:t,left:r,top:o}=this._clientSize,c=e/6,u=t/6,f=[],g=10**6;for(let E=0;E<5;E++)for(let v=0;v<5;v++){const S=(r*g+(E===0?.1:E===4?(c*E*g-1e5)/g:c*E)*g)/g,R=(o*g+(v===0?.1:v===4?(u*v*g-1e5)/g:u*v)*g)/g;f.push({x:S,y:R})}return[...f]}),jt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),jt(this,"checkSizeIsVisible",(e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10)),jt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:r,bottom:o,clientHeight:c,clientWidth:u,clientMin:f}=this._clientSize;let g,E,v,S;if(e<0)g=0;else{if(!(e<u))return!1;g=e}if(t<0)return!1;if(E=t<u?t:u,r<0)v=0;else{if(!(r<c))return!1;v=r}if(o<0)return!1;S=o<c?o:c;const R=E-g,I=S-v;return this.checkSizeIsVisible(R,I,f)}),jt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),jt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Cb.COVERED);{const t=this.checkActualSize(),r=this.checkSizeOfPartInClient();return t&&!r?this.returnHiddenResult(Cb.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Cb.SIZE)}}return this.returnHiddenResult(Cb.STYLE)}return this.returnHiddenResult(mk.UNMOUNTED)}return this.returnHiddenResult(mk.INVALID_HTML_ELEMENT)}),jt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function gk(e){return new TextEncoder().encode(e)}const P3=function(e,t){const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},_k=async e=>function(t,r){let o="";return new Uint8Array(t).forEach(c=>{o+=c.toString(r).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",gk(e)),16);let Dr=class{constructor(){jt(this,"_events",{}),jt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const r=this._events[e],o=this._indexOfListener(r,t);o!==-1&&r.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(u=>u);for(var r=arguments.length,o=new Array(r>1?r-1:0),c=1;c<r;c++)o[c-1]=arguments[c];for(let u=0;u<t.length;u+=1){const f=t[u];f.once&&this.off(e,f.listener),f.listener.apply(this,o||[])}}safeEmit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,r)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,t){let r=e.length;for(;r--;)if(e[r].listener===t)return r;return-1}},Ab=null;function k3(){if(Ab)return Ab;if(window.electron)return Ab=window.electron;if(!window.require)return null;try{return Ab=window.require("electron"),Ab}catch{return null}}let di=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Hr=function(e){return e.TRACER="tracer",e}({});function L3(e){return Jn(e.timeout,"config.timeout",0,1e5),Jn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Jn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Jn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let $te=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Fn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Ib(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function M3(e){return rs(e.turnServerURL,"turnServerURL"),rs(e.username,"username"),rs(e.password,"password"),e.udpport&&Jn(e.udpport,"udpport",1,99999,!0),e.forceturn&&Uh(e.forceturn,"forceturn"),e.security&&Uh(e.security,"security"),e.tcpport&&Jn(e.tcpport,"tcpport",1,99999,!0),!0}function Ek(e){return e.level!==void 0&&ki(e.level,"level",[1,2,3]),e.delay!==void 0&&Jn(e.delay,"delay",0,3e3,!0),!0}let hn=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),ms=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Oo=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Py=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function gs(e,t){for(var r=arguments.length,o=new Array(r>2?r-2:0),c=2;c<r;c++)o[c-2]=arguments[c];return e.getListeners(t).length===0?nt.reject(new Ae(q.UNEXPECTED_ERROR,"can not emit promise")):new nt((u,f)=>{e.emit(t,...o,u,f)})}function ir(e,t){if(e.getListeners(t).length===0)return nt.resolve();for(var r=arguments.length,o=new Array(r>2?r-2:0),c=2;c<r;c++)o[c-2]=arguments[c];return gs(e,t,...o)}function $o(e,t){if(e.getListeners(t).length===0)return null;for(var r=arguments.length,o=new Array(r>2?r-2:0),c=2;c<r;c++)o[c-2]=arguments[c];return Nb(e,t,...o)}function Nb(e,t){let r=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),f=2;f<c;f++)u[f-2]=arguments[f];if(e.emit(t,...u,g=>{r=g},g=>{o=g}),o!==null)throw o;if(r===null)throw new Ae(q.UNEXPECTED_ERROR,"handler is not sync");return r}const ui=new class extends Dr{set networkState(e){this.emit(Py.NETWORK_STATE_CHANGE,e,this._networkState),e===Oo.ONLINE?this.emit(Py.ONLINE):e===Oo.OFFLINE&&(this.onlineWaiter=new nt(t=>{this.once(Py.ONLINE,()=>{this.onlineWaiter=void 0,t(Oo.ONLINE)})}),this.emit(Py.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Oo.ONLINE}constructor(){super(),jt(this,"_moduleName","network-indicator"),jt(this,"_networkState",Oo.ONLINE),jt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Oo.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Oo.OFFLINE})}};function AA(e,t){const r=e.indexOf(t);r!==-1&&e.splice(r,1)}function ky(e){const t=[];return e.forEach(r=>{t.indexOf(r)===-1&&t.push(r)}),t}function IA(e){nt!==void 0?nt.resolve().then(e):setTimeout(e,0)}function xr(e){return JSON.parse(JSON.stringify(e))}function xg(e){try{return xr(e)}catch{return e}}const j3={};function Ef(e,t){j3[t]||(j3[t]=!0,e())}function Pg(e){const t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let o=0;o<t.length;o+=1)r[o]=t.charCodeAt(o);return r}function yf(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function U3(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=new TextEncoder().encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){const o=new Uint8Array(t);o.set(r),r=o}return r}function V3(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const o=Xa(t).call(t,(f,g)=>f+g.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return t.forEach(f=>{c.set(f,u),u+=f.length}),c}function lu(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function F3(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(r=>{t+=typeof r=="string"?lu(r):r.size}),t+138}function Jte(e){const t=new Ae(q.TIMEOUT,"timeout");return new nt((r,o)=>{window.setTimeout(()=>o(t),e)})}function is(e){return new nt(t=>{window.setTimeout(t,e)})}function lr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+lr(e-r.length,"")}function kg(){return lr(32,"").toUpperCase()}const NA=()=>{},B3=new class{constructor(){jt(this,"fnMap",new Map)}throttleByKey(e,t,r,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),f=4;f<c;f++)u[f-4]=arguments[f];if(this.fnMap.has(t)){const g=this.fnMap.get(t);if(g.threshold!==r){g.fn(...g.args),clearTimeout(g.timer);const E=window.setTimeout(()=>{const v=this.fnMap.get(t);v&&v.fn(...v.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:E,args:u,skipFn:o})}else g.skipFn&&g.skipFn(...g.args),this.fnMap.set(t,dt(dt({},g),{},{fn:e,args:u,skipFn:o}))}else{const g=window.setTimeout(()=>{const E=this.fnMap.get(t);E&&E.fn(...E.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:g,args:u,skipFn:o})}}},H3=B3.throttleByKey.bind(B3);function G3(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function yk(e,t){if(!G3(e)||!G3(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const r=[...e];for(let o=0;o<t.length;o++)r[o]=yk(e[o],t[o]);return r}{const r=dt({},e);for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(Object.prototype.hasOwnProperty.call(e,o)?r[o]=yk(e[o],t[o]):r[o]=t[o]);return r}}function W3(e,t){let r=[0];if(r=new Array(t).fill(0),e===0)return r;let o=0;for(;e>0&&(r[o]=255&e,e>>=8,o++,o!==t););return r}function vk(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function Sk(e){return Xa(e).call(e,(t,r)=>t+r,0)}function z3(e){const t="0123456789abcdef";function r(ce){let Ee,_e="";for(Ee=0;Ee<=3;Ee++)_e+=t.charAt(ce>>8*Ee+4&15)+t.charAt(ce>>8*Ee&15);return _e}function o(ce,Ee){const _e=(65535&ce)+(65535&Ee);return(ce>>16)+(Ee>>16)+(_e>>16)<<16|65535&_e}function c(ce,Ee,_e,me,Ce,xe){return o(function($e,at){return $e<<at|$e>>>32-at}(o(o(Ee,ce),o(me,xe)),Ce),_e)}function u(ce,Ee,_e,me,Ce,xe,$e){return c(Ee&_e|~Ee&me,ce,Ee,Ce,xe,$e)}function f(ce,Ee,_e,me,Ce,xe,$e){return c(Ee&me|_e&~me,ce,Ee,Ce,xe,$e)}function g(ce,Ee,_e,me,Ce,xe,$e){return c(Ee^_e^me,ce,Ee,Ce,xe,$e)}function E(ce,Ee,_e,me,Ce,xe,$e){return c(_e^(Ee|~me),ce,Ee,Ce,xe,$e)}const v=function(ce){let Ee;const _e=1+(ce.length+8>>6),me=new Array(16*_e);for(Ee=0;Ee<16*_e;Ee++)me[Ee]=0;for(Ee=0;Ee<ce.length;Ee++)me[Ee>>2]|=ce.charCodeAt(Ee)<<Ee%4*8;return me[Ee>>2]|=128<<Ee%4*8,me[16*_e-2]=8*ce.length,me}(e);let S,R,I,D,V,M=1732584193,j=-271733879,G=-1732584194,z=271733878;for(S=0;S<v.length;S+=16)R=M,I=j,D=G,V=z,M=u(M,j,G,z,v[S+0],7,-680876936),z=u(z,M,j,G,v[S+1],12,-389564586),G=u(G,z,M,j,v[S+2],17,606105819),j=u(j,G,z,M,v[S+3],22,-1044525330),M=u(M,j,G,z,v[S+4],7,-176418897),z=u(z,M,j,G,v[S+5],12,1200080426),G=u(G,z,M,j,v[S+6],17,-1473231341),j=u(j,G,z,M,v[S+7],22,-45705983),M=u(M,j,G,z,v[S+8],7,1770035416),z=u(z,M,j,G,v[S+9],12,-1958414417),G=u(G,z,M,j,v[S+10],17,-42063),j=u(j,G,z,M,v[S+11],22,-1990404162),M=u(M,j,G,z,v[S+12],7,1804603682),z=u(z,M,j,G,v[S+13],12,-40341101),G=u(G,z,M,j,v[S+14],17,-1502002290),j=u(j,G,z,M,v[S+15],22,1236535329),M=f(M,j,G,z,v[S+1],5,-165796510),z=f(z,M,j,G,v[S+6],9,-1069501632),G=f(G,z,M,j,v[S+11],14,643717713),j=f(j,G,z,M,v[S+0],20,-373897302),M=f(M,j,G,z,v[S+5],5,-701558691),z=f(z,M,j,G,v[S+10],9,38016083),G=f(G,z,M,j,v[S+15],14,-660478335),j=f(j,G,z,M,v[S+4],20,-405537848),M=f(M,j,G,z,v[S+9],5,568446438),z=f(z,M,j,G,v[S+14],9,-1019803690),G=f(G,z,M,j,v[S+3],14,-187363961),j=f(j,G,z,M,v[S+8],20,1163531501),M=f(M,j,G,z,v[S+13],5,-1444681467),z=f(z,M,j,G,v[S+2],9,-51403784),G=f(G,z,M,j,v[S+7],14,1735328473),j=f(j,G,z,M,v[S+12],20,-1926607734),M=g(M,j,G,z,v[S+5],4,-378558),z=g(z,M,j,G,v[S+8],11,-2022574463),G=g(G,z,M,j,v[S+11],16,1839030562),j=g(j,G,z,M,v[S+14],23,-35309556),M=g(M,j,G,z,v[S+1],4,-1530992060),z=g(z,M,j,G,v[S+4],11,1272893353),G=g(G,z,M,j,v[S+7],16,-155497632),j=g(j,G,z,M,v[S+10],23,-1094730640),M=g(M,j,G,z,v[S+13],4,681279174),z=g(z,M,j,G,v[S+0],11,-358537222),G=g(G,z,M,j,v[S+3],16,-722521979),j=g(j,G,z,M,v[S+6],23,76029189),M=g(M,j,G,z,v[S+9],4,-640364487),z=g(z,M,j,G,v[S+12],11,-421815835),G=g(G,z,M,j,v[S+15],16,530742520),j=g(j,G,z,M,v[S+2],23,-995338651),M=E(M,j,G,z,v[S+0],6,-198630844),z=E(z,M,j,G,v[S+7],10,1126891415),G=E(G,z,M,j,v[S+14],15,-1416354905),j=E(j,G,z,M,v[S+5],21,-57434055),M=E(M,j,G,z,v[S+12],6,1700485571),z=E(z,M,j,G,v[S+3],10,-1894986606),G=E(G,z,M,j,v[S+10],15,-1051523),j=E(j,G,z,M,v[S+1],21,-2054922799),M=E(M,j,G,z,v[S+8],6,1873313359),z=E(z,M,j,G,v[S+15],10,-30611744),G=E(G,z,M,j,v[S+6],15,-1560198380),j=E(j,G,z,M,v[S+13],21,1309151649),M=E(M,j,G,z,v[S+4],6,-145523070),z=E(z,M,j,G,v[S+11],10,-1120210379),G=E(G,z,M,j,v[S+2],15,718787259),j=E(j,G,z,M,v[S+9],21,-343485551),M=o(M,R),j=o(j,I),G=o(G,D),z=o(z,V);return r(M)+r(j)+r(G)+r(z)}let Zte=1,Y3=console,Ps=class{static setLogger(e){Y3=e}constructor(e,t){jt(this,"id",void 0),jt(this,"lockingPromise",nt.resolve()),jt(this,"locks",0),jt(this,"name",""),jt(this,"lockId",void 0),this.lockId=Zte++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const r=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");Y3.debug("".concat(r," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const r=new nt(c=>{t=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),o}};function Ly(e,t){return function(r,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const f=this[t];if(!f)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const g=await f.lock("From ".concat(e,".").concat(o));try{for(var E=arguments.length,v=new Array(E),S=0;S<E;S++)v[S]=arguments[S];return await u.apply(this,v)}finally{g()}},c}}const Si={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Tk(e,t){const r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function ld(e,t,r,o){const c=Object.assign({},Si,o);let u=c.timeout;const f=async()=>{await function(v){return new nt(S=>{window.setTimeout(S,v)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let g=!1;const E=new nt(async(v,S)=>{t=t||(()=>!1),r=r||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(g)return S(new Ae(q.OPERATION_ABORTED));try{const I=await e();if(!t(I,R)||R+1===c.maxRetryCount)return v(I);await f()}catch(I){if(!r(I,R)||R+1===c.maxRetryCount)return S(I);await f()}}});return E.cancel=()=>g=!0,E}let OA,q3=class{constructor(e){jt(this,"input",[]),jt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Xa(e=this.input).call(e,(t,r)=>t+r)/this.input.length}},DA=0,bk=0;function wk(e,t,r,o){return new nt((c,u)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),DA+=lu(t.data)):r&&(t.data.size?DA+=t.data.size:t.data instanceof FormData?DA+=F3(t.data):DA+=lu(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,xa.request(t).then(f=>{typeof f.data=="string"?bk+=lu(f.data):f.data instanceof ArrayBuffer||f.data instanceof Uint8Array?bk+=f.data.byteLength:bk+=lu(JSON.stringify(f.data)),c(f.data)}).catch(f=>{xa.isCancel(f)?u(new Ae(q.OPERATION_ABORTED,"cancel token canceled")):f.code==="ECONNABORTED"?u(new Ae(q.NETWORK_TIMEOUT,f.message)):f.response?u(new Ae(q.NETWORK_RESPONSE_ERROR,f.response.status)):u(new Ae(q.NETWORK_ERROR,f.message))})})}async function ene(e,t){const r=new Blob([t.data],{type:"buffer"});return await wk(e,dt(dt({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}const K3=()=>window.isSecureContext!==void 0;function gl(e){if(Array.isArray(e))return e.map(r=>r);if(!X3(e))return e;const t={};for(const r in e){const o=e[r];X3(o)||Array.isArray(o)?t[r]=gl(o):t[r]=o}return t}function X3(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let Rk=class{constructor(e){jt(this,"input",[]),jt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const du={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Ob={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:du,remoteCandidate:du},updateInterval:0},Q3={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},$3={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},J3={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},Z3={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let Ck=class{constructor(e,t){jt(this,"onFirstVideoReceived",void 0),jt(this,"onFirstVideoDecoded",void 0),jt(this,"onFirstAudioReceived",void 0),jt(this,"onFirstVideoDecodedTimeout",void 0),jt(this,"onFirstAudioDecoded",void 0),jt(this,"onSelectedLocalCandidateChanged",void 0),jt(this,"onSelectedRemoteCandidateChanged",void 0),jt(this,"videoIsReady",!1),jt(this,"videoIsReady2",{}),jt(this,"pc",void 0),jt(this,"options",void 0),jt(this,"intervalTimer",void 0),jt(this,"stats",gl(Ob)),jt(this,"isFirstVideoReceived",{}),jt(this,"isFirstVideoDecoded",{}),jt(this,"isFirstAudioReceived",{}),jt(this,"isFirstAudioDecoded",{}),jt(this,"isFirstVideoDecodedTimeout",{}),jt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new nt(e=>{e({local:dt({},du),remote:dt({},du)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,f=0;for(const g of r)e[g].forEach((E,v)=>{if(!this.lossRateWindowStats[t-1][g][v]||!this.lossRateWindowStats[0][g][v])return;const S=this.lossRateWindowStats[t-1][g][v].packets-this.lossRateWindowStats[0][g][v].packets,R=this.lossRateWindowStats[t-1][g][v].packetsLost-this.lossRateWindowStats[0][g][v].packetsLost;g==="videoSend"||g==="audioSend"?(o+=S,u+=R):(c+=S,f+=R),Number.isNaN(S)||Number.isNaN(S)?E.packetLostRate=0:E.packetLostRate=S<=0||R<=0?0:R/(S+R)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||f<=0?0:f/(c+f)}},tne=class extends Ck{constructor(){super(...arguments),jt(this,"_stats",Ob),jt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=gl(Ob);const r=t.filter(c=>c.type==="ssrc");this.processSSRCStats(r);const o=t.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var r;const o=et(r=t.id).call(r,"send");switch("".concat(t.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=gl($3);c.codec=t.googCodecName,c.adaptionChangeReason="none",t.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(t.googAvgEncodeMs),c.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.firsCount=Number(t.googFirReceived),c.nacksCount=Number(t.googNacksReceived),c.plisCount=Number(t.googPlisReceived),c.frameCount=Number(t.framesEncoded),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=gl(Q3),u=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(c.codec=t.googCodecName,c.targetDelayMs=Number(t.googTargetDelayMs),c.renderDelayMs=Number(t.googRenderDelayMs),c.currentDelayMs=Number(t.googCurrentDelayMs),c.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),c.decodeMs=Number(t.googDecodeMs),c.maxDecodeMs=Number(t.googMaxDecodeMs),c.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},c.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},c.decodeFrameRate=Number(t.googFrameRateDecoded),c.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},c.jitterBufferMs=Number(t.googJitterBufferMs),c.firsCount=Number(t.googFirsSent),c.nacksCount=Number(t.googNacksSent),c.plisCount=Number(t.googPlisSent),c.framesDecodeCount=Number(t.framesDecoded),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const f=u.stats,g=Date.now()-u.lts;c.framesDecodeFreezeTime=f.framesDecodeFreezeTime,c.framesDecodeInterval=f.framesDecodeInterval,c.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=g,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:dt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=gl(Z3);c.codec=t.googCodecName,c.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,c.decodingCNG=Number(t.googDecodingCNG),c.decodingCTN=Number(t.googDecodingCTN),c.decodingCTSG=Number(t.googDecodingCTSG),c.decodingNormal=Number(t.googDecodingNormal),c.decodingPLC=Number(t.googDecodingPLC),c.decodingPLCCNG=Number(t.googDecodingPLCCNG),c.expandRate=Number(t.googExpandRate),c.accelerateRate=Number(t.googAccelerateRate),c.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),c.speechExpandRate=Number(t.googSpeechExpandRate),c.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),c.jitterBufferMs=Number(t.googJitterBufferMs),c.jitterMs=Number(t.googJitterReceived),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),c.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=gl(J3);c.codec=t.googCodecName,c.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,c.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new nt((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(r=>{const o={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(c=>{o[c]=r.stat(c)}),t.push(o)}),t}},Db=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),xA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),Ak=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Jo=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var My=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(My||{});function xb(e,t,r,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:My.kNone;if(!t)return;const u=Number(t[r]);if(typeof u!="number")return;const f=Number(t[o]);if(typeof f!="number")return;if(!e)return f?u/f*c:void 0;const g=Number(e[r]);if(typeof g!="number")return;const E=Number(e[o]);if(typeof E!="number")return;const v=f-E;return v?(u-g)/v*c:void 0}let e4=class extends Ck{constructor(){super(...arguments),jt(this,"_stats",Ob),jt(this,"report",void 0),jt(this,"lastDecodeVideoReceiverStats",new Map),jt(this,"lastVideoFramesRecv",new Map),jt(this,"lastVideoFramesSent",new Map),jt(this,"lastVideoFramesDecode",new Map),jt(this,"lastVideoFramesOutput",new Map),jt(this,"lastVideoJBDelay",new Map),jt(this,"lastAudioJBDelay",new Map),jt(this,"mediaBytesSent",new Map),jt(this,"mediaBytesRetransmit",new Map),jt(this,"mediaBytesTargetEncode",new Map),jt(this,"lastDecodeAudioReceiverStats",new Map),jt(this,"lastAudioConcealment",new Map),jt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=gl(Ob),this.report.forEach(e=>{switch(e.type){case Jo.OUTBOUND:case Jo.INBOUND:{const t=e.mediaType||e.kind,r=!t&&"frameWidth"in e,o=!t&&!("frameWidth"in e);e.type===Jo.OUTBOUND?t==="audio"||o?this.processAudioOutboundStats(e):(t==="video"||r)&&this.processVideoOutboundStats(e):e.type===Jo.INBOUND&&(t==="audio"||o?this.processAudioInboundStats(e):(t==="video"||r)&&this.processVideoInboundStats(e));break}case Jo.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Jo.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:dt({},du),remote:dt({},du)};return e.forEach(r=>{let o;if(r.type===Jo.TRANSPORT&&(o=e.get(r.selectedCandidatePairId)),r.type===Jo.CANDIDATE_PAIR&&r.selected&&(o=r),o){const c=(u,f)=>{u.type=f.type,u.id=f.id,f.address&&(u.address=f.address),f.candidateType&&(u.candidateType=f.candidateType),f.port&&(u.port=f.port),f.priority&&(u.priority=f.priority),f.protocol&&(u.protocol=f.protocol),f.relayProtocol&&(u.relayProtocol=f.relayProtocol)};if(o.localCandidateId){const u=e.get(o.localCandidateId);u&&c(t.local,u)}if(o.remoteCandidateId){const u=e.get(o.remoteCandidateId);u&&c(t.remote,u)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Jo.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Jo.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Jo.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(dt({},t),dt({},this.stats.selectedCandidatePair.localCandidate)),e.type===Jo.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(dt({},t),dt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);t||(t=gl(Z3),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const r=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=xb(r,t,"totalProcessingDelay","jitterBufferEmittedCount",My.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,r,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,dt({},t))}calculateAudioFreeze(e,t,r){const o=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&o!=null){const c=o.lts,u=r.timestamp,f=u-c;if(f<=0)return;const g=e.concealedSamples-t.concealedSamples-0,E=o.nonSilent+g,v=e.totalSamplesReceived-t.totalSamplesReceived;if(v<=0)return;const S=80*v/f,R=200*v/f,I=f/v;let D=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,E>S&&(o.plc80>0?(e.freezeSamples80+=g,e.freezeMs80+=Math.round(g*I)):(e.freezeSamples80+=E,e.freezeMs80+=Math.round(E*I)),D=o.plc80+1);let V=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,E>R&&(o.plc200>0?(e.freezeSamples200+=g,e.freezeMs200+=Math.round(g*I)):(e.freezeSamples200+=E,e.freezeMs200+=Math.round(E*I)),V=o.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:g,lts:u,plc80:D,plc200:V})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:r.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(f=>f.ssrc===e.ssrc);t||(t=gl(Q3),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const r=this.lastDecodeVideoReceiverStats.get(t.ssrc),o=this.lastVideoFramesDecode.get(t.ssrc),c=this.lastVideoFramesOutput.get(t.ssrc),u=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const f=t.decodedFrame?t.decodedFrame.width:0,g=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,f,g),this.isFirstVideoDecoded[t.ssrc]=!0}if(r){const f=r.stats,g=u-r.lts;t.framesDecodeFreezeTime=f.framesDecodeFreezeTime,t.framesDecodeInterval=f.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&g>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=g,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<f.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=xb(r==null?void 0:r.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=xb(r==null?void 0:r.stats,t,"totalProcessingDelay","framesDecodeCount",My.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=xb(r==null?void 0:r.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",My.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=xb(r==null?void 0:r.stats,t,"totalInterFrameDelay","framesDecodeCount",My.kMillisecondsFromSeconds),o&&u-o.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:u,rate:t.decodeFrameRate})):o?t.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:u,rate:0}),t.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:u,rate:Math.max(t.outputFrameRate,0)})):c?t.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:dt({},t),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);t||(t=gl($3),this._stats.videoSend.push(t));const r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{const o=new Rk(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const c=new Rk(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const c=new Rk(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;t.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const o=this.findRemoteStatsId(e.ssrc,Jo.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(r=>r.ssrc===e.ssrc);if(t||(t=gl(J3),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,Jo.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}findRemoteStatsId(e,t){var r;const o=Array.from(Da(r=this.report).call(r)).find(c=>c.type===t&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,t){const r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(t.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,t){const r=this.report.get(e);r&&(t.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,t,r){var o,c,u,f;const g=t?this.report.get(t):void 0,E=(o=g==null?void 0:g.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof E!="number")return;let v=(c=g==null?void 0:g.frameWidth)!==null&&c!==void 0?c:e.frameWidth,S=(u=g==null?void 0:g.frameHeight)!==null&&u!==void 0?u:e.frameHeight,R=(f=g==null?void 0:g.framesPerSecond)!==null&&f!==void 0?f:e.framesPerSecond;if(typeof v=="number"&&typeof S=="number"||(v=0,S=0),R==null){const I=Date.now(),D=this.lastVideoFramesSent.get(r.ssrc);D&&I-D.lts>=800?(R=Math.round((E-D.count)/((I-D.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:E,lts:I,rate:R})):D?R=D.rate:this.lastVideoFramesSent.set(r.ssrc,{count:E,lts:I,rate:0})}r.sentFrame={width:v,height:S,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(e,t,r){var o,c,u,f,g;const E=t?this.report.get(t):void 0,v=(o=E==null?void 0:E.framesReceived)!==null&&o!==void 0?o:e.framesReceived,S=(c=E==null?void 0:E.frameWidth)!==null&&c!==void 0?c:e.frameWidth,R=(u=E==null?void 0:E.frameHeight)!==null&&u!==void 0?u:e.frameHeight,I=(f=E==null?void 0:E.jitterBufferDelay)!==null&&f!==void 0?f:e.jitterBufferDelay,D=(g=E==null?void 0:E.jitterBufferEmittedCount)!==null&&g!==void 0?g:e.jitterBufferEmittedCount;if(typeof v=="number"){const V=this.lastVideoFramesRecv.get(r.ssrc),M=Date.now();r.framesReceivedCount=v;let j=0;V&&M-V.lts>=800?(j=Math.round((v-V.count)/((M-V.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:v,lts:M,rate:j})):V?j=V.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:v,lts:M,rate:0}),r.receivedFrame={width:S||0,height:R||0,frameRate:j||0},r.decodedFrame={width:S||0,height:R||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:S||0,height:R||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(I&&D){const V=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let M=V.jitterBufferMs;const j=D-V.jitterBufferEmittedCount;j>0&&(M=1e3*(I-V.jitterBufferDelay)/j),r.jitterBufferMs=M,r.currentDelayMs=Math.round(M),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:D,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,t,r){var o,c,u,f;const g=t?this.report.get(t):void 0,E=(o=(c=g==null?void 0:g.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,v=(u=(f=g==null?void 0:g.echoReturnLossEnhancement)!==null&&f!==void 0?f:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;r.aecReturnLoss=E,r.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(e,t,r){var o,c,u,f,g,E,v,S,R;const I=t?this.report.get(t):void 0,D=(o=I==null?void 0:I.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,V=(c=I==null?void 0:I.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,M=(u=I==null?void 0:I.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,j=(f=I==null?void 0:I.jitterBufferEmittedCount)!==null&&f!==void 0?f:e.jitterBufferEmittedCount,G=(g=I==null?void 0:I.audioLevel)!==null&&g!==void 0?g:e==null?void 0:e.audioLevel,z=(E=I==null?void 0:I.totalSamplesDuration)!==null&&E!==void 0?E:e==null?void 0:e.totalSamplesDuration,ce=(v=I==null?void 0:I.concealedSamples)!==null&&v!==void 0?v:e.concealedSamples,Ee=(S=I==null?void 0:I.silentConcealedSamples)!==null&&S!==void 0?S:e.silentConcealedSamples,_e=(R=I==null?void 0:I.concealmentEvents)!==null&&R!==void 0?R:e.concealmentEvents;if(typeof V=="number"&&(r.totalSamplesReceived=V),typeof Ee=="number"&&(r.silentConcealedSamples=Ee),typeof _e=="number"&&(r.concealmentEvents=_e),typeof ce=="number"&&(r.concealedSamples=ce),D&&V&&(r.accelerateRate=D/V),M&&j){const Ce=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let xe=Ce.jitterBufferMs;const $e=j-Ce.jitterBufferEmittedCount;$e>0&&(xe=1e3*(M-Ce.jitterBufferDelay)/$e),r.jitterBufferMs=Math.round(xe),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:M,jitterBufferEmittedCount:j,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=G;let me=1920;z&&V&&(me=V/z/50,r.receivedFrames=Math.round(V/me)),ce&&(r.droppedFrames=Math.round(ce/me))}processRemoteInboundStats(e,t){const r=this.report.get(e);r&&(t.packetsLost=r.packetsLost,r.roundTripTime&&(t.rttMs=1e3*r.roundTripTime),r.jitter&&(t.jitterMs=1e3*r.jitter),r.timestamp&&(t.timestamp=r.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const r=t.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,t=null,r=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{t=t===null?c.diffMean():t+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()});const o=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}},nne=class extends Ck{updateStats(){return nt.resolve()}};function Ik(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const f=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return f&&f[0]?Number(f[0].split("/")[1]):null}();return u?u<76?new tne(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new e4(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(f){if(!window.RTCStatsReport)return!1;const g=f.getStats();return!!(g instanceof nt||function(E){return!!E&&(typeof E=="object"||typeof E=="function")&&typeof E.then=="function"}(g))}(e)?new e4(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new nne(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const t4="websdk_ng_install_id";function Nk(){try{if(Z("INSTALL_ID"))return Z("INSTALL_ID");let e=window.localStorage.getItem(t4);return e||(e=kg(),window.localStorage.setItem(t4,e)),qn("INSTALL_ID",e),e}catch{return}}const Ac=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const r=t[1],o=t[2];return"".concat(r,".").concat(o)}return"4.0.0.999"}("4.23.3"),Ok=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Lg=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const _s=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const o=r.join(""),c=[];for(let g=0;g<6;g++)c.push("1");const u=c.join(""),f={};return f[e]=o,f[t]=u,Object.assign(f,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=_s;const PA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},Dk={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},xk="v4.23.3-0-g83bb9b5a-dirty(4/29/2025, 5:16:52 PM)",Pk={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1},Sr=dt(dt(dt(dt({},Pk),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Dk,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},PA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:void 0,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function qn(e,t,r){var o,c,u;et(o=Object.keys(Sr)).call(o,e)&&(!r&&et(c=Object.keys(dd)).call(c,e)||(Sr[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||t!==!0||(Sr.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(Sr.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&t&&(u=!!t,Sr.USE_NEW_NETWORK_CONFIG=u,u&&(Sr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Sr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Sr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Sr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Sr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Sr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Sr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Sr.ENABLE_INSTANT_VIDEO=!0,Sr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Sr.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Sr.NEW_TURN_MODE||(Sr.NEW_TURN_MODE=4))))}function Z(e){return Sr[e]}Ok||(Sr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Sr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Sr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Sr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Sr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Sr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Sr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Sr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Sr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Sr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Sr.AREAS=["NORTH_AMERICA","OVERSEA"]);let n4=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const dd={};var _n=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(_n||{});let kA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const r4=128,rne=96,i4=1e3,jy=10;let ine=0;var s4=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>$e,Printer:()=>hr,parse:()=>Ye,print:()=>pt});const f=`
`,g="".concat("\r").concat(f),E=" ";let v;function S(ke){return ke>="0"&&ke<="9"}function R(ke){return ke>="!"&&ke<="~"}function I(ke){return R(ke)||ke>=""&&ke<=""}function D(ke){return ke==="!"||ke>="#"&&ke<="'"||ke>="*"&&ke<="+"||ke>="-"&&ke<="."||ke>="0"&&ke<="9"||ke>="A"&&ke<="Z"||ke>="^"&&ke<="~"}function V(ke){return ke>="1"&&ke<="9"}function M(ke){return ke>="A"&&ke<="Z"||ke>="a"&&ke<="z"}function j(ke){return ke==="d"||ke==="h"||ke==="m"||ke==="s"}function G(ke){return ke>""&&ke<"	"||ke>"\v"&&ke<"\f"||ke>""&&ke<""}function z(ke){return M(ke)||S(ke)||ke==="+"||ke==="/"}function ce(ke){return S(ke)||M(ke)||ke==="+"||ke==="/"||ke==="-"||ke==="_"}function Ee(ke){return M(ke)||S(ke)||ke==="+"||ke==="/"}function _e(ke,L){var ne=Object.keys(ke);if(Object.getOwnPropertySymbols){var de=Object.getOwnPropertySymbols(ke);L&&(de=de.filter(function(ze){return Object.getOwnPropertyDescriptor(ke,ze).enumerable})),ne.push.apply(ne,de)}return ne}function me(ke){for(var L=1;L<arguments.length;L++){var ne=arguments[L]!=null?arguments[L]:{};L%2?_e(Object(ne),!0).forEach(function(de){Ce(ke,de,ne[de])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ke,Object.getOwnPropertyDescriptors(ne)):_e(Object(ne)).forEach(function(de){Object.defineProperty(ke,de,Object.getOwnPropertyDescriptor(ne,de))})}return ke}function Ce(ke,L,ne){return L in ke?Object.defineProperty(ke,L,{value:ne,enumerable:!0,configurable:!0,writable:!0}):ke[L]=ne,ke}(function(ke){ke.VERSION="v",ke.ORIGIN="o",ke.SESSION_NAME="s",ke.INFORMATION="i",ke.URI="u",ke.EMAIL="e",ke.PHONE="p",ke.CONNECTION="c",ke.BANDWIDTH="b",ke.TIME="t",ke.REPEAT="r",ke.ZONE_ADJUSTMENTS="z",ke.KEY="k",ke.ATTRIBUTE="a",ke.MEDIA="m"})(v||(v={}));class xe{consumeText(L,ne){let de=ne;for(;de<L.length;){const ze=L[de];if(ze==="\0"||ze==="\r"||ze===f)break;de+=1}if(de-ne==0)throw new Error("Invalid text, at ".concat(L));return de}consumeUnicastAddress(L,ne,de){return this.consumeTill(L,ne,E)}consumeOneOrMore(L,ne,de){let ze=ne;for(;de(L[ze]);)ze++;if(ze-ne==0)throw new Error("Invalid rule at ".concat(ne,"."));return ze}consumeSpace(L,ne){if(L[ne]===E)return ne+1;throw new Error("Invalid space at ".concat(ne,"."))}consumeIP4Address(L,ne){let de=ne;for(let ze=0;ze<4;ze++)if(de=this.consumeDecimalUChar(L,de),ze!==3){if(L[de]!==".")throw new Error("Invalid IP4 address.");de++}return de}consumeDecimalUChar(L,ne){let de=ne;for(let Bt=0;Bt<3&&S(L[de]);Bt++,de++);if(de-ne==0)throw new Error("Invalid decimal uchar.");const ze=parseInt(L.slice(ne,de));if(ze>=0&&ze<=255)return de;throw new Error("Invalid decimal uchar")}consumeIP6Address(L,ne){let de=this.consumeHexpart(L,ne);return L[de]===":"&&(de+=1,de=this.consumeIP4Address(L,de)),de}consumeHexpart(L,ne){let de=ne;if(L[de]===":"&&L[de+1]===":"){de+=2;try{de=this.consumeHexseq(L,de)}catch{}return de}if(de=this.consumeHexseq(L,de),L[de]===":"&&L[de+1]===":"){de+=2;try{de=this.consumeHexseq(L,de)}catch{}return de}return de}consumeHexseq(L,ne){let de=ne;for(;de=this.consumeHex4(L,de),L[de]===":"&&L[de+1]!==":";)de+=1;return de}consumeHex4(L,ne){let de=0;for(;de<4;de++)if(!((ze=L[ne+de])>="0"&&ze<="9"||ze>="a"&&ze<="f"||ze>="A"&&ze<="F")){if(de===0)throw new Error("Invalid hex 4");break}var ze;return ne+de}consumeFQDN(L,ne){let de=ne;for(;S(L[de])||M(L[de])||L[de]==="-"||L[de]===".";)de+=1;if(de-ne<4)throw new Error("Invalid FQDN");return de}consumeExtnAddr(L,ne){return this.consumeOneOrMore(L,ne,I)}consumeMulticastAddress(L,ne,de){switch(de){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(L,ne);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(L,ne);default:try{return this.consumeFQDN(L,ne)}catch{return this.consumeExtnAddr(L,ne)}}}consumeIP6MulticastAddress(L,ne){const de=this.consumeHexpart(L,ne);return L[de]==="/"?this.consumeInteger(L,de+1):de}consumeIP4MulticastAddress(L,ne){let de=ne+3;const ze=L.slice(ne,de),Bt=parseInt(ze);if(Bt<224||Bt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let dr=0;dr<3;dr++){if(L[de]!==".")throw new Error("Invalid IP4 multicast address.");de+=1,de=this.consumeDecimalUChar(L,de)}return L[de]==="/"&&(de+=1),de=this.consumeTTL(L,de),L[de]==="/"&&(de=this.consumeInteger(L,de)),de}consumeInteger(L,ne){if(!V(L[ne]))throw new Error("Invalid integer.");for(ne+=1;S(L[ne]);)ne+=1;return ne}consumeTTL(L,ne){if(L[ne]==="0")return ne+1;if(!V(L[ne]))throw new Error("Invalid TTL.");ne+=1;for(let de=0;de<2&&S(L[ne]);de++)ne+=1;return ne}consumeToken(L,ne){return this.consumeOneOrMore(L,ne,D)}consumeTime(L,ne){let de=ne;if(L[de]==="0")return de+1;for(V(L[de])&&(de+=1);S(L[de]);)de++;if(de-ne<10)throw new Error("Invalid time");return de}consumeAddress(L,ne){return this.consumeTill(L,ne,E)}consumeTypedTime(L,ne){let de=ne;return de=this.consumeOneOrMore(L,de,S),j(L[de])?de+1:de}consumeRepeatInterval(L,ne){if(!V(L[ne]))throw new Error("Invalid repeat interval");for(ne+=1;S(L[ne]);)ne+=1;return j(L[ne])&&(ne+=1),ne}consumePort(L,ne){return this.consumeOneOrMore(L,ne,S)}consume(L,ne,de){for(let ze=0;ze<de.length;ze++){if(ne+ze>=L.length)throw new Error("consume exceeding value length");if(L[ne+ze]!==de[ze])throw new Error("consume ".concat(de," failed at ").concat(ze))}return ne+de.length}consumeTill(L,ne,de){let ze=ne;for(;ze<L.length&&(typeof de!="string"||L[ze]!==de)&&(typeof de!="function"||!de(L[ze]));)ze++;return ze}}class $e extends xe{constructor(){super(),Ce(this,"records",[]),Ce(this,"currentLine",0)}parse(L){const ne=this.probeEOL(L);this.records=L.split(ne).filter(Xh=>!!sa(Xh).call(Xh)).map(this.parseLine),this.currentLine=0;const de=this.parseVersion(),ze=this.parseOrigin(),Bt=this.parseSessionName(),dr=this.parseInformation(),Di=this.parseUri(),kc=this.parseEmail(),Nl=this.parsePhone(),_w=this.parseConnection(),t_=this.parseBandWidth(),gv=this.parseTimeFields(),GI=this.parseKey(),WI=this.parseSessionAttribute(),Lc=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:de,origin:ze,sessionName:Bt,information:dr,uri:Di,emails:kc,phones:Nl,connection:_w,bandwidths:t_,timeFields:gv,key:GI,attributes:WI,mediaDescriptions:Lc}}getCurrentRecord(){const L=this.records[this.currentLine];if(!L)throw new Error("Record doesn't exit.");return L}probeEOL(L){for(let ne=0;ne<L.length;ne++)if(L[ne]===f)return L[ne-1]==="\r"?g:f;throw new Error("Invalid newline character.")}parseLine(L,ne){if(L.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const de=L[0];if(L[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:de,value:L.slice(2),line:ne,cur:0}}parseSessionAttribute(){const L=new Zt;for(;this.currentLine<this.records.length;){const ne=this.getCurrentRecord();if(ne.type!==v.ATTRIBUTE)break;const de={attField:this.extractOneOrMore(ne,ze=>D(ze)&&ze!==":"),_cur:0};ne.value[ne.cur]===":"&&(ne.cur+=1,de.attValue=this.extractOneOrMore(ne,G)),L.parse(de),this.currentLine++}return L.digest()}parseMediaAttributes(L){const ne=new qt(L);for(;this.currentLine<this.records.length;){const de=this.getCurrentRecord();if(de.type!==v.ATTRIBUTE)break;const ze={attField:this.extractOneOrMore(de,Bt=>D(Bt)&&Bt!==":"),_cur:0};de.value[de.cur]===":"&&(de.cur+=1,ze.attValue=this.extractOneOrMore(de,G)),ne.parse(ze),this.currentLine++}return ne.digest()}parseKey(){const L=this.getCurrentRecord();if(L.type===v.KEY){if(L.value==="prompt"||L.value==="clear:"||L.value==="base64:"||L.value==="uri:")return L.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const L=this.getCurrentRecord();if(L.type===v.ZONE_ADJUSTMENTS){const ne=[];for(;;)try{const de=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);let ze=!1;L.value[L.cur]==="-"&&(ze=!0,L.cur+=1);const Bt=this.extract(L,this.consumeTypedTime);ne.push({time:de,typedTime:Bt,back:ze})}catch{break}if(ne.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ne}return[]}parseRepeat(){const L=[];for(;;){const ne=this.getCurrentRecord();if(ne.type!==v.REPEAT)break;{const de=this.extract(ne,this.consumeRepeatInterval),ze=this.parseTypedTime(ne);L.push({repeatInterval:de,typedTimes:ze}),this.currentLine++}}return L}parseTypedTime(L){const ne=[];for(;;)try{this.consumeSpaceForRecord(L),ne.push(this.extract(L,this.consumeTypedTime))}catch{break}if(ne.length===0)throw new Error("Invalid typed time.");return ne}parseTime(){const L=this.getCurrentRecord(),ne=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);const de=this.extract(L,this.consumeTime);return this.currentLine++,{startTime:ne,stopTime:de}}parseBandWidth(){const L=[];for(;this.currentLine<this.records.length;){const ne=this.getCurrentRecord();if(ne.type!==v.BANDWIDTH)break;{const de=this.extractOneOrMore(ne,D);if(ne.value[ne.cur]!==":")throw new Error("Invalid bandwidth field.");ne.cur++;const ze=this.extractOneOrMore(ne,S);L.push({bwtype:de,bandwidth:ze}),this.currentLine++}}return L}parseVersion(){const L=this.getCurrentRecord();if(L.type!==v.VERSION)throw new Error("first sdp record must be version");const ne=L.value.slice(0,this.consumeOneOrMore(L.value,0,S));if(ne.length!==L.value.length)throw new Error('invalid proto version, "v='.concat(L.value,'"'));return this.currentLine++,ne}parseOrigin(){const L=this.getCurrentRecord();if(L.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const ne=this.extractOneOrMore(L,I);this.consumeSpaceForRecord(L);const de=this.extractOneOrMore(L,S);this.consumeSpaceForRecord(L);const ze=this.extractOneOrMore(L,S);this.consumeSpaceForRecord(L);const Bt=this.extractOneOrMore(L,D);this.consumeSpaceForRecord(L);const dr=this.extractOneOrMore(L,D);this.consumeSpaceForRecord(L);const Di=this.extract(L,this.consumeUnicastAddress);return this.currentLine++,{username:ne,sessId:de,sessVersion:ze,nettype:Bt,addrtype:dr,unicastAddress:Di}}parseSessionName(){const L=this.getCurrentRecord();if(L.type===v.SESSION_NAME){const ne=this.extract(L,this.consumeText);return this.currentLine++,ne}}parseInformation(){const L=this.getCurrentRecord();if(L.type!==v.INFORMATION)return;const ne=this.extract(L,this.consumeText);return this.currentLine++,ne}parseUri(){const L=this.getCurrentRecord();if(L.type===v.URI)return this.currentLine++,L.value}parseEmail(){const L=[];for(;;){const ne=this.getCurrentRecord();if(ne.type!==v.EMAIL)break;L.push(ne.value),this.currentLine++}return L}parsePhone(){const L=[];for(;;){const ne=this.getCurrentRecord();if(ne.type!==v.PHONE)break;L.push(ne.value),this.currentLine++}return L}parseConnection(){const L=this.getCurrentRecord();if(L.type===v.CONNECTION){const ne=this.extractOneOrMore(L,D);this.consumeSpaceForRecord(L);const de=this.extractOneOrMore(L,D);this.consumeSpaceForRecord(L);const ze=this.extract(L,this.consumeAddress);return this.currentLine++,{nettype:ne,addrtype:de,address:ze}}}parseMedia(){const L=this.getCurrentRecord(),ne=this.extract(L,this.consumeToken);this.consumeSpaceForRecord(L);let de=this.extract(L,this.consumePort);L.value[L.cur]==="/"&&(L.cur+=1,de+=this.extract(L,this.consumeInteger)),this.consumeSpaceForRecord(L);const ze=[];for(ze.push(this.extract(L,this.consumeToken));L.value[L.cur]==="/";)L.cur+=1,ze.push(this.extract(L,this.consumeToken));if(ze.length===0)throw new Error("Invalid proto");const Bt=this.parseFmt(L);return this.currentLine++,{mediaType:ne,port:de,protos:ze,fmts:Bt}}parseTimeFields(){const L=[];for(;this.getCurrentRecord().type===v.TIME;){const ne=this.parseTime(),de=this.parseRepeat(),ze=this.parseZone();L.push({time:ne,repeats:de,zones:ze})}return L}parseMediaDescription(){const L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const ne=this.parseMedia(),de=this.parseInformation(),ze=this.parseConnections(),Bt=this.parseBandWidth(),dr=this.parseKey(),Di=this.parseMediaAttributes(ne);L.push({media:ne,information:de,connections:ze,bandwidths:Bt,key:dr,attributes:Di})}return L}parseConnections(){const L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)L.push(this.parseConnection());return L}parseFmt(L){const ne=[];for(;;)try{this.consumeSpaceForRecord(L),ne.push(this.extract(L,this.consumeToken))}catch{break}if(ne.length===0)throw new Error("Invalid fmts");return ne}extract(L,ne){for(var de=arguments.length,ze=new Array(de>2?de-2:0),Bt=2;Bt<de;Bt++)ze[Bt-2]=arguments[Bt];const dr=ne.call(this,L.value,L.cur,...ze),Di=L.value.slice(L.cur,dr);return L.cur=dr,Di}extractOneOrMore(L,ne){const de=this.consumeOneOrMore(L.value,L.cur,ne),ze=L.value.slice(L.cur,de);return L.cur=de,ze}consumeSpaceForRecord(L){if(L.value[L.cur]!==E)throw new Error("Invalid space at ".concat(L.cur,"."));L.cur+=1}}class at extends xe{constructor(){super(...arguments),Ce(this,"attributes",void 0),Ce(this,"digested",!1)}extractOneOrMore(L,ne,de){const ze=this.consumeOneOrMore(L.attValue,L._cur,ne),Bt=L.attValue.slice(L._cur,ze),[dr,Di]=de||[];if(typeof dr=="number"&&Bt.length<dr)throw new Error("error in length, should be more or equal than ".concat(dr," characters."));if(typeof Di=="number"&&Bt.length>Di)throw new Error("error in length, should be less or equal than ".concat(Di," characters."));return L._cur=ze,Bt}consumeAttributeSpace(L){if(L.attValue[L._cur]!==E)throw new Error("Invalid space at ".concat(L._cur,"."));L._cur+=1}extract(L,ne){if(!L.attValue)throw new Error("Nothing to extract from attValue.");for(var de=arguments.length,ze=new Array(de>2?de-2:0),Bt=2;Bt<de;Bt++)ze[Bt-2]=arguments[Bt];const dr=ne.call(this,L.attValue,L._cur,...ze),Di=L.attValue.slice(L._cur,dr);return L._cur=dr,Di}atEnd(L){if(!L.attValue)throw new Error;return L._cur>=L.attValue.length}peekChar(L){if(!L.attValue)throw new Error;return L.attValue[L._cur]}peek(L,ne){if(!L.attValue)throw new Error;for(let de=0;de<ne.length;de++)if(ne[de]!==L.attValue[L._cur+de])return!1;return!0}parseIceUfrag(L){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(L,z,[4,256])}parseIcePwd(L){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(L,z,[22,256])}parseIceOptions(L){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ne=[];for(;!this.atEnd(L);){ne.push(this.extractOneOrMore(L,z));try{this.consumeAttributeSpace(L)}catch(de){if(this.atEnd(L))break;throw de}}this.attributes.iceOptions=ne}parseFingerprint(L){const ne=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const de=this.extract(L,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ne,fingerprint:de})}parseExtmap(L){const ne=this.extractOneOrMore(L,S);let de;this.peekChar(L)==="/"&&(this.extract(L,this.consume,"/"),de=this.extract(L,this.consumeToken)),this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeTill,E),Bt=me(me({entry:parseInt(ne,10)},de&&{direction:de}),{},{extensionName:ze});this.peekChar(L)===E&&(this.consumeAttributeSpace(L),Bt.extensionAttributes=this.extract(L,this.consumeTill)),this.attributes.extmaps.push(Bt)}parseSetup(L){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ne=this.extract(L,this.consumeTill);if(ne!=="active"&&ne!=="passive"&&ne!=="actpass"&&ne!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ne}}class Zt extends at{constructor(){super(...arguments),Ce(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"group":this.parseGroup(L);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"fingerprint":this.parseFingerprint(L);break;case"setup":this.parseSetup(L);break;case"tls-id":this.parseTlsId(L);break;case"identity":this.parseIdentity(L);break;case"extmap":this.parseExtmap(L);break;case"msid-semantic":this.parseMsidSemantic(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(ne){throw console.error("parsing session attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),ne}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(L){const ne=this.extract(L,this.consumeToken),de=[];for(;!this.atEnd(L)&&this.peekChar(L)===E;)this.consumeAttributeSpace(L),de.push(this.extract(L,this.consumeToken));this.attributes.groups.push({semantic:ne,identificationTag:de})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(L){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(L,ce)}parseIdentity(L){const ne=this.extractOneOrMore(L,Ee),de=[];for(;!this.atEnd(L)&&this.peekChar(L)===E;){this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeToken);this.extract(L,this.consume,"=");const Bt=this.extractOneOrMore(L,dr=>dr!==E&&G(dr));de.push({name:ze,value:Bt})}this.attributes.identities.push({assertionValue:ne,extensions:de})}parseMsidSemantic(L){this.peekChar(L)===E&&this.consumeAttributeSpace(L);const ne={semantic:this.extract(L,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(L)}catch{break}if(this.peekChar(L)==="*"){this.extract(L,this.consume,"*"),ne.applyForAll=!0;break}{const de=this.extract(L,this.consumeTill,E);ne.identifierList.push(de)}}this.attributes.msidSemantic=ne}}class qt extends at{constructor(L){super(),Ce(this,"attributes",void 0),L.protos.indexOf("RTP")!==-1||L.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"extmap":this.parseExtmap(L);break;case"setup":this.parseSetup(L);break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"candidate":this.parseCandidate(L);break;case"remote-candidate":this.parseRemoteCandidate(L);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(L);break;case"rtpmap":this.parseRtpmap(L);break;case"ptime":this.parsePtime(L);break;case"maxptime":this.parseMaxPtime(L);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(L);break;case"ssrc":this.parseSSRC(L);break;case"fmtp":this.parseFmtp(L);break;case"rtcp-fb":this.parseRtcpFb(L);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(L);break;case"mid":this.parseMid(L);break;case"msid":this.parseMsid(L);break;case"imageattr":this.parseImageAttr(L);break;case"rid":this.parseRid(L);break;case"simulcast":this.parseSimulcast(L);break;case"sctp-port":this.parseSctpPort(L);break;case"max-message-size":this.parseMaxMessageSize(L);break;case"ssrc-group":this.parseSSRCGroup(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(ne){throw console.error("parsing media attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),ne}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}parseCandidate(L){const ne=this.extractOneOrMore(L,z,[1,32]);this.consumeAttributeSpace(L);const de=this.extractOneOrMore(L,S,[1,5]);this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const Bt=this.extractOneOrMore(L,S,[1,10]);this.consumeAttributeSpace(L);const dr=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);const Di=this.extract(L,this.consumePort);this.consumeAttributeSpace(L),this.extract(L,this.consume,"typ"),this.consumeAttributeSpace(L);const kc={foundation:ne,componentId:de,transport:ze,priority:Bt,connectionAddress:dr,port:Di,type:this.extract(L,this.consumeToken),extension:{}};for(this.peek(L," raddr")&&(this.extract(L,this.consume," raddr"),this.consumeAttributeSpace(L),kc.relAddr=this.extract(L,this.consumeAddress)),this.peek(L," rport")&&(this.extract(L,this.consume," rport"),this.consumeAttributeSpace(L),kc.relPort=this.extract(L,this.consumePort));this.peekChar(L)===E;){this.consumeAttributeSpace(L);const Nl=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L),kc.extension[Nl]=this.extractOneOrMore(L,R)}this.attributes.candidates.push(kc)}parseRemoteCandidate(L){const ne=[];for(;;){const de=this.extractOneOrMore(L,S,[1,5]);this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);const Bt=this.extract(L,this.consumePort);ne.push({componentId:de,connectionAddress:ze,port:Bt});try{this.consumeAttributeSpace(L)}catch{break}}this.attributes.remoteCandidatesList.push(ne)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(L){const ne=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const de=this.extract(L,this.consumeTill,"/");this.extract(L,this.consume,"/");const ze={encodingName:de,clockRate:this.extractOneOrMore(L,S)};this.atEnd(L)||this.peekChar(L)!=="/"||(this.extract(L,this.consume,"/"),ze.encodingParameters=parseInt(this.extract(L,this.consumeTill),10));const Bt=this.attributes.payloads.find(dr=>dr.payloadType===parseInt(ne,10));Bt?Bt.rtpMap=ze:this.attributes.payloads.push({payloadType:parseInt(ne,10),rtpMap:ze,rtcpFeedbacks:[]})}parsePtime(L){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(L,this.consumeTill)}parseMaxPtime(L){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(L,this.consumeTill)}parseDirection(L){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=L.attField}parseSSRC(L){const ne=this.extractOneOrMore(L,S);this.consumeAttributeSpace(L);const de=this.extract(L,this.consumeTill,":");let ze;this.peekChar(L)===":"&&(this.extract(L,this.consume,":"),ze=this.extract(L,this.consumeTill));const Bt=this.attributes.ssrcs.find(dr=>dr.ssrcId===parseInt(ne,10));Bt?Bt.attributes[de]=ze:this.attributes.ssrcs.push({ssrcId:parseInt(ne,10),attributes:{[de]:ze}})}parseFmtp(L){const ne=this.extract(L,this.consumeTill,E);this.consumeAttributeSpace(L);const de=this.extract(L,this.consumeTill),ze={};de.split(";").forEach(dr=>{let[Di,kc]=dr.split("=");Di=sa(Di).call(Di);const Nl=typeof kc=="string"?sa(kc).call(kc):null;typeof Di=="string"&&Di.length>0&&(ze[Di]=Nl)});const Bt=this.attributes.payloads.find(dr=>dr.payloadType===parseInt(ne,10));Bt?Bt.fmtp={parameters:ze}:this.attributes.payloads.push({payloadType:parseInt(ne,10),rtcpFeedbacks:[],fmtp:{parameters:ze}})}parseFmtParameters(L){const ne={},de=this.extract(L,this.consumeTill,"=");L._cur++;const ze=this.extract(L,this.consumeTill,";");for(ne[de]=ze;L.attValue[L._cur]===";";){const Bt=this.extract(L,this.consumeTill,"=");L._cur++;const dr=this.extract(L,this.consumeTill,";");ne[Bt]=dr}return ne}parseRtcpFb(L){let ne="";ne=this.peekChar(L)==="*"?this.extract(L,this.consume,"*"):this.extract(L,this.consumeTill,E),this.consumeAttributeSpace(L);const de=this.extract(L,this.consumeTill,E);let ze;if(de==="trr-int")ze={type:de,interval:this.extract(L,this.consumeTill)};else{const Bt={type:de};this.peekChar(L)===E&&(this.consumeAttributeSpace(L),Bt.parameter=this.extract(L,this.consumeToken),this.peekChar(L)===E&&(Bt.additional=this.extract(L,this.consumeTill))),ze=Bt}if(ne==="*")this.attributes.rtcpFeedbackWildcards.push(ze);else{const Bt=this.attributes.payloads.find(dr=>dr.payloadType===parseInt(ne,10));Bt?Bt.rtcpFeedbacks.push(ze):this.attributes.payloads.push({payloadType:parseInt(ne,10),rtcpFeedbacks:[ze]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(L){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ne={port:this.extract(L,this.consumePort)};this.peekChar(L)===E&&(this.consumeAttributeSpace(L),ne.netType=this.extractOneOrMore(L,D),this.consumeAttributeSpace(L),ne.addressType=this.extractOneOrMore(L,D),this.consumeAttributeSpace(L),ne.address=this.extract(L,this.consumeAddress)),this.attributes.rtcp=ne}parseMsid(L){const ne={id:this.extractOneOrMore(L,D,[1,64])};this.peekChar(L)===E&&(this.consumeAttributeSpace(L),ne.appdata=this.extractOneOrMore(L,D,[1,64])),this.attributes.msids.push(ne)}parseImageAttr(L){this.attributes.imageattr.push(L.attValue)}parseRid(L){const ne=this.extractOneOrMore(L,ze=>M(ze)||S(ze)||ze==="_"||ze==="-");this.consumeAttributeSpace(L);const de={id:ne,direction:this.extract(L,this.consumeToken),params:[]};if(this.peekChar(L)===E){if(this.consumeAttributeSpace(L),this.peek(L,"pt=")){this.extract(L,this.consume,"pt=");const ze=[];for(;;){const Bt=this.extract(L,this.consumeToken);ze.push(Bt);try{this.extract(L,this.consume,",")}catch{break}}de.payloads=ze,this.peekChar(L)===E&&this.extract(L,this.consume,E)}for(;;){const ze=this.extract(L,this.consumeToken);switch(ze){case"depend":{const Bt={type:ze,rids:this.extract(L,this.consume,"=").split(",")};de.params.push(Bt);break}default:{const Bt={type:ze};this.peekChar(L)==="="&&(this.extract(L,this.consume,"="),Bt.val=this.extract(L,this.consumeTill,";")),de.params.push(Bt)}}try{this.extract(L,this.consume,";")}catch{break}}}this.attributes.rids.push(de)}parseSimulcast(L){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=L.attValue,this.extract(L,this.consumeTill)}parseSctpPort(L){this.attributes.sctpPort=this.extractOneOrMore(L,S,[1,5])}parseMaxMessageSize(L){this.attributes.maxMessageSize=this.extractOneOrMore(L,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(L){this.attributes.mid=this.extract(L,this.consumeToken)}parseSSRCGroup(L){const ne=this.extract(L,this.consumeToken),de=[];for(;;)try{this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeInteger);de.push(parseInt(ze,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ne,ssrcIds:de})}}function Pt(ke,L,ne){return L in ke?Object.defineProperty(ke,L,{value:ne,enumerable:!0,configurable:!0,writable:!0}):ke[L]=ne,ke}class hr{constructor(){Pt(this,"eol",g)}print(L,ne){let de="";return ne&&(this.eol=ne),de+=this.printVersion(L.version),de+=this.printOrigin(L.origin),de+=this.printSessionName(L.sessionName),de+=this.printInformation(L.information),de+=this.printUri(L.uri),de+=this.printEmail(L.emails),de+=this.printPhone(L.phones),de+=this.printConnection(L.connection),de+=this.printBandwidth(L.bandwidths),de+=this.printTimeFields(L.timeFields),de+=this.printKey(L.key),de+=this.printSessionAttributes(L.attributes),de+=this.printMediaDescription(L.mediaDescriptions),de}printVersion(L){return"v=".concat(L).concat(this.eol)}printOrigin(L){return"o=".concat(L.username," ").concat(L.sessId," ").concat(L.sessVersion," ").concat(L.nettype," ").concat(L.addrtype," ").concat(L.unicastAddress).concat(this.eol)}printSessionName(L){return L?"s=".concat(L).concat(this.eol):""}printInformation(L){return L?"i=".concat(L).concat(this.eol):""}printUri(L){return L?"u=".concat(L).concat(this.eol):""}printEmail(L){let ne="";for(const de of L)ne+="e=".concat(de).concat(this.eol);return ne}printPhone(L){let ne="";for(const de of L)ne+="e=".concat(de).concat(this.eol);return ne}printConnection(L){return L?"c=".concat(L.nettype," ").concat(L.addrtype," ").concat(L.address).concat(this.eol):""}printBandwidth(L){let ne="";for(const de of L)ne+="b=".concat(de.bwtype,":").concat(de.bandwidth).concat(this.eol);return ne}printTimeFields(L){let ne="";for(const de of L){ne+="t=".concat(de.time.startTime," ").concat(de.time.startTime).concat(this.eol);for(const ze of de.repeats)ne+="r=".concat(ze.repeatInterval," ").concat(ze.typedTimes.join(" ")).concat(this.eol);de.zoneAdjustments&&(ne+="z=",ne+="z=".concat(de.zoneAdjustments.map(ze=>"".concat(ze.time," ").concat(ze.back?"-":""," ").concat(ze.typedTime)).join(" ")).concat(this.eol),ne+=this.eol)}return ne}printKey(L){return L?"k=".concat(L).concat(this.eol):""}printAttributes(L){let ne="";for(const de of L)ne+="a=".concat(de.attField).concat(de.attValue?":".concat(de.attValue):"").concat(this.eol);return ne}printMediaDescription(L){let ne="";for(const de of L)ne+=this.printMedia(de.media),ne+=this.printInformation(de.information),ne+=this.printConnections(de.connections),ne+=this.printBandwidth(de.bandwidths),ne+=this.printKey(de.key),ne+=this.printMediaAttributes(de);return ne}printConnections(L){let ne="";for(const de of L)ne+=this.printConnection(de);return ne}printMedia(L){return"m=".concat(L.mediaType," ").concat(L.port," ").concat(L.protos.join("/")," ").concat(L.fmts.join(" ")).concat(this.eol)}printSessionAttributes(L){return new ja(this.eol).print(L)}printMediaAttributes(L){return new Pe(this.eol).print(L)}}class er{constructor(L){Pt(this,"eol",void 0),this.eol=L}printIceUfrag(L){return L===void 0?"":"a=ice-ufrag:".concat(L).concat(this.eol)}printIcePwd(L){return L===void 0?"":"a=ice-pwd:".concat(L).concat(this.eol)}printIceOptions(L){return L===void 0?"":"a=ice-options:".concat(L.join(E)).concat(this.eol)}printFingerprints(L){return L.length>0?L.map(ne=>"a=fingerprint:".concat(ne.hashFunction).concat(E).concat(ne.fingerprint)).join(this.eol)+this.eol:""}printExtmap(L){return L.map(ne=>"a=extmap:".concat(ne.entry).concat(ne.direction?"/".concat(ne.direction):"").concat(E).concat(ne.extensionName).concat(ne.extensionAttributes?"".concat(E).concat(ne.extensionAttributes):"").concat(this.eol)).join("")}printSetup(L){return L===void 0?"":"a=setup:".concat(L).concat(this.eol)}printUnrecognized(L){return L.map(ne=>"a=".concat(ne.attField).concat(ne.attValue?":".concat(ne.attValue):"").concat(this.eol)).join("")}}class ja extends er{print(L){let ne="";return ne+=this.printGroups(L.groups),ne+=this.printMsidSemantic(L.msidSemantic),ne+=this.printIceLite(L.iceLite),ne+=this.printIceUfrag(L.iceUfrag),ne+=this.printIcePwd(L.icePwd),ne+=this.printIceOptions(L.iceOptions),ne+=this.printFingerprints(L.fingerprints),ne+=this.printSetup(L.setup),ne+=this.printTlsId(L.tlsId),ne+=this.printIdentity(L.identities),ne+=this.printExtmap(L.extmaps),ne+=this.printUnrecognized(L.unrecognized),ne}printGroups(L){let ne="";return L.length>0&&(ne+=L.map(de=>"a=group:".concat(de.semantic).concat(de.identificationTag.map(ze=>"".concat(E).concat(ze)).join("")).concat(this.eol)).join("")),ne}printIceLite(L){return L===void 0?"":"a=ice-lite"+this.eol}printTlsId(L){return L?"a=tls-id:".concat(L).concat(this.eol):""}printIdentity(L){return L.length===0?"":L.map(ne=>"a=identity:".concat(ne.assertionValue).concat(ne.extensions.map(de=>"".concat(E).concat(de.name).concat(de.value?"=".concat(de.value):"")))).join(this.eol)+this.eol}printMsidSemantic(L){if(!L)return"";let ne="a=msid-semantic:".concat(L.semantic);return L.applyForAll?ne+="".concat(E,"*"):L.identifierList.length>0&&(ne+=L.identifierList.map(de=>"".concat(E).concat(de))),ne+this.eol}}class Pe extends er{print(L){const ne=L.attributes;let de="";return de+=this.printRTCP(ne.rtcp),de+=this.printIceUfrag(ne.iceUfrag),de+=this.printIcePwd(ne.icePwd),de+=this.printIceOptions(ne.iceOptions),de+=this.printCandidates(ne.candidates),de+=this.printRemoteCandidatesList(ne.remoteCandidatesList),de+=this.printEndOfCandidates(ne.endOfCandidates),de+=this.printFingerprints(ne.fingerprints),de+=this.printSetup(ne.setup),de+=this.printMid(ne.mid),de+=this.printExtmap(ne.extmaps),de+=this.printRTPRelated(ne),de+=this.printPtime(ne.ptime),de+=this.printMaxPtime(ne.maxPtime),de+=this.printDirection(ne.direction),de+=this.printSSRCGroups(ne.ssrcGroups),de+=this.printSSRC(ne.ssrcs),de+=this.printRTCPMux(ne.rtcpMux),de+=this.printRTCPMuxOnly(ne.rtcpMuxOnly),de+=this.printRTCPRsize(ne.rtcpRsize),de+=this.printMSId(ne.msids),de+=this.printImageattr(ne.imageattr),de+=this.printRid(ne.rids),de+=this.printSimulcast(ne.simulcast),de+=this.printSCTPPort(ne.sctpPort),de+=this.printMaxMessageSize(ne.maxMessageSize),de+=this.printUnrecognized(ne.unrecognized),de}printCandidates(L){return L.map(ne=>"a=candidate:".concat(ne.foundation).concat(E).concat(ne.componentId).concat(E).concat(ne.transport).concat(E).concat(ne.priority).concat(E).concat(ne.connectionAddress).concat(E).concat(ne.port).concat(E,"typ").concat(E).concat(ne.type).concat(ne.relAddr?"".concat(E,"raddr").concat(E).concat(ne.relAddr):"").concat(ne.relPort?"".concat(E,"rport").concat(E).concat(ne.relPort):"").concat(Object.keys(ne.extension).map(de=>"".concat(E).concat(de).concat(E).concat(ne.extension[de])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(L){return L.map(ne=>"a=remote-candidates:".concat(ne.join(E)).concat(this.eol)).join("")}printEndOfCandidates(L){return L===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(L){if(!L.payloads)return"";const ne=L.payloads;let de="";de+=L.rtcpFeedbackWildcards.map(ze=>this.printRTCPFeedback("*",ze)).join("");for(const ze of ne)de+=this.printRtpMap(ze.payloadType,ze.rtpMap),de+=this.printFmtp(ze.payloadType,ze.fmtp),de+=ze.rtcpFeedbacks.map(Bt=>this.printRTCPFeedback(ze.payloadType,Bt)).join("");return de}printFmtp(L,ne){if(!ne)return"";const de=Object.keys(ne.parameters);return de.length===1&&ne.parameters[de[0]]===null?"a=fmtp:".concat(L).concat(E).concat(de[0]).concat(this.eol):"a=fmtp:".concat(L).concat(E).concat(Object.keys(ne.parameters).map(ze=>"".concat(ze,"=").concat(ne.parameters[ze])).join(";")).concat(this.eol)}printRtpMap(L,ne){return ne?"a=rtpmap:".concat(L).concat(E).concat(ne.encodingName,"/").concat(ne.clockRate).concat(ne.encodingParameters?"/".concat(ne.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(L,ne){let de="a=rtcp-fb:".concat(L).concat(E),ze=ne;return ze.type==="trr-int"?de+="ttr-int".concat(E).concat(ze.interval):(de+="".concat(ze.type),ze.parameter&&(de+="".concat(E).concat(ze.parameter),ze.additional&&(de+="".concat(E).concat(ze.additional)))),de+this.eol}printPtime(L){return L===void 0?"":"a=ptime:".concat(L).concat(this.eol)}printMaxPtime(L){return L===void 0?"":"a=maxptime:".concat(L).concat(this.eol)}printDirection(L){return L===void 0?"":"a=".concat(L).concat(this.eol)}printSSRC(L){return L.map(ne=>Object.keys(ne.attributes).map(de=>"a=ssrc:".concat(ne.ssrcId.toString(10)).concat(E).concat(de).concat(ne.attributes[de]?":".concat(ne.attributes[de]):"").concat(this.eol)).join("")).join("")}printRTCPMux(L){return L===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(L){return L===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(L){return L===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(L){if(L===void 0)return"";let ne="a=rtcp:".concat(L.port);return L.netType&&(ne+="".concat(E).concat(L.netType)),L.addressType&&(ne+="".concat(E).concat(L.addressType)),L.address&&(ne+="".concat(E).concat(L.address)),ne+this.eol}printMSId(L){return L.map(ne=>"a=msid:".concat(ne.id).concat(ne.appdata?"".concat(E).concat(ne.appdata):"").concat(this.eol)).join("")}printImageattr(L){return L.map(ne=>"a=imageattr:".concat(ne).concat(this.eol)).join("")}printRid(L){return L.map(ne=>{let de="a=rid:".concat(ne.id).concat(E).concat(ne.direction);return ne.payloads&&(de+="".concat(E,"pt=").concat(ne.payloads.join(","))),ne.params.length>0&&(de+="".concat(E).concat(ne.params.map(ze=>ze.type==="depend"?"depend=".concat(ze.rids.join(",")):"".concat(ze.type,"=").concat(ze.val)).join(";"))),de+this.eol}).join("")}printSimulcast(L){return L===void 0?"":"a=simulcast:".concat(L).concat(this.eol)}printSCTPPort(L){return L===void 0?"":"a=sctp-port:".concat(L).concat(this.eol)}printMaxMessageSize(L){return L===void 0?"":"a=max-message-size:".concat(L).concat(this.eol)}printMid(L){return L===void 0?"":"a=mid:".concat(L).concat(this.eol)}printSSRCGroups(L){return L.map(ne=>"a=ssrc-group:".concat(ne.semantic).concat(ne.ssrcIds.map(de=>"".concat(E).concat(de.toString(10))).join("")).concat(this.eol)).join("")}}function Ye(ke){return new $e().parse(ke)}function pt(ke,L){return new hr().print(ke,L)}}},t={};function r(o){if(t[o])return t[o].exports;var c=t[o]={exports:{}};return e[o](c,c.exports,r),c.exports}return r.d=(o,c)=>{for(var u in c)r.o(c,u)&&!r.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},r.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),r.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},r(8)})();function to(e){return s4.parse(e)}function vf(e,t){return s4.print(e,t)}var sne=vo("Array","keys"),ane=Wl,one=ci,cne=U,lne=sne,kk=Array.prototype,dne={DOMTokenList:!0,NodeList:!0},une=function(e){var t=e.keys;return e===kk||cne(kk,e)&&t===kk.keys||one(dne,ane(e))?lne:t},Zo=l(une);function Gr(e,t,r){return(t=function(o){var c=function(u,f){if(typeof u!="object"||!u)return u;var g=u[Symbol.toPrimitive];if(g!==void 0){var E=g.call(u,"string");if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Jt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?a4(Object(r),!0).forEach(function(o){Gr(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a4(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const o4=new class extends Dr{constructor(){super(...arguments),Gr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class hne{constructor(t){Gr(this,"logger",void 0),Gr(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];this.logger.debug(...this.prefixLists,...r)}info(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];this.logger.info(...this.prefixLists,...r)}warning(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];this.logger.warning(...this.prefixLists,...r)}error(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];this.logger.error(...this.prefixLists,...r)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function Lk(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function c4(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Ic={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},LA=Date.now(),Pb=e=>{for(const t in Ic)if(Object.prototype.hasOwnProperty.call(Ic,t)&&Ic[t]===e)return t;return"DEFAULT"},x=new class{constructor(){Gr(this,"proxyServerURL",void 0),Gr(this,"logLevel",Ic.DEBUG),Gr(this,"uploadState","collecting"),Gr(this,"uploadLogWaitingList",[]),Gr(this,"uploadLogUploadingList",[]),Gr(this,"uploadErrorCount",0),Gr(this,"currentLogID",0),Gr(this,"url",void 0),Gr(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const o=[Ic.DEBUG].concat(t);this.log.apply(this,o)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const o=[Ic.INFO].concat(t);this.log.apply(this,o)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const o=[Ic.WARNING].concat(t);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const o=[Ic.ERROR].concat(t);this.log.apply(this,o)}upload(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const o=[Ic.DEBUG].concat(t);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){qn("UPLOAD_LOG",!0)}disableLogUpload(){qn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new hne(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-LA<100)return void setTimeout(()=>{this.log(...t)},Date.now()-LA);const o=Math.max(0,Math.min(4,t[0]));if(t[0]=Lk()+" Agora-SDK [".concat(Pb(o),"]:"),this.appendLogToWaitingList(o,...t),o<this.logLevel)return;const c=Lk()+" %cAgora-SDK [".concat(Pb(o),"]:");let u=[];if(!Z("USE_NEW_LOG"))switch(o){case Ic.DEBUG:u=[c,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,u);break;case Ic.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,u);break;case Ic.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,u);break;case Ic.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-LA<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-LA);const o=Math.max(0,Math.min(4,t[0]));t[0]=Lk()+" Agora-SDK [".concat(Pb(o),"]:"),this.appendLogToWaitingList(o,...t)}appendLogToWaitingList(e){if(!Z("UPLOAD_LOG"))return;for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];Array.isArray(r[0])?r[0][0]=c4()+" Agora-SDK [".concat(Pb(e),"]:"):r[0]=c4()+" Agora-SDK [".concat(Pb(e),"]:");let c="";r.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Ac,process_id:Z("PROCESS_ID"),payload:JSON.stringify(e)};return ld(async()=>{const r=await xa.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(Z("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Z("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(r.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=r,o}},()=>(this.uploadLogUploadingList=[],!1),r=>{const o={status:-1,message:r.message,errorRange:e.map(c=>c.log_item_id)};return r.response?(o.status=r.response.status,o.data=r.response.data,o.headers=r.response.headers):r.request&&(o.status=r.request.status),o4.reportLogUploadError(o),!0},{timeout:Z("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:Z("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,Z("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),Z("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),Z("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),Z("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var l4;function pne(e){return rs(e.reportId,"params.reportId",0,100,!1),rs(e.category,"params.category",0,100,!1),rs(e.event,"params.event",0,100,!1),rs(e.label,"params.label",0,100,!1),Jn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(l4={}).FREE="free",l4.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const fne={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Bi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Ir=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let mne=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Nt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,r,o){const c=o.value;if(typeof c=="function"){const u=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);o.value=function(){for(var f,g=arguments.length,E=new Array(g),v=0;v<g;v++)E[v]=arguments[v];let S=E;if(e.argsMap)try{S=e.argsMap(this,...E)}catch(I){x.warning(I),S=[]}try{JSON.stringify(S)}catch{x.warning("arguments for method ".concat(u,".").concat(String(r)," not serializable for apiInvoke.")),S=[]}const R=(e.report||vt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((f=this.store)===null||f===void 0?void 0:f.clientId)||this._ID,name:"".concat(u,".").concat(String(r)),options:S,tag:Hr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const I=c.apply(this,E);return I instanceof nt?I.then(D=>(R.onSuccess(e.reportResult&&D),D)).catch(D=>{throw R.onError(D),D}):(R.onSuccess(e.reportResult&&I),I)}catch(I){throw R.onError(I),I}}}return o}}const vt=new class{constructor(){Gr(this,"baseInfoMap",new Map),Gr(this,"proxyServer",void 0),Gr(this,"eventUploadTimer",void 0),Gr(this,"setSessionIdTimer",void 0),Gr(this,"url",void 0),Gr(this,"sids",new Set),Gr(this,"backupUrl",void 0),Gr(this,"_appId",void 0),Gr(this,"_aid",0),Gr(this,"keyEventUploadPendingItems",[]),Gr(this,"normalEventUploadPendingItems",[]),Gr(this,"apiInvokeUploadPendingItems",[]),Gr(this,"apiInvokeCount",0),Gr(this,"apiInvokeLoggedCount",0),Gr(this,"ltsList",[]),Gr(this,"lastSendNormalEventTime",Date.now()),Gr(this,"customReportCounterTimer",void 0),Gr(this,"customReportCount",0),Gr(this,"extApiInvoke",async e=>{for(const t of e){const r=Jt(Jt({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Hr.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),Z("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),Z("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[r,o]=t;return r+o}),16)||0}reportApiInvoke(e,t,r){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!Z("SHOW_REPORT_INVOKER_LOG"),f=!!Z("SHOW_REPORT_USER_INVOKER_LOG"),g=u||f&&t.id;g&&(this.apiInvokeLoggedCount+=1);const E=this.apiInvokeLoggedCount;function v(D,V){if(g){let M="[apiInvoke-".concat(E,"]");if(t.id&&(M+="[".concat(t.id,"]")),t.name&&(M+="[".concat(t.name,"]"),t.name===di.JOIN))return x.info("".concat(M," ").concat(D));x.info("".concat(M," ").concat(D),D==="start"?t.options:V||"")}}const S=()=>({tag:t.tag,invokeId:c,sid:e,name:t.name,apiInvokeTime:o,options:t.options,states:t.states||null});v("start");let R=!1;is(t.timeout).then(()=>{R||(this.sendApiInvoke(Jt(Jt({},S()),{},{error:q.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const I=new Ae(q.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:D=>{const V=()=>{if(R)throw I;return R=!0,this.sendApiInvoke(Jt(Jt({},S()),{},{success:!0},t.reportResult&&{result:D})),v("onSuccess"),D};return r?H3(V,t.name+"Success",r,()=>R=!0):V()},onError:D=>{const V=()=>{if(R)throw D;R=!0,this.sendApiInvoke(Jt(Jt({},S()),{},{success:!1,error:D})),v("onFailure",D.toString())};return r?H3(V,t.name+"Error",r,()=>R=!0):V()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const r=Date.now(),o=this.createBaseInfo(e,r);o.cname=t.cname;const c=Object.assign({},{willUploadConsoleLog:Z("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Ok?"global":"oversea",areas:Z("AREAS")&&Z("AREAS").join(",")},t.extend),{stringUid:u,channelProfile:f,channelMode:g,isABTestSuccess:E,lsid:v,clientRole:S}=t,R=Date.now(),I=Jt(Jt({},o),{},{eventType:Bi.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:xk,lts:R,elapse:R-r,extend:JSON.stringify(c),mode:t.mode,process:Z("PROCESS_ID"),appType:Z("APP_TYPE"),success:!0,version:Ac,stringUid:u,channelProfile:f,channelMode:g,isABTestSuccess:E,lsid:v,clientType:et(D=window.navigator.userAgent).call(D,"AgoraWebView")?42:20,clientRole:S,serviceId:Z("PROCESS_ID"),extensionID:Z("PLUGIN_INFO").join(",")||""});var D;this.send({type:Ir.SESSION,data:I},!0)}joinChooseServer(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=Jt(Jt({},o),{},{role:t.role,eventType:Bi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:t.elapse||c-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:c-r.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:Ir.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=Jt(Jt({},o),{},{eventType:Bi.REQ_USER_ACCOUNT,lts:c,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||c-r.startTime,eventElapse:c-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Ir.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info;t.vid&&(o.vid=t.vid),o.uid=t.uid,o.cid=t.cid;const c=Date.now(),{firstSuccess:u,addr:f,isProxy:g}=t,E=c-r.startTime,v=Jt(Jt({},o),{},{eventType:Bi.JOIN_GATEWAY,lts:c,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:E,eventElapse:c-t.lts,firstSuccess:u,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:Nk(),isABTestSuccess:t.isABTestSuccess?1:0}),S=v.success?1:0;if(t.succ&&(r.lastJoinSuccessTime=c),u)this.send({type:Ir.JOIN_GATEWAY,data:v},!0);else{let R;if(f)if(g){const D=f.match(/h=(\d{1,3}-){3}\d{1,3}/g),V=f.match(/p=[0-9]{1,6}/g);R={isSuccess:S,gatewayIp:D&&D.length?D[0].split("=")[1].replace(/-/g,"."):"",port:V&&V.length?V[0].split("=")[1]:"",isProxy:g?1:0}}else{const D=f.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),V=f.match(/(:|p=)[0-9]{1,6}/g);R={isSuccess:S,gatewayIp:D&&D.length?D[0].split("//")[1].replace(/-/g,"."):"",port:V&&V.length?V[0].split(/:|p=/g)[1]:"",isProxy:g?1:0}}else R={isSuccess:S,gatewayIp:"",port:"",isProxy:g?1:0};delete v.success,delete v.eventType,delete v.firstSuccess,v.vid=Number(v.vid);const I=Object.assign({},v,R,{eventType:Bi.REJOIN_GATEWAY});this.send({type:Ir.RE_JOIN_GATEWAY,data:I},!0)}}joinChannelTimeout(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=Date.now(),c=Jt(Jt({},r.info),{},{lts:o,timeout:t,elapse:o-r.startTime});this.send({type:Ir.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=Jt(Jt({},o),{},{eventType:Bi.PUBLISH,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Ir.PUBLISH,data:u},!0)}subscribe(e,t,r){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,u=Date.now(),f=Jt(Jt({},c),{},{eventType:Bi.SUBSCRIBE,lts:u,eventElapse:t.eventElapse,elapse:u-o.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?f.peerSuid=t.peerid:f.peer=t.peerid,this.send({type:Ir.SUBSCRIBE,data:f},!0)}wsCompressorInit(e){var t;const r=[...Zo(t=this.baseInfoMap).call(t)],o=r.length?r[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,f=Date.now(),g=Jt(Jt({},u),{},{eventType:Bi.WS_COMPRESSOR_INIT,lts:f,eventElapse:e.eventElapse,elapse:f-c.startTime,status:e.status?1:2});this.send({type:Ir.WS_COMPRESSOR_INIT,data:g},!0)}firstRemoteVideoDecode(e,t,r,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,f=Date.now(),g=Jt(Jt(Jt({},u),o),{},{elapse:f-c.startTime,eventType:t,lts:f,firstDecodeFrame:Math.max((o.firstFrame||f)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:r,data:g},!0)}firstRemoteFrame(e,t,r,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,f=Date.now(),g=Jt(Jt(Jt({},u),o),{},{elapse:f-c.startTime,eventType:t,lts:f});this.send({type:r,data:g},!0)}abTest(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=Jt(Jt(Jt({},o),t),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-r.startTime,eventType:Bi.AB_TEST,lts:c});this.send({type:Ir.AB_TEST,data:u},!0)}pcStats(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=Jt(Jt(Jt({},o),t),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-r.startTime,eventType:Bi.PC_STATS,lts:c,preallocation:t.preallocation?1:0});this.send({type:Ir.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,t){if(e){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=Jt(Jt(Jt({},o),t),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Bi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Ir.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,t,r,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,f=Date.now(),g=Jt(Jt(Jt({},u),o),{},{eventType:t,lts:f});this.send({type:r,data:g},!0)}streamSwitch(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=Jt(Jt({},o),{},{eventType:Bi.STREAM_SWITCH,lts:c,isDual:t.isdual,elapse:c-r.startTime,success:t.succ});this.send({type:Ir.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=Jt(Jt({},o),{},{eventType:Bi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-t.lts,elapse:c-r.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Ir.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=Jt(Jt({},o),{},{eventType:Bi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-t.lts,elapse:c-r.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Ir.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?x.debug("reportProxyServerurl: ".concat(e)):x.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=Jt(Jt({},o),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:c,elapse:c-r.startTime,joinChannelSuccessElapse:c-(r.lastJoinSuccessTime||c),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Ir.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now();(function(u,f,g){const E=u[f];if(!E||typeof E!="string")return[u];u[f]="";const v=lu(JSON.stringify(u));let S=0;const R=[];let I=0;for(let D=0;D<E.length;D++)I+=E.charCodeAt(D)<=127?1:3,I<=g-v||(R[R.length]=dt(dt({},u),{},{[f]:E.substring(S,D)}),S=D,I=E.charCodeAt(D)<=127?1:3);return S!==E.length-1&&(R[R.length]=dt(dt({},u),{},{[f]:E.substring(S)})),R})(Jt(Jt(Jt({},o),t),{},{elapse:c-r.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Ir.WORKER_EVENT,data:u},!0))}apworkerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=Jt(Jt(Jt({},o),t),{},{elapse:c-r.startTime,lts:c});this.send({type:Ir.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=Jt(Jt(Jt({},o),t),{},{elapse:c-r.startTime,lts:c,extend:t.extend||void 0});this.send({type:Ir.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=Jt(Jt(Jt({},o),t),{},{elapse:c-r.startTime,lts:c});this.send({type:Ir.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>Z("CUSTOM_REPORT_LIMIT"))throw new Ae(q.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const r=Date.now(),o=t.map(c=>({type:Ir.USER_ANALYTICS,data:Jt(Jt({sid:e},c),{},{lts:r})}));try{Z("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw x.error("send custom report message failed",c.toString()),new Ae(q.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const t=Z("NOT_REPORT_EVENT");if(e.tag&&et(t)&&et(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const r=this.baseInfoMap.get(e.sid);if(!r)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:c,cid:u}=r.info;let f;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Ae){const{code:E,message:v}=e.error;f=E||v||e.error.toString()}else f=e.error.toString();const g={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-r.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?f:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Ir.API_INVOKE,data:g},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(r=>r!==null);t&&e.forEach(r=>{r&&(r.sid=t,this.sendApiInvoke(Object.assign({},r)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>Z("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const r=[],o=[];for(;e.length;){const u=e.shift();r.length<20?r.push(u):o.push(u)}e.push(...o);for(const u of[...r]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),Ft(c=this.ltsList).call(c,(f,g)=>f-g))}return t||(this.lastSendNormalEventTime=Date.now()),Z("ENABLE_EVENT_REPORT")&&r.length&&(Z("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((u=>f=>{Z("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>Z("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-Z("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(r)),e}async postDataToStatsCollector2(e){ui.networkState===Oo.OFFLINE&&await nt.race([ui.onlineWaiter,is(2*Si.maxRetryTimeout)]);const t=c=>{let u=new Uint8Array;return c.forEach(f=>{const g=gk(JSON.stringify(f.data)),E=new ArrayBuffer(5),v=(R=>{let I=0;return Object.entries(Ir).forEach(D=>{let[V,M]=D;M===R.type&&(I=mne[V])}),I})(f),S=new DataView(E);S.setUint16(0,g.byteLength,!0),S.setUint8(2,255&v),S.setUint8(3,v>>>8&255),S.setUint8(4,v>>>16&255),u=P3(u,new Uint8Array(E)),u=P3(u,g)}),u},r="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(Z("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(Z("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await wk(o,{timeout:1e4,data:t(e),headers:Jt(Jt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=(g=>{const E=g&&g.data.sid&&this.baseInfoMap.get(g.data.sid);return E&&E.info.vid&&+E.info.vid||0})(e[0]),o=r?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(g=>JSON.stringify(g)),vid:r,aid:o};ui.networkState===Oo.OFFLINE&&await nt.race([ui.onlineWaiter,is(2*Si.maxRetryTimeout)]);const u=t?"/events/proto-raws":"/events/messages";let f=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("EVENT_REPORT_DOMAIN"),"&p=").concat(Z("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(Z("EVENT_REPORT_DOMAIN"),":").concat(Z("STATS_COLLECTOR_PORT")).concat(u));for(let g=0;g<2;g+=1){g===1&&(f=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(Z("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(Z("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(Z("STATS_COLLECTOR_PORT")).concat(u)));try{t?await ene(f,{timeout:1e4,data:c}):await wk(f,{timeout:1e4,data:c})}catch(E){if(g===1)throw E;continue}return}}createBaseInfo(e,t){const r=Object.assign({},fne);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:t}),r}reportResourceTiming(e,t){const r=performance.getEntriesByName(e),o=r[r.length-1];o&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:o,tag:Hr.TRACER}).onSuccess()}};o4.on("REPORT_LOG_UPLOAD",e=>{e.networkState=ui.networkState,vt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Hr.TRACER}).onSuccess("logUploadError")});class Te extends Ae{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Gr(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,x)}throw(){super.throw(x)}}const ss={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function In(){return ss}function d4(){return"setSinkId"in HTMLAudioElement.prototype&&(!Z("RESTRICTION_SET_PLAYBACK_DEVICE")||(Mh()||S3())&&!pk())}function u4(){return!ss.supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&jh()}let as=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Uy(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function Nn(e,t,r,o,c){return{width:e,height:t,frameRate:r,bitrateMin:o,bitrateMax:c}}function _l(e,t,r,o,c){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:o,bitrateMax:c}}function Mk(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const gne={"90p":Nn(160,90),"90p_1":Nn(160,90),"120p":Nn(160,120,15,30,65),"120p_1":Nn(160,120,15,30,65),"120p_3":Nn(120,120,15,30,50),"120p_4":Nn(212,120),"180p":Nn(320,180,15,30,140),"180p_1":Nn(320,180,15,30,140),"180p_3":Nn(180,180,15,30,100),"180p_4":Nn(240,180,15,30,120),"240p":Nn(320,240,15,40,200),"240p_1":Nn(320,240,15,40,200),"240p_3":Nn(240,240,15,40,140),"240p_4":Nn(424,240,15,40,220),"360p":Nn(640,360,15,80,400),"360p_1":Nn(640,360,15,80,400),"360p_3":Nn(360,360,15,80,260),"360p_4":Nn(640,360,30,80,600),"360p_6":Nn(360,360,30,80,400),"360p_7":Nn(480,360,15,80,320),"360p_8":Nn(480,360,30,80,490),"360p_9":Nn(640,360,15,80,800),"360p_10":Nn(640,360,24,80,800),"360p_11":Nn(640,360,24,80,1e3),"480p":Nn(640,480,15,100,500),"480p_1":Nn(640,480,15,100,500),"480p_2":Nn(640,480,30,100,1e3),"480p_3":Nn(480,480,15,100,400),"480p_4":Nn(640,480,30,100,750),"480p_6":Nn(480,480,30,100,600),"480p_8":Nn(848,480,15,100,610),"480p_9":Nn(848,480,30,100,930),"480p_10":Nn(640,480,10,100,400),"720p":Nn(1280,720,15,120,1130),"720p_auto":Nn(1280,720,30,900,3e3),"720p_1":Nn(1280,720,15,120,1130),"720p_2":Nn(1280,720,30,120,2e3),"720p_3":Nn(1280,720,30,120,1710),"720p_5":Nn(960,720,15,120,910),"720p_6":Nn(960,720,30,120,1380),"1080p":Nn(1920,1080,15,120,2080),"1080p_1":Nn(1920,1080,15,120,2080),"1080p_2":Nn(1920,1080,30,120,3e3),"1080p_3":Nn(1920,1080,30,120,3150),"1080p_5":Nn(1920,1080,60,120,4780),"1440p":Nn(2560,1440,30,120,4850),"1440p_1":Nn(2560,1440,30,120,4850),"1440p_2":Nn(2560,1440,60,120,7350),"4k":Nn(3840,2160,30,120,8910),"4k_1":Nn(3840,2160,30,120,8910),"4k_3":Nn(3840,2160,60,120,13500)},_ne={"480p":_l(640,480,5),"480p_1":_l(640,480,5),"480p_2":_l(640,480,30),"480p_3":_l(640,480,15),"720p":_l(1280,720,5),"720p_auto":Nn(1280,720,30,900,3e3),"720p_1":_l(1280,720,5),"720p_2":_l(1280,720,30),"720p_3":_l(1280,720,15),"1080p":_l(1920,1080,5),"1080p_1":_l(1920,1080,5),"1080p_2":_l(1920,1080,30),"1080p_3":_l(1920,1080,15)},Ene={"1SL1TL":Mk(1,1),"3SL3TL":Mk(3,3),"2SL3TL":Mk(2,3)};function El(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},gne[e]):e}function jk(e){return typeof e=="string"?Object.assign({},_ne[e]):e}function MA(e){return typeof e=="string"?Object.assign({},Ene[e]):e}const yne={speech_low_quality:Uy(16e3,!1),speech_standard:Uy(32e3,!1,18),music_standard:Uy(48e3,!1),standard_stereo:Uy(48e3,!0,56),high_quality:Uy(48e3,!1,128),high_quality_stereo:Uy(48e3,!0,192)};function jA(e){return typeof e=="string"?Object.assign({},yne[e]):e}const Vy=[];function h4(e){return ki(e,"mediaSource",["screen","window","application"]),!0}let ft=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Zn=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Fy=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),vne=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Sne=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),Mg=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),By=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Hy=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Gy=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),ec=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const Uk={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Vk={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},p4={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Tne={uplinkNetworkQuality:0,downlinkNetworkQuality:0},f4={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ga=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),tc=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),kb=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),jg=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Js=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),uu=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const Fk={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let UA=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function vn(e,t,r,o,c){var u,f,g={};return Object.keys(o).forEach(function(E){g[E]=o[E]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=Xa(u=cE(f=r.slice()).call(f)).call(u,function(E,v){return v(e,t,E)||E},g),c&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(c):void 0,g.initializer=void 0),g.initializer===void 0?(Object.defineProperty(e,t,g),null):g}function Se(e,t,r){return(t=function(o){var c=function(u,f){if(typeof u!="object"||!u)return u;var g=u[Symbol.toPrimitive];if(g!==void 0){var E=g.call(u,"string");if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Nr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?m4(Object(r),!0).forEach(function(o){Se(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m4(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class g4 extends Dr{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Mg.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,r){super(),Se(this,"trackMediaType",void 0),Se(this,"_ID",void 0),Se(this,"_rtpTransceiver",void 0),Se(this,"_lowRtpTransceiver",void 0),Se(this,"_hints",[]),Se(this,"_isClosed",!1),Se(this,"_originMediaStreamTrack",void 0),Se(this,"mediaStreamTrack",void 0),Se(this,"_external",{}),this._ID=r||lr(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(o){et(Vy).call(Vy,o)||Vy.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Ef(()=>{var r;vt.reportApiInvoke(null,{name:di.GET_MEDIA_STREAM_TRACK,options:[],tag:Hr.TRACER}).onSuccess(((r=this._mediaStreamTrack)===null||r===void 0?void 0:r.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Fy.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const r=Vy.indexOf(t);r!==-1&&Vy.splice(r,1)}(this),this.emit(By.CLOSED),this.removeAllListeners(Mg.SEI_RECEIVED)}_updateRtpTransceiver(t,r){if(r===Fy.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Mg.TRANSCEIVER_UPDATED,t,r)}}class Wy extends g4{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,r){super(t,r),Se(this,"_enabled",!0),Se(this,"_muted",!1),Se(this,"_isExternalTrack",!1),Se(this,"_isClosed",!1),Se(this,"_enabledMutex",void 0),Se(this,"processor",void 0),Se(this,"_processorContext",void 0),Se(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ps("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,r;return(t=(r=this._originMediaStreamTrack)===null||r===void 0?void 0:r.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(ft.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,r){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ir(this,ft.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(By.TRACK_ENDED)}stateCheck(t,r){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(r,"]")),Uh(r,t),this._enabled&&this._muted&&t==="enabled"&&r===!1)throw new Ae(q.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&t==="muted"&&r===!0)throw new Ae(q.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():nt.resolve([])}}const _4=window.AudioContext||window.webkitAudioContext;let nc=null;const Kn=new class extends Dr{constructor(){super(...arguments),Se(this,"prevState",void 0),Se(this,"curState",void 0),Se(this,"currentTime",void 0),Se(this,"currentTimeStuckAt",void 0),Se(this,"interruptDetectorTrack",void 0),Se(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(as.IOS_15_16_INTERRUPTION_START)}),Se(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):(nc&&await nc.suspend(),this.emit(as.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){x.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){x.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function zy(){if(!nc){if(function(){if(!_4)return void x.error("your browser is not support web audio");x.info("create audio context");const e=Nr({},Z("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(e)),nc=new _4(e),Kn.curState=nc.state,nc.onstatechange=()=>{Kn.prevState=Kn.curState,Kn.curState=nc?nc.state:void 0;const{prevState:t,curState:r}=Kn,o=r==="running",c=r==="interrupted",u=t==="running",f=t==="suspended",g=t==="interrupted",E=An().osVersion;(ma()||ml())&&u&&c&&(x.info("ios".concat(E,"-interruption-start")),Kn.emit(as.IOS_INTERRUPTION_START)),(ma()||ml())&&(f||g)&&o&&(x.info("ios".concat(E,"-interruption-end")),Kn.emit(as.IOS_INTERRUPTION_END)),t!==r&&Kn.emit(as.STATE_CHANGE,r,t)},setInterval(()=>{var t;const r=(t=nc)===null||t===void 0?void 0:t.currentTime;Kn.currentTime!==r?(Kn.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(r)),Kn.currentTimeStuckAt=void 0),Kn.currentTime=r):(r!==Kn.currentTimeStuckAt&&(vt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:Hr.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(r))),Kn.currentTimeStuckAt=r)},5e3),async function(t){const r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,f=!1;function g(M){t.state==="running"?E(!1):ma()||ml()?t.state==="suspended"&&(E(!0),M&&t.resume().then(v,v)):t.state!=="closed"&&(E(!0),M&&t.resume().then(v,v))}function E(M){if(c!==M){c=M;for(let j=0,G=r;j<G.length;j+=1){const z=G[j];M?window.addEventListener(z,S,{capture:!0,passive:!0}):window.removeEventListener(z,S,{capture:!0,passive:!0})}}}function v(){g(!1)}function S(){g(!0)}function R(M){if(!f)if(o.paused)if(M){let j;I(!1),f=!0;try{j=o.play(),j?j.then(D,D):(o.addEventListener("playing",D),o.addEventListener("abort",D),o.addEventListener("error",D))}catch{D()}}else I(!0);else I(!1)}function I(M){if(u!==M){u=M;for(let j=0,G=r;j<G.length;j++){const z=G[j];M?window.addEventListener(z,V,{capture:!0,passive:!0}):window.removeEventListener(z,V,{capture:!0,passive:!0})}}}function D(){o.removeEventListener("playing",D),o.removeEventListener("abort",D),o.removeEventListener("error",D),f=!1,R(!1)}function V(){R(!0)}if(ma()){const M=t.createMediaStreamDestination(),j=document.createElement("div");j.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=j.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=M.stream,R(!0)}Kn.on(as.STATE_CHANGE,function(){g(!0)}),g(!1)}(nc)}(),!nc)throw new Ae(q.NOT_SUPPORTED,"can not create audio context");return nc}return nc}function Ug(e){if(function(){if(Bk!==null)return Bk;const o=zy(),c=o.createBufferSource(),u=o.createGain(),f=o.createGain();c.connect(u),c.connect(f),c.disconnect(u);let g=!1;try{c.disconnect(u)}catch{g=!0}return c.disconnect(),Bk=g,g}())return;const t=e.connect,r=e.disconnect;e.connect=(o,c,u)=>{var f;return e._inputNodes||(e._inputNodes=[]),et(f=e._inputNodes).call(f,o)||(o instanceof AudioNode?(e._inputNodes.push(o),t.call(e,o,c,u)):t.call(e,o,c)),e},e.disconnect=(o,c,u)=>{r.call(e),o?AA(e._inputNodes,o):e._inputNodes=[];for(const f of e._inputNodes)t.call(e,f)}}let Bk=null;function Hk(e,t){let r=!1;const o=1/t;if(Z("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{r?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{const c=zy();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const f=()=>{if(r)return void(u=null);const g=c.createOscillator();g.onended=f,g.connect(u),g.start(0),g.stop(c.currentTime+o),e(c.currentTime)};f()}return()=>{r=!0}}class E4{constructor(){Se(this,"context",void 0),Se(this,"analyserNode",void 0),Se(this,"sourceNode",void 0),this.context=zy(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ma()||ml()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<t.length;++c)t[c]=o[c]/128-1}const r=Xa(t).call(t,(o,c)=>o+c*c,0)/t.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,r;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(r=this.sourceNode)===null||r===void 0||r.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class y4 extends Dr{get processSourceNode(){return this.sourceNode}set processedNode(t){var r;if(!this.isDestroyed&&this._processedNode!==t){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(r=this._processedNode)===null||r===void 0||r.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Se(this,"outputNode",void 0),Se(this,"outputTrack",void 0),Se(this,"isPlayed",!1),Se(this,"sourceNode",void 0),Se(this,"context",void 0),Se(this,"audioBufferNode",void 0),Se(this,"destNode",void 0),Se(this,"audioOutputLevel",0),Se(this,"volumeLevelAnalyser",void 0),Se(this,"_processedNode",void 0),Se(this,"playNode",void 0),Se(this,"isDestroyed",!1),Se(this,"onNoAudioInput",void 0),Se(this,"isNoAudioInput",!1),Se(this,"_noAudioInputCount",0),this.context=zy(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Ug(this.outputNode),this.volumeLevelAnalyser=new E4}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(ec.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let f=0;f<u.length;f+=1)u[f]=0}return o.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!In().webAudioMediaStreamDest)throw new Ae(q.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&IA(()=>{Kn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ma()||ml()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const r=this.volumeLevelAnalyser.getAnalyserNode();let o;r.getFloatTimeDomainData?(o=new Float32Array(r.fftSize),r.getFloatTimeDomainData(o)):(o=new Uint8Array(r.fftSize),r.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await is(200),await this.checkHasAudioInput(t?t+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,r;(t=this.processedNode)===null||t===void 0||t.disconnect(),(r=this.sourceNode)===null||r===void 0||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class v4 extends y4{get isFreeze(){return!1}constructor(t,r,o){var c;if(super(),Se(this,"sourceNode",void 0),Se(this,"track",void 0),Se(this,"clonedTrack",void 0),Se(this,"audioElement",void 0),Se(this,"isCurrentTrackCloned",!1),Se(this,"isRemoteTrack",!1),Se(this,"originVolumeLevelAnalyser",void 0),Se(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const g=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?g.stop():this.isCurrentTrackCloned=!0;const E=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(E),Ug(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),Ug(this.outputNode),this.emit(ec.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=E,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new Ae(q.UNEXPECTED_ERROR);this.track=t;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(u),Ug(this.sourceNode),o){const g=o.clone();g.enabled=!0,this.clonedTrack=g,x.debug("create an unmuted track ".concat(g.id," from the original track ").concat(o.id," to get the volume"));const E=this.context.createMediaStreamSource(new MediaStream([g]));Ug(E),this.originVolumeLevelAnalyser=new E4,this.originVolumeLevelAnalyser.updateSource(E)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const f=An();r&&f.os===Fi.IOS&&Number((c=f.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Kn.on(as.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(g=>{g||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const r=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(r),Ug(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ec.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Kn.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const r=t.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),x.debug("create an unmuted track ".concat(r.id," from the original track ").concat(t.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([r]));Ug(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function S4(e,t,r){const o=(u,f)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||f:u:f,c={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(t.height,1080),maxWidth:o(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(c.video.mandatory.maxFrameRate=t.frameRate.max,c.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(c.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function bne(e,t){const r=await T4(e.mediaSource),{sourceId:o,audio:c}=await function(u){let f=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new nt((g,E)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const I=document.createElement("div");I.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const D=document.createElement("div");D.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const V=document.createElement("button");V.innerHTML="cancel",V.setAttribute("style","width: 85px;"),V.onclick=()=>{document.body.removeChild(G);const z=new Error("NotAllowedError");z.name="NotAllowedError",E(z)};let M=f;const j=document.createElement("div");if(f){const z=document.createElement("input");z.setAttribute("type","checkbox");const ce=document.createElement("span");z.setAttribute("style","margin-right: 6px;"),ce.innerText="Share audio",z.checked=M,z.onchange=()=>{M=z.checked},j.appendChild(z),j.appendChild(ce)}D.appendChild(j),D.appendChild(V),S.appendChild(R),S.appendChild(I),S.appendChild(D);const G=document.createElement("div");G.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),G.appendChild(v),G.appendChild(S),document.body.appendChild(G),u.map(z=>{if(z.id){const ce=document.createElement("div");ce.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Ee=z.thumbnail;try{const{width:_e}=Ee.getSize();_e>1920&&(Ee=Ee.resize({width:1920}))}catch(_e){throw _e&&_e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),_e}ce.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Ee.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+z.name.replace(/[\u00A0-\u9999<>\&]/g,function(_e){return"&#"+_e.charCodeAt(0)+";"})+"</span>",ce.onclick=()=>{document.body.removeChild(G),g({sourceId:z.id,audio:M})},I.appendChild(ce)}})})}(r,t);return await S4(o,e,c)}async function T4(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const r=k3();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new Ae(q.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=r.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{o=null}o&&o.then||(o=new nt((u,f)=>{r.desktopCapturer.getSources({types:t},(g,E)=>{g?f(g):u(E)})}));try{return await o}catch(u){throw new Ae(q.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const Gk=new Ps("safari");let b4=!1,w4=!1;async function rc(e,t){let r=0,o=null;for(;r<2;)try{o=await wne(e,t,r>0);break}catch(c){if(c instanceof Ae)throw x.error("[".concat(t,"] ").concat(c.toString())),c;const u=VA(c.name||c.code||c,c.message);if(u.code===q.MEDIA_OPTION_INVALID){x.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await is(500);continue}throw x.error("[".concat(t,"] ").concat(u.toString())),u}if(!o)throw new Ae(q.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function wne(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Ae(q.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=In(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return x.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(k3())e.screen.sourceId?Yy(c,await S4(e.screen.sourceId,e.screen,!!e.screenAudio)):Yy(c,await bne(e.screen,!!e.screenAudio));else if(Mh()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new Ae(q.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const I=await(f=e.screen.extensionId,g=t,new nt((D,V)=>{try{chrome.runtime.sendMessage(f,{getStream:!0},M=>{if(!M||!M.streamId)return x.error("[".concat(g,"] No response from Chrome Plugin. Plugin not installed properly"),M),void V(new Ae(q.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));D(M.streamId)})}catch(M){x.error("[".concat(g,"] AgoraRTC screensharing plugin is not accessible(").concat(f,")"),M.toString()),V(new Ae(q.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=I,Yy(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&h4(e.screen.mediaSource);const I={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:D,surfaceSwitching:V,systemAudio:M,preferCurrentTab:j}=e.screen,G={selfBrowserSurface:D,surfaceSwitching:V,systemAudio:M,preferCurrentTab:j};!D&&delete G.selfBrowserSurface,!V&&delete G.surfaceSwitching,!M&&delete G.systemAudio,!j&&delete G.preferCurrentTab,x.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:I,audio:e.screenAudio,controls:G})),Yy(c,await navigator.mediaDevices.getDisplayMedia(Nr({video:I,audio:e.screenAudio},G)))}else{if(!Fr())throw x.error("[".concat(t,"] This browser does not support screenSharing")),new Ae(q.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&h4(e.screen.mediaSource);const I={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};x.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(I))),Yy(c,await navigator.mediaDevices.getUserMedia(I))}}var f,g;if(!e.video&&!e.audio)return c;let E={video:e.video,audio:e.audio},v=Z("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),E=yk(E,v)}catch{}x.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(E)),An();let S,R=null;(fs()||ma()||RA())&&(R=await Gk.lock());try{S=await navigator.mediaDevices.getUserMedia(E)}catch(I){throw R&&R(),I}return E.audio&&(b4=!0),E.video&&(w4=!0),Yy(c,S),R&&R(),c}function VA(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Ae(q.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Ae(q.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new Ae(q.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new Ae(q.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Ae(q.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new Ae(q.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return x.error("getUserMedia unexpected error",e),new Ae(q.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Yy(e,t){const r=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=t.getVideoTracks()[0],u=t.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(r&&e.removeTrack(r),e.addTrack(c))}const ic=new class extends Dr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(jg.STATE_CHANGE,e),this._state=e)}constructor(){super(),Se(this,"_state",kb.IDLE),Se(this,"isAccessMicrophonePermission",!1),Se(this,"isAccessCameraPermission",!1),Se(this,"lastAccessMicrophonePermission",!1),Se(this,"lastAccessCameraPermission",!1),Se(this,"checkdeviceMatched",!1),Se(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(Z("ENUMERATE_DEVICES_INTERVAL")||(CA()||wA()===Fi.HARMONY_OS)&&jh())&&this.updateDevicesInfo()},Z("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>x.error(e.toString()))}async enumerateDevices(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Ae(q.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&e,f=!this.isAccessCameraPermission&&t;c.audio&&(u=!1),c.video&&(f=!1);let g=null,E=null,v=null;if(!r&&(u||f)){if(Gk.isLocked&&(x.debug("[device manager] wait GUM lock"),(await Gk.lock())(),x.debug("[device manager] GUM unlock")),b4&&(u=!1,this.isAccessMicrophonePermission=!0),w4&&(f=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",e,t,u,f),u&&f){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const R=VA(S.name||S.code||S,S.message);if(R.code===q.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{g=await navigator.mediaDevices.getUserMedia({audio:e})}catch(S){const R=VA(S.name||S.code||S,S.message);if(R.code===q.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(f){try{E=await navigator.mediaDevices.getUserMedia({video:t})}catch(S){const R=VA(S.name||S.code||S,S.message);if(R.code===q.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",e,"cam permission",t)}try{const S=await navigator.mediaDevices.enumerateDevices();return g&&g.getTracks().forEach(R=>R.stop()),E&&E.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),g=null,E=null,v=null,S}catch(S){return g&&g.getTracks().forEach(R=>R.stop()),E&&E.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),g=null,E=null,v=null,new Ae(q.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(r=>{r.device.label===e&&(t=r.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(r=>r.deviceId===e);if(!t)throw new Ae(q.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=kb.INITING;try{await this.updateDevicesInfo(),this.state=kb.INITEND}catch(e){throw x.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=kb.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Ae(q.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(f=>f.kind==="audioinput"&&f.deviceId==="default"),u=e.find(f=>f.kind==="audiooutput"&&f.deviceId==="default");c&&u?u.groupId===c.groupId?x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):x.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const f={initAt:t,updateAt:t,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),f),r.push(f)}u&&(u.updateAt=t)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==t&&(c.state="INACTIVE",r.push(c))}),this.state!==kb.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(jg.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(jg.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(jg.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(c=>c.kind==="audioinput"),r=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of t)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of r)if(c.label&&c.deviceId){o.video=!0;break}return o}};let Wk=!1;const sc=new class extends Dr{constructor(){super(...arguments),Se(this,"onAutoplayFailed",void 0),Se(this,"onAudioAutoplayFailed",void 0)}};function R4(){if(An(),!Wk){const e=t=>{t.preventDefault(),Wk=!1,Rb()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Wk=!0,Rb()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),sc.onAutoplayFailed?sc.onAutoplayFailed():sc.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),sc.emit("autoplay-failed")}}function C4(e,t,r,o){if(!e)return;const c=vt.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,f=Date.now(),g=Nr(Nr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:f,elapse:f-c.startTime,cbRegistered:sc.onAutoplayFailed||sc.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:o,extend:void 0});vt.send({type:Ir.AUTOPLAY_FAILED,data:g},!0)}const Rne=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Pa=new class{constructor(){Se(this,"onAutoplayFailed",void 0),Se(this,"elementMap",new Map),Se(this,"elementStateMap",new Map),Se(this,"elementsNeedToResume",[]),Se(this,"sinkIdMap",new Map),Se(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,o]=t;const c=this.elementStateMap.get(r),u=o.srcObject.getAudioTracks()[0],f=u&&u.readyState;if(x.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(f," ").concat(e)),f==="live"){if(e)return o.pause(),void o.play();if(Kn.curState==="running")return xy()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,r]=e;const o=r.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),Kn.on(as.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Kn.on(as.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Kn.on(as.STATE_CHANGE,()=>{ma()&&Kn.prevState==="suspended"&&Kn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(o){throw new Ae(q.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,t,r,o){if(this.elementMap.has(t))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,c),this.elementMap.set(t,c),this.elementStateMap.set(t,Js.INIT),this.setVolume(t,r);const u=this.sinkIdMap.get(t);if(u)try{c.setSinkId(u).catch(g=>{x.warning("[".concat(t,"] set sink id failed"),g.toString())})}catch(g){x.warning("[".concat(t,"] set sink id failed"),g.toString())}const f=c.play();f&&f.then&&f.catch(g=>{o&&C4(o,"audio",g.message,t),x.warning("audio element play warning",g.toString()),this.elementMap.has(t)&&g.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),IA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),R4()}))})}updateTrack(e,t){const r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Rne.forEach(r=>{t.addEventListener(r,o=>{const c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(x.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const f=t==null?void 0:t.error;f&&x.error("[".concat(e,"] media error, code: ").concat(f.code,", message: ").concat(f.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(r=>{x.debug("Auto resume audio element success")}).catch(r=>{x.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new nt(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Rb()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Qr(){return function(e,t,r){const o=r.value;return typeof o=="function"&&(r.value=function(){this._isClosed&&new Ae(q.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var c=arguments.length,u=new Array(c),f=0;f<c;f++)u[f]=arguments[f];const g=o.apply(this,u);return g instanceof nt?new nt((E,v)=>{g.then(E).catch(v)}):g}),r}}class A4 extends Dr{constructor(t){super(),Se(this,"name","VideoProcessorDestination"),Se(this,"ID","0"),Se(this,"_source",void 0),Se(this,"videoContext",void 0),Se(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Ae(q.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Ae(q.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(ga.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ga.ON_TRACK,void 0)}}class I4 extends Dr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r){super(),Se(this,"constraintsMap",new Map),Se(this,"statsRegistry",[]),Se(this,"usageRegistry",[]),Se(this,"trackId",void 0),Se(this,"direction",void 0),Se(this,"_chained",!1),this.trackId=t,this.direction=r}async getConstraints(){return await gs(this,tc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,r){var o;return x.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),ir(this,tc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Da(o=this.constraintsMap).call(o)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return x.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),ir(this,tc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Da(r=this.constraintsMap).call(r)))}registerStats(t,r,o){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:o})}unregisterStats(t,r){const o=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const t=[];for(const{processorID:r,processorName:o,type:c,cb:u}of this.statsRegistry)try{const f=u();t.push({processorID:r,processorName:o,type:c,stats:f})}catch(f){x.error(new Ae(q.UNEXPECTED_ERROR,f.message))}return t}registerUsage(t,r){this.usageRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){const r=this.usageRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let o=r();o instanceof nt&&(o=await o),t.push(Nr(Nr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return t}getDirection(){return this.direction}}class N4 extends Dr{constructor(t){super(),Se(this,"name","AudioProcessorDestination"),Se(this,"ID","0"),Se(this,"inputTrack",void 0),Se(this,"inputNode",void 0),Se(this,"audioProcessorContext",void 0),Se(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Ae(q.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Ae(q.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ga.ON_TRACK,void 0),this.emit(ga.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(ga.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(ga.ON_NODE,this.inputNode))}}class O4 extends Dr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r,o){super(),Se(this,"constraintsMap",new Map),Se(this,"statsRegistry",[]),Se(this,"audioContext",void 0),Se(this,"trackId",void 0),Se(this,"direction",void 0),Se(this,"usageRegistry",[]),Se(this,"_chained",!1),this.audioContext=t,this.trackId=r,this.direction=o}async getConstraints(){return gs(this,tc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,r){var o;return x.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),ir(this,tc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Da(o=this.constraintsMap).call(o)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),ir(this,tc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Da(r=this.constraintsMap).call(r)))}registerStats(t,r,o){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:o})}unregisterStats(t,r){const o=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const t=[];for(const{processorID:r,processorName:o,type:c,cb:u}of this.statsRegistry)try{const f=u();t.push({processorID:r,processorName:o,type:c,stats:f})}catch(f){x.error(new Ae(q.UNEXPECTED_ERROR,f.message))}return t}registerUsage(t,r){this.usageRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){const r=this.usageRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let o=r();o instanceof nt&&(o=await o),t.push(Nr(Nr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return t}getDirection(){return this.direction}}class zk extends Dr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Se(this,"context",void 0),Se(this,"processSourceNode",void 0),Se(this,"outputTrack",void 0),Se(this,"processedNode",void 0),Se(this,"clonedTrack",void 0),Se(this,"outputNode",void 0),this.outputNode=new Cne}setVolume(){}createOutputTrack(){throw new Ae(q.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Cne{disconnect(){}connect(){}}function D4(e){return new nt((t,r)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=ma()?"canplay":"playing";c.addEventListener(u,()=>{const f=c.videoWidth,g=c.videoHeight;!f&&Fr()||(o=!0,c.srcObject=null,c.remove(),t([f,g]))}),c.srcObject=new MediaStream([e]),c.play().catch(NA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),t([c.videoWidth,c.videoHeight]))},4e3)})}function FA(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const r=El(e.encoderConfig);return r.width!=null&&(t.width=r.width),r.height!=null&&(t.height=r.height),!N3()&&r.frameRate&&(t.frameRate=r.frameRate),S3()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Fr()&&(t.frameRate={ideal:30,max:30}),t}function x4(e){const t={};return N3()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Mh()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function P4(e){const t=x4(e);if(e.encoderConfig){const r=jA(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),CA()&&(t.sampleRate=void 0),t}const Ane=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:r,width:o,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=r,width:f=o,height:g=c}=t;if(!u||!f||!g)return;f=vk(f),g=vk(g),u=vk(u);const{max:E,min:v}=function(D,V,M){const j=200*Math.pow(M/15,.6)*Math.pow(D*V/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}}(f,g,u),{bitrateMax:S,bitrateMin:R}=t||{};S||x.debug("calculate bitrate: [w: ".concat(f,", h: ").concat(g,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(R,"]"));const{maxFramerate:I}=Z("ENCODER_CONFIG_LIMIT");return I&&typeof I=="number"&&(u=Math.min(u,I)),{frameRate:u,bitrateMax:S||E,bitrateMin:R||v,scaleResolutionDownBy:1,scale:0}},k4=async(e,t,r)=>await(async(o,c,u)=>{const f=function(v){const S=[];for(let R=0;R<v.length;R+=2)S.push(parseInt(v.slice(R,R+2),16));return Uint8Array.from(S)}(z3(""+c+u)).slice(0,16),g=f.slice(0,12),E=await window.crypto.subtle.importKey("raw",f,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:g},E,o))})(e.buffer,t,r),Yk=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new nt((r,o)=>{t.toBlob(async c=>{if(t.remove(),c){const u=await L4(c);r({buffer:u,width:t.width,height:t.height})}else o(new Ae(q.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},L4=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var M4,j4,U4,V4,F4,B4,H4,G4,W4,z4,Y4,q4,K4,X4,Q4,$4,J4,Z4,Pr,e5,t5,n5,r5,i5,s5,hu,a5,o5,c5,l5,d5,u5,h5,p5,f5,m5,g5,_5,E5,Es;let qr=(M4=Nt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),j4=Nt({argsMap:(e,t)=>[e.getTrackId(),t]}),U4=Qr(),V4=Ly("LocalAudioTrack","_enabledMutex"),F4=Nt({argsMap:(e,t)=>[e.getTrackId(),t]}),B4=Qr(),H4=Ly("LocalAudioTrack","_enabledMutex"),G4=Nt({argsMap:(e,t)=>[e.getTrackId(),t]}),W4=Qr(),z4=Qr(),Y4=Qr(),q4=Nt({argsMap:e=>[e.getTrackId()]}),K4=Qr(),X4=Nt({argsMap:e=>[e.getTrackId()]}),Q4=Qr(),$4=Nt({argsMap:e=>[e.getTrackId()]}),J4=Nt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Z4=Nt({argsMap:e=>[e.getTrackId()]}),vn((Pr=class extends Wy{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Pa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,o){super(e,r),Se(this,"trackMediaType",Gy.AUDIO),Se(this,"_encoderConfig",void 0),Se(this,"_trackSource",void 0),Se(this,"metadata",[]),Se(this,"_enabled",!0),Se(this,"_volume",100),Se(this,"_useAudioElement",!0),Se(this,"_bypassWebAudio",!1),Se(this,"processor",void 0),Se(this,"_processorContext",void 0),Se(this,"_processorDestination",void 0),Se(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!o,this._trackSource=new zk,Z("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),Z("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),fs()&&!nc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Jn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Pa.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,ir(this,ft.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(r=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!d4())throw new Ae(q.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Pa.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await ir(this,ft.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw r||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await ir(this,ft.NEED_DISABLE_TRACK,this)}catch(o){throw r||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await ir(this,ft.NEED_MUTE_TRACK,this):await ir(this,ft.NEED_UNMUTE_TRACK,this))}getStats(){return Ef(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),$o(this,ft.GET_STATS)||Nr({},Uk)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ec.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ec.ON_AUDIO_BUFFER),this._source.on(ec.ON_AUDIO_BUFFER,r=>e(r))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Pa.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Pa.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Pa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ir(this,ft.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return nt.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Ae(q.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Ae(q.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(ga.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await ir(this,ft.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ir(this,ft.NEED_REPLACE_TRACK,this))}),e.on(ga.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(ga.ON_TRACK),e.removeAllListeners(ga.ON_NODE)}bindProcessorContextEvents(e){e.on(tc.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(tc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof zk&&(this._trackSource=new v4(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new O4(this._source.context,this.getTrackId(),"local"),t=new N4(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(ec.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Pa.stop(this.getTrackId()),this._source.play()),ir(this,ft.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(r=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[M4],Object.getOwnPropertyDescriptor(Pr.prototype,"setVolume"),Pr.prototype),vn(Pr.prototype,"setPlaybackDevice",[j4,U4],Object.getOwnPropertyDescriptor(Pr.prototype,"setPlaybackDevice"),Pr.prototype),vn(Pr.prototype,"setEnabled",[V4,F4,B4],Object.getOwnPropertyDescriptor(Pr.prototype,"setEnabled"),Pr.prototype),vn(Pr.prototype,"setMuted",[H4,G4,W4],Object.getOwnPropertyDescriptor(Pr.prototype,"setMuted"),Pr.prototype),vn(Pr.prototype,"getStats",[z4],Object.getOwnPropertyDescriptor(Pr.prototype,"getStats"),Pr.prototype),vn(Pr.prototype,"setAudioFrameCallback",[Y4],Object.getOwnPropertyDescriptor(Pr.prototype,"setAudioFrameCallback"),Pr.prototype),vn(Pr.prototype,"play",[q4,K4],Object.getOwnPropertyDescriptor(Pr.prototype,"play"),Pr.prototype),vn(Pr.prototype,"stop",[X4,Q4],Object.getOwnPropertyDescriptor(Pr.prototype,"stop"),Pr.prototype),vn(Pr.prototype,"close",[$4],Object.getOwnPropertyDescriptor(Pr.prototype,"close"),Pr.prototype),vn(Pr.prototype,"pipe",[J4],Object.getOwnPropertyDescriptor(Pr.prototype,"pipe"),Pr.prototype),vn(Pr.prototype,"unpipe",[Z4],Object.getOwnPropertyDescriptor(Pr.prototype,"unpipe"),Pr.prototype),Pr),Lb=(e5=Nt({argsMap:(e,t)=>[e.getTrackId(),t]}),t5=Qr(),n5=Ly("MicrophoneAudioTrack","_enabledMutex"),r5=Nt({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),i5=Qr(),s5=Nt({argsMap:e=>[e.getTrackId()]}),vn((hu=class extends qr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,o){super(e,t.encoderConfig?jA(t.encoderConfig):{},o,Z("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Se(this,"_config",void 0),Se(this,"_deviceName","default"),Se(this,"_constraints",void 0),Se(this,"_originalConstraints",void 0),Se(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(xy()||hk())&&Kn.bindInterruptDetectorTrack(this)}async setDevice(e){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await ic.getDeviceById(e),r={};r.audio=Nr({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await rc(r,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await rc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await ic.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}x.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),e),Z("AUTO_RESET_AUDIO_ROUTE")&&(ma()||ml())){const f=navigator.audioSession;f&&(e||(f.type="playback"),f.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),r||(this._enabled=!1);try{await ir(this,ft.NEED_DISABLE_TRACK,this)}catch(f){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),f.toString()),f}return}const c=Nr({},this._constraints),u=ic.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{r||(this._enabled=!0);const f=await rc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(f.getAudioTracks()[0],!1),await ir(this,ft.NEED_ENABLE_TRACK,this)}catch(f){throw r||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),f.toString()),f}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(xy()||hk())&&Kn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ma()||ml())&&this._enabled&&!this._isClosed&&Kn.duringInterruption){const e=async()=>{Kn.off(as.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Kn.on(as.IOS_INTERRUPTION_END,e)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(By.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,r=ic.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const o=await rc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(tc.REQUEST_UPDATE_CONSTRAINTS,async(t,r,o)=>{try{const c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),r()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(tc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[e5,t5],Object.getOwnPropertyDescriptor(hu.prototype,"setDevice"),hu.prototype),vn(hu.prototype,"setEnabled",[n5,r5,i5],Object.getOwnPropertyDescriptor(hu.prototype,"setEnabled"),hu.prototype),vn(hu.prototype,"close",[s5],Object.getOwnPropertyDescriptor(hu.prototype,"close"),hu.prototype),hu),Ine=(a5=Nt({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),o5=Qr(),c5=Nt({argsMap:e=>[e.getTrackId()]}),l5=Qr(),d5=Nt({argsMap:e=>[e.getTrackId()]}),u5=Qr(),h5=Nt({argsMap:e=>[e.getTrackId()]}),p5=Qr(),f5=Nt({argsMap:e=>[e.getTrackId()]}),m5=Qr(),g5=Nt({argsMap:e=>[e.getTrackId()]}),_5=Nt({argsMap:e=>[e.getTrackId()]}),E5=Qr(),vn((Es=class extends qr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,o){super(t.createOutputTrack(),r,o),Se(this,"source",void 0),Se(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(ec.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(By.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Jn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[a5,o5],Object.getOwnPropertyDescriptor(Es.prototype,"startProcessAudioBuffer"),Es.prototype),vn(Es.prototype,"pauseProcessAudioBuffer",[c5,l5],Object.getOwnPropertyDescriptor(Es.prototype,"pauseProcessAudioBuffer"),Es.prototype),vn(Es.prototype,"seekAudioBuffer",[d5,u5],Object.getOwnPropertyDescriptor(Es.prototype,"seekAudioBuffer"),Es.prototype),vn(Es.prototype,"resumeProcessAudioBuffer",[h5,p5],Object.getOwnPropertyDescriptor(Es.prototype,"resumeProcessAudioBuffer"),Es.prototype),vn(Es.prototype,"stopProcessAudioBuffer",[f5,m5],Object.getOwnPropertyDescriptor(Es.prototype,"stopProcessAudioBuffer"),Es.prototype),vn(Es.prototype,"close",[g5],Object.getOwnPropertyDescriptor(Es.prototype,"close"),Es.prototype),vn(Es.prototype,"setAudioBufferPlaybackSpeed",[_5,E5],Object.getOwnPropertyDescriptor(Es.prototype,"setAudioBufferPlaybackSpeed"),Es.prototype),Es);class Ni extends qr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=zy().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,lr(8,"track-mix-")),Se(this,"trackList",void 0),Se(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(x.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):x.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){x.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}AA(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(r=>{r instanceof Ni?r.emit(Mg.TRANSCEIVER_UPDATED,t):r._updateRtpTransceiver(t)}))}}class Nne extends y4{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(ec.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Se(this,"audioBuffer",void 0),Se(this,"sourceNode",void 0),Se(this,"startPlayTime",0),Se(this,"startPlayOffset",0),Se(this,"pausePlayTime",0),Se(this,"options",void 0),Se(this,"currentLoopCount",0),Se(this,"currentPlaybackSpeed",100),Se(this,"_currentState","stopped"),this.audioBuffer=t,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const y5=new Map;function v5(e,t){if(e.length===0||t.length===0)return 1/0;const r=Sk(e),o=Sk(t);return Math.floor(o/r)}class qk{get rendFrameRate(){const t=Math.max(1,v5(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var r;t!==this._videoState&&(this._videoState=t,(r=this.onVideoStateChanged)===null||r===void 0||r.call(this,this.videoState))}constructor(t){Se(this,"trackId",void 0),Se(this,"config",void 0),Se(this,"onFirstVideoFrameDecoded",void 0),Se(this,"onVideoStateChanged",void 0),Se(this,"freezeTimeCounterList",[]),Se(this,"renderFreezeAccTime",0),Se(this,"renderFreezeAccTime2",0),Se(this,"isKeepLastFrame",!1),Se(this,"timeUpdatedCount",0),Se(this,"freezeTime",0),Se(this,"playbackTime",0),Se(this,"lastTimeUpdatedTime",0),Se(this,"autoplayFailed",!1),Se(this,"videoTrack",void 0),Se(this,"videoElement",void 0),Se(this,"cacheVideoElement",void 0),Se(this,"_render_interframe_delays",[]),Se(this,"_render_interframe_delays_sizes",[]),Se(this,"_videoState",uu.VideoStateStopped),Se(this,"videoElementCheckInterval",void 0),Se(this,"videoElementFreezeTimeout",void 0),Se(this,"_videoElementStatus",Js.NONE),Se(this,"isGettingVideoDimensions",!1),Se(this,"startGetVideoDimensions",()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),Se(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Kn.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(v3())),A3()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Se(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Js.PLAYING;break;case"loadeddata":if(this.videoState=uu.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Js.CANPLAY;break;case"stalled":this.videoElementStatus=Js.STALLED;break;case"suspend":this.videoElementStatus=Js.SUSPEND;break;case"pause":this.videoElementStatus=Js.PAUSED,ma()||ml()||fs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Js.WAITING;break;case"abort":this.videoElementStatus=Js.ABORT;break;case"ended":this.videoElementStatus=Js.ENDED;break;case"emptied":this.videoElementStatus=Js.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=Js.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,pu.lastVisibleTime<pu.lastHiddenTime||u<pu.lastHiddenTime||u<pu.lastVisibleTime)return;for(c>Z("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const f=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(f),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(v3())),A3()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Kn.on(as.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Kn.on(as.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const r=this.videoElement.play();r&&r.catch&&r.catch(c=>{t&&C4(t,"video",c.message,this.trackId),c.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),c)});const o=An();if((o.name==="Safari"&&Number(o.version)===15||xy())&&r&&r.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(c).catch(c)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const r=t.getContext("2d");if(!r)return x.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,t.width,t.height);const o=r.getImageData(0,0,t.width,t.height);return t.remove(),o}async getCurrentFrameToUint8Array(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new nt((u,f)=>{o.toBlob(async g=>{if(o.remove(),g){const E=await L4(g);u({buffer:E,width:o.width,height:o.height})}else f(new Ae(q.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,r<0?.1:r>1?1:r)})):await Yk(t)}destroy(){Kn.off(as.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Kn.off(as.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=uu.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Js.INIT,!this.videoElementCheckInterval&&(S5.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=Js.DESTROYED)},1e3),Z("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,r;let u;const f=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",f),this.videoElementFreezeTimeout=window.setTimeout(g,Z("VIDEO_FREEZE_DURATION")))},g=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===uu.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=uu.VideoStateFrozen:document.addEventListener("visibilitychange",f))},E=(v,S)=>{if(this.videoElementStatus===Js.PLAYING){if(u){const D=S.presentationTime-u.presentationTime,V=S.presentedFrames-u.presentedFrames;this._render_interframe_delays_sizes.push(V),this._render_interframe_delays.push(D);const M=Sk(this._render_interframe_delays_sizes),j=M-this._render_interframe_delays_sizes[0];if(M>30&&j>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===uu.VideoStateStarting&&(this.videoState=uu.VideoStateDecoding),this.videoState===uu.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(g,Z("VIDEO_FREEZE_DURATION"))),D<Z("VIDEO_FREEZE_DURATION")&&this.videoState===uu.VideoStateFrozen&&(this.videoState=uu.VideoStateDecoding),D>Z("VIDEO_FREEZE_DURATION")&&pu.lastVisibleTime>=pu.lastHiddenTime&&u.timestamp>pu.lastVisibleTime&&u.timestamp>pu.lastHiddenTime){const G=Math.min(66,v5(this._render_interframe_delays_sizes,this._render_interframe_delays)),z=Math.max(0,D-(V-1)*G);this.renderFreezeAccTime2+=z>G?z:0,this.renderFreezeAccTime+=D}}u=Nr(Nr({},S),{},{timestamp:v})}var R,I;Z("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(I=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(I,E))};(t=(r=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(r,E)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),CA()&&!Z("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=An();o.name==="Safari"&&Number(o.version)===15||xy()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Fr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Fr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{x.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){S5.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Js.NONE}handleAutoPlayFailed(){const t=r=>{r.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{x.error(o)}),this.autoplayFailed=!1,Rb()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Rb()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),R4()}}const S5=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class T5 extends qk{constructor(t){super(t),Se(this,"container",void 0),Se(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const r=t.element;r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var r;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,o):await Yk(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",Z("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var b5,w5,R5,C5,A5,I5,N5,O5,D5,x5,P5,k5,L5,M5,j5,U5,V5,F5,B5,H5,G5,W5,z5,Y5,q5,K5,pn,X5,Q5,$5,J5,Z5,e9,t9,n9,ac;let gr=(b5=Nt({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),w5=Qr(),R5=Nt({argsMap:e=>[e.getTrackId()]}),C5=Ly("LocalVideoTrack","_enabledMutex"),A5=Nt({argsMap:(e,t)=>[e.getTrackId(),t]}),I5=Qr(),N5=Ly("LocalVideoTrack","_enabledMutex"),O5=Nt({argsMap:(e,t)=>[e.getTrackId(),t]}),D5=Qr(),x5=Nt({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),P5=Qr(),k5=Nt({argsMap:(e,t)=>[e.getTrackId(),t]}),L5=Qr(),M5=Qr(),j5=Nt({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),U5=Qr(),V5=Qr(),F5=Qr(),B5=Qr(),H5=Qr(),G5=Qr(),W5=Qr(),z5=Nt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Y5=Nt({argsMap:e=>[e.getTrackId()]}),q5=Nt({argsMap:e=>[e.getTrackId()]}),K5=Nt({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),pn=class xX extends Wy{get videoHeight(){if(fs()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(fs()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Js.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,r,o,c,u,f){if(super(t,u),Se(this,"trackMediaType",Gy.VIDEO),Se(this,"_player",void 0),Se(this,"isUseScaleResolutionDownBy",!1),Se(this,"_videoVisibleTimer",null),Se(this,"_previousVideoVisibleStatus",void 0),Se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Se(this,"_encoderConfig",void 0),Se(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Se(this,"_optimizationMode",void 0),Se(this,"_saveEncodeBitrateRatio",1),Se(this,"_videoHeight",void 0),Se(this,"_videoWidth",void 0),Se(this,"_forceBitrateLimit",void 0),Se(this,"_enabled",!0),Se(this,"_processorDestination",void 0),Se(this,"_processorContext",void 0),fs()){const{width:g,height:E}=t.getSettings();this._videoWidth=g,this._videoHeight=E}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=o,this._optimizationMode=c,this._hints=f||[],r&&this._hints.indexOf(Zn.CUSTOM_TRACK)!==-1?this._encoderConfig=xr(r):this._encoderConfig=r,this._hints.indexOf(Zn.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(lk(Un.CHROME,115)&&wA().indexOf("Windows")!==-1){const g=function(E,v){if("VideoFrame"in window&&"TransformStream"in window&&In().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(E),R=new MediaStreamTrackGenerator({kind:"video"});let I,D,V=Date.now();const M=()=>{j&&(clearInterval(j),j=void 0),I&&(I.close(),I=void 0),E.stop(),D=void 0,R.removeEventListener("ended",M)};let j=window.setInterval(()=>{if(D&&I&&Date.now()-V>1e3)try{R.readyState==="live"?D.enqueue(I.clone()):M()}catch{M()}},1e3);const G=new TransformStream({transform:(z,ce)=>{R.readyState==="live"?(D=ce,V=Date.now(),I===void 0?(I=z,ce.enqueue(z.clone())):(ce.enqueue(I),I=z)):z.close()}});return R.addEventListener("ended",M),S.readable.pipeThrough(G).pipeTo(R.writable),R}}(t);g&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=g)}r&&this._hints.indexOf(Zn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r),this._processorContext=new I4(this.getTrackId(),"local"),this._processorDestination=new A4(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const c=document.getElementById(t);c?t=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const o=Nr(Nr(Nr({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(o):(t instanceof HTMLVideoElement?this._player=new qk(o):this._player=new T5(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(By.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},Z("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await ir(this,ft.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return r||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await ir(this,ft.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await ir(this,ft.NEED_MUTE_TRACK,this):await ir(this,ft.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),x.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await ir(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(x)}}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new Ae(q.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=El(t),Z("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const o=FA({encoderConfig:t});(fs()||ma()||ml())&&(o.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new Ae(q.UNEXPECTED_ERROR,c.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=t,this._hints.indexOf(Zn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ir(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(x)}}getStats(){return Ef(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),$o(this,ft.GET_STATS)||Nr({},Vk)}async setBeautyEffect(t){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):await Yk(t)}async setBitrateLimit(t){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void x.error(q.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const r=this._optimizationMode;try{this._optimizationMode=t,await ir(this,ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=r,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return x.error(q.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){D4(this._originMediaStreamTrack).then(t=>{let[r,o]=t;this._videoHeight=o,this._videoWidth=r}).catch(NA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new Ae(q.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=El(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Zn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ir(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:r,frameRate:o}=this.getMediaStreamTrackSettings();if(!t||!r||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:f,min:g}=function(E,v,S,R,I){const D=Z("BITRATE_ADAPTER_TYPE");if(D==="DEFAULT_BITRATE")return{min:R,max:I};if(I===void 0){const V=Math.floor(200*Math.pow(S/15,.6)*Math.pow(E*v/640/360,.75));I=D==="STANDARD_BITRATE"?4*V:2*V,R=R??V}else R=R??Math.floor(I/10);return{min:R,max:I}}(t,r,o,u,c);if(this._encoderConfig.bitrateMin=g,this._encoderConfig.bitrateMax=f,Z("VIDEO_STANDARD_BITRATE_VERSION")&&u==null&&c==null){const[E,v]=function(S,R,I){const D=4*Math.floor(2e5*Math.pow(I/15,.6)*Math.pow(S*R/230400,.75)),V=S*R,M=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),j=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let G=Da(M).call(M).next().value,z=1;if(M.has(V))G=M.get(V);else{var ce;const at=Ft(ce=Array.from(M.entries())).call(ce,(qt,Pt)=>{let[hr]=qt,[er]=Pt;return hr-er}),Zt=at.find(qt=>{let[Pt]=qt;return Pt>V});if(Zt){const qt=at.indexOf(Zt);if(qt>0){const Pt=at[qt-1],hr=(V-Pt[0])/(Zt[0]-Pt[0]);G=Pt[1]+hr*(Zt[1]-Pt[1])}else G=Zt[1]}else G=at[at.length-1][1]}if(j.has(V))z=j.get(V);else{var Ee;const at=Ft(Ee=Array.from(j.entries())).call(Ee,(qt,Pt)=>{let[hr]=qt,[er]=Pt;return hr-er}),Zt=at.find(qt=>{let[Pt]=qt;return Pt>V});if(Zt){const qt=at.indexOf(Zt);if(qt>0){const Pt=at[qt-1],hr=(V-Pt[0])/(Zt[0]-Pt[0]);z=Pt[1]+hr*(Zt[1]-Pt[1])}else z=Zt[1]}else z=at[at.length-1][1]}const _e=Z("VIDEO_NEW_BITRATE_RATIO");_e&&_e>0&&(G=_e/100);const me=Math.floor(D*G),Ce=Math.floor(65e4*Math.pow(S*R/230400,.5)*Math.pow(I/15,.69));let xe=me;const $e=Z("VIDEO_STANDARD_BITRATE_VERSION");return $e&&$e>0&&($e===1?xe=D:$e===2?xe=me:$e===3&&(xe=Ce)),[Math.floor(xe/1e3),z]}(t,r,o);this._encoderConfig.bitrateMax=E,this._encoderConfig.bitrateMin=g?Math.min(g,E):E,this._saveEncodeBitrateRatio=v,x.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(o,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(o,"] => [brMax: ").concat(f,", brMin: ").concat(g,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,r;const o=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),c={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:f}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&f instanceof HTMLElement){const g=x3.checkOneElementVisible(u),E=Object.assign({},g);if(E.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=E.visible;const v=vt.reportApiInvoke(null,{tag:Hr.TRACER,name:di.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});E.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(E.reason))}return E}return}catch(o){throw new Ae(q.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new Ae(q.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;t&&(o=Nr(Nr({},o),El(t))),o=xg(o);const c=lr(8,"track-video-cloned-"),u=new xX(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,xg(this._scalabilityMode),this._optimizationMode,c,xg(this._hints));return t&&o&&u.setEncoderConfiguration(o),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),u}async replaceTrack(t,r){if(!(t instanceof MediaStreamTrack))throw new Ae(q.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new Ae(q.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,r,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Ef(()=>{vt.reportApiInvoke(null,{name:di.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Hr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!Z("ENABLE_VIDEO_SEI")||!Z("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new Ae(q.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const r=this.getRTCRtpTransceiver();if(!r)return void x.warning("Video track is not published, SEI can not be send");const o=r.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",t):x.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(ga.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await ir(this,ft.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ir(this,ft.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ga.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(tc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(tc.REQUEST_CONSTRAINTS)}},vn(pn.prototype,"play",[b5,w5],Object.getOwnPropertyDescriptor(pn.prototype,"play"),pn.prototype),vn(pn.prototype,"stop",[R5],Object.getOwnPropertyDescriptor(pn.prototype,"stop"),pn.prototype),vn(pn.prototype,"setEnabled",[C5,A5,I5],Object.getOwnPropertyDescriptor(pn.prototype,"setEnabled"),pn.prototype),vn(pn.prototype,"setMuted",[N5,O5,D5],Object.getOwnPropertyDescriptor(pn.prototype,"setMuted"),pn.prototype),vn(pn.prototype,"setSaveEncodeBitrateRatio",[x5,P5],Object.getOwnPropertyDescriptor(pn.prototype,"setSaveEncodeBitrateRatio"),pn.prototype),vn(pn.prototype,"setEncoderConfiguration",[k5,L5],Object.getOwnPropertyDescriptor(pn.prototype,"setEncoderConfiguration"),pn.prototype),vn(pn.prototype,"getStats",[M5],Object.getOwnPropertyDescriptor(pn.prototype,"getStats"),pn.prototype),vn(pn.prototype,"setBeautyEffect",[j5,U5],Object.getOwnPropertyDescriptor(pn.prototype,"setBeautyEffect"),pn.prototype),vn(pn.prototype,"getCurrentFrameData",[V5],Object.getOwnPropertyDescriptor(pn.prototype,"getCurrentFrameData"),pn.prototype),vn(pn.prototype,"getCurrentFrameImage",[F5],Object.getOwnPropertyDescriptor(pn.prototype,"getCurrentFrameImage"),pn.prototype),vn(pn.prototype,"setBitrateLimit",[B5],Object.getOwnPropertyDescriptor(pn.prototype,"setBitrateLimit"),pn.prototype),vn(pn.prototype,"setOptimizationMode",[H5],Object.getOwnPropertyDescriptor(pn.prototype,"setOptimizationMode"),pn.prototype),vn(pn.prototype,"setScalabiltyMode",[G5],Object.getOwnPropertyDescriptor(pn.prototype,"setScalabiltyMode"),pn.prototype),vn(pn.prototype,"updateMediaStreamTrackResolution",[W5],Object.getOwnPropertyDescriptor(pn.prototype,"updateMediaStreamTrackResolution"),pn.prototype),vn(pn.prototype,"pipe",[z5],Object.getOwnPropertyDescriptor(pn.prototype,"pipe"),pn.prototype),vn(pn.prototype,"unpipe",[Y5],Object.getOwnPropertyDescriptor(pn.prototype,"unpipe"),pn.prototype),vn(pn.prototype,"close",[q5],Object.getOwnPropertyDescriptor(pn.prototype,"close"),pn.prototype),vn(pn.prototype,"replaceTrack",[K5],Object.getOwnPropertyDescriptor(pn.prototype,"replaceTrack"),pn.prototype),pn),Kk=(X5=Nt({argsMap:(e,t)=>[e.getTrackId(),t]}),Q5=Qr(),$5=Ly("CameraVideoTrack","_enabledMutex"),J5=Nt({argsMap:(e,t)=>[e.getTrackId(),t]}),Z5=Qr(),e9=Nt({argsMap:(e,t)=>[e.getTrackId(),t]}),t9=Qr(),n9=Nt({argsMap:e=>[e.getTrackId()]}),ac=class PX extends gr{get __className__(){return"CameraVideoTrack"}constructor(t,r,o,c,u,f){super(t,El(r.encoderConfig),c,u,f),Se(this,"_config",void 0),Se(this,"_originalConstraints",void 0),Se(this,"_constraints",void 0),Se(this,"_enabled",!0),Se(this,"_deviceName","default"),Se(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(xy()||hk())&&!function(){const g=An();if(g.os!==Fi.IOS||!g.osVersion)return!1;const E=g.osVersion.split(".");return Number(E[0])===15&&Number(E[1])>=2}()&&I3()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=r,this._originalConstraints=o,this._constraints=o,this._deviceName=t.label,this._encoderConfig=El(this._config.encoderConfig),Kn.on(as.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Kn.on(as.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const r=await ic.getDeviceById(t),o={};o.video=Nr({},this._constraints),o.video.deviceId={exact:t},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await rc(o,this.getTrackId())}catch(u){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await rc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await ic.getDeviceById(t);this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const r={video:Nr(Nr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await rc(r,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await rc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Nr({},r.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await rc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await ir(this,ft.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r||(this._enabled=!1);try{await ir(this,ft.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new Ae(q.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=El(t),Z("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const o=xr(this._config);o.encoderConfig=t;const c=FA(o);(fs()||ma()||ml())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const f=new Ae(q.UNEXPECTED_ERROR,u.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),f.toString()),f}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=t,this._hints.indexOf(Zn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ir(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ma()||ml())&&this._enabled&&!this._isClosed&&Kn.duringInterruption){const t=async()=>{Kn.off(as.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Kn.on(as.IOS_INTERRUPTION_END,t)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(By.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,o=ic.searchDeviceIdByName(this._deviceName);if(o&&!r.deviceId&&(r.deviceId={exact:o}),this._enabled){const c=await rc({video:r},this.getTrackId());this._constraints=r,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Kn.off(as.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Kn.off(as.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;t&&(o=Nr(Nr({},o),El(t))),o=xg(o);const c=lr(8,"track-cam-cloned-"),u=new PX(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,xg(Nr(Nr({},this._config),{},{encoderConfig:o})),xg(this._constraints),xg(this._scalabilityMode),this._optimizationMode,c);return t&&o&&u.setEncoderConfiguration(o),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),u}bindProcessorContextEvents(){this.processorContext.on(tc.REQUEST_UPDATE_CONSTRAINTS,async(t,r,o)=>{try{const c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),r()}catch(c){o(c)}}),this.processorContext.on(tc.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},vn(ac.prototype,"setDevice",[X5,Q5],Object.getOwnPropertyDescriptor(ac.prototype,"setDevice"),ac.prototype),vn(ac.prototype,"setEnabled",[$5,J5,Z5],Object.getOwnPropertyDescriptor(ac.prototype,"setEnabled"),ac.prototype),vn(ac.prototype,"setEncoderConfiguration",[e9,t9],Object.getOwnPropertyDescriptor(ac.prototype,"setEncoderConfiguration"),ac.prototype),vn(ac.prototype,"close",[n9],Object.getOwnPropertyDescriptor(ac.prototype,"close"),ac.prototype),ac);function Xk(e,t,r,o){r.optimizationMode&&(o&&o.width&&o.height?(r.encoderConfig=Nr(Nr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?x.debug("[".concat(e,"] set content hint to"),r.optimizationMode):x.debug("[".concat(e,"] set content hint failed")))):x.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var r9,i9,s9,a9,Nc,o9,c9,l9,d9,u9,h9,aa;class p9 extends g4{getUserId(){return this._userId}constructor(t,r,o,c){super(t,"track-".concat(t.kind,"-").concat(r,"-").concat(c.clientId,"_").concat(lr(5,""))),Se(this,"_userId",void 0),Se(this,"_uintId",void 0),Se(this,"_isDestroyed",!1),Se(this,"store",void 0),Se(this,"processor",void 0),Se(this,"processorContext",void 0),this._userId=r,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let qy=(r9=Nt({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),i9=Nt({argsMap:e=>[e.getTrackId()]}),s9=Nt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),a9=Nt({argsMap:e=>[e.getTrackId()]}),vn((Nc=class extends p9{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Js.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,o){super(e,t,r,o),Se(this,"_videoVisibleTimer",null),Se(this,"_previousVideoVisibleStatus",void 0),Se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Se(this,"trackMediaType",Gy.VIDEO),Se(this,"_videoWidth",void 0),Se(this,"_videoHeight",void 0),Se(this,"_player",void 0),Se(this,"processorDestination",void 0),Se(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new I4(this.getTrackId(),"remote"),this.processorDestination=new A4(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Ef(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),$o(this,ft.GET_STATS)||Nr({},f4)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const r=Nr(Nr({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new qk(r):this._player=new T5(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Hy.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(Hy.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(Hy.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},Z("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){D4(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(NA)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const f=x3.checkOneElementVisible(c),g=Object.assign({},f);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const E=vt.reportApiInvoke(null,{tag:Hr.TRACER,name:di.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?E.onSuccess("Video is visible"):E.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(r){throw new Ae(q.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Ae(q.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ga.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ga.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Mg.SEI_RECEIVED,e)}}).prototype,"play",[r9],Object.getOwnPropertyDescriptor(Nc.prototype,"play"),Nc.prototype),vn(Nc.prototype,"stop",[i9],Object.getOwnPropertyDescriptor(Nc.prototype,"stop"),Nc.prototype),vn(Nc.prototype,"pipe",[s9],Object.getOwnPropertyDescriptor(Nc.prototype,"pipe"),Nc.prototype),vn(Nc.prototype,"unpipe",[a9],Object.getOwnPropertyDescriptor(Nc.prototype,"unpipe"),Nc.prototype),Nc),Ky=(o9=Nt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),c9=Nt({argsMap:(e,t)=>[e.getTrackId(),t]}),l9=Nt({argsMap:e=>[e.getTrackId()]}),d9=Nt({argsMap:e=>[e.getTrackId()]}),u9=Nt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),h9=Nt({argsMap:e=>[e.getTrackId()]}),vn((aa=class extends p9{get isPlaying(){return this._useAudioElement?Pa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,o){super(e,t,r,o),Se(this,"trackMediaType",Gy.AUDIO),Se(this,"_source",void 0),Se(this,"_useAudioElement",!0),Se(this,"_volume",100),Se(this,"processorContext",void 0),Se(this,"processorDestination",void 0),Se(this,"_played",!1),Se(this,"_bypassWebAudio",!1),Z("DISABLE_WEBAUDIO")?(this._source=new zk,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new v4(e,!0),Z("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ec.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Hy.FIRST_FRAME_DECODED)}),this.processorContext=new O4(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new N4(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ec.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ec.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ec.ON_AUDIO_BUFFER),this._source.on(ec.ON_AUDIO_BUFFER,r=>e(r))}setVolume(e){this._volume=e,this._useAudioElement?Pa.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!d4())throw new Ae(q.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Pa.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Ef(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),$o(this,ft.GET_STATS)||Nr({},p4)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),Pa.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Pa.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Pa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Ae(q.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Ae(q.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Ae(q.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ga.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(ga.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ga.ON_TRACK),this.processorDestination.removeAllListeners(ga.ON_NODE)}}).prototype,"setVolume",[o9],Object.getOwnPropertyDescriptor(aa.prototype,"setVolume"),aa.prototype),vn(aa.prototype,"setPlaybackDevice",[c9],Object.getOwnPropertyDescriptor(aa.prototype,"setPlaybackDevice"),aa.prototype),vn(aa.prototype,"play",[l9],Object.getOwnPropertyDescriptor(aa.prototype,"play"),aa.prototype),vn(aa.prototype,"stop",[d9],Object.getOwnPropertyDescriptor(aa.prototype,"stop"),aa.prototype),vn(aa.prototype,"pipe",[u9],Object.getOwnPropertyDescriptor(aa.prototype,"pipe"),aa.prototype),vn(aa.prototype,"unpipe",[h9],Object.getOwnPropertyDescriptor(aa.prototype,"unpipe"),aa.prototype),aa);const pu=new class extends Dr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Se(this,"_lastHiddenTime",0),Se(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class f9 extends Dr{constructor(t,r){super(),Se(this,"trackMediaType",Gy.DATA),Se(this,"_version",1),Se(this,"_type",3),Se(this,"_config",void 0),Se(this,"_originDataChannel",void 0),Se(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Se(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Se(this,"_datachannelEventMap",new Map),this._config=t,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return Z("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new nt((t,r)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const o=setTimeout(()=>{var c;r(new Ae(q.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Ae(q.DATACHANNEL_CONNECTION_TIMEOUT)}}else r(new Ae(q.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[UA.OPEN,UA.CLOSE,UA.ERROR].forEach(r=>{const o=()=>{this.emit(r)};this._datachannelEventMap.set(r,o),t.addEventListener(r,o)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[o,c]=r;t.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class One extends f9{constructor(t){super(t),Se(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=r.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(Z("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=r.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(UA.MESSAGE,u)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Dne extends f9{send(t){if(this._originDataChannel){let r=t;r=this._dataStreamPacketHandler.serialize(t);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function BA(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>BC.revokeObjectURL(e),0),new Worker(BC.createObjectURL(e))}const m9=71,Qk=1,$k=2,Jk=1,g9=2;var Fh=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Fh||{});function _9(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=e.getUint8(0);if(r!==m9)return;const o=e.getUint16(1),c=Qk+$k+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const f={m:r,tlvLen:o,tlv:[],frame:u};let g=Qk+$k;for(;g<c;){const E=e.getUint8(g),v=e.getUint16(g+Jk),S=Jk+g9;if(E===Fh.AUDIO_LEVEL){let R=e.getUint8(g+S);for(let I=1;I<v;I++)R=R<<8|e.getUint8(g+S+I);f.tlv.push({tag:E,length:v,value:t?127^R>>1:127&R})}else if(E===Fh.METADATA||E===Fh.AUDIO_64_BIT_PTS){const R=new Uint8Array(v);for(let I=0;I<v;I++)R[I]=e.getUint8(g+S+I);f.tlv.push({tag:E,length:v,value:R})}g+=S+v}return f}const HA=new Map,GA=127,Vg=1e-10,Zk=139/13,WA=new Map;function e1(e,t,r){const o="".concat(e,"-").concat(t,"-").concat(r);let c=0;return WA.has(o)?c=WA.get(o):(c=Math.log(function(f,g){const E=f-g;g<E&&(g=E);let v=1;for(let S=f,R=1;S>g;S--,R++)v=v*S/R;return v}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(r)+r*e,WA.set(o,c)),c<Vg&&(c=Vg),c}function E9(e,t,r){const o=t.length,c=e.length/o;let u=!1;for(let f=0,g=0;f<o;f++){let E=0;for(let v=g+c;g<v;g++)e[g]>r&&E++;t[f]!==E&&(t[f]=E,u=!0)}return u}window.cache=WA;let xne=0;class y9{constructor(t){Se(this,"id",void 0),Se(this,"immediates",[]),Se(this,"lastNonSilence",-1),Se(this,"immediateSpeechActivityScore",Vg),Se(this,"lastLevelChangedTime",Date.now()),Se(this,"levels",[]),Se(this,"longs",[]),Se(this,"longSpeechActivityScore",Vg),Se(this,"mediums",[]),Se(this,"mediumSpeechActivityScore",Vg),Se(this,"minLevel",0),Se(this,"nextMinLevel",0),Se(this,"nextMinLevelWindowLength",0),Se(this,"energyScore",0),this.id=t||"".concat(xne++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,r=this.levels,o=this.minLevel+Zk;let c=!1;for(let u=0;u<t.length;++u){let f=r[u];f<o&&(f=0);const g=Math.floor(f/Zk);t[u]!==g&&(t[u]=g,c=!0)}return c}computeLongs(){return E9(this.mediums,this.longs,4)}computeMediums(){return E9(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=e1(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=e1(this.longs[0],10,47),this.longSpeechActivityScore>Vg&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=e1(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(cE(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,r){if(this.lastLevelChangedTime<=r){this.lastLevelChangedTime=r;let o=t;return t<0&&(o=0),t>GA&&(o=GA),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+Zk?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let r=Math.sqrt(this.minLevel*this.nextMinLevel);r<0?r=0:r>GA&&(r=GA),this.minLevel=r,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Pne{constructor(t){Se(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const r=this.algorithm.runInDecisionMaker(this);r<=0?t=!0:setTimeout(this.execute.bind(this),r)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class t1{constructor(t,r,o){Se(this,"isDominant",void 0),Se(this,"energyRanking",void 0),Se(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=r,this.energyScore=o}}class kne extends Dr{constructor(t){super(),Se(this,"dominantId",null),Se(this,"lastDecisionTime",0),Se(this,"lastLevelChangedTime",0),Se(this,"lastLevelIdleTime",0),Se(this,"relativeSpeechActivities",[]),Se(this,"speakers",new Map),Se(this,"enableSilence",!1),Se(this,"timeoutToSilenceInterval",0),Se(this,"decisionMaker",null),Se(this,"loudest",[]),Se(this,"numLoudestToTrack",3),Se(this,"energyExpireTimeMs",250),Se(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,r=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,r!=null&&(this.energyExpireTimeMs=r),o!=null&&(this.energyAlphaPct=o),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(r=>r.id===t)}levelChanged(t,r){const o=Date.now(),c=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(r,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(r=>{this.speakers.has(r.id)||this.speakers.set(r.id,r)})}removeSpeakers(t){t.forEach(r=>{this.speakers.delete(r.id)})}getOrCreateSpeaker(t){let r=this.speakers.get(t);return r||(r=new y9(t),this.speakers.set(t,r),this.maybeStartDecisionMaker()),r}updateLoudestList(t,r,o){const c=t.id===this.dominantId;if(r<0){let E=0;for(;E<this.loudest.length&&this.loudest[E]!==t;)++E;return new t1(c,E,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*r+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new t1(c,0,t.energyScore);const u=o-this.energyExpireTimeMs;let f=0;for(;f<this.loudest.length;){const E=this.loudest[f];if(E.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(f,1);else if(E.id!==t.id)++f;else if(this.loudest.splice(f,1),this.loudest.length<this.numLoudestToTrack)break}let g=0;for(;g<this.loudest.length&&!(this.loudest[g].energyScore<t.energyScore);)++g;return g<this.numLoudestToTrack&&(this.loudest.splice(g,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new t1(c,g,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Pne(this),this.decisionMaker.execute())}makeDecision(t){let r=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var f;const g=Da(f=this.speakers).call(f).next().value;this.enableSilence&&g&&(u=g.id,g.evaluateSpeechActivityScores(t),t-g.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let g=this.dominantId==null?null:this.speakers.get(this.dominantId);if(g==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],g=S.value[1])}else u=g.id;g!=null&&g.evaluateSpeechActivityScores(t);const E=this.relativeSpeechActivities;let v=2;for(const S of this.speakers.entries()){const[R,I]=S;if(I===g)continue;I.evaluateSpeechActivityScores(t);for(let j=0;j<E.length;++j){const G=g==null?Vg:g.getSpeechActivityScore(j);E[j]=Math.log(I.getSpeechActivityScore(j)/G)}const D=E[0],V=E[1],M=E[2];D>3&&V>2&&M>0&&V>v&&(v=V,u=R)}this.enableSilence&&g!=null&&u===g.id&&t-g.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(r=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===r||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const t=Date.now(),r=300-(t-this.lastLevelIdleTime);let o=0;r<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):o=r;let c=300-(t-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=t,this.makeDecision(t),c=300-(Date.now()-t)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(t){const r=[];for(const c of Da(o=this.speakers).call(o)){var o;const u=t-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?r.push(c.id):300<u&&c.levelTimedOut()}r.forEach(c=>this.speakers.delete(c))}}const Xy=new Map;let ud=null,zA=null;const v9=3;let Fg=[];const hd=new Map,YA=new Map;class Lne{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,r){Se(this,"id",void 0),Se(this,"track",void 0),Se(this,"score",0),Se(this,"active",!0),Se(this,"muted",!1),Se(this,"timer",0),Se(this,"actives",0),Se(this,"inactives",0),this.id=t,this.track=r,this.setActive(hd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:r,inactives:o}=function(){const c=[],u=[];return Array.from(Da(hd).call(hd)).forEach(f=>{f.active?c.push(f):u.push(f)}),{actives:c,inactives:u}}();if(r.length>3){let c;r.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(r.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&t&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(r){let o;return Array.from(Da(hd).call(hd)).forEach(c=>{!c.active||c.id===r||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(r){let o;return Array.from(Da(hd).call(hd)).forEach(c=>{c.active||c.id===r||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let qA;function S9(e){const t=hd.get(e);t&&(hd.delete(e),t.clearTimer())}const KA=new Map,Mne=new Map;function jne(e,t,r){let o=new Uint8Array(e,t,r),c=[],u=0;for(;c.length<r;)u+3<r&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const XA=new Map,Mb=new Map;(function(){const e=An();ss.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ss.getStreamFromExtension=e.name===Un.CHROME&&Number(e.version)>34,ss.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let r=!1;try{t.addTransceiver("audio"),r=!0}catch{}return t.close(),r}(),ss.supportMinBitrate=e.name===Un.CHROME||e.name===Un.EDGE,ss.supportSetRtpSenderParameters=function(){const t=An();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!jh()||!(!fs()&&!RA())||t.name===Un.FIREFOX&&Number(t.version)>=64)}(),e.name===Un.SAFARI&&(Number(e.version)>=14?ss.supportDualStream=!0:ss.supportDualStream=!1),ss.webAudioMediaStreamDest=function(){const t=An();return!(t.name===Un.SAFARI&&Number(t.version)<12)}(),ss.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ss.supportWebGL=typeof WebGLRenderingContext<"u",ss.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,jh()||(ss.webAudioWithAEC=!0),ss.supportShareAudio=function(){const t=An();return(t.os===Fi.WIN_10||t.os===Fi.WIN_81||t.os===Fi.WIN_7||t.os===Fi.LINUX||t.os===Fi.MAC_OS||t.os===Fi.CHROMIUM_OS)&&t.name===Un.CHROME&&Number(t.version)>=74}(),ss.supportDataChannel=!!(wb(76)||function(t){const r=An();return!(r.name!==Un.FIREFOX||!r.osVersion)&&Number(r.version)>=t}(68)||b3(14)),ss.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Fr()&&!!t&&t.prototype.setConfiguration instanceof Function}(),ss.supportWebRTCEncodedTransform=function(){const t=An();return t.name==="Chrome"&&Number(t.version)>=87||t.name==="Safari"&&Number(t.version)>=15}(),ss.supportWebRTCInsertableStream=function(){const t=An();return(t.name===Un.CHROME||t.name===Un.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ss.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ss.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,IA(()=>{ss.supportDualStreamEncoding=function(){const t=An();return!!Z("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&Z("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",e),x.info("browser compatibility: ",ss)})})();const Une=["CHINA","GLOBAL"],T9=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Bg=[],Qy=[];function Hg(e,t){return!!t&&Bg.some(r=>r.uid===e&&r.channelName===t)}function n1(){return Qy.length>0}var Vne=FF.forEach,b9=ih("forEach")?[].forEach:function(e){return Vne(this,e,arguments.length>1?arguments[1]:void 0)};xn({target:"Array",proto:!0,forced:[].forEach!==b9},{forEach:b9});var Fne=vo("Array","forEach"),Bne=Wl,Hne=ci,Gne=U,Wne=Fne,r1=Array.prototype,zne={DOMTokenList:!0,NodeList:!0},Yne=function(e){var t=e.forEach;return e===r1||Gne(r1,e)&&t===r1.forEach||Hne(zne,Bne(e))?Wne:t},qne=l(Yne),Kne=_o,w9=Pp;xn({target:"Object",stat:!0,forced:p(function(){w9(1)})},{keys:function(e){return w9(Kne(e))}});var Xne=l(Gt.Object.keys),Qne=l(jd),$ne=l(AS),Jne=xn,R9=Jc,Zne=Jm,ere=kt,C9=Ue,tre=Yn,nre=Dt,rre=Yx,ire=Mr,sre=Na,are=OF("slice"),ore=ire("species"),i1=Array,cre=Math.max;Jne({target:"Array",proto:!0,forced:!are},{slice:function(e,t){var r,o,c,u=nre(this),f=tre(u),g=C9(e,f),E=C9(t===void 0?f:t,f);if(R9(u)&&(r=u.constructor,(Zne(r)&&(r===i1||R9(r.prototype))||ere(r)&&(r=r[ore])===null)&&(r=void 0),r===i1||r===void 0))return sre(u,g,E);for(o=new(r===void 0?i1:r)(cre(E-g,0)),c=0;g<E;g++,c++)g in u&&rre(o,c,u[g]);return o.length=c,o}});var lre=vo("Array","slice"),dre=U,ure=lre,s1=Array.prototype,hre=function(e){var t=e.slice;return e===s1||dre(s1,e)&&t===s1.slice?ure:t},pre=l(hre);function _t(e,t,r,o,c){var u,f,g,E={};return qne(u=Xne(o)).call(u,function(v){E[v]=o[v]}),E.enumerable=!!E.enumerable,E.configurable=!!E.configurable,("value"in E||E.initializer)&&(E.writable=!0),E=Qne(f=$ne(g=pre(r).call(r)).call(g)).call(f,function(v,S){return S(e,t,v)||v},E),c&&E.initializer!==void 0&&(E.value=E.initializer?E.initializer.call(c):void 0,E.initializer=void 0),E.initializer===void 0?(CF(e,t,E),null):E}let QA=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),a1=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),yl=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),_a=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Ct=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),ur=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Lt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),xt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),jb=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),fn=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Ea=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Wt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function $A(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw x.error("Invalid Channel Name ".concat(e)),new Te(q.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function JA(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||D3(e,1,255)))throw new Te(q.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Bh=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const fre={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},o1={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function c1(e,t){rs(e.url,"".concat(t,".url"),1,1e3,!1),Br(e.x)||Jn(e.x,"".concat(t,".x"),0,1e4),Br(e.y)||Jn(e.y,"".concat(t,".y"),0,1e4),Br(e.width)||Jn(e.width,"".concat(t,".width"),0,1e4),Br(e.height)||Jn(e.height,"".concat(t,".height"),0,1e4),Br(e.zOrder)||Jn(e.zOrder,"".concat(t,".zOrder"),0,255),Br(e.alpha)||Jn(e.alpha,"".concat(t,".alpha"),0,1,!1)}const mre={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Sf=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),l1=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Oi=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function A9(e){if(!e.channelName)throw new Te(q.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Te(q.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&rs(e.token,"info.token",1,2047),JA(e.uid),$A(e.channelName),!0}let ya=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Hh=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),no=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),$y=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Hn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Ki=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),ZA=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Hi=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Vn=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const I9=[Vn.AFRICA,Vn.ASIA,Vn.CHINA,Vn.EUROPE,Vn.GLOBAL,Vn.INDIA,Vn.JAPAN,Vn.NORTH_AMERICA,Vn.OCEANIA,Vn.OVERSEA,Vn.SOUTH_AMERICA];let ks=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const eI={CHINA:{},ASIA:{CODE:ks.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ks.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ks.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ks.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ks.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ks.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ks.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ks.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ks.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ks.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ks.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ks.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ks.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Ok&&(eI.CHINA={CODE:ks.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Ub=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function N9(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class O9 extends Dr{constructor(t,r){super(),H(this,"onICEConnectionStateChange",void 0),H(this,"onConnectionStateChange",void 0),H(this,"onDTLSTransportStateChange",void 0),H(this,"onDTLSTransportError",void 0),H(this,"onICETransportStateChange",void 0),H(this,"onFirstAudioReceived",void 0),H(this,"onFirstVideoReceived",void 0),H(this,"onFirstAudioDecoded",void 0),H(this,"onFirstVideoDecoded",void 0),H(this,"onFirstVideoDecodedTimeout",void 0),H(this,"onSelectedLocalCandidateChanged",void 0),H(this,"onSelectedRemoteCandidateChanged",void 0),H(this,"onICECandidateError",void 0),H(this,"getLocalVideoStats",void 0)}}class D9 extends O9{constructor(t,r){super(t,r),H(this,"establishPromise",void 0)}}let lt=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Ls=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),Gh=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const x9=["disconnected","failed"];let Ve=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Bn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Rt=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),vl=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Sl=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Xi=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),P9=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),fu=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Oc=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),pd=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Jy=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ni=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Zy=function(e){return e.ABORT="abort",e}({}),Tf=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),gre=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const _re={[QA.ACCESS_POINT]:{[_a.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[_a.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[_a.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[_a.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[_a.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[_a.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[_a.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[QA.UNILBS]:{[yl.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[yl.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[yl.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[yl.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[yl.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[yl.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[yl.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[yl.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[yl.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[yl.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[yl.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[yl.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[QA.STRING_UID_ALLOCATOR]:{[a1.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[a1.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[a1.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function ev(e){const t=_re[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===QA.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}const Ere={[Ct.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ct.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ct.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ct.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ct.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ct.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ct.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ct.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ct.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ct.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ct.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ct.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ct.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ct.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ct.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ct.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ct.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ct.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ct.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ct.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ct.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ct.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ct.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ct.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ct.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ct.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ct.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ct.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ct.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ct.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ct.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ct.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ct.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ct.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ct.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ct.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ct.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ct.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ct.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ct.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ct.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ct.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ct.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ct.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ct.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ct.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ct.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ct.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ct.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ct.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ct.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ct.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ct.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ct.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ct.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ct.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ct.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ct.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ct.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ct.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ct.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ct.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ct.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Vb(e){return Ere[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function k9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function d1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?k9(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k9(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function u1(e,t){if(typeof e=="string")return e;const{proxy:r,host:o,port:c}=e;if(t){const u=Z("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const yre=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,vre=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Sre=/wss:\/\/(.+):([0-9]+)\/?/,Tre=/wss:\/\/(.[^\/]+)\/?/;let bre=0;class wre{constructor(t,r){H(this,"id",0),H(this,"store",void 0),H(this,"recordIndex",void 0),H(this,"websockets",[]),H(this,"try443PortDuration",2e3),H(this,"forceCloseWSDuration",5e3),H(this,"try443PortTimeout",null),H(this,"forceCloseTimeout",null),H(this,"isTry443PortFailed",!1),H(this,"isNormalPortFailed",!1),H(this,"useDoubleDomain",!1),H(this,"useProxy",!1),H(this,"startTime",Date.now()),this.id=++bre,this.try443PortDuration=Z("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const r=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];x.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...c)}createWebSocket(t,r,o){this.logger("createWebSocket:",t,{isTry443Port:r,hasTimeoutDetection:o});const c=Z("GATEWAY_DOMAINS"),u=Date.now(),f=[],g=c.find(I=>{var D;return et(D=t.host).call(D,I)});g||(this.useDoubleDomain=!1);const E=[];if(this.useDoubleDomain)c.forEach(I=>{E.push(u1(d1(d1({},t),{},{host:t.host.replace(g,I)}),r))});else{const I=d1({},t);if(r&&g){const D=c.find(V=>V!==g);D&&(I.host=I.host.replace(g,D))}E.push(u1(I,r))}try{E.forEach(I=>{const D=new WebSocket(I);D.binaryType="arraybuffer",f.push(D),this.logger("ws is connecting:",D.url)})}catch(I){if(this.logger("ws create failed"),f.forEach(D=>D.close()),f.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,r,o);if(!r&&Number(t.port)!==443)return this.createWebSocket(t,!0,o);throw new Te(q.WS_ERR,"init websocket failed! Error: ".concat(I.toString()))}const v=bb();this.store&&this.store.recordJoinChannelService({urls:f.map(I=>I.url),service:"gateway"},this.recordIndex),f.forEach(I=>{I.onopen=()=>{this.logger("onopen: ws ".concat(I.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(D=>{D!==I&&(D.onopen=null,D.onclose=null,D.onmessage=null,D.close(),this.logger("close backup websocket: ".concat(D.url)))}),this.websockets.length=0,v.resolve(I)},I.onclose=D=>{this.logger("onclose: ws ".concat(I.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(I.readyState));const V=f.every(M=>M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING);this.logger("".concat(r?"443":"47xx"," websocket closed, all failed: ").concat(V)),V&&(r||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(D.reason)),v.reject({code:D.code,reason:ZA.A_ROUND_WS_FAILED})):!r&&V&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),r?this.isTry443PortFailed=V:this.isNormalPortFailed=V},I.onmessage=D=>this.logger("".concat(I.url," onmessage: ").concat(D.data))}),this.websockets.push(...f);const S=()=>{this.websockets.forEach(I=>I.readyState!==WebSocket.OPEN&&I.close())},R=()=>{if(v.isResolved)return S();An().os===Fi.MAC_OS&&Fr()&&S(),this.createWebSocket(t,!0,!0).then(I=>{v.resolve(I)}).catch(I=>{this.isNormalPortFailed&&v.reject(I),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(t,r,o,c){return this.useDoubleDomain=!!r,typeof t=="string"&&(t=function(u){let f,g,E;return[,f,g,E]=u.match(yre)||[],f||([,g,E]=u.match(vre)||[]),g&&E||([,g,E]=u.match(Sre)||[]),g&&E||([,g]=u.match(Tre)||[]),g||x.warning("un-destructible url: ",u),{proxy:f,host:g,port:E||"443"}}(t)),this.recordIndex=c,this.useProxy=!!t.proxy,o&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(t,!!o,!1).finally(()=>this.clearTimeout())}}function L9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}class M9 extends Dr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var r;et(r=["tryNext","recover"]).call(r,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Wt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Wt.CONNECTED):this._state==="closed"?this.emit(Wt.CLOSED):this._state==="failed"&&this.emit(Wt.FAILED))}resetReconnectCount(t){x.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,r){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],f=arguments.length>5?arguments[5]:void 0;super(),H(this,"_websocketUrl",null),H(this,"connectionID",0),H(this,"currentURLIndex",0),H(this,"urls",[]),H(this,"_reconnectMode","tryNext"),H(this,"reconnectReason",void 0),H(this,"_initMutex",void 0),H(this,"name",void 0),H(this,"_state","closed"),H(this,"reconnectInterrupter",void 0),H(this,"websocket",void 0),H(this,"retryConfig",void 0),H(this,"reconnectCount",0),H(this,"forceCloseTimeout",5e3),H(this,"onlineReconnectListener",void 0),H(this,"useCompress",void 0),H(this,"tryDoubleDomain",!1),H(this,"use443PortOnly",!1),H(this,"wsInflateLength",0),H(this,"wsDeflateLength",0),H(this,"closeEstablishingWs",()=>{}),H(this,"store",void 0),H(this,"joinGatewayRecordIndex",void 0),this.store=f,this.name=t,this.retryConfig=function(R){for(var I=1;I<arguments.length;I++){var D=arguments[I]!=null?arguments[I]:{};I%2?L9(Object(D),!0).forEach(function(V){H(R,V,D[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(D)):L9(Object(D)).forEach(function(V){Object.defineProperty(R,V,Object.getOwnPropertyDescriptor(D,V))})}return R}({},r),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Ps("websocket",f?f.clientId:void 0);const{timeout:g,timeoutFactor:E}=r,v=Math.max(300,Math.floor(3*g/5)),S=Math.max(1.2,Math.floor(8*E)/10);Oo.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=S),ui.on(Py.NETWORK_STATE_CHANGE,(R,I)=>{R!==I&&(this.resetReconnectCount("network state change: ".concat(I," -> ").concat(R)),R===Oo.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=E))})}getConnection(){return this.websocket||void 0}async init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=r,this.urls=t,this.state="connecting";try{const c=bb(),u=this.urls[this.currentURLIndex];Z("ENABLE_PREALLOC_PC")&&this.emit(P9.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(Wt.CLOSED,()=>{c.reject(new Ae(q.WS_DISCONNECT))}),this.once(Wt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(t,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;r?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,r){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:r})}sendMessage(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Ae(q.WS_ABORT,"websocket is not ready");try{r||(t=JSON.stringify(t)),this.websocket.send(t)}catch(o){throw new Ae(q.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var r;const o=bb();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async S=>{var R;if(x.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Ae(q.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const I=$o(this,Wt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,D=await this.reconnectWithAction(I);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!D)return o.reject(new Ae(q.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},f=S=>{this.emit(Wt.ON_MESSAGE,S)},g=S=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),Z("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=Z("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),t);const E=(r=this.store)===null||r===void 0?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;this._websocketUrl=u1(t);const S=await this.chooseBestWebsocketConnection(t);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=f,this.websocket.onerror=g,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},E),this.joinGatewayRecordIndex=E}catch(S){const R=this.state==="closed",I=S instanceof Ae,D=I&&S.code===q.WS_ABORT,V=I&&S.code===q.WS_ERR,M=I?S.message:S&&(S.reason||S.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(M)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:D?"aborted":"error",errors:[S]},E),R||V?(o.reject(R?new Ae(q.WS_DISCONNECT,"websocket is closed: ".concat(M)):new Ae(q.WS_ERR,"init websocket failed: ".concat(M))),V&&x.error("[".concat(this.name,"] init websocket failed: ").concat(M))):u&&u(S)}return o.promise}async reconnectWithAction(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||ui.isOnline||!ui.onlineWaiter||(this.onlineReconnectListener=ui.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,r){const f=Tk(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(f,"ms to reconnect websocket, mode: ").concat(t)),await nt.race([is(f),this.onlineReconnectListener||new nt(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(f,g)=>{this.emit(Wt.RECONNECT_CREATE_CONNECTION,g),await this.createWebSocketConnection(f)};try{if(t==="retry")await c(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],t)}else t==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await gs(this,Wt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],t))}catch(f){var u;x.error("[".concat(this.name,"] reconnect failed ").concat(f&&f.toString()));const g=f==null||(u=f.data)===null||u===void 0?void 0:u.desc;return Array.isArray(g)&&et(g).call(g,"dynamic key expired")?(this.emit(Wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,r)}return!0}}class h1 extends M9{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){const o=bb(),c=function(f,g){return new wre(f,g)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new Ae(q.WS_ABORT,"choose best websocket aborted"))};const u=Z("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",t,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,r).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Fb extends M9{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){return new nt((o,c)=>{let u=!1;const f=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),f.forEach(V=>{V.onclose=null,V.onopen=null,V.onmessage=null,V.close()}),c(new Ae(q.WS_ABORT,"choose best websocket aborted"))};const g=Z("GATEWAY_DOMAINS");let E;const v=t.indexOf("?h="),S=g.find(V=>v!==-1?et(t).call(t,V,v):et(t).call(t,V));x.debug("[choose-best-ws] currentDomain: ",S,", domains: ",g);let R=!this.tryDoubleDomain||!S;if(!R&&S){var I;const V=Date.now();try{g.forEach(M=>{const j=v===-1?t.replace(S,M):t.substr(0,v)+t.substr(v).replace(S,M),G=new WebSocket(j);G.binaryType="arraybuffer",f.push(G),x.debug("[choose-best-ws] ws is connecting:",G.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),f.forEach(j=>j.close());f.length;)f.pop();R=!0}(I=this.store)===null||I===void 0||I.recordJoinChannelService({urls:f.map(M=>M.url),service:"gateway"},r),f.forEach(M=>{M.onopen=()=>{if(u)return;const j=Date.now()-V;x.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),f.filter(G=>G!==M).forEach(G=>{x.debug("[choose-best-ws]close backup websocket: ".concat(G.url)),G.close()}),u=!0,o(M)},M.onclose=j=>{E=j,!u&&(f.find(G=>!(G.readyState===WebSocket.CLOSED||G.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),u=!0,c(E)))},M.onmessage=j=>{x.debug("[choose-best-ws]".concat(M.url," onmessage: ").concat(j.data))}}),is(this.forceCloseTimeout).then(()=>{f.forEach(M=>{M.readyState!==WebSocket.OPEN&&M.close()})})}if(R){var D;let V;x.debug("[choose-best-ws] use single url: ",t),(D=this.store)===null||D===void 0||D.recordJoinChannelService({urls:[t],service:"gateway"},r);try{V=new WebSocket(t),f.push(V),V.binaryType="arraybuffer"}catch(M){const j=new Ae(q.WS_ERR,"init websocket failed! Error: ".concat(M.toString()));return x.error("[".concat(this.name,"]").concat(j)),void c(j)}V.onopen=()=>{o(V)},V.onclose=M=>{c(M)},V.onmessage=M=>{x.debug("[choose-best-ws]".concat(V.url," onmessage: ").concat(M.data))},is(this.forceCloseTimeout).then(()=>{V&&V.readyState!==WebSocket.OPEN&&V.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class Rre extends Dr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===ur.CONNECTED?this.emit(Lt.WS_CONNECTED):t===ur.RECONNECTING?this.emit(Lt.WS_RECONNECTING,this._websocketReconnectReason):t===ur.CLOSED&&this.emit(Lt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),H(this,"_disconnectedReason",void 0),H(this,"_websocketReconnectReason",void 0),H(this,"_connectionState",ur.CLOSED),H(this,"reconnectToken",void 0),H(this,"websocket",void 0),H(this,"openConnectionTime",void 0),H(this,"clientId",void 0),H(this,"lastMsgTime",Date.now()),H(this,"uploadCache",[]),H(this,"uploadCacheInterval",void 0),H(this,"rttRolling",new q3(5)),H(this,"pingpongTimer",void 0),H(this,"wsInflateDataTimer",void 0),H(this,"pingpongTimeoutCount",0),H(this,"joinResponse",void 0),H(this,"multiIpOption",void 0),H(this,"initError",void 0),H(this,"spec",void 0),H(this,"store",void 0),H(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Lt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===fn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===fn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Fn.UID_BANNED);break;case 15:this.close(Fn.IP_BANNED);break;case 16:this.close(Fn.CHANNEL_BANNED)}if(c._type===fn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ct.ERR_LICENSE_MISSING:this.close(Fn.LICENSE_MISSING);break;case Ct.ERR_LICENSE_EXPIRED:this.close(Fn.LICENSE_EXPIRED);break;case Ct.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Fn.LICENSE_MINUTES_EXCEEDED);break;case Ct.ERR_LICENSE_PERIOD_INVALID:this.close(Fn.LICENSE_PERIOD_INVALID);break;case Ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Fn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ct.ERR_LICENSE_ILLEGAL:this.close(Fn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new h1("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Z("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ur.CONNECTED&&this.reconnect("retry",ms.OFFLINE)})}async request(t,r,o,c){const u=lr(6,""),f={_id:u,_type:t,_message:r},g=this.websocket.connectionID,E=()=>new nt((V,M)=>{if(this.connectionState===ur.CONNECTED)return V();const j=()=>{this.off(Lt.WS_CLOSED,G),V()},G=()=>{this.off(Lt.WS_CONNECTED,j),M(new Te(q.WS_ABORT))};this.once(Lt.WS_CONNECTED,j),this.once(Lt.WS_CLOSED,G),t!==xt.PUBLISH&&t!==xt.PUBLISH_DATASTREAM&&t!==xt.SUBSCRIBE&&t!==xt.SUBSCRIBE_DATASTREAM&&t!==xt.UNSUBSCRIBE&&t!==xt.UNSUBSCRIBE_DATASTREAM&&t!==xt.UNPUBLISH&&t!==xt.UNPUBLISH_DATASTREAM&&t!==xt.CONTROL&&t!==xt.RESTART_ICE||this.once(Lt.DISCONNECT_P2P,()=>{M(new Te(q.DISCONNECT_P2P))}),t!==xt.PUBLISH&&t!==xt.RESTART_ICE||this.once(Lt.ABORT_P2P_EXECUTION,()=>{M(new Te(q.DISCONNECT_P2P))})});if(this.connectionState!==ur.CONNECTING&&this.connectionState!==ur.RECONNECTING||t===xt.JOIN||t===xt.REJOIN||await E(),this.websocket.sendMessage(f,!0),c)return;const v=new nt((V,M)=>{let j=!1;const G=(ce,Ee)=>{j=!0,V({isSuccess:ce==="success",message:Ee||{}}),this.off(Lt.WS_CLOSED,z),this.off(Lt.WS_RECONNECTING,z),this.emit(Lt.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(u),G);const z=()=>{M(new Te(q.WS_ABORT,"type: ".concat(t))),this.off(Lt.WS_CLOSED,z),this.off(Lt.WS_RECONNECTING,z),this.off("res-@".concat(u),G)};this.once(Lt.WS_CLOSED,z),this.once(Lt.WS_RECONNECTING,z),is(Z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==g||j||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Lt.REQUEST_TIMEOUT,t,r))})});let S=null;try{S=await v}catch(V){if(this.connectionState===ur.CLOSED||t===xt.LEAVE)throw new Te(q.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?V.throw():t===xt.JOIN||t===xt.REJOIN?null:(await E(),await this.request(t,r))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),I=Vb(R),D=new Te(q.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:I.desc});return I.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(R,", message: ").concat(I.desc,", action: ").concat(I.action)),R===Ct.ERR_TOO_MANY_BROADCASTERS?((t===xt.JOIN||t===xt.REJOIN)&&(this.initError=D,this.close()),D.throw()):I.action==="failed"?D.throw():I.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===Ct.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ms.MULTI_IP)):this.reconnect(I.action,ms.SERVER_ERROR),t===xt.JOIN||t===xt.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new nt(o=>{const c=u=>{(!r||r(u))&&(this.off(t,c),o(u))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(jb.WRTC_STATS,r)}upload(t,r){const o={_type:t,_message:r};try{this.websocket.sendMessage(o)}catch{const u=Z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ur.CONNECTED)return;const f=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(f._type,f._message)},Z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const o={_type:t,_message:r};this.websocket.sendMessage(o)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new nt((r,o)=>{this.once(Lt.WS_CONNECTED,()=>r(this.joinResponse)),this.once(Lt.WS_CLOSED,c=>o(this.initError||new Te(q.WS_ABORT,c))),this.connectionState=ur.CONNECTING,this.websocket.init(t).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Fn.LEAVE,this.connectionState=ur.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Lt.ABORT_P2P_EXECUTION);const t=await gs(this,Lt.REQUEST_JOIN_INFO),r=await this.request(xt.JOIN,t);if(!r)return this.emit(Lt.REPORT_JOIN_GATEWAY,ZA.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(Lt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ur.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Te(q.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Nb(this,Lt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const r=await this.request(xt.REJOIN,t);return!!r&&(this.connectionState=ur.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r.peers&&r.peers.forEach(o=>{this.emit(fn.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(fn.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(fn.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(fn.MUTE_AUDIO,{uid:o.uid}):this.emit(fn.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(fn.MUTE_VIDEO,{uid:o.uid}):this.emit(fn.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(fn.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(fn.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(fn.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(fn.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(fn.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleNotification(t){x.debug("[".concat(this.clientId,"] receive notification: "),t);const r=Vb(t.code);if(t.code===28&&"detail"in t&&(x.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(Lt.RECOVER_NOTIFICATION,t.detail)),r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Fn.UID_BANNED),void this.close()):void this.reconnect(r.action,ms.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=Z("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>Z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ms.TIMEOUT):this.request(xt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-r;this.rttRolling.add(o),Z("REPORT_STATS")&&this.send(xt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:r}=this.websocket.getWsInflateData();t!==0&&r!==0&&this.upload(jb.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Wt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Lt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Wt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Wt.CLOSED,()=>{this.connectionState=ur.CLOSED}),this.websocket.on(Wt.FAILED,()=>{this._disconnectedReason=Fn.NETWORK_ERROR,this.connectionState=ur.CLOSED}),this.websocket.on(Wt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===ur.CONNECTED?this.connectionState=ur.RECONNECTING:this.connectionState=ur.CONNECTING}),this.websocket.on(Wt.WILL_RECONNECT,(t,r,o)=>{const c=Nb(this,Lt.IS_P2P_DISCONNECTED),u=c||t!=="retry";c&&t==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",r=ZA.P2P_DISCONNECTED),u&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Lt.REPORT_JOIN_GATEWAY,r||ZA.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Lt.DISCONNECT_P2P)),o(t)}),this.websocket.on(Wt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",ms.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Lt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Te){if(t.code===q.UNEXPECTED_RESPONSE&&t.data.code===Ct.ERR_NO_AUTHORIZED)return this.initError=new Te(q.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Fn.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ms.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(Wt.REQUEST_NEW_URLS,(t,r)=>{gs(this,Lt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(Wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(fn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(P9.PRE_CONNECT_PC,()=>{this.emit(Lt.PRE_CONNECT_PC)})}}let Cre=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),hi=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function j9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function tI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?j9(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j9(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function bf(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(Z("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function p1(e,t){e.addresses||(e.addresses=[]);const r=function(g,E){if(Z("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return g.map(R=>{let{ip:I,port:D}=R;return{address:"".concat(I,":").concat(D)}});const v=Z("GATEWAY_DOMAINS");let S=v[1]&&et(E).call(E,v[1])?1:0;return g.map(R=>{let{domain_prefix:I,port:D,ip:V}=R;if(I)return{address:"".concat(I,".").concat(v[S++%v.length],":").concat(D)};const M=/^[\.\:\d]+$/.test(V),j=M?"".concat(V.replace(/[^\d]/g,"-"),".").concat(v[S++%v.length],":").concat(D):"".concat(V,":").concat(D);return M||x.debug("Cannot recognized as ip address: ".concat(V,", use as host")),{ip:V,port:D,address:j}})}(e.addresses,t),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const g=o.split(";");for(let E=0;E<g.length;E++){var c;const v=sa(c=g[E]).call(c);r[E]&&v&&(r[E].ip6=v)}}const u=e.detail&&e.detail.candidate;let f;if(u){const[g,E]=u.split(":");g&&E&&(f={port:Number(E),ip:g,address:"".concat(g,":").concat(E)})}return{gatewayAddrs:r,apGatewayAddress:f,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Do(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function U9(e){const t=e._encoderConfig;if(!t)return{};const r={resolution:t.width&&t.height?"".concat(Do(t.width),"x").concat(Do(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function V9(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Bb(e,t){let r,o,c;switch(t){case hi.CHOOSE_SERVER:o=4096,c="choose server";break;case hi.CLOUD_PROXY:o=1048576,c="proxy";break;case hi.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case hi.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Te(q.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(r={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(f=>tI(tI({},f),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:tI(tI({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!r)throw new Te(q.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function F9(e,t){return await nt.all(e.addresses.map(async r=>({address:Z("USE_TURN_IP")?r.ip:bf(r.ip),tcpport:r.port,udpport:r.port,username:t&&Z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():_s.username,password:t&&Z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await _k(t.toString()):_s.password})))}function f1(e,t){const r=t.getMediaStreamTrack(!0).getSettings(),o=t.videoHeight||r.height,c=t.videoWidth||r.width;return o&&c?Math.max(Math.min(o,c)/Math.min(Do(e.height),Do(e.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function wf(e){let{candidateType:t,relayProtocol:r,type:o,address:c,port:u,protocol:f}=e;const g={candidateType:t,relayProtocol:r,protocol:f};if(o!=="local-candidate"){const E=c.split(".");E.length>=4&&(E[1]="*",E[2]="*"),g.address=E.join("."),g.port=u}return g}function nI(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Z("SVC_MODE");if(Z("ENABLE_SVC"))return function(t){return t in xA}(e)?e:xA.L1T3}const B9={[lt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[lt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function rI(e,t,r){t.forEach(o=>{var c;const u=B9[e].find(g=>{var E;let{key:v}=g;return et(E=o.extensionName).call(E,v)});if(!u)return;const f=r.find(g=>{let{extensionName:E}=g;return et(E).call(E,u.key)});f&&et(c=f.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=f.extensionName)})}function tv(e,t){t.forEach(r=>{var o;const c=B9[e].find(u=>{var f;let{key:g}=u;return et(f=r.extensionName).call(f,g)});et(o=r.extensionName).call(o,"gdpr_forbidden")&&c&&(r.extensionName=c.extensionName)})}function H9(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||et(e).call(e,"abs-send-time")}function iI(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||et(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function G9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function W9(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?G9(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G9(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function Hb(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:f,filterAudioCodec:g,filterVideoCodec:E}=t,{useXR:v}=r;let S=[],R=[],I=[],D=[],V=!1,M=!1;if(to(e).mediaDescriptions.forEach(G=>{o&&o!==G.attributes.direction||(G.media.mediaType!=="video"||V||(R=G.attributes.payloads,D=G.attributes.extmaps,V=!0),G.media.mediaType!=="audio"||M||(S=G.attributes.payloads,I=G.attributes.extmaps,M=!0))}),!D||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!I||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(G=>{var z;(z=G.rtpMap)!==null&&z!==void 0&&z.clockRate&&(G.rtpMap.clockRate=parseInt(G.rtpMap.clockRate)),v&&G.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(G=>{var z;(z=G.rtpMap)!==null&&z!==void 0&&z.clockRate&&(G.rtpMap.clockRate=parseInt(G.rtpMap.clockRate)),v&&G.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(G=>{var z;return((z=G.rtpMap)===null||z===void 0?void 0:z.encodingName.toLowerCase())!=="rtx"}),R=R.filter(G=>{var z;return((z=G.rtpMap)===null||z===void 0?void 0:z.encodingName.toLowerCase())!=="rtx"})),u&&(R=R.filter(G=>{var z;return!/(red)|(ulpfec)|(flexfec)/i.test(((z=G.rtpMap)===null||z===void 0?void 0:z.encodingName)||"")})),f&&(S=S.filter(G=>{var z;return!/(red)|(ulpfec)|(flexfec)/i.test(((z=G.rtpMap)===null||z===void 0?void 0:z.encodingName)||"")})),g&&(g==null?void 0:g.length)>0&&(S=S.filter(G=>{var z;return et(g).call(g,((z=G.rtpMap)===null||z===void 0?void 0:z.encodingName.toLowerCase())||"")})),E&&(E==null?void 0:E.length)>0){const G=R.filter(z=>{var ce;return et(E).call(E,((ce=z.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLowerCase())||"")});R=G.concat(c?[]:_1(G,R))}const j=Z("UNSUPPORTED_VIDEO_CODEC");return j&&j.length>0&&(R=R.filter(G=>!(G.rtpMap&&et(j).call(j,G.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:R,audioExtensions:I,videoExtensions:D}}function Rf(e){const t=to(e);let r,o;for(const c of t.mediaDescriptions){if(!r){const u=c.attributes.iceUfrag,f=c.attributes.icePwd;if(!u||!f)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:u,icePwd:f}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&t.attributes.fingerprints.length>0&&(o={fingerprints:t.attributes.fingerprints}),!o||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:o}}function z9(e,t){const r=[],o=e.attributes.ssrcGroups.filter(f=>f.semantic==="FID"),c=e.attributes.ssrcGroups.find(f=>f.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(f=>{var g;const E=(g=o.find(v=>v.ssrcIds[0]===f))===null||g===void 0?void 0:g.ssrcIds[1];r.push({ssrcId:f,rtx:t?E:void 0})});else if(o.length>0){const f=o[0].ssrcIds[0],g=o[0].ssrcIds[1];r.push({ssrcId:f,rtx:t?g:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:u[0].ssrcId})}return r}function Y9(e,t,r){const{cname:o}=e;let c=[];t&&(c=q9(t)),c.length===0&&(c=e.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),x.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},f={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let g;switch(e.dtlsParameters.role){case"server":g="passive";break;case"client":g="active";break;case"auto":g="actpass"}const E=aI(e.rtpCapabilities),v=[];return Array.isArray(r)&&r.length>0&&r.forEach(S=>{v.push({kind:lt.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:lt.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:f,candidates:c,rtpCapabilities:E,setup:g,cname:o,preSSRCs:v}}function q9(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function Gg(e,t,r){const o=[],c=[];return e.forEach(u=>{let{ssrcId:f,rtx:g}=u;const E=lr(8,"track-"),v={ssrcId:f,attributes:W9({label:E,mslabel:r=r||lr(10,""),msid:"".concat(r," ").concat(E)},t&&{cname:t})};if(o.push(v),g!==void 0){const S={ssrcId:g,attributes:W9({label:E,mslabel:r,msid:"".concat(r," ").concat(E)},t&&{cname:t})};o.push(S),c.push({semantic:"FID",ssrcIds:[f,g]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:f}=u;return f})}),{ssrcs:o,ssrcGroups:c}}function nv(e,t){t instanceof qr&&e.attributes.payloads.forEach(r=>{var o;const c=(o=r.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;r.fmtp||(r.fmtp={parameters:{}}),c==="opus"&&typeof Z("OPUS_PTIME")=="number"?r.fmtp.parameters.ptime=Z("OPUS_PTIME"):r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";const u=t._encoderConfig;u&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Fr()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1")),t instanceof Lb&&c==="opus"&&t._config.DTX&&(r.fmtp.parameters.usedtx="1"))})}function m1(e){const t=e.attributes.unrecognized.findIndex(r=>r.attField==="x-google-flag"&&r.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function g1(e,t){var r;if(!(t instanceof gr&&t._encoderConfig&&t._hints.indexOf(Zn.SCREEN_TRACK)===-1))return;const o=t._encoderConfig;In().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,f;et(u=["h264","h265","vp8","vp9","av1"]).call(u,((f=c.rtpMap)===null||f===void 0?void 0:f.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),In().supportMinBitrate&&!et(r=t._hints).call(r,Zn.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,f;et(u=["h264","h265","vp8","vp9","av1"]).call(u,((f=c.rtpMap)===null||f===void 0?void 0:f.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(Z("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function K9(e){if(e.media.mediaType!=="video")return;const t=An();if(t.name!==Un.SAFARI&&t.os!==Fi.IOS)return;const r=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));r!==-1&&e.attributes.extmaps.splice(r,1)}function sI(e,t,r){if(!t)return;let o,c;if(e.media.mediaType==="video"?(o=r.videoExtensions,c=r.videoCodecs):(o=r.audioExtensions,c=r.audioCodecs),t.twcc===!0){const u=o.find(f=>iI(f.extensionName));if(u){const f=u.extensionName;e.attributes.extmaps.find(E=>iI(E.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:f}),function(E,v){return v.filter(S=>!!E.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(I=>I.type==="transport-cc")))}(c,e.attributes.payloads).forEach(E=>{E.rtcpFeedbacks.find(v=>v.type==="transport-cc")||E.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const u=e.attributes.extmaps.findIndex(f=>iI(f.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(f=>{const g=f.rtcpFeedbacks.findIndex(E=>E.type==="transport-cc");g!==-1&&f.rtcpFeedbacks.splice(g,1)})}if(t.remb===!0){const u=o.find(f=>H9(f.extensionName));if(u){const f=u.extensionName;e.attributes.extmaps.find(E=>E.extensionName===f)||e.attributes.extmaps.push({entry:u.entry,extensionName:f}),function(E,v){return v.filter(S=>!!E.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(I=>I.type==="goog-remb")))}(c,e.attributes.payloads).forEach(E=>{E.rtcpFeedbacks.find(v=>v.type==="goog-remb")||E.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const u=e.attributes.extmaps.findIndex(f=>H9(f.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(f=>{const g=f.rtcpFeedbacks.findIndex(E=>E.type==="goog-remb");g!==-1&&f.rtcpFeedbacks.splice(g,1)})}}function X9(e,t,r){if(Fr()||e.media.mediaType!=="video"||!(t instanceof gr)||r!=="vp9"&&r!=="vp8"||r==="vp8"&&!Z("SIMULCAST")||r==="vp9"&&Z("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const o=r==="vp8"?2:t._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(g=>g.semantic==="FID"&&g.ssrcIds[0]===c.ssrcId),f={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let g=1;g<o;g++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+g,attributes:xr(c.attributes)}),f.ssrcIds.push(c.ssrcId+g),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+g,attributes:xr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+g,u.ssrcIds[1]+g]}));e.attributes.ssrcGroups.unshift(f)}async function Q9(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const o=(await r.createOffer()).sdp,{send:c,recv:u,sendrecv:f}=function(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const S=Hb(v,g,E,"sendonly"),R=Hb(v,g,E,"recvonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},V={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Tl(S,R,"videoExtensions",I,D,V),Tl(S,R,"videoCodecs",I,D,V),Tl(S,R,"audioExtensions",I,D,V),Tl(S,R,"audioCodecs",I,D,V),Z("RAISE_H264_BASELINE_PRIORITY")){const M=[],j=[];V.videoCodecs.forEach((G,z)=>{var ce;if(((ce=G.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLocaleLowerCase())==="h264"){var Ee,_e;const me=V.videoCodecs[z+1],Ce=me&&t6(G,me),xe=(Ee=G.fmtp)===null||Ee===void 0?void 0:Ee.parameters["profile-level-id"],$e=(_e=G.fmtp)===null||_e===void 0?void 0:_e.parameters["packetization-mode"];!xe||xe!==Z("FIRST_H264_PROFILE_LEVEL_ID")||Z("FIRST_PACKETIZATION_MODE")&&$e!==Z("FIRST_PACKETIZATION_MODE")?Ce?j.push([G,me]):j.push([G]):Ce?M.push([G,me]):M.push([G])}}),M.length>0&&j.length>0&&(x.debug("raising H264 baseline profile priority"),V.videoCodecs.forEach((G,z)=>{var ce;if(((ce=G.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLocaleLowerCase())==="h264"){const Ee=t6(G,V.videoCodecs[z+1]),_e=M.shift()||j.shift()||[];_e.length>0&&(Ee?V.videoCodecs.splice(z,2,..._e):V.videoCodecs.splice(z,1,..._e))}}),D.videoCodecs=D.videoCodecs.filter(G=>{var z,ce;return!(((z=G.rtpMap)===null||z===void 0?void 0:z.encodingName.toLocaleLowerCase())==="h264"&&((ce=G.fmtp)===null||ce===void 0?void 0:ce.parameters["profile-level-id"])!==Z("FIRST_H264_PROFILE_LEVEL_ID"))}),Z("FILTER_SEND_H264_BASELINE")&&(I.videoCodecs=I.videoCodecs.filter(G=>{var z,ce;return!(((z=G.rtpMap)===null||z===void 0?void 0:z.encodingName.toLocaleLowerCase())==="h264"&&((ce=G.fmtp)===null||ce===void 0?void 0:ce.parameters["profile-level-id"])!==Z("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:I,recv:D,sendrecv:V}}(e,t,o);try{r.close()}catch{}return{send:c,recv:u,sendrecv:f}}function $9(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Hb(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Tl(e,t,"videoExtensions",r,o,c),Tl(e,t,"videoCodecs",r,o,c),Tl(e,t,"audioExtensions",r,o,c),Tl(e,t,"audioCodecs",r,o,c),Z("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(f=>f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&f.fmtp&&f.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const f=c.videoCodecs.findIndex(g=>g.rtpMap&&g.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(f<u){x.debug("raising H264 baseline profile priority");const g=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(f,0,g)}f!==-1&&(o.videoCodecs=o.videoCodecs.filter(g=>!(g.rtpMap&&g.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&g.fmtp&&g.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:r,recv:o,sendrecv:c}}function Tl(e,t,r,o,c,u){if(r==="videoExtensions"||r==="audioExtensions"){const f=[];return e[r].forEach(g=>{t[r].some((E,v)=>{if(g.entry===E.entry&&g.extensionName===E.extensionName)return f.push(v),!0})?u[r].push(g):o[r].push(g)}),void t[r].forEach((g,E)=>{f.indexOf(E)===-1&&c[r].push(g)})}if(r==="videoCodecs"||r==="audioCodecs"){const f=[];return e[r].forEach(g=>{t[r].some((E,v)=>{if(g.payloadType===E.payloadType&&JSON.stringify(g)===JSON.stringify(E))return f.push(v),!0})?u[r].push(g):o[r].push(g)}),void t[r].forEach((g,E)=>{f.indexOf(E)===-1&&c[r].push(g)})}}function aI(e){const{send:t,recv:r,sendrecv:o}=e;if(!o){if(!t||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:r}}let c,u;return t?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...t.audioCodecs,...o.audioCodecs],c.videoCodecs=[...t.videoCodecs,...o.videoCodecs],c.audioExtensions=[...t.audioExtensions,...o.audioExtensions],c.videoExtensions=[...t.videoExtensions,...o.videoExtensions]):c=o,r?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...r.audioCodecs,...o.audioCodecs],u.videoCodecs=[...r.videoCodecs,...o.videoCodecs],u.audioExtensions=[...r.audioExtensions,...o.audioExtensions],u.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function rv(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var r;return((r=t.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Gb(e,t,r,o){let c=[];if(e===lt.VIDEO){if(Z("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=t.videoCodecs.filter(u=>{var f;return et(f=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(f,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===Z("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const f=[],g=[],E=[];if(r.videoCodecs.forEach(v=>{const S=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";et(S).call(S,o)?u.push(v):et(S).call(S,"vp9")?f.push(v):et(S).call(S,"vp8")?g.push(v):et(S).call(S,"h264")&&E.push(v)}),u.length===0){let v="";f.length!==0?(u=f,v="vp9"):g.length!==0?(u=g,v="vp8"):E.length!==0&&(u=E,v="h264"),x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}u.length!==0&&(c=t.videoCodecs.filter(v=>u.some(S=>S.payloadType===v.payloadType)))}if(c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),c=t.videoCodecs),Z("USE_PUB_RTX")||Z("USE_SUB_RTX")){const u=_1(c,t.videoCodecs);c=[...c,...u]}}else{c=t.audioCodecs.filter(f=>{var g;return et(g=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"").call(g,o)});const u=t.audioCodecs.filter(f=>{var g;return et(g=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"").call(g,"red")});c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=t.audioCodecs.filter(f=>{var g;return et(g=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"").call(g,"opus")})),Z("ENABLE_AUDIO_RED")&&u.length!==0&&(c=[...u,...c])}return c}function _1(e,t){const r=e.map(o=>o.payloadType.toString());return t.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&et(r).call(r,o.fmtp&&o.fmtp.parameters.apt))}async function Wb(e,t,r){const o=t.toString(),c=Z9(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let f=u.sdp;f=J9(f,r||{}),c==null||c(f||""),await e.setLocalDescription({type:"answer",sdp:f})}function J9(e,t,r){const o=to(e),{useXR:c}=t;return o.mediaDescriptions.forEach(u=>{var f;u.attributes.mid&&(Array.isArray(r)&&!et(r).call(r,u.attributes.mid)||(u.media.mediaType==="audio"&&rv(u),c&&et(f=["audio","video"]).call(f,u.media.mediaType)&&u.attributes.payloads.forEach(g=>{g.rtcpFeedbacks.findIndex(E=>E.type==="rrtr")===-1&&g.rtcpFeedbacks.push({type:"rrtr"})})))}),vf(o)}function Z9(e,t,r,o){if(Z("SDP_LOGGING"))return x.upload("exchanging ".concat(r," ").concat(t," SDP during P2PConnection.").concat(o,`
`),e),t==="offer"?c=>{Z9(c,"answer",r==="local"?"remote":"local",o)}:void 0}function e6(e){const t=Z("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(r=>et(e).call(e,r))}function t6(e,t){try{var r;return((r=e.fmtp)===null||r===void 0?void 0:r.parameters.apt)===t.payloadType.toString()}catch{return!1}}function n6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function xo(e,t){return typeof Z(e)===t?Z(e):void 0}function Are(){try{const e=Z("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?n6(Object(o),!0).forEach(function(c){H(t,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n6(Object(o)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(o,c))})}return t}({},e)}catch(e){return x.debug("handle gateway attributes failed: ",e),{}}}const r6={};function Cf(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(e.name)),r6[e.name]=e}function Wh(e){const t=r6[e];if(!t)throw new Ae(q.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function i6(e,t){return Wh("DataStream").create(e,t)}function oI(){return Wh("InterceptFrame").create()}function s6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function mu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?s6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const E1=new Map;class Ire extends Dr{get state(){return this._state}set state(t){if(t===this._state)return;const r=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Ki.CONNECTION_STATE_CHANGE,t,r,this._disconnectedReason):this.emit(Ki.CONNECTION_STATE_CHANGE,t,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,r){var o,c,u;super(),H(this,"store",void 0),H(this,"joinInfo",void 0),H(this,"key",void 0),H(this,"ntpOffset",0),H(this,"signal",void 0),H(this,"role",void 0),H(this,"inChannelInfo",{joinAt:null,duration:0}),H(this,"spec",void 0),H(this,"_state","DISCONNECTED"),H(this,"_statsCollector",void 0),H(this,"_disconnectedReason",void 0),H(this,"isSignalRecover",!1),H(this,"hasChangeBGPAddress",!1),H(this,"trafficStatsInterval",void 0),H(this,"networkQualityInterval",void 0),H(this,"_joinGatewayStartTime",0),H(this,"_signalTimeout",!1),H(this,"_clientRoleOptions",void 0),H(this,"_isProactiveJoin",!1),this.store=t,this.spec=r,this.signal=this.store.useP2P?(o={spec:mu(mu({},r),{},{retryConfig:r.websocketRetryConfig}),store:t},(c=(u=Wh("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new Rre(mu(mu({},r),{},{retryConfig:r.websocketRetryConfig}),t),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}async join(t,r,o){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=E1.get(t.cname);if(u||(u=new Map,E1.set(t.cname,u)),this._isProactiveJoin=!0,u.has(t.uid)){const v=new Te(q.UID_CONFLICT);throw vt.joinGateway(t.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),v}u.set(t.uid,!0),this.joinInfo=t,this.key=r;let f=0;this.joinGatewayStartTime=c;const g=t.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(f));const v=t.gatewayAddrs.map(S=>{let{address:R}=S;const[I,D]=R.split(":"),V={host:I,port:D};return t.proxyServer&&(V.proxy=t.proxyServer),V});f=(await this.signal.init(v)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(f," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var E;throw x.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),vt.joinGateway(t.sid,{lts:c,succ:!1,ec:((E=v.data)===null||E===void 0?void 0:E.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!g,signalChannel:"0",preload:t.preload}),u.delete(t.uid),this.signal.close(),v}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(v=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Ki.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Ki.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Ki.NETWORK_QUALITY,{uplinkNetworkQuality:V9(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:V9(this._statsCollector.trafficStats.B_dnq)}):this.emit(Ki.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),f}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){r!==Fn.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==ur.CONNECTED||await function(o,c){return c===1/0?o:nt.race([o,Jte(c)])}(this.signal.request(xt.LEAVE,void 0,!0),3e3)}catch(o){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(r),r!==Fn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,r,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:r,mode:this.spec.mode,extend:Z("PUB_EXTEND"),twcc:!!Z("PUBLISH_TWCC"),rtx:!!Z("USE_PUB_RTX")};try{return(await this.signal.request(xt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(t,r),this.publish(t,r,!1);throw u}}async publishDataChannel(t,r,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:(c=r.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:r.channelId,metadata:r.metadata};try{await this.signal.request(xt.PUBLISH_DATASTREAM,u,!0)}catch(f){if(o&&f.data&&f.data.code===Ct.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),f.toString()),await this.tryUnpubDataChannelBeforeRepub(t,r),this.publishDataChannel(t,r,!1);throw f}}async unpublish(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(xt.UNPUBLISH,{stream_id:r,ortc:t},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await nt.all(t.map(r=>this.signal.request(xt.UNPUBLISH_DATASTREAM,{channel_id:r},!0)))}catch(r){x.warning("unpublish datachannels warning: ",r)}}async presubscribe(t,r,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:t,stream_type:r,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Z("SUBSCRIBE_TWCC"),rtx:!!Z("USE_SUB_RTX")||void 0,extend:Z("SUB_EXTEND"),svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return await this.signal.request(xt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(t,r,!1);throw u}}async subscribe(t,r,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:t,stream_type:r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Z("SUBSCRIBE_TWCC"),rtx:!!Z("USE_SUB_RTX"),extend:Z("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return(await this.signal.request(xt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(t,r),await this.subscribe(t,r,!1);throw u}}async subscribeDataChannel(t,r,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:t,stream_id:r.id,channel_id:r.datachannelId};try{return void await this.signal.request(xt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(t,r),await this.subscribeDataChannel(t,r,!1);throw u}}async subscribeAll(t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!Z("USE_SUB_RTX"),twcc:!!Z("SUBSCRIBE_TWCC"),svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return await this.signal.request(xt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(r&&c.data&&c.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw c}}async setVideoProfile(t){const r=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,f=o.height,g=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(g=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(g=!1)),typeof f!="number"&&(f=f.exact||f.ideal||f.max||f.min||0,c||(g=!1)),g?{stream_type:0,width:u,height:f,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(t);if(r)return this.signal.request(xt.SET_VIDEO_PROFILE,r);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,r){try{await this.signal.request(xt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:r},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await nt.all(t.map(o=>this.signal.request(xt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:r},!0)))}catch(o){x.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(t){try{await this.signal.request(xt.UNSUBSCRIBE_STREAMS,t,!0)}catch(r){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),r)}}async reconnectPC(t){const{iceParameters:r,dtlsParameters:o,rtpCapabilities:c}=t;return{gatewayEstablishParams:await this.signal.request(xt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(xt.GATEWAY_INFO)}async renewToken(t){await this.signal.request(xt.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,r){r&&(this._clientRoleOptions=Object.assign({},r)),Z("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},Z("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,r){if(r&&(this._clientRoleOptions=Object.assign({},r)),Z("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},Z("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let o,c=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(xt.SET_CLIENT_ROLE,{role:t,level:c,delay:o,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,r){await this.signal.request(xt.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:r})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(xt.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,r){await this.signal.request(xt.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:r})}async pickSVCLayer(t,r){await this.signal.request(xt.PICK_SVC_LAYER,{stream_id:t,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}async setRTM2Flag(t){await this.signal.request(xt.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,r,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,r,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),mu({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(xt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=E1.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(r){let o;return o=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:_s.username,password:_s.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(mu(mu({},_s),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(xt.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(r=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===r.peer_uid);o&&o.B_st!==r.B_st&&IA(()=>{this.emit(Ki.STREAM_TYPE_CHANGE,r.peer_uid,r.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var r;if(!this.joinInfo||!this.key)throw new Te(q.UNEXPECTED_ERROR,"can not generate join message, no join info");const o=Object.assign({},this.joinInfo.apResponse);let c=Z("REPORT_APP_SCENARIO");if(typeof c!="string")try{c=JSON.stringify(c)}catch{c=void 0}var u;c&&c.length>128&&(c=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Ki.UPDATE_GATEWAY_CONFIG),u=this.store.clientId,et(Qy).call(Qy,u)||Qy.push(u);const f=!(Fr()||T3(87)||u4())&&typeof Z("ENABLE_PRE_SUB")=="boolean"&&Z("ENABLE_PRE_SUB"),g=!u4()&&xo("ENABLE_PREALLOC_PC","boolean"),E=Are(),v=wb(87)||function(){const R=An();if(R.name!==Un.SAFARI||!R.browserVersion)return!1;const I=R.browserVersion.split(".");return Number(I[0])>15||Number(I[0])===15&&Number(I[1])>=4}(),S=mu({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ac,browser:navigator.userAgent,process_id:Z("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:o,extend:Z("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:c,attributes:{userAttributes:mu(mu({enableEncodedTransform:!!Z("ENABLE_AUDIO_METADATA")&&v||!!Z("ENABLE_AUDIO_TOPN")&&lk(Un.CHROME,87,116)||void 0,enableAudioMetadata:!!Z("ENABLE_AUDIO_METADATA")&&v,enableAudioPts:!!Z("ENABLE_AUDIO_PTS_METADATA")&&v,topnSmoothLevel:Z("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:Z("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:Z("TOPN_SWITCH_HOLD_MS"),topnAudioGain:Z("TOPN_AUDIO_GAIN"),enablePublishedUserList:Z("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:Z("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:xo("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:xo("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:xo("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:Z("USE_PUB_RTX")===!0||Z("USE_SUB_RTX")===!0||void 0,disableFEC:Z("DISABLE_FEC"),enableNTPReport:!!Z("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!Z("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!Z("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:xo("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!Z("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!Z("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:xo("USE_XR","boolean"),enableLossbasedBwe:xo("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!Z("ENABLE_AUT_CC")||void 0,enableCCFallback:xo("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:g,preSubNum:f?xo("PRE_SUB_NUM","number"):void 0,enablePubTWCC:xo("PUBLISH_TWCC","boolean"),enableSubTWCC:xo("SUBSCRIBE_TWCC","boolean"),enablePubRTX:xo("USE_PUB_RTX","boolean"),enableSubRTX:xo("USE_SUB_RTX","boolean"),enableSubSVC:Z("ENABLE_SVC")?Z("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0,enableSvcExtended:Z("ENABLE_SVC")&&Array.isArray(Z("SVC_EXTENDED"))&&Z("SVC_EXTENDED").length!==0?Z("SVC_EXTENDED"):void 0},E),{},{audioDuplicate:xo("ENABLE_AUDIO_RED","boolean")?(r=xo("AUDIO_DUPLICATE_NUM","number"))!==null&&r!==void 0?r:2:void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(S.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(S.aes_mode=this.joinInfo.aesmode,Z("ENCRYPT_AES")?(S.aes_secret=this.joinInfo.aespassword,S.aes_encrypt=!0):S.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(S.aes_salt=this.joinInfo.aessalt)),o.addresses[this.signal.websocket.currentURLIndex]&&(S.ap_response.ticket=o.addresses[this.signal.websocket.currentURLIndex].ticket,delete o.addresses),this.joinInfo.defaultVideoStream!==void 0&&(S.default_video_stream=this.joinInfo.defaultVideoStream),S}getRejoinMessage(){if(!this.joinInfo)throw new Te(q.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Lt.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Lt.WS_RECONNECTING,t=>{this.joinInfo&&vt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||ms.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",vt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Lt.WS_CLOSED,t=>{let r;switch(t){case Fn.LEAVE:r=ms.LEAVE;break;case Fn.UID_BANNED:case Fn.IP_BANNED:case Fn.CHANNEL_BANNED:case Fn.SERVER_ERROR:r=ms.SERVER_ERROR;break;case Fn.FALLBACK:r=ms.FALLBACK;break;case Fn.LICENSE_MISSING:case Fn.LICENSE_EXPIRED:case Fn.LICENSE_MINUTES_EXCEEDED:case Fn.LICENSE_PERIOD_INVALID:case Fn.LICENSE_MULTIPLE_SDK_SERVICE:case Fn.LICENSE_ILLEGAL:case Fn.TOKEN_EXPIRE:r=t;break;default:r=ms.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(r||"undefined -> "+ms.NETWORK_ERROR)),this.joinInfo&&vt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Fn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this._disconnectedReason=t,t!==Fn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Lt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=Z("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(vt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));qn("EVENT_REPORT_DOMAIN",t[1]),qn("EVENT_REPORT_BACKUP_DOMAIN",t[1]),qn("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(fn.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Lt.REQUEST_RECOVER,(t,r,o)=>{if(!this.joinInfo)return o(new Te(q.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,gs(this,Ki.REQUEST_NEW_GATEWAY_LIST).then(r).catch(o)}),this.signal.on(Lt.REQUEST_JOIN_INFO,async(t,r,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const u=xr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(Z("NEW_TURN_MODE")&&u){let v=u.servers,S=u.serversFromGateway;const R=this.signal.currentURLIndex;v.length>0&&(v=[v[R%v.length]],u.servers=v),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:f,dtlsParameters:g,rtpCapabilities:E}=await gs(this,Ki.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{t(this.getJoinMessage({ortc:{iceParameters:f,dtlsParameters:g,rtpCapabilities:E,version:"2"}}))}catch(v){r(v)}}),this.signal.on(Lt.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Lt.REPORT_JOIN_GATEWAY,(t,r)=>{if(!this.joinInfo)return;let o,c="";var u;t instanceof Te?(o=((u=t.data)===null||u===void 0?void 0:u.desc)||t.code,c=t.message):o=t,vt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Lt.IS_P2P_DISCONNECTED,t=>{t(Nb(this,Ki.IS_P2P_DISCONNECTED))}),this.signal.on(Lt.DISCONNECT_P2P,()=>{this.emit(Ki.DISCONNECT_P2P)}),this.signal.on(Lt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Lt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Lt.JOIN_RESPONSE,t=>{const r=this.getCurrentGatewayAddress();this.emit(Ki.JOIN_RESPONSE,t,r)}),this.signal.on(Lt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const t=this.getCurrentGatewayAddress(),r=Z("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(t&&r){const o=q9(t);this.emit(Ki.PRE_CONNECT_PC,{candidates:o,fingerprint:r})}}}),this.signal.on(Lt.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof Z("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(Z("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,r){try{await this.signal.request(xt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[r]},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(t,r){try{await this.signal.request(xt.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(o){throw x.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(t,r){try{await this.signal.request(xt.UNPUBLISH,{stream_id:t,ortc:r},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(t,r){try{await this.signal.request(xt.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(o){throw x.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(t){const r={users:t.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(xt.UNSUBSCRIBE_STREAMS,r,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(t,r){const o={action:t.find(c=>c.stream_type===Hn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(xt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(t,r){const o={action:t.find(c=>c.stream_type===Hn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(xt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(t,r){const o={action:t===lt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(xt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(t,r){const o={action:t===lt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(xt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,r){this.signal.upload(t,r)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(xt.RESTART_ICE,r,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(t,r){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,r||ms.P2P_FAILED)}getCurrentGatewayAddress(){var t,r;if(!Z("GATEWAY_WSS_ADDRESS"))return Z("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(r=this.joinInfo)!==null&&r!==void 0&&r.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(xt.SET_PARAMETER,{enablePublishAudioFilter:t})}}let cI=0,y1=0;function fd(e,t,r,o){return new nt((c,u)=>{t.timeout=t.timeout||Z("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),cI+=lu(t.data)):r&&(t.data.size?cI+=t.data.size:t.data instanceof FormData?cI+=F3(t.data):cI+=lu(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,xa.request(t).then(f=>{typeof f.data=="string"?y1+=lu(f.data):f.data instanceof ArrayBuffer||f.data instanceof Uint8Array?y1+=f.data.byteLength:y1+=lu(JSON.stringify(f.data)),o&&c({data:f.data,headers:f.headers}),c(f.data)}).catch(f=>{xa.isCancel(f)?u(new Te(q.OPERATION_ABORTED,"cancel token canceled")):f.code==="ECONNABORTED"?u(new Te(q.NETWORK_TIMEOUT,f.message)):f.response?u(new Te(q.NETWORK_RESPONSE_ERROR,f.response.status)):u(new Te(q.NETWORK_ERROR,f.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(Pe){var Ye=0;return function(){return Ye<Pe.length?{done:!1,value:Pe[Ye++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(Pe,Ye,pt){return Pe==Array.prototype||Pe==Object.prototype||(Pe[Ye]=pt.value),Pe},o,c=function(Pe){Pe=[typeof globalThis=="object"&&globalThis,Pe,typeof window=="object"&&window,typeof self=="object"&&self,typeof s=="object"&&s];for(var Ye=0;Ye<Pe.length;++Ye){var pt=Pe[Ye];if(pt&&pt.Math==Math)return pt}throw Error("Cannot find global object")}(this);function u(Pe,Ye){if(Ye)e:{var pt=c;Pe=Pe.split(".");for(var ke=0;ke<Pe.length-1;ke++){var L=Pe[ke];if(!(L in pt))break e;pt=pt[L]}(Ye=Ye(ke=pt[Pe=Pe[Pe.length-1]]))!=ke&&Ye!=null&&r(pt,Pe,{configurable:!0,writable:!0,value:Ye})}}function f(Pe){return(Pe={next:Pe})[Symbol.iterator]=function(){return this},Pe}function g(Pe){var Ye=typeof Symbol<"u"&&Symbol.iterator&&Pe[Symbol.iterator];return Ye?Ye.call(Pe):{next:t(Pe)}}if(u("Symbol",function(Pe){function Ye(L,ne){this.A=L,r(this,"description",{configurable:!0,writable:!0,value:ne})}if(Pe)return Pe;Ye.prototype.toString=function(){return this.A};var pt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ke=0;return function L(ne){if(this instanceof L)throw new TypeError("Symbol is not a constructor");return new Ye(pt+(ne||"")+"_"+ke++,ne)}}),u("Symbol.iterator",function(Pe){if(Pe)return Pe;Pe=Symbol("Symbol.iterator");for(var Ye="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),pt=0;pt<Ye.length;pt++){var ke=c[Ye[pt]];typeof ke=="function"&&typeof ke.prototype[Pe]!="function"&&r(ke.prototype,Pe,{configurable:!0,writable:!0,value:function(){return f(t(this))}})}return Pe}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var E;e:{var v={};try{v.__proto__={a:!0},E=v.a;break e}catch{}E=!1}o=E?function(Pe,Ye){if(Pe.__proto__=Ye,Pe.__proto__!==Ye)throw new TypeError(Pe+" is not extensible");return Pe}:null}var S=o;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function I(Pe){if(Pe.m)throw new TypeError("Generator is already running");Pe.m=!0}function D(Pe,Ye){return Pe.h=3,{value:Ye}}function V(Pe){this.g=new R,this.G=Pe}function M(Pe,Ye,pt,ke){try{var L=Ye.call(Pe.g.j,pt);if(!(L instanceof Object))throw new TypeError("Iterator result "+L+" is not an object");if(!L.done)return Pe.g.m=!1,L;var ne=L.value}catch(de){return Pe.g.j=null,Pe.g.s(de),j(Pe)}return Pe.g.j=null,ke.call(Pe.g,ne),j(Pe)}function j(Pe){for(;Pe.g.h;)try{var Ye=Pe.G(Pe.g);if(Ye)return Pe.g.m=!1,{value:Ye.value,done:!1}}catch(pt){Pe.g.v=void 0,Pe.g.s(pt)}if(Pe.g.m=!1,Pe.g.l){if(Ye=Pe.g.l,Pe.g.l=null,Ye.F)throw Ye.D;return{value:Ye.return,done:!0}}return{value:void 0,done:!0}}function G(Pe){this.next=function(Ye){return Pe.o(Ye)},this.throw=function(Ye){return Pe.s(Ye)},this.return=function(Ye){return function(pt,ke){I(pt.g);var L=pt.g.j;return L?M(pt,"return"in L?L.return:function(ne){return{value:ne,done:!0}},ke,pt.g.return):(pt.g.return(ke),j(pt))}(Pe,Ye)},this[Symbol.iterator]=function(){return this}}function z(Pe,Ye){return Ye=new G(new V(Ye)),S&&Pe.prototype&&S(Ye,Pe.prototype),Ye}if(R.prototype.o=function(Pe){this.v=Pe},R.prototype.s=function(Pe){this.l={D:Pe,F:!0},this.h=this.C||this.u},R.prototype.return=function(Pe){this.l={return:Pe},this.h=this.u},V.prototype.o=function(Pe){return I(this.g),this.g.j?M(this,this.g.j.next,Pe,this.g.o):(this.g.o(Pe),j(this))},V.prototype.s=function(Pe){return I(this.g),this.g.j?M(this,this.g.j.throw,Pe,this.g.o):(this.g.s(Pe),j(this))},u("Array.prototype.entries",function(Pe){return Pe||function(){return function(Ye,pt){Ye instanceof String&&(Ye+="");var ke=0,L=!1,ne={next:function(){if(!L&&ke<Ye.length){var de=ke++;return{value:pt(de,Ye[de]),done:!1}}return L=!0,{done:!0,value:void 0}}};return ne[Symbol.iterator]=function(){return ne},ne}(this,function(Ye,pt){return[Ye,pt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ce=function(Pe,Ye){for(var pt=0;pt<Pe.length;pt++)Ye(Pe[pt])},Ee=function(Pe){return Pe.replace(/\r?\n|\r/g,`\r
`)},_e=function(Pe,Ye,pt){return Ye instanceof Blob?(pt=pt!==void 0?pt+"":typeof Ye.name=="string"?Ye.name:"blob",Ye.name===pt&&Object.prototype.toString.call(Ye)!=="[object Blob]"||(Ye=new File([Ye],pt)),[String(Pe),Ye]):[String(Pe),String(Ye)]},me=function(Pe,Ye){if(Pe.length<Ye)throw new TypeError(Ye+" argument required, but only "+Pe.length+" present.")},Ce=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,xe=Ce.FormData,$e=Ce.XMLHttpRequest&&Ce.XMLHttpRequest.prototype.send,at=Ce.Request&&Ce.fetch,Zt=Ce.navigator&&Ce.navigator.sendBeacon,qt=Ce.Element&&Ce.Element.prototype,Pt=Ce.Symbol&&Symbol.toStringTag;Pt&&(Blob.prototype[Pt]||(Blob.prototype[Pt]="Blob"),"File"in Ce&&!File.prototype[Pt]&&(File.prototype[Pt]="File"));try{new File([],"")}catch{Ce.File=function(Ye,pt,ke){return Ye=new Blob(Ye,ke||{}),Object.defineProperties(Ye,{name:{value:pt},lastModified:{value:+(ke&&ke.lastModified!==void 0?new Date(ke.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Pt&&Object.defineProperty(Ye,Pt,{value:"File"}),Ye}}var hr=function(Pe){return Pe.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},er=function(Pe){this.i=[];var Ye=this;Pe&&ce(Pe.elements,function(pt){if(pt.name&&!pt.disabled&&pt.type!=="submit"&&pt.type!=="button"&&!pt.matches("form fieldset[disabled] *"))if(pt.type==="file"){var ke=pt.files&&pt.files.length?pt.files:[new File([],"",{type:"application/octet-stream"})];ce(ke,function(L){Ye.append(pt.name,L)})}else pt.type==="select-multiple"||pt.type==="select-one"?ce(pt.options,function(L){!L.disabled&&L.selected&&Ye.append(pt.name,L.value)}):pt.type==="checkbox"||pt.type==="radio"?pt.checked&&Ye.append(pt.name,pt.value):(ke=pt.type==="textarea"?Ee(pt.value):pt.value,Ye.append(pt.name,ke))})};if((e=er.prototype).append=function(Pe,Ye,pt){me(arguments,2),this.i.push(_e(Pe,Ye,pt))},e.delete=function(Pe){me(arguments,1);var Ye=[];Pe=String(Pe),ce(this.i,function(pt){pt[0]!==Pe&&Ye.push(pt)}),this.i=Ye},e.entries=function Pe(){var Ye,pt=this;return z(Pe,function(ke){if(ke.h==1&&(Ye=0),ke.h!=3)return Ye<pt.i.length?ke=D(ke,pt.i[Ye]):(ke.h=0,ke=void 0),ke;Ye++,ke.h=2})},e.forEach=function(Pe,Ye){me(arguments,1);for(var pt=g(this),ke=pt.next();!ke.done;ke=pt.next()){var L=g(ke.value);ke=L.next().value,L=L.next().value,Pe.call(Ye,L,ke,this)}},e.get=function(Pe){me(arguments,1);var Ye=this.i;Pe=String(Pe);for(var pt=0;pt<Ye.length;pt++)if(Ye[pt][0]===Pe)return Ye[pt][1];return null},e.getAll=function(Pe){me(arguments,1);var Ye=[];return Pe=String(Pe),ce(this.i,function(pt){pt[0]===Pe&&Ye.push(pt[1])}),Ye},e.has=function(Pe){me(arguments,1),Pe=String(Pe);for(var Ye=0;Ye<this.i.length;Ye++)if(this.i[Ye][0]===Pe)return!0;return!1},e.keys=function Pe(){var Ye,pt,ke,L,ne=this;return z(Pe,function(de){if(de.h==1&&(Ye=g(ne),pt=Ye.next()),de.h!=3)return pt.done?void(de.h=0):(ke=pt.value,L=g(ke),D(de,L.next().value));pt=Ye.next(),de.h=2})},e.set=function(Pe,Ye,pt){me(arguments,2),Pe=String(Pe);var ke=[],L=_e(Pe,Ye,pt),ne=!0;ce(this.i,function(de){de[0]===Pe?ne&&(ne=!ke.push(L)):ke.push(de)}),ne&&ke.push(L),this.i=ke},e.values=function Pe(){var Ye,pt,ke,L,ne=this;return z(Pe,function(de){if(de.h==1&&(Ye=g(ne),pt=Ye.next()),de.h!=3)return pt.done?void(de.h=0):(ke=pt.value,(L=g(ke)).next(),D(de,L.next().value));pt=Ye.next(),de.h=2})},er.prototype._asNative=function(){for(var Pe=new xe,Ye=g(this),pt=Ye.next();!pt.done;pt=Ye.next()){var ke=g(pt.value);pt=ke.next().value,ke=ke.next().value,Pe.append(pt,ke)}return Pe},er.prototype._blob=function(){var Pe="----formdata-polyfill-"+Math.random(),Ye=[],pt="--"+Pe+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ke,L){return typeof ke=="string"?Ye.push(pt+hr(Ee(L))+`"\r
\r
`+Ee(ke)+`\r
`):Ye.push(pt+hr(Ee(L))+'"; filename="'+hr(ke.name)+`"\r
Content-Type: `+(ke.type||"application/octet-stream")+`\r
\r
`,ke,`\r
`)}),Ye.push("--"+Pe+"--"),new Blob(Ye,{type:"multipart/form-data; boundary="+Pe})},er.prototype[Symbol.iterator]=function(){return this.entries()},er.prototype.toString=function(){return"[object FormData]"},qt&&!qt.matches&&(qt.matches=qt.matchesSelector||qt.mozMatchesSelector||qt.msMatchesSelector||qt.oMatchesSelector||qt.webkitMatchesSelector||function(Pe){for(var Ye=(Pe=(this.document||this.ownerDocument).querySelectorAll(Pe)).length;0<=--Ye&&Pe.item(Ye)!==this;);return-1<Ye}),Pt&&(er.prototype[Pt]="FormData"),$e){var ja=Ce.XMLHttpRequest.prototype.setRequestHeader;Ce.XMLHttpRequest.prototype.setRequestHeader=function(Pe,Ye){ja.call(this,Pe,Ye),Pe.toLowerCase()==="content-type"&&(this.B=!0)},Ce.XMLHttpRequest.prototype.send=function(Pe){Pe instanceof er?(Pe=Pe._blob(),this.B||this.setRequestHeader("Content-Type",Pe.type),$e.call(this,Pe)):$e.call(this,Pe)}}at&&(Ce.fetch=function(Pe,Ye){return Ye&&Ye.body&&Ye.body instanceof er&&(Ye.body=Ye.body._blob()),at.call(this,Pe,Ye)}),Zt&&(Ce.navigator.sendBeacon=function(Pe,Ye){return Ye instanceof er&&(Ye=Ye._asNative()),Zt.call(this,Pe,Ye)}),Ce.FormData=er}})();const zb=()=>{const e=Z("AREAS");return e.length===0&&e.push(Vn.GLOBAL),Xa(e).call(e,(t,r,o)=>{const c=a6(r);return c?o===0?c:"".concat(t,",").concat(c):t},"")},a6=e=>e===Vn.OVERSEA?"".concat(ks.ASIA,",").concat(ks.EUROPE,",").concat(ks.AFRICA,",").concat(ks.NORTH_AMERICA,",").concat(ks.SOUTH_AMERICA,",").concat(ks.OCEANIA):ks[e],Nre=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(r=>{const o=eI[r],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(t[u]=t[u].concat(o[u]))})}),t},lI={GLOBAL:{ASIA:[Vn.CHINA,Vn.JAPAN,Vn.INDIA,Vn.KOREA,Vn.HKMC],EUROPE:[],NORTH_AMERICA:[Vn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},dI=Object.keys(lI[Vn.GLOBAL]),v1=[Vn.CHINA,Vn.NORTH_AMERICA,Vn.EUROPE,Vn.ASIA,Vn.JAPAN,Vn.INDIA,Vn.OCEANIA,Vn.SOUTH_AMERICA,Vn.AFRICA,Vn.KOREA,Vn.HKMC,Vn.US],Ore=function(e,t){let r=[];if(et(e).call(e,Vn.GLOBAL)){const u=[Vn.GLOBAL,Vn.OVERSEA],f=Object.keys(eI);if(t===Vn.GLOBAL)throw new Te(q.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Vn.CHINA)r=[Vn.OVERSEA];else if(c=t,et(dI).call(dI,c)){const g=(o=t,lI[Vn.GLOBAL][o]||[]),E=[...u,t,...g];r=f.filter(v=>!et(E).call(E,v))}else if(function(g){let E=!1;return dI.forEach(v=>{var S;et(S=lI[Vn.GLOBAL][v]).call(S,g)&&(E=!0)}),E}(t)){const g=function(v){let S;return dI.forEach(R=>{var I;et(I=lI[Vn.GLOBAL][R]).call(I,v)&&(S=R)}),S}(t),E=[...u,g,t];r=f.filter(v=>!et(E).call(E,v))}else r=e;r=function(g){const E=[];return v1.forEach(v=>{et(g).call(g,v)&&E.push(v)}),E.concat(g.filter(v=>!et(v1).call(v1,v)))}(r)}else r=e;var o,c;return r};function o6(e){var t,r;if(!e&&et(t=Z("AREAS")).call(t,Vn.EXTENSIONS))return x.debug("update area from ap : reset"),void S1(Une,!0);if(!et(r=Z("AREAS")).call(r,Vn.GLOBAL)||!e)return;let o=eI.EXTENSIONS;o&&(o={CODE:a6(Vn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},x.debug("update area from ap success: ".concat(e,",config is "),o),qn("AREAS",[Vn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?qn(c,o[c][0]):qn(c,o[c])}))}function S1(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=vt.reportApiInvoke(null,{name:di.SET_AREA,options:e,tag:Hr.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!et(I9).call(I9,u))throw new Te(q.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:f}=e;if(!u)throw new Te(q.INVALID_PARAMS,"area code is needed");let g=u;typeof u=="string"&&(g=[u]),o=f?Ore(g,f):g}if(!t){if(dd.AREAS){const u=new Te(q.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(u),void x.warning("setArea is prohibited because of config-distribute")}if(et(o).call(o,Vn.GLOBAL)&&Z("AREAS")===Vn.EXTENSIONS){const u=new Te(q.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(u),void x.warning("setArea is prohibited because of ap extensions")}}qn("AREAS",o,t);const c=Nre(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?qn(u,c[u][0]):qn(u,c[u])}),x.debug("set area success:",o.join(","))}catch(o){throw r.onError(o),o}r.onSuccess()}function c6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function gu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?c6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let T1=1;function Dre(e,t,r,o,c){T1+=1;const u={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:T1,requestId:T1,version:Ac,cname:r.cname},f={service_name:t,json_body:JSON.stringify(u)};let g,E,v=e[0];return ld(async()=>{g=Date.now();const S=await fd(v,{data:f,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(E=Date.now()-g,S.code!==0){const D=new Te(q.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:E});throw x.error(D.toString()),D}const R=JSON.parse(S.json_body);if(R.code!==200){const D=new Te(q.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:E});throw x.error(D.toString()),D}if(!R.servers||R.servers.length===0){const D=new Te(q.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:E});throw x.error(D.toString()),D}const I=function(D,V){return{addressList:D.servers.map(M=>"wss://".concat(M.address.replace(/\./g,"-"),".").concat(Z("WORKER_DOMAIN"),":").concat(M.wss,"?serviceName=").concat(encodeURIComponent(V))),workerToken:D.workerToken,vid:D.vid}}(R,t);return Z("LIVE_STREAMING_ADDRESS")&&(I.addressList=Z("LIVE_STREAMING_ADDRESS")instanceof Array?Z("LIVE_STREAMING_ADDRESS"):[Z("LIVE_STREAMING_ADDRESS")]),gu(gu({},I),{},{responseTime:E})},(S,R)=>(vt.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(S.addressList),firstSuccess:R===0,responseTime:E,serverIp:e[R%e.length]}),!1),(S,R)=>(vt.apworkerEvent(r.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:t,responseTime:E,serverIp:e[R%e.length]}),!!(S.code!==q.OPERATION_ABORTED&&S.code!==q.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(v=e[(R+1)%e.length],!0)),c)}let b1=1;function l6(e,t,r,o){let{url:c,areaCode:u}=e;const{clientId:f,sid:g}=t,E=Date.now();let v;const S=t.role,[R,I]=R1(t,u,[hi.CHOOSE_SERVER]);let D=ui.networkState;return ld(async()=>{D&&ui.networkState===Oo.OFFLINE&&ui.onlineWaiter&&await nt.race([ui.onlineWaiter,is(o&&o.maxRetryTimeout||Si.maxRetryTimeout)]),D=ui.networkState;const{data:V,headers:M}=await fd(c,{data:R,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=M.http3==="1"?1:-1,vt.reportResourceTiming(c,g),u6(V,c,t,E,[hi.CHOOSE_SERVER],v);const j=Bb(V,hi.CHOOSE_SERVER);return w1(j),p1(j,c)},V=>(V&&vt.joinChooseServer(g,{role:S,lts:E,succ:!0,csAddr:c,opid:I,serverList:V.gatewayAddrs.map(M=>M.address),ec:null,cid:V.cid.toString(),uid:V.uid.toString(),csIp:V.csIp,unilbsServerIds:[hi.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:V.res.detail&&V.res.detail[38]}),!1),V=>V.code!==q.OPERATION_ABORTED&&(V.code===q.CAN_NOT_GET_GATEWAY_SERVER?V.data.retry:(vt.joinChooseServer(g,{role:S,lts:E,succ:!1,csAddr:c,serverList:null,opid:I,ec:V.code,csIp:V.data&&V.data.csIp,unilbsServerIds:[hi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:D}),isHttp3:v,corssRegionTagReq:t.apRequestDetail}),x.warning("[".concat(f||"sid-".concat(g.slice(0,6)),"] Choose server network error, retry"),V),!0)),o)}function d6(e,t,r,o){let c,{url:u,areaCode:f,serviceIds:g}=e;const E=Date.now(),v=t.role,[S,R]=R1(t,f,g);let I;return ld(async()=>{I&&ui.networkState===Oo.OFFLINE&&ui.onlineWaiter&&await nt.race([ui.onlineWaiter,is(o&&o.maxRetryTimeout||Si.maxRetryTimeout)]),I=ui.networkState;const{data:D,headers:V}=await fd(u,{data:S,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=V.http3==="1"?1:-1,vt.reportResourceTiming(u,t.sid),u6(D,u,t,E,g,c);const M=Bb(D,hi.CHOOSE_SERVER),j=Bb(D,t.cloudProxyServer==="proxy5"?hi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?hi.CLOUD_PROXY:hi.CLOUD_PROXY_FALLBACK);return w1(M),{gatewayInfo:p1(M,u),proxyInfo:j,url:u}},D=>(D.gatewayInfo&&vt.joinChooseServer(t.sid,{role:v,lts:E,succ:!0,csAddr:u,serverList:D.gatewayInfo.gatewayAddrs.map(V=>V.address),ec:null,opid:R,cid:D.gatewayInfo.cid.toString(),uid:D.gatewayInfo.uid.toString(),csIp:D.gatewayInfo.csIp,unilbsServerIds:g.toString(),isHttp3:c,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:D.gatewayInfo.res.detail&&D.gatewayInfo.res.detail[38]}),D.proxyInfo&&vt.joinWebProxyAP(t.sid,{lts:E,sucess:1,apServerAddr:u,turnServerAddrList:D.proxyInfo.addresses.map(V=>V.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:g.toString()}),!1),D=>D.code!==q.OPERATION_ABORTED&&(D.code===q.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(vt.joinWebProxyAP(t.sid,{lts:E,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:D.code,eventType:t.cloudProxyServer,unilbsServerIds:g.toString(),extend:JSON.stringify({networkState:I})}),x.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),D),!0)),o)}const u6=(e,t,r,o,c,u)=>{const{sid:f,clientId:g,cloudProxyServer:E}=r,v=[],S=R=>{R.flag===4096?vt.joinChooseServer(f,{role:r.role,lts:o,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:r.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||vt.joinWebProxyAP(f,{lts:o,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:R.error.code,eventType:E,unilbsServerIds:c.toString()})};if(e.response_body.forEach(R=>{const I=R.buffer.code;if(R.uri===23&&I===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const D={error:new Te(q.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:R.buffer.flag};v.push(D),S(D)}if(I!==0){const D=ev(I),V={error:new Te(q.CAN_NOT_GET_GATEWAY_SERVER,D.desc,{desc:D.desc,retry:D.retry,csIp:e.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?x.warning(V.error.toString()):v.push(V),S(V)}}),v.length)throw x.warning("[".concat(g||"sid-".concat(f.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Te(q.CAN_NOT_GET_GATEWAY_SERVER,v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!v.find(R=>R.error.data.retry),csIp:e.detail[502],desc:[...new Set(v.map(R=>{var I;return R==null||(I=R.error)===null||I===void 0||(I=I.data)===null||I===void 0?void 0:I.desc}).filter(R=>!!R))]})},w1=e=>{var t,r,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Te(q.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(Z("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?o6(e.detail[23].toLowerCase()):o6()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((r=e.detail)===null||r===void 0?void 0:r[19])=="string"){const f=e.detail[19],g=f==null?void 0:f.split(";");for(let E=0;E<g.length;E++){var u;const v=sa(u=g[E]).call(u);e.addresses[E]&&g&&(e.addresses[E].fingerprint=v)}}if(Z("GATEWAY_ADDRESS")&&Z("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",Z("GATEWAY_ADDRESS"));const f=Z("GATEWAY_ADDRESS").map(g=>{var E,v;const S=(E=(v=e.addresses.find(R=>R.ip===g.ip&&R.port===g.port))===null||v===void 0?void 0:v.fingerprint)!==null&&E!==void 0?E:"";return{ip:g.ip,port:g.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:S}});e.addresses=f}},xre=(e,t)=>{if(e.response_body&&e.response_body.length){const r=e.response_body[0];if(r.buffer.code!==0){const o=ev(r.buffer.code);throw new Te(q.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return r.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",t),new Te(q.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},R1=(e,t,r)=>{const o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:gu(gu(gu({6:e.stringUid,11:t,12:Z("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};u.request_bodies.forEach(g=>{e.multiIP&&e.multiIP.gateway_ip&&(g.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const f=new FormData;return f.append("request",JSON.stringify(u)),[f,o]},Pre=(e,t)=>{const r=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,r]};let iv=0;function sv(e){return nt.all(e.map(t=>t.then(r=>{throw r},r=>r))).then(t=>{throw t},t=>t)}const Yb=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,f=0;const g=t;let E,v=0;const S=async()=>{const R=(()=>{const I=f*g,D=I+g;return r.slice(I,D).map(o)})();u&&u.push(...R);try{E=await sv(R)}catch(I){if(v+=g,f++,!(v>=r.length))return void await S();c(I)}R.forEach(I=>I.cancel())};return await S(),E},h6=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:o}=e;const c=t.length;let u=0;const f=async()=>{const g=r(t.shift());try{return await g}catch(E){if(u++,u>=c||o!=null&&o(E))throw E;return f()}};return f()};async function C1(e,t,r,o){return{gatewayInfo:await async function(u,f,g,E){let v=null;const S=[],R=async()=>{const D=Z("WEBCS_DOMAIN").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:zb()})),V=E.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),M=await Yb({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(x.debug("[".concat(u.clientId,"] Connect to choose_server:"),j.url),l6(j,u,f,g)),allFailedhandler:j=>{throw E.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},V),j[0]},promisesCollector:S});return E.recordJoinChannelService({endTs:Date.now(),status:"success"},V),M},I=async()=>{if(await is(1e3),v!==null)return v;const D=Z("WEBCS_DOMAIN_BACKUP_LIST").map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:zb()})),V=E.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),M=await Yb({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(x.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),j.url),l6(j,u,f,g)),allFailedhandler:j=>{throw E.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},V),j[0]},promisesCollector:S});return E.recordJoinChannelService({endTs:Date.now(),status:"success"},V),M};try{return v=await sv([R(),I()]),S.length&&S.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),v}catch(D){throw D[0]}}(e,t,r,o)}}async function p6(e,t,r,o,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await C1(e,t,r,c);if(Z("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:I,proxyInfo:D}=await g6(e,t,r,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:I};const V=D.map(M=>({turnServerURL:M.address,tcpport:M.tcpport||_s.tcpport,udpport:M.udpport||_s.udpport,username:M.username||_s.username,password:M.password||_s.password,forceturn:!1,security:!0}));if(c.useP2P){var f;const M=(f=e.uid)!==null&&f!==void 0?f:I.uid,j="glb:".concat(M.toString()),G=await _k(j),z=D.map(ce=>({turnServerURL:ce.address,tcpport:ce.tcpport||_s.tcpport,udpport:ce.udpport||_s.udpport,username:j,password:G,forceturn:!1,security:!0}));V.push(...z)}return e.turnServer={mode:"manual",servers:V},{gatewayInfo:I}}return await C1(e,t,r,c)}const{proxyInfo:g,gatewayInfo:E}=await g6(e,t,r,c),v={gatewayInfo:E},S=g.map(I=>({turnServerURL:I.address,tcpport:u==="proxy3"?void 0:I.tcpport?I.tcpport:_s.tcpport,udpport:u==="proxy4"?void 0:I.udpport?I.udpport:_s.udpport,username:I.username||_s.username,password:I.password||_s.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;const I=(R=e.uid)!==null&&R!==void 0?R:E.uid,D="glb:".concat(I.toString()),V=await _k(D),M=g.map(j=>({turnServerURL:j.address,tcpport:u==="proxy3"?void 0:j.tcpport||_s.tcpport,udpport:u==="proxy4"?void 0:j.udpport||_s.udpport,username:D,password:V,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...M)}return e.turnServer={mode:"manual",servers:S},x.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),v}async function f6(e,t,r,o,c){const u=Z("ACCOUNT_REGISTER").slice(0,Z("AJAX_REQUEST_CONCURRENT"));let f=[];f=t.proxyServer?u.map(E=>"https://".concat(t.proxyServer,"/ap/?url=").concat(E+"/api/v1")):u.map(E=>"https://".concat(E,"/api/v1"));const g=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:f});try{const E=await async function(v,S,R,I,D){const V=Date.now(),M={sid:R.sid,opid:10,appid:R.appId,string_uid:S};let j=v[0];const G=await ld(()=>fd(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:M,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(z,ce)=>{if(z.code===0){if(z.uid<=0||z.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(S," => ").concat(z.uid),z),vt.reqUserAccount(M.sid,{lts:V,success:!1,serverAddr:j,stringUid:M.string_uid,uid:z.uid,errorCode:q.INVALID_UINT_UID_FROM_STRING_UID,extend:M}),new Te(q.INVALID_UINT_UID_FROM_STRING_UID);return vt.reqUserAccount(M.sid,{lts:V,success:!0,serverAddr:j,stringUid:M.string_uid,uid:z.uid,errorCode:null,extend:M}),!1}const Ee=ev(z.code);return Ee.retry&&(j=v[(ce+1)%v.length]),vt.reqUserAccount(M.sid,{lts:V,success:!1,serverAddr:j,stringUid:M.string_uid,uid:z.uid,errorCode:Ee.desc,extend:M}),Ee.retry},(z,ce)=>z.code!==q.OPERATION_ABORTED&&(vt.reqUserAccount(M.sid,{lts:V,success:!1,serverAddr:j,stringUid:M.string_uid,uid:null,errorCode:z.code,extend:M}),j=v[(ce+1)%v.length],!0),D);if(G.code!==0){const z=ev(G.code);throw new Te(q.UNEXPECTED_RESPONSE,z.desc)}return G}(f,e,t,r,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},g),E.uid}catch(E){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[E]},g),E}}async function kre(e,t,r){const o=Z("ACCOUNT_REGISTER");let c=[];c=t.proxyServer?o.map(u=>"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await h6({referenceList:c,asyncMapHandler:f=>async function(g,E,v,S){const R=Date.now(),I={sid:v.sid,opid:10,appid:v.appId,string_uid:E};try{const D=await fd(g+"".concat(g.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(D.code!==0){const V=ev(D.code);throw new Te(q.UNEXPECTED_RESPONSE,"preload sua error:".concat(V.desc),V)}if(D.uid<=0||D.uid>=Math.pow(2,32))throw new Te(q.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:g,req:I,uid:D.uid,elapse:Date.now()-R}}catch(D){throw D}}(f,e,t,r),closeFn:f=>f.code===q.OPERATION_ABORTED||f.code===q.UNEXPECTED_RESPONSE&&!f.data.retry})}catch(u){throw u}}async function Lre(e,t,r){const o=Z("CDS_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(E=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(E+"/api/v1"):"https://".concat(E,"/api/v1?action=config")),c=o.map(E=>function(v,S,R,I){const D=An(),V={flag:64,cipher_method:0,features:gu(gu(gu(gu(gu({install_id:Nk(),device:D.name,system:D.os,system_general:navigator.userAgent,vendor:S.appId,version:Ac,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:Cre.WEB_RTC,browser_name:D.name,browser_version:D.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),D.os&&{os_name:D.os}),D.osVersion&&{os_version:D.osVersion}),{},{detail:""})};return ld(()=>fd(v,{data:V,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,M=>M.code!==q.OPERATION_ABORTED,I)}(E,e,t,r));let u=null,f=null,g={};try{u=await sv(c)}catch(E){if(E.code===q.OPERATION_ABORTED)throw E;f=E}if(c.forEach(E=>E.cancel()),vt.reportApiInvoke(e.sid,{name:di.REQUEST_CONFIG_DISTRIBUTE,options:{error:f,res:u}}).onSuccess(),u&&u.test_tags)try{g=function(E){if(!E.test_tags)return{};const v=E.test_tags,S=Object.keys(v),R={};return S.forEach(I=>{var D;const V=sa(D=I.slice(4)).call(D),M=JSON.parse(v[I]),j=M[1];R[V]={tag:M[0]||"",value:j}}),R}(u)}catch{}return g}async function m6(e,t){const r=Z("WEBCS_DOMAIN").concat(Z("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:zb(),serviceIds:[hi.CHOOSE_SERVER,hi.CLOUD_PROXY_FALLBACK]}));try{return await h6({referenceList:r,asyncMapHandler:c=>async function(u,f,g){let E,{url:v,areaCode:S,serviceIds:R}=u;const I=Date.now(),[D,V]=R1(f,S,R);let M=ui.networkState;try{M&&ui.networkState===Oo.OFFLINE&&ui.onlineWaiter&&await nt.race([ui.onlineWaiter,is(Si.maxRetryTimeout)]),M=ui.networkState;const{data:j,headers:G}=await fd(v,{data:D,cancelToken:g,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);E=G.http3==="1"?1:-1,(_e=>{const me=[];if(_e.response_body.forEach(Ce=>{const xe=Ce.buffer.code;if(Ce.uri===23&&xe===0&&!Ce.buffer.edges_services)if(Ce.buffer.flag===4194310)Ce.buffer.edges_services=[];else{const $e={error:new Te(q.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:_e.detail[502]}),flag:Ce.buffer.flag};me.push($e)}if(xe!==0){const $e=ev(xe),at={error:new Te(q.CAN_NOT_GET_GATEWAY_SERVER,$e.desc,{desc:$e.desc,retry:$e.retry,csIp:_e.detail[502]}),flag:Ce.buffer.flag};Ce.buffer.flag===4194310?x.warning(at.error.toString()):me.push(at)}}),me.length)throw new Te(q.CAN_NOT_GET_GATEWAY_SERVER,me.map(Ce=>"flag: ".concat(Ce.flag,", message: ").concat(Ce.error.message)).join(" | "),{retry:!!me.find(Ce=>Ce.error.data.retry),csIp:_e.detail[502],desc:[...new Set(me.map(Ce=>{var xe;return Ce==null||(xe=Ce.error)===null||xe===void 0||(xe=xe.data)===null||xe===void 0?void 0:xe.desc}).filter(Ce=>!!Ce))]})})(j);const ce=Bb(j,hi.CHOOSE_SERVER),Ee=Bb(j,hi.CLOUD_PROXY_FALLBACK);return w1(ce),{gatewayInfo:p1(ce,v),proxyInfo:Ee,opid:V,requestTime:I,url:v,isHttp3:E,elapse:Date.now()-I}}catch(j){throw j}}(c,e,t),closeFn:c=>c.code===q.OPERATION_ABORTED||c.code===q.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function g6(e,t,r,o){const c=Z("PROXY_SERVER_TYPE3"),u=(D,V,M)=>{let j=M||c;return Array.isArray(j)&&(j=V%2==0?c[1]:c[0]),"https://".concat(j,"/ap/?url=").concat(D)};let f=null;const g=[],E=async()=>{const D=Z("WEBCS_DOMAIN").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map((j,G)=>{let z;return z=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),G,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),G),{url:z,areaCode:zb(),serviceIds:[hi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?hi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?hi.CLOUD_PROXY:hi.CLOUD_PROXY_FALLBACK]}}),V=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),M=await Yb({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(x.debug("[".concat(e.clientId,"] Connect to choose_server:"),j.url),d6(j,e,t,r)),allFailedhandler:j=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},V),j[0]},promisesCollector:g});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},V),M},v=async()=>{if(await is(1e3),f!==null)return f;const D=Z("WEBCS_DOMAIN_BACKUP_LIST").map((j,G)=>{let z;return z=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),G,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),G),{url:z,areaCode:zb(),serviceIds:[hi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?hi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?hi.CLOUD_PROXY:hi.CLOUD_PROXY_FALLBACK]}}),V=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),M=await Yb({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(x.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),j.url),d6(j,e,t,r)),allFailedhandler:j=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},V),j[0]},promisesCollector:g});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},V),M};let S,R,I;try{({gatewayInfo:S,proxyInfo:R,url:I}=await sv([E(),v()]))}catch(D){throw D[0]}if(g.length&&g.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),!S||!R)throw new Te(q.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=I,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&I){const D=/^https?:\/\/(.+?)(\/.*)?$/.exec(I)[1];et(c).call(c,D)&&(e.proxyServer=D,x.setProxyServer(D),vt.setProxyServer(D))}return f={gatewayInfo:S,proxyInfo:await F9(R,S.uid)},f}async function Mre(e,t,r){const o=Z("UAP_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(f,g,E,v){const S={command:"convergeAllocateEdge",sid:g.sid,appId:g.appId,token:g.token,ts:Date.now(),version:Ac,cname:g.cname,uid:g.uid.toString(),requestId:b1,seq:b1};b1+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(S)};return ld(async()=>{const I=await fd(f,{data:R,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(I.code!==0){const V=new Te(q.UNEXPECTED_RESPONSE,"cross channel ap error, code"+I.code,{retry:!0});throw x.error(V.toString()),V}const D=JSON.parse(I.json_body);if(D.code!==200){const V=new Te(q.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(D.code,", reason: ").concat(D.reason));throw x.error(V.toString()),V}if(!D.servers||D.servers.length===0){const V=new Te(q.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(V.toString()),V}return{vid:D.vid,workerToken:D.workerToken,addressList:(Z("CHANNEL_MEDIA_RELAY_SERVERS")||D.servers).map(V=>"wss://".concat(V.address.replace(/\./g,"-"),".").concat(Z("WORKER_DOMAIN"),":").concat(V.wss))}},void 0,I=>!!(I.code!==q.OPERATION_ABORTED&&I.code!==q.UNEXPECTED_RESPONSE||I.data&&I.data.retry),v)}(u,e,t,r));try{const u=await sv(c);return c.forEach(f=>f.cancel()),u}catch(u){throw u[0]}}async function jre(e,t,r){let o=null;const c=[],u=async f=>{const g=Z(f?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(E=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(E+"/api/v2/transpond/webrtc?v=2"):"https://".concat(E,"/api/v2/transpond/webrtc?v=2"));return f&&(await is(1e3),o!==null)?o:await Yb({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:E=>(x.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(f?"backup":""," choose_server:"),E),function(v,S,R,I){const[D]=Pre(S,[hi.CHOOSE_SERVER]);let V=ui.networkState;return ld(async()=>{V&&ui.networkState===Oo.OFFLINE&&ui.onlineWaiter&&await nt.race([ui.onlineWaiter,is(I&&I.maxRetryTimeout||Si.maxRetryTimeout)]),V=ui.networkState;const M=await fd(v,{data:D,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return xre(M,v)},()=>!1,M=>M.code!==q.OPERATION_ABORTED&&(M.code===q.UPDATE_TICKET_FAILED?M.data.retry:(x.warning("[".concat(S.clientId,"] update ticket network error, retry"),M),!0)),I)}(E,e,t,r)),allFailedhandler:E=>{throw E[0]},promisesCollector:c})};try{return o=await sv([u(!1),u(!0)]),c.length&&c.forEach(f=>f.cancel&&typeof f.cancel=="function"&&f.cancel()),o}catch(f){throw f[0]}}function _6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function A1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class Ure extends Dr{get isSuccess(){return!!this.configs}constructor(t,r){super(),H(this,"configs",void 0),H(this,"store",void 0),H(this,"joinInfo",void 0),H(this,"cancelToken",void 0),H(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),H(this,"interval",void 0),H(this,"mutex",void 0),H(this,"mutableParamsRead",!1),H(this,"configCache",{}),H(this,"limit_bitrate",void 0),this.mutex=new Ps("config-distribute",t),this.store=r}startGetConfigDistribute(t,r){this.joinInfo=t,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),Z("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},Z("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,vt.reportApiInvoke(null,{options:void 0,name:di.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Hr.TRACER}).onSuccess(JSON.stringify(dd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const r=await this.mutex.lock();try{t=await Lre(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(t));const o=function(c){var u;const f=Ft(u=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(u);for(let v=0;v<f.length;v++)for(let S=f.length-1;S>v;S--){const R=f[S],I=c[R].value;if(typeof I.__priority=="number"){const D=I.__priority,V=f[S-1],M=c[V].value;if(typeof M.__priority=="number"){if(!(D>M.__priority))continue;{const j=R;f[S]=f[S-1],f[S-1]=j}}else{const j=R;f[S]=f[S-1],f[S-1]=j}}}const g=Date.now();let E={};return f.forEach(v=>{const S=c[v].value.__expires;S&&S<=g||(E[v]=c[v])}),E}(t);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Te(q.NETWORK_RESPONSE_ERROR,o);x.warning("[config-distribute] ".concat(c.toString()))}finally{r()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){N9(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Ub.UPDATE_BITRATE_LIMIT,t):this.emit(Ub.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&A1({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const r={},o=Object.keys(t),c=[];o.forEach(u=>{const f=t[u].value;r[u]=f;const g=f.__id;if(g&&this.configCache[u]&&this.configCache[u].__id===g)return;const E=f.__type,v=t[u].value,S=t[u].tag;let R=0;E?E===n4.REALTIME&&(R=1):Object.keys(v).some(I=>Object.prototype.hasOwnProperty.call(Pk,I)||!n1()&&Object.prototype.hasOwnProperty.call(PA,I)?(R=1,!0):void 0),c.push({tag:S,isApplied:R,feature:u,params:JSON.stringify(f)})}),c.forEach(u=>{let{tag:f,feature:g,params:E,isApplied:v}=u;this.store.sessionId&&vt.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:f,feature:g,params:E,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=r}catch(r){x.debug("handleABTestConfigDistribute error",r)}}cacheGlobalParameterConfig(t){const r=function(c){const u={};return Object.keys(c).forEach(f=>{const g=c[f].value,E=g.__expires,v=g.__type;Object.keys(g).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=A1(A1({value:g[S]},E&&{expires:E}),v&&{type:v}))})}),u}(t);try{var o;const c=(o=r.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete r.LIMIT_BITRATE,c&&N9(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(r),this.handleABTestConfigDistribute(t),function(g){try{const E=Date.now();Object.keys(g).forEach(v=>{const{value:S,type:R,expires:I}=g[v];I&&I<=E||((R===n4.REALTIME||Object.prototype.hasOwnProperty.call(Pk,v))&&(dd[v]=S,Sr[v]=S,x.debug("Update realtime parameters from config distribute",v,S)),R||n1()||!Object.prototype.hasOwnProperty.call(PA,v)||(dd[v]=S,Sr[v]=S,x.debug("Update gateway parameters from config distribute",v,S)))})}catch(E){x.error("Error update config immediately: ".concat(g),E.message)}}(r);const u=JSON.stringify(r),f=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",f),x.debug("Caching global parameters ".concat(u))}catch(c){x.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(t){try{const r=Date.now();Object.keys(t).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Sr,o)){const{value:c,expires:u}=t[o];if(u&&u<=r)return;(function(f,g){try{return typeof f=="object"&&typeof g=="object"&&JSON.stringify(f)===JSON.stringify(g)}catch{return!1}})(Sr[o],c)||(dd[o]=c,Sr[o]=c,this.emit(Ub.UPDATE_CLIENT_ROLE_OPTIONS,c),x.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(r){x.error("Error handling global parameter config:",r.message)}}}class Vre extends Dr{constructor(){super(...arguments),H(this,"resultStorage",new Map)}setLocalAudioStats(t,r,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(o,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(o,r))}setLocalVideoStats(t,r,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(o,r)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(o,r)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(o))}setRemoteAudioStats(t,r){const o=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(r))}setRemoteVideoStats(t,r){const o=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(r))}record(t,r,o){if(Z("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(t);if(c&&(c.result.push(o),c.result.length>=5)){var u;const f=et(u=c.result).call(u,!0);c.isPrevNormal&&!f&&this.emit("exception",E6[t],t,r),!c.isPrevNormal&&f&&this.emit("exception",E6[t]+2e3,t+"_RECOVER",r),c.isPrevNormal=f,c.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,r){return r instanceof Ni&&!r.isActive||!!r.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,r){let o=null;r._encoderConfig&&r._encoderConfig.frameRate&&(o=Do(r._encoderConfig.frameRate));const c=t.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,r){return!!r.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,r){return r instanceof Ni&&!r.isActive||!!r.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const E6={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ms=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){const o=r[r.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,t){const r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){const o=r[r.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function y6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Wg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?y6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class qb{constructor(t){H(this,"store",void 0),H(this,"onStatsException",void 0),H(this,"onUploadPublishDuration",void 0),H(this,"onStatsChanged",void 0),H(this,"onVideoCodecChanged",void 0),H(this,"localStats",new Map),H(this,"remoteStats",new Map),H(this,"updateStatsInterval",void 0),H(this,"trafficStats",void 0),H(this,"trafficStatsPeerList",[]),H(this,"uplinkStats",void 0),H(this,"exceptionMonitor",void 0),H(this,"p2pChannel",void 0),H(this,"scalabilityMode",xA.L1T1),H(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Vre,this.exceptionMonitor.on("exception",(r,o,c)=>{this.onStatsException&&this.onStatsException(r,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ve.LocalAudioTrack)||Wg({},Uk)}getLocalVideoTrackStats(){return this.localStats.get(Ve.LocalVideoTrack)||Wg({},Vk)}getRemoteAudioTrackStats(t){const r=(u,f)=>{if(!this.trafficStats)return f;const g=this.trafficStats.peer_delay.find(E=>E.peer_uid===u);return g&&(f.publishDuration=g.B_ppad+(Date.now()-this.trafficStats.timestamp)),f},o={};if(t){var c;const u=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.audioStats;u&&(o[t]=r(t,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[f,{audioStats:g}]=u;g&&(o[f]=r(f,g))});return o}getRemoteNetworkQualityStats(t){const r={};if(t){var o;const c=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.networkStats;c&&(r[t]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:f}]=c;f&&(r[u]=f)});return r}getRemoteVideoTrackStats(t){const r=(u,f)=>{if(!this.trafficStats)return f;const g=this.trafficStats.peer_delay.find(E=>E.peer_uid===u);return g&&(f.publishDuration=g.B_ppvd+(Date.now()-this.trafficStats.timestamp)),f},o={};if(t){var c;const u=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.videoStats;u&&(o[t]=r(t,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[f,{videoStats:g}]=u;g&&(o[f]=r(f,g))});return o}getRTCStats(){let t=0,r=0,o=0,c=0;const u=this.localStats.get(Ve.LocalAudioTrack);u&&(t+=u.sendBytes,r+=u.sendBitrate);const f=this.localStats.get(Ve.LocalVideoTrack);f&&(t+=f.sendBytes,r+=f.sendBitrate);const g=this.localStats.get(Ve.LocalVideoLowTrack);g&&(t+=g.sendBytes,r+=g.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:S,videoStats:R}=v;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),R&&(o+=R.receiveBytes,c+=R.receiveBitrate)});let E=1;return this.trafficStats&&(E+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:E,SendBitrate:r,SendBytes:t,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(r=>r.B_ppad!==void 0||r.B_ppvd!==void 0),t.peer_delay.filter(r=>this.trafficStatsPeerList.indexOf(r.peer_uid)===-1).forEach(r=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(r.peer_uid),u=c!=null&&c.videoSSRC?Ms.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,f=c!=null&&c.audioSSRC?Ms.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;r.B_ppad!==void 0&&r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,u>f?u:f),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,o){if(!t)return!1;const c=!!o&&r.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||r.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(r=>{let[o,c]=r;switch(o){case Ve.LocalVideoTrack:case Ve.LocalVideoLowTrack:{const g=c,E=Wg({},Vk),v=t.getStats(),S=t.getLocalMedia(o);if(v){const R=v.videoSend.find(I=>I.ssrc===(S==null?void 0:S.ssrcs[0].ssrcId));if(R){const I=t.getLocalVideoSize(),D=t.getEncoderConfig(Ve.LocalVideoTrack);var u;(R.codec==="H264"||R.codec==="H265"||R.codec==="VP8"||R.codec==="VP9"||R.codec==="AV1X"||R.codec==="AV1")&&(E.codecType=R.codec,(g==null?void 0:g.codecType)!==R.codec&&((u=this.onVideoCodecChanged)===null||u===void 0||u.call(this,R.codec.toLocaleLowerCase()))),E.sendBytes=R.bytes,E.sendBitrate=g?8*Math.max(0,E.sendBytes-g.sendBytes):0,R.inputFrame?(E.captureFrameRate=R.inputFrame.frameRate,E.captureResolutionHeight=R.inputFrame.height,E.captureResolutionWidth=R.inputFrame.width):I&&(E.captureResolutionWidth=I.width,E.captureResolutionHeight=I.height),R.sentFrame?(E.sendFrameRate=R.sentFrame.frameRate,E.sendResolutionHeight=R.sentFrame.height,E.sendResolutionWidth=R.sentFrame.width):I&&(E.sendResolutionWidth=I.width,E.sendResolutionHeight=I.height),R.avgEncodeMs&&(E.encodeDelay=R.avgEncodeMs),D&&D.bitrateMax?E.targetSendBitrate=1e3*D.bitrateMax:R.targetBitrate&&(E.targetSendBitrate=R.targetBitrate),E.sendPackets=R.packets,E.sendPacketsLost=R.packetsLost,E.sendJitterMs=R.jitterMs,E.sendRttMs=R.rttMs,E.totalDuration=g?g.totalDuration+1:1,E.totalFreezeTime=g?g.totalFreezeTime:0,this.isLocalVideoFreeze(R)&&(E.totalFreezeTime+=1),R.scalabilityMode&&this.scalabilityMode!==R.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(R.scalabilityMode)),this.scalabilityMode=R.scalabilityMode)}this.trafficStats&&(E.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var f;this.localStats.set(o,E),((g==null?void 0:g.sendResolutionWidth)!==E.sendResolutionWidth||(g==null?void 0:g.sendResolutionHeight)!==E.sendResolutionHeight)&&((f=this.onStatsChanged)===null||f===void 0||f.call(this,"resolution",{width:E.sendResolutionWidth,height:E.sendResolutionHeight})),E&&S&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,S.track,E);break}case Ve.LocalAudioTrack:{const g=c,E=Wg({},Uk),v=t.getStats(),S=t.getLocalMedia(o);if(v){const R=v.audioSend.find(I=>I.ssrc===(S==null?void 0:S.ssrcs[0].ssrcId));if(R){if(R.codec!=="opus"&&R.codec!=="aac"&&R.codec!=="PCMU"&&R.codec!=="PCMA"&&R.codec!=="G722"||(E.codecType=R.codec),R.inputLevel)E.sendVolumeLevel=Math.round(32767*R.inputLevel);else{const I=t.getLocalAudioVolume();I&&(E.sendVolumeLevel=Math.round(32767*I))}E.sendBytes=R.bytes,E.sendPackets=R.packets,E.sendPacketsLost=R.packetsLost,E.sendJitterMs=R.jitterMs,E.sendRttMs=R.rttMs,E.sendBitrate=g?8*Math.max(0,E.sendBytes-g.sendBytes):0}}this.trafficStats&&(E.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ve.LocalAudioTrack,E),E&&S&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,S.track,E);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(r=>{var o,c;let[u,{videoStats:f,audioStats:g,videoPcStats:E}]=r;const v=g,S=f,R=E,I=Wg({},p4),D=Wg({},f4),V=Wg({},Tne),{audioTrack:M,videoTrack:j,audioSSRC:G,videoSSRC:z}=t.getRemoteMedia(u);let ce;ce=this.store.useP2P?t.getStats(!0):t.getStats();const Ee=(o=ce)===null||o===void 0?void 0:o.audioRecv.find(xe=>xe.ssrc===G),_e=(c=ce)===null||c===void 0?void 0:c.videoRecv.find(xe=>xe.ssrc===z),me=this.trafficStats&&this.trafficStats.peer_delay.find(xe=>xe.peer_uid===u);if(Ee&&(Ee.codec!=="opus"&&Ee.codec!=="aac"&&Ee.codec!=="PCMU"&&Ee.codec!=="PCMA"&&Ee.codec!=="G722"||(I.codecType=Ee.codec),Ee.outputLevel?I.receiveLevel=Math.round(32767*Ee.outputLevel):M&&(I.receiveLevel=Math.round(32767*M.getVolumeLevel())),I.receiveBytes=Ee.bytes,I.receivePackets=Ee.packets,I.receivePacketsLost=Ee.packetsLost,I.receivePacketsDiscarded=Ee.packetsDiscarded,I.packetLossRate=I.receivePacketsLost/(I.receivePackets+I.receivePacketsLost),I.receiveBitrate=v?8*Math.max(0,I.receiveBytes-v.receiveBytes):0,I.totalDuration=v?v.totalDuration+1:1,I.totalFreezeTime=v?v.totalFreezeTime:0,I.freezeRate=I.totalFreezeTime/I.totalDuration,I.receiveDelay=Ee.jitterBufferMs,I.totalDuration>10&&qb.isRemoteAudioFreeze(M)&&(I.totalFreezeTime+=1)),_e){var Ce;_e.codec!=="H264"&&_e.codec!=="H265"&&_e.codec!=="VP8"&&_e.codec!=="VP9"&&_e.codec!=="AV1X"&&_e.codec!=="AV1"||(D.codecType=_e.codec),D.receiveBytes=_e.bytes,D.receiveBitrate=S?8*Math.max(0,D.receiveBytes-S.receiveBytes):0,D.decodeFrameRate=_e.decodeFrameRate<0?0:_e.decodeFrameRate,D.renderFrameRate=_e.decodeFrameRate<0?0:_e.decodeFrameRate,_e.outputFrame&&(D.renderFrameRate=_e.outputFrame.frameRate),_e.receivedFrame?(D.receiveFrameRate=_e.receivedFrame.frameRate,D.receiveResolutionHeight=_e.receivedFrame.height,D.receiveResolutionWidth=_e.receivedFrame.width):j&&(D.receiveResolutionHeight=j._videoHeight||0,D.receiveResolutionWidth=j._videoWidth||0),_e.framesRateFirefox!==void 0&&(D.receiveFrameRate=Math.round(_e.framesRateFirefox)),D.receivePackets=_e.packets,D.receivePacketsLost=_e.packetsLost,D.packetLossRate=D.receivePacketsLost/(D.receivePackets+D.receivePacketsLost);const xe=S?S.totalFreezeTime:0,$e=S?S.totalDuration:0;D.totalDuration=S?S.totalDuration+1:1,D.totalFreezeTime=(Ce=_e.totalFreezesDuration)!==null&&Ce!==void 0?Ce:xe||0,D.receiveDelay=_e.jitterBufferMs||0;const at=!!z&&t.getRemoteVideoIsReady(z);_e.totalFreezesDuration===void 0&&j&&at&&qb.isRemoteVideoFreeze(j,_e,R)&&(D.totalFreezeTime+=1),D.freezeRate=Math.max(0,Math.min((D.totalFreezeTime-xe)/(D.totalDuration-$e),1))}me&&(I.end2EndDelay=me.B_ad,D.end2EndDelay=me.B_vd,I.transportDelay=me.B_ed,D.transportDelay=me.B_ed,I.currentPacketLossRate=me.B_ealr4/100,D.currentPacketLossRate=me.B_evlr4/100,V.uplinkNetworkQuality=me.B_punq?me.B_punq:0,V.downlinkNetworkQuality=me.B_pdnq?me.B_pdnq:0),this.remoteStats.set(u,{audioStats:I,videoStats:D,videoPcStats:_e,networkStats:V}),M&&this.exceptionMonitor.setRemoteAudioStats(M,I),j&&this.exceptionMonitor.setRemoteVideoStats(j,D)})}}class v6{constructor(){H(this,"destChannelMediaInfos",new Map),H(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){A9(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){A9(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){$A(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function S6(e){if(!(e instanceof v6))return new Te(q.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();if(!t)return new Te(q.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new Te(q.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Af{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,r){H(this,"uid",void 0),H(this,"_uintid",void 0),H(this,"_trust_in_room_",!0),H(this,"_trust_audio_enabled_state_",!0),H(this,"_trust_video_enabled_state_",!0),H(this,"_trust_audio_mute_state_",!0),H(this,"_trust_video_mute_state_",!0),H(this,"_audio_muted_",!1),H(this,"_video_muted_",!1),H(this,"_audio_enabled_",!0),H(this,"_video_enabled_",!0),H(this,"_audio_added_",!1),H(this,"_video_added_",!1),H(this,"_is_pre_created",!1),H(this,"_video_pre_subscribed",!1),H(this,"_audio_pre_subscribed",!1),H(this,"_trust_video_stream_added_state_",!0),H(this,"_trust_audio_stream_added_state_",!0),H(this,"_audioTrack",void 0),H(this,"_videoTrack",void 0),H(this,"_dataChannels",[]),H(this,"_audioSSRC",void 0),H(this,"_videoSSRC",void 0),H(this,"_audioOrtc",void 0),H(this,"_videoOrtc",void 0),H(this,"_cname",void 0),H(this,"_rtxSsrcId",void 0),H(this,"_videoMid",void 0),H(this,"_audioMid",void 0),this.uid=t,this._uintid=r}}function T6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function b6(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?T6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const Kb="9",w6=4e4;function R6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function zh(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?R6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}var av=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(av||{});const uI=new Map;function C6(e,t,r,o){let{scale:c}=e;if(c===0&&o===av.UP||c>=t.length-1&&o===av.DOWN)return e;let u=zh(zh({},e),{},{scale:o===av.DOWN?++c:--c});switch(r){case"maintain-framerate":u=zh(zh({},u),t[c].motion);break;case"maintain-resolution":u=zh(zh({},u),t[c].detail);break;case"balanced":u=zh(zh({},u),t[c].balanced)}return u}function A6(e,t){if(t){const r={overUse:0,underUse:0,adaptationList:I6(t)};uI.set(e,r)}else uI.delete(e)}function I6(e){const t=zh({},e),{bitrateMax:r,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=t,{MIN_FRAME_RATE:f,MAX_THRESHOLD_FRAMERATE:g,MAX_SCALE:E,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:I,PERF_SCALE_DOWN_THRESHOLD:D,PERF_SCALE_UP_THRESHOLD:V,BALANCE_BITRATE_FACTOR:M,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:G,MOTION_RESOLUTION_FACTOR:z,MOTION_BITRATE_FACTOR:ce,DETAIL_FRAMERATE_FACTOR:Ee,DETAIL_BITRATE_FACTOR:_e}=Dk,me=Math.min(t.frameRate,g),Ce=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(I,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(D,1)*me),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:r,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:r,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:r,bitrateMin:u}}];for(let xe=1;xe<=E;xe++){const $e={bwe_up:Math.round(Math.pow(R,xe)*r),bwe_down:Math.round(Math.pow(I,xe+1)*r),fps_up:Math.round(Math.pow(V,xe)*me),fps_down:Math.round(Math.pow(D,xe+1)*me)},at={scaleResolutionDownBy:c/Math.pow(G,xe),frameRate:Math.max(Math.round(Math.pow(j,xe)*o),f),bitrateMax:Math.max(Math.round(Math.pow(M,xe)*r),S),bitrateMin:Math.max(Math.round(Math.pow(M,xe)*u),v)},Zt={scaleResolutionDownBy:c/Math.pow(z,xe),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(ce,xe)*r),S),bitrateMin:Math.max(Math.round(Math.pow(ce,xe)*u),v)},qt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Ee,xe)*o),f),bitrateMax:Math.max(Math.round(Math.pow(_e,xe)*r),S),bitrateMin:Math.max(Math.round(Math.pow(_e,xe)*u),v)};Ce.push({scale:xe,threshold:$e,balanced:at,motion:Zt,detail:qt})}return Ce}function Fre(e,t,r,o,c,u){const f=uI.get(e)||{overUse:0,underUse:0,adaptationList:I6(c)},{adaptationList:g}=f;uI.set(e,f);const{OVERUSE_TIMES_THRESHOLD:E,UNDERUSE_TIMES_THRESHOLD:v}=Dk,{scale:S}=o;let R,I;return typeof t=="number"&&t>0&&function(D,V,M,j){if(V>=M.length)return!1;let{threshold:{fps_down:G}}=M[V];return Z("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(G=M[0].threshold.fps_down),D<G}(t,S,g,u)&&(f.overUse++,I=Db.CPU,f.overUse>E)||typeof r=="number"&&r>0&&function(D,V,M){if(V>=M.length)return!1;const{threshold:{bwe_down:j}}=M[V];return D<j}(r,S,g)&&(f.overUse++,I=Db.BANDWIDTH,f.overUse>E)?(f.overUse=0,f.underUse=0,R=C6(o,g,u,av.DOWN),[R,I]):(typeof t=="number"&&t>0&&typeof r=="number"&&r>0&&function(D,V,M,j){if(V===0)return;let{threshold:{fps_up:G}}=M[V];return Z("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(G=M[1].threshold.fps_up),D>G}(t,S,g,u)&&function(D,V,M){if(V===0)return;const{threshold:{bwe_up:j}}=M[V];return D>j}(r,S,g)&&(f.underUse++,f.underUse>v&&(f.overUse=0,f.underUse=0,R=C6(o,g,u,av.UP),R.scale===0&&(I=Db.NONE))),[R,I])}function N6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function I1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?N6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function Bre(e){var t;return!!Z("ENABLE_AG_ADAPTATION")&&!!(e instanceof Kk||et(t=e._hints).call(t,Zn.CUSTOM_TRACK))&&(!!Z("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(r){const o=An();if(o.os!==Fi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=r}(14)&&w3(17,4)||b3(14)&&R3(17,4,!0)))}const hI=new Map;function pI(e,t){const r=hI.get(e);if(r){const{timer:o}=r;window.clearTimeout(o),hI.delete(e)}t.qualityLimitationReason=Db.NONE,A6(e)}function Hre(e,t){var r;let o;switch(t){case Ve.LocalAudioTrack:o=Hn.Audio;break;case Ve.LocalVideoTrack:o=et(r=e._hints).call(r,Zn.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Ve.LocalVideoLowTrack:o=Hn.Low}return o}function N1(e){const t=In();if(e.some(r=>r._bypassWebAudio))throw new Ae(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new Ae(q.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function O1(e,t){N1(e);const r=new Ni;return e.forEach(o=>r.addAudioTrack(o)),r}const Gre=!In().supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&jh();function fI(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;return Gre?(r={spec:t,store:e},Wh("PlanBConnection").create(r)):new _u(t,e)}function D1(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function O6(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Ib(e.turnServer.servers))return!1;if(Z("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var Sn;function D6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function md(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?D6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let _u=(Sn=class a_ extends D9{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return et(r=Object.keys(kA)).call(r,t)}))]}constructor(t,r){super(t,r),H(this,"id",lr(5,"connection-")),H(this,"store",void 0),H(this,"peerConnection",void 0),H(this,"forceTurn",!1),H(this,"remoteSDP",void 0),H(this,"initialOffer",void 0),H(this,"transportEventReceiver",void 0),H(this,"statsFilter",void 0),H(this,"extension",{useXR:Z("USE_XR")}),H(this,"localCapabilities",void 0),H(this,"remoteCodecs",void 0),H(this,"localCandidateCount",0),H(this,"allCandidatesReceived",!1),H(this,"isPreallocation",!1),H(this,"preSSRCMap",new Map),H(this,"dataStreamChannelMap",new Map),H(this,"establishPromise",void 0),H(this,"recoveredDataChannelIds",[]),H(this,"currentDataChannelId",1),H(this,"supportAV1RtpSpec",!1),H(this,"mutex",void 0),H(this,"qualityLimitationReason",Db.NONE),H(this,"isFirstConnected",!1),this.store=r,this.forceTurn=O6(t),this.mutex=new Ps("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(a_.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=Ik(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,Fr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){const r=this.preSSRCMap.get(t);if(r!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(o)return{transceiver:o,track:o.receiver.track,id:r}}}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Rf(o.sdp),u=await Q9({filterRTX:!Z("USE_PUB_RTX")&&!Z("USE_SUB_RTX"),filterVideoFec:Z("FILTER_VIDEO_FEC"),filterAudioFec:Z("FILTER_AUDIO_FEC"),filterVideoCodec:Z("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=aI(u),this.initialOffer=o,Z("ENABLE_SVC")&&this.store.codec=="av1"){const g=await async function(){try{const E=new RTCPeerConnection;E.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:xA.L1T3}]});const v=await E.createOffer();if(!v.sdp)return void E.close();const S=to(v.sdp).mediaDescriptions[0];if(!S)return;const R=S.attributes.extmaps.find(I=>I.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return E.close(),R}catch{return}}();var t;g&&(this.supportAV1RtpSpec=!0,(t=u.send)===null||t===void 0||t.videoExtensions.push(g))}let f;return o.sdp&&e6(o.sdp)&&(f=xr(u),(r=f).send&&(tv(lt.VIDEO,r.send.videoExtensions),tv(lt.AUDIO,r.send.audioExtensions)),r.recv&&(tv(lt.VIDEO,r.recv.videoExtensions),tv(lt.AUDIO,r.recv.audioExtensions)),r.sendrecv&&(tv(lt.VIDEO,r.sendrecv.videoExtensions),tv(lt.AUDIO,r.sendrecv.audioExtensions))),md(md({},c),{},{rtpCapabilities:f||u,offerSDP:o.sdp})}catch(o){throw new Ae(q.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var r}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&e6(this.initialOffer.sdp)&&(r=t.rtpCapabilities,o=this.localCapabilities,r.send&&(rI(lt.VIDEO,r.send.videoExtensions,o.send.videoExtensions),rI(lt.AUDIO,r.send.audioExtensions,o.send.audioExtensions)),r.recv&&(rI(lt.VIDEO,r.recv.videoExtensions,o.recv.videoExtensions),rI(lt.AUDIO,r.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return xr(this._localCapabilities)}get rtpCapabilities(){return xr(this._rtpCapabilities)}get candidates(){return xr(this._candidates)}get iceParameters(){return xr(this._iceParameters)}get dtlsParameters(){return xr(this._dtlsParameters)}constructor(v){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];H(this,"sessionDesc",void 0),H(this,"_localCapabilities",void 0),H(this,"_rtpCapabilities",void 0),H(this,"_candidates",void 0),H(this,"_originCandidates",void 0),H(this,"_iceParameters",void 0),H(this,"_isUseExtmapAllowMixed",void 0),H(this,"_dtlsParameters",void 0),H(this,"setup",void 0),H(this,"currentMidIndex",void 0),H(this,"cname",void 0),H(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,v=xr(v);const{iceParameters:R,dtlsParameters:I,candidates:D,rtpCapabilities:V,setup:M,localCapabilities:j,cname:G}=v;this._rtpCapabilities=V,this._candidates=D,this._originCandidates=xr(D),this._iceParameters=R,this._dtlsParameters=I,this._localCapabilities=j,this.setup=M,this.cname=G,this.sessionDesc=this.updateRemoteRTPCapabilities(V),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(v){const S=this.candidates,R=this.dtlsParameters,I=this.iceParameters,D=this.rtpCapabilities.send;let V=this.sessionDesc.mediaDescriptions.length-1;for(let M=1;M<v;M++){const j=2*M+2e4,G=2*M+w6,{ssrcs:z,ssrcGroups:ce}=Gg([{ssrcId:j}],this.cname),{ssrcs:Ee,ssrcGroups:_e}=Gg([{ssrcId:G,rtx:Z("USE_SUB_RTX")?G+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Kb,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.videoCodecs.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:S,extmaps:D.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Ee,ssrcGroups:_e,rtcpFeedbackWildcards:[],payloads:D.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++V)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Kb,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.audioCodecs.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:S,extmaps:D.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:z,ssrcGroups:ce,rtcpFeedbackWildcards:[],payloads:D.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++V)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return vf(this.sessionDesc)}send(v,S,R,I){const{ssrcs:D,ssrcGroups:V}=Gg(S,this.cname,Z("SYNC_GROUP")?R:void 0),M=this.findPreloadMediaDesc(D);if(M){if(Fr()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,M.attributes.mid),I&&(I.twcc||I.remb)){const j=this.sessionDesc.mediaDescriptions.indexOf(M);return this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(M,I),{mid:M.attributes.mid,needExchangeSDP:!0}}return{mid:M.attributes.mid,needExchangeSDP:!1}}{const j=this.findAvailableMediaIndex(v,D);let G;return j===-1||j===1&&(fs()||function(){const z=An();return!(z.name!==Un.CHROME||!z.osVersion)&&Number(z.version)<=90}()||Z("ENABLE_ENCODED_TRANSFORM")&&Mh())||j===0&&Z("USE_SUB_RTX")||C3()?(G=this.createOrRecycleSendMedia(v,D,V,"sendonly",I),this.updateBundleMids()):(G=xr(this.sessionDesc.mediaDescriptions[j]),G.attributes.direction="sendonly",G.attributes.ssrcs=D,G.attributes.ssrcGroups=V,this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(G,I)),Fr()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,G.attributes.mid),{mid:G.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:v,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:v.attributes.mid,needExchangeSDP:S}}batchSend(v){const S=v.map(D=>{let{kind:V,ssrcMsg:M,mslabel:j}=D;return this.send(V,M,j)}),R=[];let I=!1;return S.forEach(D=>{let{mid:V,needExchangeSDP:M}=D;M&&(I=!0),R.push(V)}),{mids:R,needExchangeSDP:I}}stopSending(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&v.indexOf(R.attributes.mid)!==-1);if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(R=>{R.attributes.mid==="0"||Fr()||C3()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(v){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!S)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(v){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!S)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>et(v).call(v,R.attributes.mid||""));if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>et(v).call(v,R.attributes.mid||""));if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="recvonly"})}receive(v,S,R,I){v.forEach((D,V)=>{this.createOrRecycleRecvMedia(D,[],"recvonly",S,R,I[V])}),this.updateBundleMids()}stopReceiving(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>v.indexOf(R.attributes.mid)!==-1);if(S.length!==v.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(v){const S=this.sessionDesc||to((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=v;const I=this.rtpCapabilities.send,D=this.localCapabilities.send;for(const V of S.mediaDescriptions){if(V.attributes.iceUfrag=this._iceParameters.iceUfrag,V.attributes.icePwd=this._iceParameters.icePwd,V.attributes.fingerprints=this._dtlsParameters.fingerprints,V.attributes.candidates=this._candidates,V.attributes.setup=this.setup,V.media.mediaType==="application"&&(V.attributes.sctpPort="5000"),V.media.mediaType==="video"){if(I.videoCodecs.length===0){const M=D.videoCodecs.filter(j=>{var G,z;return(G=j.rtpMap)===null||G===void 0?void 0:et(z=G.encodingName.toLowerCase()).call(z,"vp8")})||[D.videoCodecs[0]];V.media.fmts=M.map(j=>j.payloadType.toString(10)),V.attributes.payloads=M,V.attributes.extmaps=[]}else if(V.media.fmts=I.videoCodecs.map(M=>M.payloadType.toString(10)),V.attributes.payloads=I.videoCodecs,V.attributes.extmaps=I.videoExtensions,Z("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:M,ssrcGroups:j}=Gg([{ssrcId:w6,rtx:Z("USE_SUB_RTX")?40001:void 0}],this.cname);V.attributes.ssrcs=M,V.attributes.ssrcGroups=j}}if(V.media.mediaType==="audio"){if(I.audioCodecs.length===0){const M=D.audioCodecs.filter(j=>{var G,z;return(G=j.rtpMap)===null||G===void 0?void 0:et(z=G.encodingName.toLowerCase()).call(z,"opus")})||[D.audioCodecs[0]];V.media.fmts=M.map(j=>j.payloadType.toString(10)),V.attributes.payloads=M,V.attributes.extmaps=[]}else if(V.media.fmts=I.audioCodecs.map(M=>M.payloadType.toString(10)),V.attributes.payloads=I.audioCodecs,V.attributes.extmaps=I.audioExtensions,rv(V),Z("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:M,ssrcGroups:j}=Gg([{ssrcId:2e4}],this.cname);V.attributes.ssrcs=M,V.attributes.ssrcGroups=j}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(v){const S=this._originCandidates.filter(I=>I.transport==="udp"),R=[];if(S.forEach(I=>{R.push(b6(b6({},I),{},{foundation:"tcpcandidate",priority:Number(I.priority)-1+"",transport:"tcp",port:Number(I.port)+90+""}))}),S.length!==0){switch(v){case Ls.TCP_RELAY:this._candidates=R;break;case Ls.UDP_TCP_RELAY:case Ls.RELAY:this._candidates=[...S,...R];break;default:this._candidates=S}for(const I of this.sessionDesc.mediaDescriptions)I.attributes.candidates=this.candidates}}restartICE(v){v=xr(v),this._iceParameters=v,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=v.iceUfrag,S.attributes.icePwd=v.icePwd})}predictReceivingMids(v){const S=[];for(let R=0;R<v;R++)S.push((this.currentMidIndex+R+1).toString(10));return S}findAvailableMediaIndex(v,S){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const I=R.media.mediaType===v&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(Fr()){if(I){const D=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(D||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!D||D!==R.attributes.mid)}return!1}return I})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const v="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:Kb,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(v),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(v,S,R,I,D,V){const M=v._mediaStreamTrack.kind,j=this.rtpCapabilities.recv,G=Gb(M,j,this.localCapabilities.send,M===lt.VIDEO?I:D),z=M===lt.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const ce="".concat(this.currentMidIndex);let Ee={media:{mediaType:M,port:Kb,protos:["UDP","TLS","RTP","SAVPF"],fmts:G.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:z,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:G,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ce)}};Ee=this.mungRecvMediaDsec(Ee,v,V);const _e=this.findFirstClosedMedia(M);if(_e){const me=this.sessionDesc.mediaDescriptions.indexOf(_e);this.sessionDesc.mediaDescriptions[me]=Ee}else this.sessionDesc.mediaDescriptions.push(Ee);return Ee}updateRemoteCodec(v,S,R){const I=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(Ee=>Ee.rtpMap&&Ee.rtpMap.encodingName.toLowerCase()||"").filter(Ee=>{var _e;return et(_e=Object.keys(kA)).call(_e,Ee)}))],D=new Set(S);if(I.every(Ee=>D.has(Ee)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const V=this._rtpCapabilities.recv.videoCodecs.filter(Ee=>S.some(_e=>{var me;return et(me=Ee.rtpMap&&Ee.rtpMap.encodingName.toLowerCase()||"").call(me,_e)}));if(V.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(I," codecs: ").concat(S)),!1;const M=[...new Set(V.map(Ee=>Ee.rtpMap&&Ee.rtpMap.encodingName.toLowerCase()||""))];let j;if(x.debug("updateRemoteCodec, from ".concat(I," to ").concat(M)),v.length===0)j=this.sessionDesc.mediaDescriptions.filter(Ee=>Ee.media.mediaType==="video"&&Ee.attributes.direction==="recvonly");else if(j=this.sessionDesc.mediaDescriptions.filter(Ee=>Ee.attributes.mid&&et(v).call(v,Ee.attributes.mid)&&Ee.attributes.direction==="recvonly"),j.length!==v.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(v,", codecs: ").concat(S)),!1;if(Z("USE_PUB_RTX")||Z("USE_SUB_RTX")){const Ee=_1(V,this.rtpCapabilities.recv.videoCodecs);V.push(...Ee)}this._rtpCapabilities.recv.videoCodecs=V;const G=this.localCapabilities.send,z=this.rtpCapabilities.recv,ce=Gb(lt.VIDEO,z,G,R);return j.forEach(Ee=>{const _e=ce.map(me=>me.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(Ee.attributes.mid,", from"),Ee.attributes.payloads,"to",ce),Ee.attributes.payloads=ce,Ee.media.fmts=_e}),!0}createOrRecycleSendMedia(v,S,R,I,D){const V=this.rtpCapabilities.send,M=v===lt.VIDEO?V.videoCodecs:V.audioCodecs,j=v===lt.VIDEO?V.videoExtensions:V.audioExtensions;this.currentMidIndex+=1;const G="".concat(this.currentMidIndex);let z={media:{mediaType:v,port:Kb,protos:["UDP","TLS","RTP","SAVPF"],fmts:M.map(Ee=>Ee.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:M,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:I,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(G)}};z=this.mungSendMediaDesc(z,D);const ce=this.findFirstClosedMedia(v);if(ce){const Ee=this.sessionDesc.mediaDescriptions.indexOf(ce);this.sessionDesc.mediaDescriptions[Ee]=z}else this.sessionDesc.mediaDescriptions.push(z);return z}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(v=>v.media.port!=="0").map(v=>v.attributes.mid)}mungRecvMediaDsec(v,S,R){const I=xr(v);return m1(I),nv(I,S),g1(I,S),K9(I),sI(I,R,this.localCapabilities.send),I}mungSendMediaDesc(v,S){const R=xr(v);return sI(R,S,this.localCapabilities.recv),rv(R),R}updateRecvMedia(v,S){const R=this.sessionDesc.mediaDescriptions.findIndex(I=>I.attributes.mid===v);if(R!==-1){const I=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],S);this.sessionDesc.mediaDescriptions[R]=I}}bumpMid(v){this.currentMidIndex+=v}findFirstClosedMedia(v){return this.sessionDesc.mediaDescriptions.find(S=>Fr()?S.media.port==="0"&&S.media.mediaType===v:S.media.port==="0")}findPreloadMediaDesc(v){return this.sessionDesc.mediaDescriptions.find(S=>{var R;return((R=S.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===v[0].ssrcId})}getSSRC(v){var S;return(S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v))===null||S===void 0?void 0:S.attributes.ssrcs}}(md(md({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=J9(this.initialOffer.sdp,this.extension),f=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),f==null||f(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const g=this.peerConnection.getTransceivers()[0];if(g!=null&&g.receiver&&this.tryBindTransportEvents(g.receiver),Z("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(Z("PRELOAD_MEDIA_COUNT"));const v=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:v});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:E}=t;if(Array.isArray(E)&&E.length>0){const{mids:v}=this.remoteSDP.batchSend(E.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));v.forEach((S,R)=>{this.preSSRCMap.set(E[R].ssrcId,S)}),await Wb(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var r,o}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:r}=t;this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=t;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,f)=>{this.preSSRCMap.set(o[f].ssrcId,u)})}await Wb(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r.toString()))}}send(t,r,o){var c=this;return Cc(function*(){const u=yield Cn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const f=[],g=nI();t.forEach(j=>{const G=c.peerConnection.addTransceiver(j._mediaStreamTrack,md({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&g?{sendEncodings:[{scalabilityMode:g}]}:{}));f.push(G),j._updateRtpTransceiver(G)}),Fr()&&Z("SIMULCAST")===!0&&(yield Cn(c.applySimulcastForFirefox(f,t)));const E=yield Cn(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(t.length),S=c.mungSendOfferSDP(E.sdp,t,v),R=to(S),I=v.map(j=>{const G=R.mediaDescriptions.find(z=>z.attributes.mid===j);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return z9(G,Z("USE_PUB_RTX"))});let D;try{D=yield I}catch(j){D=[],c.remoteSDP.receive(t,r,o,D);const G=c.remoteSDP.toString();throw yield Cn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Cn(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),yield Cn(c.stopSending(v,!0)),j}c.remoteSDP.receive(t,r,o,D);const V=c.remoteSDP.toString(),M=c.logSDPExchange(S,"offer","local","send");return yield Cn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Cn(c.applySimulcastEncodings(f,t)),yield Cn(c.applySendEncodings(f,t)),M==null||M(V),yield Cn(c.peerConnection.setRemoteDescription({type:"answer",sdp:V})),f.map((j,G)=>{const z=v[G];return{localSSRC:I[G],id:z,transceiver:j}})}catch(f){throw f instanceof Ae?f:new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(f.toString()))}finally{u()}})()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(t);if(o&&o.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:Z("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,o)}r.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(f),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Ae?o:new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(t){try{const r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof Ae?r:new Ae(q.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){const o=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(E=>t.indexOf(E.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(E=>{var v;pI(this.id+E.mid,this),E.direction="inactive",(v=E.stop)===null||v===void 0||v.call(E)});const u=await this.peerConnection.createOffer(),f=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(t);const g=this.remoteSDP.toString();f==null||f(g),await this.peerConnection.setRemoteDescription({type:"answer",sdp:g})}catch(c){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(t,r,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:u,needExchangeSDP:f}=this.remoteSDP.send(t,r,o,c);f&&(await Wb(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const g=this.peerConnection.getTransceivers().find(E=>E.mid===u);if(!g)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:g.receiver.track,id:u,transceiver:g}}catch(u){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:r,needExchangeSDP:o}=this.remoteSDP.batchSend(t);return o&&(await Wb(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r.map(c=>{const u=this.peerConnection.getTransceivers().find(f=>f.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(f=>{let[g,E]=f;if(E===u)return this.preSSRCMap.delete(g),!0})}),this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(f=>f.mid&&t.indexOf(f.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(f=>{f.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(t);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(f=>f.mid&&t.indexOf(f.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(f,g)=>{f.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return Cc(function*(){const o=yield Cn(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=In().supportPCSetConfiguration,u=Z("FORCE_TURN_TCP")||r.forceTurn;if(t===Ls.RELAY&&!c)return;if(c&&!u){const R=t===Ls.RELAY?"relay":"all",I=r.peerConnection.getConfiguration();I.iceTransportPolicy!==R&&(x.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(I.iceTransportPolicy,"] to [").concat(R,"]")),I.iceTransportPolicy=R,r.peerConnection.setConfiguration(I))}r.remoteSDP.updateCandidates(t);const f=yield Cn(r.peerConnection.createOffer({iceRestart:!0}));if(!f.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const g=Rf(f.sdp),{remoteIceParameters:E}=yield g.iceParameters;r.remoteSDP.restartICE(E);const v=r.remoteSDP.toString(),S=r.logSDPExchange(f.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield Cn(r.peerConnection.setLocalDescription(f)),S==null||S(v),yield Cn(r.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){x.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ls.TCP_RELAY),await Wb(this.peerConnection,this.remoteSDP,this.extension)}catch(r){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),r)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(r=>{pI(this.id+r.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return md(md({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const u=this.remoteSDP.toString(),f=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),f==null||f(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ae(q.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,r){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===t);o.length===1&&(this.isVP8Simulcast(r)?Fr()||await this.applySimulcastEncodings(o,[r]):await this.applySendEncodings(o,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const o=this.peerConnection.getTransceivers().find(c=>c.mid===r);o&&await o.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:o,remote:c}=r.getSelectedCandidatePair();return{local:md(md({},du),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:md(md({},du),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var r;const o="code: ".concat(t.errorCode,", message: ").concat(t.errorText),c=t.port?"local: ".concat(t.port):"";x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(t.url||"",", host_candidate:").concat(c)),(r=this.onICECandidateError)===null||r===void 0||r.call(this,o)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[]};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&(Ib(t.turnServer.servers)?r.iceServers=t.turnServer.servers:Z("NEW_TURN_MODE")&&r.iceServers?(Z("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&r.iceServers.push(...a_.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):r.iceServers.push(...a_.newTurnServerConfigToIceServers(t.turnServer.servers)),Z("NEW_FORCE_TURN")&&(r.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(r.iceServers&&r.iceServers.push(...a_.turnServerConfigToIceServers(t.turnServer.servers)),Z("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...a_.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),Z("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(r.iceTransportPolicy="relay")}))),Z("ENABLE_ENCODED_TRANSFORM")&&In().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach(o=>{o.security?o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(bf(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!Z("FORCE_TURN_TCP")&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),r}static newTurnServerConfigToIceServers(t){const r=[];return t.forEach(o=>{const c=Z("NEW_TURN_MODE");c===1?r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(bf(o.turnServerURL),":443?transport=tcp")}):c===4&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(bf(o.turnServerURL),":443?transport=tcp")}))}),r}tryBindTransportEvents(t){const r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var c;r!=null&&r.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,r.state))},r.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=r.iceTransport;o&&(o.onstatechange=()=>{const c=r==null?void 0:r.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var o,c;if(r||(r=this.peerConnection.getSenders().find(j=>j.track===t._mediaStreamTrack)),!r)return x.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!In().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},f={};switch(t._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const g=function(M,j){return M.getTransceivers().find(G=>G.sender.track===j||G.receiver.track===j)}(this.peerConnection,t._mediaStreamTrack),E=Ane(t);if(Bre(t)&&g&&r&&E&&this.getLocalVideoStats&&et(o=["vp8","vp9"]).call(o,this.store.codec)){var v;const M=u.degradationPreference||(et(v=t._hints).call(v,Zn.CUSTOM_TRACK)?Z("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(j,G,z,ce,Ee,_e){if(pI(j,z),Ee(G),ce!=="balanced"&&ce!=="maintain-framerate"&&ce!=="maintain-resolution")return;let me=-1;A6(j,G);const Ce=window.setInterval(()=>{const $e=hI.get(j);if(!Z("ENABLE_AG_ADAPTATION")||!$e)return pI(j,z),void Ee(G);const at=_e();if(at.sendPackets>0&&at.OutgoingAvailableBandwidth>0){if(me===-1)return void(me=Date.now());if(Date.now()-me<1e3)return;const Zt=at.sendFrameRate,qt=at.OutgoingAvailableBandwidth,[Pt,hr]=Fre(j,Zt,qt,$e.adaptationConfig,G,ce);hr&&(z.qualityLimitationReason=hr),Pt&&$e.adaptationConfig.scale!==Pt.scale&&(x.debug("[".concat(j,"] applyAdaptation: ").concat(z.qualityLimitationReason,`
           sendFps `).concat(Zt,", bwe ").concat(qt,", switch from ").concat($e.adaptationConfig.scale," to ").concat(Pt.scale," ")),$e.adaptationConfig=I1(I1({},$e.adaptationConfig),Pt),Ee(Pt))}},Z("CHECK_LOCAL_STATS_INTERVAL")),xe=I1({},G);hI.set(j,{timer:Ce,adaptationConfig:xe,originConfig:G,adaptationFunc:Ee}),x.debug("[".concat(j,"] start adaptation, originConfig: ").concat(JSON.stringify(G),", degradationPreference: ").concat(ce))})(this.id+g.mid,E,this,M,j=>{r&&this.updateAdaptation(r,j)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var S;const{bitrateMax:M,frameRate:j,scaleResolutionDownBy:G}=t._encoderConfig;M&&(f.maxBitrate=1e3*M),(et(S=t._hints).call(S,Zn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(j&&(f.maxFramerate=Do(j)),G&&G>=1&&(f.scaleResolutionDownBy=G))}const{maxFramerate:R}=Z("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(f.maxFramerate=f.maxFramerate?Math.min(f.maxFramerate,R):R),Z("DSCP_TYPE")&&jh()){var I;const M=Z("DSCP_TYPE");et(I=["very-low","low","medium","high"]).call(I,M)&&(f.networkPriority=M)}const D=r.getParameters(),V=(c=D.encodings)===null||c===void 0?void 0:c[0];Fr()&&!V&&(u.encodings=[f]),V&&Object.assign(V,f),Object.assign(D,u),x.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(D.encodings))),await r.setParameters(D),await async function(M,j,G){try{var z;if(!In().supportSetRtpSenderParameters||!function(Ce){return Ce==="vp9"||Ce==="av1"}(M)||!Z("ENABLE_SVC"))return;const ce={},Ee={},_e=j.getParameters(),me=(z=_e.encodings)===null||z===void 0?void 0:z[0];Ee.scalabilityMode=nI(G),me&&Object.assign(me,Ee),Object.assign(_e,ce),await j.setParameters(_e),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(_e.encodings)))}catch(ce){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ce)}}(this.store.codec,r,Z("SVC_MODE"))}async updateAdaptation(t,r){var o,c;if(!t)return x.debug("[updateAdaptation] no rtpSender found");if(!In().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:f,frameRate:g,scaleResolutionDownBy:E}=r;f&&(u.maxBitrate=1e3*f),g&&(u.maxFramerate=Do(g)),E&&E>=1&&et(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=E);const v=t.getParameters(),S=(c=v.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(v,{});try{await t.setParameters(v),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(R){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!In().supportSetRtpSenderParameters||t.length!==r.length)return;for(let o=0;o<t.length;o++){const c=t[o],u=r[o];u instanceof gr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,o){const c=to(t);return r.forEach((u,f)=>{const g=o[f],E=c.mediaDescriptions.find(v=>v.attributes.mid===g);E&&(nv(E,u),X9(E,u,this.store.codec))}),vf(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let E=0;E<t.length;E++){var o,c,u,f,g;const v=t[E],S=r[E];if(S instanceof gr&&!et(o=S._hints).call(o,Zn.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(f=S._scalabilityMode)!==null&&f!==void 0&&f.numSpatialLayers&&((g=S._scalabilityMode)===null||g===void 0?void 0:g.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},I={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const D=v.sender.getParameters();await v.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(t,r){if(!Fr()&&t.length===r.length)for(let o=0;o<t.length;o++){const c=r[o];if(c instanceof gr&&this.isVP8Simulcast(c)){const u=t[o],f={},g={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:g.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:g.medium,scaleResolutionDownBy:4}];const E=u.sender.getParameters();await u.sender.setParameters(Object.assign(E,f))}}}isVP8Simulcast(t){var r,o,c,u,f;return!!(t instanceof gr&&Z("SIMULCAST")&&this.store.codec==="vp8"&&!et(r=t._hints).call(r,Zn.LOW_STREAM)&&(o=t._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=t._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((f=t._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1)}logSDPExchange(t,r,o,c){if(Z("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(r," SDP during P2PConnection.").concat(c,`
`),t),r==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(t){if(In().supportPCSetConfiguration){const r=a_.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},_t(Sn.prototype,"updateRemoteRTPCapabilities",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"updateRemoteRTPCapabilities"),Sn.prototype),_t(Sn.prototype,"connect",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"connect"),Sn.prototype),_t(Sn.prototype,"updateRemoteConnect",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"updateRemoteConnect"),Sn.prototype),_t(Sn.prototype,"createDataChannels",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"createDataChannels"),Sn.prototype),_t(Sn.prototype,"receive",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"receive"),Sn.prototype),_t(Sn.prototype,"batchReceive",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"batchReceive"),Sn.prototype),_t(Sn.prototype,"stopReceiving",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"stopReceiving"),Sn.prototype),_t(Sn.prototype,"muteRemote",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"muteRemote"),Sn.prototype),_t(Sn.prototype,"unmuteRemote",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"unmuteRemote"),Sn.prototype),_t(Sn.prototype,"muteLocal",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"muteLocal"),Sn.prototype),_t(Sn.prototype,"unmuteLocal",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"unmuteLocal"),Sn.prototype),_t(Sn.prototype,"close",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"close"),Sn.prototype),_t(Sn.prototype,"updateEncoderConfig",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"updateEncoderConfig"),Sn.prototype),_t(Sn.prototype,"updateSendParameters",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"updateSendParameters"),Sn.prototype),_t(Sn.prototype,"replaceTrack",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"replaceTrack"),Sn.prototype),_t(Sn.prototype,"updateAdaptation",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"updateAdaptation"),Sn.prototype),_t(Sn.prototype,"getRemoteSSRC",[ka],Object.getOwnPropertyDescriptor(Sn.prototype,"getRemoteSSRC"),Sn.prototype),Sn);function ka(e,t,r){const o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(t));try{for(var f=arguments.length,g=new Array(f),E=0;E<f;E++)g[E]=arguments[E];return await o.apply(this,g)}finally{u()}},r}function x1(e,t){let r=document.createElement("video"),o=document.createElement("canvas");r.setAttribute("style","display:none"),o.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),o.width=Do(t.width),o.height=Do(t.height);const c=Do(t.framerate||15);document.body.append(r),document.body.append(o);let u=e._mediaStreamTrack;r.srcObject=new MediaStream([u]),r.play();const f=o.getContext("2d");if(!f)throw new Te(q.UNEXPECTED_ERROR,"can not get canvas context");const g=In(),E=o.captureStream(g.supportRequestFrame?0:c).getVideoTracks()[0];E.canvas||(E.canvas=o),o.startCapture=()=>{if(!r)return o.stopCapture&&o.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const S=r.videoWidth,R=r.videoHeight/S,I=o.width*R;Math.abs(I-o.height)>=2&&(x.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(I)),o.height=I)}f.drawImage(r,0,0,o.width,o.height),E.requestFrame&&E.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,r.srcObject=new MediaStream([u]))},o.stopCapture=Hk(()=>o.startCapture&&o.startCapture(),c);const v=E.stop;return E.stop=()=>{v.call(E),r&&(r.remove(),r.srcObject=null,r=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),x.debug("clean low stream renderer")},E}var bl=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e[e.Video_Send_Type=2225]="Video_Send_Type",e}(bl||{}),Ut=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(Ut||{}),os=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(os||{}),La=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(La||{}),mI=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(mI||{});const zg=1e3,gI=6,Xb=3,Wre=Math.max(gI,Xb);function At(e,t,r){r!=null&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function x6(e){const t={[La.CONN_TYPE]:0,[La.RTT]:e.rtt,[La.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r=e.selectedCandidatePair.localCandidate.relayProtocol;r==="udp"&&(t[La.CONN_TYPE]=1),r==="tcp"&&(t[La.CONN_TYPE]=3),r==="tls"&&(t[La.CONN_TYPE]=4);break}case"srflx":t[La.CONN_TYPE]=2;break;case"unknown":t[La.CONN_TYPE]=5;break;default:t[La.CONN_TYPE]=0}return t}function P6(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class k6 extends Dr{constructor(t){super(),H(this,"store",void 0),H(this,"uploadWRTCStatsTimer",void 0),H(this,"uploadOutboundDenoiserStatsTimer",void 0),H(this,"uploadExtStatsTimer",void 0),H(this,"uploadExtUsageStatsTimer",void 0),H(this,"uploadInboundExtStatsTimer",void 0),H(this,"requestStats",void 0),H(this,"requestTransportStats",void 0),H(this,"requestLocalMedia",void 0),H(this,"requestRemoteMedia",void 0),H(this,"requestAllTracks",void 0),H(this,"requestVideoIsReady",void 0),H(this,"requestUploadStats",void 0),H(this,"requestUpload",void 0),H(this,"uploadOutboundStarted",!1),H(this,"uploadInboundStarted",!1),H(this,"uploadTransportStarted",!1),H(this,"uploadBaseStatsStarted",!1),H(this,"uploadExtensionUsageStarted",!1),H(this,"lastRecvStats",void 0),H(this,"lastSendStats",void 0),H(this,"lastRefRecvStats",void 0),H(this,"lastRefSendStats",void 0),H(this,"lastNormalRecvStats",void 0),H(this,"lastNormalSendStats",void 0),H(this,"needUploadRenderFreezeTime",!0),H(this,"lastUploadCompensateTime",-1),H(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const r=t%Xb==0,o=t%gI==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var f;const g={};if(this.uploadTransportStarted&&c){const v=this.getTransportStats(c,u,r);v&&(g.misc=[v])}if(this.uploadOutboundStarted&&c){const v=this.getOutboundStats(c,o?this.lastNormalSendStats:void 0,r?this.lastRefSendStats:void 0,this.lastSendStats);v&&(g.outbound=[v])}if(this.uploadInboundStarted&&u){this.uploadCompensateStats(t);const v=this.getInboundStats(u,o?this.lastNormalRecvStats:void 0,r?this.lastRefRecvStats:void 0,this.lastRecvStats);v&&(g.inbound=v)}const E=(f=this.requestTransportStats)===null||f===void 0?void 0:f.call(this).connectState;E&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[mI.RTC_PEER_CONNECTION_STATE]=Ak[E]):g.misc=[{addition:{[mI.RTC_PEER_CONNECTION_STATE]:Ak[E]}}]),this.requestUploadStats(g)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastNormalRecvStats=u,this.lastNormalSendStats=c),r&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var r,o;const c=(r=this.requestTransportStats)===null||r===void 0?void 0:r.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[mI.RTC_PEER_CONNECTION_STATE]:Ak[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===Wre+1&&(t=1)},zg)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const r=t%Xb==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!r)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const o=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=o,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;const u=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const f={};if(this.uploadInboundStarted&&u){const g=this.requestRemoteMedia()||[],E=[];g.forEach(v=>{let[S,R]=v;const I={peer:S.uid};if(S._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(S._videoSSRC)&&R.has(lt.VIDEO)&&S.videoTrack){const D=function(V,M,j){if(!M.videoRecv.find(z=>z.ssrc===V))return;const G={};if(j&&j._player){const z=j._player,{renderFreezeAccTime2:ce,videoElementStatus:Ee}=z;if(pu.visibility==="visible"&&Ee===Js.PLAYING&&In().supportRequestVideoFrameCallback){const _e=Math.min(6e3,ce);z.renderFreezeAccTime2=Math.max(0,ce-_e),At(G,bl.Video_Render_Freeze_Time_Render2,_e),Z("USE_NEW_RENDER_FREEZE_TIME")&&At(G,bl.Video_Render_Freeze_Time_Render,_e)}}return G}(S._videoSSRC,u,S.videoTrack);D&&(I.video=D)}I.video&&E.push(I)}),E.length>0&&(f.inbound=E,this.requestUploadStats(f))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,r,o){if(!this.requestStats)return;if(!o)return t.rtt==null?void 0:{addition:{[La.RTT]:t.rtt,[La.CONN_TYPE]:void 0,[La.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const c=x6(t);if(this.store.useP2P){if(r){const u=x6(r);c[La.CONN_TYPE]+=u[La.CONN_TYPE]<<3}c[La.CONN_TYPE]+=110}else c[La.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(t,r,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let f,g,E;return u.forEach(v=>{let[S,{track:R,ssrcs:I}]=v;switch(S){case Ve.LocalVideoLowTrack:case Ve.LocalVideoTrack:if(S===Ve.LocalVideoTrack){const D=function(j,G,z,ce,Ee,_e){const me=G.videoSend.find(Zt=>Zt.ssrc===j);if(!me)return;const Ce={},{sentFrame:xe,inputFrame:$e}=me;if(ce&&(At(Ce,bl.Video_Send_Qp_Sum,me.qpSumPerFrame),$e&&xe)){var at;const Zt=$e.frameRate,qt=xe.frameRate;Ce[bl.Video_Send_Freeze]=function(Pt,hr){let er=!0;return er=!(Pt<=5)&&(Pt<=10?hr<3:Pt<=20?hr<4:hr<5),er}(Zt,qt)?1:0,Ce[bl.Video_Send_Type]=z.__className__==="CameraVideoTrack"?0:et(at=z._hints).call(at,Zn.SCREEN_TRACK)?1:2}if(Ee){switch(xe&&(At(Ce,Ut.Video_Send_Height,xe.height),At(Ce,Ut.Video_Send_Width,xe.width),At(Ce,Ut.Video_Send_Frame_Rate,xe.frameRate)),Ce[Ut.Video_Send_Disabled]=z._originMediaStreamTrack&&!z._originMediaStreamTrack.enabled||z._mediaStreamTrack&&!z._mediaStreamTrack.enabled?1:0,me.adaptionChangeReason){case"none":Ce[Ut.Video_Send_Adaptation]=0;break;case"cpu":Ce[Ut.Video_Send_Adaptation]=1;break;case"bandwidth":Ce[Ut.Video_Send_Adaptation]=2;break;case"other":Ce[Ut.Video_Send_Adaptation]=3}let Zt=0;me.adaptionChangeReason&&(Zt+=P6(me.adaptionChangeReason)),G.qualityLimitationReason&&(Zt+=P6(G.qualityLimitationReason)<<3),Ce[Ut.Video_Send_Adaptation]=Zt,Ce[Ut.Video_Send_Player_Status]=Fk[z._player?z._player.videoElementStatus:"uninit"],At(Ce,Ut.Video_Send_Nacks,me.nacksCount),At(Ce,Ut.Video_Send_Plis,me.plisCount),At(Ce,Ut.Video_Send_Firs,me.firsCount),At(Ce,Ut.Video_Send_Avg_Encode,me.avgEncodeMs),At(Ce,Ut.Video_Send_Huge_Frame_Sent,me.hugeFramesSent),At(Ce,Ut.Video_Send_Bytes_Retransmit,me.retransmittedBytesSent),At(Ce,Ut.Video_Send_Packages_Retransmit,me.retransmittedPacketsSent),At(Ce,Ut.Video_Send_Key_Frames_Encoded,me.keyFramesEncoded);const qt=Ee.videoSend.find(Pt=>Pt.ssrc===j);if(qt){let Pt=zg*Xb;qt.timestamp&&me.timestamp&&(Pt=me.timestamp-qt.timestamp),qt.packets!=null&&me.packets!=null&&At(Ce,Ut.Video_Send_Package_Rate,1e3*(me.packets-qt.packets)/Pt),me.packetsLost!=null&&qt.packetsLost!=null&&At(Ce,Ut.Video_Send_Package_Lost,me.packetsLost-qt.packetsLost),qt.bytes!=null&&me.bytes!=null&&At(Ce,Ut.Video_Send_Bitrate,8*(me.bytes-qt.bytes)/Pt)}}return Ce}(I[0].ssrcId,t,R,r,o),V=R&&function(j,G,z,ce){const Ee=G.videoSend.find(me=>me.ssrc===j);if(!Ee)return null;const _e={};if(ce){const me=Ee.inputFrame,Ce=me&&me.height||z.videoHeight||0,xe=me&&me.width||z.videoWidth||0,$e=me&&me.frameRate||0;At(_e,Ut.Video_Capture_Height,Ce),At(_e,Ut.Video_Capture_Width,xe),At(_e,Ut.Video_Capture_Frame_Rate,$e)}return _e}(I[0].ssrcId,t,R,!!o),M=function(j,G){const z={};return G&&(At(z,Ut.Video_Send_Retransmit,j.bitrate.retransmit),At(z,Ut.Video_Send_Target_Encoded,j.bitrate.targetEncoded),At(z,Ut.Video_Send_Actual_Encoded,j.bitrate.actualEncoded),At(z,Ut.Video_Send_Transmit,j.bitrate.transmit),At(z,Ut.Video_Send_Bandwidth,j.sendBandwidth)),z}(t,!!o);g=Object.assign({},D,V,M)}else E=function(D,V,M,j,G){const z=V.videoSend.find(Ee=>Ee.ssrc===D);if(!z)return;const ce={};if(j){const Ee=z.sentFrame;Ee&&(At(ce,Ut.Video_Send_Low_Height,Ee.height),At(ce,Ut.Video_Send_Low_Width,Ee.width),At(ce,Ut.Video_Send_Low_Frame_Rate,Ee.frameRate));const _e=j.videoSend.find(me=>me.ssrc===D);if(_e){let me=zg*gI;_e.timestamp&&z.timestamp&&(me=z.timestamp-_e.timestamp),_e.packets!=null&&z.packets!=null&&At(ce,Ut.Video_Send_Low_Package_Rate,1e3*(z.packets-_e.packets)/me),z.packetsLost!=null&&_e.packetsLost!=null&&At(ce,Ut.Video_Send_Low_Package_Lost,z.packetsLost-_e.packetsLost),_e.bytes!=null&&z.bytes!=null&&At(ce,Ut.Video_Send_Low_Bitrate,8*(z.bytes-_e.bytes)/me)}}return ce}(I[0].ssrcId,t,0,o);break;case Ve.LocalAudioTrack:f=R&&function(D,V,M,j,G,z){const ce=V.audioSend.find(_e=>_e.ssrc===D);if(!ce)return;const Ee={};if(G){Ee[Ut.Audio_Send_Disabled]=M._originMediaStreamTrack&&!M._originMediaStreamTrack.enabled||M._mediaStreamTrack&&!M._mediaStreamTrack.enabled?1:0;const _e=100*M._source.getAccurateVolumeLevel(),me=ce.inputLevel;if(me!=null){const xe=Math.ceil(50*Math.log10(100*me+1));At(Ee,Ut.Audio_Send_Level,xe)}At(Ee,Ut.Audio_Capture_PCM_Level,_e),At(Ee,Ut.Audio_Send_AEC_Return_Loss,ce.aecReturnLoss),At(Ee,Ut.Audio_Send_AEC_Return_Loss_Enhancement,ce.aecReturnLossEnhancement),At(Ee,Ut.Audio_Send_Bytes_Retransmit,ce.retransmittedBytesSent),At(Ee,Ut.Audio_Send_Packages_Retransmit,ce.retransmittedPacketsSent),Ee[Ut.Audio_Send_Freeze]=0;const Ce=G.audioSend.find(xe=>xe.ssrc===D);if(Ce){let xe=zg*gI;Ce.timestamp&&ce.timestamp&&(xe=ce.timestamp-Ce.timestamp),Ce.bytes!=null&&ce.bytes!=null&&At(Ee,Ut.Audio_Send_Bitrate,8*(ce.bytes-Ce.bytes)/xe),Ce.packets!=null&&ce.packets!=null&&At(Ee,Ut.Audio_Send_Package_Rate,1e3*(ce.packets-Ce.packets)/xe)}}return Ee}(I[0].ssrcId,t,R,0,o)}}),{high:g,low:E,audio:f}}getInboundStats(t,r,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],f=[];return u.forEach(g=>{let[E,v]=g;const S={peer:E.uid};if(v.has(lt.VIDEO)&&E.videoTrack){const R=E._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(E._videoSSRC)||!1,I=E.videoTrack?function(D,V,M,j,G,z,ce,Ee){const _e=V.videoRecv.find(Pt=>Pt.ssrc===D);if(!_e)return;const me={},{receivedFrame:Ce,outputFrame:xe,decodeFrameRate:$e}=_e;At(me,os.Video_Render_Frame_Rate_Decode,$e),_e.framesRateFirefox&&At(me,os.Video_Recv_Frame_Rate,_e.framesRateFirefox),Ce&&At(me,os.Video_Recv_Frame_Rate,Ce.frameRate),At(me,os.Video_Recv_Frame_Dropped,_e.framesDroppedCount),At(me,os.Video_Recv_Bytes_Retransmit,_e.retransmittedBytesReceived),At(me,os.Video_Recv_Packages_Retransmit,_e.retransmittedPacketsReceived),At(me,os.Video_Recv_Packages_Discarded,_e.packetsDiscarded),At(me,os.Video_Recv_Avg_Decode,_e.avgDecodeMs),At(me,os.Video_Recv_Avg_Processing_Delay,_e.avgProcessingDelayMs),At(me,os.Video_Recv_Avg_Assembly_Time,_e.avgFramesAssembledFromMultiplePacketsMs),At(me,os.Video_Recv_Avg_Inter_Frame_Delay,_e.avgInterFrameDelayMs),At(me,os.Video_Recv_Key_Frames_Decoded,_e.keyFramesDecoded);const at=Ee&&Ee.videoRecv.find(Pt=>Pt.ssrc===D);if(at){const Pt=V.timestamp-Ee.timestamp||zg;_e.packetsLost!=null&&at.packetsLost!=null&&At(me,os.Video_Recv_Package_Lost,_e.packetsLost-at.packetsLost),at.bytes!=null&&_e.bytes!=null&&At(me,os.Video_Recv_Bitrate,8*(_e.bytes-at.bytes)/Pt),at.packets!=null&&_e.packets!=null&&At(me,os.Video_Recv_Package_Rate,1e3*(_e.packets-at.packets)/Pt)}const Zt=z&&z.videoRecv.find(Pt=>Pt.ssrc===D);if(Zt&&(At(me,bl.Video_Recv_Qp_Sum,_e.qpSumPerFrame),me[bl.Video_Recv_Freeze]=j&&qb.isRemoteVideoFreeze(M,_e,Zt)?1:0),ce){var qt;const Pt=ce.videoRecv.find(er=>er.ssrc===D);Ce?(At(me,Ut.Video_Recv_Height,Ce.height),At(me,Ut.Video_Recv_Width,Ce.width)):M&&(At(me,Ut.Video_Recv_Height,M._videoHeight||0),At(me,Ut.Video_Recv_Width,M._videoWidth||0)),xe&&At(me,Ut.Video_Recv_Frame_Rate_Output,xe.frameRate);const hr=(qt=M._player)===null||qt===void 0?void 0:qt.rendFrameRate.toFixed(0);if(hr&&At(me,Ut.Video_Render_Frame_Rate_Render,+hr),At(me,Ut.Video_Recv_Jitter_Buffer,_e.jitterBufferMs),At(me,Ut.Video_Recv_Current_Delay,_e.currentDelayMs),At(me,Ut.Video_Recv_Firs,_e.firsCount),At(me,Ut.Video_Recv_Nacks,_e.nacksCount),At(me,Ut.Video_Recv_Plis,_e.plisCount),M){me[Ut.Video_Recv_Disabled]=M._originMediaStreamTrack.enabled&&M._mediaStreamTrack.enabled?0:1;const er=M._player;if(er){const{freezeTimeCounterList:ja,renderFreezeAccTime:Pe,renderFreezeAccTime2:Ye,videoElementStatus:pt}=er;if(ja&&ja.length>0&&At(me,bl.Video_Render_Freeze_Time,ja.splice(0,1)[0]),G&&pu.visibility==="visible"&&pt===Js.PLAYING&&In().supportRequestVideoFrameCallback){const ke=Math.min(6e3,Ye);er.renderFreezeAccTime2=Math.max(0,Ye-ke),At(me,bl.Video_Render_Freeze_Time_Render2,ke);const L=Math.min(6e3,Pe);er.renderFreezeAccTime=Math.max(0,Pe-L),At(me,bl.Video_Render_Freeze_Time_Render,Z("USE_NEW_RENDER_FREEZE_TIME")?ke:L)}if(typeof _e.totalFreezesDuration=="number"){const ke=Pt&&Pt.totalFreezesDuration?_e.totalFreezesDuration-Pt.totalFreezesDuration:_e.totalFreezesDuration;At(me,Ut.Video_Render_Freeze_Duration,1e3*ke)}}}if(me[Ut.Video_Recv_Player_Status]=Fk[M._player?M._player.videoElementStatus:"uninit"],Pt&&_e.totalInterFrameDelay!==void 0&&_e.totalSquaredInterFrameDelay!==void 0&&Pt.totalInterFrameDelay!==void 0&&Pt.totalSquaredInterFrameDelay!==void 0){const er=_e.totalInterFrameDelay-Pt.totalInterFrameDelay,ja=_e.totalSquaredInterFrameDelay-Pt.totalSquaredInterFrameDelay,Pe=_e.framesDecodeCount-Pt.framesDecodeCount,Ye=er/Pe*1e3,pt=Math.round(1e3*Math.sqrt((ja-Math.pow(er,2)/Pe)/Pe));!isNaN(pt)&&Ye+pt>Math.max(3*Ye,Ye+150)&&(me[Ut.Video_Recv_I_Frame_Delay]=pt)}}return me}(E._videoSSRC,t,E.videoTrack,R===!0,this.needUploadRenderFreezeTime,r,o,c):void 0;I&&(S.video=I)}if(v.has(lt.AUDIO)&&E.audioTrack){const R=E.audioTrack?function(I,D,V,M,j,G){const z=D.audioRecv.find(me=>me.ssrc===I);if(!z)return;const ce={};At(ce,os.Audio_Recv_Jitter,z.jitterMs),At(ce,os.Audio_Recv_Bytes_Retransmit,z.retransmittedBytesReceived),At(ce,os.Audio_Recv_Packages_Retransmit,z.retransmittedPacketsReceived),At(ce,os.Audio_Recv_Packages_Discarded,z.packetsDiscarded),At(ce,os.Audio_Recv_Avg_Processing_Delay,z.avgProcessingDelayMs);const Ee=G&&G.audioRecv.find(me=>me.ssrc===I);if(Ee){const me=zg;z.packets!=null&&Ee.packets!=null&&At(ce,os.Audio_Recv_Package_Rate,1e3*(z.packets-Ee.packets)/me),z.packetsLost!=null&&Ee.packetsLost!=null&&At(ce,os.Audio_Recv_Package_Lost,z.packetsLost-Ee.packetsLost)}if(M){const{receivedFrames:me,droppedFrames:Ce}=z;me!=null&&Ce!=null&&(ce[bl.Audio_Recv_Freeze]=(_e=me)===0||100*Ce/_e>20?1:0)}var _e;if(j){const me=100*V._source.getAccurateVolumeLevel(),Ce=z.outputLevel;if(Ce!=null){const $e=Math.ceil(50*Math.log10(100*Ce+1));At(ce,Ut.Audio_Render_Level,$e)}At(ce,Ut.Audio_Recv_PCM_Level,me),V&&(ce[Ut.Audio_Recv_Disabled]=V._originMediaStreamTrack.enabled&&V._mediaStreamTrack.enabled?0:1),At(ce,Ut.Audio_Recv_Jitter_Buffer,z.jitterBufferMs),At(ce,Ut.Audio_Recv_Current_Delay,z.jitterBufferMs),ce[Ut.Audio_Recv_Player_Status]=Fk[Pa.getPlayerState(V.getTrackId())];const xe=j.audioRecv.find($e=>$e.ssrc===I);if(xe){xe.bytes!=null&&z.bytes!=null&&At(ce,Ut.Audio_Recv_Bitrate,8*(z.bytes-xe.bytes)/(zg*Xb));const $e=z.concealedSamples-xe.concealedSamples;$e>0&&At(ce,Ut.Audio_Recv_Concealed_Samples,$e);const at=z.totalSamplesReceived-xe.totalSamplesReceived;at>0&&At(ce,Ut.Audio_Recv_Total_Samples_Received,at);const Zt=z.freezeSamples80-xe.freezeSamples80;Zt>0&&At(ce,Ut.Audio_Render_Freeze_Samples_80ms,Zt);const qt=z.freezeSamples200-xe.freezeSamples200;qt>0&&At(ce,Ut.Audio_Render_Freeze_Samples_200ms,qt);const Pt=z.freezeMs80-xe.freezeMs80;At(ce,Ut.Audio_Render_Freeze_Time_80ms,Pt<0?0:Pt);const hr=z.freezeMs200-xe.freezeMs200;At(ce,Ut.Audio_Render_Freeze_Time_200ms,hr<0?0:hr)}}return ce}(E._audioSSRC,t,E.audioTrack,r,o,c):void 0;R&&(S.audio=R)}(S.video||S.audio)&&f.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,f}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(r=>r instanceof Lb);if(t&&t._external.getDenoiserStats){const r=t._external.getDenoiserStats();r&&this.requestUpload(jb.DENOISER_STATS,r)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[r,o]=t;o.has(lt.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(lt.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const r=Date.now(),o={connectionInterval:Z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of u)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const f=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,S]of f)S.has(lt.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),S.has(lt.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(v,S){const R={};for(const{id:M,value:j,level:G,direction:z}of v){var I;const ce=(I=S.get(M))!==null&&I!==void 0?I:0,Ee=j===2?ce+Z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ce;var D,V;S.set(M,Ee),R[M]?(j===2&&(R[M].value=j),G>R[M].level&&(R[M].level=G),z==="remote"&&(R[M].remoteUidCount+=1),R[M].totalTs=(D=S.get(M))!==null&&D!==void 0?D:0):R[M]={value:j,level:G,remoteUidCount:z==="local"?0:1,totalTs:(V=S.get(M))!==null&&V!==void 0?V:0}}return Object.keys(R).map(M=>{const{level:j,value:G,totalTs:z}=R[M];return{id:M,level:j,value:G,totalTs:z}})}(c,t);const g=Date.now(),E=g>r?g:r+1;this.requestUpload&&this.requestUpload(jb.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:E})},Z("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const zre=Z("ICE_RESTART_INTERVAL");let _I=new Map,ov=new Map,If=[Ls.UDP_TCP_RELAY,Ls.TCP_RELAY,Ls.RELAY],P1=Z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&In().supportPCSetConfiguration;function L6(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=_I.get(e.id);r&&(window.clearTimeout(r),_I.delete(e.id));const o=ov.get(e.id);t&&o&&o.index===If.length-1&&(x.debug("[".concat(e.id,"] reset ICE restart policy")),ov.delete(e.id))}function M6(e,t,r){if(_I.size===0&&ov.size===0&&(Array.isArray(Z("RESTART_SEQUENCE"))&&Z("RESTART_SEQUENCE").length>0&&!function(g,E){if(g.length!==E.length)return!1;for(let v=0;v<g.length;v+=1){const S=g[v];if(g.filter(R=>R===S).length!==E.filter(R=>R===S).length)return!1}return!0}(If,Z("RESTART_SEQUENCE"))&&(If=Z("RESTART_SEQUENCE").filter(g=>{var E;if(et(E=Object.values(Ls)).call(E,g))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(If.join(" => ")))),P1=Z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&In().supportPCSetConfiguration),If.length===0)return void r();let o,{index:c=0,type:u}=ov.get(e.id)||{};if(P1&&u===Ls.RELAY)return void r();let f=u&&c>=If.length-1;if(P1)u=Ls.RELAY;else{if(f)return void r();u?(c++,u=If[c]):(u=If[0],c=0)}x.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),t(u),ov.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>M6(e,t,r),zre),_I.set(e.id,o)}var cn;function j6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Eu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?j6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function U6(e){var t,r,o,c=2;for(typeof Symbol<"u"&&(r=tk,o=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(o&&(t=e[o])!=null)return new EI(t.call(e));r="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function EI(e){function t(r){if(Object(r)!==r)return nt.reject(new TypeError(r+" is not an object."));var o=r.done;return nt.resolve(r.value).then(function(c){return{value:c,done:o}})}return EI=function(r){this.s=r,this.n=r.next},EI.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var o=this.s.return;return o===void 0?nt.resolve({value:r,done:!0}):t(o.apply(this.s,arguments))},throw:function(r){var o=this.s.return;return o===void 0?nt.reject(r):t(o.apply(this.s,arguments))}},new EI(e)}let Qb=(cn=class extends Dr{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Rt.StateChange,t,this._state)}constructor(e,t){super(),H(this,"isPlanB",void 0),H(this,"store",void 0),H(this,"statsUploader",void 0),H(this,"connection",void 0),H(this,"localTrackMap",new Map),H(this,"remoteUserMap",new Map),H(this,"localDataChannels",[]),H(this,"remoteDataChannelMap",new Map),H(this,"pendingLocalTracks",[]),H(this,"pendingRemoteTracks",[]),H(this,"pendingLocalDataChannels",[]),H(this,"pendingRemoteDataChannels",[]),H(this,"statsCollector",void 0),H(this,"shouldForwardP2PCreation",void 0),H(this,"iceFailedCount",0),H(this,"dtlsFailedCount",0),H(this,"mutex",void 0),H(this,"_state",Bn.Disconnected),H(this,"_pcStatsUploadType",Z("NEW_ICE_RESTART")?Gh.FIRST_CONNECTION:Gh.OLD_FIRST_CONNECTION),H(this,"_isStartRestartIce",!1),H(this,"_restartTimer",void 0),H(this,"_isTryConnecting",!1),H(this,"_iceError",null),H(this,"_forceTurn",!1),H(this,"_isWaitPcToRePub",!1),H(this,"handleMuteLocalTrack",async(r,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Bn.Connected)return void c(new Ae(q.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const f=this.filterTobeMutedTracks(r);if(f.length===0)return void o();const g=f.find(v=>v[0]==="videoLowTrack");g&&g[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(f.map(v=>{let[,{id:S}]=v;return S}));const E=this.createMuteMessage(f);await ir(this,Rt.RequestMuteLocal,E),o()}catch(f){c(f)}finally{u()}}),H(this,"handleUnmuteLocalTrack",async(r,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Bn.Connected)return void c(new Ae(q.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const f=this.filterTobeUnmutedTracks(r);if(f.length===0)return void o();const g=f.find(v=>v[0]==="videoLowTrack");if(g){const v=g[1];if(v.track._originMediaStreamTrack.stop(),!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&In().supportDualStreamEncoding){const S=r._mediaStreamTrack.clone();v.track._mediaStreamTrack=S,v.track._originMediaStreamTrack=S}else{const S=x1(r,Nb(this,Rt.RequestLowStreamParameter));v.track._mediaStreamTrack=S,v.track._originMediaStreamTrack=S}await new nt((S,R)=>{this.handleReplaceTrack(v.track,S,R,!0)})}await this.connection.unmuteLocal(f.map(v=>{let[,{id:S}]=v;return S}));const E=this.createUnmuteMessage(f);await ir(this,Rt.RequestUnmuteLocal,E),o()}catch(f){c(f)}finally{u()}}),H(this,"handleUpdateVideoEncoder",async(r,o,c,u)=>{let f;u||(f=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const E=this.localTrackMap.get(Ve.LocalVideoTrack);if(!this.connection||!E||E.track!==r||this.state!==Bn.Connected)return void o();const{id:v,track:S}=E;await this.connection.updateSendParameters(v,S),await this.connection.updateEncoderConfig(v,S),this.emit(Rt.UpdateVideoEncoder,S),o()}catch(E){c(E)}finally{var g;(g=f)===null||g===void 0||g()}}),H(this,"handleUpdateVideoSendParameters",async(r,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const f=this.localTrackMap.get(Ve.LocalVideoTrack);if(!this.connection||!f||f.track!==r||this.state!==Bn.Connected)return void o();const{id:g,track:E}=f;await this.connection.updateSendParameters(g,E),o()}catch(f){c(f)}finally{u()}}),H(this,"handleReplaceMixingTrack",async(r,o,c,u)=>{if(!this.connection||this.state!==Bn.Connected)return void o();const f=O1([r]);let g;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(f.getTrackId(),"]")),typeof u=="boolean"&&u||(g=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r,f),o()}catch(v){c(v)}finally{var E;(E=g)===null||E===void 0||E()}}),H(this,"handleReplaceTrack",async(r,o,c,u)=>{let f;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof u=="boolean"&&u||(f=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var g;const v=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return r===R});if(!this.connection||!v||this.state!==Bn.Connected)return void o();if(await((g=this.connection)===null||g===void 0?void 0:g.replaceTrack(r,v[1].id)),this.isPlanB){const S=v[1];S.id=r._mediaStreamTrack.id,this.localTrackMap.set(v[0],S)}if(v[0]===Ve.LocalVideoTrack&&!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&In().supportDualStreamEncoding){const S=this.localTrackMap.get(Ve.LocalVideoLowTrack);if(S){const R=r._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new nt((I,D)=>{this.handleReplaceTrack(S.track,I,D,!0)})}}o()}catch(v){c(v)}finally{var E;(E=f)===null||E===void 0||E()}}),H(this,"handleGetRTCStats",r=>{r(this.statsCollector.getRTCStats())}),H(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),H(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),H(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),H(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new k6(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ps("P2PChannel-mutex",this.store.clientId),this.isPlanB=!In().supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&jh(),this.shouldForwardP2PCreation=Z("FORWARD_P2P_CREATION")&&In().supportPCSetConfiguration&&pk(),this.shouldForwardP2PCreation&&(this.connection=fI(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=Bn.New,this._forceTurn=O6(e),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=fI(this.store,e),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Ae(q.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=Z("NEW_ICE_RESTART")?Gh.FIRST_CONNECTION:Gh.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Ae(q.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");Z("ENABLE_PREALLOC_PC")&&this.state===Bn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Bn.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[f]=c;return et(u=[Ve.LocalVideoLowTrack,Ve.LocalVideoTrack]).call(u,f)}),r=t.map(c=>{let[,{id:u}]=c;return u}),o=t.map(c=>{let[u]=c;return u});if(this.connection instanceof _u){if(vt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!et(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>et(e).call(e,u));c&&(this.store.codec=c,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async getEstablishParams(){var e;if(this.connection instanceof _u&&this.connection.peerConnectionState!=="closed"&&et(e=[Bn.New,Bn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Bn.Connected){if(this.state===Bn.Disconnected)throw new Ae(q.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(r=>{var o;et(o=this.pendingLocalDataChannels).call(o,r)||this.pendingLocalDataChannels.push(r)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(r=>{const o=Date.now();this.store.publish(r.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(r=>{this.localDataChannels.push(r);const o=Date.now();this.store.publish(r.id+"","datachannel",void 0,o)}),e.map(r=>({streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId})))}publish(e,t,r){var o=this;return Cc(function*(){const c=yield Cn(o.mutex.lock("From P2PChannel.publish"));try{var u;const f=o.connection&&et(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==Bn.Connected||f){if(o.state===Bn.Disconnected)throw new Ae(q.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const E=e.filter(v=>o.pendingLocalTracks.indexOf(v)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(E),void(f&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Ms.markPublishStart(o.store.clientId,o.store.pubId);const g=o.filterTobePublishedTracks(e,t,r);if(g.length===0)return void(yield Cn(o.tryToUnmuteAudio(e)));yield*fA(U6(o.doPublish(o.connection,g)))}finally{c()}})()}doPublish(e,t){var r=this;return Cc(function*(){t.forEach(I=>{let{track:D,type:V}=I;const M=Date.now();r.store.publish(D.getTrackId(),V===Ve.LocalAudioTrack?"audio":"video",M)}),r.bindLocalTrackEvents(t);const o=t.map(I=>{let{track:D}=I;return D}),c=yield Cn(e.send(o,r.store.codec,r.store.audioCodec)),u=(yield Cn(c.next())).value,f=r.createGatewayPublishMessage(t,u);let g;try{g=yield f}catch(I){throw c.throw(I),(I==null?void 0:I.code)===q.WS_ABORT&&t.forEach(D=>{let{track:V}=D;r.pendingLocalTracks.indexOf(V)===-1&&r.pendingLocalTracks.push(V)}),r.unbindLocalTrackEvents(t),I}const E=r.mapPubResToRemoteConfig(f,g,o),v=(yield Cn(c.next(E))).value;if(r.state===Bn.Disconnected)throw new Ae(q.UNEXPECTED_ERROR,"PeerConnection already disconnected.");Z("ENABLE_VIDEO_SEI");const S=Z("ENABLE_ENCODED_TRANSFORM"),R=Z("ENABLE_AUDIO_METADATA");o.forEach(async I=>{const D=I.getRTCRtpTransceiver();if(!D||!S)return;const{interceptLocalVideoFrame:V,interceptLocalAudioFrame:M}=oI();I.trackMediaType===lt.VIDEO?await V(D.sender,I):I.trackMediaType===lt.AUDIO&&await M(D.sender,{metadata:R?()=>{const j=I.metadata.shift();return j&&j.value}:void 0})}),t.forEach(I=>{let{type:D}=I;r.statsCollector.addLocalStats(D)}),r.assignLocalTracks(t,v),r.statsUploader.startUploadOutboundStats(),t.forEach(I=>{let{track:D,type:V}=I;const M=Date.now();r.store.publish(D.getTrackId(),V===Ve.LocalAudioTrack?"audio":"video",void 0,M)})})()}async updateVideoStreamParameter(e,t){const r=this.localTrackMap.get(t);if(!r||!this.connection)return;if(!(r.track instanceof gr))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=r,c=function(u,f){const g={};return u.height&&u.width&&(g.scaleResolutionDownBy=f1(u,f)),g.maxFramerate=u.framerate?Do(u.framerate):void 0,g.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,g}(e,o);if(o._encoderConfig||(o._encoderConfig={}),t!==Ve.LocalVideoLowTrack||!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&In().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return x.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(f,g){const E=f.canvas;g.width&&(E.width=Do(g.width)),g.height&&(E.height=Do(g.height)),g.framerate&&(E.stopCapture&&E.stopCapture(),E.stopCapture=Hk(()=>{!E.startCapture&&E.stopCapture&&E.stopCapture(),E.startCapture&&E.startCapture()},Do(g.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),x.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var t=this;return Cc(function*(){if(!t.connection||t.state!==Bn.Connected)return;const r=yield Cn(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=t.localTrackMap.get(Ve.LocalVideoTrack);if(!c)throw new Ae(q.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Ve.LocalVideoLowTrack))throw new Ae(q.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:t.getLowVideoTrack(c.track,e),type:Ve.LocalVideoLowTrack}];if(yield*fA(U6(t.doPublish(t.connection,u))),c.track.muted||!c.track.enabled){var o;const f=(o=t.localTrackMap.get(Ve.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;f!==void 0&&(yield Cn(t.connection.muteLocal([f])))}}finally{r()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await gs(this,Rt.RequestRePublish,this.pendingLocalTracks),this.emit(Rt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await gs(this,Rt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:r,kind:o}=this.pendingRemoteTracks[t];(o!==lt.AUDIO||r._audio_added_&&r._audioSSRC)&&(o!==lt.VIDEO||r._video_added_&&r._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await gs(this,Rt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:r}of this.pendingRemoteTracks)await this.subscribe(t,r,r===lt.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:r}=t;this.emit(Rt.MediaReconnectEnd,r.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Bn.Connected)return void e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const r=t.find(o=>o[0]==="videoLowTrack");return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Bn.Connected)return void e.forEach(r=>{const o=this.pendingLocalDataChannels.indexOf(r);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(r=>{const o=this.localDataChannels.indexOf(r);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(r=>r.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Bn.Connected)return;const e=this.localTrackMap.get(Ve.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[Ve.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),t.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Bn.Connected)throw new Ae(q.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const r=t.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(r.length!==0)return await this.connection.createDataChannels(e.uid,r),r.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(f=>{let{user:g,id:E}=f;return g.uid===e.uid&&E===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),r.map(o=>o.id)}async subscribe(e,t,r,o,c){var u;if(!this.connection||this.state!==Bn.Connected)throw new Ae(q.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(t))return;let f,g,E;const v=this.connection.getPreMedia(r);if(v)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),E=v.transceiver,f=v.track,g=v.id;else if(c){const I=c.find(V=>{let{stream_type:M}=V;return M===t});if(!I)throw new Ae(q.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const D=await this.connection.receive(t,I.ssrcs,String(e._uintid),I.attributes);this.connection instanceof _u&&(E=D.transceiver),f=D.track,g=D.id}else{const I=await this.connection.receive(t,[{ssrcId:r,rtx:o}],String(e._uintid),void 0);this.connection instanceof _u&&(E=I.transceiver),f=I.track,g=I.id}if(t===lt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(f):(e._audioTrack=new Ky(f,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),E&&e._audioTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(f):(e._videoTrack=new qy(f,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),E&&e._videoTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(e,e._videoTrack)),E&&Z("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:I,interceptRemoteAudioFrame:D}=oI();t==lt.VIDEO?await I(E.receiver,{onSei:Z("ENABLE_VIDEO_SEI")&&(V=>{var M;return(M=e._videoTrack)===null||M===void 0?void 0:M._onSei(V)})}):t==lt.AUDIO&&await D(E.receiver,{enableTopn:!!Z("ENABLE_AUDIO_TOPN"),enableMetadata:!!Z("ENABLE_AUDIO_METADATA"),onMetadata:V=>{this.safeEmit(Rt.AudioMetadata,V)}})}const S=this.remoteUserMap.get(e);S?S.set(t,g):this.remoteUserMap.set(e,new Map([[t,g]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(I=>{let{user:D,kind:V}=I;return D.uid===e.uid&&t===V});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(Rt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Bn.Connected)throw new Ae(q.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:f,mediaType:g}=c;return!((u=this.remoteUserMap.get(f))!==null&&u!==void 0&&u.has(g))});const t=[],r=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?r.set(c.ssrcId,u):t.push(c)});const o=await this.connection.batchReceive(t.map(c=>{let{user:u,mediaType:f,ssrcId:g,rtxSsrcId:E}=c;return{kind:f,ssrcMsg:[{ssrcId:g,rtx:E}],mslabel:String(u._uintid)}}));t.forEach((c,u)=>{r.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:f}of e){const g=r.get(f);if(!g)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(f));const{track:E,id:v,transceiver:S}=g;if(S&&Z("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:V}=oI();u==lt.VIDEO?await D(S.receiver,{onSei:Z("ENABLE_VIDEO_SEI")&&(M=>{var j;return(j=c._videoTrack)===null||j===void 0?void 0:j._onSei(M)})}):u==lt.AUDIO&&await V(S.receiver,{enableTopn:!!Z("ENABLE_AUDIO_TOPN"),enableMetadata:!!Z("ENABLE_AUDIO_METADATA"),onMetadata:M=>{this.safeEmit(Rt.AudioMetadata,M)}})}if(u===lt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(E):(c._audioTrack=new Ky(E,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(E):(c._videoTrack=new qy(E,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),Z("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:V}=oI();u==lt.VIDEO?await D(S.receiver,{onSei:M=>{var j;(j=c._videoTrack)===null||j===void 0||j._onSei(M)}}):u==lt.AUDIO&&await V(S.receiver)}const R=this.remoteUserMap.get(c);R?R.set(u,v):this.remoteUserMap.set(c,new Map([[u,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const I=this.pendingRemoteTracks.findIndex(D=>{let{user:V,kind:M}=D;return V.uid===c.uid&&u===M});I!==-1&&(this.pendingRemoteTracks.splice(I,1),this.emit(Rt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,t,r){const o=this.pendingRemoteTracks.filter(f=>{let{user:g,kind:E}=f;return t!==void 0?g.uid===e.uid&&t===E:g.uid===e.uid});if(o.forEach(f=>{const g=this.pendingRemoteTracks.indexOf(f);this.pendingRemoteTracks.splice(g,1)}),this.connection&&this.state===Bn.Connected||r||o.forEach(f=>{let{kind:g}=f;var E;if(g===lt.AUDIO)(E=e._audioTrack)===null||E===void 0||E._destroy(),e._audioTrack=void 0;else if(g===lt.VIDEO){var v;(v=e._videoTrack)===null||v===void 0||v._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Bn.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,t);if(c.length===0)return;await this.connection.stopReceiving(c.map(f=>{let[,{id:g}]=f;return g}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(f=>{let[g,{kind:E}]=f;var v,S;if(E===lt.VIDEO&&g._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(g._videoSSRC,!1)),E===lt.VIDEO)this.unbindRemoteTrackEvents(g._videoTrack),r||((S=g._videoTrack)===null||S===void 0||S._destroy(),g._videoTrack=void 0);else if(E===lt.AUDIO){var R;this.unbindRemoteTrackEvents(g._audioTrack),!r&&((R=g._audioTrack)===null||R===void 0||R._destroy(),g._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,t){if(t.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(f=>f.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const r=this.filterTobeUnSubscribedDataChannels(e,t);if(r.length===0)return;t.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(e);return r.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:c,mediaType:u}of e){const f=this.pendingRemoteTracks.filter(g=>{let{user:E,kind:v}=g;return u!==void 0?E.uid===c.uid&&u===v:E.uid===c.uid});f.forEach(g=>{const E=this.pendingRemoteTracks.indexOf(g);this.pendingRemoteTracks.splice(E,1)}),t=t.concat(f)}if(!this.connection||this.state!==Bn.Connected)return void t.forEach(c=>{let{user:u,kind:f}=c;var g;if(f===lt.AUDIO)(g=u._audioTrack)===null||g===void 0||g._destroy(),u._audioTrack=void 0;else if(f===lt.VIDEO){var E;(E=u._videoTrack)===null||E===void 0||E._destroy(),u._videoTrack=void 0}});const r=Xa(e).call(e,(c,u)=>{let{user:f,mediaType:g}=u;const E=this.filterTobeUnSubscribedTracks(f,g);return c.concat(E)},[]);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[u,{kind:f}]=c;var g,E;if(f===lt.VIDEO&&u._videoSSRC&&((g=this.connection)===null||g===void 0||g.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),f===lt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(E=u._videoTrack)===null||E===void 0||E._destroy(),u._videoTrack=void 0;else if(f===lt.AUDIO){var v;this.unbindRemoteTrackEvents(u._audioTrack),(v=u._audioTrack)===null||v===void 0||v._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==Bn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const r=this.remoteUserMap.get(e);if(!r)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const o=t===lt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const r=this.remoteUserMap.get(e);if(!r)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(Ve.LocalAudioTrack),r=t&&t.track;r&&r.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(Ve.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ni){const r=t.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ve.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Ve.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[o]=r;return!(e&&o===Ve.LocalVideoLowTrack)}).map(r=>{let[,{track:o}]=r;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,o,c){if(e){const f=this.localTrackMap.get(Ve.LocalAudioTrack),g=o?this.localTrackMap.get(Ve.LocalVideoLowTrack):this.localTrackMap.get(Ve.LocalVideoTrack);vt.publish(this.store.sessionId,{eventElapse:Ms.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:f==null?void 0:f.track.getTrackLabel(),videoName:g==null?void 0:g.track.getTrackLabel(),screenshare:(g==null?void 0:g.track._hints.indexOf(Zn.SCREEN_TRACK))!==-1,audio:!!f,video:!!g,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;r||(r=[]);const f=r.find(E=>E instanceof qr),g=o?(u=this.localTrackMap.get(Ve.LocalVideoTrack))===null||u===void 0?void 0:u.track:r.find(E=>E instanceof gr);vt.publish(this.store.sessionId,{eventElapse:Ms.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:f==null?void 0:f.getTrackLabel(),videoName:g==null?void 0:g.getTrackLabel(),screenshare:(g==null?void 0:g._hints.indexOf(Zn.SCREEN_TRACK))!==-1,audio:!!f,video:!!g,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,r,o){const c=o===lt.VIDEO?r._videoSSRC:r._audioSSRC;c&&vt.subscribe(this.store.sessionId,{succ:e,ec:t,video:o===lt.VIDEO,audio:o===lt.AUDIO,peerid:r.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Ms.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ps("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=fI(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ve.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ni){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Bn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ve.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ve.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof gr||t&&t.track instanceof qr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;const r=Array.from(Zo(t=this.remoteUserMap).call(t)).find(o=>o.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[o]=r;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Ve.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Ft(e).call(e,(r,o)=>r.level-o.level),e}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Bn.Reconnecting,Z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=fI(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:o}]=e;switch(r){case Ve.LocalVideoTrack:et(t=o._hints).call(t,Zn.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ve.LocalAudioTrack:o instanceof Ni?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ve.LocalVideoLowTrack:}}),this.emit(Rt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Zo(r).call(r)).forEach(o=>{this.setPendingRemoteMedia(t,o)}),this.emit(Rt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Zo(r).call(r)).forEach(o=>{this.setPendingRemoteDataChannel(t,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const r of this.pendingRemoteDataChannels){const{user:o,id:c}=r;if((e instanceof Af?e.uid:e)===o.uid&&c===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const r of this.pendingRemoteTracks){const{user:o,kind:c}=r;if((e instanceof Af?e.uid:e)===o.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Cc(function*(){if(!t.connection||t.state!==Bn.Connected)return;const r=yield Cn(t.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield Cn(t.connection.restartICE(e));const u=yield Cn(o.next());if(u.done)return;const f=u.value,g=yield f;switch(D1(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Ls.UDP_TCP_RELAY:t._pcStatsUploadType=Gh.UDP_TCP_RESTART;break;case Ls.TCP_RELAY:t._pcStatsUploadType=Gh.TCP_RESTART;break;case Ls.RELAY:t._pcStatsUploadType=Gh.RELAY_RESTART;break;default:t._pcStatsUploadType=Gh.OLD_RESTART}t._isTryConnecting=!0,o.next(g)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{r()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(Ve.LocalVideoTrack),r=this.localTrackMap.get(Ve.LocalAudioTrack),o=e.videoSend.find(D=>D.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),c=e.audioSend.find(D=>D.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=$o(this,Rt.NeedSignalRTT),f=o?o.rttMs:void 0,g=c?c.rttMs:void 0,E=f&&g?(f+g)/2:f||g,v=(E&&u?(E+u)/2:E||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*v/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,I=t==null?void 0:t.track;if(I&&I._encoderConfig&&I._hints.indexOf(Zn.SCREEN_TRACK)===-1){const D=I._encoderConfig.bitrateMax,V=e.bitrate.actualEncoded;if(D&&V){const M=(1e3*D-V)/(1e3*D);return T9[M<.15?0:M<.3?1:M<.45?2:M<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[o]=r;const c=o._audioSSRC,u=o._videoSSRC,f=e.audioRecv.find(V=>V.ssrc===c),g=e.videoRecv.find(V=>V.ssrc===u);if(!f&&!g)return void(t+=1);const E=$o(this,Rt.NeedSignalRTT),v=e.rtt,S=(v&&E?(v+E)/2:v||E)||0,R=f?f.jitterMs:void 0,I=e.recvPacketLossRate;let D=.7*I*100/50+.3*S/1500;R&&(D=.6*I*100/50+.2*S/1500+.2*R/400),t+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new nt((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}async replaceTrack(e,t){var r;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Bn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:f}]=u;return e===f});if(!o)return;const c=o[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:t,type:c}]),o[1].track=t),await((r=this.connection)===null||r===void 0?void 0:r.replaceTrack(t,o[1].id)),this.isPlanB){const u=o[1];u.id=t._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Ve.LocalVideoTrack&&!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&In().supportDualStreamEncoding){const u=this.localTrackMap.get(Ve.LocalVideoLowTrack);if(u){const f=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=f,u.track._originMediaStreamTrack=f,await new nt((g,E)=>{this.handleReplaceTrack(u.track,g,E,!0)})}}}filterTobePublishedTracks(e,t,r){const o=[],c=this.getAllTracks();e=ky(e=e.filter(E=>c.indexOf(E)===-1));let u,f=!1;const g=this.localTrackMap.get(Ve.LocalAudioTrack);for(const E of e){if(E instanceof gr&&(this.localTrackMap.has(Ve.LocalVideoTrack)||f?new Ae(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:E,type:Ve.LocalVideoTrack}),f=!0),t)){const v=this.getLowVideoTrack(E,r);o.push({track:v,type:Ve.LocalVideoLowTrack})}if(E instanceof qr)if(g){const v=g.track;if(v instanceof Ni)N1([E]),v.addAudioTrack(E),this.bindLocalAudioTrackEvents(E,!0);else{const S=O1([v,E]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(v,S)}}else u instanceof Ni?(N1([E]),u.addAudioTrack(E)):u||!E._useAudioElement&&In().webAudioMediaStreamDest&&!E._bypassWebAudio?u=O1(u?[E,u]:[E]):u=E}return u&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:Ve.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const t=[],r=this.getAllTracks();e=ky(e=e.filter(o=>r.indexOf(o)!==-1));for(const o of e){if(o instanceof qr){const c=this.localTrackMap.get(Ve.LocalAudioTrack);if(!c)continue;c.track instanceof Ni?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(t.push([Ve.LocalAudioTrack,c]),c.track.close())):t.push([Ve.LocalAudioTrack,c])}if(o instanceof gr){const c=this.localTrackMap.get(Ve.LocalVideoTrack);if(!c)continue;t.push([Ve.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ve.LocalVideoLowTrack);u&&t.push([Ve.LocalVideoLowTrack,u])}}return t}filterTobePublishedDataChannels(e){return e=(e=ky(e)).filter(t=>this.localDataChannels.findIndex(r=>r.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=ky(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:o}=t;switch(o){case Ve.LocalVideoTrack:r.addListener(ft.GET_STATS,this.handleGetLocalVideoStats),r.addListener(ft.GET_RTC_STATS,this.handleGetRTCStats),r.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ve.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case Ve.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ni?e.trackList.forEach(r=>{r.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),r.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(ft.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:o}]=t;return{track:o,type:r}})),e.forEach(t=>{let{track:r,type:o}=t;switch(o){case Ve.LocalVideoTrack:r.off(ft.GET_STATS,this.handleGetLocalVideoStats),r.off(ft.GET_RTC_STATS,this.handleGetRTCStats),r.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ve.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case Ve.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ni?e.trackList.forEach(t=>{t.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ft.GET_STATS,this.handleGetLocalAudioStats),t.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ft.GET_STATS,this.handleGetLocalAudioStats),e.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ft.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof qy&&t.addListener(ft.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof Ky&&t.addListener(ft.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ft.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(lt.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(lt.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,o)=>{var c;let u,f,{track:g,type:E}=r;switch(E){case Ve.LocalAudioTrack:u=Hn.Audio,f={dtx:g instanceof Lb&&g._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ve.LocalVideoTrack:u=et(c=g._hints).call(c,Zn.SCREEN_TRACK)?Hn.Screen:Hn.High,f=Eu(Eu({},U9(g)),{},{codec:this.store.codec,svc_mode:nI()});break;case Ve.LocalVideoLowTrack:u=Hn.Low,f=Eu(Eu({},U9(g)),{},{codec:this.store.codec,svc_mode:nI()})}return{stream_type:u,attributes:f,ssrcs:t[o]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:f,id:g}]=t;switch(c){case Ve.LocalVideoTrack:o=et(r=u._hints).call(r,Zn.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Ve.LocalAudioTrack:o=Hn.Audio;break;case Ve.LocalVideoLowTrack:o=Hn.Low}return{stream_type:o,ssrcs:f,mid:g}})}assignLocalTracks(e,t){e.forEach((r,o)=>{let{track:c,type:u}=r;this.localTrackMap.set(u,{track:c,id:t[o].id,ssrcs:t[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Rt.PeerConnectionStateChange,t),t==="connecting"&&e instanceof _u&&!Fr()&&Z("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},Z("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof _u&&L6(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Gh.DISCONNECTED_OR_FAILED,$o(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const r=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));vt.reportApiInvoke(this.store.sessionId,{name:di.REPUB_AFTER_PC_CONNECTED,options:r.concat(o),tag:Hr.TRACER}).onSuccess(),this.republish()}if(Z("NEW_ICE_RESTART")&&e instanceof _u&&!Fr()&&!this._forceTurn){if(et(x9).call(x9,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const r=c=>{D1(e)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),$o(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Rt.RequestRestartICE,c))},o=()=>{D1(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{M6(e,r,o)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&Z("ICE_RESTART")&&$o(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Rt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),vt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Hr.TRACER}).onSuccess(),this.emit(Rt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;const o=Array.from(Zo(r=this.remoteUserMap).call(r)).find(u=>u._audioSSRC===t);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Hy.FIRST_FRAME_DECODED),vt.firstRemoteFrame(this.store.sessionId,Bi.FIRST_AUDIO_DECODE,Ir.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ms.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;const o=Array.from(Zo(r=this.remoteUserMap).call(r)).find(c=>c._audioSSRC===t);o&&vt.firstRemoteFrame(this.store.sessionId,Bi.FIRST_AUDIO_RECEIVED,Ir.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ms.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,o)=>{this.reportVideoFirstFrameDecoded(t,r,o)},e.onFirstVideoReceived=t=>{var r;const o=Array.from(Zo(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);o&&vt.firstRemoteFrame(this.store.sessionId,Bi.FIRST_VIDEO_RECEIVED,Ir.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ms.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{const o=t.candidateType==="relay",c=r.candidateType==="relay";r.candidateType!=="unknown"&&o===c||this.emit(Rt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(wf(r))," -> ").concat(JSON.stringify(wf(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(wf(r))," -> ").concat(JSON.stringify(wf(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),r=this.statsCollector.getRTCStats();return Eu(Eu({},t),r)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof _u&&function(t){ov.delete(t.id),L6(t)}(e),e.close(),this.emit(Rt.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const r=this.localTrackMap.get(Ve.LocalAudioTrack);if(e instanceof qr&&(r==null?void 0:r.track)instanceof Ni)return r.track.isActive||t.push([Ve.LocalAudioTrack,r]),t;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(t.push(o),o[0]===Ve.LocalVideoTrack)){const c=this.localTrackMap.get(Ve.LocalVideoLowTrack);c&&t.push([Ve.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){const t=[],r=this.localTrackMap.get(Ve.LocalAudioTrack);if(e instanceof qr&&(r==null?void 0:r.track)instanceof Ni)return r.track.isActive&&t.push([Ve.LocalAudioTrack,r]),t;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Ve.LocalVideoTrack){t.push(o);const c=this.localTrackMap.get(Ve.LocalVideoLowTrack);c&&t.push([Ve.LocalVideoLowTrack,c])}else t.push(o);return t}createMuteMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:f,id:g}]=t;switch(c){case Ve.LocalAudioTrack:o=Hn.Audio;break;case Ve.LocalVideoTrack:o=et(r=u._hints).call(r,Zn.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Ve.LocalVideoLowTrack:o=Hn.Low}return{stream_type:o,ssrcs:f,mid:g}})}createUnmuteMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:f,id:g}]=t;switch(c){case Ve.LocalAudioTrack:o=Hn.Audio;break;case Ve.LocalVideoTrack:o=et(r=u._hints).call(r,Zn.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Ve.LocalVideoLowTrack:o=Hn.Low}return{stream_type:o,ssrcs:f,mid:g}})}filterTobeUnSubscribedTracks(e,t){const r=[],o=this.remoteUserMap.get(e);if(!o)return r;if(t){const c=o.get(t);if(!c)return r;r.push([e,{kind:t,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,f]=c;r.push([e,{kind:u,id:f}])});return r}filterTobeUnSubscribedDataChannels(e,t){const r=[];return t.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&r.push(o)}),r}createUnsubscribeMessage(e){const t=[];return e.forEach(r=>{let[o,{kind:c,id:u}]=r;switch(c){case lt.VIDEO:return void(o._videoSSRC&&t.push({stream_type:lt.VIDEO,ssrcId:o._videoSSRC}));case lt.AUDIO:return void(o._audioSSRC&&t.push({stream_type:lt.AUDIO,ssrcId:o._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(r=>{let[o,{kind:c}]=r;if(t.has(o)){let u=t.get(o);c===lt.VIDEO?u|=Hi.Video:u|=Hi.Audio,t.set(o,u)}else c===lt.VIDEO?t.set(o,Hi.Video):t.set(o,Hi.Audio)}),{users:Array.from(t.entries()).map(r=>{let[o,c]=r;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:o}]=t;const c=this.remoteUserMap.get(r);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Ve.LocalVideoTrack),r=this.localTrackMap.get(Ve.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new nt((o,c)=>{this.handleUpdateVideoEncoder(t.track,o,c,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new nt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t,r){return e.map((o,c)=>{var u;let{stream_type:f}=o;const g=(u=t.find(E=>{let{stream_type:v}=E;return f===v}))===null||u===void 0?void 0:u.attributes;if(g&&Z("DISABLE_SCREEN_SHARE_REMB")){const E=r[c]._hints;(et(E).call(E,Zn.SCREEN_TRACK)||et(E).call(E,Zn.SCREEN_LOW_TRACK))&&(g.remb=!1,x.debug("disable remb for screen share, hints:",E))}return g})}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof qr){var t;const o=this.filterTobeUnmutedTracks(e[r]);if(o.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(o.map(u=>{let[,{id:f}]=u;return f})));const c=this.createUnmuteMessage(o);return void await ir(this,Rt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Rt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Rt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await is(Tk(this.dtlsFailedCount,Si)),this.emit(Rt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await gs(this,Rt.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Rt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ve.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof gr)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof gr).length>1)throw new Ae(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof qr).length>1&&(e.some(t=>t instanceof qr&&t._bypassWebAudio)||!In().webAudioMediaStreamDest))throw new Ae(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof gr&&this.pendingLocalTracks.some(r=>r instanceof gr))throw new Ae(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof qr&&this.pendingLocalTracks.some(r=>r instanceof qr)&&(!In().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof qr&&r._bypassWebAudio)))throw new Ae(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var r;const o=!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&In().supportDualStreamEncoding,c=Eu(Eu({},{width:160,height:120,framerate:15,bitrate:50}),t);let u;u=o?e._mediaStreamTrack.clone():x1(e,c);const f=lr(8,"track-low-"),g=new gr(u,Eu(Eu({},o&&{scaleResolutionDownBy:f1(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,f);return g.on(Mg.TRANSCEIVER_UPDATED,E=>{e._updateRtpTransceiver(E,Fy.LOW_STREAM)}),g._hints.push(Zn.LOW_STREAM),et(r=e._hints).call(r,Zn.SCREEN_TRACK)&&g._hints.push(Zn.SCREEN_LOW_TRACK),e.on("sei-to-send",E=>{g.emit("sei-to-send",E)}),e.addListener(ft.NEED_CLOSE,()=>{g.close()}),g}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof _u){var c,u,f,g;const E=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:S,peerConnectionState:R}=this.connection,{local:I,remote:D}=await this.connection.getSelectedCandidatePair();vt.pcStats(this.store.sessionId,{startTime:E,eventElapse:e-E||0,iceconnectionsate:v,dtlsstate:S,connectionstate:R,intSucc:t?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=I==null?void 0:I.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=I.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(I.address,":").concat(I.port),selectedRemoteCandidateProtocol:(f=D.protocol)!==null&&f!==void 0?f:"",selectedRemoteCandidateType:(g=D.candidateType)!==null&&g!==void 0?g:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:r,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,t,r,o){var c;const u=Array.from(Zo(c=this.remoteUserMap).call(c)).find(f=>f._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const f=this.store.keyMetrics,g=f.subscribe.find(E=>E.userId===u.uid&&E.type==="video");vt.firstRemoteVideoDecode(this.store.sessionId,Bi.FIRST_VIDEO_DECODE,Ir.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:t,videoheight:r,subscribeElapse:Ms.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:f.requestAPEnd||0,apStart:f.requestAPStart||0,joinGwEnd:f.joinGatewayEnd||0,joinGwStart:f.joinGatewayStart||0,pcEnd:f.peerConnectionEnd||0,pcStart:f.peerConnectionStart||0,subscriberEnd:(g==null?void 0:g.subscribeEnd)||0,subscriberStart:(g==null?void 0:g.subscribeStart)||0,videoAddNotify:(g==null?void 0:g.streamAdded)||0,state:o?1:0,firstFrame:(g==null?void 0:g.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(t);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==r}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===Ve.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,Fy.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},_t(cn.prototype,"startP2PConnection",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"startP2PConnection"),cn.prototype),_t(cn.prototype,"connect",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"connect"),cn.prototype),_t(cn.prototype,"updateRemoteRTPCapabilities",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"updateRemoteRTPCapabilities"),cn.prototype),_t(cn.prototype,"publishDataChannel",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"publishDataChannel"),cn.prototype),_t(cn.prototype,"unpublish",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"unpublish"),cn.prototype),_t(cn.prototype,"unpublishDataChannel",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"unpublishDataChannel"),cn.prototype),_t(cn.prototype,"unpublishLowStream",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"unpublishLowStream"),cn.prototype),_t(cn.prototype,"subscribeDataChannel",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"subscribeDataChannel"),cn.prototype),_t(cn.prototype,"subscribe",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"subscribe"),cn.prototype),_t(cn.prototype,"massSubscribe",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"massSubscribe"),cn.prototype),_t(cn.prototype,"unsubscribe",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"unsubscribe"),cn.prototype),_t(cn.prototype,"unsubscribeDataChannel",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"unsubscribeDataChannel"),cn.prototype),_t(cn.prototype,"massUnsubscribe",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"massUnsubscribe"),cn.prototype),_t(cn.prototype,"muteRemote",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"muteRemote"),cn.prototype),_t(cn.prototype,"unmuteRemote",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"unmuteRemote"),cn.prototype),_t(cn.prototype,"hasRemoteMediaWithLock",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"hasRemoteMediaWithLock"),cn.prototype),_t(cn.prototype,"disconnectForReconnect",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"disconnectForReconnect"),cn.prototype),_t(cn.prototype,"updateBitrateLimit",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"updateBitrateLimit"),cn.prototype),_t(cn.prototype,"remoteMediaSsrcChanged",[oa],Object.getOwnPropertyDescriptor(cn.prototype,"remoteMediaSsrcChanged"),cn.prototype),cn);function oa(e,t,r){const o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(t));try{for(var f=arguments.length,g=new Array(f),E=0;E<f;E++)g[E]=arguments[E];return await o.apply(this,g)}finally{u()}},r}function V6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function F6(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?V6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const Yre=Date.now(),qre=20,k1=new Map,yI=new Map;async function B6(e){const t=k1.get(e),r=Array.isArray(t)&&t[t.length-1],o=yI.get(e);if(!r)return void(o.isSyncing=!1);const c={uid:r.uid,payload:r.payload};o.firstRecvTs===0&&(o.firstRecvTs=r.recvTs,o.firstSendTs=r.sendTs);const u=r.sendTs-o.firstSendTs,f=u-(Date.now()-o.firstRecvTs);f>0&&(o.firstRecvTs=Date.now()-u);let g=r.mediaDelay+f;g<=0?(t.pop(),H6(r.context,c),g=0):g=Math.min(g,qre),setTimeout(()=>t.length&&B6(e),g)}function H6(e,t){e.safeEmit(hn.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function Kre(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return H6(r,{uid:e.uid,payload:e.payload});const o="".concat(r.id,"-").concat(e.uid),c=k1.get(o)||[],u=c.findIndex(v=>e.sendTs>=v.sendTs),f=F6(F6({},e),{},{context:r,mediaDelay:t,recvTs:Date.now()});u===-1?c.push(f):c.splice(u,0,f),k1.set(o,c);let g=!1;var E;yI.has(o)?g=!((E=yI.get(o))===null||E===void 0||!E.isSyncing):yI.set(o,{isSyncing:g,firstRecvTs:0,firstSendTs:0}),g||B6(o)}const Xre=An().name;function G6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function W6(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?G6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const cv="websdk_ng_cache_parameter",Qre=Z("MAX_PRELOAD_ASYNC_LENGTH"),$re=1e4,Yg=new Map,qg=[];let L1=null,M1=0,j1=0;const vI=new Map,Jre=function(e,t){const r=[];let o=0;const c=async()=>{const u=r.shift();u&&await u(),r.length>0&&o<t?c():o--};return async function(){for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];return new nt(async(E,v)=>{r.push(async()=>{try{const S=await e(...f);E(S)}catch(S){v(S)}}),o<t&&(o++,c())})}}(z6,Qre),U1=xa.CancelToken.source();async function z6(e,t,r,o,c,u){try{if(!Z("ENABLE_PRELOAD"))return;if(!In().supportWebCrypto)return void Ef(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r&&r!==null)throw new Ae(q.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&rs(r,"token",1,2047),rs(e,"appid",1,2047),$A(t),o&&JA(o);const f=kg();x.debug("preload channel ".concat(t,", uid is ").concat(o));const g={appId:e,cname:t,token:r||e,uid:typeof o!="string"?o:null,sid:f,proxyServer:c};let E,v;typeof o=="string"?(g.stringUid=o,[v,E]=await nt.all([kre(o,{sid:f,appId:e},U1.token),m6(W6(W6({},g),{},{token:r||e,uid:0}),U1.token)]),g.uid=v.uid,E.gatewayInfo.uid=g.uid,E.gatewayInfo.res.uid=g.uid):(u&&(g.stringUid=u),E=await m6(g,U1.token));const S={sid:f,appId:e,cname:t,token:r||e,uid:g.stringUid||o,intUid:g.uid||E.gatewayInfo.uid,stringUid:g.stringUid,ts:Date.now(),sua:v,ap:E};await async function(R){let I;try{R.uid&&q6({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const D=$6(R),V=await async function(j,G){try{const z=await window.crypto.subtle.importKey("raw",U3(G),"AES-GCM",!1,["encrypt"]),ce=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},z,Pg(window.btoa(JSON.stringify(j))));return yf(new Uint8Array(ce))}catch{return}}(R,R.token||R.appId);if(!V)return;I=Q6(cv);const M=I?JSON.parse(I):[];M.push({[D]:V}),M.length>Z("AP_CACHE_NUM")&&M.shift(),SI(cv,JSON.stringify(M))}catch(D){x.warn("Error caching server parameters:",D.message),SI(cv,"")}}(S),M1++}catch(f){throw j1++,function(g){L1||(L1=window.setTimeout(()=>{let v="";vI.forEach((S,R)=>{v+="".concat(R,": ").concat(S," ;")}),vt.reportApiInvoke(null,{name:di.PRELOAD,options:{success:M1,failed:j1,err:v}}).onError(g),M1=0,j1=0,vI.clear(),L1=null},$re));const E=vI.get(g.code)||0;vI.set(g.code,E+1)}(f),f}}async function Y6(e){try{if(Z("AP_REQUEST_DETAIL")||Z("ENABLE_ROLE_SELECT_EDGE"))return;const t=q6(e);if(!t||e.cloudProxyServer!=="disabled")return;const r=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",U3(c),"AES-GCM",!1,["decrypt"]),f=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,Pg(o));return JSON.parse(window.atob(yf(new Uint8Array(f))))}catch{return}}(t,e.token||e.appId);if(!r||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(r,e))return;if(r&&Date.now()-r.ts<Z("AP_CACHE_LIFETIME"))return r}catch(t){x.warn("Error get preloadInfo",t.message)}}function q6(e){let t;try{if(t=Q6(cv),!t)return;const r=JSON.parse(t),o=$6(e),c=function(f,g){for(let E=f.length-1;E>=0;E--)if(g(f[E]))return E;return-1}(r,f=>o in f);if(c===-1)return;const u=r.splice(c,1)[0];return SI(cv,JSON.stringify(r)),u[o]}catch(r){x.warn("Error delete preload info: ".concat(t),r.message),SI(cv,"")}}function V1(e){if(e){let t=Yg.get(e);t&&(window.clearTimeout(t),t=null,Yg.delete(e)),et(qg).call(qg,e)||e.cloudProxyServer!=="disabled"||qg.push(e)}if(Yg.size<Z("AP_CACHE_NUM")&&qg.length>0){const t=qg.shift();Yg.set(t,window.setTimeout(async()=>{const{appId:r,cname:o,token:c,stringUid:u,uid:f,proxyServer:g}=t;try{await Jre(r,o,c,f,g,u),Yg.has(t)&&V1(t)}catch(E){x.warn("update preload failed",E.message),K6(t)}},Z("AP_UPDATE_INTERVAL")))}}function K6(e){const t=qg.indexOf(e);t!==-1&&qg.splice(t,1);let r=Yg.get(e);r&&(window.clearTimeout(r),r=null,Yg.delete(e),V1())}function X6(e,t){const r=e.sua,o=e.ap;t&&r&&vt.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),vt.reportResourceTiming(e.ap.url,e.sid),vt.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[hi.CHOOSE_SERVER,hi.CLOUD_PROXY_FALLBACK].toString()}),vt.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[hi.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function Q6(e){return window.atob(window.localStorage.getItem(e)||"")}function SI(e,t){window.localStorage.setItem(e,window.btoa(t))}function $6(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),z3(t)}function Zre(e){let t=function(){const r=nie.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,o){let c=r.appId;c!==void 0&&(pi(o,10),Nf(o,c));let u=r.cid;u!==void 0&&(pi(o,16),pi(o,u));let f=r.cname;f!==void 0&&(pi(o,26),Nf(o,f));let g=r.deviceId;g!==void 0&&(pi(o,34),Nf(o,g));let E=r.elapse;E!==void 0&&(pi(o,40),Of(o,E));let v=r.fileSize;v!==void 0&&(pi(o,48),Of(o,lv(v)));let S=r.height;S!==void 0&&(pi(o,56),Of(o,lv(S)));let R=r.jpg;R!==void 0&&(pi(o,66),pi(o,R.length),Z6(o,R));let I=r.networkType;I!==void 0&&(pi(o,72),Of(o,lv(I)));let D=r.osType;D!==void 0&&(pi(o,80),Of(o,lv(D)));let V=r.requestId;V!==void 0&&(pi(o,90),Nf(o,V));let M=r.sdkVersion;M!==void 0&&(pi(o,98),Nf(o,M));let j=r.sequence;j!==void 0&&(pi(o,104),Of(o,lv(j)));let G=r.sid;G!==void 0&&(pi(o,114),Nf(o,G));let z=r.timestamp;z!==void 0&&(pi(o,120),Of(o,z));let ce=r.uid;ce!==void 0&&(pi(o,128),pi(o,ce));let Ee=r.vid;Ee!==void 0&&(pi(o,136),pi(o,Ee));let _e=r.width;_e!==void 0&&(pi(o,144),Of(o,lv(_e)));let me=r.service;me!==void 0&&(pi(o,152),pi(o,me));let Ce=r.callbackData;Ce!==void 0&&(pi(o,162),pi(o,Ce.length),Z6(o,Ce));let xe=r.ticket;xe!==void 0&&(pi(o,170),Nf(o,xe));let $e=r.vendorConfigs;$e!==void 0&&(pi(o,178),Nf(o,$e))}(e,t),function(r){let o=r.bytes,c=r.limit;return o.length===c?o:o.subarray(0,c)}(t)}function eie(e){return function(r){let o={};e:for(;!rie(r);){let c=$b(r);switch(c>>>3){case 0:break e;case 1:o.code=$b(r);break;case 2:o.msg=eH(r,$b(r));break;case 3:o.requestId=eH(r,$b(r));break;case 4:o.timestamp=iie(r,!1);break;default:tie(r,7&c)}}return o}({bytes:t=e,offset:0,limit:t.length});var t}function tie(e,t){switch(t){case 0:for(;128&wl(e););break;case 2:F1(e,$b(e));break;case 5:F1(e,4);break;case 1:F1(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function lv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let nie=[];function F1(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function rie(e){return e.offset>=e.limit}function TI(e,t){let r=e.bytes,o=e.offset,c=e.limit,u=o+t;if(u>r.length){let f=new Uint8Array(2*u);f.set(r),e.bytes=f}return e.offset=u,u>c&&(e.limit=u),o}function J6(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function Z6(e,t){let r=TI(e,t.length);e.bytes.set(t,r)}function eH(e,t){let r=J6(e,t),o=String.fromCharCode,c=e.bytes,u="",f="";for(let g=0;g<t;g++){let E,v,S,R,I=c[g+r];(128&I)==0?f+=o(I):(224&I)==192?g+1>=t?f+=u:(E=c[g+r+1],(192&E)!=128?f+=u:(R=(31&I)<<6|63&E,R<128?f+=u:(f+=o(R),g++))):(240&I)==224?g+2>=t?f+=u:(E=c[g+r+1],v=c[g+r+2],(49344&(E|v<<8))!=32896?f+=u:(R=(15&I)<<12|(63&E)<<6|63&v,R<2048||R>=55296&&R<=57343?f+=u:(f+=o(R),g+=2))):(248&I)==240?g+3>=t?f+=u:(E=c[g+r+1],v=c[g+r+2],S=c[g+r+3],(12632256&(E|v<<8|S<<16))!=8421504?f+=u:(R=(7&I)<<18|(63&E)<<12|(63&v)<<6|63&S,R<65536||R>1114111?f+=u:(R-=65536,f+=o(55296+(R>>10),56320+(1023&R)),g+=3))):f+=u}return f}function Nf(e,t){let r=t.length,o=0;for(let f=0;f<r;f++){let g=t.charCodeAt(f);g>=55296&&g<=56319&&f+1<r&&(g=(g<<10)+t.charCodeAt(++f)-56613888),o+=g<128?1:g<2048?2:g<65536?3:4}pi(e,o);let c=TI(e,o),u=e.bytes;for(let f=0;f<r;f++){let g=t.charCodeAt(f);g>=55296&&g<=56319&&f+1<r&&(g=(g<<10)+t.charCodeAt(++f)-56613888),g<128?u[c++]=g:(g<2048?u[c++]=g>>6&31|192:(g<65536?u[c++]=g>>12&15|224:(u[c++]=g>>18&7|240,u[c++]=g>>12&63|128),u[c++]=g>>6&63|128),u[c++]=63&g|128)}}function wl(e){return e.bytes[J6(e,1)]}function tH(e,t){let r=TI(e,1);e.bytes[r]=t}function $b(e){let t,r=0,o=0;do t=wl(e),r<32&&(o|=(127&t)<<r),r+=7;while(128&t);return o}function pi(e,t){for(t>>>=0;t>=128;)tH(e,127&t|128),t>>>=7;tH(e,t)}function iie(e,t){let r,o=0,c=0,u=0;return r=wl(e),o=127&r,128&r&&(r=wl(e),o|=(127&r)<<7,128&r&&(r=wl(e),o|=(127&r)<<14,128&r&&(r=wl(e),o|=(127&r)<<21,128&r&&(r=wl(e),c=127&r,128&r&&(r=wl(e),c|=(127&r)<<7,128&r&&(r=wl(e),c|=(127&r)<<14,128&r&&(r=wl(e),c|=(127&r)<<21,128&r&&(r=wl(e),u=127&r,128&r&&(r=wl(e),u|=(127&r)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:t}}function Of(e,t){let r=t.low>>>0,o=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,u=c===0?o===0?r<16384?r<128?1:2:r<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,f=TI(e,u),g=e.bytes;switch(u){case 10:g[f+9]=c>>>7&1;case 9:g[f+8]=u!==9?128|c:127&c;case 8:g[f+7]=u!==8?o>>>21|128:o>>>21&127;case 7:g[f+6]=u!==7?o>>>14|128:o>>>14&127;case 6:g[f+5]=u!==6?o>>>7|128:o>>>7&127;case 5:g[f+4]=u!==5?128|o:127&o;case 4:g[f+3]=u!==4?r>>>21|128:r>>>21&127;case 3:g[f+2]=u!==3?r>>>14|128:r>>>14&127;case 2:g[f+1]=u!==2?r>>>7|128:r>>>7&127;case 1:g[f]=u!==1?128|r:127&r}}const nH={},rH={},bI=4294967296,sie=bI*bI,aie=sie/2;sH(0,!0);const iH=sH(0),oie=Jb(0,-2147483648,!1),cie=Jb(-1,2147483647,!1);function sH(e,t){let r,o,c;return t?(c=0<=(e>>>=0)&&e<256)&&(o=rH[e],o)?o:(r=Jb(e,0,!0),c&&(rH[e]=r),r):(c=-128<=(e|=0)&&e<128)&&(o=nH[e],o)?o:(r=Jb(e,e<0?-1:0,!1),c&&(nH[e]=r),r)}function Jb(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}function aH(e,t){if(isNaN(e))return iH;{if(e<=-9223372036854776e3)return oie;if(e+1>=aie)return cie}return e<0?iH:Jb(e%bI|0,e/bI|0,t)}function oH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}class B1 extends Dr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const r=this._connectionState;this._connectionState=t,this.emit(pd.CONNECTION_STATE_CHANGE,t,r)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var r;super(),H(this,"name","AgoraRTCImageModeration"),H(this,"_connectionState",Oc.CONNECTING),H(this,"_sequence",0),H(this,"_moderationStartTime",void 0),H(this,"_workerConnection",void 0),H(this,"_workerMessageLengthLimit",void 0),H(this,"_qualityRatio",void 0),H(this,"_connectInfo",void 0),H(this,"_cancelTokenSource",xa.CancelToken.source()),H(this,"_retryConfig",void 0),H(this,"_moderationInterval",void 0),H(this,"_moderationTimer",null),H(this,"_moderationMode",1),H(this,"_quality",1),H(this,"_qualityTimer",null),H(this,"_ticket",void 0),H(this,"_moderationIntervalMinimum",void 0),H(this,"_uploadFailedNum",0),H(this,"_uploadNum",0),H(this,"_uploadTimer",null),H(this,"_extraInfo",void 0),H(this,"_vendor",""),H(this,"_encoder",new TextEncoder),H(this,"_moderationId",void 0),H(this,"inspectImage",()=>{if(this.connectionState!==Oc.CONNECTED)throw new Te(q.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Oc.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=lr(5,"image-moderation-"),this._workerMessageLengthLimit=Z("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=Z("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=Z("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Fb("worker-"+this._moderationId,Si),this.on(pd.STATE_CHANGE,(o,c)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Jy[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(t,r){this.emit(pd.STATE_CHANGE,Jy.CONNECT_AP),this._connectInfo=t;const o=this._cancelTokenSource.token;return this._retryConfig=r,new nt((c,u)=>{this.on(pd.CONNECTION_STATE_CHANGE,(f,g)=>{f===Oc.CONNECTED&&c()}),this.requestAP(t,o,r).then(f=>{this.connectWorker(f)}).catch(f=>{u(f)})})}updateConfig(t){var r;this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Oc.CONNECTED&&this.inspectImage()}async requestAP(t,r,o){const c=Z("WEBCS_DOMAIN").map(E=>"https://".concat(E,"/api/v1")),u=await function(E,v,S,R){let{appId:I,areaCode:D,cname:V,sid:M,token:j,uid:G}=v;iv++;const z="moderation_plugin",ce={service_name:z,json_body:JSON.stringify({appId:I,areaCode:D,cname:V,command:"allocateEdge",requestId:iv,seq:iv,sid:M,appToken:j,ts:Date.now(),uid:G+""})};let Ee,_e,me=E[0];return ld(async()=>{Ee=Date.now();const Ce=await fd(me,{data:ce,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_e=Date.now()-Ee,Ce.code!==0){const at=new Te(q.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ce.code,{retry:!0,responseTime:_e});throw x.error(at.toString()),at}const xe=JSON.parse(Ce.json_body);if(xe.code!==200){const at=new Te(q.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(xe.code,", reason: ").concat(xe.reason),{code:xe.code,responseTime:_e});throw x.error(at.toString()),at}if(!xe.servers||!Array.isArray(xe.servers)||xe.servers.length===0){const at=new Te(q.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:xe.code,responseTime:_e});throw x.error(at.toString()),at}if(!xe.servers.some(at=>!!at.wss)){const at=new Te(q.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:xe.code,responseTime:_e});throw x.error(at.toString()),at}const $e=Z("IMAGE_MODERATION_WORKER_HOST");return{addressList:xe.servers.map(at=>{let{address:Zt,wss:qt}=at;if(Zt&&qt)return"wss://".concat(Zt.replace(/\./g,"-"),".").concat($e,":").concat(qt,"/moderation")}).filter(at=>!!at),workerToken:xe.workerToken,vid:xe.vid,ticket:xe.appTicket,responseTime:_e}},(Ce,xe)=>(vt.apworkerEvent(M,{success:!0,sc:200,serviceName:z,responseDetail:JSON.stringify(Ce.addressList),firstSuccess:xe===0,responseTime:_e,serverIp:E[xe%E.length]}),!1),(Ce,xe)=>(vt.apworkerEvent(M,{success:!1,sc:Ce.data&&Ce.data.code||200,serviceName:z,responseTime:_e,serverIp:E[xe%E.length]}),!!(Ce.code!==q.OPERATION_ABORTED&&Ce.code!==q.UNEXPECTED_RESPONSE||Ce.data&&Ce.data.retry)&&(me=E[(xe+1)%E.length],!0)),R)}(c,t,r,o);this.emit(pd.STATE_CHANGE,Jy.AP_CONNECTED);const{addressList:f,ticket:g}=u;return this._ticket=g,f}async connectWorker(t){this.emit(pd.STATE_CHANGE,Jy.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Wt.CONNECTED,async()=>{this.emit(pd.STATE_CHANGE,Jy.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Oc.CONNECTED}),this._workerConnection.on(Wt.CLOSED,()=>{this.connectionState=Oc.CLOSED}),this._workerConnection.on(Wt.FAILED,()=>{this.connectionState=Oc.CLOSED}),this._workerConnection.on(Wt.RECONNECTING,()=>{this.connectionState=this.connectionState===Oc.CONNECTED?Oc.RECONNECTING:Oc.CONNECTING}),this._workerConnection.on(Wt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=eie(new Uint8Array(t.data));Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),this._uploadNum++,r.code===void 0||r.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{vt.reportApiInvoke(this._connectInfo.sid||null,{name:di.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r.code],tag:Hr.TRACER}).onError(new Te(q.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),this._uploadTimer=null},Z("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Wt.WILL_RECONNECT,(t,r,o)=>{t==="recover"&&o(t),o("tryNext")}),this._workerConnection.on(Wt.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=$o(this,pd.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(t,r);this._workerConnection.sendMessage(o,!0,!0)}else Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(t,r){let{appId:o,cname:c,cid:u,vid:f,sid:g,uid:E}=r;const v=Date.now(),S=await t.getCurrentFrameImage("image/jpeg",this.quality),R=await k4(S,o,c),I=this._sequence+"-"+u+"-"+E+"-"+v+"-"+lr(12,""),D={appId:o,cid:u,cname:c,deviceId:"",elapse:B1.intToLong(Number(v-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:I,sdkVersion:"4.23.3",sequence:this._sequence,sid:g,timestamp:aH(v),uid:E,vid:f,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete D.callbackData;const V=Zre(D);if(V.byteLength<this._workerMessageLengthLimit){if(Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const M=function(j){for(var G=1;G<arguments.length;G++){var z=arguments[G]!=null?arguments[G]:{};G%2?oH(Object(z),!0).forEach(function(ce){H(j,ce,z[ce])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(z)):oH(Object(z)).forEach(function(ce){Object.defineProperty(j,ce,Object.getOwnPropertyDescriptor(z,ce))})}return j}({},D);delete M.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(M))}return V}{const M=this.quality*this._qualityRatio;return this.quality=M,await this.generateRequestData(t,{appId:o,cname:c,cid:u,vid:f,sid:g,uid:E})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=xa.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Oc.CLOSED,this.emit(pd.STATE_CHANGE,Jy.CLOSED)}}function cH(e){if(Jn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Te(q.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Te(q.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const lie={name:"ImageModeration",create:function(e){let{config:t}=e;return cH(t),new B1(t)}};var lH,dH,uH,hH,pH,fH,mH,gH,_H,EH,yH,vH,SH,TH,bH,wH,RH,CH,AH,IH,NH,OH,DH,xH,PH,kH,LH,MH,jH,UH,VH,FH,BH,HH,GH,WH,zH,YH,qH,KH,XH,st;function QH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Rl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?QH(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):QH(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}Ps.setLogger(x);let die=(lH=Nt(),dH=Nt({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Wy))return[t];t=[t]}return t.map(r=>r?Object(r).toString():"null")}}),uH=Nt({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Gy.DATA?(Array.isArray(t)||(t=[t]),t.map(r=>r.getTrackId())):[t.getChannelId()])}),hH=Nt({argsMap:(e,t,r,o)=>[typeof t=="object"?t.uid:t,r,o]}),pH=Nt({argsMap:(e,t,r)=>[t,r]}),fH=Nt({argsMap:(e,t)=>t.map(r=>{let{user:o,mediaType:c}=r;return[o==null?void 0:o.uid,c]})}),mH=Nt({argsMap:(e,t,r,o)=>[typeof t=="object"?t.uid:t,r,o]}),gH=Nt({argsMap:(e,t)=>t.map(r=>{let{user:o,mediaType:c}=r;return{uid:o==null?void 0:o.uid,mediaType:c}})}),_H=Nt(),EH=Nt(),yH=Nt(),vH=Nt(),SH=Nt(),TH=Nt(),bH=Nt(),wH=Nt(),RH=Nt(),CH=Nt(),AH=Nt(),IH=Nt(),NH=Nt(),OH=Nt(),DH=Nt(),xH=Nt({argsMap:(e,t)=>[t]}),PH=Nt(),kH=Nt(),LH=Nt(),MH=Nt(),jH=Nt(),UH=Nt(),VH=Nt(),FH=Nt(),BH=Nt({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),HH=Nt(),GH=Nt(),WH=Nt(),zH=Nt(),YH=Nt(),qH=Nt(),KH=Nt({reportResult:!0}),XH=Nt(),st=class extends Dr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let r;if(super(),H(this,"store",void 0),H(this,"_uid",void 0),H(this,"_channelName",void 0),H(this,"_uintUid",void 0),H(this,"_users",[]),H(this,"_config",void 0),H(this,"_clientId",void 0),H(this,"_appId",void 0),H(this,"_sessionId",null),H(this,"_key",void 0),H(this,"_rtmConfig",{}),H(this,"_joinInfo",void 0),H(this,"_gateway",void 0),H(this,"_statsCollector",void 0),H(this,"_configDistribute",void 0),H(this,"_leaveMutex",void 0),H(this,"_publishMutex",void 0),H(this,"_renewTokenMutex",void 0),H(this,"_subscribeMutex",void 0),H(this,"_encryptionMode","none"),H(this,"_encryptionSecret",null),H(this,"_encryptionSalt",null),H(this,"_encryptDataStream",!1),H(this,"_encryptDataStreamKey",null),H(this,"_encryptDataStreamIv",null),H(this,"_proxyServer",void 0),H(this,"_turnServer",{servers:[],mode:"auto"}),H(this,"_cloudProxyServerMode","disabled"),H(this,"_isDualStreamEnabled",!1),H(this,"_defaultStreamFallbackType",void 0),H(this,"_lowStreamParameter",void 0),H(this,"_streamFallbackTypeCacheMap",new Map),H(this,"_remoteStreamTypeCacheMap",new Map),H(this,"_axiosCancelSource",xa.CancelToken.source()),H(this,"_audioVolumeIndicationInterval",void 0),H(this,"_networkQualityInterval",void 0),H(this,"_userOfflineTimeout",void 0),H(this,"_streamRemovedTimeout",void 0),H(this,"_liveTranscodeStreamingClient",void 0),H(this,"_liveRawStreamingClient",void 0),H(this,"_channelMediaRelayClient",void 0),H(this,"_networkQualitySensitivity","normal"),H(this,"_p2pChannel",void 0),H(this,"_useLocalAccessPoint",!1),H(this,"_setLocalAPVersion",void 0),H(this,"_joinAndNotLeaveYet",!1),H(this,"_numberOfJoinCount",0),H(this,"_remoteDefaultVideoStreamType",void 0),H(this,"_inspect",void 0),H(this,"_moderation",void 0),H(this,"_license",void 0),H(this,"_pendingPublishedUsers",[]),H(this,"ntpAlignErrorCount",0),H(this,"remoteInboundOffset",0),H(this,"_peerConnectionState",void 0),H(this,"_handleLocalTrackEnable",(c,u,f)=>{this.publish(c,!1).then(u).catch(f)}),H(this,"_handleLocalTrackDisable",(c,u,f)=>{this.unpublish(c).then(u).catch(f)}),H(this,"_handleUserOnline",c=>{if(Z("BLOCK_LOCAL_CLIENT")&&Hg(c.uid,this.channelName))return void x.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(f=>f.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(hn.USER_JOINED,u));else{const f=new Af(c.uid,c.uint_id||c.uid);this._users.push(f),x.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(hn.USER_JOINED,f)}}),H(this,"_handleUserOffline",c=>{if(Z("BLOCK_LOCAL_CLIENT")&&Hg(c.uid,this.channelName))return;const u=this._users.find(f=>f.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:AA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),x.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(hn.USER_LEAVED,u,c.reason))}),H(this,"_handleAddAudioOrVideoStream",(c,u,f,g,E,v,S)=>{if(Z("BLOCK_LOCAL_CLIENT")&&Hg(u,this.channelName))return;const R=this._users.find(D=>D.uid===u);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const I=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=E||u),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,f!==void 0&&(R._audioSSRC=f),g!==void 0&&(R._cname=g),v&&(R._audioOrtc=v)):(R._video_added_=!0,f!==void 0&&(R._videoSSRC=f),g!==void 0&&(R._cname=g),S!==void 0&&(R._rtxSsrcId=S),v&&(R._videoOrtc=v)),(c==="audio"?R.hasAudio:R.hasVideo)&&!I&&(x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(hn.USER_PUBLISHED,R,c)),c==="video"?vt.onGatewayStream(this._sessionId,Bi.ON_ADD_VIDEO_STREAM,Ir.ON_ADD_VIDEO_STREAM,{peer:E||u,ssrc:R._videoSSRC}):vt.onGatewayStream(this._sessionId,Bi.ON_ADD_AUDIO_STREAM,Ir.ON_ADD_AUDIO_STREAM,{peer:E||u,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,f).then(D=>{if(D&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Qb))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(V=>{x.error("[".concat(this._clientId,"] resubscribe error"),V.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(D=>{x.error("[".concat(this._clientId,"] resubscribe error"),D.toString())}))}),H(this,"_handleRemoveStream",c=>{if(Z("BLOCK_LOCAL_CLIENT")&&Hg(c.uid,this.channelName))return;const u=this._users.find(g=>g.uid===c.uid);if(!u)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let f=()=>{};u.hasAudio&&u.hasVideo?f=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(hn.USER_UNPUBLISHED,u,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(hn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?f=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(hn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(f=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(hn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof Qb&&this._p2pChannel.unsubscribe(u).then(g=>{if(g)return this._gateway.unsubscribe(g,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),vt.onGatewayStream(this._sessionId,Bi.ON_REMOVE_STREAM,Ir.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),f()}),H(this,"_handleSetStreamLocalEnable",(c,u,f)=>{if(Z("BLOCK_LOCAL_CLIENT")&&Hg(u,this.channelName))return;const g=this._users.find(S=>S.uid===u);if(!g)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(f?"enabled":"disabled"," with uid ").concat(u));const E=c==="audio"?g.hasAudio:g.hasVideo;if(c==="audio"){g._trust_audio_enabled_state_=!0;const S=g._audio_enabled_;if(g._audio_enabled_=f,g._audio_enabled_===S)return;{const R=g._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(hn.USER_INFO_UPDATED,u,R)}}else{g._trust_video_enabled_state_=!0;const S=g._video_enabled_;if(g._video_enabled_=f,g._video_enabled_===S)return;{const R=g._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(hn.USER_INFO_UPDATED,u,R)}}const v=c==="audio"?g.hasAudio:g.hasVideo;return E!==v?!E&&v?(x.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(hn.USER_PUBLISHED,g,c)):(c==="video"&&g._videoTrack&&g._videoTrack._destroy(),c==="audio"&&g._audioTrack,this._p2pChannel.muteRemote(g,c),x.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(hn.USER_UNPUBLISHED,g,c)):void 0}),H(this,"_handleMuteStream",(c,u,f)=>{if(Z("BLOCK_LOCAL_CLIENT")&&Hg(c,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),c,u,f);const g=this._users.find(S=>S.uid===c);if(!g)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const E=u==="audio"?g.hasAudio:g.hasVideo;if(u==="audio"){g._trust_audio_mute_state_=!0;const S=g._audio_muted_;if(g._audio_muted_=f,g._audio_muted_===S)return;{const R=g._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(hn.USER_INFO_UPDATED,c,R)}}else{g._trust_video_mute_state_=!0;const S=g._video_muted_;if(g._video_muted_=f,g._video_muted_===S)return;{const R=g._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(hn.USER_INFO_UPDATED,c,R)}}const v=u==="audio"?g.hasAudio:g.hasVideo;if(E!==v){if(!E&&v)return(u==="audio"?g._audioSSRC:g._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(hn.USER_PUBLISHED,g,u)):void x.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&g._videoTrack&&!g._video_pre_subscribed&&g._videoTrack._destroy(),u==="audio"&&g._audioTrack,this._p2pChannel.muteRemote(g,u),x.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(hn.USER_UNPUBLISHED,g,u)}}),H(this,"_handleP2PLost",async c=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),H(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(hn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),H(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),H(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(hn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(hn.NETWORK_QUALITY,c)}),H(this,"_handleP2PAddAudioOrVideoStream",(c,u,f,g)=>{const E=this._users.find(S=>S.uid===u);if(!E)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(E.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?E.hasAudio:E.hasVideo;c==="audio"?E._trust_audio_stream_added_state_=!0:E._trust_video_stream_added_state_=!0,c==="audio"?(E._audio_added_=!0,f!==void 0&&(E._audioSSRC=f),g!==void 0&&(E._audioMid=g)):(E._video_added_=!0,f!==void 0&&(E._videoSSRC=f),g!==void 0&&(E._videoMid=g)),(c==="audio"?E.hasAudio:E.hasVideo)&&!v&&(x.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published ").concat(c)),this.safeEmit(hn.USER_PUBLISHED,E,c)),this._p2pChannel.hasPendingRemoteMedia(E,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(E.uid," after reconnect.")),this._subscribe(E,c,!0).catch(S=>{x.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=e,this._clientId=t||lr(5,"client-"),this.store=new class{constructor(c,u,f,g){jt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:f,clientId:g,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Lg.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,f){switch(f.type){case _n.SET_SESSION_ID:return dt(dt({},u),{},{sessionId:f.sessionId});case _n.SET_P2P_ID:return dt(dt({},u),{},{p2pId:f.p2pId});case _n.SET_UID:return dt(dt({},u),{},{uid:f.uid});case _n.SET_INT_UID:return dt(dt({},u),{},{intUid:f.intUid});case _n.SET_PUB_ID:return dt(dt({},u),{},{pubId:f.pubId});case _n.KEY_METRIC_CLIENT_CREATED:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{clientCreated:f.metric})});case _n.KEY_METRIC_JOIN_START:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{joinStart:f.metric})});case _n.KEY_METRIC_JOIN_END:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{joinEnd:f.metric})});case _n.KEY_METRIC_REQUEST_AP_START:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{requestAPStart:f.metric})});case _n.KEY_METRIC_REQUEST_AP_END:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{requestAPEnd:f.metric})});case _n.KEY_METRIC_JOIN_GATEWAY_START:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{joinGatewayStart:f.metric})});case _n.KEY_METRIC_JOIN_GATEWAY_END:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{joinGatewayEnd:f.metric})});case _n.KEY_METRIC_PEER_CONNECTION_START:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{peerConnectionStart:f.metric})});case _n.KEY_METRIC_PEER_CONNECTION_END:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{peerConnectionEnd:f.metric})});case _n.KEY_METRIC_DESCRIPTION_START:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{descriptionStart:f.metric})});case _n.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{signalChannelOpen:f.metric})});case _n.KEY_METRIC_ICE_CONNECTION_END:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{iceConnectionEnd:f.metric})});case _n.KEY_METRIC_PUBLISH:{const g=u.keyMetrics.publish,E=g.findIndex(v=>v.trackId===f.metric.trackId);return E!==-1?(g[E]=dt(dt({},g[E]),f.metric),dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{publish:[...g]})})):dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,f.metric]})})}case _n.KEY_METRIC_SUBSCRIBE:{const g=u.keyMetrics.subscribe,E=g.findIndex(v=>v.userId===f.metric.userId&&v.type===f.metric.type);return E!==-1?(g[E]=dt(dt({},g[E]),f.metric),dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{subscribe:[...g]})})):dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,f.metric]})})}case _n.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=f.mode,u;case _n.RECORD_JOIN_CHANNEL_SERVICE:return typeof f.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,f.record]:(u.joinChannelServiceRecords[f.index]=dt(dt({},u.joinChannelServiceRecords[f.index]),f.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case _n.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case _n.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case _n.SET_USE_P2P:return dt(dt({},u),{},{useP2P:f.val});case _n.SET_TRANSPORT_TYPE:return dt(dt({},u),{},{p2pTransport:f.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:_n.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:_n.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:_n.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:_n.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:_n.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:_n.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:_n.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:_n.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:_n.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:_n.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:_n.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:_n.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:_n.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:_n.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:_n.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:_n.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:_n.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:_n.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:_n.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:_n.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:_n.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,f,g){this.dispatch({type:_n.KEY_METRIC_PUBLISH,metric:dt(dt({trackId:c,type:u},f&&{publishStart:f}),g&&{publishEnd:g})})}subscribe(c,u,f,g,E,v,S){this.dispatch({type:_n.KEY_METRIC_SUBSCRIBE,metric:dt(dt(dt(dt(dt({userId:c,type:u},f&&{subscribeStart:f}),g&&{subscribeEnd:g}),E&&{firstFrame:E}),v&&{streamAdded:v}),S&&{firstDecoded:S})})}massSubscribe(c,u,f,g){c.forEach(E=>{this.dispatch({type:_n.KEY_METRIC_SUBSCRIBE,metric:dt(dt(dt({userId:E.userId,type:E.type},u&&{subscribeStart:u}),f&&{subscribeEnd:f}),g&&{firstFrame:g})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(f=>f.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:_n.RECORD_JOIN_CHANNEL_SERVICE,record:dt(dt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:_n.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:_n.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:_n.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Ps("client-leave",this._clientId),this._publishMutex=new Ps("client-publish",this._clientId),this._renewTokenMutex=new Ps("client-renewtoken",this._clientId),this._subscribeMutex=new Ps("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ac," build: ").concat(xk,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{Ek(e.clientRoleOptions),r=Object.assign({},e.clientRoleOptions)}catch(c){x.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new qb(this.store),this._statsCollector.onStatsException=(c,u,f)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(f)),this.safeEmit(hn.EXCEPTION,{code:c,msg:u,uid:f})},this._statsCollector.onUploadPublishDuration=(c,u,f,g)=>{const E=this._users.find(v=>v.uid===c);E&&vt.peerPublishStatus(this._sessionId,{subscribeElapse:g,audioPublishDuration:u,videoPublishDuration:f,peer:E._uintid})},this._statsCollector.onVideoCodecChanged=c=>{if(Z("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){const u=this.localTracks.find(f=>f instanceof gr);u&&u._saveEncodeBitrateRatio!==1&&u.setSaveEncodeBitrateRatio(c==="h264"?Z("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Ire(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Si,httpRetryConfig:e.httpRetryConfig||Si,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:r}),this._configDistribute=new Ure(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},Wh("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new Qb(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],f=arguments.length>6&&arguments[6]!==void 0&&arguments[6];qn("JOIN_GATEWAY_USE_443PORT_ONLY",u),qn("JOIN_GATEWAY_USE_DUAL_DOMAIN",f);const g=this._gateway.signal.websocket;return g instanceof h1&&(g.use443PortOnly=u,g.tryDoubleDomain=f),async function(E,v,S){TA.get(E)||TA.set(E,[]),bA.get(E)||bA.set(E,v),cu.get(E)||cu.set(E,0);const R=TA.get(E),I=bA.get(E);if(!R||!I)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(cu.get(E)===I){const G=bb();R.push(G),await G.promise}cu.set(E,cu.get(E)+1);for(var D=arguments.length,V=new Array(D>3?D-3:0),M=3;M<D;M++)V[M-3]=arguments[M];const j=await S(...V);return cu.set(E,cu.get(E)-1),cu.get(E)===I-1&&R.length>0&&(R[0].resolve(),R.shift()),cu.get(E)===0&&(TA.set(E,[]),bA.set(E,0),cu.set(E,0)),j}("client.join",Z("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,r,o,c)}async join(e,t,r,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const f=(OA||OA||(OA=(window.location.protocol.split(":")[0]||"").toUpperCase(),OA))==="HTTPS",g=K3()?window.isSecureContext:"Browser Not Support";(!K3()&&!f||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),vt.setAppId(e);try{if(!r&&r!==null)throw new Te(q.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&rs(r,"token",1,2047),rs(e,"appid",1,2047),$A(t),o&&JA(o),c&&rs(c,"optionalInfo",1,2047)}catch(M){throw vt.reportApiInvoke(kg(),{name:di.JOIN,options:[e,t,r,o],states:{isHttps:f,isSecureContext:g},tag:Hr.TRACER}).onError(M),M}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const M=new Te(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw vt.reportApiInvoke(kg(),{name:di.JOIN,options:[e,t,r,o],states:{isHttps:f,isSecureContext:g},tag:Hr.TRACER}).onError(M),M}this._gateway.state="CONNECTING";const E=await Y6({appId:e,cname:t,uid:o,stringUid:typeof o=="string"?o:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Te(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const v=(E==null?void 0:E.sid)||kg();x.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(u)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);const S=vt.reportApiInvoke(v,{id:this._clientId,name:di.JOIN,options:[e,t,r,o],states:{isHttps:f,isSecureContext:g},tag:Hr.TRACER}),R=Rl(Rl(Rl({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!E},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:Z("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(R.stringUid=o,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async M=>{const j=function(Ee){const _e=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),me=new Uint8Array(new ArrayBuffer(_e.length));for(let Ce=0;Ce<_e.length;Ce+=1)me[Ce]=_e.charCodeAt(Ce);return me}(),G=await window.crypto.subtle.importKey("spki",j,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),z=gk(M),ce=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},G,z);return function(Ee){let _e="";for(let me=0;me<Ee.length;me+=1)_e+=String.fromCharCode(Ee[me]);return window.btoa(_e)}(new Uint8Array(ce))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Te(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const M=new TextEncoder,j=Z("USE_PURE_ENCRYPTION_MASTER_KEY")?M.encode(R.appId+this._encryptionSecret+this._encryptionSecret):M.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(G,z,ce){const Ee=await window.crypto.subtle.importKey("raw",z,"PBKDF2",!1,["deriveBits","deriveKey"]),_e=G==="aes-128-gcm2"?128:256,me=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:i4,hash:"SHA-256",salt:ce},Ee,_e+rne);return new Uint8Array(me).subarray(_e/8)}(this._encryptionMode,j,Pg(this._encryptionSalt)),this._encryptDataStreamKey=await async function(G,z,ce){const Ee=await window.crypto.subtle.importKey("raw",z,"PBKDF2",!1,["deriveBits","deriveKey"]),_e=G==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:i4,hash:"SHA-256",salt:ce},Ee,{name:"AES-GCM",length:_e},!0,["encrypt","decrypt"])}(this._encryptionMode,j,Pg(this._encryptionSalt))}else g?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:R.stringUid});const I=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&I===this._sessionId&&vt.joinChannelTimeout(this._sessionId,5)},5e3);try{var D;let M;const j=R.cloudProxyServer;if(et(D=["proxy3","proxy4","proxy5"]).call(D,j)){const _e=Z("PROXY_SERVER_TYPE3");Array.isArray(_e)?R.proxyServer=_e[0]:R.proxyServer=_e}if(vt.setProxyServer(R.proxyServer),x.setProxyServer(R.proxyServer),this.store.requestAPStart(),E){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(E.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=E.intUid),M={gatewayInfo:E.ap.gatewayInfo},Z("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(E.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const _e=(await F9(E.ap.proxyInfo,E.ap.gatewayInfo.uid)).map(me=>({turnServerURL:me.address,tcpport:me.tcpport||_s.tcpport,udpport:me.udpport||_s.udpport,username:me.username||_s.username,password:me.password||_s.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:_e}}X6(E,R.stringUid)}else{if(R.stringUid&&!R.uid){let _e;[_e,M]=await nt.all([f6(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||Si,this.store),p6(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Si,!0,this.store)]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(_e)),R.uid=_e,M.gatewayInfo.uid=_e,M.gatewayInfo.res.uid=_e}else M=await p6(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Si,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Te(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(Ub.UPDATE_BITRATE_LIMIT,_e=>{this._p2pChannel.updateBitrateLimit(_e)}),this._configDistribute.on(Ub.UPDATE_CLIENT_ROLE_OPTIONS,_e=>{this._setClientRoleOptions(_e)})},0),this._key=r||e;const G=M.gatewayInfo,z=R.uid?R.uid:G.uid;this._joinInfo=Rl(Rl({},R),{},{cid:G.cid,uid:z,vid:G.vid,apResponse:G.res,apGatewayAddress:G.apGatewayAddress,uni_lbs_ip:G.uni_lbs_ip,gatewayAddrs:G.gatewayAddrs}),this.store.intUid=z,this.store.cid=G.cid;const ce=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Te(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(ce),this._appId=e,this._channelName=R.cname,this._uid=ce,this.store.uid=ce,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(fs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Ee=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(Ee)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),V=this,et(Bg).call(Bg,V)||Bg.push(V),this._cloudProxyServerMode==="disabled"&&In().supportWebCrypto&&Z("ENABLE_PRELOAD")&&V1(this._joinInfo),ce}catch(M){const j=Array.isArray(M)?M[0]:M;throw j&&j.code===q.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),j):x.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),j),j.code!==q.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(j),j}var V}_joinGateway(){if(!this._joinInfo||!this._key)throw new Te(q.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!Z("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(fs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const r=Bg.indexOf(t);r!==-1&&Bg.splice(r,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Fn.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Wy))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Te(q.INVALID_PARAMS,"param list is empty");const r=e;if(this._gateway.role==="audience")throw new Te(q.INVALID_OPERATION,"audience can not publish stream");for(const c of r){if(!(c instanceof Wy))throw new Te(q.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&t)throw new Te(q.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof gr&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(r),x.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw x.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){Jn(e.id,"id",0,65535,!0),Uh(e.ordered,"ordered"),rs(e.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new Te(q.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Te(q.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Z("FORCE_TURN")&&!Z("TURN_ENABLE_TCP")&&!Z("TURN_ENABLE_UDP"))throw new Te(q.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const r=function(c){return i6(c,!1)}(e),o=await this._p2pChannel.publishDataChannel([r]);if(o.length>0){if(typeof r._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Te(q.CREATE_DATACHANNEL_ERROR);try{await nt.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await r._waitTillOpen()}catch(c){if(c.code!==q.DISCONNECT_P2P)throw c}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r}catch(r){throw x.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Te(q.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Wy))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(o=>"".concat(o.getTrackId()," "))," "));const r=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(t);o&&await this._gateway.sendExtensionMessage(ni.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(t);o&&await this._gateway.unpublish(o,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw x.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{r&&r()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(r=>"".concat(r.id," "))," "));const t=await this._publishMutex.lock();try{const r=await this._p2pChannel.unpublishDataChannel(e);r&&await this._gateway.unpublishDataChannel(r),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(r){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),r.toString()),r}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof Af)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new Te(q.INVALID_REMOTE_USER,"user is not in the channel");e=o}return t==="datachannel"?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(ki(t,"mediaType",["audio","video"]),this.store.useP2P)throw new Te(q.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Te(q.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const r=t===lt.AUDIO,o=t===lt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:f,rtxSsrcId:g,cname:E,uint_id:v}=await this._gateway.presubscribe(e,t,!0);if(u==null)throw new Te(q.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(I=>I.uid===e);S||(S=new Af(e,v||e),S._is_pre_created=!0,this._users.push(S)),E&&(S._cname=E),S._uintid||(S._uintid=v||e),r&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,f&&(S._audioOrtc=f)),o&&(S._videoSSRC=u,S._video_pre_subscribed=!0,f&&(S._videoOrtc=f),g!=null&&(S._rtxSsrcId=g)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,t,u,g,f);const R=r?S._audioTrack:S._videoTrack;if(!R)throw new Te(q.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),R}catch(u){throw x.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,t){var r;if(Jn(t,"channelId",0,65535,!0),!this._joinInfo)throw new Te(q.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(g=>g===e))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Te(q.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Te(q.INVALID_REMOTE_USER,"user is not published");const c=(r=e._dataChannels)===null||r===void 0?void 0:r.find(g=>g.id===t);if(!c)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Te(q.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const g=await this._p2pChannel.subscribeDataChannel(e,[c]);if(g&&et(g).call(g,c.id))try{var f;if(typeof c._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Te(q.CREATE_DATACHANNEL_ERROR);const E={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(f=c.metadata)!==null&&f!==void 0?f:""};await this._gateway.subscribeDataChannel(e.uid,E,!0),await c._waitTillOpen()}catch(E){if((E==null?void 0:E.code)!==q.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),E;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,t,r){if(ki(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Te(q.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new Te(q.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new Te(q.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!r&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const u=new Te(q.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),u}const c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const f=t==="audio"?e._audioSSRC:e._videoSSRC,g=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,f,g)}catch(f){throw f}x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(f=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),f)});const u=t==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new Te(q.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,t,r){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(ki(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Te(q.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===e)){const v=new Te(q.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),v}if(!e.hasAudio&&!e.hasVideo){const v=new Te(q.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),v}if(!(r||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const v=new Te(q.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),v}let c=t==="audio"?e._audioSSRC:e._videoSSRC,u=t==="audio"?e._audioOrtc:e._videoOrtc,f=t==="video"?e._rtxSsrcId:void 0,g={stream_type:t==="audio"?lt.AUDIO:lt.VIDEO,ssrcId:c};const E=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const S=t==="audio"?e._audioSSRC:e._videoSSRC;S!==void 0&&S!==c&&(c=S,u=t==="audio"?e._audioOrtc:e._videoOrtc,f=t==="video"?e._rtxSsrcId:void 0,g={stream_type:t==="audio"?lt.AUDIO:lt.VIDEO,ssrcId:c}),Ms.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,c,f,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,g,!0)}catch(R){if((R==null?void 0:R.code)!==q.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),R;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,e,t),S}x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(S=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const v=t==="audio"?e._audioTrack:e._videoTrack;if(!v)throw new Te(q.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),v),v}finally{E()}}async massSubscribe(e){if(Vh(e,"subscribeList"),!this._joinInfo)throw new Te(q.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),r=new Map,o=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(g=>{let{user:E,mediaType:v}=g;return"user: ".concat(E==null?void 0:E.uid,", mediaType: ").concat(v)}).join("; ")));const c=(e=[...e]).map(g=>{let{user:E,mediaType:v}=g;return{user:E,mediaType:v}}),u=await this._p2pChannel.globalLock();try{var f;for(let E=e.length-1;E>=0;E--){const v=e[E],{user:S,mediaType:R}=v;if(ki(R,"mediaType",["audio","video"]),!S){const M=new Te(q.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),M}if(!this._users.find(M=>M===S)){const M=new Te(q.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[E].error=M,e.splice(E,1);continue}if(R==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||R==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const M=new Te(q.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(R,", remote user is not published")),c[E].error=M,e.splice(E,1);continue}const D=Hi.Video|Hi.LwoVideo,V=r.get(S);if(V){if(R==="video"?V&D:V&Hi.Audio){e.splice(E,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(R," twice"));continue}r.set(S,V|(R==="video"?D:Hi.Audio))}else r.set(S,R==="video"?D:Hi.Audio)}for(let E=e.length-1;E>=0;E--){const v=e[E],{user:S,mediaType:R}=v,I=Hi.Video|Hi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,R)){await this._p2pChannel.unmuteRemoteNoLock(S,R);const D=r.get(S);r.set(S,R==="video"?D^I:D^Hi.Audio),e.splice(E,1)}}this.store.massSubscribe(e.map(E=>({userId:E.user.uid,type:E.mediaType})),t);let g=Xa(f=Array.from(r.entries())).call(f,(E,v)=>{let[S,R]=v;if(R===0)return E;const I={stream_id:S.uid,stream_type:R};return R&Hi.Audio&&(I.audio_ssrc=S._audioSSRC),R&Hi.Video&&(I.video_ssrc=S._videoSSRC),E.push(I),E},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(v=>{let{user:S,mediaType:R}=v;return{user:S,mediaType:R,ssrcId:R===lt.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:R===lt.VIDEO?S._rtxSsrcId:void 0}}));const E=new Map;if(g=g.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),g.length>0){const v=await this._gateway.subscribeAll(g,!0);((v==null?void 0:v.users)||[]).forEach(S=>{let{stream_id:R,video_error_code:I,audio_error_code:D,error_code:V}=S;(I||D||V)&&E.set(R,{video_error_code:I,audio_error_code:D,error_code:V})})}if(Array.from(E.entries()).length>0){const v=[];Array.from(E.entries()).forEach(S=>{let[R,I]=S;const D=this.remoteUsers.find(V=>V.uid===R);if(D){let V;I.error_code||I.video_error_code&&I.audio_error_code?V=void 0:I.video_error_code?V=lt.VIDEO:I.audio_error_code&&(V=lt.AUDIO),v.push({user:D,mediaType:V})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const S=E.get(v.user.uid);if(S){const R=S.error_code||v.mediaType==="audio"&&S.audio_error_code||v.mediaType==="video"&&S.video_error_code;if(R){const I=Vb(R);x.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(I.desc)),v.error=new Te(q.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(I.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var S;vt.subscribe(this.store.sessionId,{succ:!!v.error,ec:((S=v.error)===null||S===void 0?void 0:S.code)||null,video:v.mediaType===lt.VIDEO,audio:v.mediaType===lt.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===lt.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(v=>{let{user:S,mediaType:R}=v;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(E){throw await this._p2pChannel.massUnsubscribeNoLock(e),E}}finally{u(),o()}}async unsubscribe(e,t,r){if(!(e instanceof Af)){const u=this.remoteUsers.find(f=>f.uid===e);if(!u)throw new Te(q.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&ki(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Te(q.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new Te(q.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const u=await this._p2pChannel.unsubscribe(e,t);u&&await this._gateway.unsubscribe(u,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&AA(this._users,e),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(u){if(u.code===q.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,t){if(t&&Jn(t,"id",0,65535,!0),!this._joinInfo)throw new Te(q.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new Te(q.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let o;if(typeof t=="number"){const c=e._dataChannels.find(u=>u.id===t);c&&(o=[c])}else o=e._dataChannels;if(o===void 0){const c=new Te(q.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),c}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,o);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===q.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(Vh(e,"unsubscribeList"),!this._joinInfo)throw new Te(q.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(r=>{let{user:o,mediaType:c}=r;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const t=new Map;for(let r=e.length-1;r>=0;r--){const{user:o,mediaType:c}=e[r];if(!o){const g=new Te(q.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),g}if(ki(c,"mediaType",["video","audio",void 0]),!this._users.find(g=>g===o)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(r,1);continue}const f=Hi.Video|Hi.LwoVideo;if(t.has(o)){const g=t.get(o);let E;switch(c){case"video":E=g&f;break;case"audio":E=g&Hi.Audio;break;default:E=g&(Hi.Audio|f)}if(E){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(r,1);continue}c?c==="audio"?t.set(o,g|Hi.Audio):c==="video"&&t.set(o,g|f):t.set(o,g|Hi.Audio|f)}else c?c==="audio"?t.set(o,Hi.Audio):c==="video"&&t.set(o,f):t.set(o,Hi.Audio|f)}try{const r=await this._p2pChannel.massUnsubscribe(e);r&&await this._gateway.massUnsubscribe(r),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(r){if(r.code===q.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),r.toString()),r}}async setLowStreamParameter(e){(function(r){if(!r)throw new Ae(q.INVALID_PARAMS);Br(r.width)||fk(r.width,"streamParameter.width"),Br(r.height)||fk(r.height,"streamParameter.height"),Br(r.framerate)||fk(r.framerate,"streamParameter.framerate"),Br(r.bitrate)||Jn(r.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Ve.LocalVideoLowTrack)}async enableDualStream(){if(!In().supportDualStream)throw vt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Te(q.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Te(q.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw vt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,vt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Te(q.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ve.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw vt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,vt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(o){ki(o,"role",["audience","host"])}(e),t&&Ek(t),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Te(q.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new Te(q.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Te(q.INVALID_OPERATION,"can not set client role to audience when publishing stream");const r=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==r&&Z("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",ms.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),x.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&Ek(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(rs(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new Te(q.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Te(q.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,vt.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new Te(q.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Te(q.INVALID_OPERATION,"You have already set the proxy")}if(Ib(e))return this._turnServer={servers:e,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(r=>r.urls).join(","),"."));e.forEach(r=>M3(r)),this._turnServer={servers:e,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Te(q.INVALID_OPERATION,"you should set license before join channel");if(rs(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Te(q.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,x.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Te(q.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Te(q.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let r;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Te(q.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r="proxy3";break;case 4:r="proxy4";break;case 5:r="proxy5";break;default:throw new Te(q.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=r,this.store.cloudProxyServerMode=r,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Te(q.INVALID_OPERATION,"Stop proxy server after leave channel");vt.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Te(q.INVALID_PARAMS,"accessPoints is required.");Vh(e.accessPoints.serverList,"accessPoints.serverList"),rs(e.accessPoints.domain,"accessPoints.domain");const t=(I,D)=>{Jn(I,D,0,65535,!0)};let r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Te(q.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");Z("CLOSE_AFB_FOR_LOCAL_AP")&&(qn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),qn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(I=>o.test(I)?"".concat(I.replace(/\./g,"-"),".").concat(c):I),f=u.map(I=>"".concat(I,":").concat(r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,qn("WEBCS_DOMAIN",f),qn("WEBCS_DOMAIN_BACKUP_LIST",f),qn("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Vh(e.report.hostname,"report.hostname"),qn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),qn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(qn("EVENT_REPORT_DOMAIN",u[0]),qn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let g=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),g=e.report.port),qn("STATS_COLLECTOR_PORT",g),e.report?qn("ENABLE_EVENT_REPORT",!0):qn("ENABLE_EVENT_REPORT",!1);let E="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Vh(e.log.hostname,"log.hostname"),E=e.log.hostname[0]):E=u[0];let v=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),v=e.log.port),qn("LOG_UPLOAD_SERVER","".concat(E,":").concat(v));let S=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Vh(e.cds.hostname,"cds.hostname"),S=e.cds.hostname):S=u;let R=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),R=e.cds.port),qn("CDS_AP",S.map(I=>"".concat(I,":").concat(R))),e.cds?qn("ENABLE_CONFIG_DISTRIBUTE",!0):qn("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Vh(e,"serverList"),rs(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Te(q.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>r.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(t):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,qn("WEBCS_DOMAIN",e),qn("WEBCS_DOMAIN_BACKUP_LIST",e),qn("GATEWAY_DOMAINS",[t]),qn("EVENT_REPORT_DOMAIN",e[0]),qn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),qn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(ki(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){ki(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const r=this._users.find(o=>o.uid===e);r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(r){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),r.toString()),r}x.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){ki(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(r){throw x.error("[".concat(this._clientId,"] set stream fallback option"),r.toString()),r}x.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,o){(function(u){ki(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),rs(t,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(et(c).call(c,e)){if(!r||!(r instanceof Uint8Array&&r.length===32))throw new Te(q.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new Te(q.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(Uh(o,"encryptDataStream"),!et(c).call(c,e))throw new Te(q.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=yf(r))}async renewToken(e){if(rs(e,"token",1,2047),!this._key||!this._joinInfo)throw new Te(q.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const r=await this._renewTokenMutex.lock();try{if(Z("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await jre(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Si);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=t,this._joinInfo.token=t,x.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(hn.VOLUME_INDICATOR,e)},Z("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new Te(q.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Te(q.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Te(q.LIVE_STREAMING_TASK_CONFLICT);const r=t?Bh.TRANSCODE:Bh.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(Bh.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(r=>r&&r.hasUrl(e));if(!t.length)throw new Te(q.INVALID_PARAMS,"can not find live streaming url to stop");await nt.all(t.map(r=>r&&r.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){S6(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){S6(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Qb&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Te(q.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&et(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(o=!0,e.payload=await async function(c,u,f){var g;const E=Xa(g=Array.from(f)).call(g,(M,j)=>M+j,0),v={serverTs:0,seq:ine++,length:f.length,checkSum:E},S=new Uint8Array(W3(E,2)),R=new ArrayBuffer(jy),I=new DataView(R);I.setUint32(0,v.serverTs),I.setUint16(4,v.seq),I.setUint16(6,v.length),I.setUint16(8,v.checkSum);const D=16-f.length%16;f=V3(f,new Uint8Array(D));const V=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:r4,additionalData:S},u,f);return V3(new Uint8Array(R),new Uint8Array(V))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Te(q.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(xt.DATA_STREAM,{payload:yf(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Yre},!r)}sendMetadata(e){if(!this._joinInfo)throw new Te(q.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Te(q.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(xt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:yf(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(pne),!this._joinInfo)throw new Te(q.INVALID_OPERATION,"can not send custom report, not joined");await vt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){ki(t.spatialLayer,"spatialLayer",[0,1,2,3]),ki(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(r){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),r.toString()),r}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:r}=e;if(Uh(t,"apRTM"),Jn(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(e){const t=Qy.indexOf(e);t!==-1&&Qy.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=xa.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&K6(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&vt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ps("client-publish",this._clientId),this._subscribeMutex=new Ps("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var r;const o=e||kg();e?x.debug("[".concat(this._clientId,"] new Session ").concat(o)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,vt.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((r=this._joinInfo)===null||r===void 0?void 0:r.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};vt.sessionInit(this._sessionId,Rl({cname:t.channel,appid:t.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Te(q.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Z("FORCE_TURN")&&!Z("TURN_ENABLE_TCP")&&!Z("TURN_ENABLE_UDP"))throw new Te(q.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await r.next()).value;if(o){try{await this._gateway.sendExtensionMessage(ni.PUBLISH,o,!0)}catch(c){throw r.throw(c),c}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await r.next()).value;if(o){var t;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==q.DISCONNECT_P2P)throw r.throw(u),u}await r.next(((t=c)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof gr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,e),(r==null?void 0:r.code)===q.WS_ABORT)return;throw r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Te(q.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(q.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await r.next()).value;if(o){var t;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==q.DISCONNECT_P2P)throw r.throw(u),u}r.next(((t=c)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,void 0,!0),(r==null?void 0:r.code)===q.WS_ABORT)return;throw r}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new Te(q.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Wh("LiveStreaming").create(o));var o;return r.onLiveStreamError=(c,u)=>{vt.reportApiInvoke(this._sessionId,{name:di.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Hr.TRACER}).onSuccess(),this.safeEmit(hn.LIVE_STREAMING_ERROR,c,u)},r.onLiveStreamWarning=(c,u)=>{vt.reportApiInvoke(this._sessionId,{name:di.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Hr.TRACER}).onSuccess(),this.safeEmit(hn.LIVE_STREAMING_WARNING,c,u)},r.on(l1.REQUEST_WORKER_MANAGER_LIST,(c,u,f)=>{if(!this._joinInfo)return f(new Te(q.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(g,E,v,S){const R=Z("UAP_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(I=>E.proxyServer?"https://".concat(E.proxyServer,"/ap/?url=").concat(I+"/api/v1?action=uap"):"https://".concat(I,"/api/v1?action=uap"));return await Dre(R,g,E,v,S)})(c,this._joinInfo,this._axiosCancelSource.token,Si).then(u).catch(f)}),r};return e===Bh.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Te(q.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:r}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:r}},Wh("ChannelMediaRelay").create(e));o.on("state",c=>{c===no.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(hn.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(hn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var f;c==="resolution"&&((f=this._channelMediaRelayClient)===null||f===void 0||f.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:r,deleted:o}=e,c=[];if(t){const u=[];this._users.forEach(f=>{f._dataChannels.forEach(g=>{r.every(E=>E.uid!==f._uintid||E.stream_id!==g.id)&&u.push({uid:f._uintid,stream_id:g.id,ordered:g.ordered,max_retrans_times:g.maxRetransmits,metadata:g.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(r)&&r.length>0&&r.forEach(u=>{const{uid:f,stream_id:g,ordered:E,max_retrans_times:v,metadata:S}=u,R=this._users.find(I=>I._uintid===f);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(f)),et(c).call(c,R)||c.push(R),R._uintid||(R._uintid=f),R._dataChannels.findIndex(I=>I.id===u.stream_id)===-1){const I={id:g,ordered:!!E,maxRetransmits:v,metadata:S},D=function(V){return i6(V,!0)}(I);R._dataChannels.push(D),x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),t||this.safeEmit(hn.USER_PUBLISHED,R,"datachannel",I)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(I=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),I.toString())}))}),t&&(this.safeEmit(hn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:f,stream_id:g}=u,E=this._users.find(S=>S._uintid===f);if(!E)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=E._dataChannels.find(S=>S.id===u.stream_id);v&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(f)),this._p2pChannel.unsubscribeDataChannel(E,[v]).then(S=>{if(E._dataChannels=E._dataChannels.filter(R=>R!==v),S)return this._gateway.unsubscribeDataChannel(S,E.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(f," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(hn.USER_UNPUBLISHED,E,"datachannel",v._config))})}_handleRemoveDataChannels(e){const t=this._users.find(r=>r.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const r=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(o=>{this.safeEmit(hn.USER_UNPUBLISHED,t,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,t.uid)}),r()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Ki.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void x.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),r=Date.now();Object.keys(t).forEach(o=>{const{value:c,type:u,expires:f}=t[o];f&&f<=r||u||n1()||!Object.prototype.hasOwnProperty.call(PA,o)||(dd[o]=c,Sr[o]=c,x.debug("Update gateway parameters from config distribute",o,c))})}catch(t){x.error("Error update config from local cache",t.message)}})()}),this._gateway.on(Ki.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Ki.CONNECTION_STATE_CHANGE,(e,t,r)=>{var o;if(r===Fn.FALLBACK)return;const c=()=>{this.safeEmit(hn.CONNECTION_STATE_CHANGE,e,t,r)};if(vt.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:di.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:Hr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(f=>{f._trust_in_room_=!1,f._trust_audio_enabled_state_=!1,f._trust_video_enabled_state_=!1,f._trust_audio_mute_state_=!1,f._trust_video_mute_state_=!1,f._trust_audio_stream_added_state_=!1,f._trust_video_stream_added_state_=!1,f._is_pre_created||(f._audio_pre_subscribed||(f._audioSSRC=void 0,f._audioOrtc=void 0),f._video_pre_subscribed||(f._videoSSRC=void 0,f._videoOrtc=void 0,f._rtxSsrcId=void 0),f._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((f,g)=>{this._gateway.setStreamFallbackOption(g,f).catch(E=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),E)})}),this._remoteStreamTypeCacheMap.forEach((f,g)=>{this._gateway.setRemoteVideoStreamType(g,f).catch(E=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),E)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(f=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(f))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(f=>!f._trust_in_room_).forEach(f=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(f.uid)),this._handleUserOffline({uid:f.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(f=>{f._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(f.uid)),this._handleMuteStream(f.uid,lt.AUDIO,!1)),f._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(f.uid)),this._handleMuteStream(f.uid,lt.VIDEO,!1)),f._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(f.uid)),this._handleSetStreamLocalEnable("audio",f.uid,!0)),f._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(f.uid)),this._handleSetStreamLocalEnable("video",f.uid,!0)),f._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(f.uid)),this._handleResetAddStream(f,"video")),f._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(f.uid)),this._handleResetAddStream(f,"audio")),f._video_added_||f._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(f.uid)),this._handleRemoveStream({uid:f.uid,uint_id:f._uintid}))}))},1e3))}c()}),this._gateway.on(Ki.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new Te(q.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r;const o=await Y6(Rl(Rl({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(r=o.ap,X6(o),this._joinInfo.preload=!0):(r=await C1(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Si,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=r.gatewayInfo.res,this._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);const c=[];r.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:f}=u;const[g,E]=f.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:g,port:E}):c.push({host:g,port:E})}),e(c)}catch(r){t(r)}}),this._gateway.on(Ki.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(hn.NETWORK_QUALITY,e)}),this._gateway.on(Ki.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(hn.STREAM_TYPE_CHANGED,e,t),vt.reportApiInvoke(this._sessionId,{name:di.STREAM_TYPE_CHANGE,options:[e,t],tag:Hr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(Ki.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Ki.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,r)=>{try{let o=await this._p2pChannel.getEstablishParams();Z("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),t(o)}catch(o){r(o)}}),this._gateway.on(Ki.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let r;e.attributes?r=e.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const o=Y9(e.ortc,t,r);this._p2pChannel.connect(o)}),this._gateway.on(Ki.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=Z("FINGERPRINT"))!==null&&o!==void 0?o:r}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(fn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(fn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(fn.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(fn.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(fn.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(fn.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(fn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(fn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(fn.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,lt.AUDIO,!0)),this._gateway.signal.on(fn.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,lt.AUDIO,!1)),this._gateway.signal.on(fn.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,lt.VIDEO,!0)),this._gateway.signal.on(fn.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,lt.VIDEO,!1)),this._gateway.signal.on(fn.RECEIVE_METADATA,e=>{const t=Pg(e.metadata);this.safeEmit(hn.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(fn.ON_DATA_STREAM,async e=>{var t;if(!e)return;let r=Pg(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&et(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<jy)throw new Te(q.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(jy));r=await async function(u,f,g){const E=g.subarray(0,jy),v=E.slice(8,jy),S=(v[0]<<8)+v[1],R=(E[6]<<8)+E[7],I=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:r4,additionalData:new Uint8Array(W3(S,2))},f,g.subarray(jy));return new Uint8Array(I).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let o=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(g=>g.uid===e.uid),f=c==null?void 0:c.audioRecv.find(g=>g.ssrc===(u==null?void 0:u._audioSSRC));o=f==null?void 0:f.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),Kre(Rl(Rl({},e),{},{payload:r}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(fn.ON_CRYPT_ERROR,()=>{Ef(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(hn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(fn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(fn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Fn.TOKEN_EXPIRE),this.safeEmit(hn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(fn.ON_STREAM_FALLBACK_UPDATE,e=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(hn.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(fn.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(fn.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(fn.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Lt.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case xt.PUBLISH:{if(!t)return;const c=t.ortc;if(c){var r,o;const u=c.some(E=>{let{stream_type:v}=E;return v===Hn.Audio}),f=c.some(E=>{let{stream_type:v}=E;return v!==Hn.Audio}),g=c.some(E=>{let{stream_type:v}=E;return v===Hn.Screen||v===Hn.ScreenLow});t.state==="offer"&&vt.publish(this._joinInfo.sid,{eventElapse:Ms.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:q.TIMEOUT,audio:u,video:f,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:g,audioName:u?(r=c.find(E=>{let{stream_type:v}=E;return v===Hn.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:f?(o=c.find(E=>{let{stream_type:v}=E;return v!==Hn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case xt.SUBSCRIBE:t&&vt.subscribe(this._joinInfo.sid,{succ:!1,ec:q.TIMEOUT,audio:t.stream_type===lt.AUDIO,video:t.stream_type===lt.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Ms.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(fn.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(fn.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;Z("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!Hg(o.string_id||o.stream_id,this.channelName)));const t=[],r=[];for(const o of e.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Af(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(hn.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(hn.USER_JOINED,c)));const u=Hi.Audio&o.stream_type,f=(Hi.Video|Hi.LwoVideo)&o.stream_type,g=(65280&o.stream_type)!=0,E=u&&c.hasAudio,v=f&&c.hasVideo;f&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!E&&this.getListeners(hn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(hn.USER_PUBLISHED,c,"audio")),f&&!v&&this.getListeners(hn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(hn.USER_PUBLISHED,c,"video")),(u&&!E||f&&!v||g)&&t.push(c),f&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&r.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&r.push({user:c,mediaType:"audio"})}r.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(r).catch(o=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(hn.PUBLISHED_USER_LIST).length>0?Z("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(o=>o.uid).join(", "))),this.safeEmit(hn.PUBLISHED_USER_LIST,t)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(fn.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof Qb&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(r=>r.toLowerCase()).filter(r=>{var o;return et(o=Object.keys(kA)).call(o,r)}))})}_handleP2PEvents(){this._gateway.signal.on(fn.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(ni.PUBLISH,(e,t,r)=>{const{uid:o}=e;e.forEach(c=>{const{kind:u,ssrcs:f,mid:g,isMuted:E}=c;this._handleP2PAddAudioOrVideoStream(u,o,f[0].ssrcId,g);const v=this._users.find(S=>S.uid===o);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,u,f[0].ssrcId,g).then(()=>{t()}).catch(r):t(),this._handleMuteStream(o,u,!!E)})}),this._gateway.signal.on(ni.CALL,async(e,t,r)=>{if(this.store.useP2P)try{var o;t(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){r(c)}}),this._gateway.signal.on(Lt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(ni.UNPUBLISH,async(e,t,r)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=e,u=this._users.find(f=>f.uid===c);if(!u)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void t();try{o.forEach(async f=>{let{stream_type:g}=f;const E=g===Hn.Audio?lt.AUDIO:lt.VIDEO;await this._p2pChannel.unsubscribe(u,E),this._handleMuteStream(c,E,!0)}),t()}catch(f){r(f)}}}),this._gateway.signal.on(ni.CONTROL,async(e,t)=>{const{action:r}=e;switch(r){case Tf.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,lt.VIDEO,!0);break;case Tf.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,lt.AUDIO,!0);break;case Tf.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,lt.VIDEO,!1);break;case Tf.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,lt.AUDIO,!1)}}),this._gateway.signal.on(ni.RESTART_ICE,async(e,t,r)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=e;o!==Ea.SEND_ONLY||c?t(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),t())}catch(o){r(o)}}),this._gateway.signal.on(ni.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}}),this._p2pChannel.on(Rt.RequestP2PRestartICE,async(e,t,r)=>{try{const{direction:o}=e;t(await this._gateway.sendExtensionMessage(ni.RESTART_ICE,e,o===Ea.SEND_ONLY))}catch(o){r(o)}}),this._p2pChannel.on(Rt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(ni.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Rt.RequestP2PMuteLocal,async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(ni.CONTROL,e,!0),t()}catch(o){r(o)}}),this._p2pChannel.on(Rt.RequestP2PUnmuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===q.DISCONNECT_P2P?t():r(o)}else t()}),this._p2pChannel.on(Rt.RequestP2PMuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===q.DISCONNECT_P2P?t():r(o)}else t()}),this._p2pChannel.on(Rt.StateChange,(e,t)=>{t===Bn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Rt.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(hn.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Rt.RequestMuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===q.DISCONNECT_P2P?t():r(o)}else t()}),this._p2pChannel.on(Rt.RequestUnmuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===q.DISCONNECT_P2P?t():r(o)}else t()}),this._p2pChannel.on(Rt.RequestRePublish,(e,t,r)=>{this.publish(e,!1).then(t).catch(r)}),this._p2pChannel.on(Rt.RequestRePublishDataChannel,(e,t,r)=>{nt.all(e.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==q.DISCONNECT_P2P)throw u}})).then(t).catch(r)}),this._p2pChannel.on(Rt.RequestReSubscribe,async(e,t,r)=>{try{for(const{user:o,kind:c}of e)c===lt.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");t()}catch(o){r(o)}}),this._p2pChannel.on(Rt.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Rt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Rt.MediaReconnectStart,e=>{this.safeEmit(hn.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Rt.MediaReconnectEnd,e=>{this.safeEmit(hn.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Rt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Rt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),r=await t.next();if(r.done)return;const o=r.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(f){return void t.throw(f)}const{iceParameters:u}=function(f){const g=f.iceParameters;return{iceParameters:{iceUfrag:g.iceUfrag,icePwd:g.icePwd}}}(c);await t.next({remoteIceParameters:u})}),this._p2pChannel.on(Rt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Rt.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:r,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:o}),f=Y9(c,u);await this._p2pChannel.connect(f),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Rt.RequestUnpublishForReconnectPC,async(e,t,r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):r()}),this._p2pChannel.on(Rt.P2PLost,()=>{this.safeEmit(hn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Rt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Rt.ConnectionTypeChange,e=>{this.safeEmit(hn.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Rt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Rt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Rt.AudioMetadata,e=>{this.safeEmit(hn.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Te(q.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Te(q.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const r=(t={config:e},Wh("ContentInspect").create(t));this._inspect=r,this.handleVideoInspectEvents(r);const{appId:o,cname:c,sid:u,token:f,uid:g,cid:E,vid:v}=this._joinInfo;await r.init({appId:o,areaCode:"",cname:c,sid:u,token:f,uid:g,cid:E,vid:v?Number(v):0},Si)}catch(r){throw Array.isArray(r)?r[0]:r}var t}handleVideoInspectEvents(e){e.on(Xi.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(hn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===vl.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(hn.CONTENT_INSPECT_ERROR,new Te(q.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Xi.INSPECT_RESULT,(t,r)=>{var o;if((r==null?void 0:r.code)===q.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(hn.CONTENT_INSPECT_RESULT,t,r)}),e.on(Xi.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Te(q.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Uh(e,"enabled"),e){if(!t)throw new Te(q.INVALID_PARAMS,"config is required");if(cH(t),!this._joinInfo)throw new Te(q.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const o=(r={config:t},Wh("ImageModeration").create(r));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:f,token:g,uid:E,cid:v,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:f,token:g,uid:E,cid:v,vid:S?Number(S):0},Si)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var r;if(!this._moderation)throw new Te(q.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(pd.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(hn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===Oc.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Te(q.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(pd.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){ki(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Te(q.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Uh(e,"enabled"),qn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},_t(st.prototype,"leave",[lH],Object.getOwnPropertyDescriptor(st.prototype,"leave"),st.prototype),_t(st.prototype,"publish",[dH],Object.getOwnPropertyDescriptor(st.prototype,"publish"),st.prototype),_t(st.prototype,"unpublish",[uH],Object.getOwnPropertyDescriptor(st.prototype,"unpublish"),st.prototype),_t(st.prototype,"subscribe",[hH],Object.getOwnPropertyDescriptor(st.prototype,"subscribe"),st.prototype),_t(st.prototype,"presubscribe",[pH],Object.getOwnPropertyDescriptor(st.prototype,"presubscribe"),st.prototype),_t(st.prototype,"massSubscribe",[fH],Object.getOwnPropertyDescriptor(st.prototype,"massSubscribe"),st.prototype),_t(st.prototype,"unsubscribe",[mH],Object.getOwnPropertyDescriptor(st.prototype,"unsubscribe"),st.prototype),_t(st.prototype,"massUnsubscribe",[gH],Object.getOwnPropertyDescriptor(st.prototype,"massUnsubscribe"),st.prototype),_t(st.prototype,"setLowStreamParameter",[_H],Object.getOwnPropertyDescriptor(st.prototype,"setLowStreamParameter"),st.prototype),_t(st.prototype,"enableDualStream",[EH],Object.getOwnPropertyDescriptor(st.prototype,"enableDualStream"),st.prototype),_t(st.prototype,"disableDualStream",[yH],Object.getOwnPropertyDescriptor(st.prototype,"disableDualStream"),st.prototype),_t(st.prototype,"setClientRole",[vH],Object.getOwnPropertyDescriptor(st.prototype,"setClientRole"),st.prototype),_t(st.prototype,"_setClientRoleOptions",[SH],Object.getOwnPropertyDescriptor(st.prototype,"_setClientRoleOptions"),st.prototype),_t(st.prototype,"setProxyServer",[TH],Object.getOwnPropertyDescriptor(st.prototype,"setProxyServer"),st.prototype),_t(st.prototype,"setTurnServer",[bH],Object.getOwnPropertyDescriptor(st.prototype,"setTurnServer"),st.prototype),_t(st.prototype,"setLicense",[wH],Object.getOwnPropertyDescriptor(st.prototype,"setLicense"),st.prototype),_t(st.prototype,"startProxyServer",[RH],Object.getOwnPropertyDescriptor(st.prototype,"startProxyServer"),st.prototype),_t(st.prototype,"stopProxyServer",[CH],Object.getOwnPropertyDescriptor(st.prototype,"stopProxyServer"),st.prototype),_t(st.prototype,"setLocalAccessPointsV2",[AH],Object.getOwnPropertyDescriptor(st.prototype,"setLocalAccessPointsV2"),st.prototype),_t(st.prototype,"setLocalAccessPoints",[IH],Object.getOwnPropertyDescriptor(st.prototype,"setLocalAccessPoints"),st.prototype),_t(st.prototype,"setRemoteDefaultVideoStreamType",[NH],Object.getOwnPropertyDescriptor(st.prototype,"setRemoteDefaultVideoStreamType"),st.prototype),_t(st.prototype,"setRemoteVideoStreamType",[OH],Object.getOwnPropertyDescriptor(st.prototype,"setRemoteVideoStreamType"),st.prototype),_t(st.prototype,"setStreamFallbackOption",[DH],Object.getOwnPropertyDescriptor(st.prototype,"setStreamFallbackOption"),st.prototype),_t(st.prototype,"setEncryptionConfig",[xH],Object.getOwnPropertyDescriptor(st.prototype,"setEncryptionConfig"),st.prototype),_t(st.prototype,"renewToken",[PH],Object.getOwnPropertyDescriptor(st.prototype,"renewToken"),st.prototype),_t(st.prototype,"enableAudioVolumeIndicator",[kH],Object.getOwnPropertyDescriptor(st.prototype,"enableAudioVolumeIndicator"),st.prototype),_t(st.prototype,"startLiveStreaming",[LH],Object.getOwnPropertyDescriptor(st.prototype,"startLiveStreaming"),st.prototype),_t(st.prototype,"setLiveTranscoding",[MH],Object.getOwnPropertyDescriptor(st.prototype,"setLiveTranscoding"),st.prototype),_t(st.prototype,"stopLiveStreaming",[jH],Object.getOwnPropertyDescriptor(st.prototype,"stopLiveStreaming"),st.prototype),_t(st.prototype,"startChannelMediaRelay",[UH],Object.getOwnPropertyDescriptor(st.prototype,"startChannelMediaRelay"),st.prototype),_t(st.prototype,"updateChannelMediaRelay",[VH],Object.getOwnPropertyDescriptor(st.prototype,"updateChannelMediaRelay"),st.prototype),_t(st.prototype,"stopChannelMediaRelay",[FH],Object.getOwnPropertyDescriptor(st.prototype,"stopChannelMediaRelay"),st.prototype),_t(st.prototype,"sendCustomReportMessage",[BH],Object.getOwnPropertyDescriptor(st.prototype,"sendCustomReportMessage"),st.prototype),_t(st.prototype,"pickSVCLayer",[HH],Object.getOwnPropertyDescriptor(st.prototype,"pickSVCLayer"),st.prototype),_t(st.prototype,"setRTMConfig",[GH],Object.getOwnPropertyDescriptor(st.prototype,"setRTMConfig"),st.prototype),_t(st.prototype,"enableContentInspect",[WH],Object.getOwnPropertyDescriptor(st.prototype,"enableContentInspect"),st.prototype),_t(st.prototype,"disableContentInspect",[zH],Object.getOwnPropertyDescriptor(st.prototype,"disableContentInspect"),st.prototype),_t(st.prototype,"setImageModeration",[YH],Object.getOwnPropertyDescriptor(st.prototype,"setImageModeration"),st.prototype),_t(st.prototype,"setP2PTransport",[qH],Object.getOwnPropertyDescriptor(st.prototype,"setP2PTransport"),st.prototype),_t(st.prototype,"getJoinChannelServiceRecords",[KH],Object.getOwnPropertyDescriptor(st.prototype,"getJoinChannelServiceRecords"),st.prototype),_t(st.prototype,"setPublishAudioFilterEnabled",[XH],Object.getOwnPropertyDescriptor(st.prototype,"setPublishAudioFilterEnabled"),st.prototype),st);class Zb{constructor(t,r){H(this,"id",0),H(this,"element",void 0),H(this,"peerPair",void 0),H(this,"context",void 0),H(this,"audioPlayerElement",void 0),H(this,"audioTrack",void 0),Zb.count+=1,this.id=Zb.count,this.element=t,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const r=document.createElement("audio");r.srcObject=new MediaStream([t.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;const t=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new nt(f=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&f(o.localDescription)}})},r=async(o,c)=>await o.setRemoteDescription(c);try{const o=await t(this.peerPair[0],"offer");await r(this.peerPair[1],o);const c=await t(this.peerPair[1],"answer");await r(this.peerPair[0],c)}catch(o){throw new Te(q.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let r;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(r)}catch(c){throw new Te(q.LOCAL_AEC_ERROR,c.toString()).print()}if(!r)throw new Te(q.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=r.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,r=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var $H,wI;H(Zb,"count",0);const uie=window.AudioContext||window.webkitAudioContext,hie=new($H=Nt({report:vt}),_t((wI=class{constructor(){H(this,"units",[]),H(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new uie);let t=this.units.find(r=>r&&r.getElement()===e);return t||(t=new Zb(e,this.context),this.units.push(t)),t.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return An().name!==Un.SAFARI}}).prototype,"processExternalMediaAEC",[$H],Object.getOwnPropertyDescriptor(wI.prototype,"processExternalMediaAEC"),wI.prototype),wI);function JH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function ZH(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?JH(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):JH(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const H1=window||document;function eG(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!H1)return;const r=Ti._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);const o=c=>{if(!(c&&c.blockedURI&&(Ti.onSecurityPolicyViolation||Ti.getListeners(fu.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;Z("CSP_DETECTED_HOSTNAME_LIST").some(f=>et(u).call(u,f))&&(Ti.onSecurityPolicyViolation&&typeof Ti.onSecurityPolicyViolation=="function"&&Ti.onSecurityPolicyViolation(c),Ti.getListeners(fu.SECURITY_POLICY_VIOLATION).length>0&&Ti.safeEmit(fu.SECURITY_POLICY_VIOLATION,c))};r&&H1.removeEventListener("securitypolicyviolation",r),(t||e&&typeof e=="function"||Ti.getListeners(fu.SECURITY_POLICY_VIOLATION).length>0)&&H1.addEventListener("securitypolicyviolation",o),Ti._cspEventHandlerPointer=o}var pie=U,fie=UB,tG=RegExp.prototype,mie=function(e){return e===tG||pie(tG,e)?fie(e):e.flags},ca=l(mie);function dv(e){let t=e.length;for(;--t>=0;)e[t]=0}const G1=256,nG=286,ew=30,tw=15,W1=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),RI=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),gie=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),rG=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Yh=new Array(576);dv(Yh);const nw=new Array(60);dv(nw);const rw=new Array(512);dv(rw);const iw=new Array(256);dv(iw);const z1=new Array(29);dv(z1);const CI=new Array(ew);function Y1(e,t,r,o,c){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let iG,sG,aG;function q1(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}dv(CI);const oG=e=>e<256?rw[e]:rw[256+(e>>>7)],sw=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},oc=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,sw(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},yu=(e,t,r)=>{oc(e,r[2*t],r[2*t+1])},cG=(e,t)=>{let r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1},lG=(e,t,r)=>{const o=new Array(16);let c,u,f=0;for(c=1;c<=tw;c++)f=f+r[c-1]<<1,o[c]=f;for(u=0;u<=t;u++){let g=e[2*u+1];g!==0&&(e[2*u]=cG(o[g]++,g))}},dG=e=>{let t;for(t=0;t<nG;t++)e.dyn_ltree[2*t]=0;for(t=0;t<ew;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},uG=e=>{e.bi_valid>8?sw(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},hG=(e,t,r,o)=>{const c=2*t,u=2*r;return e[c]<e[u]||e[c]===e[u]&&o[t]<=o[r]},K1=(e,t,r)=>{const o=e.heap[r];let c=r<<1;for(;c<=e.heap_len&&(c<e.heap_len&&hG(t,e.heap[c+1],e.heap[c],e.depth)&&c++,!hG(t,o,e.heap[c],e.depth));)e.heap[r]=e.heap[c],r=c,c<<=1;e.heap[r]=o},pG=(e,t,r)=>{let o,c,u,f,g=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+g++],o+=(255&e.pending_buf[e.sym_buf+g++])<<8,c=e.pending_buf[e.sym_buf+g++],o===0?yu(e,c,t):(u=iw[c],yu(e,u+G1+1,t),f=W1[u],f!==0&&(c-=z1[u],oc(e,c,f)),o--,u=oG(o),yu(e,u,r),f=RI[u],f!==0&&(o-=CI[u],oc(e,o,f)));while(g<e.sym_next);yu(e,256,t)},X1=(e,t)=>{const r=t.dyn_tree,o=t.stat_desc.static_tree,c=t.stat_desc.has_stree,u=t.stat_desc.elems;let f,g,E,v=-1;for(e.heap_len=0,e.heap_max=573,f=0;f<u;f++)r[2*f]!==0?(e.heap[++e.heap_len]=v=f,e.depth[f]=0):r[2*f+1]=0;for(;e.heap_len<2;)E=e.heap[++e.heap_len]=v<2?++v:0,r[2*E]=1,e.depth[E]=0,e.opt_len--,c&&(e.static_len-=o[2*E+1]);for(t.max_code=v,f=e.heap_len>>1;f>=1;f--)K1(e,r,f);E=u;do f=e.heap[1],e.heap[1]=e.heap[e.heap_len--],K1(e,r,1),g=e.heap[1],e.heap[--e.heap_max]=f,e.heap[--e.heap_max]=g,r[2*E]=r[2*f]+r[2*g],e.depth[E]=(e.depth[f]>=e.depth[g]?e.depth[f]:e.depth[g])+1,r[2*f+1]=r[2*g+1]=E,e.heap[1]=E++,K1(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((S,R)=>{const I=R.dyn_tree,D=R.max_code,V=R.stat_desc.static_tree,M=R.stat_desc.has_stree,j=R.stat_desc.extra_bits,G=R.stat_desc.extra_base,z=R.stat_desc.max_length;let ce,Ee,_e,me,Ce,xe,$e=0;for(me=0;me<=tw;me++)S.bl_count[me]=0;for(I[2*S.heap[S.heap_max]+1]=0,ce=S.heap_max+1;ce<573;ce++)Ee=S.heap[ce],me=I[2*I[2*Ee+1]+1]+1,me>z&&(me=z,$e++),I[2*Ee+1]=me,Ee>D||(S.bl_count[me]++,Ce=0,Ee>=G&&(Ce=j[Ee-G]),xe=I[2*Ee],S.opt_len+=xe*(me+Ce),M&&(S.static_len+=xe*(V[2*Ee+1]+Ce)));if($e!==0){do{for(me=z-1;S.bl_count[me]===0;)me--;S.bl_count[me]--,S.bl_count[me+1]+=2,S.bl_count[z]--,$e-=2}while($e>0);for(me=z;me!==0;me--)for(Ee=S.bl_count[me];Ee!==0;)_e=S.heap[--ce],_e>D||(I[2*_e+1]!==me&&(S.opt_len+=(me-I[2*_e+1])*I[2*_e],I[2*_e+1]=me),Ee--)}})(e,t),lG(r,v,e.bl_count)},fG=(e,t,r)=>{let o,c,u=-1,f=t[1],g=0,E=7,v=4;for(f===0&&(E=138,v=3),t[2*(r+1)+1]=65535,o=0;o<=r;o++)c=f,f=t[2*(o+1)+1],++g<E&&c===f||(g<v?e.bl_tree[2*c]+=g:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):g<=10?e.bl_tree[34]++:e.bl_tree[36]++,g=0,u=c,f===0?(E=138,v=3):c===f?(E=6,v=3):(E=7,v=4))},mG=(e,t,r)=>{let o,c,u=-1,f=t[1],g=0,E=7,v=4;for(f===0&&(E=138,v=3),o=0;o<=r;o++)if(c=f,f=t[2*(o+1)+1],!(++g<E&&c===f)){if(g<v)do yu(e,c,e.bl_tree);while(--g!=0);else c!==0?(c!==u&&(yu(e,c,e.bl_tree),g--),yu(e,16,e.bl_tree),oc(e,g-3,2)):g<=10?(yu(e,17,e.bl_tree),oc(e,g-3,3)):(yu(e,18,e.bl_tree),oc(e,g-11,7));g=0,u=c,f===0?(E=138,v=3):c===f?(E=6,v=3):(E=7,v=4)}};let gG=!1;const _G=(e,t,r,o)=>{oc(e,0+(o?1:0),3),uG(e),sw(e,r),sw(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var _ie=e=>{gG||((()=>{let t,r,o,c,u;const f=new Array(16);for(o=0,c=0;c<28;c++)for(z1[c]=o,t=0;t<1<<W1[c];t++)iw[o++]=c;for(iw[o-1]=c,u=0,c=0;c<16;c++)for(CI[c]=u,t=0;t<1<<RI[c];t++)rw[u++]=c;for(u>>=7;c<ew;c++)for(CI[c]=u<<7,t=0;t<1<<RI[c]-7;t++)rw[256+u++]=c;for(r=0;r<=tw;r++)f[r]=0;for(t=0;t<=143;)Yh[2*t+1]=8,t++,f[8]++;for(;t<=255;)Yh[2*t+1]=9,t++,f[9]++;for(;t<=279;)Yh[2*t+1]=7,t++,f[7]++;for(;t<=287;)Yh[2*t+1]=8,t++,f[8]++;for(lG(Yh,287,f),t=0;t<ew;t++)nw[2*t+1]=5,nw[2*t]=cG(t,5);iG=new Y1(Yh,W1,257,nG,tw),sG=new Y1(nw,RI,0,ew,tw),aG=new Y1(new Array(0),gie,0,19,7)})(),gG=!0),e.l_desc=new q1(e.dyn_ltree,iG),e.d_desc=new q1(e.dyn_dtree,sG),e.bl_desc=new q1(e.bl_tree,aG),e.bi_buf=0,e.bi_valid=0,dG(e)},Eie=(e,t,r,o)=>{let c,u,f=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(g=>{let E,v=4093624447;for(E=0;E<=31;E++,v>>>=1)if(1&v&&g.dyn_ltree[2*E]!==0)return 0;if(g.dyn_ltree[18]!==0||g.dyn_ltree[20]!==0||g.dyn_ltree[26]!==0)return 1;for(E=32;E<G1;E++)if(g.dyn_ltree[2*E]!==0)return 1;return 0})(e)),X1(e,e.l_desc),X1(e,e.d_desc),f=(g=>{let E;for(fG(g,g.dyn_ltree,g.l_desc.max_code),fG(g,g.dyn_dtree,g.d_desc.max_code),X1(g,g.bl_desc),E=18;E>=3&&g.bl_tree[2*rG[E]+1]===0;E--);return g.opt_len+=3*(E+1)+5+5+4,E})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=r+5,r+4<=c&&t!==-1?_G(e,t,r,o):e.strategy===4||u===c?(oc(e,2+(o?1:0),3),pG(e,Yh,nw)):(oc(e,4+(o?1:0),3),((g,E,v,S)=>{let R;for(oc(g,E-257,5),oc(g,v-1,5),oc(g,S-4,4),R=0;R<S;R++)oc(g,g.bl_tree[2*rG[R]+1],3);mG(g,g.dyn_ltree,E-1),mG(g,g.dyn_dtree,v-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,f+1),pG(e,e.dyn_ltree,e.dyn_dtree)),dG(e),o&&uG(e)},yie=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(iw[r]+G1+1)]++,e.dyn_dtree[2*oG(t)]++),e.sym_next===e.sym_end),vie=e=>{oc(e,2,3),yu(e,256,Yh),(t=>{t.bi_valid===16?(sw(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Sie={_tr_init:_ie,_tr_stored_block:_G,_tr_flush_block:Eie,_tr_tally:yie,_tr_align:vie},aw=(e,t,r,o)=>{let c=65535&e|0,u=e>>>16&65535|0,f=0;for(;r!==0;){f=r>2e3?2e3:r,r-=f;do c=c+t[o++]|0,u=u+c|0;while(--f);c%=65521,u%=65521}return c|u<<16|0};const Tie=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var va=(e,t,r,o)=>{const c=Tie,u=o+r;e^=-1;for(let f=o;f<u;f++)e=e>>>8^c[255&(e^t[f])];return-1^e},Kg={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},AI={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:bie,_tr_stored_block:Q1,_tr_flush_block:wie,_tr_tally:Df,_tr_align:Rie}=Sie,{Z_NO_FLUSH:xf,Z_PARTIAL_FLUSH:Cie,Z_FULL_FLUSH:Aie,Z_FINISH:Cl,Z_BLOCK:EG,Z_OK:Ma,Z_STREAM_END:yG,Z_STREAM_ERROR:vu,Z_DATA_ERROR:Iie,Z_BUF_ERROR:$1,Z_DEFAULT_COMPRESSION:Nie,Z_FILTERED:Oie,Z_HUFFMAN_ONLY:II,Z_RLE:Die,Z_FIXED:xie,Z_DEFAULT_STRATEGY:Pie,Z_UNKNOWN:kie,Z_DEFLATED:NI}=AI,J1=286,Lie=30,Mie=19,jie=2*J1+1,Uie=15,Xg=258,Su=262,uv=42,Qg=113,ow=666,$g=(e,t)=>(e.msg=Kg[t],t),vG=e=>2*e-(e>4?9:0),Pf=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Vie=e=>{let t,r,o,c=e.w_size;t=e.hash_size,o=t;do r=e.head[--o],e.head[o]=r>=c?r-c:0;while(--t);t=c,o=t;do r=e.prev[--o],e.prev[o]=r>=c?r-c:0;while(--t)};let kf=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const Dc=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},xc=(e,t)=>{wie(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Dc(e.strm)},$r=(e,t)=>{e.pending_buf[e.pending++]=t},cw=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Z1=(e,t,r,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,t.set(e.input.subarray(e.next_in,e.next_in+c),r),e.state.wrap===1?e.adler=aw(e.adler,t,c,r):e.state.wrap===2&&(e.adler=va(e.adler,t,c,r)),e.next_in+=c,e.total_in+=c,c)},SG=(e,t)=>{let r,o,c=e.max_chain_length,u=e.strstart,f=e.prev_length,g=e.nice_match;const E=e.strstart>e.w_size-Su?e.strstart-(e.w_size-Su):0,v=e.window,S=e.w_mask,R=e.prev,I=e.strstart+Xg;let D=v[u+f-1],V=v[u+f];e.prev_length>=e.good_match&&(c>>=2),g>e.lookahead&&(g=e.lookahead);do if(r=t,v[r+f]===V&&v[r+f-1]===D&&v[r]===v[u]&&v[++r]===v[u+1]){u+=2,r++;do;while(v[++u]===v[++r]&&v[++u]===v[++r]&&v[++u]===v[++r]&&v[++u]===v[++r]&&v[++u]===v[++r]&&v[++u]===v[++r]&&v[++u]===v[++r]&&v[++u]===v[++r]&&u<I);if(o=Xg-(I-u),u=I-Xg,o>f){if(e.match_start=t,f=o,o>=g)break;D=v[u+f-1],V=v[u+f]}}while((t=R[t&S])>E&&--c!=0);return f<=e.lookahead?f:e.lookahead},hv=e=>{const t=e.w_size;let r,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Su)&&(e.window.set(e.window.subarray(t,t+t-o),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Vie(e),o+=t),e.strm.avail_in===0)break;if(r=Z1(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=r,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=kf(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=kf(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Su&&e.strm.avail_in!==0)},TG=(e,t)=>{let r,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,f=0,g=e.strm.avail_in;do{if(r=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,r>o+e.strm.avail_in&&(r=o+e.strm.avail_in),r>c&&(r=c),r<u&&(r===0&&t!==Cl||t===xf||r!==o+e.strm.avail_in)))break;f=t===Cl&&r===o+e.strm.avail_in?1:0,Q1(e,0,0,f),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,Dc(e.strm),o&&(o>r&&(o=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,r-=o),r&&(Z1(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(f===0);return g-=e.strm.avail_in,g&&(g>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=g&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-g,e.strm.next_in),e.strstart),e.strstart+=g,e.insert+=g>e.w_size-e.insert?e.w_size-e.insert:g),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),f?4:t!==xf&&t!==Cl&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(Z1(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||t===Cl)&&t!==xf&&e.strm.avail_in===0&&o<=c)&&(r=o>c?c:o,f=t===Cl&&e.strm.avail_in===0&&r===o?1:0,Q1(e,e.block_start,r,f),e.block_start+=r,Dc(e.strm)),f?3:1)},eL=(e,t)=>{let r,o;for(;;){if(e.lookahead<Su){if(hv(e),e.lookahead<Su&&t===xf)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=kf(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-Su&&(e.match_length=SG(e,r)),e.match_length>=3)if(o=Df(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=kf(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=kf(e,e.ins_h,e.window[e.strstart+1]);else o=Df(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(xc(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Cl?(xc(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(xc(e,!1),e.strm.avail_out===0)?1:2},pv=(e,t)=>{let r,o,c;for(;;){if(e.lookahead<Su){if(hv(e),e.lookahead<Su&&t===xf)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=kf(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Su&&(e.match_length=SG(e,r),e.match_length<=5&&(e.strategy===Oie||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=Df(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=kf(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(xc(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=Df(e,0,e.window[e.strstart-1]),o&&xc(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=Df(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Cl?(xc(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(xc(e,!1),e.strm.avail_out===0)?1:2};function Tu(e,t,r,o,c){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=o,this.func=c}const lw=[new Tu(0,0,0,0,TG),new Tu(4,4,8,4,eL),new Tu(4,5,16,8,eL),new Tu(4,6,32,32,eL),new Tu(4,4,16,16,pv),new Tu(8,16,32,32,pv),new Tu(8,16,128,128,pv),new Tu(8,32,128,256,pv),new Tu(32,128,258,1024,pv),new Tu(32,258,258,4096,pv)];function Fie(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=NI,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*jie),this.dyn_dtree=new Uint16Array(2*(2*Lie+1)),this.bl_tree=new Uint16Array(2*(2*Mie+1)),Pf(this.dyn_ltree),Pf(this.dyn_dtree),Pf(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Uie+1),this.heap=new Uint16Array(2*J1+1),Pf(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*J1+1),Pf(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const dw=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==uv&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Qg&&t.status!==ow?1:0},bG=e=>{if(dw(e))return $g(e,vu);e.total_in=e.total_out=0,e.data_type=kie;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?uv:Qg,e.adler=t.wrap===2?0:1,t.last_flush=-2,bie(t),Ma},wG=e=>{const t=bG(e);return t===Ma&&(r=>{r.window_size=2*r.w_size,Pf(r.head),r.max_lazy_match=lw[r.level].max_lazy,r.good_match=lw[r.level].good_length,r.nice_match=lw[r.level].nice_length,r.max_chain_length=lw[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0})(e.state),t},RG=(e,t,r,o,c,u)=>{if(!e)return vu;let f=1;if(t===Nie&&(t=6),o<0?(f=0,o=-o):o>15&&(f=2,o-=16),c<1||c>9||r!==NI||o<8||o>15||t<0||t>9||u<0||u>xie||o===8&&f!==1)return $g(e,vu);o===8&&(o=9);const g=new Fie;return e.state=g,g.strm=e,g.status=uv,g.wrap=f,g.gzhead=null,g.w_bits=o,g.w_size=1<<g.w_bits,g.w_mask=g.w_size-1,g.hash_bits=c+7,g.hash_size=1<<g.hash_bits,g.hash_mask=g.hash_size-1,g.hash_shift=~~((g.hash_bits+3-1)/3),g.window=new Uint8Array(2*g.w_size),g.head=new Uint16Array(g.hash_size),g.prev=new Uint16Array(g.w_size),g.lit_bufsize=1<<c+6,g.pending_buf_size=4*g.lit_bufsize,g.pending_buf=new Uint8Array(g.pending_buf_size),g.sym_buf=g.lit_bufsize,g.sym_end=3*(g.lit_bufsize-1),g.level=t,g.strategy=u,g.method=r,wG(e)};var Bie=(e,t)=>{if(dw(e)||t>EG||t<0)return e?$g(e,vu):vu;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===ow&&t!==Cl)return $g(e,e.avail_out===0?$1:vu);const o=r.last_flush;if(r.last_flush=t,r.pending!==0){if(Dc(e),e.avail_out===0)return r.last_flush=-1,Ma}else if(e.avail_in===0&&vG(t)<=vG(o)&&t!==Cl)return $g(e,$1);if(r.status===ow&&e.avail_in!==0)return $g(e,$1);if(r.status===uv&&r.wrap===0&&(r.status=Qg),r.status===uv){let c=NI+(r.w_bits-8<<4)<<8,u=-1;if(u=r.strategy>=II||r.level<2?0:r.level<6?1:r.level===6?2:3,c|=u<<6,r.strstart!==0&&(c|=32),c+=31-c%31,cw(r,c),r.strstart!==0&&(cw(r,e.adler>>>16),cw(r,65535&e.adler)),e.adler=1,r.status=Qg,Dc(e),r.pending!==0)return r.last_flush=-1,Ma}if(r.status===57){if(e.adler=0,$r(r,31),$r(r,139),$r(r,8),r.gzhead)$r(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),$r(r,255&r.gzhead.time),$r(r,r.gzhead.time>>8&255),$r(r,r.gzhead.time>>16&255),$r(r,r.gzhead.time>>24&255),$r(r,r.level===9?2:r.strategy>=II||r.level<2?4:0),$r(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&($r(r,255&r.gzhead.extra.length),$r(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=va(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if($r(r,0),$r(r,0),$r(r,0),$r(r,0),$r(r,0),$r(r,r.level===9?2:r.strategy>=II||r.level<2?4:0),$r(r,3),r.status=Qg,Dc(e),r.pending!==0)return r.last_flush=-1,Ma}if(r.status===69){if(r.gzhead.extra){let c=r.pending,u=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+u>r.pending_buf_size;){let g=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+g),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>c&&(e.adler=va(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex+=g,Dc(e),r.pending!==0)return r.last_flush=-1,Ma;c=0,u-=g}let f=new Uint8Array(r.gzhead.extra);r.pending_buf.set(f.subarray(r.gzindex,r.gzindex+u),r.pending),r.pending+=u,r.gzhead.hcrc&&r.pending>c&&(e.adler=va(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex=0}r.status=73}if(r.status===73){if(r.gzhead.name){let c,u=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>u&&(e.adler=va(e.adler,r.pending_buf,r.pending-u,u)),Dc(e),r.pending!==0)return r.last_flush=-1,Ma;u=0}c=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,$r(r,c)}while(c!==0);r.gzhead.hcrc&&r.pending>u&&(e.adler=va(e.adler,r.pending_buf,r.pending-u,u)),r.gzindex=0}r.status=91}if(r.status===91){if(r.gzhead.comment){let c,u=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>u&&(e.adler=va(e.adler,r.pending_buf,r.pending-u,u)),Dc(e),r.pending!==0)return r.last_flush=-1,Ma;u=0}c=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,$r(r,c)}while(c!==0);r.gzhead.hcrc&&r.pending>u&&(e.adler=va(e.adler,r.pending_buf,r.pending-u,u))}r.status=103}if(r.status===103){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Dc(e),r.pending!==0))return r.last_flush=-1,Ma;$r(r,255&e.adler),$r(r,e.adler>>8&255),e.adler=0}if(r.status=Qg,Dc(e),r.pending!==0)return r.last_flush=-1,Ma}if(e.avail_in!==0||r.lookahead!==0||t!==xf&&r.status!==ow){let c=r.level===0?TG(r,t):r.strategy===II?((u,f)=>{let g;for(;;){if(u.lookahead===0&&(hv(u),u.lookahead===0)){if(f===xf)return 1;break}if(u.match_length=0,g=Df(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,g&&(xc(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,f===Cl?(xc(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(xc(u,!1),u.strm.avail_out===0)?1:2})(r,t):r.strategy===Die?((u,f)=>{let g,E,v,S;const R=u.window;for(;;){if(u.lookahead<=Xg){if(hv(u),u.lookahead<=Xg&&f===xf)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(v=u.strstart-1,E=R[v],E===R[++v]&&E===R[++v]&&E===R[++v])){S=u.strstart+Xg;do;while(E===R[++v]&&E===R[++v]&&E===R[++v]&&E===R[++v]&&E===R[++v]&&E===R[++v]&&E===R[++v]&&E===R[++v]&&v<S);u.match_length=Xg-(S-v),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(g=Df(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(g=Df(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),g&&(xc(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,f===Cl?(xc(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(xc(u,!1),u.strm.avail_out===0)?1:2})(r,t):lw[r.level].func(r,t);if(c!==3&&c!==4||(r.status=ow),c===1||c===3)return e.avail_out===0&&(r.last_flush=-1),Ma;if(c===2&&(t===Cie?Rie(r):t!==EG&&(Q1(r,0,0,!1),t===Aie&&(Pf(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),Dc(e),e.avail_out===0))return r.last_flush=-1,Ma}return t!==Cl?Ma:r.wrap<=0?yG:(r.wrap===2?($r(r,255&e.adler),$r(r,e.adler>>8&255),$r(r,e.adler>>16&255),$r(r,e.adler>>24&255),$r(r,255&e.total_in),$r(r,e.total_in>>8&255),$r(r,e.total_in>>16&255),$r(r,e.total_in>>24&255)):(cw(r,e.adler>>>16),cw(r,65535&e.adler)),Dc(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Ma:yG)},Hie=(e,t)=>{let r=t.length;if(dw(e))return vu;const o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==uv||o.lookahead)return vu;if(c===1&&(e.adler=aw(e.adler,t,r,0)),o.wrap=0,r>=o.w_size){c===0&&(Pf(o.head),o.strstart=0,o.block_start=0,o.insert=0);let E=new Uint8Array(o.w_size);E.set(t.subarray(r-o.w_size,r),0),t=E,r=o.w_size}const u=e.avail_in,f=e.next_in,g=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,hv(o);o.lookahead>=3;){let E=o.strstart,v=o.lookahead-2;do o.ins_h=kf(o,o.ins_h,o.window[E+3-1]),o.prev[E&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=E,E++;while(--v);o.strstart=E,o.lookahead=2,hv(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=f,e.input=g,e.avail_in=u,o.wrap=c,Ma},uw={deflateInit:(e,t)=>RG(e,t,NI,15,8,Pie),deflateInit2:RG,deflateReset:wG,deflateResetKeep:bG,deflateSetHeader:(e,t)=>dw(e)||e.state.wrap!==2?vu:(e.state.gzhead=t,Ma),deflate:Bie,deflateEnd:e=>{if(dw(e))return vu;const t=e.state.status;return e.state=null,t===Qg?$g(e,Iie):Ma},deflateSetDictionary:Hie,deflateInfo:"pako deflate (from Nodeca project)"};const Gie=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var OI={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const o in r)Gie(r,o)&&(e[o]=r[o])}}return e},flattenChunks:e=>{let t=0;for(let o=0,c=e.length;o<c;o++)t+=e[o].length;const r=new Uint8Array(t);for(let o=0,c=0,u=e.length;o<u;o++){let f=e[o];r.set(f,c),c+=f.length}return r}};let CG=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{CG=!1}const hw=new Uint8Array(256);for(let e=0;e<256;e++)hw[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;hw[254]=hw[254]=1;var pw={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,o,c,u,f=e.length,g=0;for(c=0;c<f;c++)r=e.charCodeAt(c),(64512&r)==55296&&c+1<f&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(r=65536+(r-55296<<10)+(o-56320),c++)),g+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(g),u=0,c=0;u<g;c++)r=e.charCodeAt(c),(64512&r)==55296&&c+1<f&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(r=65536+(r-55296<<10)+(o-56320),c++)),r<128?t[u++]=r:r<2048?(t[u++]=192|r>>>6,t[u++]=128|63&r):r<65536?(t[u++]=224|r>>>12,t[u++]=128|r>>>6&63,t[u++]=128|63&r):(t[u++]=240|r>>>18,t[u++]=128|r>>>12&63,t[u++]=128|r>>>6&63,t[u++]=128|63&r);return t},buf2string:(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let o,c;const u=new Array(2*r);for(c=0,o=0;o<r;){let f=e[o++];if(f<128){u[c++]=f;continue}let g=hw[f];if(g>4)u[c++]=65533,o+=g-1;else{for(f&=g===2?31:g===3?15:7;g>1&&o<r;)f=f<<6|63&e[o++],g--;g>1?u[c++]=65533:f<65536?u[c++]=f:(f-=65536,u[c++]=55296|f>>10&1023,u[c++]=56320|1023&f)}}return((f,g)=>{if(g<65534&&f.subarray&&CG)return String.fromCharCode.apply(null,f.length===g?f:f.subarray(0,g));let E="";for(let v=0;v<g;v++)E+=String.fromCharCode(f[v]);return E})(u,c)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(192&e[r])==128;)r--;return r<0||r===0?t:r+hw[e[r]]>t?r:t}},AG=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const IG=Object.prototype.toString,{Z_NO_FLUSH:Wie,Z_SYNC_FLUSH:zie,Z_FULL_FLUSH:Yie,Z_FINISH:qie,Z_OK:DI,Z_STREAM_END:Kie,Z_DEFAULT_COMPRESSION:Xie,Z_DEFAULT_STRATEGY:Qie,Z_DEFLATED:$ie}=AI;function xI(e){this.options=OI.assign({level:Xie,method:$ie,chunkSize:16384,windowBits:15,memLevel:8,strategy:Qie},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new AG,this.strm.avail_out=0;let r=uw.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==DI)throw new Error(Kg[r]);if(t.header&&uw.deflateSetHeader(this.strm,t.header),t.dictionary){let o;if(o=typeof t.dictionary=="string"?pw.string2buf(t.dictionary):IG.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,r=uw.deflateSetDictionary(this.strm,o),r!==DI)throw new Error(Kg[r]);this._dict_set=!0}}function Jie(e,t){const r=new xI(t);if(r.push(e,!0),r.err)throw r.msg||Kg[r.err];return r.result}xI.prototype.push=function(e,t){const r=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=t===~~t?t:t===!0?qie:Wie,typeof e=="string"?r.input=pw.string2buf(e):IG.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(r.avail_out===0&&(r.output=new Uint8Array(o),r.next_out=0,r.avail_out=o),(u===zie||u===Yie)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(c=uw.deflate(r,u),c===Kie)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),c=uw.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===DI;if(r.avail_out!==0){if(u>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(r.avail_in===0)break}else this.onData(r.output)}return!0},xI.prototype.onData=function(e){this.chunks.push(e)},xI.prototype.onEnd=function(e){e===DI&&(this.result=OI.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Zie={deflate:Jie};const PI=16209;var ese=function(e,t){let r,o,c,u,f,g,E,v,S,R,I,D,V,M,j,G,z,ce,Ee,_e,me,Ce,xe,$e;const at=e.state;r=e.next_in,xe=e.input,o=r+(e.avail_in-5),c=e.next_out,$e=e.output,u=c-(t-e.avail_out),f=c+(e.avail_out-257),g=at.dmax,E=at.wsize,v=at.whave,S=at.wnext,R=at.window,I=at.hold,D=at.bits,V=at.lencode,M=at.distcode,j=(1<<at.lenbits)-1,G=(1<<at.distbits)-1;e:do{D<15&&(I+=xe[r++]<<D,D+=8,I+=xe[r++]<<D,D+=8),z=V[I&j];t:for(;;){if(ce=z>>>24,I>>>=ce,D-=ce,ce=z>>>16&255,ce===0)$e[c++]=65535&z;else{if(!(16&ce)){if((64&ce)==0){z=V[(65535&z)+(I&(1<<ce)-1)];continue t}if(32&ce){at.mode=16191;break e}e.msg="invalid literal/length code",at.mode=PI;break e}Ee=65535&z,ce&=15,ce&&(D<ce&&(I+=xe[r++]<<D,D+=8),Ee+=I&(1<<ce)-1,I>>>=ce,D-=ce),D<15&&(I+=xe[r++]<<D,D+=8,I+=xe[r++]<<D,D+=8),z=M[I&G];n:for(;;){if(ce=z>>>24,I>>>=ce,D-=ce,ce=z>>>16&255,!(16&ce)){if((64&ce)==0){z=M[(65535&z)+(I&(1<<ce)-1)];continue n}e.msg="invalid distance code",at.mode=PI;break e}if(_e=65535&z,ce&=15,D<ce&&(I+=xe[r++]<<D,D+=8,D<ce&&(I+=xe[r++]<<D,D+=8)),_e+=I&(1<<ce)-1,_e>g){e.msg="invalid distance too far back",at.mode=PI;break e}if(I>>>=ce,D-=ce,ce=c-u,_e>ce){if(ce=_e-ce,ce>v&&at.sane){e.msg="invalid distance too far back",at.mode=PI;break e}if(me=0,Ce=R,S===0){if(me+=E-ce,ce<Ee){Ee-=ce;do $e[c++]=R[me++];while(--ce);me=c-_e,Ce=$e}}else if(S<ce){if(me+=E+S-ce,ce-=S,ce<Ee){Ee-=ce;do $e[c++]=R[me++];while(--ce);if(me=0,S<Ee){ce=S,Ee-=ce;do $e[c++]=R[me++];while(--ce);me=c-_e,Ce=$e}}}else if(me+=S-ce,ce<Ee){Ee-=ce;do $e[c++]=R[me++];while(--ce);me=c-_e,Ce=$e}for(;Ee>2;)$e[c++]=Ce[me++],$e[c++]=Ce[me++],$e[c++]=Ce[me++],Ee-=3;Ee&&($e[c++]=Ce[me++],Ee>1&&($e[c++]=Ce[me++]))}else{me=c-_e;do $e[c++]=$e[me++],$e[c++]=$e[me++],$e[c++]=$e[me++],Ee-=3;while(Ee>2);Ee&&($e[c++]=$e[me++],Ee>1&&($e[c++]=$e[me++]))}break}}break}}while(r<o&&c<f);Ee=D>>3,r-=Ee,D-=Ee<<3,I&=(1<<D)-1,e.next_in=r,e.next_out=c,e.avail_in=r<o?o-r+5:5-(r-o),e.avail_out=c<f?f-c+257:257-(c-f),at.hold=I,at.bits=D};const kI=15,tse=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),nse=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),rse=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ise=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var fw=(e,t,r,o,c,u,f,g)=>{const E=g.bits;let v,S,R,I,D,V,M=0,j=0,G=0,z=0,ce=0,Ee=0,_e=0,me=0,Ce=0,xe=0,$e=null;const at=new Uint16Array(16),Zt=new Uint16Array(16);let qt,Pt,hr,er=null;for(M=0;M<=kI;M++)at[M]=0;for(j=0;j<o;j++)at[t[r+j]]++;for(ce=E,z=kI;z>=1&&at[z]===0;z--);if(ce>z&&(ce=z),z===0)return c[u++]=20971520,c[u++]=20971520,g.bits=1,0;for(G=1;G<z&&at[G]===0;G++);for(ce<G&&(ce=G),me=1,M=1;M<=kI;M++)if(me<<=1,me-=at[M],me<0)return-1;if(me>0&&(e===0||z!==1))return-1;for(Zt[1]=0,M=1;M<kI;M++)Zt[M+1]=Zt[M]+at[M];for(j=0;j<o;j++)t[r+j]!==0&&(f[Zt[t[r+j]]++]=j);if(e===0?($e=er=f,V=20):e===1?($e=tse,er=nse,V=257):($e=rse,er=ise,V=0),xe=0,j=0,M=G,D=u,Ee=ce,_e=0,R=-1,Ce=1<<ce,I=Ce-1,e===1&&Ce>852||e===2&&Ce>592)return 1;for(;;){qt=M-_e,f[j]+1<V?(Pt=0,hr=f[j]):f[j]>=V?(Pt=er[f[j]-V],hr=$e[f[j]-V]):(Pt=96,hr=0),v=1<<M-_e,S=1<<Ee,G=S;do S-=v,c[D+(xe>>_e)+S]=qt<<24|Pt<<16|hr|0;while(S!==0);for(v=1<<M-1;xe&v;)v>>=1;if(v!==0?(xe&=v-1,xe+=v):xe=0,j++,--at[M]==0){if(M===z)break;M=t[r+f[j]]}if(M>ce&&(xe&I)!==R){for(_e===0&&(_e=ce),D+=G,Ee=M-_e,me=1<<Ee;Ee+_e<z&&(me-=at[Ee+_e],!(me<=0));)Ee++,me<<=1;if(Ce+=1<<Ee,e===1&&Ce>852||e===2&&Ce>592)return 1;R=xe&I,c[R]=ce<<24|Ee<<16|D-u|0}}return xe!==0&&(c[D+xe]=M-_e<<24|64<<16|0),g.bits=ce,0};const{Z_FINISH:NG,Z_BLOCK:sse,Z_TREES:LI,Z_OK:Jg,Z_STREAM_END:ase,Z_NEED_DICT:ose,Z_STREAM_ERROR:Al,Z_DATA_ERROR:OG,Z_MEM_ERROR:DG,Z_BUF_ERROR:cse,Z_DEFLATED:xG}=AI,MI=16180,jI=16190,qh=16191,tL=16192,nL=16194,UI=16199,VI=16200,rL=16206,Qi=16209,PG=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function lse(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Zg=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<MI||t.mode>16211?1:0},kG=e=>{if(Zg(e))return Al;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=MI,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Jg},LG=e=>{if(Zg(e))return Al;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,kG(e)},MG=(e,t)=>{let r;if(Zg(e))return Al;const o=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Al:(o.window!==null&&o.wbits!==t&&(o.window=null),o.wrap=r,o.wbits=t,LG(e))},jG=(e,t)=>{if(!e)return Al;const r=new lse;e.state=r,r.strm=e,r.window=null,r.mode=MI;const o=MG(e,t);return o!==Jg&&(e.state=null),o};let iL,sL,UG=!0;const dse=e=>{if(UG){iL=new Int32Array(512),sL=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(fw(1,e.lens,0,288,iL,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;fw(2,e.lens,0,32,sL,0,e.work,{bits:5}),UG=!1}e.lencode=iL,e.lenbits=9,e.distcode=sL,e.distbits=5},VG=(e,t,r,o)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(t.subarray(r-u.wsize,r),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(t.subarray(r-o,r-o+c),u.wnext),(o-=c)?(u.window.set(t.subarray(r-o,r),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var use=(e,t)=>{let r,o,c,u,f,g,E,v,S,R,I,D,V,M,j,G,z,ce,Ee,_e,me,Ce,xe=0;const $e=new Uint8Array(4);let at,Zt;const qt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Zg(e)||!e.output||!e.input&&e.avail_in!==0)return Al;r=e.state,r.mode===qh&&(r.mode=tL),f=e.next_out,c=e.output,E=e.avail_out,u=e.next_in,o=e.input,g=e.avail_in,v=r.hold,S=r.bits,R=g,I=E,Ce=Jg;e:for(;;)switch(r.mode){case MI:if(r.wrap===0){r.mode=tL;break}for(;S<16;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(2&r.wrap&&v===35615){r.wbits===0&&(r.wbits=15),r.check=0,$e[0]=255&v,$e[1]=v>>>8&255,r.check=va(r.check,$e,2,0),v=0,S=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",r.mode=Qi;break}if((15&v)!==xG){e.msg="unknown compression method",r.mode=Qi;break}if(v>>>=4,S-=4,me=8+(15&v),r.wbits===0&&(r.wbits=me),me>15||me>r.wbits){e.msg="invalid window size",r.mode=Qi;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&v?16189:qh,v=0,S=0;break;case 16181:for(;S<16;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(r.flags=v,(255&ca(r))!==xG){e.msg="unknown compression method",r.mode=Qi;break}if(57344&ca(r)){e.msg="unknown header flags set",r.mode=Qi;break}r.head&&(r.head.text=v>>8&1),512&ca(r)&&4&r.wrap&&($e[0]=255&v,$e[1]=v>>>8&255,r.check=va(r.check,$e,2,0)),v=0,S=0,r.mode=16182;case 16182:for(;S<32;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}r.head&&(r.head.time=v),512&ca(r)&&4&r.wrap&&($e[0]=255&v,$e[1]=v>>>8&255,$e[2]=v>>>16&255,$e[3]=v>>>24&255,r.check=va(r.check,$e,4,0)),v=0,S=0,r.mode=16183;case 16183:for(;S<16;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}r.head&&(r.head.xflags=255&v,r.head.os=v>>8),512&ca(r)&&4&r.wrap&&($e[0]=255&v,$e[1]=v>>>8&255,r.check=va(r.check,$e,2,0)),v=0,S=0,r.mode=16184;case 16184:if(1024&ca(r)){for(;S<16;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}r.length=v,r.head&&(r.head.extra_len=v),512&ca(r)&&4&r.wrap&&($e[0]=255&v,$e[1]=v>>>8&255,r.check=va(r.check,$e,2,0)),v=0,S=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&ca(r)&&(D=r.length,D>g&&(D=g),D&&(r.head&&(me=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(o.subarray(u,u+D),me)),512&ca(r)&&4&r.wrap&&(r.check=va(r.check,o,D,u)),g-=D,u+=D,r.length-=D),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&ca(r)){if(g===0)break e;D=0;do me=o[u+D++],r.head&&me&&r.length<65536&&(r.head.name+=String.fromCharCode(me));while(me&&D<g);if(512&ca(r)&&4&r.wrap&&(r.check=va(r.check,o,D,u)),g-=D,u+=D,me)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&ca(r)){if(g===0)break e;D=0;do me=o[u+D++],r.head&&me&&r.length<65536&&(r.head.comment+=String.fromCharCode(me));while(me&&D<g);if(512&ca(r)&&4&r.wrap&&(r.check=va(r.check,o,D,u)),g-=D,u+=D,me)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&ca(r)){for(;S<16;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(4&r.wrap&&v!==(65535&r.check)){e.msg="header crc mismatch",r.mode=Qi;break}v=0,S=0}r.head&&(r.head.hcrc=ca(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=qh;break;case 16189:for(;S<32;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}e.adler=r.check=PG(v),v=0,S=0,r.mode=jI;case jI:if(r.havedict===0)return e.next_out=f,e.avail_out=E,e.next_in=u,e.avail_in=g,r.hold=v,r.bits=S,ose;e.adler=r.check=1,r.mode=qh;case qh:if(t===sse||t===LI)break e;case tL:if(r.last){v>>>=7&S,S-=7&S,r.mode=rL;break}for(;S<3;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}switch(r.last=1&v,v>>>=1,S-=1,3&v){case 0:r.mode=16193;break;case 1:if(dse(r),r.mode=UI,t===LI){v>>>=2,S-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=Qi}v>>>=2,S-=2;break;case 16193:for(v>>>=7&S,S-=7&S;S<32;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",r.mode=Qi;break}if(r.length=65535&v,v=0,S=0,r.mode=nL,t===LI)break e;case nL:r.mode=16195;case 16195:if(D=r.length,D){if(D>g&&(D=g),D>E&&(D=E),D===0)break e;c.set(o.subarray(u,u+D),f),g-=D,u+=D,E-=D,f+=D,r.length-=D;break}r.mode=qh;break;case 16196:for(;S<14;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(r.nlen=257+(31&v),v>>>=5,S-=5,r.ndist=1+(31&v),v>>>=5,S-=5,r.ncode=4+(15&v),v>>>=4,S-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=Qi;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;S<3;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}r.lens[qt[r.have++]]=7&v,v>>>=3,S-=3}for(;r.have<19;)r.lens[qt[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,at={bits:r.lenbits},Ce=fw(0,r.lens,0,19,r.lencode,0,r.work,at),r.lenbits=at.bits,Ce){e.msg="invalid code lengths set",r.mode=Qi;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;xe=r.lencode[v&(1<<r.lenbits)-1],j=xe>>>24,G=xe>>>16&255,z=65535&xe,!(j<=S);){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(z<16)v>>>=j,S-=j,r.lens[r.have++]=z;else{if(z===16){for(Zt=j+2;S<Zt;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(v>>>=j,S-=j,r.have===0){e.msg="invalid bit length repeat",r.mode=Qi;break}me=r.lens[r.have-1],D=3+(3&v),v>>>=2,S-=2}else if(z===17){for(Zt=j+3;S<Zt;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}v>>>=j,S-=j,me=0,D=3+(7&v),v>>>=3,S-=3}else{for(Zt=j+7;S<Zt;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}v>>>=j,S-=j,me=0,D=11+(127&v),v>>>=7,S-=7}if(r.have+D>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=Qi;break}for(;D--;)r.lens[r.have++]=me}}if(r.mode===Qi)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=Qi;break}if(r.lenbits=9,at={bits:r.lenbits},Ce=fw(1,r.lens,0,r.nlen,r.lencode,0,r.work,at),r.lenbits=at.bits,Ce){e.msg="invalid literal/lengths set",r.mode=Qi;break}if(r.distbits=6,r.distcode=r.distdyn,at={bits:r.distbits},Ce=fw(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,at),r.distbits=at.bits,Ce){e.msg="invalid distances set",r.mode=Qi;break}if(r.mode=UI,t===LI)break e;case UI:r.mode=VI;case VI:if(g>=6&&E>=258){e.next_out=f,e.avail_out=E,e.next_in=u,e.avail_in=g,r.hold=v,r.bits=S,ese(e,I),f=e.next_out,c=e.output,E=e.avail_out,u=e.next_in,o=e.input,g=e.avail_in,v=r.hold,S=r.bits,r.mode===qh&&(r.back=-1);break}for(r.back=0;xe=r.lencode[v&(1<<r.lenbits)-1],j=xe>>>24,G=xe>>>16&255,z=65535&xe,!(j<=S);){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(G&&(240&G)==0){for(ce=j,Ee=G,_e=z;xe=r.lencode[_e+((v&(1<<ce+Ee)-1)>>ce)],j=xe>>>24,G=xe>>>16&255,z=65535&xe,!(ce+j<=S);){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}v>>>=ce,S-=ce,r.back+=ce}if(v>>>=j,S-=j,r.back+=j,r.length=z,G===0){r.mode=16205;break}if(32&G){r.back=-1,r.mode=qh;break}if(64&G){e.msg="invalid literal/length code",r.mode=Qi;break}r.extra=15&G,r.mode=16201;case 16201:if(r.extra){for(Zt=r.extra;S<Zt;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}r.length+=v&(1<<r.extra)-1,v>>>=r.extra,S-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;xe=r.distcode[v&(1<<r.distbits)-1],j=xe>>>24,G=xe>>>16&255,z=65535&xe,!(j<=S);){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if((240&G)==0){for(ce=j,Ee=G,_e=z;xe=r.distcode[_e+((v&(1<<ce+Ee)-1)>>ce)],j=xe>>>24,G=xe>>>16&255,z=65535&xe,!(ce+j<=S);){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}v>>>=ce,S-=ce,r.back+=ce}if(v>>>=j,S-=j,r.back+=j,64&G){e.msg="invalid distance code",r.mode=Qi;break}r.offset=z,r.extra=15&G,r.mode=16203;case 16203:if(r.extra){for(Zt=r.extra;S<Zt;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}r.offset+=v&(1<<r.extra)-1,v>>>=r.extra,S-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=Qi;break}r.mode=16204;case 16204:if(E===0)break e;if(D=I-E,r.offset>D){if(D=r.offset-D,D>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=Qi;break}D>r.wnext?(D-=r.wnext,V=r.wsize-D):V=r.wnext-D,D>r.length&&(D=r.length),M=r.window}else M=c,V=f-r.offset,D=r.length;D>E&&(D=E),E-=D,r.length-=D;do c[f++]=M[V++];while(--D);r.length===0&&(r.mode=VI);break;case 16205:if(E===0)break e;c[f++]=r.length,E--,r.mode=VI;break;case rL:if(r.wrap){for(;S<32;){if(g===0)break e;g--,v|=o[u++]<<S,S+=8}if(I-=E,e.total_out+=I,r.total+=I,4&r.wrap&&I&&(e.adler=r.check=ca(r)?va(r.check,c,I,f-I):aw(r.check,c,I,f-I)),I=E,4&r.wrap&&(ca(r)?v:PG(v))!==r.check){e.msg="incorrect data check",r.mode=Qi;break}v=0,S=0}r.mode=16207;case 16207:if(r.wrap&&ca(r)){for(;S<32;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(4&r.wrap&&v!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=Qi;break}v=0,S=0}r.mode=16208;case 16208:Ce=ase;break e;case Qi:Ce=OG;break e;case 16210:return DG;default:return Al}return e.next_out=f,e.avail_out=E,e.next_in=u,e.avail_in=g,r.hold=v,r.bits=S,(r.wsize||I!==e.avail_out&&r.mode<Qi&&(r.mode<rL||t!==NG))&&VG(e,e.output,e.next_out,I-e.avail_out),R-=e.avail_in,I-=e.avail_out,e.total_in+=R,e.total_out+=I,r.total+=I,4&r.wrap&&I&&(e.adler=r.check=ca(r)?va(r.check,c,I,e.next_out-I):aw(r.check,c,I,e.next_out-I)),e.data_type=r.bits+(r.last?64:0)+(r.mode===qh?128:0)+(r.mode===UI||r.mode===nL?256:0),(R===0&&I===0||t===NG)&&Ce===Jg&&(Ce=cse),Ce},Kh={inflateReset:LG,inflateReset2:MG,inflateResetKeep:kG,inflateInit:e=>jG(e,15),inflateInit2:jG,inflate:use,inflateEnd:e=>{if(Zg(e))return Al;let t=e.state;return t.window&&(t.window=null),e.state=null,Jg},inflateGetHeader:(e,t)=>{if(Zg(e))return Al;const r=e.state;return(2&r.wrap)==0?Al:(r.head=t,t.done=!1,Jg)},inflateSetDictionary:(e,t)=>{const r=t.length;let o,c,u;return Zg(e)?Al:(o=e.state,o.wrap!==0&&o.mode!==jI?Al:o.mode===jI&&(c=1,c=aw(c,t,r,0),c!==o.check)?OG:(u=VG(e,t,r,r),u?(o.mode=16210,DG):(o.havedict=1,Jg)))},inflateInfo:"pako inflate (from Nodeca project)"},hse=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const FG=Object.prototype.toString,{Z_NO_FLUSH:pse,Z_FINISH:fse,Z_OK:mw,Z_STREAM_END:aL,Z_NEED_DICT:oL,Z_STREAM_ERROR:mse,Z_DATA_ERROR:BG,Z_MEM_ERROR:gse}=AI;function FI(e){this.options=OI.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new AG,this.strm.avail_out=0;let r=Kh.inflateInit2(this.strm,t.windowBits);if(r!==mw)throw new Error(Kg[r]);if(this.header=new hse,Kh.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=pw.string2buf(t.dictionary):FG.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Kh.inflateSetDictionary(this.strm,t.dictionary),r!==mw)))throw new Error(Kg[r])}function _se(e,t){const r=new FI(t);if(r.push(e),r.err)throw r.msg||Kg[r.err];return r.result}FI.prototype.push=function(e,t){const r=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,f,g;if(this.ended)return!1;for(f=t===~~t?t:t===!0?fse:pse,FG.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(o),r.next_out=0,r.avail_out=o),u=Kh.inflate(r,f),u===oL&&c&&(u=Kh.inflateSetDictionary(r,c),u===mw?u=Kh.inflate(r,f):u===BG&&(u=oL));r.avail_in>0&&u===aL&&r.state.wrap>0&&e[r.next_in]!==0;)Kh.inflateReset(r),u=Kh.inflate(r,f);switch(u){case mse:case BG:case oL:case gse:return this.onEnd(u),this.ended=!0,!1}if(g=r.avail_out,r.next_out&&(r.avail_out===0||u===aL))if(this.options.to==="string"){let E=pw.utf8border(r.output,r.next_out),v=r.next_out-E,S=pw.buf2string(r.output,E);r.next_out=v,r.avail_out=o-v,v&&r.output.set(r.output.subarray(E,E+v),0),this.onData(S)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(u!==mw||g!==0){if(u===aL)return u=Kh.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},FI.prototype.onData=function(e){this.chunks.push(e)},FI.prototype.onEnd=function(e){e===mw&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=OI.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ese={inflate:_se};const{deflate:yse}=Zie,{inflate:vse}=Ese;var Sse=yse,Tse=vse,HG=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(HG||{});class bse{constructor(){H(this,"_sequence",0),H(this,"_startTime",Date.now()),H(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const g=new Uint8Array(4);g.set([1,0,0,0]);const E={id:0,length:4,data:g.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[E]};r.commonPacketHeader.extension=1,r.extension=v,r.payload=this.compress(t),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;Z("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));const o=new ArrayBuffer(r.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let f=0;if(u.setUint16(f,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),f+=2,u.setUint32(f,r.commonPacketHeader.sequence,!0),f+=4,u.setUint16(f,r.commonStreamHeader,!0),f+=2,r.extension){const g=this.serializeExtension(r.extension);c.set(new Uint8Array(g),f),f+=g.byteLength}if(c.set(new Uint8Array(r.payload),f),f+=r.payload.byteLength,f!==r.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const r=new DataView(t);let o=0;const c=r.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:r.getUint16(o+2,!0)<<16|r.getUint16(o,!0)};let f,g;if(o+=4,Z("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(u))),r.getUint16(o,!0),o+=2,u.extension){g=this.deserializeExtension(t.slice(o)),o+=2+g.length,f=t.slice(o);let E=!1;if(g.datas.length>0){const v=g.datas.find(S=>S.id===0);v&&(E=(1&new DataView(v.data).getUint32(0,!0))==1)}f=E?this.decompress(f):f}else f=t.slice(8);return f}serializeExtension(t){const{profile:r,length:o,datas:c}=t,u=new ArrayBuffer(o+2),f=new Uint8Array(u),g=new DataView(u);let E=0;if(g.setUint8(E++,r),g.setUint8(E++,o),c.forEach(v=>{r?(g.setUint8(E++,v.id),g.setUint8(E++,v.length),f.set(new Uint8Array(v.data),E),E+=v.data.byteLength):(g.setUint8(E++,v.id|v.length<<4),f.set(new Uint8Array(v.data),E),E+=v.data.byteLength)}),E!==o+2)throw Error("serialize extension error, is ".concat(E,"!==").concat(o+2));return u}deserializeExtension(t){const r=new DataView(t);let o=0;const c=r.getUint8(o);o++;const u=r.getUint8(o);o++;const f=c===HG.TWO_BYTE,g=[],E=new DataView(t,2);let v=0;for(;v<u;){let S=0,R=0,I=new ArrayBuffer(0);f?(S=E.getUint8(v),v++,R=E.getUint8(v),v++):(S=15&E.getUint8(v),R=E.getUint8(v)>>4,v++),R>0&&(I=E.buffer.slice(v+2,v+2+R),v+=I.byteLength),g.push({id:S,length:R,data:I})}if(v!==u)throw Error("parse error");return{profile:c,length:u,datas:g}}decompress(t){return Tse(new Uint8Array(t))}compress(t){return Sse(new Uint8Array(t))}}const wse={name:"DataStream",create:(e,t)=>{const r=t?new One(e):new Dne(e);return r.useDataStream(new bse),r}};class Rse extends Dr{constructor(t,r,o){super(),H(this,"ws",void 0),H(this,"requestId",1),H(this,"heartBeatTimer",void 0),H(this,"joinInfo",void 0),H(this,"clientId",void 0),H(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),H(this,"onClose",c=>{this.emit("close"),this.dispose()}),H(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=t,this.clientId=r,this.ws=new Fb("cross-channel-".concat(this.clientId),o),this.ws.on(Wt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Wt.CONNECTED,this.onOpen),this.ws.on(Wt.ON_MESSAGE,this.onMessage),this.ws.on(Wt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const r=this.requestId++;return t.requestId=r,t.seq=r,this.ws.sendMessage(t),r}waitStatus(t){return new nt((r,o)=>{const c=window.setTimeout(()=>{o(new Te(q.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Te(q.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Te(q.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new Te(q.WS_DISCONNECT);const r=()=>new nt((f,g)=>{this.ws.once(Wt.CLOSED,()=>g(new Te(q.WS_ABORT))),this.ws.once(Wt.CONNECTED,f)});this.ws.state!=="connected"&&await r();const o=this.sendMessage(t),c=new nt((f,g)=>{const E=()=>{g(new Te(q.WS_ABORT))};this.ws.once(Wt.RECONNECTING,E),this.ws.once(Wt.CLOSED,E),this.once("req_".concat(o),f),is(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Wt.RECONNECTING,E),this.ws.off(Wt.CLOSED,E),g(new Te(q.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Te(q.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(t){this.ws.removeAllListeners(Wt.REQUEST_NEW_URLS),this.ws.on(Wt.REQUEST_NEW_URLS,r=>{r(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const r=this.requestId++;return t.requestId=r,this.ws.sendMessage(t),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Cse extends Dr{set state(t){t!==this._state&&(t!==no.RELAY_STATE_FAILURE&&(this.errorCode=$y.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,r,o,c,u){super(),H(this,"joinInfo",void 0),H(this,"sid",void 0),H(this,"clientId",void 0),H(this,"cancelToken",xa.CancelToken.source()),H(this,"workerToken",void 0),H(this,"requestId",0),H(this,"signal",void 0),H(this,"prevChannelMediaConfig",void 0),H(this,"httpRetryConfig",void 0),H(this,"_resolution",void 0),H(this,"_state",no.RELAY_STATE_IDLE),H(this,"errorCode",$y.RELAY_OK),H(this,"onStatus",f=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(f))),f&&f.command&&(f.command==="onAudioPacketReceived"&&this.emit("event",Hh.PACKET_RECEIVED_AUDIO_FROM_SRC),f.command==="onVideoPacketReceived"&&this.emit("event",Hh.PACKET_RECEIVED_VIDEO_FROM_SRC),f.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=$y.SRC_TOKEN_EXPIRED,this.state=no.RELAY_STATE_FAILURE),f.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=$y.DEST_TOKEN_EXPIRED,this.state=no.RELAY_STATE_FAILURE))}),H(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Hh.NETWORK_DISCONNECTED),this.state=no.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(f=>{this.state!==no.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",f.toString()),this.errorCode=$y.SERVER_CONNECTION_LOST,this.state=no.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=r,this.sid=kg(),this.signal=new Rse(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(t){if(this.state!==no.RELAY_STATE_IDLE)throw new Te(q.INVALID_OPERATION);this.state=no.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(r){throw r.data&&r.data.serverResponse&&r.data.serverResponse.command==="SetSourceChannel"?new Te(q.CROSS_CHANNEL_FAILED_JOIN_SRC):r.data&&r.data.serverResponse&&r.serverResponse.command==="SetDestChannelStatus"?new Te(q.CROSS_CHANNEL_FAILED_JOIN_DEST):r.data&&r.data.serverResponse&&r.serverResponse.command==="StartPacketTransfer"?new Te(q.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==no.RELAY_STATE_RUNNING)throw new Te(q.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==no.RELAY_STATE_RUNNING)throw new Te(q.INVALID_OPERATION);const r=this.genMessage(ya.SetVideoProfile);await this.signal.request(r),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=no.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=xa.CancelToken.source(),this.state=no.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await Mre(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Hh.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const r=this.genMessage(ya.StopPacketTransfer);await this.signal.request(r),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(ya.SetSdkProfile,t);await this.signal.request(o),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(ya.SetSourceChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Hh.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(ya.SetSourceUserId,t);await this.signal.request(u),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const f=this.genMessage(ya.SetDestChannel,t);await this.signal.request(f),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Hh.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const g=this.genMessage(ya.StartPacketTransfer,t);await this.signal.request(g),this.emit("event",Hh.PACKET_SENT_TO_DEST_CHANNEL),this.state=no.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const r=this.genMessage(ya.UpdateDestChannel,t);await this.signal.request(r),this.emit("event",Hh.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(ya.StopPacketTransfer);await this.signal.request(t),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,r){const o=[],c=[],u=[];this.requestId+=1;const f={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ac,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};f.sdkVersion==="4.23.3"&&(f.sdkVersion="0.0.1");let g=null,E=null;switch(t){case ya.SetSdkProfile:return f.clientRequest={command:"SetSdkProfile",type:"multi_channel"},f;case ya.SetSourceChannel:if(E=r&&r.getSrcChannelMediaInfo(),!E)throw new Te(q.UNEXPECTED_ERROR,"can not find source config");return f.clientRequest={command:"SetSourceChannel",uid:"0",channelName:E.channelName,token:E.token||this.joinInfo.appId},f;case ya.SetSourceUserId:if(E=r&&r.getSrcChannelMediaInfo(),!E)throw new Te(q.UNEXPECTED_ERROR,"can not find source config");return f.clientRequest={command:"SetSourceUserId",uid:E.uid+""},f;case ya.SetDestChannel:if(g=r&&r.getDestChannelMediaInfo(),!g)throw new Te(q.UNEXPECTED_ERROR,"can not find dest config");return g.forEach(v=>{o.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),f.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},f;case ya.StartPacketTransfer:return f.clientRequest={command:"StartPacketTransfer"},f;case ya.Reconnect:return f.clientRequest={command:"Reconnect"},f;case ya.StopPacketTransfer:return f.clientRequest={command:"StopPacketTransfer"},f;case ya.UpdateDestChannel:if(g=r&&r.getDestChannelMediaInfo(),!g)throw new Te(q.UNEXPECTED_ERROR,"can not find dest config");return g.forEach(v=>{o.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),f.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},f;case ya.SetVideoProfile:f.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return f}}const Ase={name:"ChannelMediaRelay",create:function(e){return new Cse(e.joinInfo,e.clientId,e.websocketRetryConfig||Si,e.httpRetryConfig||Si,e.resolution)}};function GG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function gw(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?GG(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):GG(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class Ise extends Dr{constructor(t,r,o,c){super(),H(this,"spec",void 0),H(this,"token",void 0),H(this,"websocket",void 0),H(this,"pingpongTimer",void 0),H(this,"reconnectMode","retry"),H(this,"serviceMode",void 0),H(this,"reqId",0),H(this,"commandReqId",0),H(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),H(this,"handleWebSocketMessage",u=>{if(!u.data)return;const f=JSON.parse(u.data);f.requestId?this.emit("@".concat(f.requestId,"-").concat(f.sid),f):(vt.workerEvent(this.spec.sid,{actionType:"status",serverCode:f.code,workerType:this.serviceMode===Bh.TRANSCODE?1:2}),this.emit(Sf.PUBLISH_STREAM_STATUS,f))}),this.spec=r,this.token=t,this.serviceMode=c,this.websocket=new Fb("live-streaming",o),this.websocket.on(Wt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Wt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Wt.REQUEST_NEW_URLS,(u,f)=>{gs(this,Sf.REQUEST_NEW_ADDRESS).then(u).catch(f)}),this.websocket.on(Wt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,r,o,c){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const u=this.commandReqId,f=this.reqId;if(!f||!this.websocket)throw new Te(q.UNEXPECTED_ERROR);const g=gw({command:t,sdkVersion:Ac==="4.23.3"?"0.0.1":Ac,seq:f,requestId:f,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if(this.websocket.state==="closed")throw new Te(q.WS_DISCONNECT);const E=()=>new nt((I,D)=>{this.websocket.once(Wt.CLOSED,()=>D(new Te(q.WS_ABORT))),this.websocket.once(Wt.CONNECTED,I)});this.websocket.state!=="connected"&&await E(),g.clientRequest&&(g.clientRequest.workerToken=this.token);const v=new nt((I,D)=>{const V=()=>{D(new Te(q.WS_ABORT))};this.websocket.once(Wt.RECONNECTING,V),this.websocket.once(Wt.CLOSED,V),this.once("@".concat(f,"-").concat(this.spec.sid),M=>{I(M)})});c&&vt.workerEvent(this.spec.sid,gw(gw({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(g);let R=null;try{R=await v}catch(I){if(this.websocket.state==="closed")throw I;return await E(),await this.request(t,r,o)}return c&&vt.workerEvent(this.spec.sid,gw(gw({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-S})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Ac==="4.23.3"?"0.0.1":Ac;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Oi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case Oi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Oi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Oi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Te(q.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Oi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new Te(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Oi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Te(q.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Oi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new Te(q.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Sf.WARNING,r,t.serverResponse.url)}case Oi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new Te(q.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Sf.WARNING,r,t.serverResponse.url)}case Oi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Te(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Oi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Te(q.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Oi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new Te(q.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Sf.WARNING,r,t.serverResponse.url)}case Oi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Te(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Oi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Te(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Oi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Oi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new Te(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Oi.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new Te(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new Te(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Oi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Oi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Oi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Oi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Te(q.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(NA)},6e3)}}function WG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function ro(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?WG(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):WG(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class Nse extends Dr{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Si,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Si;super(),H(this,"onLiveStreamWarning",void 0),H(this,"onLiveStreamError",void 0),H(this,"spec",void 0),H(this,"retryTimeout",1e4),H(this,"connection",void 0),H(this,"httpRetryConfig",void 0),H(this,"wsRetryConfig",void 0),H(this,"streamingTasks",new Map),H(this,"isStartingStreamingTask",!1),H(this,"taskMutex",new Ps("live-streaming")),H(this,"cancelToken",xa.CancelToken.source()),H(this,"transcodingConfig",void 0),H(this,"uapResponse",void 0),H(this,"lastTaskId",1),H(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=o,this.wsRetryConfig=r}async setTranscodingConfig(t){const r=ro(ro({},mre),t);r.videoCodecProfile!==66&&r.videoCodecProfile!==77&&r.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(r.videoCodecProfile," -> 100")),r.videoCodecProfile=100),r.transcodingUsers||(r.transcodingUsers=r.userConfigs),r.transcodingUsers&&(r.transcodingUsers=r.transcodingUsers.map(f=>ro(ro(ro({},fre),f),{},{zOrder:f.zOrder?f.zOrder+1:1}))),function(f){Br(f.width)||Jn(f.width,"config.width",0,1e4),Br(f.height)||Jn(f.height,"config.height",0,1e4),Br(f.videoBitrate)||Jn(f.videoBitrate,"config.videoBitrate",1,1e6),Br(f.videoFrameRate)||Jn(f.videoFrameRate,"config.videoFrameRate"),Br(f.lowLatency)||Uh(f.lowLatency,"config.lowLatency"),Br(f.audioSampleRate)||ki(f.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Br(f.audioBitrate)||Jn(f.audioBitrate,"config.audioBitrate",1,128),Br(f.audioChannels)||ki(f.audioChannels,"config.audioChannels",[1,2,3,4,5]),Br(f.videoGop)||Jn(f.videoGop,"config.videoGop"),Br(f.videoCodecProfile)||ki(f.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Br(f.userCount)||Jn(f.userCount,"config.userCount",0,17),Br(f.backgroundColor)||Jn(f.backgroundColor,"config.backgroundColor",0,16777215),Br(f.userConfigExtraInfo)||rs(f.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),f.transcodingUsers&&!Br(f.transcodingUsers)&&(Vh(f.transcodingUsers,"config.transcodingUsers"),f.transcodingUsers.forEach((g,E)=>{JA(g.uid),Br(g.x)||Jn(g.x,"transcodingUser[".concat(E,"].x"),0,1e4),Br(g.y)||Jn(g.y,"transcodingUser[".concat(E,"].y"),0,1e4),Br(g.width)||Jn(g.width,"transcodingUser[".concat(E,"].width"),0,1e4),Br(g.height)||Jn(g.height,"transcodingUser[".concat(E,"].height"),0,1e4),Br(g.zOrder)||Jn(g.zOrder-1,"transcodingUser[".concat(E,"].zOrder"),0,100),Br(g.alpha)||Jn(g.alpha,"transcodingUser[".concat(E,"].alpha"),0,1,!1)})),Br(f.watermark)||c1(f.watermark,"watermark"),Br(f.backgroundImage)||c1(f.backgroundImage,"backgroundImage"),f.images&&!Br(f.images)&&(Vh(f.images,"config.images"),f.images.forEach((g,E)=>{c1(g,"images[".concat(E,"]"))}))}(r);const o=[];r.images&&o.push(...r.images.map(f=>ro(ro(ro({},o1),f),{},{zOrder:255}))),r.backgroundImage&&(o.push(ro(ro(ro({},o1),r.backgroundImage),{},{zOrder:0})),delete r.backgroundImage),r.watermark&&(o.push(ro(ro(ro({},o1),r.watermark),{},{zOrder:255})),delete r.watermark),r.images=o,r.transcodingUsers&&(r.userConfigs=r.transcodingUsers.map(f=>ro({},f)),r.userCount=r.transcodingUsers.length,delete r.transcodingUsers);const c=(r.userConfigs||[]).map(f=>typeof f.uid=="number"?nt.resolve(f.uid):f6(f.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await nt.all(c)).forEach((f,g)=>{r.userConfigs&&r.userConfigs[g]&&(r.userConfigs[g].uid=f)}),this.transcodingConfig=r,this.connection)try{var u;const f=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Da(u=this.streamingTasks).call(u)).map(g=>g.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(f.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(f){if(!f.data||!f.data.retry)throw f;f.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(g=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),f.toString(),"try to republish",g.url),this.startLiveStreamingTask(g.url,g.mode,f).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(g.url," success"))}).catch(E=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),g.url,E.toString()),this.onLiveStreamError&&this.onLiveStreamError(g.url,E)})})}}async startLiveStreamingTask(t,r,o){if(!this.transcodingConfig&&r===Bh.TRANSCODE)throw new Te(q.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(r));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(t)&&!o)return u(),new Te(q.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r))}catch(g){throw u(),g}switch(r){case Bh.TRANSCODE:c.transcodingConfig=ro({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const f=this.lastTaskId++;try{const g=new nt((v,S)=>{is(this.retryTimeout).then(()=>{if(o)return S(o);const R=this.statusError.get(t);return R?(this.statusError.delete(t),S(R)):void 0})}),E=await nt.race([this.connection.request("request",{clientRequest:c},!0,{url:t,command:"PublishStream",workerType:r===Bh.TRANSCODE?1:2,requestByUser:!o,tid:f.toString()}),g]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(E.code)),this.streamingTasks.set(t,{clientRequest:c,mode:r,url:t,taskId:f}),u()}catch(g){if(u(),this.isStartingStreamingTask=!1,!g.data||!g.data.retry||o)throw g;return g.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,r,g)):await this.startLiveStreamingTask(t,r,g)}}stopLiveStreamingTask(t){return new nt((r,o)=>{const c=this.streamingTasks.get(t);if(!c||!this.connection)return new Te(q.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),r()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:t,command:"UnPublishStream",workerType:u===Bh.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(f=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(f.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),r()}).catch(o)})}resetAllTask(){var t;const r=Array.from(Da(t=this.streamingTasks).call(t));this.terminate();for(const o of r)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=xa.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new Te(q.UNEXPECTED_ERROR,"live streaming connection has already connected");const r=await gs(this,l1.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=r,this.connection=new Ise(r.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Sf.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(Sf.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Sf.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Te(q.UNEXPECTED_ERROR,"can not get new live streaming address list"));gs(this,l1.REQUEST_WORKER_MANAGER_LIST,t).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(r.addressList),this.connection}handlePublishStreamServer(t){const r=t.serverStatus&&t.serverStatus.url||"empty_url",o=this.streamingTasks.get(r),c=t.reason;switch(t.code){case Oi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Oi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Oi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Oi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const f=new Te(q.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(o)return x.error(f.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,f);if(!this.isStartingStreamingTask)return;this.statusError.set(r,f)}case Oi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const f=new Te(q.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,f)}case Oi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Oi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const f=Array.from(Da(u=this.streamingTasks).call(u));for(const g of f)g.abortTask?g.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",g.url),this.startLiveStreamingTask(g.url,g.mode,new Te(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),g.url)}).catch(E=>{x.error(E.toString()),this.onLiveStreamError&&this.onLiveStreamError(g.url,E)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const Ose={name:"LiveStreaming",create:function(e){return new Nse(e.joinInfo,e.websocketRetryConfig||Si,e.httpRetryConfig||Si)}};function Dse(e){let t=qG();return function(r,o){let c=r.appId;c!==void 0&&(Wn(o,10),bu(o,c));let u=r.cid;u!==void 0&&(Wn(o,16),Wn(o,u));let f=r.cname;f!==void 0&&(Wn(o,26),bu(o,f));let g=r.deviceId;g!==void 0&&(Wn(o,34),bu(o,g));let E=r.elapse;E!==void 0&&(Wn(o,40),Lf(o,E));let v=r.fileSize;v!==void 0&&(Wn(o,48),Lf(o,fv(v)));let S=r.height;S!==void 0&&(Wn(o,56),Lf(o,fv(S)));let R=r.jpg;R!==void 0&&(Wn(o,66),Wn(o,R.length),function(ja,Pe){let Ye=mv(ja,Pe.length);ja.bytes.set(Pe,Ye)}(o,R));let I=r.networkType;I!==void 0&&(Wn(o,72),Lf(o,fv(I)));let D=r.osType;D!==void 0&&(Wn(o,80),Lf(o,fv(D)));let V=r.requestId;V!==void 0&&(Wn(o,90),bu(o,V));let M=r.sdkVersion;M!==void 0&&(Wn(o,98),bu(o,M));let j=r.sequence;j!==void 0&&(Wn(o,104),Lf(o,fv(j)));let G=r.sid;G!==void 0&&(Wn(o,114),bu(o,G));let z=r.timestamp;z!==void 0&&(Wn(o,120),Lf(o,z));let ce=r.uid;ce!==void 0&&(Wn(o,128),Wn(o,ce));let Ee=r.vid;Ee!==void 0&&(Wn(o,136),Wn(o,Ee));let _e=r.width;_e!==void 0&&(Wn(o,144),Lf(o,fv(_e)));let me=r.service;me!==void 0&&(Wn(o,152),Wn(o,me));let Ce=r.callbackData;Ce!==void 0&&(Wn(o,162),bu(o,Ce));let xe=r.jpgEncryption;xe!==void 0&&(Wn(o,168),Wn(o,xe));let $e=r.requestType;$e!==void 0&&(Wn(o,176),Wn(o,$e));let at=r.scorePorn;at!==void 0&&(Wn(o,185),hL(o,at));let Zt=r.scoreSexy;Zt!==void 0&&(Wn(o,193),hL(o,Zt));let qt=r.scoreNeutral;qt!==void 0&&(Wn(o,201),hL(o,qt));let Pt=r.scene;Pt!==void 0&&(Wn(o,208),Wn(o,Pt));let hr=r.ossFilePrefix;hr!==void 0&&(Wn(o,218),bu(o,hr));let er=r.serviceVendor;if(er!==void 0)for(let ja of er){Wn(o,226);let Pe=qG();kse(ja,Pe),Wn(o,Pe.limit),Use(o,Pe),jse(Pe)}}(e,t),function(r){let o=r.bytes,c=r.limit;return o.length===c?o:o.subarray(0,c)}(t)}function xse(e){return function(r){let o={};e:for(;!KG(r);){let c=wu(r);switch(c>>>3){case 0:break e;case 1:o.code=wu(r);break;case 2:o.msg=XG(r,wu(r));break;case 3:{let u=Lse(r);o.data=Pse(r),r.limit=u;break}default:zG(r,7&c)}}return o}({bytes:t=e,offset:0,limit:t.length});var t}function Pse(e){let t={};e:for(;!KG(e);){let r=wu(e);switch(r>>>3){case 0:break e;case 1:t.requestId=XG(e,wu(e));break;case 2:t.requestType=wu(e)>>>0;break;case 3:t.scorePorn=uL(e);break;case 4:t.scoreSexy=uL(e);break;case 5:t.scoreNeutral=uL(e);break;case 6:t.requestScene=wu(e)>>>0;break;case 7:t.scene=wu(e)>>>0;break;default:zG(e,7&r)}}return t}function kse(e,t){let r=e.service;r!==void 0&&(Wn(t,8),Wn(t,r));let o=e.vendor;o!==void 0&&(Wn(t,16),Wn(t,o));let c=e.token;c!==void 0&&(Wn(t,26),bu(t,c));let u=e.callbackUrl;u!==void 0&&(Wn(t,34),bu(t,u))}function Lse(e){let t=wu(e),r=e.limit;return e.limit=e.offset+t,r}function zG(e,t){switch(t){case 0:for(;128&QG(e););break;case 2:lL(e,wu(e));break;case 5:lL(e,4);break;case 1:lL(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Mse=new Float32Array(1);new Uint8Array(Mse.buffer);let cL=new Float64Array(1),io=new Uint8Array(cL.buffer);function fv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let YG=[];function qG(){const e=YG.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function jse(e){YG.push(e)}function lL(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function KG(e){return e.offset>=e.limit}function mv(e,t){let r=e.bytes,o=e.offset,c=e.limit,u=o+t;if(u>r.length){let f=new Uint8Array(2*u);f.set(r),e.bytes=f}return e.offset=u,u>c&&(e.limit=u),o}function dL(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function XG(e,t){let r=dL(e,t),o=String.fromCharCode,c=e.bytes,u="",f="";for(let g=0;g<t;g++){let E,v,S,R,I=c[g+r];(128&I)==0?f+=o(I):(224&I)==192?g+1>=t?f+=u:(E=c[g+r+1],(192&E)!=128?f+=u:(R=(31&I)<<6|63&E,R<128?f+=u:(f+=o(R),g++))):(240&I)==224?g+2>=t?f+=u:(E=c[g+r+1],v=c[g+r+2],(49344&(E|v<<8))!=32896?f+=u:(R=(15&I)<<12|(63&E)<<6|63&v,R<2048||R>=55296&&R<=57343?f+=u:(f+=o(R),g+=2))):(248&I)==240?g+3>=t?f+=u:(E=c[g+r+1],v=c[g+r+2],S=c[g+r+3],(12632256&(E|v<<8|S<<16))!=8421504?f+=u:(R=(7&I)<<18|(63&E)<<12|(63&v)<<6|63&S,R<65536||R>1114111?f+=u:(R-=65536,f+=o(55296+(R>>10),56320+(1023&R)),g+=3))):f+=u}return f}function bu(e,t){let r=t.length,o=0;for(let f=0;f<r;f++){let g=t.charCodeAt(f);g>=55296&&g<=56319&&f+1<r&&(g=(g<<10)+t.charCodeAt(++f)-56613888),o+=g<128?1:g<2048?2:g<65536?3:4}Wn(e,o);let c=mv(e,o),u=e.bytes;for(let f=0;f<r;f++){let g=t.charCodeAt(f);g>=55296&&g<=56319&&f+1<r&&(g=(g<<10)+t.charCodeAt(++f)-56613888),g<128?u[c++]=g:(g<2048?u[c++]=g>>6&31|192:(g<65536?u[c++]=g>>12&15|224:(u[c++]=g>>18&7|240,u[c++]=g>>12&63|128),u[c++]=g>>6&63|128),u[c++]=63&g|128)}}function Use(e,t){let r=mv(e,t.limit),o=e.bytes,c=t.bytes;for(let u=0,f=t.limit;u<f;u++)o[u+r]=c[u]}function QG(e){return e.bytes[dL(e,1)]}function $G(e,t){let r=mv(e,1);e.bytes[r]=t}function uL(e){let t=dL(e,8),r=e.bytes;return io[0]=r[t++],io[1]=r[t++],io[2]=r[t++],io[3]=r[t++],io[4]=r[t++],io[5]=r[t++],io[6]=r[t++],io[7]=r[t++],cL[0]}function hL(e,t){let r=mv(e,8),o=e.bytes;cL[0]=t,o[r++]=io[0],o[r++]=io[1],o[r++]=io[2],o[r++]=io[3],o[r++]=io[4],o[r++]=io[5],o[r++]=io[6],o[r++]=io[7]}function wu(e){let t,r=0,o=0;do t=QG(e),r<32&&(o|=(127&t)<<r),r+=7;while(128&t);return o}function Wn(e,t){for(t>>>=0;t>=128;)$G(e,127&t|128),t>>>=7;$G(e,t)}function Lf(e,t){let r=t.low>>>0,o=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,u=c===0?o===0?r<16384?r<128?1:2:r<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,f=mv(e,u),g=e.bytes;switch(u){case 10:g[f+9]=c>>>7&1;case 9:g[f+8]=u!==9?128|c:127&c;case 8:g[f+7]=u!==8?o>>>21|128:o>>>21&127;case 7:g[f+6]=u!==7?o>>>14|128:o>>>14&127;case 6:g[f+5]=u!==6?o>>>7|128:o>>>7&127;case 5:g[f+4]=u!==5?128|o:127&o;case 4:g[f+3]=u!==4?r>>>21|128:r>>>21&127;case 3:g[f+2]=u!==3?r>>>14|128:r>>>14&127;case 2:g[f+1]=u!==2?r>>>7|128:r>>>7&127;case 1:g[f]=u!==1?128|r:127&r}}function JG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}const Vse=new Map([["moderation",1],["supervise",2]]);class Fse extends Dr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const r=this._connectionState;this._connectionState=t,this.emit(Xi.CONNECTION_STATE_CHANGE,r,t)}get inspectType(){return this._inspectType}set inspectType(t){var r;this._inspectMode=Xa(r=t.map(o=>Vse.get(o)||0)).call(r,(o,c)=>o+c),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),H(this,"name","AgoraRTCVideoContentInspect"),H(this,"_connectionState",vl.CONNECTING),H(this,"_innerConnectionState",void 0),H(this,"sequence",0),H(this,"inspectStartTime",void 0),H(this,"workerManagerConnection",void 0),H(this,"workerConnection",void 0),H(this,"workerMessageLengthLimit",void 0),H(this,"inspectIntervalMinimum",void 0),H(this,"qualityRatio",void 0),H(this,"_connectInfo",void 0),H(this,"_cancelTokenSource",xa.CancelToken.source()),H(this,"_retryConfig",void 0),H(this,"wmSequence",0),H(this,"inspectInterval",void 0),H(this,"inspectTimer",null),H(this,"ossFilePrefix",void 0),H(this,"extraInfo",void 0),H(this,"_inspectType",void 0),H(this,"_inspectMode",void 0),H(this,"_quality",1),H(this,"qualityTimer",null),H(this,"_inspectId",void 0),H(this,"_needWorkUrlOnly",!1),H(this,"inspectImage",()=>{if(this.connectionState!==vl.CONNECTED)throw new Te(q.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===vl.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=lr(5,"inspect-"),this.workerMessageLengthLimit=Z("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=Z("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=Z("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Fb("worker-manager-"+this._inspectId,Si),this.on(Xi.STATE_CHANGE,(r,o)=>{this._innerConnectionState=r,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Sl[r]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Fb("worker-"+this._inspectId,Si),this.handleWorkerEvents()}async init(t,r){this.emit(Xi.STATE_CHANGE,Sl.CONNECT_AP),this._connectInfo=t;const o=this._cancelTokenSource.token;return this._retryConfig=r,new nt((c,u)=>{this.on(Xi.CONNECTION_STATE_CHANGE,(f,g)=>{g===vl.CONNECTED&&c()}),this.requestAP(t,o,r).then(f=>{this.connectWorkerManager(f)}).catch(f=>{u(f)})})}async requestAP(t,r,o){const c=Z("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),u=await function(g,E,v,S){let{appId:R,areaCode:I,cname:D,sid:V,token:M,uid:j}=E;iv++;const G="image_moderation_api",z={service_name:G,json_body:JSON.stringify({appId:R,areaCode:I,cname:D,command:"allocateEdge",requestId:iv,seq:iv,sid:V,token:M,ts:Date.now(),uid:j+""})};let ce,Ee,_e=g[0];return ld(async()=>{ce=Date.now();const me=await fd(_e,{data:z,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ee=Date.now()-ce,me.code!==0){const at=new Te(q.UNEXPECTED_RESPONSE,"image inspect ap error, code"+me.code,{retry:!0,responseTime:Ee});throw x.error(at.toString()),at}const Ce=JSON.parse(me.json_body);if(Ce.code!==200){const at=new Te(q.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ce.code,", reason: ").concat(Ce.reason),{code:Ce.code,responseTime:Ee});throw x.error(at.toString()),at}if(!Ce.servers||!Array.isArray(Ce.servers)||Ce.servers.length===0){const at=new Te(q.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ce.code,responseTime:Ee});throw x.error(at.toString()),at}const xe=Z("VIDEO_INSPECT_WORKER_MANAGER_HOST"),$e=Z("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ce.servers.map(at=>{let{address:Zt,wss:qt}=at;if(Zt&&qt)return"wss://".concat(Zt.replace(/\./g,"-"),".").concat(xe,":").concat($e||qt)}).filter(at=>!!at),workerToken:Ce.workerToken,vid:Ce.vid,responseTime:Ee}},(me,Ce)=>(vt.apworkerEvent(V,{success:!0,sc:200,serviceName:G,responseDetail:JSON.stringify(me.addressList),firstSuccess:Ce===0,responseTime:Ee,serverIp:g[Ce%g.length]}),!1),(me,Ce)=>(vt.apworkerEvent(V,{success:!1,sc:me.data&&me.data.code||200,serviceName:G,responseTime:Ee,serverIp:g[Ce%g.length]}),!!(me.code!==q.OPERATION_ABORTED&&me.code!==q.UNEXPECTED_RESPONSE||me.data&&me.data.retry)&&(_e=g[(Ce+1)%g.length],!0)),S)}(c,t,r,o);this.emit(Xi.STATE_CHANGE,Sl.AP_CONNECTED);const{addressList:f}=u;return this.wmSequence++,f}async connectWorkerManager(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(Xi.STATE_CHANGE,Sl.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Wt.CONNECTED,async()=>{this.emit(Xi.STATE_CHANGE,Sl.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.3",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Wt.CLOSED,()=>{this._innerConnectionState<Sl.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Wt.FAILED,()=>{this._innerConnectionState<Sl.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Wt.RECONNECTING,()=>{this._innerConnectionState<Sl.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Wt.ON_MESSAGE,async t=>{this.emit(Xi.STATE_CHANGE,Sl.GET_WORKER_MANAGER_RESPONSE);const r=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(t.data);if(o.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Te(q.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&r))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Te(q.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=Z("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=r.replace(/:\d+\/?$/,":".concat(c));this.emit(Xi.STATE_CHANGE,Sl.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(Xi.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Wt.WILL_RECONNECT,(t,r,o)=>{o(t)}),this.workerManagerConnection.on(Wt.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}handleWorkerEvents(){this.workerConnection.on(Wt.CONNECTED,async()=>{this.emit(Xi.STATE_CHANGE,Sl.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=vl.CONNECTED}),this.workerConnection.on(Wt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const o=xse(new Uint8Array(t.data));if(Z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Xi.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var r;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=Xa(r=Object.keys(c)).call(r,(g,E)=>c[g]>c[E]?g:E,"porn"),f=Object.keys(c).find(g=>g===u);this.emit(Xi.INSPECT_RESULT,f)}else this.emit(Xi.INSPECT_RESULT,void 0,new Te(q.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(Xi.INSPECT_RESULT,void 0,new Te(q.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Xi.INSPECT_RESULT,void 0,new Te(q.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Wt.CLOSED,()=>{this.connectionState=vl.CLOSED}),this.workerConnection.on(Wt.FAILED,()=>{this.connectionState=vl.CLOSED}),this.workerConnection.on(Wt.RECONNECTING,()=>{this.connectionState=this.connectionState===vl.CONNECTED?vl.RECONNECTING:vl.CONNECTING}),this.workerConnection.on(Wt.WILL_RECONNECT,(t,r,o)=>{t==="recover"&&o(t),o("tryNext")}),this.workerConnection.on(Wt.REQUEST_NEW_URLS,(t,r)=>{this.workerManagerConnection.close(),this.once(Xi.REQUEST_NEW_WORKER_URL,o=>{t([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{r(o)})})}async requestToInspectImage(){this.sequence++;const t=$o(this,Xi.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Xi.INSPECT_RESULT,void 0,new Te(q.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(t,r);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(Xi.INSPECT_RESULT,void 0,new Te(q.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,r){let{appId:o,cname:c,cid:u,vid:f,sid:g,uid:E}=r;const v=Date.now(),S=await t.getCurrentFrameImage("image/jpeg",this.quality),R=await k4(S,o,c),I=this.sequence+"-"+u+"-"+E+"-"+v+"-"+lr(12,""),D={appId:o,cid:u,cname:c,deviceId:"",elapse:(V=Number(v-this.inspectStartTime),{low:V|=0,high:V>>31,unsigned:V>=0}),fileSize:R.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:I,sdkVersion:"4.23.3",sequence:this.sequence,sid:g,timestamp:aH(v),uid:E,vid:f,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var V;this.extraInfo===void 0&&delete D.callbackData,this.ossFilePrefix===void 0&&delete D.ossFilePrefix;const M=Dse(D);if(M.byteLength<this.workerMessageLengthLimit){if(Z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const j=function(G){for(var z=1;z<arguments.length;z++){var ce=arguments[z]!=null?arguments[z]:{};z%2?JG(Object(ce),!0).forEach(function(Ee){H(G,Ee,ce[Ee])}):Object.getOwnPropertyDescriptors?Object.defineProperties(G,Object.getOwnPropertyDescriptors(ce)):JG(Object(ce)).forEach(function(Ee){Object.defineProperty(G,Ee,Object.getOwnPropertyDescriptor(ce,Ee))})}return G}({},D);delete j.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return M}{const j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(t,{appId:o,cname:c,cid:u,vid:f,sid:g,uid:E})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=xa.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=vl.CLOSED,this.emit(Xi.STATE_CHANGE,Sl.CLOSED)}}const Bse={name:"ContentInspect",create:function(e){let{config:t}=e;return function(r){if(!r)throw new Te(q.INVALID_PARAMS,"inspectConfig is necessary.");if(!r.inspectType||!Array.isArray(r.inspectType))throw new Te(q.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(r.inspectType)];o.forEach(c=>{var u;if(!et(u=["supervise","moderation"]).call(u,c))throw new Te(q.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),r.inspectType=o}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new Te(q.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Fse(t)}};var ZG=l(Gt.Object.getOwnPropertySymbols),Hse=xn,Gse=Ho.indexOf,Wse=ih,pL=oe([].indexOf),eW=!!pL&&1/pL([1],1,-0)<0;Hse({target:"Array",proto:!0,forced:eW||!Wse("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return eW?pL(this,e,t)||0:Gse(this,e,t)}});var zse=vo("Array","indexOf"),Yse=U,qse=zse,fL=Array.prototype,Kse=function(e){var t=e.indexOf;return e===fL||Yse(fL,e)&&t===fL.indexOf?qse:t},tW=l(Kse);function Xse(e,t){if(e==null)return{};var r,o,c=function(f,g){if(f==null)return{};var E={};for(var v in f)if({}.hasOwnProperty.call(f,v)){if(tW(g).call(g,v)!==-1)continue;E[v]=f[v]}return E}(e,t);if(ZG){var u=ZG(e);for(o=0;o<u.length;o++)r=u[o],tW(t).call(t,r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(c[r]=e[r])}return c}let nW=class{get localCapabilities(){return xr(this._localCapabilities)}get rtpCapabilities(){return xr(this._rtpCapabilities)}get candidates(){return xr(this._candidates)}get iceParameters(){return xr(this._iceParameters)}get dtlsParameters(){return xr(this._dtlsParameters)}constructor(e){H(this,"sessionDesc",void 0),H(this,"_localCapabilities",void 0),H(this,"_rtpCapabilities",void 0),H(this,"_candidates",void 0),H(this,"_iceParameters",void 0),H(this,"_dtlsParameters",void 0),H(this,"setup",void 0),H(this,"currentMidIndex",void 0),H(this,"cname","o/i14u9pJrxRKAsu"),H(this,"firefoxSsrcMidMap",new Map),e=xr(e);const{remoteIceParameters:t,remoteDtlsParameters:r,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:f,setup:g,videoCodec:E,audioCodec:v}=e;let S;this.setup=g,S=f===Ea.RECEIVE_ONLY?to(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):to(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=u;const R=f===Ea.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,I=f===Ea.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,D=f===Ea.RECEIVE_ONLY?c.send.videoCodecs:Gb(lt.VIDEO,R,I,E),V=f===Ea.RECEIVE_ONLY?c.send.audioCodecs:Gb(lt.AUDIO,R,I,v);for(const M of S.mediaDescriptions)M.attributes.iceUfrag=t.iceUfrag,M.attributes.icePwd=t.icePwd,M.attributes.fingerprints=r.fingerprints,M.attributes.candidates=o,M.attributes.setup=this.setup,M.media.mediaType==="application"&&(M.attributes.sctpPort="5000"),M.media.mediaType==="video"&&(M.media.fmts=D.map(j=>j.payloadType.toString(10)),M.attributes.payloads=D,M.attributes.extmaps=R.videoExtensions),M.media.mediaType==="audio"&&(M.media.fmts=V.map(j=>j.payloadType.toString(10)),M.attributes.payloads=V,M.attributes.extmaps=R.audioExtensions,rv(M));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return vf(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,r,o,c){r=r.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:f}=Gg(t,this.cname,Z("SYNC_GROUP")?r:void 0),g=this.findPreloadMediaDesc(u);if(g){if(Fr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,g.attributes.mid),c&&(c.twcc||c.remb)){const E=this.sessionDesc.mediaDescriptions.indexOf(g);return this.sessionDesc.mediaDescriptions[E]=this.mungSendMediaDesc(g,c),{mid:g.attributes.mid,needExchangeSDP:!0}}return{mid:g.attributes.mid,needExchangeSDP:!1}}{const E=this.findAvailableMediaIndex(e,u,o);let v;return E===-1?(v=this.createOrRecycleSendMedia(e,u,f,"sendonly",o,c),this.updateBundleMids()):(v=xr(this.sessionDesc.mediaDescriptions[E]),v.attributes.direction="sendonly",v.attributes.ssrcs=u,v.attributes.ssrcGroups=f,this.sessionDesc.mediaDescriptions[E]=this.mungSendMediaDesc(v,c)),Fr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,r){const o=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,f=this.findAvailableRecvMediaIndex(u);let g,E=!1;f===-1?(E=!0,g=this.createOrRecycleRecvMedia(c,[],"recvonly",t,r),this.updateBundleMids()):(g=xr(this.sessionDesc.mediaDescriptions[f]),g.attributes.direction="recvonly"),o.push({mid:g.attributes.mid,needCreateTransceiver:E})}),o}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:r,address:o,port:c,type:u,relatedAddress:f,relatedPort:g,priority:E}=new RTCIceCandidate(e),v={foundation:t??"",componentId:"1",transport:r??"",priority:E?E+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:f??"",relPort:g?g+"":"",extension:{}};this.candidates.some(S=>S.priority===v.priority&&S.connectionAddress===v.connectionAddress&&S.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,r,o,c){const u=e._mediaStreamTrack.kind,f=this.rtpCapabilities.recv,g=Gb(u,f,this.localCapabilities.send,u===lt.AUDIO?c:o),E=u===lt.VIDEO?f.videoExtensions:f.audioExtensions,v="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:E,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};S=this.mungRecvMediaDsec(S,e);const R=this.findFirstClosedMedia(u);if(R){const I=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[I]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>et(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>et(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,r){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Fr()){if(c){const u=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===r})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const r=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&r})}predictReceivingMids(e){const t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}restartICE(e){e=xr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,r,o,c,u){const f=this.rtpCapabilities.send,g=e===lt.VIDEO?f.videoCodecs:f.audioCodecs,E=e===lt.VIDEO?f.videoExtensions:f.audioExtensions;Fr()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:E,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,u);const S=this.findFirstClosedMedia(e);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(e,t,r){const o=xr(e);return m1(o),nv(o,t),g1(o,t),K9(o),sI(o,r,this.localCapabilities.send),o}mungSendMediaDesc(e,t){const r=xr(e);return sI(r,t,this.localCapabilities.recv),rv(r),r}updateRecvMedia(e,t){const r=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(r!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Fr()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const Qse=["sdp"];var _r;function rW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Mf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rW(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rW(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let iW=(_r=class Rv extends O9{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,r,o){super(t,r),H(this,"direction",void 0),H(this,"name",void 0),H(this,"store",void 0),H(this,"spec",void 0),H(this,"peerConnection",void 0),H(this,"initialOffer",void 0),H(this,"transport",void 0),H(this,"statsFilter",void 0),H(this,"localCandidateCount",0),H(this,"_isInRestartIce",!1),H(this,"mutex",void 0),H(this,"onLocalCandidate",void 0),H(this,"remoteSDP",void 0),H(this,"pendingCandidates",[]),H(this,"localCapabilities",void 0),H(this,"isReady",!1),H(this,"restartCnt",0),H(this,"curTurnServerIndex",0),this.store=r,this.spec=t,this.mutex=new Ps("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(Rv.resolvePCConfiguration(t,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??Ea.SEND_ONLY,this.name=this.direction===Ea.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Ik(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,Fr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const r=await Q9();if(this.localCapabilities=aI(r),t){const{sdp:o}=t,c=Xse(t,Qse),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=Hb(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},V={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Tl(R,S,"videoExtensions",I,D,V),Tl(R,S,"videoCodecs",I,D,V),Tl(R,S,"audioExtensions",I,D,V),Tl(R,S,"audioCodecs",I,D,V),Z("RAISE_H264_BASELINE_PRIORITY")){const M=V.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(M!==-1){const j=V.videoCodecs.findIndex(G=>G.rtpMap&&G.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<M){x.debug("raising H264 baseline profile priority");const G=V.videoCodecs[M];V.videoCodecs.splice(M,1),V.videoCodecs.splice(j,0,G)}j!==-1&&Z("FILTER_SEND_H264_BASELINE")&&(I.videoCodecs=I.videoCodecs.filter(G=>!(G.rtpMap&&G.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&G.fmtp&&G.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:I,recv:D,sendrecv:V}}({},{},o);this.remoteSDP=new nW({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const f=await this.peerConnection.createAnswer();if(!f.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const g=Rf(f.sdp);await this.peerConnection.setLocalDescription(f);const E=await $9({},{},f.sdp);this.localCapabilities=aI(E);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),Mf(Mf({},g),{},{sdp:f.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Rf(o.sdp);return this.initialOffer=o,Mf(Mf({},c),{},{sdp:o.sdp})}}catch(r){throw new Ae(q.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:r,iceParameters:o,dtlsParameters:c}=t,u=await $9({},{},r);this.remoteSDP=new nW({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const f=this.peerConnection.getTransceivers()[0];f!=null&&f.sender&&f.sender.transport&&this.tryBindTransportEvents(f.sender.transport)}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(r=>{this.peerConnection.addIceCandidate(r)}),this.pendingCandidates=[])}catch(r){throw new Ae(q.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r.toString()))}}send(t,r,o){var c=this;return Cc(function*(){const u=yield Cn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const f=[],g=c.remoteSDP.receive(t,r,o);t.forEach((j,G)=>{if(g[G].needCreateTransceiver){const z=c.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});f.push(z),j._updateRtpTransceiver(z)}else{const z=c.peerConnection.getTransceivers().find(ce=>ce.mid===g[G].mid);if(!z)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(g[G].mid));f.push(z),j._updateRtpTransceiver(z)}}),Fr()&&Z("SIMULCAST")===!0&&(yield Cn(c.applySimulcastForFirefox(f,t)));const E=g.map(j=>j.mid),v=yield Cn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(v.sdp,t,E),R=to(S),I=E.map(j=>{const G=R.mediaDescriptions.find(z=>z.attributes.mid===j);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return z9(G,Z("USE_PUB_RTX"))}),D=f.map((j,G)=>{const z=E[G];return{localSSRC:I[G],id:z}});yield Cn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield D}catch(j){const G=c.remoteSDP.toString();throw yield Cn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Cn(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),yield Cn(c.stopSending(E,!0)),j}yield Cn(c.applySimulcastEncodings(f,t)),yield Cn(c.applySendEncodings(f,t));const V=c.remoteSDP.toString(),M=c.logSDPExchange(S,"offer","local","send");return M==null||M(V),yield Cn(c.setRemoteDescription({type:"answer",sdp:V})),f.map((j,G)=>{const z=E[G];return{localSSRC:I[G],id:z}})}catch(f){throw f instanceof Ae?f:new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(f.toString()))}finally{u()}})()}async stopSending(t,r){const o=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(E=>t.indexOf(E.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));c.map(E=>{var v;E.direction="inactive",(v=E.stop)===null||v===void 0||v.call(E)});const u=await this.peerConnection.createOffer(),f=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(t);const g=this.remoteSDP.toString();f==null||f(g),await this.setRemoteDescription({type:"answer",sdp:g})}catch(c){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(t,r,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:u,needExchangeSDP:f}=this.remoteSDP.send(t,r,o,c);if(f){const E=this.remoteSDP.toString(),v=this.logSDPExchange(E,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:E});const S=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(S.sdp,u,t);v==null||v(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const g=this.peerConnection.getTransceivers().find(E=>E.mid===u);if(!g||g.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:g.receiver.track,mid:g.mid,transceiver:g}}catch(u){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(t,r,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:u,needExchangeSDP:f}=this.remoteSDP.send(t,r,o,c);if(f){const g=this.remoteSDP.toString(),E=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const v=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(v.sdp,u,t);E==null||E(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(u){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Lg.Auto&&(this.store.p2pTransport=Lg.SdRtn,In().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Rv.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,In().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Rv.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const r=await this.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Rf(r.sdp);return this.store.descriptionStart(),this.direction===Ea.SEND_ONLY&&await this.peerConnection.setLocalDescription(r),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Ea.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Rf(r.sdp);return await this.peerConnection.setLocalDescription(r),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const u=this.remoteSDP.toString(),f=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),f==null||f(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ae(q.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,r){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===t);o.length===1&&(this.isVP8Simulcast(r)?Fr()||await this.applySimulcastEncodings(o,[r]):await this.applySendEncodings(o,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const o=this.peerConnection.getTransceivers().find(c=>c.mid===r);o&&await o.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:o,remote:c}=r.getSelectedCandidatePair();return{local:Mf(Mf({},du),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Mf(Mf({},du),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,r;et(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var r;t.candidate.candidate&&((r=this.onLocalCandidate)===null||r===void 0||r.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,r){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return t.iceServers?c.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Ib(t.turnServer.servers)?c.iceServers=t.turnServer.servers:(c.iceServers&&c.iceServers.push(...Rv.turnServerConfigToIceServers(t.turnServer.servers,r,o)),Z("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&t.turnServer.serversFromGateway&&c.iceServers.push(...Rv.turnServerConfigToIceServers(t.turnServer.serversFromGateway,r,o)),et(u=[Lg.Relay,Lg.SdRtn]).call(u,r)&&(c.iceTransportPolicy="relay"),Z("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(f=>{f.forceturn&&(c.iceTransportPolicy="relay")}))),Z("ENABLE_ENCODED_TRANSFORM")&&In().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(r)),c}static turnServerConfigToIceServers(t,r){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=t.filter(g=>g.tcpport);x.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const f=u.length>o?u[o]:u[0];switch(r){case Lg.SdRtn:const g=t.filter(v=>{var S;return et(S=v.username).call(S,"glb:")&&v.turnServerURL==v.turnServerURL}),E=g.length>o?g[o]:g[0];E&&(c.push({username:E.username,credential:E.password,credentialType:"password",urls:"turn:".concat(bf(E.turnServerURL),":").concat(E.tcpport,"?transport=udp")}),c.push({username:E.username,credential:E.password,credentialType:"password",urls:"turns:".concat(bf(E.turnServerURL),":").concat(E.tcpport,"?transport=tcp")}));break;case Lg.Relay:f&&(c.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(f.turnServerURL,":").concat(f.tcpport,"?transport=udp")}),c.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(bf(f.turnServerURL),":").concat(f.tcpport,"?transport=tcp")}));break;default:f&&(c.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(f.turnServerURL,":").concat(f.tcpport,"?transport=udp")}),c.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(bf(f.turnServerURL),":").concat(f.tcpport,"?transport=tcp")}),c.push({username:f.username,credential:f.password,credentialType:"password",urls:"stun:".concat(f.turnServerURL,":").concat(f.tcpport)}))}return c}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var o;t!=null&&t.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,t.state))},t.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const r=t.iceTransport;r&&(r.onstatechange=()=>{const o=t==null?void 0:t.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:o,remote:c}=r.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var o;if(r||(r=this.peerConnection.getSenders().find(S=>S.track===t._mediaStreamTrack)),!r)return x.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!In().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(t._encoderConfig){var f;const{bitrateMax:S,frameRate:R,scaleResolutionDownBy:I}=t._encoderConfig;S&&(u.maxBitrate=1e3*S),et(f=t._hints).call(f,Zn.LOW_STREAM)&&(R&&(u.maxFramerate=Do(R)),I&&I>=1&&(u.scaleResolutionDownBy=I))}if(Z("DSCP_TYPE")&&jh()){var g;const S=Z("DSCP_TYPE");et(g=["very-low","low","medium","high"]).call(g,S)&&(u.networkPriority=S)}const E=r.getParameters(),v=(o=E.encodings)===null||o===void 0?void 0:o[0];Fr()&&!v&&(c.encodings=[u]),v&&Object.assign(v,u),Object.assign(E,c),x.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(E.encodings))),await r.setParameters(E)}async applySendEncodings(t,r){try{if(!In().supportSetRtpSenderParameters||t.length!==r.length)return;for(let o=0;o<t.length;o++){const c=t[o],u=r[o];u instanceof gr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,o){const c=to(t);return r.forEach((u,f)=>{const g=o[f],E=c.mediaDescriptions.find(v=>v.attributes.mid===g);E&&(nv(E,u),X9(E,u,this.store.codec))}),vf(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let E=0;E<t.length;E++){var o,c,u,f,g;const v=t[E],S=r[E];if(S instanceof gr&&!et(o=S._hints).call(o,Zn.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(f=S._scalabilityMode)!==null&&f!==void 0&&f.numSpatialLayers&&((g=S._scalabilityMode)===null||g===void 0?void 0:g.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},I={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const D=v.sender.getParameters();await v.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(t,r){if(!Fr()&&t.length===r.length)for(let o=0;o<t.length;o++){const c=r[o];if(c instanceof gr&&this.isVP8Simulcast(c)){const u=t[o],f={},g={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:g.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:g.medium,scaleResolutionDownBy:4}];const E=u.sender.getParameters();await u.sender.setParameters(Object.assign(E,f))}}}isVP8Simulcast(t){var r,o,c,u,f;return!!(t instanceof gr&&Z("SIMULCAST")&&this.store.codec==="vp8"&&!et(r=t._hints).call(r,Zn.LOW_STREAM)&&(o=t._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=t._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((f=t._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1)}logSDPExchange(t,r,o,c){if(Z("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(r," SDP during P2PConnection.").concat(c,`
`),t),r==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(f=>f.mid&&t.indexOf(f.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(f=>{f.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(t);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(f=>f.mid&&t.indexOf(f.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async f=>{f.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(t);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}async getRemoteSSRC(t,r){var o;if(r=r??((o=this.currentRemoteDescription)===null||o===void 0?void 0:o.sdp)){var c;const u=(c=to(r).mediaDescriptions.find(f=>f.attributes.mid===t))===null||c===void 0?void 0:c.attributes.ssrcs;return u==null?void 0:u[0].ssrcId}}async setRemoteDescription(t){var r;await this.peerConnection.setRemoteDescription(t),et(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,r,o){const c=to(t),u=c.mediaDescriptions.find(f=>f.attributes.mid===r);return u&&o===lt.AUDIO&&u.media.mediaType==="audio"&&rv(u),vf(c)}},_t(_r.prototype,"establish",[Il],Object.getOwnPropertyDescriptor(_r.prototype,"establish"),_r.prototype),_t(_r.prototype,"connect",[Il],Object.getOwnPropertyDescriptor(_r.prototype,"connect"),_r.prototype),_t(_r.prototype,"receive",[Il],Object.getOwnPropertyDescriptor(_r.prototype,"receive"),_r.prototype),_t(_r.prototype,"mockReceive",[Il],Object.getOwnPropertyDescriptor(_r.prototype,"mockReceive"),_r.prototype),_t(_r.prototype,"stopReceiving",[Il],Object.getOwnPropertyDescriptor(_r.prototype,"stopReceiving"),_r.prototype),_t(_r.prototype,"restartICE",[Il],Object.getOwnPropertyDescriptor(_r.prototype,"restartICE"),_r.prototype),_t(_r.prototype,"close",[Il],Object.getOwnPropertyDescriptor(_r.prototype,"close"),_r.prototype),_t(_r.prototype,"updateEncoderConfig",[Il],Object.getOwnPropertyDescriptor(_r.prototype,"updateEncoderConfig"),_r.prototype),_t(_r.prototype,"updateSendParameters",[Il],Object.getOwnPropertyDescriptor(_r.prototype,"updateSendParameters"),_r.prototype),_t(_r.prototype,"replaceTrack",[Il],Object.getOwnPropertyDescriptor(_r.prototype,"replaceTrack"),_r.prototype),_t(_r.prototype,"muteLocal",[Il],Object.getOwnPropertyDescriptor(_r.prototype,"muteLocal"),_r.prototype),_t(_r.prototype,"unmuteLocal",[Il],Object.getOwnPropertyDescriptor(_r.prototype,"unmuteLocal"),_r.prototype),_r);function Il(e,t,r){const o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(t));try{for(var f=arguments.length,g=new Array(f),E=0;E<f;E++)g[E]=arguments[E];return await o.apply(this,g)}finally{u()}},r}let gd=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var sW,aW,oW,cW,lW,dW,uW,hW,pW,fW,mW,Or;function gW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function BI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gW(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gW(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let $se=(sW=_d(gd.SEND_ONLY),aW=_d(gd.SEND_ONLY),oW=_d(),cW=_d(gd.RECEIVE_ONLY),lW=_d(gd.RECEIVE_ONLY),dW=_d(gd.RECEIVE_ONLY),uW=_d(gd.RECEIVE_ONLY),hW=_d(gd.RECEIVE_ONLY),pW=_d(gd.RECEIVE_ONLY),fW=_d(),mW=_d(gd.RECEIVE_ONLY),Or=class extends Dr{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Rt.StateChange,t,this._state)}constructor(e,t){super(),H(this,"isPlanB",!1),H(this,"store",void 0),H(this,"statsUploader",void 0),H(this,"sendConnection",void 0),H(this,"recvConnection",void 0),H(this,"localTrackMap",new Map),H(this,"remoteUserMap",new Map),H(this,"localDataChannels",[]),H(this,"pendingLocalTracks",[]),H(this,"pendingRemoteTracks",[]),H(this,"statsCollector",void 0),H(this,"dtlsFailedCount",0),H(this,"sendMutex",void 0),H(this,"recvMutex",void 0),H(this,"_state",Bn.Disconnected),H(this,"_restartStates",["disconnected","failed"]),H(this,"reconnectInterval",void 0),H(this,"uploadUnplinkStarted",!1),H(this,"uploadDownlinkStarted",!1),H(this,"uplinkStateUploadInterval",void 0),H(this,"downlinkStatsUploadInterval",void 0),H(this,"handleMuteLocalTrack",async(r,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Bn.Connected)return void c(new Ae(q.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const E=this.filterTobeMutedTracks(r);if(E.length===0)return void o();const v=E.find(D=>D[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(E.map(D=>{let[,{id:V}]=D;return V}));let S=!1;var f,g;r.trackMediaType==="video"?S=!((f=this.localTrackMap.get(Ve.LocalAudioTrack))===null||f===void 0||!f.track._muted):S=((g=this.localTrackMap.get(Ve.LocalVideoTrack))===null||g===void 0?void 0:g.id)===void 0;const R=this.createMuteMessage(E);await ir(this,Rt.RequestMuteLocal,R);const I=r.trackMediaType==="video"?Tf.MUTE_LOCAL_VIDEO:Tf.MUTE_LOCAL_AUDIO;await ir(this,Rt.RequestP2PMuteLocal,{action:I,message:R,isMuteAll:S}),o()}catch(E){c(E)}finally{u()}}),H(this,"handleUnmuteLocalTrack",async(r,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Bn.Connected)return void c(new Ae(q.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const f=this.filterTobeUnmutedTracks(r);if(f.length===0)return void o();await this.sendConnection.unmuteLocal(f.map(v=>{let[,{id:S}]=v;return S}));const g=this.createUnmuteMessage(f),E=r.trackMediaType==="video"?Tf.UNMUTE_LOCAL_VIDEO:Tf.UNMUTE_LOCAL_AUDIO;await ir(this,Rt.RequestP2PMuteLocal,{action:E,message:g}),o()}catch(f){c(f)}finally{u()}}),H(this,"handleUpdateVideoEncoder",async(r,o,c,u)=>{let f;typeof u=="boolean"&&u||(f=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const E=this.localTrackMap.get(Ve.LocalVideoTrack);if(!this.sendConnection||!E||E.track!==r||this.state!==Bn.Connected)return void o();const{id:v,track:S}=E;v&&(await this.sendConnection.updateSendParameters(v,S),await this.sendConnection.updateEncoderConfig(v,S),this.emit(Rt.UpdateVideoEncoder,S)),o()}catch(E){c(E)}finally{var g;(g=f)===null||g===void 0||g()}}),H(this,"handleUpdateVideoSendParameters",async(r,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const f=this.localTrackMap.get(Ve.LocalVideoTrack);if(!this.sendConnection||!f||f.track!==r||this.state!==Bn.Connected)return void o();const{id:g,track:E}=f;g&&await this.sendConnection.updateSendParameters(g,E),o()}catch(f){c(f)}finally{u()}}),H(this,"handleReplaceTrack",async(r,o,c,u)=>{let f;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof u=="boolean"&&u||(f=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var g;const v=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return r===R});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==Bn.Connected)return void o();if(await((g=this.sendConnection)===null||g===void 0?void 0:g.replaceTrack(r,v[1].id)),v[0]===Ve.LocalVideoTrack&&In().supportDualStreamEncoding){const S=this.localTrackMap.get(Ve.LocalVideoLowTrack);if(S){const R=r._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new nt((I,D)=>{this.handleReplaceTrack(S.track,I,D,!0)})}}o()}catch(v){c(v)}finally{var E;(E=f)===null||E===void 0||E()}}),H(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),H(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),H(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),H(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new k6(e),this.bindStatsUploaderEvents(),this.sendMutex=new Ps("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Ps("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(r=>{r&&(r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))})},Z("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new Ae(q.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Ae(q.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let r;try{if(t){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new iW(e,this.store,Ea.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(t);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Bn.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new iW(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{r&&r()}}async p2pConnect(e){if(!this.sendConnection)throw new Ae(q.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Bn.Connected}async addRemoteCandidate(e,t){if(t===Ea.RECEIVE_ONLY){if(!this.sendConnection)throw new Ae(q.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Ae(q.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,r){var o=this;return Cc(function*(){const c=yield Cn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Bn.Connected){o.throwIfTrackTypeNotMatch(e);const v=e.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(v))}o.store.pubId=o.store.pubId+1,Ms.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(e,t,r);if(u.length===0)return void(yield Cn(o.tryToUnmuteAudio(e)));u.forEach(v=>{let{track:S,type:R}=v;const I=Date.now();o.store.publish(S.getTrackId(),R===Ve.LocalAudioTrack?"audio":"video",I)}),o.bindLocalTrackEvents(u);const f=yield Cn(o.sendConnection.send(u.map(v=>{let{track:S}=v;return S}),o.store.codec,o.store.audioCodec)),g=(yield Cn(f.next())).value,E=o.createGatewayPublishMessage(u,g);try{yield E}catch(v){throw f.throw(v),(v==null?void 0:v.code)===q.WS_ABORT&&u.forEach(S=>{let{track:R}=S;o.pendingLocalTracks.indexOf(R)===-1&&o.pendingLocalTracks.push(R)}),o.unbindLocalTrackEvents(u),v}yield Cn(f.next()),u.forEach(v=>{let{type:S}=v;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,g),u.forEach(v=>{let{track:S,type:R}=v;const I=Date.now();o.store.publish(S.getTrackId(),R===Ve.LocalAudioTrack?"audio":"video",void 0,I)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Bn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!et(e).call(e,c)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const r=t.find(c=>c[0]==="videoLowTrack");r&&r[1].track.close();const o=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(c=>{let[u,{track:f}]=c;return{type:u,track:f}})),t.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Bn.Connected)return r&&r[1].track.close(),o;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],r=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:f}]=o;const g={stream_type:Hre(u,c),ssrcs:f};u._muted||!u._enabled?t.push(g):r.push(g)}),t.length>0&&t.forEach(o=>{ir(this,Rt.RequestMuteLocal,[o])}),r.length>0&&r.forEach(o=>{ir(this,Rt.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Cc(function*(){throw new Ae(q.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await gs(this,Rt.RequestRePublish,this.pendingLocalTracks),this.emit(Rt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Ae(q.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,r,o){var c;if(!this.recvConnection)throw new Ae(q.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;const{track:u,mid:f,transceiver:g}=await this.recvConnection.receive(t,[{ssrcId:r}],String(e.uid),o);t===lt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new Ky(u,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),g&&e._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new qy(u,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),g&&e._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._videoTrack));const E=this.remoteUserMap.get(e);E?E.set(t,f):this.remoteUserMap.set(e,new Map([[t,f]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:I}=S;return R.uid===e.uid&&t===I});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(Rt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,r,o){if(!this.recvConnection)throw new Ae(q.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:r}],String(e.uid),o)}async unsubscribe(e,t,r){const o=this.pendingRemoteTracks.filter(u=>{let{user:f,kind:g}=u;return t!==void 0?f.uid===e.uid&&t===g:f.uid===e.uid});if(o.forEach(u=>{const f=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(f,1)}),this.recvConnection||r||o.forEach(u=>{let{kind:f}=u;var g;if(f===lt.AUDIO)(g=e._audioTrack)===null||g===void 0||g._destroy(),e._audioTrack=void 0;else if(f===lt.VIDEO){var E;(E=e._videoTrack)===null||E===void 0||E._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,t);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:f}]=u;return f})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[f,{kind:g}]=u;var E,v;if(g===lt.VIDEO&&f._videoSSRC&&((E=this.recvConnection)===null||E===void 0||E.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),g===lt.VIDEO)this.unbindRemoteTrackEvents(f._videoTrack),r||((v=f._videoTrack)===null||v===void 0||v._destroy(),f._videoTrack=void 0);else if(g===lt.AUDIO){var S;this.unbindRemoteTrackEvents(f._audioTrack),!r&&((S=f._audioTrack)===null||S===void 0||S._destroy(),f._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:f}]=u;ir(this,Rt.RequestP2PMuteRemote,f)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,r]=t;[lt.VIDEO,lt.AUDIO].forEach(o=>{r.has(o)?ir(this,Rt.RequestP2PUnmuteRemote,o):ir(this,Rt.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Ae(q.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Ae(q.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Ae(q.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Ae(q.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const r=this.remoteUserMap.get(e);if(!r)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const o=t===lt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const r=this.remoteUserMap.get(e);if(!r)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(Ve.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ni){const r=t.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ve.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Ve.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[o]=r;return!(e&&o===Ve.LocalVideoLowTrack)}).map(r=>{let[,{track:o}]=r;return o})}reportPublishEvent(e,t,r,o,c){if(e){const f=this.localTrackMap.get(Ve.LocalAudioTrack),g=o?this.localTrackMap.get(Ve.LocalVideoLowTrack):this.localTrackMap.get(Ve.LocalVideoTrack);vt.publish(this.store.sessionId,{eventElapse:Ms.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:f==null?void 0:f.track.getTrackLabel(),videoName:g==null?void 0:g.track.getTrackLabel(),screenshare:(g==null?void 0:g.track._hints.indexOf(Zn.SCREEN_TRACK))!==-1,audio:!!f,video:!!g,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;r||(r=[]);const f=r.find(E=>E instanceof qr),g=o?(u=this.localTrackMap.get(Ve.LocalVideoTrack))===null||u===void 0?void 0:u.track:r.find(E=>E instanceof gr);vt.publish(this.store.sessionId,{eventElapse:Ms.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:f==null?void 0:f.getTrackLabel(),videoName:g==null?void 0:g.getTrackLabel(),screenshare:(g==null?void 0:g._hints.indexOf(Zn.SCREEN_TRACK))!==-1,audio:!!f,video:!!g,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,r,o){const c=o===lt.VIDEO?r._videoSSRC:r._audioSSRC;c&&vt.subscribe(this.store.sessionId,{succ:e,ec:t,video:o===lt.VIDEO,audio:o===lt.AUDIO,peerid:r.uid,subscribeRequestid:o===lt.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ms.measureFromSubscribeStart(this.store.clientId,c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ps("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ps("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ve.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ni){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Bn.Disconnected}getStats(e){var t,r;return e?(r=this.recvConnection)===null||r===void 0?void 0:r.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ve.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ve.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof gr||t&&t.track instanceof qr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;const r=Array.from(Zo(t=this.remoteUserMap).call(t)).find(o=>o.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[o]=r;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Ve.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Ft(e).call(e,(r,o)=>r.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Bn.Reconnecting,Z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:o}]=e;switch(r){case Ve.LocalVideoTrack:et(t=o._hints).call(t,Zn.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ve.LocalAudioTrack:o instanceof Ni?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ve.LocalVideoLowTrack:}}),this.emit(Rt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Zo(r).call(r)).forEach(o=>{this.setPendingRemoteMedia(t,o)}),this.emit(Rt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const r of this.pendingRemoteTracks){const{user:o,kind:c}=r;if((e instanceof Af?e.uid:e)===o.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let r,o;if(e===Ea.SEND_ONLY){if(!this.sendConnection)throw new Ae(q.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Ae(q.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(t){const c=await o.restartICE(t);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await gs(this,Rt.RequestP2PRestartICE,{direction:Ea.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(Ve.LocalVideoTrack),r=this.localTrackMap.get(Ve.LocalAudioTrack),o=e.videoSend.find(D=>{var V;return D.ssrc===(t==null||(V=t.ssrcs)===null||V===void 0?void 0:V[0].ssrcId)}),c=e.audioSend.find(D=>{var V;return D.ssrc===(r==null||(V=r.ssrcs)===null||V===void 0?void 0:V[0].ssrcId)});if(!o||!c)return 1;const u=$o(this,Rt.NeedSignalRTT),f=o?o.rttMs:void 0,g=c?c.rttMs:void 0,E=f&&g?(f+g)/2:f||g,v=(E&&u?(E+u)/2:E||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*v/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,I=t==null?void 0:t.track;if(I&&I._encoderConfig&&I._hints.indexOf(Zn.SCREEN_TRACK)===-1){const D=I._encoderConfig.bitrateMax,V=e.bitrate.actualEncoded;if(D&&V){const M=(1e3*D-V)/(1e3*D);return T9[M<.15?0:M<.3?1:M<.45?2:M<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[o]=r;const c=o._audioSSRC,u=o._videoSSRC,f=e.audioRecv.find(V=>V.ssrc===c),g=e.videoRecv.find(V=>V.ssrc===u);if(!f&&!g)return void(t+=1);const E=$o(this,Rt.NeedSignalRTT),v=e.rtt,S=(v&&E?(v+E)/2:v||E)||0,R=f?f.jitterMs:void 0,I=e.recvPacketLossRate;let D=.7*I*100/50+.3*S/1500;R&&(D=.6*I*100/50+.2*S/1500+.2*R/400),t+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new nt((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}filterTobePublishedTracks(e,t,r){const o=[],c=In(),u=this.getAllTracks();e=ky(e=e.filter(E=>u.indexOf(E)===-1));let f=!1,g=!1;for(const E of e){if(E instanceof gr&&(this.localTrackMap.has(Ve.LocalVideoTrack)||f?new Ae(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:E,type:Ve.LocalVideoTrack}),f=!0),t)){const v=this.getLowVideoTrack(E,r);o.push({track:v,type:Ve.LocalVideoLowTrack})}if(E instanceof qr){const v=this.localTrackMap.get(Ve.LocalAudioTrack);if(v){if(!(v.track instanceof Ni))throw new Ae(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(E._bypassWebAudio)throw new Ae(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(E),this.bindLocalAudioTrackEvents(E,!0)}else if(g){const S=o.find(R=>{let{type:I}=R;return I===Ve.LocalAudioTrack});if(!(S.track instanceof Ni))throw new Ae(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(E._bypassWebAudio)throw new Ae(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(E)}else{if(!c.webAudioMediaStreamDest||E instanceof Ni||E._bypassWebAudio)o.push({track:E,type:Ve.LocalAudioTrack});else{const S=new Ni;S.addAudioTrack(E),o.push({track:S,type:Ve.LocalAudioTrack})}g=!0}}}return o}filterTobeUnpublishedTracks(e){const t=[],r=this.getAllTracks();e=ky(e=e.filter(o=>r.indexOf(o)!==-1));for(const o of e){if(o instanceof qr){const c=this.localTrackMap.get(Ve.LocalAudioTrack);if(!c)continue;c.track instanceof Ni?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(t.push([Ve.LocalAudioTrack,c]),c.track.close())):t.push([Ve.LocalAudioTrack,c])}if(o instanceof gr){const c=this.localTrackMap.get(Ve.LocalVideoTrack);if(!c)continue;t.push([Ve.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ve.LocalVideoLowTrack);u&&t.push([Ve.LocalVideoLowTrack,u])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:o}=t;switch(o){case Ve.LocalVideoTrack:r.addListener(ft.GET_STATS,this.handleGetLocalVideoStats),r.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ve.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case Ve.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ni?e.trackList.forEach(r=>{r.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),r.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:o}]=t;return{track:o,type:r}})),e.forEach(t=>{let{track:r,type:o}=t;switch(o){case Ve.LocalVideoTrack:r.off(ft.GET_STATS,this.handleGetLocalVideoStats),r.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ve.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case Ve.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ni?e.trackList.forEach(t=>{t.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ft.GET_STATS,this.handleGetLocalAudioStats),t.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ft.GET_STATS,this.handleGetLocalAudioStats),e.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof qy&&t.addListener(ft.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof Ky&&t.addListener(ft.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ft.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(lt.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(lt.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,o)=>{var c;let u,{track:f,type:g}=r;switch(g){case Ve.LocalAudioTrack:u=Hn.Audio;break;case Ve.LocalVideoTrack:u=et(c=f._hints).call(c,Zn.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Ve.LocalVideoLowTrack:u=Hn.Low}return{kind:g===Ve.LocalAudioTrack?lt.AUDIO:lt.VIDEO,stream_type:u,mid:t[o].id,ssrcs:t[o].localSSRC,isMuted:f.muted||!f.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:f,id:g}]=t;switch(c){case Ve.LocalVideoTrack:o=et(r=u._hints).call(r,Zn.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Ve.LocalAudioTrack:o=Hn.Audio;break;case Ve.LocalVideoLowTrack:o=Hn.Low}return{stream_type:o,ssrcs:f,mid:g}})}assignLocalTracks(e,t){e.forEach((r,o)=>{let{track:c,type:u}=r;this.localTrackMap.set(u,{track:c,id:t[o].id,ssrcs:t[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var r;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Rt.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),et(r=this._restartStates).call(r,t)&&!e.isInRestartIce&&(t==="disconnected"&&await is(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),vt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Hr.TRACER}).onSuccess(),this.emit(Rt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;const o=Array.from(Zo(r=this.remoteUserMap).call(r)).find(u=>u._audioSSRC===t);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Hy.FIRST_FRAME_DECODED),vt.firstRemoteFrame(this.store.sessionId,Bi.FIRST_AUDIO_DECODE,Ir.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ms.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;const o=Array.from(Zo(r=this.remoteUserMap).call(r)).find(c=>c._audioSSRC===t);o&&vt.firstRemoteFrame(this.store.sessionId,Bi.FIRST_AUDIO_RECEIVED,Ir.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ms.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,o)=>{this.reportVideoFirstFrameDecoded(t,r,o)},e.onFirstVideoReceived=t=>{var r;const o=Array.from(Zo(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);o&&vt.firstRemoteFrame(this.store.sessionId,Bi.FIRST_VIDEO_RECEIVED,Ir.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ms.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{const o=t.candidateType==="relay",c=r.candidateType==="relay";r.candidateType!=="unknown"&&o===c||this.emit(Rt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(wf(r))," -> ").concat(JSON.stringify(wf(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(wf(r))," -> ").concat(JSON.stringify(wf(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Rt.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Ea.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Ea.SEND_ONLY?this.restartICE(e):gs(this,Rt.RequestP2PRestartICE,{direction:Ea.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const r=this.localTrackMap.get(Ve.LocalAudioTrack);if(e instanceof qr&&(r==null?void 0:r.track)instanceof Ni)return r.track.isActive||t.push([Ve.LocalAudioTrack,r]),t;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(t.push(o),o[0]===Ve.LocalVideoTrack)){const c=this.localTrackMap.get(Ve.LocalVideoLowTrack);c&&t.push([Ve.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){const t=[],r=this.localTrackMap.get(Ve.LocalAudioTrack);if(e instanceof qr&&(r==null?void 0:r.track)instanceof Ni)return r.track.isActive&&t.push([Ve.LocalAudioTrack,r]),t;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Ve.LocalVideoTrack){t.push(o);const c=this.localTrackMap.get(Ve.LocalVideoLowTrack);c&&t.push([Ve.LocalVideoLowTrack,c])}else t.push(o);return t}createMuteMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:f,id:g}]=t;switch(c){case Ve.LocalAudioTrack:o=Hn.Audio;break;case Ve.LocalVideoTrack:o=et(r=u._hints).call(r,Zn.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Ve.LocalVideoLowTrack:o=Hn.Low}return{stream_type:o,ssrcs:f,mid:g}})}createUnmuteMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:f,id:g}]=t;switch(c){case Ve.LocalAudioTrack:o=Hn.Audio;break;case Ve.LocalVideoTrack:o=et(r=u._hints).call(r,Zn.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Ve.LocalVideoLowTrack:o=Hn.Low}return{stream_type:o,ssrcs:f,mid:g}})}filterTobeUnSubscribedTracks(e,t){const r=[],o=this.remoteUserMap.get(e);if(!o)return r;if(t){const c=o.get(t);if(!c)return r;r.push([e,{kind:t,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,f]=c;r.push([e,{kind:u,id:f}])});return r}createUnsubscribeMessage(e){const t=[];return e.forEach(r=>{let[o,{kind:c,id:u}]=r;switch(c){case lt.VIDEO:return void(o._videoSSRC&&t.push({stream_type:lt.VIDEO,ssrcId:o._videoSSRC}));case lt.AUDIO:return void(o._audioSSRC&&t.push({stream_type:lt.AUDIO,ssrcId:o._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:o}]=t;const c=this.remoteUserMap.get(r);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Ve.LocalVideoTrack),r=this.localTrackMap.get(Ve.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new nt((o,c)=>{this.handleUpdateVideoEncoder(t.track,o,c,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new nt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof qr){const r=this.filterTobeUnmutedTracks(e[t]);if(r.length===0)continue;const o=this.createUnmuteMessage(r);return void await ir(this,Rt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Rt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Rt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await is(Tk(this.dtlsFailedCount,Si)),this.emit(Rt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ve.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof gr)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof gr).length>1)throw new Ae(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof qr).length>1&&(e.some(t=>t instanceof qr&&t._bypassWebAudio)||!In().webAudioMediaStreamDest))throw new Ae(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof gr&&this.pendingLocalTracks.some(r=>r instanceof gr))throw new Ae(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof qr&&this.pendingLocalTracks.some(r=>r instanceof qr)&&(!In().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof qr&&r._bypassWebAudio)))throw new Ae(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const r=!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&In().supportDualStreamEncoding,o=BI(BI({},{width:160,height:120,framerate:15,bitrate:50}),t);let c;c=r?e._mediaStreamTrack.clone():x1(e,o);const u=lr(8,"track-low-"),f=new gr(c,BI(BI({},r&&{scaleResolutionDownBy:f1(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return f.on(Mg.TRANSCEIVER_UPDATED,g=>{e._updateRtpTransceiver(g,Fy.LOW_STREAM)}),f._hints.push(Zn.LOW_STREAM),e.addListener(ft.NEED_CLOSE,()=>{f.close()}),f}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,r,o){var c;const u=Array.from(Zo(c=this.remoteUserMap).call(c)).find(f=>f._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const f=this.store.keyMetrics,g=f.subscribe.find(E=>E.userId===u.uid&&E.type==="video");vt.firstRemoteVideoDecode(this.store.sessionId,Bi.FIRST_VIDEO_DECODE,Ir.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:t,videoheight:r,subscribeElapse:Ms.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:f.requestAPEnd||0,apStart:f.requestAPStart||0,joinGwEnd:f.joinGatewayEnd||0,joinGwStart:f.joinGatewayStart||0,pcEnd:f.peerConnectionEnd||0,pcStart:f.peerConnectionStart||0,subscriberEnd:(g==null?void 0:g.subscribeEnd)||0,subscriberStart:(g==null?void 0:g.subscribeStart)||0,videoAddNotify:(g==null?void 0:g.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(t);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==r}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Ae(q.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Ae(q.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new Ae(q.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new Ae(q.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new Ae(q.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new Ae(q.NOT_SUPPORTED)}async preConnect(e){throw new Ae(q.NOT_SUPPORTED)}getEstablishParams(){throw new Ae(q.NOT_SUPPORTED)}async reSubscribe(e){throw new Ae(q.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new Ae(q.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===Ve.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,Fy.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},_t(Or.prototype,"p2pConnect",[sW],Object.getOwnPropertyDescriptor(Or.prototype,"p2pConnect"),Or.prototype),_t(Or.prototype,"unpublish",[aW],Object.getOwnPropertyDescriptor(Or.prototype,"unpublish"),Or.prototype),_t(Or.prototype,"unpublishLowStream",[oW],Object.getOwnPropertyDescriptor(Or.prototype,"unpublishLowStream"),Or.prototype),_t(Or.prototype,"subscribe",[cW],Object.getOwnPropertyDescriptor(Or.prototype,"subscribe"),Or.prototype),_t(Or.prototype,"mockSubscribe",[lW],Object.getOwnPropertyDescriptor(Or.prototype,"mockSubscribe"),Or.prototype),_t(Or.prototype,"unsubscribe",[dW],Object.getOwnPropertyDescriptor(Or.prototype,"unsubscribe"),Or.prototype),_t(Or.prototype,"muteRemote",[uW],Object.getOwnPropertyDescriptor(Or.prototype,"muteRemote"),Or.prototype),_t(Or.prototype,"unmuteRemote",[hW],Object.getOwnPropertyDescriptor(Or.prototype,"unmuteRemote"),Or.prototype),_t(Or.prototype,"hasRemoteMediaWithLock",[pW],Object.getOwnPropertyDescriptor(Or.prototype,"hasRemoteMediaWithLock"),Or.prototype),_t(Or.prototype,"disconnectForReconnect",[fW],Object.getOwnPropertyDescriptor(Or.prototype,"disconnectForReconnect"),Or.prototype),_t(Or.prototype,"remoteMediaSsrcChanged",[mW],Object.getOwnPropertyDescriptor(Or.prototype,"remoteMediaSsrcChanged"),Or.prototype),Or);function _d(e){return function(t,r,o){const c=t[r];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];switch(e){case gd.SEND_ONLY:{const E=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,f)}finally{E()}}case gd.RECEIVE_ONLY:{const E=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,f)}finally{E()}}default:{const E=await this.sendMutex.lock("From P2PChannel2.".concat(r)),v=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,f)}finally{E(),v()}}}},o}}class e_ extends Dr{constructor(t,r){super(),H(this,"signal",void 0),H(this,"token",void 0),H(this,"tokenTimeout",void 0),H(this,"tokenInterval",void 0),H(this,"_sequence",0),H(this,"userMap",new Map),H(this,"encoder",new TextEncoder),this.signal=t,this.token=r;const o=()=>{this.signal.connectionState===ur.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*Z("P2P_TOKEN_INTERVAL"))};o()}async send(t,r,o,c,u){var f;if(this.userMap.size===0)return;const g=Array.from(Da(f=this.userMap).call(f))[0].token;typeof r!="string"&&(r=JSON.stringify(r)),c=c??lr(6,""),u=u??this._sequence++;const E={_id:c,_type:t,_seq:u,_message:r,token:"".concat(this.token,"_").concat(g)};Z("SHOW_P2P_LOG")&&x.debug("send message",E,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(E)).forEach(S=>{this.signal.request(xt.DATA_STREAM,{payload:yf(this.encoder.encode(S))})});const v=new nt((S,R)=>{const I=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),D),this.off("res-@".concat(c),M),this.off(Zy.ABORT,V),x.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(c)),this.userMap.size===0?R(new Ae(q.INVALID_REMOTE_USER)):R(new Ae(q.TIMEOUT))},Z("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),D=()=>{I&&window.clearTimeout(I),this.off(Zy.ABORT,V),o&&S()},V=()=>{I&&window.clearTimeout(I),this.off("res-@".concat(c,"_ack"),D),this.off("res-@".concat(c),M),R(new Ae(q.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(c)))};this.once(Zy.ABORT,V),this.once("res-@".concat(c,"_ack"),D);const M=(G,z)=>{j=!0,I&&window.clearTimeout(I),this.off("res-@".concat(c,"_ack"),D),this.off(Zy.ABORT,V),G==="success"?S(z):R(new Ae(q.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(c)))};let j=!1;o||(this.once("res-@".concat(c),M),is(Z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{j||x.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(c,", ").concat(E))}))});try{return await v}catch(S){if(S.code===q.TIMEOUT)return await this.send(t,r,o,c,u);throw S}}onMessage(t){var r;const{_uid:o}=t;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==ni.CHECK)return;const{token:v}=t;c=new Map,u={uid:o,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(fn.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in t&&"total"in t){var f;const{id:v,total:S}=t,R=(f=c.get(v))!==null&&f!==void 0?f:[];if(R.push(t),c.has(v)||c.set(v,R),R.length!==S)return;{const I=Ft(R).call(R,(D,V)=>D.index-V.index).map(D=>D.payload).join("");c.delete(v),(t=JSON.parse(I))._uid=o}}const{_type:g,token:E}=t;if(et(r=[ni.ACK,ni.CHECK]).call(r,g))return g===ni.CHECK&&this.handleCheckToken(u,E),void this.receiveMessage(t);E==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(t):x.debug('Receive unexpected message", '.concat(E,", cur_token: ").concat(u.token,"_").concat(this.token),t)}check(){const t={_id:lr(6,""),token:this.token,_type:ni.CHECK};Z("SHOW_P2P_LOG")&&x.debug("send message",t),this.signal.request(xt.DATA_STREAM,{payload:yf(this.encoder.encode(JSON.stringify(t)))})}ack(t){const r={_id:t,_type:ni.ACK,token:this.token};Z("SHOW_P2P_LOG")&&x.debug("send message",r),this.signal.request(xt.DATA_STREAM,{payload:yf(this.encoder.encode(JSON.stringify(r)))})}response(t,r,o){this.send(ni.RESPONSE,JSON.stringify({success:!o,message:r}),!0,t)}handleReceivedMessage(t){const r=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:R}=v;for(;S.has(R);){const I=S.get(R);S.delete(R),this.receiveMessage(I),v.nextExpectedSequenceNumber++}})};if(!t)return void r();const{_uid:o,_seq:c}=t,u=this.userMap.get(o),{receivedMessagesMap:f,isStart:g,nextExpectedSequenceNumber:E}=u;if(c<E)return this.ack(t._id),void x.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(t._message));f.set(c,t),g&&c===E&&(this.receiveMessage(t),f.delete(E),u.nextExpectedSequenceNumber++,r())}receiveMessage(t){const{_id:r,_type:o,_message:c,_uid:u}=t;if(Z("SHOW_P2P_LOG")&&x.debug("receive message",t),r){let f;switch(t._type!==ni.ACK&&(c&&(f=JSON.parse(c)),this.ack(t._id)),t._type){case ni.CANDIDATE:case ni.CONTROL:this.signal.emit(o,f,u);break;case ni.PUBLISH:case ni.UNPUBLISH:case ni.RESTART_ICE:case ni.CALL:f.uid=u,gs(this.signal,o,f).then(g=>{this.response(t._id,g)}).catch(()=>{this.response(t._id,void 0,!0)});break;case ni.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case ni.RESPONSE:{const{success:g,message:E}=f;this.emit("res-@".concat(r),g?"success":"failed",E);break}}}}splitMessage(t){if(t.length<e_.MAX_MESSAGE_SIZE)return[t];const r=[],{remoteToken:o}=JSON.parse(t),c=lr(6,"");let u=0,f=800;const g=Math.ceil(t.length/f);for(;t.length>0;){u++;const E={id:c,index:u,total:g,payload:t.slice(0,f),token:"".concat(this.token,"_").concat(o)};JSON.stringify(E).length>e_.MAX_MESSAGE_SIZE?f-=50:(r.push(E),t=t.slice(f))}return r.map(E=>JSON.stringify(E))}handleCheckToken(t,r){return t.token!==r?(x.debug("token changed, from ".concat(t.token," to ").concat(r)),this.reset(t.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(r)),this.reset(t.uid)},Z("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await gs(this.signal,ni.CALL,void 0),r=await this.send(ni.CALL,t);this.signal.emit(Lt.P2P_CONNECTION,r,!0)}async reset(t,r){const o=this.userMap.get(t);o&&(this.emit(Zy.ABORT),this.signal.emit(fn.ON_USER_OFFLINE,{uid:o.uid,reason:gre.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r||(x.debug("change local token from ".concat(r," to ").concat(r)),this.token=lr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Zy.ABORT)}}H(e_,"MAX_SIZE",1),H(e_,"MAX_MESSAGE_SIZE",1024);class Jse extends Dr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===ur.CONNECTED?this.emit(Lt.WS_CONNECTED):t===ur.RECONNECTING?this.emit(Lt.WS_RECONNECTING,this._websocketReconnectReason):t===ur.CLOSED&&this.emit(Lt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),H(this,"_disconnectedReason",void 0),H(this,"_websocketReconnectReason",void 0),H(this,"_connectionState",ur.CLOSED),H(this,"reconnectToken",void 0),H(this,"p2pToken",void 0),H(this,"websocket",void 0),H(this,"openConnectionTime",void 0),H(this,"clientId",void 0),H(this,"lastMsgTime",Date.now()),H(this,"uploadCache",[]),H(this,"uploadCacheInterval",void 0),H(this,"rttRolling",new q3(5)),H(this,"pingpongTimer",void 0),H(this,"pingpongTimeoutCount",0),H(this,"joinResponse",void 0),H(this,"multiIpOption",void 0),H(this,"initError",void 0),H(this,"spec",void 0),H(this,"store",void 0),H(this,"_external_signal",void 0),H(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Lt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case fn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case fn.MUTE_AUDIO:case fn.MUTE_VIDEO:case fn.ON_P2P_LOST:case fn.ON_USER_ONLINE:return;case fn.ON_USER_OFFLINE:const{uid:u}=c._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===fn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===fn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Fn.UID_BANNED);break;case 15:this.close(Fn.IP_BANNED);break;case 16:this.close(Fn.CHANNEL_BANNED)}if(c._type===fn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ct.ERR_LICENSE_MISSING:this.close(Fn.LICENSE_MISSING);break;case Ct.ERR_LICENSE_EXPIRED:this.close(Fn.LICENSE_EXPIRED);break;case Ct.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Fn.LICENSE_MINUTES_EXCEEDED);break;case Ct.ERR_LICENSE_PERIOD_INVALID:this.close(Fn.LICENSE_PERIOD_INVALID);break;case Ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Fn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ct.ERR_LICENSE_ILLEGAL:this.close(Fn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new h1("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Z("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ur.CONNECTED&&this.reconnect("retry",ms.OFFLINE)}),this.p2pToken=lr(6,""),this._external_signal=new e_(this,this.p2pToken)}async request(t,r,o,c){const u=lr(6,""),f={_id:u,_type:t,_message:r},g=this.websocket.connectionID,E=()=>new nt((V,M)=>{if(this.connectionState===ur.CONNECTED)return V();const j=()=>{this.off(Lt.WS_CLOSED,G),V()},G=()=>{this.off(Lt.WS_CONNECTED,j),M(new Ae(q.WS_ABORT))};this.once(Lt.WS_CONNECTED,j),this.once(Lt.WS_CLOSED,G)});if(this.connectionState!==ur.CONNECTING&&this.connectionState!==ur.RECONNECTING||t===xt.JOIN||t===xt.REJOIN||await E(),this.websocket.sendMessage(f,!0),c)return;const v=new nt((V,M)=>{let j=!1;const G=(ce,Ee)=>{j=!0,V({isSuccess:ce==="success",message:Ee||{}}),this.off(Lt.WS_CLOSED,z),this.off(Lt.WS_RECONNECTING,z),this.emit(Lt.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(u),G);const z=()=>{M(new Ae(q.WS_ABORT,"type: ".concat(t))),this.off(Lt.WS_CLOSED,z),this.off(Lt.WS_RECONNECTING,z),this.off("res-@".concat(u),G)};this.once(Lt.WS_CLOSED,z),this.once(Lt.WS_RECONNECTING,z),is(Z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==g||j||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Lt.REQUEST_TIMEOUT,t,r))})});let S=null;try{S=await v}catch(V){if(this.connectionState===ur.CLOSED||t===xt.LEAVE)throw new Ae(q.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?V.throw():t===xt.JOIN||t===xt.REJOIN?null:(await E(),await this.request(t,r))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),I=Vb(R),D=new Ae(q.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:I.desc});return I.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(R,", message: ").concat(I.desc,", action: ").concat(I.action)),R===Ct.ERR_TOO_MANY_BROADCASTERS?((t===xt.JOIN||t===xt.REJOIN)&&(this.initError=D,this.close()),D.throw()):I.action==="failed"?D.throw():I.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===Ct.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ms.MULTI_IP)):this.reconnect(I.action,ms.SERVER_ERROR),t===xt.JOIN||t===xt.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new nt(o=>{const c=u=>{(!r||r(u))&&(this.off(t,c),o(u))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(jb.WRTC_STATS,r)}upload(t,r){const o={_type:t,_message:r};try{this.websocket.sendMessage(o)}catch{const u=Z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ur.CONNECTED)return;const f=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(f._type,f._message)},Z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const o={_type:t,_message:r};this.websocket.sendMessage(o)}async sendExtensionMessage(t,r,o){return await this._external_signal.send(t,r,o)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new nt((r,o)=>{this.once(Lt.WS_CONNECTED,()=>r(this.joinResponse)),this.once(Lt.WS_CLOSED,()=>o(this.initError||new Ae(q.WS_ABORT))),this.connectionState=ur.CONNECTING,this.websocket.init(t).catch(o)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Fn.LEAVE,this.connectionState=ur.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=lr(6,""),this._external_signal.clear(),this._external_signal=new e_(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Lt.ABORT_P2P_EXECUTION);const t=await gs(this,Lt.REQUEST_JOIN_INFO),r=await this.request(xt.JOIN,t);if(!r)return this.emit(Lt.REPORT_JOIN_GATEWAY,q.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(Lt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ur.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleDataStream(t){try{var r;const o=Pg(t.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||et(r=Object.values(ni)).call(r,u._type)?(u._uid=t.uid,this._external_signal.onMessage(u)):this.emit(fn.ON_DATA_STREAM,t)}catch{this.emit(fn.ON_DATA_STREAM,t)}}handleNotification(t){x.debug("[".concat(this.clientId,"] receive notification: "),t);const r=Vb(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Fn.UID_BANNED),void this.close()):void this.reconnect(r.action,ms.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=Z("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>Z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ms.TIMEOUT):this.request(xt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-r;this.rttRolling.add(o),Z("REPORT_STATS")&&this.send(xt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(Wt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Lt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Wt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Wt.CLOSED,()=>{this.connectionState=ur.CLOSED}),this.websocket.on(Wt.FAILED,()=>{this._disconnectedReason=Fn.NETWORK_ERROR,this.connectionState=ur.CLOSED}),this.websocket.on(Wt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===ur.CONNECTED?this.connectionState=ur.RECONNECTING:this.connectionState=ur.CONNECTING}),this.websocket.on(Wt.WILL_RECONNECT,(t,r,o)=>{t!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(t)}),this.websocket.on(Wt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Lt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Ae&&t.code===q.UNEXPECTED_RESPONSE&&t.data.code===Ct.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ms.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ms.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Wt.REQUEST_NEW_URLS,(t,r)=>{gs(this,Lt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(Wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(fn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const Zse={name:"P2PChannel",create:function(e){let{store:t,statsCollector:r}=e;return new $se(t,r)},createSubmodule:function(e){let{store:t,spec:r}=e;return new Jse(r,t)}};function _W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function EW(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_W(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_W(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class eae{constructor(t){H(this,"sessionDesc",void 0),H(this,"localCapabilities",void 0),H(this,"rtpCapabilities",void 0),H(this,"candidates",void 0),H(this,"_originCandidates",void 0),H(this,"iceParameters",void 0),H(this,"dtlsParameters",void 0),H(this,"setup",void 0),H(this,"currentMidIndex",void 0),H(this,"cname",void 0),t=xr(t);const{iceParameters:r,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:f,localCapabilities:g,sdkCodec:E,cname:v}=t,S=to(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=xr(c),this.iceParameters=r,this.dtlsParameters=o,this.setup=f,this.localCapabilities=g,this.cname=v;for(let R=0;R<S.mediaDescriptions.length;R++){const I=S.mediaDescriptions[R];if(I.attributes.iceUfrag=r.iceUfrag,I.attributes.icePwd=r.icePwd,I.attributes.fingerprints=o.fingerprints,I.attributes.candidates=c,I.attributes.setup=f,I.media.mediaType==="video"){I.media.fmts=u.videoCodecs.map(V=>V.payloadType.toString(10));let D=u.videoCodecs.filter(V=>{var M,j;return(M=V.rtpMap)===null||M===void 0?void 0:et(j=M.encodingName.toLowerCase()).call(j,E)});D.length===0&&(D=u.videoCodecs),I.attributes.payloads=D,I.attributes.extmaps=u.videoExtensions}I.media.mediaType==="audio"&&(I.media.fmts=u.audioCodecs.map(D=>D.payloadType.toString(10)),I.attributes.payloads=u.audioCodecs,I.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[R]=this.mungMediaDesc(I)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return vf(this.sessionDesc)}send(t,r,o){const{ssrcs:c,ssrcGroups:u}=Gg(r,this.cname),f=this.sessionDesc.mediaDescriptions.find(v=>t===lt.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),g=c[0].attributes.label,E=c[0].attributes.mslabel;return f.attributes.ssrcs=f.attributes.ssrcs.concat(c),f.attributes.ssrcGroups=f.attributes.ssrcGroups.concat(u),{id:g,mslabel:E}}batchSend(t){return t.map(r=>{let{kind:o,ssrcMsg:c}=r;return this.send(o,c,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(r=>{const o=[],c=[],u=[];r.attributes.ssrcs.forEach(f=>{et(t).call(t,f.attributes.label||"")?u.push(f):o.push(f)}),r.attributes.ssrcGroups.forEach(f=>{var g;et(g=u.map(E=>E.ssrcId)).call(g,f.ssrcIds[0])||c.push(f)}),r.attributes.ssrcs=o,r.attributes.ssrcGroups=c})}mute(t){const r=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){const r=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}receive(t,r,o){t.forEach((c,u)=>{const f=c._mediaStreamTrack,g=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===f.kind),E=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[g],c);this.sessionDesc.mediaDescriptions[g]=E})}stopReceiving(t){}updateCandidates(t){const r=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(r.forEach(c=>{o.push(EW(EW({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),r.length!==0){switch(t){case Ls.TCP_RELAY:this.candidates=o;break;case Ls.UDP_TCP_RELAY:case Ls.RELAY:this.candidates=[...r,...o];break;default:this.candidates=r}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(t){t=xr(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const r=[];for(let o=0;o<t;o++)r.push((this.currentMidIndex+o+1).toString(10));return r}mungRecvMediaDsec(t,r){const o=xr(t);return nv(o,r),g1(o,r),o}updateRecvMedia(t,r){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===t);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],r);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,r,o){const c=this.sessionDesc.mediaDescriptions.find(f=>t===lt.VIDEO?f.attributes.mid==="video":f.attributes.mid==="audio");if(c){const f=c.attributes.ssrcs.find(g=>g.attributes.label===r);var u;f&&(f.attributes.label=o,(u=f.attributes.msid)===null||u===void 0||u.replace(r,o))}}mungMediaDesc(t){const r=xr(t);return m1(r),function(o){const c=o.attributes.extmaps.find(u=>iI(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const f=u.rtcpFeedbacks.findIndex(g=>g.type==="transport-cc");f!==-1&&u.rtcpFeedbacks.splice(f,1)})}(r),r}getSSRC(t){for(const r of this.sessionDesc.mediaDescriptions)for(const o of r.attributes.ssrcs)if(o.attributes.label===t)return[o]}}var sr;function yW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function HI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yW(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yW(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let tae=(sr=class kw extends D9{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return et(r=Object.keys(kA)).call(r,t)}))]}constructor(t,r){super(t,r),H(this,"store",void 0),H(this,"peerConnection",void 0),H(this,"remoteSDP",void 0),H(this,"initialOffer",void 0),H(this,"statsFilter",void 0),H(this,"useRTX",!1),H(this,"localCapabilities",void 0),H(this,"localCandidateCount",0),H(this,"allCandidatesReceived",!1),H(this,"establishPromise",void 0),H(this,"mutex",void 0),this.store=r,this.mutex=new Ps("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(kw.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Ik(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,Fr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Rf(t.sdp),o=Hb(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:Z("FILTER_VIDEO_FEC"),filterAudioFec:Z("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=t,HI(HI({},r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:t.sdp})}catch(t){throw new Ae(q.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new eae(HI(HI({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteRTPCapabilities(t,r){throw new Ae(q.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,r){var o=this;return Cc(function*(){const c=yield Cn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=t.map(I=>o.peerConnection.addTrack(I._mediaStreamTrack)),f=yield Cn(o.peerConnection.createOffer()),g=to(f.sdp),E=t.map(I=>{const D=I._mediaStreamTrack,V=g.mediaDescriptions.find(M=>M.attributes.mid===D.kind);if(!V)throw new Error("Cannot extract ssrc from mediaDescription.");return function(M,j,G){const z=M.attributes.ssrcs.filter(Ee=>Ee.attributes.label===j),ce=M.attributes.ssrcGroups;if(z.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ce&&z.length>1){const Ee=ce.find(_e=>_e.ssrcIds.indexOf(z[0].ssrcId)!==-1);return Ee?[{ssrcId:Ee.ssrcIds[0],rtx:G?Ee.ssrcIds[1]:void 0}]:[{ssrcId:z[0].ssrcId}]}return[{ssrcId:z[0].ssrcId}]}(V,D.id,o.useRTX)});let v;try{v=yield E}catch(I){throw u.forEach(D=>{fs()&&D.replaceTrack(null),o.peerConnection.removeTrack(D)}),I}const S=o.mungSendOfferSDP(f.sdp,t);o.remoteSDP.receive(t,r,v);const R=o.remoteSDP.toString();return yield Cn(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Cn(o.applySendEncodings(u,t)),yield Cn(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),t.map((I,D)=>{const V=I._mediaStreamTrack.id;return{localSSRC:E[D],id:V}})}catch(u){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getSenders().filter(u=>{var f;return t.indexOf(((f=u.track)===null||f===void 0?void 0:f.id)||"")!==-1});if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(u=>{fs()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}}async receive(t,r,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:u,mslabel:f}=this.remoteSDP.send(t,r,c),g=new nt((S,R)=>{const I=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),D=V=>{const M=An();if((M.name==="Safari"&&Number(M.version)===11||ma())&&V.track.id!==u&&V.streams[0].id===f){var j;const G=V.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(t,u,V.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(I),void S(G)}if(V.track.id===u)return this.peerConnection.removeEventListener("track",D),clearTimeout(I),void S(V.track)};this.peerConnection.addEventListener("track",D)}),E=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:E});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await g,id:u}}catch(u){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter(o=>{var c;return t.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(r.length!==t.length)throw new Error("sender' length doesn't match mids' length.");r.map(o=>{if(fs()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter(u=>{var f;return t.indexOf(((f=u.track)===null||f===void 0?void 0:f.id)||"")!==-1});if(r.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");r.map(async u=>{if(fs()&&u.track)u.track.enabled=!0;else{const f=u.getParameters();f.encodings.forEach(g=>g.active=!0),await u.setParameters(f)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return Cc(function*(){const o=yield Cn(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=In().supportPCSetConfiguration;if(t===Ls.RELAY&&!c)return;if(c){const v=r.peerConnection.getConfiguration(),S=t===Ls.RELAY?"relay":"all";v.iceTransportPolicy!==S&&(x.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(S,"]")),v.iceTransportPolicy=S,r.peerConnection.setConfiguration(v))}t!==Ls.RELAY&&r.remoteSDP.updateCandidates(t);const u=yield Cn(r.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const f=Rf(u.sdp),{remoteIceParameters:g}=yield f.iceParameters;r.remoteSDP.restartICE(g);const E=r.remoteSDP.toString();yield Cn(r.peerConnection.setLocalDescription(u)),yield Cn(r.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(c){x.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ae(q.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,r){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===t});o.length===1&&await this.applySendEncodings(o,[r])}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});o&&await o.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,r){throw new Ae(q.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new Ae(q.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Ib(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...kw.turnServerConfigToIceServers(t.turnServer.servers)),Z("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...kw.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach(o=>{o.security?o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),r}async updateRtpSenderEncodings(t,r){var o;if(r||(r=this.peerConnection.getSenders().find(v=>{var S;return((S=v.track)===null||S===void 0?void 0:S.id)===t._mediaStreamTrack.id})),!r)return x.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!In().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const c={},u={};if(t instanceof gr)switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(Z("DSCP_TYPE")&&jh()){var f;const v=Z("DSCP_TYPE");et(f=["very-low","low","medium","high"]).call(f,v)&&(u.networkPriority=v)}const g=r.getParameters(),E=(o=g.encodings)===null||o===void 0?void 0:o[0];E&&Object.assign(E,u),Object.assign(g,c),x.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await r.setParameters(g)}async applySendEncodings(t,r){try{if(!In().supportSetRtpSenderParameters||t.length!==r.length)return;for(let o=0;o<t.length;o++){const c=t[o],u=r[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r){const o=to(t);return r.forEach((c,u)=>{const f=c._mediaStreamTrack,g=o.mediaDescriptions.find(E=>E.attributes.mid===f.kind);g&&nv(g,c)}),vf(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const r=this.remoteSDP.batchSend(t).map((u,f)=>{let{id:g,mslabel:E}=u;const{kind:v}=t[f];return new nt((S,R)=>{const I=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(g)))},1e4),D=V=>{const M=An();if(M.name==="Safari"&&Number(M.version)===11&&V.track.id!==g&&V.streams[0].id===E){var j;const G=V.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(v,g,V.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(I),void S({track:G,id:g})}if(V.track.id===g)return this.peerConnection.removeEventListener("track",D),clearTimeout(I),void S({track:V.track,id:g})};this.peerConnection.addEventListener("track",D)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await nt.all(r)}catch(r){throw new Ae(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r==null?void 0:r[0].ssrcId}setConfiguration(t){if(In().supportPCSetConfiguration){const r=kw.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},_t(sr.prototype,"connect",[Pc],Object.getOwnPropertyDescriptor(sr.prototype,"connect"),sr.prototype),_t(sr.prototype,"stopSending",[Pc],Object.getOwnPropertyDescriptor(sr.prototype,"stopSending"),sr.prototype),_t(sr.prototype,"receive",[Pc],Object.getOwnPropertyDescriptor(sr.prototype,"receive"),sr.prototype),_t(sr.prototype,"stopReceiving",[Pc],Object.getOwnPropertyDescriptor(sr.prototype,"stopReceiving"),sr.prototype),_t(sr.prototype,"muteRemote",[Pc],Object.getOwnPropertyDescriptor(sr.prototype,"muteRemote"),sr.prototype),_t(sr.prototype,"unmuteRemote",[Pc],Object.getOwnPropertyDescriptor(sr.prototype,"unmuteRemote"),sr.prototype),_t(sr.prototype,"muteLocal",[Pc],Object.getOwnPropertyDescriptor(sr.prototype,"muteLocal"),sr.prototype),_t(sr.prototype,"unmuteLocal",[Pc],Object.getOwnPropertyDescriptor(sr.prototype,"unmuteLocal"),sr.prototype),_t(sr.prototype,"close",[Pc],Object.getOwnPropertyDescriptor(sr.prototype,"close"),sr.prototype),_t(sr.prototype,"updateEncoderConfig",[Pc],Object.getOwnPropertyDescriptor(sr.prototype,"updateEncoderConfig"),sr.prototype),_t(sr.prototype,"updateSendParameters",[Pc],Object.getOwnPropertyDescriptor(sr.prototype,"updateSendParameters"),sr.prototype),_t(sr.prototype,"replaceTrack",[Pc],Object.getOwnPropertyDescriptor(sr.prototype,"replaceTrack"),sr.prototype),_t(sr.prototype,"getRemoteSSRC",[Pc],Object.getOwnPropertyDescriptor(sr.prototype,"getRemoteSSRC"),sr.prototype),sr);function Pc(e,t,r){const o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(t));try{for(var f=arguments.length,g=new Array(f),E=0;E<f;E++)g[E]=arguments[E];return await o.apply(this,g)}finally{u()}},r}const nae={name:"PlanBConnection",create:function(e){let{store:t,spec:r}=e;return new tae(r,t)}},rae={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!In().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(HA.has(e)||!e.track)return;const r={track:e.track};if(Mh()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(f){return void x.error("create audio-encoded-streams error",f&&f.message)}const u=new TransformStream({transform(f,g){r.controller||(r.controller=g),e.track&&e.track.id!==r.track.id&&(x.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o));const E=t.metadata&&t.metadata();E?function(v,S){const{chunk:R,controller:I}=S,D=Z("ENABLE_AUDIO_PTS_METADATA")?Fh.AUDIO_64_BIT_PTS:Fh.METADATA;R.data=function(V,M,j){const G=j.byteLength,z=G+Jk+g9,ce=Qk+$k+z,Ee=new ArrayBuffer(V.byteLength+ce),_e=new DataView(Ee);_e.setUint8(0,m9),_e.setUint16(1,z),_e.setUint8(3,M),_e.setUint16(4,G);for(let Ce=0;Ce<G;Ce++)_e.setUint8(6+Ce,j[Ce]);const me=new Uint8Array(_e.buffer);return me.set(new Uint8Array(V),ce),me.buffer}(R.data,D,v),I.enqueue(R)}(E,{chunk:f,controller:g}):g.enqueue(f)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(fs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=BA(),u=new MessageChannel;await new nt(g=>c.onmessage=E=>{E.data==="registered"&&g(void 0)});const f=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=f,await new nt(g=>c.onmessage=E=>{E.data==="started"&&g(void 0)}),u.port1.onmessage=g=>{var E;if(g.data.transformed&&e.track&&((E=e.track)===null||E===void 0?void 0:E.id)!==r.track.id)x.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o);else if(g.data.getMetadata){const v=t.metadata&&t.metadata();v&&u.port1.postMessage({metadata:v})}},r.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=HA.get(e);if(c){HA.delete(e);try{var u,f;(u=c.controller)===null||u===void 0||u.terminate(),(f=c.worker)===null||f===void 0||f.terminate()}catch(g){x.warning(g&&g.message)}}}HA.set(e,r),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!In().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(KA.has(e))return;const r={track:e.track,onMetadata:t.onMetadata};if(Mh()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");lk(Un.CHROME,87,116)||(t.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(f){return void x.error("create audio-encoded-streams error",f&&f.message)}const u=new TransformStream({transform(f,g){r.controller||(r.controller=g),e.track&&e.track.id!==r.track.id&&(x.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o)),t.enableTopn?function(E,v,S){var R;const I=_9(new DataView(v.data));if(!I)return S.enqueue(v);const D=E.track.id;Mne.set(D,E.track);const V=(R=I.tlv.find(Ee=>Ee.tag===Fh.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let M=0;typeof V=="number"&&(M=127-V);const j=Math.round(Math.pow(10,M/60)-1),{selected:G,speaker:z}=function(Ee,_e){let me=Xy.get(Ee);if(me||(me=function(Ce){const xe=new y9;return Xy.set(Ce,xe),ud||(ud=new kne(Z("TOPN_SILENCE_THRESHOLD")||500),ud.on("ActiveSpeakerChanged",$e=>{$e!=null&&(zA=$e)})),ud.addSpeakers([xe]),xe}(Ee)),Xy.size<=v9)return{selected:!0,speaker:me};if(!ud)throw new Error("no active speaker detector");return ud.levelChanged(me.id,_e),Fg=ud.loudest.map(Ce=>Ce.id),zA&&!et(Fg).call(Fg,zA)&&Fg.length>=v9&&Fg.pop(),{selected:et(Fg).call(Fg,me.id)||me.id===zA,speaker:me}}(E,j),ce=function(Ee,_e,me){const Ce=hd.get(Ee)||new Lne(Ee,_e);return Ce.score=me,hd.set(Ee,Ce),function(xe){if(YA.set(xe,!0),!qA)return void(qA=Date.now());const $e=Date.now();$e-qA>1e3&&(YA.get(xe)?YA.set(xe,!1):(S9(xe),YA.delete(xe)),qA=$e)}(Ee),Ce}(D,E.track,z.energyScore);ce.addSample(G),ce.active&&(v.data=I.frame.buffer,S.enqueue(v))}(e,f,g):t.enableMetadata?function(E,v,S){const R=_9(new DataView(E.data));if(!R)return v.enqueue(E);const I=R.tlv.find(D=>D.tag===Fh.METADATA||D.tag===Fh.AUDIO_64_BIT_PTS);I&&S&&I.value instanceof Uint8Array&&S(I.value),E.data=R.frame.buffer,v.enqueue(E)}(f,g,t.onMetadata):g.enqueue(f)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(fs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=BA(),u=new MessageChannel;await new nt(g=>c.onmessage=E=>{E.data==="registered"&&g(void 0)});const f=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=f,await new nt(g=>c.onmessage=E=>{E.data==="started"&&g(void 0)}),u.port1.onmessage=g=>{var E;g.data.transformed&&e.track&&((E=e.track)===null||E===void 0?void 0:E.id)!==r.track.id?(x.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o)):g.data.metadata&&r.onMetadata&&r.onMetadata(g.data.metadata)},r.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){const u=KA.get(c);if(u){(function(E){const v=Xy.get(E);v&&(Xy.delete(E),ud&&(ud.removeSpeakers([v]),Xy.size===0&&(ud.destroy(),ud=null)))})(c),S9(c.track.id),KA.delete(c);try{var f,g;(f=u.controller)===null||f===void 0||f.terminate(),(g=u.worker)===null||g===void 0||g.terminate()}catch(E){x.warning(E&&E.message)}}}(e)}KA.set(e,r),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,t){if(!In().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(XA.has(e)||!e.track)return;const r={track:e.track};if(Mh()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(g){return void x.error("create video-encoded-streams error",g&&g.message)}const u=[];t.on("sei-to-send",g=>{u.push(g)});const f=new TransformStream({transform(g,E){r.controller||(r.controller=E),e.track&&e.track.id!==r.track.id&&(x.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o));const v=u.shift();v&&(g.data=function(S,R){const I=function(z){const ce=z.length;let Ee=[],_e=0;for(;_e<ce;)_e+2<ce&&z[_e]===0&&z[_e+1]===0&&(z[_e+2]===0||z[_e+2]===1||z[_e+2]===2||z[_e+2]===3)?(Ee.push(z[_e],z[_e+1],3,z[_e+2]),_e+=3):(Ee.push(z[_e]),_e++);return new Uint8Array(Ee)}(R),D=I.length,V=Math.floor(D/255),M=D%255,j=new Uint8Array(6+V+1+D+S.byteLength);j[0]=0,j[1]=0,j[2]=0,j[3]=1,j[4]=6,j[5]=101;let G=0;for(;G<V;)j[6+G]=255,G++;return j[6+G]=M,G++,j.set(I,6+G),j.set(new Uint8Array(S),6+G+D),j.buffer}(g.data,v)),E.enqueue(g)}});c.readable.pipeThrough(f).pipeTo(c.writable)}else{if(!fs())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=BA(),u=new MessageChannel;await new nt(g=>c.onmessage=E=>{E.data==="registered"&&g(void 0)});const f=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=f,await new nt(g=>c.onmessage=E=>{E.data==="started"&&g(void 0)}),t.on("sei-to-send",g=>{u.port1.postMessage({sei:g})}),u.port1.onmessage=g=>{var E;g.data.transformed&&e.track&&((E=e.track)===null||E===void 0?void 0:E.id)!==r.track.id&&(x.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o))},r.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=XA.get(e);if(c){XA.delete(e);try{var u,f;(u=c.controller)===null||u===void 0||u.terminate(),(f=c.worker)===null||f===void 0||f.terminate()}catch(g){x.warning(g&&g.message)}}}XA.set(e,r),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!In().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!e.track)return;if(Mb.has(e)){const c=Mb.get(e);return void(c&&(c.onSei=t.onSei))}const r={track:e.track,onSei:t.onSei};if(Mh()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(f){return void x.error("create video-encoded-streams error",f&&f.message)}const u=new TransformStream({transform(f,g){r.controller||(r.controller=g),e.track&&e.track.id!==r.track.id&&(x.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o));const E=function(v){const S=new DataView(v.data);let R=0;for(;R+4<v.data.byteLength;){if(S.getUint8(R+0)===0&&S.getUint8(R+1)===0&&S.getUint8(R+2)===0&&S.getUint8(R+3)===1&&S.getUint8(R+4)===6){let I=R+6,D=0,V=0;for(;(V=S.getUint8(I++))===255;)D+=255;D+=V;const M=jne(v.data,I,D);return new Uint8Array(M)}R++}return null}(f);E&&r.onSei&&r.onSei(E),g.enqueue(f)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(fs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=BA(),u=new MessageChannel;await new nt(g=>c.onmessage=E=>{E.data==="registered"&&g(void 0)});const f=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=f,await new nt(g=>c.onmessage=E=>{E.data==="started"&&g(void 0)}),u.port1.onmessage=g=>{var E;g.data.transformed&&e.track&&((E=e.track)===null||E===void 0?void 0:E.id)!==r.track.id?(x.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o)):g.data.sei&&r.onSei&&r.onSei(g.data.sei)},r.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){const u=Mb.get(c);if(u){Mb.delete(c);try{var f,g;(f=u.controller)===null||f===void 0||f.terminate(),(g=u.worker)===null||g===void 0||g.terminate()}catch(E){x.warning(E&&E.message)}}})(e)}Mb.set(e,r),e.track.addEventListener("ended",o)}},iae={name:"InterceptFrame",create:()=>rae};Nk(),qn("PROCESS_ID","process-".concat(lr(8,""),"-").concat(lr(4,""),"-").concat(lr(4,""),"-").concat(lr(4,""),"-").concat(lr(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void x.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),r=Date.now();x.debug("Loading global parameters from cache",t),Object.keys(t).forEach(o=>{if(Object.prototype.hasOwnProperty.call(Sr,o)){const{value:c,expires:u}=t[o];if(u&&u<=r)return;dd[o]=c,Sr[o]=c}})}catch(t){x.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(dd.AREAS)&&dd.AREAS.length>0&&S1(dd.AREAS,!0);const vW=(e,t,r)=>{x.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),qn(e,t,r)};Cf(Ase,!1),Cf(Ose,!1),Cf(lie,!1),Cf(Bse,!1),Cf(wse,!1),Cf(Zse,!1),Cf(nae,!1),Cf(iae,!1);const Ti=function(e){const t=new Dr,r=e,o={getListeners:t.getListeners.bind(t),on:(c,u)=>(function(f,g){f===fu.SECURITY_POLICY_VIOLATION&&eG(g,!0)}(c,u),t.on.bind(t)(c,u)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return ZH(ZH({},r),o)}({__TRACK_LIST__:Vy,VERSION:Ac,BUILD:xk,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:vW,getParameter:Z,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const r=await async function(o){let c;return In().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(t);if(!r)return e;t.close(),t=null,e=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(r)}catch(t){throw new Te(q.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=vt.reportApiInvoke(null,{name:di.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Hr.TRACER});let t=!1;try{const u=window.RTCPeerConnection,f=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,g=window.WebSocket;t=!!(u&&f&&g),t&&pk()&&T3(75)&&new u().close()}catch(u){return x.error("check system requirement failed: ",u),!1}let r=!1;const o=An();o.name===Un.CHROME&&Number(o.version)>=58&&(cd.engine.name!=="WebKit"||function(){const u=An();if(RA()){if(u.os===Fi.MAC_OS)return!0;if(u.os===Fi.IOS){const f=cd.os.version&&cd.os.version.split(".");if(f&&Number(f[0])===14&&f[1]&&Number(f[1])>=3||f&&Number(f[0])>14)return!0}}return!1}())&&(r=!0),(o.name===Un.FIREFOX&&Number(o.version)>=56||o.name===Un.OPERA&&Number(o.version)>=45||o.name===Un.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(ma()||ml())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||I3()||An().name===Un.QQ)&&(r=!0),x.debug("checkSystemRequirements, api:",t,"browser",r);const c=t&&r;return e.onSuccess(c),c},getDevices:function(e){return ic.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return ic.getRecordingDevices(e)},getCameras:function(e){return ic.getCamerasDevices(e)},getElectronScreenSources:T4,getPlaybackDevices:function(e){return ic.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const r=lr(5,"client-"),o=vt.reportApiInvoke(null,{id:r,name:di.CREATE_CLIENT,options:[t],tag:Hr.TRACER});try{(function(c){ki(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),ki(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&ki(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&rs(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&M3(c.turnServer),c.httpRetryConfig!==void 0&&L3(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&L3(c.websocketRetryConfig)})(t)}catch(c){throw o.onError(c),c}return(w3(16,0)||R3(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",x.debug("browser not support vp9, force use vp8")),qn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),o.onSuccess(),new die(Rl(Rl({forceWaitGatewayResponse:!0},t),{},{role:et(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),r)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Z("CAMERA_CAPTURE_CONFIG"),r=lr(8,"track-cam-"),o=vt.reportApiInvoke(null,{id:r,tag:Hr.TRACER,name:di.CREATE_CAM_VIDEO_TRACK,options:[Nr({},e),t]});t&&(e.encoderConfig=t);const c=FA(e);let u=null;x.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{u=(await rc({video:c},r)).getVideoTracks()[0]||null}catch(g){throw o.onError(g),g}if(!u){const g=new Ae(q.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(g),g.throw(x)}if(e.optimizationMode&&Xk(r,u,e,El(e.encoderConfig)),Z("USE_STANDARD_BITRATE_DEFAULT")){const g=El(e.encoderConfig);e.encoderConfig=g,delete g.bitrateMax,delete g.bitrateMin}const f=new Kk(u,e,c,e.scalabiltyMode?MA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return o.onSuccess(f.getTrackId()),x.info("create camera video success, trackId:",r),f},createCustomVideoTrack:function(e){const t=lr(8,"track-cus-"),r=vt.reportApiInvoke(null,{id:t,tag:Hr.TRACER,name:di.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});Z("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const o=new gr(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?MA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Zn.CUSTOM_TRACK]);return r.onSuccess(o.getTrackId()),x.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const r=typeof t=="object"?function(I){return x4(I)}(t):void 0;r&&(t="auto");const o=lr(8,"track-scr-v-"),c=vt.reportApiInvoke(null,{id:o,tag:Hr.TRACER,name:di.CREATE_SCREEN_VIDEO_TRACK,options:[Nr({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(I){const D={};I.screenSourceType&&(D.mediaSource=I.screenSourceType),I.extensionId&&Mh()&&(D.extensionId=I.extensionId);const{displaySurface:V,selfBrowserSurface:M,surfaceSwitching:j,systemAudio:G,preferCurrentTab:z}=I;(wb(107)||dk(107)||uk(93))&&(V&&(ki(V,"displaySurface",["browser","window","monitor"]),D.displaySurface=V),M?(ki(M,"selfBrowserSurface",["exclude","include"]),D.selfBrowserSurface=M):D.selfBrowserSurface="include",j&&(ki(j,"surfaceSwitching",["exclude","include"]),D.surfaceSwitching=j)),(wb(105)||dk(105)||uk(91))&&G&&(ki(G,"systemAudio",["exclude","include"]),D.systemAudio=G),(wb(94)||dk(94)||uk(80))&&z&&(D.preferCurrentTab=!0),I.electronScreenSourceId&&(D.sourceId=I.electronScreenSourceId);const ce=I.encoderConfig?jk(I.encoderConfig):null;return D.mandatory={chromeMediaSource:"desktop",maxWidth:ce?ce.width:void 0,maxHeight:ce?ce.height:void 0},ce&&(ce.frameRate&&(typeof ce.frameRate=="number"?(D.mandatory.maxFrameRate=ce.frameRate,D.mandatory.minFrameRate=ce.frameRate):(D.mandatory.maxFrameRate=ce.frameRate.max||ce.frameRate.ideal||ce.frameRate.exact||void 0,D.mandatory.minFrameRate=ce.frameRate.min||ce.frameRate.ideal||ce.frameRate.exact||void 0),D.frameRate=ce.frameRate),ce.width&&(D.width=ce.width),ce.height&&(D.height=ce.height)),D}(e);let f=null,g=null;const E=In();if(!E.supportShareAudio&&t==="enable"){const I=new Ae(q.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(I),I.throw(x)}x.info("start create screen video track with config",e,"withAudio",t,"trackId",o);const v=E.supportShareAudio&&t!=="disable";try{const I=await rc({screen:u,screenAudio:v?r||!0:void 0},o);f=I.getVideoTracks()[0]||null,g=I.getAudioTracks()[0]||null}catch(I){throw c.onError(I),I}if(!f){const I=new Ae(q.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(I),I.throw(x)}if(!g&&t==="enable"){f&&f.stop();const I=new Ae(q.SHARE_AUDIO_NOT_ALLOWED);return c.onError(I),I.throw(x)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Xk(o,f,e,e.encoderConfig&&jk(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const S=new gr(f,e.encoderConfig?jk(e.encoderConfig):{},e.scalabiltyMode?MA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[Zn.SCREEN_TRACK]);if(!g)return c.onSuccess(S.getTrackId()),x.info("create screen video track success","video:",S.getTrackId()),S;const R=new qr(g,void 0,lr(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create screen video track success","video:",S.getTrackId(),"audio:",R.getTrackId()),[S,R]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=Z("CAMERA_CAPTURE_CONFIG"),o=lr(8,"track-mic-"),c=lr(8,"track-cam-"),u=vt.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:Hr.TRACER,name:di.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,r]});r&&(t.encoderConfig=r);const f=FA(t),g=P4(e);let E=null,v=null;x.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const I=await rc({audio:g,video:f},"".concat(o,"-").concat(c));E=I.getAudioTracks()[0],v=I.getVideoTracks()[0]}catch(I){throw u.onError(I),I}if(!E||!v){const I=new Ae(q.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(I),I.throw(x)}if(t.optimizationMode&&Xk(c,v,t,El(t.encoderConfig)),Z("USE_STANDARD_BITRATE_DEFAULT")){const I=El(t.encoderConfig);t.encoderConfig=I,delete I.bitrateMax,delete I.bitrateMin}const S=new Lb(E,e,g,o),R=new Kk(v,t,f,t.scalabiltyMode?MA(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,c);return u.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,R]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=lr(8,"track-mic-"),r=vt.reportApiInvoke(null,{id:t,tag:Hr.TRACER,name:di.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=P4(e);let c=null;x.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{c=(await rc({audio:o},t)).getAudioTracks()[0]||null}catch(f){throw r.onError(f),f}if(!c){const f=new Ae(q.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(f),f.throw(x)}const u=new Lb(c,e,o,t);return r.onSuccess(u.getTrackId()),x.info("create microphone audio track success, trackId:",t),u},createCustomAudioTrack:function(e){const t=lr(8,"track-cus-"),r=vt.reportApiInvoke(null,{id:t,tag:Hr.TRACER,name:di.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new qr(e.mediaStreamTrack,e.encoderConfig?jA(e.encoderConfig):{},t,!1);return x.info("create custom audio track success with config",e,"trackId",o.getTrackId()),r.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:r,encoderConfig:o}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":c,cacheOnlineFile:r,encoderConfig:o},f=lr(8,"track-buf-"),g=vt.reportApiInvoke(null,{id:f,tag:Hr.TRACER,name:di.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(Z("DISABLE_WEBAUDIO"))throw new Ae(q.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",f);const E=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,I){let D=null;if(typeof R=="string"){const M=y5.get(R);if(M)return x.debug("use cached audio resource: ",R),M;try{D=(await ld(()=>xa.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new Ae(q.FETCH_AUDIO_FILE_FAILED,j.toString())}}else D=await new nt((j,G)=>{const z=new FileReader;z.onload=ce=>{ce.target?j(ce.target.result):G(new Ae(q.READ_LOCAL_AUDIO_FILE_ERROR))},z.onerror=()=>{G(new Ae(q.READ_LOCAL_AUDIO_FILE_ERROR))},z.readAsArrayBuffer(R)});const V=await function(M){const j=zy();return new nt((G,z)=>{j.decodeAudioData(M,ce=>{G(ce)},ce=>{z(new Ae(q.DECODE_AUDIO_FILE_FAILED,ce.toString()))})})}(D);return typeof R=="string"&&I&&y5.set(R,V),V}(c,r)}catch(R){return g.onError(R),R.throw(x)}const v=new Nne(c),S=new Ine(E,v,o?jA(o):{},f);return x.info("create buffer source audio track success, trackId:",f),g.onSuccess(S.getTrackId()),S},setAppType:function(e){if(x.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw x.debug("Invalid appType"),new Te(q.INVALID_PARAMS,"invalid app type",e);qn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){x.setLogLevel(e)},enableLogUpload:function(){Z("USE_NEW_LOG")?qn("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){Z("USE_NEW_LOG")?qn("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new v6},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=vt.reportApiInvoke(null,{tag:Hr.TRACER,name:di.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof qr||e instanceof Ky)){const E=new Te(q.INVALID_TRACK,"the parameter is not a audio track");return r.onError(E),E.throw()}t&&t<1e3&&(t=1e3);const o=e instanceof qr?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,f=c;const g=Date.now();return new nt(E=>{const v=setInterval(()=>{const S=e.getVolumeLevel();u=S>u?S:u,f=S<f?S:f;const R=u-f>1e-4,I=Date.now()-g;if(R||I>t){clearInterval(v);const D=R,V={duration:I,deviceLabel:o,maxVolumeLevel:u,result:D};x.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(V))),r.onSuccess(V),E(D)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=vt.reportApiInvoke(null,{tag:Hr.TRACER,name:di.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof gr||e instanceof qy)){const R=new Te(q.INVALID_TRACK,"the parameter is not a video track");return r.onError(R),R.throw()}t&&t<1e3&&(t=1e3);const o=e instanceof gr?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(fs()||RA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const f=document.createElement("canvas");f.width=160,f.height=120;let g=0,E=0;try{const R=Date.now();g=await function(I,D,V,M){let j,G=0,z=null;return new nt((ce,Ee)=>{function _e(){G>M&&j&&(j(),ce(G));const me=V.getContext("2d");if(!me){const $e=new Te(q.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error($e.toString()),void Ee($e)}me.drawImage(I,0,0,160,120);const Ce=me.getImageData(0,0,V.width,V.height),xe=Math.floor(Ce.data.length/3);if(z){for(let $e=0;$e<xe;$e+=3)if(Ce.data[$e]!==z[$e])return G+=1,void(z=Ce.data);z=Ce.data}else z=Ce.data}setTimeout(()=>{j&&(j(),ce(G))},D),j=Hk(()=>{_e()},30)})}(u,t,f,4),E=Date.now()-R}catch(R){throw r.onError(R),R}Xre===Un.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const v=g>4,S={duration:E,changedPicNum:g,deviceLabel:o,result:v};return x.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),r.onSuccess(S),v},setArea:S1,audioElementPlayCenter:Pa,resumeAudioContext:function(){Pa.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){hie.processExternalMediaAEC(e)},registerExtensions:function(e){const t=Z("PLUGIN_INFO")||[];e.forEach(r=>{"name"in r&&!et(t).call(t,r.name)&&t.push(r.name);const o=r;o.__registered__=!0,o.logger.hookLog=x.extLog,o.reporter.hookApiInvoke=vt.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=Z(c)})}),vW("PLUGIN_INFO",t)},ChannelMediaRelayError:$y,ChannelMediaRelayEvent:Hh,ChannelMediaRelayState:no,RemoteStreamFallbackType:Sne,RemoteStreamType:vne,ConnectionDisconnectedReason:Fn,AudienceLatencyLevelType:$te,AREAS:Vn,preload:async function(e,t,r,o){return z6(e,t,r,o)}});return Object.defineProperties(Ti,{onAudioAutoplayFailed:{get:()=>sc.onAudioAutoplayFailed,set:e=>{sc.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>sc.onAutoplayFailed,set:e=>{sc.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ti._onSecurityPolicyViolation,set(e){Ti._onSecurityPolicyViolation=e,eG(e)}},__CLIENT_LIST__:{get:()=>Z("SHOW_GLOBAL_CLIENT_LIST")?Bg:[]}}),ic.on(jg.CAMERA_DEVICE_CHANGED,e=>{x.info("camera device changed",JSON.stringify(e)),Ti.onCameraChanged&&Ti.onCameraChanged(e),Ti.safeEmit(fu.CAMERA_CHANGED,e)}),ic.on(jg.RECORDING_DEVICE_CHANGED,e=>{x.info("microphone device changed",JSON.stringify(e)),Ti.onMicrophoneChanged&&Ti.onMicrophoneChanged(e),Ti.safeEmit(fu.MICROPHONE_CHANGED,e)}),ic.on(jg.PLAYOUT_DEVICE_CHANGED,e=>{x.debug("playout device changed",JSON.stringify(e)),Ti.onPlaybackDeviceChanged&&Ti.onPlaybackDeviceChanged(e),Ti.safeEmit(fu.PLAYBACK_DEVICE_CHANGED,e)}),Pa.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),sc.onAudioAutoplayFailed&&sc.onAudioAutoplayFailed()},Kn.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),sc.onAudioAutoplayFailed&&sc.onAudioAutoplayFailed(),Ti.safeEmit(fu.AUTOPLAY_FAILED)}),Kn.on(as.STATE_CHANGE,(e,t)=>{x.info("audio context state changed: ".concat(t," => ").concat(e)),Ti.onAudioContextStateChanged&&Ti.onAudioContextStateChanged(e,t),Ti.safeEmit(fu.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),ui.on(Py.NETWORK_STATE_CHANGE,(e,t)=>{x.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Ti),Ti})}(tO)),tO.exports}var Ove=Nve();const pM=fR(Ove);function Dve(a){return rS({attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{id:"Microphone_Off"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{d:"M16.5,7.046v4.72a.5.5,0,0,1-1,0V9.946H14a.5.5,0,0,1,0-1h1.5v-2H13.57a.5.5,0,0,1,0-1h1.87a3.23,3.23,0,0,0-.2-.72,3.533,3.533,0,0,0-6.16-.59c-.36.53-1.23.03-.87-.5a4.509,4.509,0,0,1,7.71.21A5.255,5.255,0,0,1,16.5,7.046Z"},child:[]},{tag:"path",attr:{d:"M20.14,19.436q-2.625-2.64-5.27-5.28Q10.685,9.986,6.51,5.8c-.65-.64-1.3-1.29-1.94-1.94a.5.5,0,0,0-.71.71Q5.69,6.381,7.5,8.206v3.92a4.591,4.591,0,0,0,3.59,4.61,4.629,4.629,0,0,0,3.9-1.04c.24.24.48.47.71.71a5.252,5.252,0,0,1-6.62.67,5.2,5.2,0,0,1-2.05-2.76,7.608,7.608,0,0,1-.24-2.33v-2.2a.5.5,0,0,0-1,0,15.463,15.463,0,0,0,.34,4.99,6.276,6.276,0,0,0,5.37,4.17v1.99H8a.5.5,0,0,0,0,1h8a.5.5,0,0,0,0-1H12.5v-2a6.118,6.118,0,0,0,3.91-1.82l1.08,1.08c.65.65,1.3,1.3,1.95,1.94A.5.5,0,0,0,20.14,19.436Zm-11.2-5.42a3.991,3.991,0,0,1-.44-2.03V9.206l5.77,5.77A3.521,3.521,0,0,1,8.94,14.016Z"},child:[]}]}]}]})(a)}const xve=({isCameraOn:a,isMuted:n,patientInfo:i})=>{var ue,ye;const s=ds();Wi();const l=i?i.charAt(0).toUpperCase():"",{channelDetails:p}=Tr(ae=>ae.info),_=(p==null?void 0:p.appId)||null,T=(p==null?void 0:p.token)||null,w=(p==null?void 0:p.channelName)||null,C=(p==null?void 0:p.uid)||0,O=JSON.parse(localStorage.getItem("doctor-app")),k=(ue=O==null?void 0:O.doctorData)!=null&&ue.name?(ye=O==null?void 0:O.doctorData)==null?void 0:ye.name.charAt(0).toUpperCase():"",U=F.useRef(null),Y=F.useRef(null),W=F.useRef(null),ee=F.useRef(null),[K,ie]=F.useState({}),se=F.useCallback(ae=>{const ve=`Remote User ${ae}`,$=ve.charAt(0).toUpperCase();return{name:ve,initial:$}},[]);return F.useEffect(()=>(U.current||(U.current=pM.createClient({mode:"rtc",codec:"vp8"})),(async()=>{if(!_||!w||!T){console.error("Agora Error: Missing APP_ID, CHANNEL, or TOKEN. Cannot join."),s("/doctor-home");return}try{await U.current.join(_,w,T,C),Y.current=await pM.createMicrophoneAudioTrack(),W.current=await pM.createCameraVideoTrack(),ee.current?W.current.play(ee.current):console.warn("Local video ref is not available. Cannot play local video."),await U.current.publish([Y.current,W.current]),U.current.remoteUsers.forEach(async ve=>{var te;const{name:$,initial:Q}=se(ve.uid);if(ie(oe=>({...oe,[ve.uid]:{...ve,audioMuted:!ve.hasAudio,videoMuted:!ve.hasVideo,remoteDisplayName:$,remoteDisplayInitial:Q}})),ve.hasAudio&&(await U.current.subscribe(ve,"audio"),(te=ve.audioTrack)==null||te.play()),ve.hasVideo){await U.current.subscribe(ve,"video");const oe=`remote-player-${ve.uid}`;setTimeout(()=>{var re;if(document.getElementById(oe)){(re=ve.videoTrack)==null||re.play(oe);const fe=document.getElementById(oe).querySelector("video");fe&&(fe.style.width="100%",fe.style.height="100%",fe.style.objectFit="cover")}else console.warn(`Video player container ${oe} not found for existing user ${ve.uid}.`)},300)}}),U.current.on("user-published",async(ve,$)=>{var oe;await U.current.subscribe(ve,$);const{name:Q,initial:te}=se(ve.uid);if(ie(re=>({...re,[ve.uid]:{...re[ve.uid],...ve,audioMuted:!ve.hasAudio,videoMuted:!ve.hasVideo,remoteDisplayName:Q,remoteDisplayInitial:te}})),$==="video"){const re=`remote-player-${ve.uid}`;setTimeout(()=>{var fe;if(document.getElementById(re)){(fe=ve.videoTrack)==null||fe.play(re);const pe=document.getElementById(re).querySelector("video");pe&&(pe.style.width="100%",pe.style.height="100%",pe.style.objectFit="cover")}else console.warn(`Video player container ${re} not found for user ${ve.uid}.`)},300)}else $==="audio"&&((oe=ve.audioTrack)==null||oe.play())}),U.current.on("user-updated",(ve,$)=>{ie(Q=>{const te=Q[ve.uid]||{},oe=te.videoMuted&&ve.hasVideo,re={...te,...ve,audioMuted:!ve.hasAudio,videoMuted:!ve.hasVideo};if($==="video"&&ve.hasVideo&&ve.videoTrack&&oe){const fe=`remote-player-${ve.uid}`;setTimeout(()=>{if(document.getElementById(fe)){ve.videoTrack.play(fe);const pe=document.getElementById(fe).querySelector("video");pe&&(pe.style.width="100%",pe.style.height="100%",pe.style.objectFit="cover")}},300)}return{...Q,[ve.uid]:re}})}),U.current.on("user-unpublished",(ve,$)=>{$==="video"&&ve.videoTrack&&ve.videoTrack.stop(),ie(Q=>{const te={...Q};return te[ve.uid]&&($==="audio"?te[ve.uid].audioMuted=!0:$==="video"&&(te[ve.uid].videoMuted=!0)),te})}),U.current.on("user-left",async ve=>{ie($=>{const Q={...$};return delete Q[ve.uid],Q})})}catch(ve){console.error("Agora Operation Error:",ve)}})(),()=>{(async()=>{Y.current&&(Y.current.close(),Y.current=null),W.current&&(W.current.close(),W.current=null),U.current&&U.current.connectionState==="CONNECTED"&&await U.current.leave(),U.current=null,ie({})})()}),[_,w,T,C,se]),F.useEffect(()=>{W.current&&W.current.setEnabled(a)},[a]),F.useEffect(()=>{Y.current&&Y.current.setEnabled(!n)},[n]),m.jsxs("div",{style:{position:"relative",width:"100%",height:"580px",backgroundColor:"#000",display:"flex",flexDirection:"column",overflow:"hidden"},children:[m.jsx("div",{id:"remote-video-grid-container",style:{flexGrow:1,backgroundColor:"#0c0d0f",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"10px",overflowY:"auto",justifyContent:"center",alignContent:"center",width:"100%",height:"580px"},children:Object.entries(K).map(([ae,ve])=>m.jsxs("div",{id:`remote-player-${ve.uid}`,style:{aspectRatio:"4/3",position:"relative",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"2em",fontWeight:"bold",textAlign:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.4)",backgroundColor:"#0c0d0f",width:"100%",height:"580px"},children:[ve.videoMuted?m.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:3},children:l?m.jsx("span",{style:{fontSize:"3em"},children:l}):m.jsx("span",{children:"Video Off"})}):m.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"#0c0d0f"}}),ve.audioMuted&&m.jsx("div",{style:{position:"absolute",top:"20px",right:"240px",backgroundColor:"rgba(255, 0, 0, 0.7)",color:"#fff",padding:"4px 8px",borderRadius:"4px",fontSize:"0.8em",zIndex:4},children:m.jsx(Dve,{})})]},ae))}),m.jsx("div",{style:{position:"absolute",bottom:"120px",right:"20px",width:"180px",height:"240px",backgroundColor:"#0c0d0f",borderRadius:"8px",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"3em",fontWeight:"bold",zIndex:10,boxShadow:"0 4px 12px rgba(0,0,0,0.6)",border:"2px solid rgba(255,255,255,0.3)"},children:a?m.jsx("div",{ref:ee,style:{width:"100%",height:"100%",backgroundColor:"#222"}}):m.jsx("div",{style:{borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"48px",fontWeight:"bold",zIndex:2},children:k&&m.jsx("span",{style:{fontSize:"1em"},children:k})})})]})},Pve=()=>{const a=ds(),[n,i]=F.useState(!1),[s,l]=F.useState(!0),[p,_]=F.useState(!1);F.useRef(null);const T=Wi(),{id:w,patientId:C,time_period:O}=T.state||{},k=F.useRef([]),U=Li(),{patientProfileData:Y}=Tr(Ot=>Ot.patientProfile);F.useEffect(()=>{(!w||!C||!O)&&a("/doctor-home")},[T]);const[W,ee]=F.useState("");F.useEffect(()=>{const Ot=O==null?void 0:O.split(" - "),en=Ot==null?void 0:Ot[0],Dt=Ot==null?void 0:Ot[1];if(!en)return;const[mt,kt]=en==null?void 0:en.split(":");let Gt=parseInt(mt,10);const Mn=parseInt(kt,10),Ci=Dt.slice(-2);Ci==="PM"&&Gt!==12?Gt+=12:Ci==="AM"&&Gt===12&&(Gt=0);const[bs,Rr]=Dt.slice(0,-2).split(":");let kn=parseInt(bs,10);const Mi=parseInt(Rr,10),Ht=Dt.slice(-2);Ht==="PM"&&kn!==12?kn+=12:Ht==="AM"&&kn===12&&(kn=0);let sn=!1;const wt=()=>{const jn=new Date,Ei=new Date(jn.getFullYear(),jn.getMonth(),jn.getDate(),Gt,Mn,0),ai=new Date(jn.getFullYear(),jn.getMonth(),jn.getDate(),kn,Mi,0),Cr=new Date(ai.getTime()+5*60*1e3),ji=ai;if(!sn&&jn.getTime()>=ji.getTime()&&(ct.success("Note: This call will automatically end in 5 minutes. Please wrap up your discussion accordingly!",{duration:1e4}),sn=!0),jn.getTime()>=Cr.getTime()){window.location.href="/doctor-home";return}let zi=jn.getTime()-Ei.getTime();if(zi<0)ee("00:00:00");else{const ws=Math.floor(zi/1e3),ua=Math.floor(ws/3600),Fs=Math.floor(ws%3600/60),Wa=ws%60,je=String(ua).padStart(2,"0"),nn=String(Fs).padStart(2,"0"),yn=String(Wa).padStart(2,"0");ua>0?ee(`${je}:${nn}:${yn}`):ee(`${nn}:${yn}`)}};wt();const mn=setInterval(wt,1e3);return()=>clearInterval(mn)},[O]),F.useEffect(()=>{C&&U(Ov({patientId:C}))},[U,C]);const K=(Y==null?void 0:Y.basic_information)||{},{completeAssignedPrescription:ie,loading:se,loading2:ue,error:ye,medicineSearch:ae,user:ve}=Tr(Ot=>Ot.user),[$,Q]=F.useState([]),[te,oe]=F.useState(""),[re,fe]=F.useState(""),[pe,Ne]=F.useState(""),[Je,be]=F.useState(!1),[Ie,Re]=F.useState({}),[Me,he]=F.useState(null),[De,qe]=F.useState([]),[We,Be]=F.useState([{medicineName:"",dosage:"",frequency:"",duration:"",suggestions:[],showSuggestion:!1,isValid:!1}]),[bt,St]=F.useState(0);F.useEffect(()=>{const Ot=setInterval(()=>{St(en=>en+1)},1e3);return()=>clearInterval(Ot)},[]);const[Tt,ut]=F.useState({});F.useEffect(()=>{if(ae&&Me!==null){const Ot=[...We];Ot[Me].suggestions=ae,Be(Ot),ut(en=>({...en,[Me]:ae}))}},[ae]),F.useEffect(()=>{function Ot(en){be(!1);const Dt=[...We];let mt=!1;We.forEach((kt,Gt)=>{const Mn=k.current[Gt];Mn&&!Mn.contains(en.target)&&kt.suggestions.length>0&&(Dt[Gt].suggestions=[],mt=!0)}),mt&&Be(Dt)}return document.addEventListener("mousedown",Ot),()=>{document.removeEventListener("mousedown",Ot)}},[We]);const tn=()=>i(Ot=>!Ot),Mt=()=>{l(Ot=>!Ot)},wn=Ot=>a("/doctor-home",{state:{appointmentIdd:Ot,modaleOpen:!0}}),Yt=F.useCallback(async()=>{if(!w)return;const Ot=JSON.parse(localStorage.getItem("doctor-app")),en=Ot==null?void 0:Ot.token,Dt={appointment_id:w};try{const mt=await Ri.get(`${mi}api/doctor/prescriptions/is-completed`,{params:Dt,headers:{Authorization:`Bearer ${en}`,"Content-Type":"application/json"}});mt.data&&mt.data.data?_(mt.data.data.is_done):(_(!1),console.warn("API response.data.data is missing or unexpected."))}catch(mt){console.error("Error checking prescription status on focus:",mt),_(!1)}},[w]);F.useEffect(()=>{Yt()},[Yt]),F.useEffect(()=>{const Ot=()=>{Yt()};return window.addEventListener("focus",Ot),()=>{window.removeEventListener("focus",Ot)}},[Yt]);const Xn={opacity:p?.5:1,cursor:p?"not-allowed":"pointer"};return m.jsx("main",{className:"doctor-panel video-call-pg",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(Ga,{})}),m.jsx("div",{className:"video-call-screen",children:m.jsxs("div",{className:"vdo-call-scrn-row row",children:[m.jsx("div",{className:"vdo-call-scrn-left-wrp col-lg-6",children:m.jsx("div",{className:"vdoclscrn-left",children:m.jsxs("div",{className:"vdo-screen",children:[m.jsxs("div",{className:"vdo-screen-controls",children:[m.jsxs("div",{className:"vdoscrn-controls-head",children:[m.jsx("h1",{children:K==null?void 0:K.name}),m.jsxs("div",{className:"vdoscrn-status-time-wrp",children:[m.jsx("span",{className:"vdoscrn-status live",children:"LIVE"}),m.jsx("span",{className:"vdoscrnduration-time",children:W})]})]}),m.jsx("div",{className:"vdoscrn-controls-body",children:m.jsxs("div",{className:"vdoscrn-volume-con",children:[m.jsx("img",{src:"./images/speaker-icon.svg",alt:"Icon"}),m.jsx("input",{type:"range"})]})}),m.jsxs("div",{className:"vdoscrn-controls-ftr",style:{marginLeft:100},children:[m.jsxs("div",{className:"vdoscrn-action-controls",children:[m.jsx("button",{className:"vdo-toggle-btn",onClick:Mt,style:{marginTop:-30},children:m.jsx("img",{src:s?"./images/video-cam-icon.svg":"./images/video-camera-off-icon.svg",alt:"Camera Icon",style:{filter:s?"none":"invert(100%)"}})}),m.jsx("button",{className:"vdo-call-end-btn",onClick:()=>wn(w),style:{borderRadius:"50%",padding:"10px",marginTop:-30},children:m.jsx("img",{src:"./images/call-icon.svg",alt:"Call End Icon"})}),m.jsx("button",{className:"vdo-mute-toggle-btn",onClick:tn,style:{marginTop:-30},children:m.jsx("img",{src:n?"./images/mic-off.svg":"./images/mic-icon.svg",alt:"Mic Icon",style:{filter:n?"invert(100%)":"none"}})})]}),m.jsx("div",{className:"doc-vdo-scrn"})]})]}),m.jsx("div",{className:"patient-vdo-screen",children:m.jsx(xve,{isCameraOn:s,isMuted:n,patientInfo:K.name})})]})})}),m.jsx("div",{className:" col-lg-6",children:se?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsx("form",{children:m.jsx("div",{className:"vdoclscrn-patient-details-wrp-inr",children:m.jsxs("div",{className:"vdoclscrn-patient-details",children:[m.jsxs("div",{className:"vdoclscrnpd-wrp",children:[m.jsx("h2",{children:"Patient Details:"}),m.jsx("div",{className:"vdoclscrnpd",children:[{label:"Patient Name",value:K.name||"N/A"},{label:"Age",value:K.age||"N/A"},{label:"Gender",value:K.gender?K.gender.charAt(0).toUpperCase()+K.gender.slice(1):"N/A"},{label:"Height",value:K.height||"N/A"},{label:"Weight",value:K.weight||"N/A"},{label:"Contact No.",value:K.phone_no||"N/A"}].map((Ot,en)=>m.jsxs("div",{className:"vdoclscrnpd-grp",children:[m.jsx("span",{className:"vdoclscrnpd-label",children:Ot.label}),m.jsx("span",{className:"vdoclscrnpd-val",children:Ot.value})]},en))})]}),m.jsx("div",{className:"mt-4 text-right",children:m.jsx("a",{href:`/PrescriptiveDoctor?id=${w}&patientId=${C}`,target:"_blank",rel:"noopener noreferrer",onClick:Ot=>{p&&Ot.preventDefault()},children:m.jsx("button",{type:"button",className:"orange-btn",style:Xn,disabled:p,children:"Go for Prescription"})})})]})})})})]})})]})})};function kve(){const a=ds();return F.useEffect(()=>{localStorage.getItem("doctor-app")?(ct.error("The URL you entered does not exist. Redirected to home."),a("/doctor-home",{replace:!0})):(ct.error("Please login first"),a("/",{replace:!0}))},[a]),null}const Lve=()=>{const a=Li(),{pendingPrescription:n,loading:i,error:s}=Tr(K=>K.user),[l,p]=F.useState(1),_=5;F.useEffect(()=>{a(IN())},[a]);const T=n||[],w=Math.ceil(T.length/_),C=l*_,O=C-_,k=T.slice(O,C),U=K=>{p(K)},Y=()=>l<w&&p(l+1),W=()=>l>1&&p(l-1),ee=K=>{if(!K)return"N/A";const ie=new Date().getFullYear(),se=`${K} ${ie}`,ue=new Date(se);if(isNaN(ue))return"Invalid Date";const ye=String(ue.getDate()).padStart(2,"0"),ae=String(ue.getMonth()+1).padStart(2,"0"),ve=ue.getFullYear();return`${ye}/${ae}/${ve}`};return m.jsx(m.Fragment,{children:m.jsx("main",{className:"doctor-panel",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(Ga,{})}),i?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"doc-panel-body",children:[m.jsx("div",{className:"docpnl-sec-head",children:m.jsx("h1",{className:"h2-title",children:"Pending Prescriptions"})}),m.jsx("div",{className:"pending-prescriptions-wrp",children:m.jsxs("div",{className:"my-appointments-inr",children:[m.jsx("div",{className:"myapintmnt-content-tab pending",children:m.jsx("div",{className:"pending-presc-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Patient Name"}),m.jsx("th",{children:"Symptom Upload Date"}),m.jsx("th",{children:"Disease"}),m.jsx("th",{children:"View Details"})]})}),m.jsxs("tbody",{children:[k.length==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center"},children:i?"Loading...":m.jsx("span",{style:{fontWeight:"400",fontSize:18},children:"No data found"})})}),k.map((K,ie)=>m.jsxs("tr",{children:[m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:String((l-1)*_+ie+1).padStart(2,"0")}),m.jsxs("td",{style:{textAlign:"left",maxWidth:"287px",paddingLeft:"165px"},children:[m.jsx(dn,{to:"/patient-profile",state:{patientId:K.patient_id},className:"no-underline-link",style:{display:"inline-block ",fontSize:20,marginLeft:10},children:K.patient_name}),(K==null?void 0:K.is_referred_patient)==!1?m.jsxs("div",{className:"time",style:{color:"#199FD9",marginLeft:10,fontWeight:"bold"},children:[m.jsxs("span",{style:{color:"black",fontWeight:"bold"},children:["(DS Code:"," "]}),K.ds_code,m.jsx("span",{children:")"})]}):m.jsxs("div",{className:"time",style:{color:"#199FD9",fontWeight:"bold"},children:[m.jsx("span",{style:{color:"black",fontWeight:"bold"},children:"(Referred by DS Code:"}),K.ds_code,m.jsx("span",{children:")"})]})]}),m.jsxs("td",{children:[m.jsx("div",{className:"date",style:{color:"#199FD9",fontSize:20},children:ee(K.date)}),m.jsx("div",{className:"time",style:{color:"#199FD9"},children:K.time})]}),m.jsx("td",{style:{color:"#199FD9"},children:K.diseaseName}),m.jsx("td",{children:m.jsx(dn,{to:"/patient-details",state:{id:K.appointment_id,patientId:K.patient_id,referrerDscode:K.ds_code,referrer:K.referred_patient_name},style:{fontSize:20},children:"View"})})]},ie))]})]})})}),T.length>0&&m.jsx(xu,{currentPage:l,totalPages:w,onPageChange:U,onPrevious:W,onNext:Y})]})})]}),m.jsx(po,{})]})})})},Mve=()=>m.jsx(m.Fragment,{children:m.jsx("main",{className:"doctor-panel",children:m.jsxs(iq,{fluid:!0,children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(Ga,{})}),m.jsxs("div",{className:"doc-panel-body appoint-details-pg has-texture papd-pg",children:[m.jsx("div",{className:"texture only-img",children:m.jsx("img",{src:"./images/doctor-symbol.png",alt:"Symbol"})}),m.jsxs("div",{className:"appointments",children:[m.jsxs("div",{className:"start-appointment cmn-mb",children:[m.jsxs("div",{className:"docpnl-sec-head",children:[m.jsx("h1",{className:"h2-title",children:"Symptom Upload Details"}),m.jsx("div",{className:"back-btn",children:m.jsx(dn,{to:"#",onClick:a=>{a.preventDefault(),window.history.back()},children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),m.jsxs("div",{className:"apointment-detail-card",children:[m.jsx("div",{className:"apoint-dtl-img",children:m.jsx("img",{src:"./images/client-img-5.png",alt:"Patient"})}),m.jsxs("div",{className:"appoint-dtl-content",children:[m.jsxs("div",{className:"appoint-dtl-left",children:[m.jsx("div",{className:"date h3-title",children:"21/12/2024"}),m.jsx("div",{className:"time",children:"10:40 PM"})]}),m.jsx(dn,{to:"/patient-profile",className:"cmn-btn",children:"View profile"})]})]})]}),m.jsx("div",{className:"patient-details-wrp",children:m.jsx(ot,{children:m.jsxs("div",{className:"patient-dtl-form",children:[m.jsxs("div",{className:"patient-basic-info cmn-mb2",children:[m.jsx("h2",{children:"Basic Information"}),m.jsx(UM,{children:["Name","Height","Weight","Gender","Age"].map((a,n)=>m.jsx(dO,{lg:4,md:4,sm:6,children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:a}),m.jsx(ot.Control,{type:"text",placeholder:a==="Name"?"Name":"Answer"})]})},n))})]}),m.jsxs("div",{className:"scheduled-call-consultations cmn-mb2",children:[m.jsx("h2",{children:"Uploaded Symptoms"}),m.jsx(UM,{children:[1,2,3,4].map(a=>m.jsx(dO,{lg:12,children:m.jsxs("div",{className:"formfield",children:[m.jsxs("label",{children:[a,". Lorem ipsum dolor sit amet"]}),m.jsx(ot.Control,{type:"text",placeholder:"Answer"})]})},a))})]}),m.jsxs("div",{className:"view-uploaded-images-wrp",children:[m.jsx("h2",{children:"View Uploaded Images"}),m.jsx("div",{className:"view-uploaded-img",children:[...Array(3)].map((a,n)=>m.jsx("div",{className:"img-wrp",children:m.jsx("a",{href:"./images/symptom-img.png","data-fancybox":"symptoms",children:m.jsx("img",{src:"./images/symptom-img.png",alt:"Symptom"})})},n))})]}),m.jsxs("div",{className:"view-uploaded-images-wrp uploaded-vdo-wrp",children:[m.jsx("h2",{children:"View Uploaded Videos"}),m.jsx("div",{className:"view-uploaded-img",children:[...Array(3)].map((a,n)=>m.jsx("div",{className:"img-wrp",children:m.jsx("a",{href:"https://youtu.be/EngW7tLk6R8?si=m3prZmspIQt_MGXm","data-fancybox":"symptoms",children:m.jsx("img",{src:"./images/symptom-img.png",alt:"Video"})})},n))})]}),m.jsxs("div",{className:"view-uploaded-images-wrp upload-file-wrp",children:[m.jsx("h2",{children:"View Uploaded Files"}),m.jsx("div",{className:"view-uploaded-img",children:[...Array(3)].map((a,n)=>m.jsx("div",{className:"img-wrp",children:m.jsxs("a",{href:"./images/file-icon.svg","data-fancybox":"symptoms",children:[m.jsx("img",{src:"./images/file-icon.svg",alt:"File"}),m.jsx("span",{className:"file-size",children:"5.3mb"})]})},n))})]}),m.jsx("div",{className:"btn-wrp",children:m.jsx(dn,{to:"/CompletedAssignedPrescription",children:m.jsx("button",{type:"button",className:"orange-btn",children:"Respond"})})})]})})})]})]}),m.jsx(po,{})]})})}),jve=({show:a,handleClose:n})=>{const i=ds(),s=()=>{n(),i("/pendingprescription")};return m.jsxs(bn,{show:a,onHide:n,centered:!0,dialogClassName:"custom-modal",children:[m.jsx("style",{children:`
            .custom-modal .modal-content {
              border-radius: 15px !important;
              // border: 12px solid red;
                max-width: 400px; 
  margin: auto;
            }
          `}),m.jsxs(bn.Body,{className:"text-center p-4",children:[m.jsx("div",{style:{marginBottom:"20px"},children:m.jsx("img",{src:"/images/check-icon.png",alt:"Success"})}),m.jsx("h4",{style:{fontSize:"22px",fontWeight:"600",color:"#333",marginBottom:"8px"},children:"Successfully Submitted"}),m.jsx("p",{style:{fontSize:"16px",color:"#888",marginBottom:"25px"},children:"Prescription successfully submitted"}),m.jsx(Pi,{variant:"primary",onClick:s,style:{backgroundColor:"#f37021",border:"none",padding:"12px 30px",fontSize:"16px",borderRadius:"8px",width:"100%",maxWidth:"200px"},children:"Ok"})]})]})};function kX(a){return rS({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M4 8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8ZM6 10V20H18V10H6ZM9 12H11V18H9V12ZM13 12H15V18H13V12ZM7 5V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V5H22V7H2V5H7ZM9 4V5H15V4H9Z"},child:[]}]})(a)}const Uve=({id:a})=>{const n=Li(),i=ds();Wi();const[s,l]=F.useState(!1),[p,_]=F.useState(!1),{allMedicine:T,loading:w,error:C}=Tr(Be=>Be.userdata),{medicineSearch:O}=Tr(Be=>Be.user);F.useEffect(()=>{n(Uw())},[n]);const[k,U]=F.useState(T);F.useEffect(()=>{T&&U(T)},[T]),F.useEffect(()=>{n(Fw({appointment_id:a}))},[n,a]);const Y=F.useMemo(()=>{if(!T||!T.treatments)return[];const Be=new Set,bt=[];return T.treatments.forEach(St=>{Be.has(St.medicine_name)||(Be.add(St.medicine_name),bt.push({medicine_id:St.medicine_id,medicine_name:St.medicine_name}))}),bt},[T]),[W,ee]=F.useState(!1),[K,ie]=F.useState(!1),[se,ue]=F.useState(null),ye=500,[ae,ve]=F.useState(""),[$,Q]=F.useState({medicine_name:"",dosage:"",duration:"",unit:"",with_water:"",dosage_frequency:"",meal_timing:"",day_time:"",remarks:""}),te=ae.length,oe=Be=>{switch(Be){case"morning":return"Morning";case"morning_afternoon":return"Morning + Afternoon";case"morning_evening":return"Morning + Evening";case"morning_afternoon_evening":return"Morning + Afternoon + Evening";case"morning_afternoon_evening_night":return"Morning + Afternoon + Evening + Night";case"morning_night":return"Morning + Night";case"night":return"Night";default:return Be}},re=Be=>{switch(Be){case"before":return"Before";case"after":return"After";default:return Be}},fe=Be=>{ue({...Be,with_water:Be.with_water===1?"Yes":"No"}),ee(!0)},pe=()=>{ee(!1),ue(null)},Ne=Be=>{const{name:bt,value:St}=Be.target;ue(Tt=>({...Tt,[bt]:St}))},Je=()=>{let Be=!0;const bt=["medicine_name","dosage","duration","unit","with_water","dosage_frequency","meal_timing","day_time"];for(const Tt of bt)if(!se[Tt]||String(se[Tt]).trim()===""){ct.error(`Please fill in the "${Tt.replace(/_/g," ")}" field.`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),Be=!1;break}if(!Be)return;const St={...se,with_water:se.with_water==="Yes"?1:0};U(Tt=>({...Tt,treatments:Tt.treatments.map(ut=>ut.treatment_id===St.treatment_id?St:ut)})),pe(),ct.success("Medicine updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"})},be=Be=>{U(bt=>({...bt,treatments:bt.treatments.filter(St=>St.treatment_id!==Be)})),ct.info("Medicine deleted successfully!",{position:"top-center",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})},Ie=()=>{ie(!0),Q({medicine_name:"",dosage:"",duration:"",unit:"",with_water:"",dosage_frequency:"",meal_timing:"",day_time:"",remarks:""})},Re=()=>{ie(!1)},Me=Be=>{const{name:bt,value:St}=Be.target;Q(Tt=>{const ut={...Tt,[bt]:St};if(bt==="medicine_name"&&St){const tn=O.find(Mt=>Mt.product_name===St);tn&&tn.unit&&(ut.unit=tn.unit)}return ut})},he=()=>{let Be=!0;const bt=["medicine_name","dosage","duration","unit","with_water","dosage_frequency","meal_timing","day_time"];for(const Mt of bt)if(!$[Mt]||String($[Mt]).trim()===""){ct.error(`Please fill in the "${Mt.replace(/_/g," ")}" field.`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),Be=!1;break}if($.medicine_name.trim()||(ct.error("Please select a Medicine Name.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),Be=!1),k.treatments&&k.treatments.some(Mt=>Mt.medicine_name.toLowerCase()===$.medicine_name.toLowerCase())&&(ct.error("Duplicate medicine not added. This medicine already exists in the table.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),Be=!1),!Be)return;const St=k.treatments&&k.treatments.length>0?Math.max(...k.treatments.map(Mt=>Mt.treatment_id||0))+1:1,Tt=O.find(Mt=>Mt.product_name===$.medicine_name),ut=Tt?Tt.product_code:St,tn={...$,treatment_id:St,medicine_id:ut,with_water:$.with_water==="Yes"?1:0};U(Mt=>({...Mt,treatments:[...Mt.treatments||[],tn]})),Re(),ct.success("New medicine added successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"})},De=async()=>{if(!k||!k.disease_name||!k.treatments||k.treatments.length===0){ct.warn("No data to submit! Please add at least one medicine.",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"});return}_(!0)},qe=async()=>{_(!1),l(!0);const Be=JSON.parse(localStorage.getItem("doctor-app")),bt=Be==null?void 0:Be.token;if(!bt){ct.error("Authentication token not found. Please log in again.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),l(!1);return}const St={appointment_id:a,diagnosis:k.disease_name,notes:ae,medicines:k.treatments.map(Tt=>({medicine_name:Tt.medicine_name,dosage:Tt.dosage,duration:Tt.duration,unit:Tt.unit,with_water:Tt.with_water,dosage_frequency:String(Tt.dosage_frequency),meal_timing:Tt.meal_timing,day_time:Tt.day_time,remarks:Tt.remarks}))};try{const Tt=await Ri.post(`${mi}api/doctor/prescriptions/submit_appointment_prescription`,St,{headers:{Authorization:`Bearer ${bt}`,"Content-Type":"application/json"}});Tt.data.status?(ct.success("Prescription data submitted successfully!",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark"}),l(!1),i("/doctor-home")):(ct.error(Tt.data.message||"An error occurred.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),l(!1))}catch(Tt){console.error("API Call Error:",Tt),Tt.response?(console.error("Error response data:",Tt.response.data),console.error("Error response status:",Tt.response.status),ct.error(Tt.response.data.message||"Server error. Please try again.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})):Tt.request?ct.error("No response from server. Please check your internet connection.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}):ct.error("An unexpected error occurred. Please try again.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),l(!1)}};if(s)return m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})});if(C)return m.jsxs("div",{className:"flex justify-center items-center h-screen text-red-600 font-bold text-lg",children:["Error: ",C]});const We=k&&Array.isArray(k.treatments)&&k.treatments.length>0;return w?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"mx-auto font-sans bg-white",children:[m.jsx(nj,{}),m.jsx("div",{style:{width:"200px",border:"1px solid #ccc",padding:"8px",borderRadius:"6px",marginBottom:-40},children:m.jsx("h3",{className:"text-3xl font-bold text-gray-800 m-0",style:{fontSize:20},children:(k==null?void 0:k.disease_name)||"N/A"})}),m.jsx("div",{className:"mb-4 text-right",children:m.jsxs(Pi,{onClick:Ie,style:{backgroundColor:"#F47820"},className:"border-0 px-6 py-2 rounded-lg shadow-md text-white flex items-center gap-2 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-75",children:[m.jsx(rj,{style:{marginBottom:5,marginRight:5}}),"Add New Medicine"]})}),m.jsx("div",{className:"overflow-x-auto bg-white border-[#199FD9]",children:We?m.jsxs(Tq,{hover:!0,responsive:!0,className:"min-w-full text-center table-auto rounded-lg overflow-hidden",children:[m.jsx("thead",{style:{backgroundColor:"#199FD9",color:"white"},children:m.jsxs("tr",{children:[m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"S.No."}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Medicine Name"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Dosage"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Duration (For day)"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Unit"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"With Water"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Frequency (Times per day)"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Before/After Meal"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Day Time"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Remarks"}),m.jsx("th",{className:"px-4 py-3",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Actions"})]})}),m.jsx("tbody",{children:k.treatments.map((Be,bt)=>m.jsxs("tr",{className:"hover:bg-gray-100",children:[m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:bt+1}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:Be.medicine_name}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:Be.dosage}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:Be.duration}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:Be.unit}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:Be.with_water===1?"Yes":"No"}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:Be.dosage_frequency}),m.jsxs("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:[re(Be.meal_timing)," "]}),m.jsxs("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:[oe(Be.day_time)," "]}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:Be.remarks}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:m.jsxs("div",{style:{display:"flex",gap:"8px"},children:[m.jsx("button",{onClick:()=>fe(Be),style:{border:"none",background:"transparent",padding:"4px"},children:m.jsx(EK,{style:{color:"#199FD9"}})}),m.jsx("button",{onClick:()=>be(Be.treatment_id),style:{border:"none",background:"transparent",padding:"4px"},children:m.jsx(kX,{style:{color:"red"}})})]})})]},Be.treatment_id))})]}):m.jsxs("div",{className:"text-center py-5",children:[m.jsx("p",{className:"text-xl text-gray-600 font-semibold",children:"No Data Found"}),m.jsx("p",{className:"text-gray-500 mt-2",children:'Start by adding new medicines using the "Add New Medicine" button above.'})]})}),m.jsxs("div",{style:{display:"flex",flexDirection:"column",marginTop:10,marginBottom:20,position:"relative",width:"60%"},children:[m.jsx("h3",{children:"Advice/Suggestion/Investigation."}),m.jsx("textarea",{style:{width:"100%",height:100,border:"1px solid #199FD9",backgroundColor:"white",maxHeight:"200px",overflowY:"auto",padding:"8px",boxSizing:"border-box",resize:"vertical"},value:ae,onChange:Be=>{Be.target.value.length<=ye&&ve(Be.target.value)},rows:4,cols:50,placeholder:"Enter your advice, suggestion, or investigation details here...",maxLength:ye}),m.jsxs("div",{style:{position:"absolute",bottom:5,right:5,fontSize:"0.8em",color:te===ye?"red":"#666",backgroundColor:"rgba(255, 255, 255, 0.7)",padding:"2px 5px",borderRadius:"3px",pointerEvents:"none"},children:[te,"/",ye]})]}),We&&m.jsx("div",{className:"mt-6 text-center",children:m.jsx(Pi,{className:"orange-btn",onClick:De,children:"Submit"})}),m.jsxs(bn,{show:W,onHide:pe,centered:!0,children:[m.jsx(bn.Header,{closeButton:!0,style:{backgroundColor:"#199FD9",color:"white"},className:"add-new-med-close border-b-0 rounded-t-lg",children:m.jsx(bn.Title,{className:"text-xl font-bold",children:"Update Medicine"})}),m.jsx(bn.Body,{className:"p-6 bg-gray-50",children:se&&m.jsxs(ot,{children:[m.jsxs(ot.Group,{className:"mb-3",controlId:"formMedicineName",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Medicine Name"}),m.jsx(ot.Control,{type:"text",name:"medicine_name",value:se.medicine_name,onChange:Ne,list:"medicineSuggestionsList",disabled:!0,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),m.jsx("datalist",{id:"medicineSuggestionsList",children:Y.map(Be=>m.jsx("option",{value:Be.medicine_name},Be.medicine_id))})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formDosage",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Dosage"}),m.jsx(ot.Control,{type:"text",name:"dosage",value:se.dosage,onChange:Ne,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formDuration",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Duration"}),m.jsx(ot.Control,{type:"text",name:"duration",value:se.duration,onChange:Ne,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formUnit",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Unit"}),m.jsxs(ot.Select,{name:"unit",value:se.unit,onChange:Ne,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Unit"}),m.jsx("option",{value:"mg",children:"Milligram (mg)"}),m.jsx("option",{value:"g",children:"Gram (g)"}),m.jsx("option",{value:"tab",children:"Tablet (tab)"}),m.jsx("option",{value:"cap",children:"Capsule (cap)"}),m.jsx("option",{value:"ml",children:"Milliliter (mL)"}),m.jsx("option",{value:"drop",children:"Drop (drop)"}),m.jsx("option",{value:"tbsp",children:"Tablespoon (tbsp)"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formWithWater",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"With Water"}),m.jsxs(ot.Select,{name:"with_water",value:se.with_water,onChange:Ne,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select"}),m.jsx("option",{value:"Yes",children:"Yes"}),m.jsx("option",{value:"No",children:"No"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formDosageFrequency",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Dosage Frequency"}),m.jsx(ot.Control,{type:"number",name:"dosage_frequency",value:se.dosage_frequency,onChange:Ne,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formMealTiming",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Meal Timing"}),m.jsxs(ot.Select,{name:"meal_timing",value:se.meal_timing,onChange:Ne,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Before/After Meal"}),m.jsx("option",{value:"before",children:"Before "}),m.jsx("option",{value:"after",children:"After "})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formDayTime",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Day Time"}),m.jsxs(ot.Select,{name:"day_time",value:se.day_time,onChange:Ne,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select"}),m.jsx("option",{value:"morning",children:"Morning"}),m.jsx("option",{value:"morning_afternoon",children:"Morning + Afternoon"}),m.jsx("option",{value:"morning_evening",children:"Morning + Evening"}),m.jsx("option",{value:"morning_afternoon_evening",children:"Morning + Afternoon + Evening"}),m.jsx("option",{value:"morning_night",children:"Morning + Night"}),m.jsx("option",{value:"night",children:"Night"}),m.jsx("option",{value:"morning_afternoon_evening_night",children:"Morning + Afternoon + Evening + Night"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formRemarks",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Remarks (Optional)"}),m.jsx(ot.Control,{as:"textarea",rows:3,name:"remarks",value:se.remarks,onChange:Ne,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}),m.jsxs(bn.Footer,{className:"bg-gray-100 p-4 border-t-0 rounded-b-lg flex justify-end gap-3",children:[m.jsx(Pi,{variant:"secondary",onClick:pe,className:"px-4 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400",children:"Cancel"}),m.jsx(Pi,{style:{backgroundColor:"#F47820",borderColor:"#F47820"},onClick:Je,className:"px-4 py-2 rounded-md text-white hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500",children:"Update Medicine"})]})]}),m.jsxs(bn,{show:K,onHide:Re,centered:!0,children:[m.jsx(bn.Header,{closeButton:!0,style:{backgroundColor:"#199FD9",color:"white"},className:"add-new-med-close border-b-0 rounded-t-lg",children:m.jsx(bn.Title,{className:"text-xl font-bold",children:"Add New Medicine"})}),m.jsx(bn.Body,{className:"p-6 bg-gray-50",children:m.jsxs(ot,{children:[m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewMedicineName",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Medicine Name"}),m.jsxs(ot.Select,{name:"medicine_name",value:$.medicine_name,onChange:Me,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Medicine"}),O&&O.length>0?O.map(Be=>m.jsx("option",{value:Be.product_name,children:Be.product_name},Be.product_code)):m.jsx("option",{value:"",disabled:!0,children:"Loading medicines..."})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewDosage",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Dosage"}),m.jsx(ot.Control,{type:"text",name:"dosage",value:$.dosage,onChange:Me,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewDuration",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Duration"}),m.jsx(ot.Control,{type:"text",name:"duration",value:$.duration,onChange:Me,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewUnit",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Unit"}),m.jsxs(ot.Select,{name:"unit",value:$.unit,onChange:Me,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Unit"}),m.jsx("option",{value:"mg",children:"Milligram (mg)"}),m.jsx("option",{value:"g",children:"Gram (g)"}),m.jsx("option",{value:"tab",children:"Tablet (tab)"}),m.jsx("option",{value:"cap",children:"Capsule (cap)"}),m.jsx("option",{value:"ml",children:"Milliliter (mL)"}),m.jsx("option",{value:"drop",children:"Drop (drop)"}),m.jsx("option",{value:"tbsp",children:"Tablespoon (tbsp)"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewWithWater",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"With Water"}),m.jsxs(ot.Select,{name:"with_water",value:$.with_water,onChange:Me,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select"}),m.jsx("option",{value:"Yes",children:"Yes"}),m.jsx("option",{value:"No",children:"No"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewDosageFrequency",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Dosage Frequency"}),m.jsx(ot.Control,{type:"number",name:"dosage_frequency",value:$.dosage_frequency,onChange:Me,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewMealTiming",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Meal Timing"}),m.jsxs(ot.Select,{name:"meal_timing",value:$.meal_timing,onChange:Me,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Before/After Meal"}),m.jsx("option",{value:"before",children:"Before "}),m.jsx("option",{value:"after",children:"After "})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewDayTime",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Day Time"}),m.jsxs(ot.Select,{name:"day_time",value:$.day_time,onChange:Me,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select"}),m.jsx("option",{value:"morning",children:"Morning"}),m.jsx("option",{value:"morning_afternoon",children:"Morning + Afternoon"}),m.jsx("option",{value:"morning_evening",children:"Morning + Evening"}),m.jsx("option",{value:"morning_afternoon_evening",children:"Morning + Afternoon + Evening"}),m.jsx("option",{value:"morning_night",children:"Morning + Night"}),m.jsx("option",{value:"night",children:"Night"}),m.jsx("option",{value:"morning_afternoon_evening_night",children:"Morning + Afternoon + Evening + Night"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewRemarks",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Remarks (Optional)"}),m.jsx(ot.Control,{as:"textarea",rows:3,name:"remarks",value:$.remarks,onChange:Me,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}),m.jsxs(bn.Footer,{className:"bg-gray-100 p-4 border-t-0 rounded-b-lg flex justify-end gap-3",children:[m.jsx(Pi,{variant:"secondary",onClick:Re,className:"px-4 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400",children:"Cancel"}),m.jsx(Pi,{style:{backgroundColor:"#F47820",borderColor:"#F47820"},onClick:he,className:"px-4 py-2 rounded-md text-white hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500",children:"Add Medicine"})]})]}),m.jsx(bn,{show:p,onHide:()=>_(!1),centered:!0,dialogClassName:"custom-modal-dialog",children:m.jsxs("div",{className:"modal-content text-center position-relative shadow",style:{width:"auto",minHeight:"280px",padding:"30px 20px",backgroundColor:"white",overflow:"hidden"},children:[m.jsx("button",{type:"button",onClick:()=>_(!1),className:"position-absolute top-0 end-0 m-3 border-0 bg-transparent","aria-label":"Close",children:m.jsx("img",{src:"./images/cross-blue.png",alt:"Close Icon",style:{width:"24px",height:"24px"}})}),m.jsx("div",{className:"modal-icon mb-3 mt-4",children:m.jsx("img",{src:"/images/logout-icon.svg",alt:"Info Icon",style:{width:"60px",height:"60px",color:"#199FD9"}})}),m.jsxs("div",{className:"modal-header border-0 flex-column align-items-center p-0",children:[" ",m.jsx("h2",{className:"fw-bold mb-2",style:{fontSize:"22px",color:"#333"},children:"Confirm Submission"}),m.jsx("p",{className:"m-0",style:{color:"black",fontSize:"16px"},children:"You cannot add more medicine after submission."}),m.jsx("p",{className:"m-0",style:{color:"black",fontSize:"16px",marginTop:"5px"},children:"Are you sure you want to submit the prescription?"})]}),m.jsxs("div",{className:"modal-body p-0 mt-5 d-flex justify-content-center gap-3",children:[" ",m.jsx(Pi,{variant:"outline-primary",onClick:()=>_(!1),className:"px-4 py-2 rounded-md font-semibold",style:{borderColor:"#199FD9",color:"#199FD9",backgroundColor:"white",minWidth:"120px",fontSize:"16px"},children:"Cancel"}),m.jsx(Pi,{variant:"primary",onClick:qe,className:"orange-btn px-4 py-2 rounded-md font-semibold",style:{backgroundColor:"#FF8C00",borderColor:"#FF8C00",color:"white",minWidth:"120px",fontSize:"16px"},children:"Confirm"})]})]})})]})},Vve=()=>{const a=Wi(),n=ds(),{id:i,patientId:s}=a.state||{},{medicineSearch:l}=Tr(Ne=>Ne.user);console.log(i,"id **********************");const p=F.useRef([]),_=Li(),[T,w]=F.useState({});console.log(T,"choosen item get from **********"),F.useEffect(()=>{(!i||!s)&&n("/doctor-home")},[a]);const{patientProfileData:C}=Tr(Ne=>Ne.patientProfile);F.useEffect(()=>{window.scrollTo(0,0)},[]),F.useEffect(()=>{s&&_(Ov({patientId:s}))},[_,s]);const O=(C==null?void 0:C.basic_information)||{},{loading:k,loading2:U,error:Y,completeAssignedPrescription:W,medicineSearch:ee}=Tr(Ne=>Ne.user),[K,ie]=F.useState(!1),[se,ue]=F.useState(""),[ye,ae]=F.useState(""),[ve,$]=F.useState({}),[Q,te]=F.useState(null),[oe,re]=F.useState([]),[fe,pe]=F.useState([{medicineName:"",dosage:"",frequency:"",duration:"",disease:"",unit:"",withWater:"",beforeAfterMeal:"",dayTime:"",suggestions:[],showSuggestion:!1,isSelectedFromSuggestions:!1}]);return F.useEffect(()=>{ee&&Q!==null&&pe(Ne=>{const Je=[...Ne];return Je[Q].suggestions=ee,Je})},[ee,Q]),F.useEffect(()=>{function Ne(Je){const be=[...fe];let Ie=!1;fe.forEach((Re,Me)=>{const he=p.current[Me];he&&!he.contains(Je.target)&&Re.suggestions.length>0&&(be[Me].suggestions=[],Ie=!0)}),Ie&&pe(be)}return document.addEventListener("mousedown",Ne),()=>{document.removeEventListener("mousedown",Ne)}},[fe]),m.jsx("main",{className:"doctor-panel",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(Ga,{})}),k?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsx("div",{className:"doc-panel-body cap-pg",children:m.jsx("div",{className:"vdoclscrn-patient-details-wrp",children:m.jsx("form",{onSubmit:Ne=>Ne.preventDefault(),children:m.jsx("div",{className:"vdoclscrn-patient-details-wrp-inr",children:m.jsxs("div",{className:"vdoclscrn-patient-details w-100",children:[m.jsxs("div",{className:"vdoclscrnpd-wrp",children:[m.jsx("h2",{children:"Patient Details:"}),m.jsx("div",{className:"vdoclscrnpd",children:[{label:"Patient Name",value:O.name||"N/A"},{label:"Age",value:O.age||"N/A"},{label:"Gender",value:O.gender||"N/A"},{label:"Height",value:O.height||"N/A"},{label:"Weight",value:O.weight||"N/A"},{label:"Contact No.",value:O.phone_no||"N/A"}].map((Ne,Je)=>m.jsxs("div",{className:"vdoclscrnpd-grp",children:[m.jsx("span",{className:"vdoclscrnpd-label",children:Ne.label}),m.jsx("span",{className:"vdoclscrnpd-val",children:Ne.value})]},Je))})]}),m.jsx("div",{className:"vdoclscrnpd-wrp",children:m.jsxs("div",{className:"vdoclscrnpd-wrp",children:[m.jsx("h2",{children:"Prescriptions:"}),m.jsx(Uve,{id:i})]})}),m.jsx(jve,{show:K,handleClose:()=>ie(!1)})]})})})})}),m.jsx(po,{})]})})},Fve=()=>{const a=Li(),{user:n,loading:i}=Tr(se=>se.user);F.useEffect(()=>{a(v_())},[a]);const[s,l]=F.useState(""),[p,_]=F.useState(!1),[T,w]=F.useState(!1),[C,O]=F.useState({fullName:"",email:"",phone:"",experience:"",profilePic:""}),[k,U]=F.useState({date:null,timeRange:[]});F.useEffect(()=>{n&&O(se=>({...se,fullName:n.name||"",email:n.email||"",phone:n.contact_no||"",experience:n.experience||"",profilePic:(Mc==null?void 0:Mc.BaseUrl)+n.profile_path||""}))},[n]);const Y=se=>{const{name:ue,value:ye}=se.target;O(ae=>({...ae,[ue]:ye}))},W=se=>{const ue=se.target.files[0];if(!ue)return;const ye=URL.createObjectURL(ue);l(ye),_(!1)},ee=()=>{l(""),O(se=>({...se,profilePic:"https://admin.awplconnect.com/public/doctorPlaceholder.jpg"})),_(!0)},K=async()=>{var ue;if(p)await a(AN());else if(s&&s!==C.profilePic){const ae=await(await fetch(s)).blob(),ve=new File([ae],"profile.jpg",{type:ae.type}),$=new FormData;$.append("profileImage",ve),await a(CN($))}(ue=(await a(RN({name:C.fullName,contact_no:C.phone,experience:C.experience}))).payload)!=null&&ue.status&&(await a(v_()),w(!1))},ie=()=>{const se=n!=null&&n.profile_path?(Mc==null?void 0:Mc.BaseUrl)+n.profile_path:"/images/my-profile-img.png";O(ue=>({...ue,fullName:n.name||"",email:n.email||"",phone:n.contact_no||"",experience:n.experience||"",profilePic:se})),l(se),_(!1),w(!1)};return i?m.jsxs("div",{className:"loader-main",children:[" ",m.jsx("span",{class:"loader"})," "]}):m.jsxs("main",{className:"doctor-panel my-profile-pg",children:[m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(Ga,{})}),m.jsxs("div",{className:"doc-panel-body",children:[m.jsx("div",{className:"docpnl-sec-head",children:m.jsx("h1",{className:"h2-title",children:"My Profile"})}),m.jsxs("div",{className:"my-profile-details",children:[m.jsxs("div",{className:"my-profile-img-wrp",children:[m.jsx("div",{className:"my-profile-img",children:m.jsx("img",{src:s||C.profilePic,alt:"My Profile"})}),T&&m.jsxs(m.Fragment,{children:[m.jsxs("label",{className:"orange-btn",style:{marginTop:"10px"},children:[m.jsx(ife,{style:{marginRight:"6px"}}),"Upload New Picture",m.jsx("input",{type:"file",onChange:W,style:{display:"none"}})]}),m.jsx("button",{className:"cmn-btn",onClick:ee,style:{marginTop:"10px"},children:"Remove"})]})]}),m.jsx("div",{className:"my-profile-details-inr",children:T?m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"my-profile-details-form",children:[m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Full Name"}),m.jsx("input",{type:"text",name:"fullName",value:C.fullName,onChange:Y,placeholder:"Enter full name"})]}),m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Phone number"}),m.jsx("input",{type:"tel",name:"phone",value:C.phone,onChange:Y,placeholder:"Enter phone number"})]}),m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Experience"}),m.jsx("input",{type:"text",name:"experience",value:C.experience,onChange:Y,placeholder:"Experience"})]})]}),m.jsxs("div",{className:"btn-wrp",style:{display:"flex",gap:"15px"},children:[m.jsx("button",{className:"orange-btn",onClick:K,children:"Save Changes"}),m.jsx("button",{className:"cmn-btn",onClick:ie,children:"Cancel"})]})]}):m.jsxs(m.Fragment,{children:[m.jsx("form",{children:m.jsxs("div",{className:"my-profile-details-form",children:[m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Full Name"}),m.jsx("input",{type:"text",value:C.fullName,readOnly:!0})]}),m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Email ID"}),m.jsx("input",{type:"email",value:C.email,readOnly:!0})]}),m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Phone number"}),m.jsx("input",{type:"tel",value:C.phone,readOnly:!0})]}),m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Experience"}),m.jsx("input",{type:"text",value:C.experience,readOnly:!0})]})]})}),m.jsx("div",{className:"btn-wrp",children:m.jsxs("button",{className:"orange-btn",onClick:()=>{l(C.profilePic),_(!1),w(!0)},children:[m.jsx("img",{src:"./images/pencil-icon.svg",alt:"Edit"})," Edit profile"]})})]})})]})]}),m.jsx(po,{})]}),m.jsx("div",{className:"modal fade popup-wrp small-pop dash-pop",id:"logOut",tabIndex:"-1",role:"dialog","aria-hidden":"true",children:m.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:m.jsxs("div",{className:"modal-content",children:[m.jsx("div",{className:"modal-icon",children:m.jsx("img",{src:"./images/logout-icon.svg",alt:"Icon"})}),m.jsxs("div",{className:"modal-header",children:[m.jsx("h2",{children:"Logout"}),m.jsx("p",{children:"Are you sure you want to logout?"})]}),m.jsxs("div",{className:"modal-footer btn-wrp",children:[m.jsx("button",{type:"button",className:"cmn-btn","data-bs-dismiss":"modal",children:"Cancel"}),m.jsx("a",{href:"login.html",className:"cmn-btn orange-btn",children:"Logout"})]})]})})})]})},Bve=()=>{const{pastPatients:a,loading:n,error:i,patient_id:s}=Tr(Me=>Me.userdata),l=Li(),p=4,[_,T]=F.useState([]),[w,C]=F.useState({name:"",age:"",dscode:"",disease:""}),[O,k]=F.useState(!1),[U,Y]=F.useState(1),[W,ee]=F.useState([]),[K,ie]=F.useState([]),[se,ue]=F.useState(!1),[ye,ae]=F.useState(!1);F.useEffect(()=>{l(Iv())},[l]),F.useEffect(()=>{T(a),ie(a);const Me=[...new Set(a.map(he=>he.latestDisease).filter(he=>he&&he.trim()!==""&&he.trim()!=="-"))];ee(Me)},[a]);const ve=Me=>{const{name:he,value:De}=Me.target;if(he==="name"){const qe=De.replace(/[^A-Za-z\s]/g,"");C(We=>({...We,[he]:qe}))}else he==="age"?(De===""||/^[0-9\b]+$/.test(De))&&C(qe=>({...qe,[he]:De})):C(he==="dscode"?qe=>({...qe,[he]:De}):qe=>({...qe,[he]:De}))},$=Math.ceil(_.length/p),Q=Me=>{Me>=1&&Me<=$&&Y(Me)},te=()=>{U>1&&Y(U-1)},oe=()=>{U<$&&Y(U+1)},re=()=>{const Me=new FormData;w.name&&Me.append("patient_name",w.name),w.age&&Me.append("age",w.age),w.dscode&&Me.append("ds_code",w.dscode),w.disease&&Me.append("disease",w.disease),l(Iv(Me)),k(!1)},fe=Me=>{Me.preventDefault(),C({name:"",age:"",dscode:"",disease:""});const he=new FormData;l(Iv(he)),k(!1)},pe=()=>{k(Me=>!Me)},Je=(()=>{const Me=[],he=new Set;return a&&a.forEach(De=>{De.patient_name&&!he.has(De.patient_name.toLowerCase())&&(he.add(De.patient_name.toLowerCase()),Me.push({name:De.patient_name,dsCode:De.ds_code||""}))}),Me})(),be=w.name?Je.filter(Me=>Me.name.toLowerCase().includes(w.name.toLowerCase())):Je,Ie=Me=>{C(he=>({...he,name:Me.name})),ue(!1)},Re=({patient:Me})=>{var he,De;return m.jsx("div",{className:"col-lg-6 col-md-6",children:m.jsxs("div",{className:"past-patient-detail-card",children:[m.jsx("div",{className:"past-patient-cd-img",children:Me.referred_by_patient_name?m.jsx("img",{src:"./images/referredProfile.png",alt:"referred patient",style:{border:"1px solid #199FD9"}}):m.jsx("img",{src:`${mi}/${Me.patient_profile}`,alt:"Client"})}),m.jsxs("div",{className:"p-patient-card-content",children:[m.jsxs("div",{className:"p-patient-cd-head",children:[m.jsx("h3",{children:Me==null?void 0:Me.patient_name}),Me.referred_by_patient_name?m.jsxs("p",{children:[m.jsx("span",{style:{color:"black"},children:"Referred by "}),m.jsx("span",{style:{color:"#199FD9"},children:Me.referred_by_patient_name})]}):m.jsxs("p",{children:[m.jsx("span",{style:{color:"black"},children:"DS Code: "}),m.jsx("span",{style:{color:"#199FD9"},children:Me.ds_code})]})]}),m.jsxs("div",{className:"p-patient-cd-body",children:[m.jsxs("div",{className:"p-patient-dtl-wrp",children:[m.jsxs("strong",{className:"p-patient-dtl",children:["Age: ",Me.age]}),m.jsxs("strong",{className:"p-patient-dtl",children:["Gender:"," ",((he=Me.gender)==null?void 0:he.charAt(0).toUpperCase())+((De=Me.gender)==null?void 0:De.slice(1).toLowerCase())]})]}),m.jsx("div",{className:"p-patient-disease",children:m.jsxs("b",{children:["Latest Disease: ",Me.latestDisease]})}),m.jsx(dn,{to:"/patient-profile",state:{patientId:Me.patient_id},className:"orange-btn",children:"View full details"})]})]})]})})};return m.jsx("main",{className:"doctor-panel",style:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:m.jsxs("div",{className:"container-fluid",style:{flex:1},children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(Ga,{})}),n?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"doc-panel-body pp-list-pg",children:[m.jsxs("div",{className:"docpnl-sec-head text-center",children:[m.jsx("h1",{className:"h2-title",children:"My Past Patients"}),m.jsx("div",{className:"back-btn",children:m.jsx(dn,{to:"#",onClick:Me=>{Me.preventDefault(),window.history.back()},children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})}),m.jsxs("div",{className:"past-patient-filter-wrp past-patient-pg",children:[m.jsxs("button",{type:"button",onClick:pe,children:["Filter ",m.jsx("img",{src:"./images/filter-icon.svg",alt:"Filter"})]}),m.jsx("div",{className:`filter-options-drpdn ${O?"active":""}`,children:m.jsxs("form",{children:[m.jsxs("div",{className:"filter-form",children:[m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"Patient Name"}),m.jsxs("div",{className:"suggestion-container",style:{position:"relative"},children:[m.jsx("input",{type:"text",name:"name",value:w.name,onChange:ve,placeholder:"Patient Name",pattern:"[A-Za-z\\s]+",title:"Only letters and spaces allowed",autoComplete:"off",onFocus:()=>{ae(!0),w.name&&ue(!0)},onBlur:()=>{setTimeout(()=>{ae(!1),ue(!1)},200)}}),(se||ye)&&be.length>0&&m.jsx("ul",{className:"suggestions-dropdown",style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"#fff",border:"1px solid #ddd",borderRadius:"4px",maxHeight:"200px",overflowY:"auto",zIndex:1e3,marginTop:"5px",padding:0,listStyle:"none"},children:be.map((Me,he)=>m.jsxs("li",{onClick:()=>Ie(Me),style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid #eee",display:"flex",flexDirection:"column",textAlign:"left"},children:[m.jsx("div",{children:Me.name}),Me.dsCode&&m.jsxs("div",{style:{color:"#199fd9",fontSize:"0.8em"},children:["(DS Code: ",Me.dsCode,")"]})]},he))})]})]}),m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"Age"}),m.jsx("input",{id:"age",type:"text",name:"age",value:w.age,onChange:ve,placeholder:"Age",pattern:"[0-9]*",inputMode:"numeric"})]}),m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"DS Code"}),m.jsx("input",{id:"dscode",type:"text",name:"dscode",value:w.dscode,onChange:ve,placeholder:"DS Code"})]}),m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"Disease"}),m.jsxs("select",{name:"disease",value:w.disease,onChange:ve,children:[m.jsx("option",{value:"",disabled:!0,children:"Disease"}),W.map((Me,he)=>m.jsx("option",{value:Me,children:Me},he))]})]})]}),m.jsxs("div",{className:"filter-form-btn-wrp",children:[m.jsx("button",{type:"button",className:"orange-btn",onClick:fe,style:{borderRadius:0},children:"Clear Filter"}),m.jsx("button",{type:"button",className:"orange-btn",onClick:re,style:{borderRadius:0},children:"Apply Filter"})]})]})})]})]}),m.jsx("div",{className:"past-patients-list-wrp",children:m.jsx("div",{className:"row",children:_.length==0?m.jsx("h3",{style:{textAlign:"center",padding:"25px 0",fontWeight:"bold",color:"#356598",fontSize:18},children:"No data found"}):_.slice((U-1)*p,U*p).map(Me=>m.jsx(Re,{patient:Me},Me.id))})}),_.length>0&&m.jsx(xu,{currentPage:U,totalPages:$,onPageChange:Q,onPrevious:te,onNext:oe})]}),m.jsx(po,{})]})})},R2=({onSearch:a,placeholder:n="Search anything here...",value:i=""})=>{const[s,l]=F.useState(i),p=_=>{const T=_.target.value;l(T),a(T)};return m.jsx("div",{className:"formfield",children:m.jsx("input",{placeholder:n,type:"text",value:s,onChange:p})})},LX=6048e5,Hve=864e5,xD=6e4,PD=36e5,Gve=1e3,Kz=Symbol.for("constructDateFrom");function _i(a,n){return typeof a=="function"?a(n):a&&typeof a=="object"&&Kz in a?a[Kz](n):a instanceof Date?new a.constructor(n):new Date(n)}function an(a,n){return _i(n||a,a)}function Sd(a,n,i){const s=an(a,i==null?void 0:i.in);return isNaN(n)?_i((i==null?void 0:i.in)||a,NaN):(n&&s.setDate(s.getDate()+n),s)}function wd(a,n,i){const s=an(a,i==null?void 0:i.in);if(isNaN(n))return _i(a,NaN);if(!n)return s;const l=s.getDate(),p=_i(a,s.getTime());p.setMonth(s.getMonth()+n+1,0);const _=p.getDate();return l>=_?p:(s.setFullYear(p.getFullYear(),p.getMonth(),l),s)}function MX(a,n,i){return _i(a,+an(a)+n)}function Wve(a,n,i){return MX(a,n*PD)}let zve={};function F_(){return zve}function fp(a,n){var T,w,C,O;const i=F_(),s=(n==null?void 0:n.weekStartsOn)??((w=(T=n==null?void 0:n.locale)==null?void 0:T.options)==null?void 0:w.weekStartsOn)??i.weekStartsOn??((O=(C=i.locale)==null?void 0:C.options)==null?void 0:O.weekStartsOn)??0,l=an(a,n==null?void 0:n.in),p=l.getDay(),_=(p<s?7:0)+p-s;return l.setDate(l.getDate()-_),l.setHours(0,0,0,0),l}function Wv(a,n){return fp(a,{...n,weekStartsOn:1})}function jX(a,n){const i=an(a,n==null?void 0:n.in),s=i.getFullYear(),l=_i(i,0);l.setFullYear(s+1,0,4),l.setHours(0,0,0,0);const p=Wv(l),_=_i(i,0);_.setFullYear(s,0,4),_.setHours(0,0,0,0);const T=Wv(_);return i.getTime()>=p.getTime()?s+1:i.getTime()>=T.getTime()?s:s-1}function MO(a){const n=an(a),i=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return i.setUTCFullYear(n.getFullYear()),+a-+i}function gp(a,...n){const i=_i.bind(null,n.find(s=>typeof s=="object"));return n.map(i)}function P_(a,n){const i=an(a,n==null?void 0:n.in);return i.setHours(0,0,0,0),i}function zv(a,n,i){const[s,l]=gp(i==null?void 0:i.in,a,n),p=P_(s),_=P_(l),T=+p-MO(p),w=+_-MO(_);return Math.round((T-w)/Hve)}function Yve(a,n){const i=jX(a,n),s=_i(a,0);return s.setFullYear(i,0,4),s.setHours(0,0,0,0),Wv(s)}function C2(a,n,i){const s=an(a,i==null?void 0:i.in);return s.setTime(s.getTime()+n*xD),s}function qj(a,n,i){return wd(a,n*3,i)}function qve(a,n,i){return MX(a,n*1e3)}function jO(a,n,i){return Sd(a,n*7,i)}function np(a,n,i){return wd(a,n*12,i)}function Xz(a,n){let i,s=n==null?void 0:n.in;return a.forEach(l=>{!s&&typeof l=="object"&&(s=_i.bind(null,l));const p=an(l,s);(!i||i<p||isNaN(+p))&&(i=p)}),_i(s,i||NaN)}function Qz(a,n){let i,s=n==null?void 0:n.in;return a.forEach(l=>{!s&&typeof l=="object"&&(s=_i.bind(null,l));const p=an(l,s);(!i||i>p||isNaN(+p))&&(i=p)}),_i(s,i||NaN)}function Kve(a,n,i){const[s,l]=gp(i==null?void 0:i.in,a,n);return+P_(s)==+P_(l)}function rp(a){return a instanceof Date||typeof a=="object"&&Object.prototype.toString.call(a)==="[object Date]"}function UO(a){return!(!rp(a)&&typeof a!="number"||isNaN(+an(a)))}function VO(a,n,i){const[s,l]=gp(i==null?void 0:i.in,a,n),p=s.getFullYear()-l.getFullYear(),_=s.getMonth()-l.getMonth();return p*12+_}function b_(a,n){const i=an(a,n==null?void 0:n.in);return Math.trunc(i.getMonth()/3)+1}function FO(a,n,i){const[s,l]=gp(i==null?void 0:i.in,a,n),p=s.getFullYear()-l.getFullYear(),_=b_(s)-b_(l);return p*4+_}function BO(a,n,i){const[s,l]=gp(i==null?void 0:i.in,a,n);return s.getFullYear()-l.getFullYear()}function Xve(a,n,i){const[s,l]=gp(i==null?void 0:i.in,a,n),p=$z(s,l),_=Math.abs(zv(s,l));s.setDate(s.getDate()-p*_);const T=+($z(s,l)===-p),w=p*(_-T);return w===0?0:w}function $z(a,n){const i=a.getFullYear()-n.getFullYear()||a.getMonth()-n.getMonth()||a.getDate()-n.getDate()||a.getHours()-n.getHours()||a.getMinutes()-n.getMinutes()||a.getSeconds()-n.getSeconds()||a.getMilliseconds()-n.getMilliseconds();return i<0?-1:i>0?1:i}function UX(a,n){const i=an(a,n==null?void 0:n.in);return i.setHours(23,59,59,999),i}function VX(a,n){const i=an(a,n==null?void 0:n.in),s=i.getMonth();return i.setFullYear(i.getFullYear(),s+1,0),i.setHours(23,59,59,999),i}function A2(a,n){const i=an(a,n==null?void 0:n.in),s=i.getMonth(),l=s-s%3;return i.setMonth(l,1),i.setHours(0,0,0,0),i}function FX(a,n){const i=an(a,n==null?void 0:n.in);return i.setDate(1),i.setHours(0,0,0,0),i}function BX(a,n){const i=an(a,n==null?void 0:n.in),s=i.getFullYear();return i.setFullYear(s+1,0,0),i.setHours(23,59,59,999),i}function kD(a,n){const i=an(a,n==null?void 0:n.in);return i.setFullYear(i.getFullYear(),0,1),i.setHours(0,0,0,0),i}function Qve(a,n){var T,w;const i=F_(),s=i.weekStartsOn??((w=(T=i.locale)==null?void 0:T.options)==null?void 0:w.weekStartsOn)??0,l=an(a,n==null?void 0:n.in),p=l.getDay(),_=(p<s?-7:0)+6-(p-s);return l.setDate(l.getDate()+_),l.setHours(23,59,59,999),l}const $ve={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Jve=(a,n,i)=>{let s;const l=$ve[a];return typeof l=="string"?s=l:n===1?s=l.one:s=l.other.replace("{{count}}",n.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+s:s+" ago":s};function fM(a){return(n={})=>{const i=n.width?String(n.width):a.defaultWidth;return a.formats[i]||a.formats[a.defaultWidth]}}const Zve={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},eSe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},tSe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},nSe={date:fM({formats:Zve,defaultWidth:"full"}),time:fM({formats:eSe,defaultWidth:"full"}),dateTime:fM({formats:tSe,defaultWidth:"full"})},rSe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},iSe=(a,n,i,s)=>rSe[a];function ww(a){return(n,i)=>{const s=i!=null&&i.context?String(i.context):"standalone";let l;if(s==="formatting"&&a.formattingValues){const _=a.defaultFormattingWidth||a.defaultWidth,T=i!=null&&i.width?String(i.width):_;l=a.formattingValues[T]||a.formattingValues[_]}else{const _=a.defaultWidth,T=i!=null&&i.width?String(i.width):a.defaultWidth;l=a.values[T]||a.values[_]}const p=a.argumentCallback?a.argumentCallback(n):n;return l[p]}}const sSe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},aSe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},oSe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},cSe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},lSe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},dSe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},uSe=(a,n)=>{const i=Number(a),s=i%100;if(s>20||s<10)switch(s%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},hSe={ordinalNumber:uSe,era:ww({values:sSe,defaultWidth:"wide"}),quarter:ww({values:aSe,defaultWidth:"wide",argumentCallback:a=>a-1}),month:ww({values:oSe,defaultWidth:"wide"}),day:ww({values:cSe,defaultWidth:"wide"}),dayPeriod:ww({values:lSe,defaultWidth:"wide",formattingValues:dSe,defaultFormattingWidth:"wide"})};function Rw(a){return(n,i={})=>{const s=i.width,l=s&&a.matchPatterns[s]||a.matchPatterns[a.defaultMatchWidth],p=n.match(l);if(!p)return null;const _=p[0],T=s&&a.parsePatterns[s]||a.parsePatterns[a.defaultParseWidth],w=Array.isArray(T)?fSe(T,k=>k.test(_)):pSe(T,k=>k.test(_));let C;C=a.valueCallback?a.valueCallback(w):w,C=i.valueCallback?i.valueCallback(C):C;const O=n.slice(_.length);return{value:C,rest:O}}}function pSe(a,n){for(const i in a)if(Object.prototype.hasOwnProperty.call(a,i)&&n(a[i]))return i}function fSe(a,n){for(let i=0;i<a.length;i++)if(n(a[i]))return i}function mSe(a){return(n,i={})=>{const s=n.match(a.matchPattern);if(!s)return null;const l=s[0],p=n.match(a.parsePattern);if(!p)return null;let _=a.valueCallback?a.valueCallback(p[0]):p[0];_=i.valueCallback?i.valueCallback(_):_;const T=n.slice(l.length);return{value:_,rest:T}}}const gSe=/^(\d+)(th|st|nd|rd)?/i,_Se=/\d+/i,ESe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},ySe={any:[/^b/i,/^(a|c)/i]},vSe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},SSe={any:[/1/i,/2/i,/3/i,/4/i]},TSe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},bSe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},wSe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},RSe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},CSe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},ASe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},ISe={ordinalNumber:mSe({matchPattern:gSe,parsePattern:_Se,valueCallback:a=>parseInt(a,10)}),era:Rw({matchPatterns:ESe,defaultMatchWidth:"wide",parsePatterns:ySe,defaultParseWidth:"any"}),quarter:Rw({matchPatterns:vSe,defaultMatchWidth:"wide",parsePatterns:SSe,defaultParseWidth:"any",valueCallback:a=>a+1}),month:Rw({matchPatterns:TSe,defaultMatchWidth:"wide",parsePatterns:bSe,defaultParseWidth:"any"}),day:Rw({matchPatterns:wSe,defaultMatchWidth:"wide",parsePatterns:RSe,defaultParseWidth:"any"}),dayPeriod:Rw({matchPatterns:CSe,defaultMatchWidth:"any",parsePatterns:ASe,defaultParseWidth:"any"})},HX={code:"en-US",formatDistance:Jve,formatLong:nSe,formatRelative:iSe,localize:hSe,match:ISe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function NSe(a,n){const i=an(a,n==null?void 0:n.in);return zv(i,kD(i))+1}function Kj(a,n){const i=an(a,n==null?void 0:n.in),s=+Wv(i)-+Yve(i);return Math.round(s/LX)+1}function Xj(a,n){var O,k,U,Y;const i=an(a,n==null?void 0:n.in),s=i.getFullYear(),l=F_(),p=(n==null?void 0:n.firstWeekContainsDate)??((k=(O=n==null?void 0:n.locale)==null?void 0:O.options)==null?void 0:k.firstWeekContainsDate)??l.firstWeekContainsDate??((Y=(U=l.locale)==null?void 0:U.options)==null?void 0:Y.firstWeekContainsDate)??1,_=_i((n==null?void 0:n.in)||a,0);_.setFullYear(s+1,0,p),_.setHours(0,0,0,0);const T=fp(_,n),w=_i((n==null?void 0:n.in)||a,0);w.setFullYear(s,0,p),w.setHours(0,0,0,0);const C=fp(w,n);return+i>=+T?s+1:+i>=+C?s:s-1}function OSe(a,n){var T,w,C,O;const i=F_(),s=(n==null?void 0:n.firstWeekContainsDate)??((w=(T=n==null?void 0:n.locale)==null?void 0:T.options)==null?void 0:w.firstWeekContainsDate)??i.firstWeekContainsDate??((O=(C=i.locale)==null?void 0:C.options)==null?void 0:O.firstWeekContainsDate)??1,l=Xj(a,n),p=_i((n==null?void 0:n.in)||a,0);return p.setFullYear(l,0,s),p.setHours(0,0,0,0),fp(p,n)}function GX(a,n){const i=an(a,n==null?void 0:n.in),s=+fp(i,n)-+OSe(i,n);return Math.round(s/LX)+1}function fi(a,n){const i=a<0?"-":"",s=Math.abs(a).toString().padStart(n,"0");return i+s}const jf={y(a,n){const i=a.getFullYear(),s=i>0?i:1-i;return fi(n==="yy"?s%100:s,n.length)},M(a,n){const i=a.getMonth();return n==="M"?String(i+1):fi(i+1,2)},d(a,n){return fi(a.getDate(),n.length)},a(a,n){const i=a.getHours()/12>=1?"pm":"am";switch(n){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(a,n){return fi(a.getHours()%12||12,n.length)},H(a,n){return fi(a.getHours(),n.length)},m(a,n){return fi(a.getMinutes(),n.length)},s(a,n){return fi(a.getSeconds(),n.length)},S(a,n){const i=n.length,s=a.getMilliseconds(),l=Math.trunc(s*Math.pow(10,i-3));return fi(l,n.length)}},vv={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Jz={G:function(a,n,i){const s=a.getFullYear()>0?1:0;switch(n){case"G":case"GG":case"GGG":return i.era(s,{width:"abbreviated"});case"GGGGG":return i.era(s,{width:"narrow"});case"GGGG":default:return i.era(s,{width:"wide"})}},y:function(a,n,i){if(n==="yo"){const s=a.getFullYear(),l=s>0?s:1-s;return i.ordinalNumber(l,{unit:"year"})}return jf.y(a,n)},Y:function(a,n,i,s){const l=Xj(a,s),p=l>0?l:1-l;if(n==="YY"){const _=p%100;return fi(_,2)}return n==="Yo"?i.ordinalNumber(p,{unit:"year"}):fi(p,n.length)},R:function(a,n){const i=jX(a);return fi(i,n.length)},u:function(a,n){const i=a.getFullYear();return fi(i,n.length)},Q:function(a,n,i){const s=Math.ceil((a.getMonth()+1)/3);switch(n){case"Q":return String(s);case"QQ":return fi(s,2);case"Qo":return i.ordinalNumber(s,{unit:"quarter"});case"QQQ":return i.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(s,{width:"wide",context:"formatting"})}},q:function(a,n,i){const s=Math.ceil((a.getMonth()+1)/3);switch(n){case"q":return String(s);case"qq":return fi(s,2);case"qo":return i.ordinalNumber(s,{unit:"quarter"});case"qqq":return i.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(s,{width:"wide",context:"standalone"})}},M:function(a,n,i){const s=a.getMonth();switch(n){case"M":case"MM":return jf.M(a,n);case"Mo":return i.ordinalNumber(s+1,{unit:"month"});case"MMM":return i.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(s,{width:"wide",context:"formatting"})}},L:function(a,n,i){const s=a.getMonth();switch(n){case"L":return String(s+1);case"LL":return fi(s+1,2);case"Lo":return i.ordinalNumber(s+1,{unit:"month"});case"LLL":return i.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(s,{width:"wide",context:"standalone"})}},w:function(a,n,i,s){const l=GX(a,s);return n==="wo"?i.ordinalNumber(l,{unit:"week"}):fi(l,n.length)},I:function(a,n,i){const s=Kj(a);return n==="Io"?i.ordinalNumber(s,{unit:"week"}):fi(s,n.length)},d:function(a,n,i){return n==="do"?i.ordinalNumber(a.getDate(),{unit:"date"}):jf.d(a,n)},D:function(a,n,i){const s=NSe(a);return n==="Do"?i.ordinalNumber(s,{unit:"dayOfYear"}):fi(s,n.length)},E:function(a,n,i){const s=a.getDay();switch(n){case"E":case"EE":case"EEE":return i.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(s,{width:"short",context:"formatting"});case"EEEE":default:return i.day(s,{width:"wide",context:"formatting"})}},e:function(a,n,i,s){const l=a.getDay(),p=(l-s.weekStartsOn+8)%7||7;switch(n){case"e":return String(p);case"ee":return fi(p,2);case"eo":return i.ordinalNumber(p,{unit:"day"});case"eee":return i.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(l,{width:"short",context:"formatting"});case"eeee":default:return i.day(l,{width:"wide",context:"formatting"})}},c:function(a,n,i,s){const l=a.getDay(),p=(l-s.weekStartsOn+8)%7||7;switch(n){case"c":return String(p);case"cc":return fi(p,n.length);case"co":return i.ordinalNumber(p,{unit:"day"});case"ccc":return i.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(l,{width:"narrow",context:"standalone"});case"cccccc":return i.day(l,{width:"short",context:"standalone"});case"cccc":default:return i.day(l,{width:"wide",context:"standalone"})}},i:function(a,n,i){const s=a.getDay(),l=s===0?7:s;switch(n){case"i":return String(l);case"ii":return fi(l,n.length);case"io":return i.ordinalNumber(l,{unit:"day"});case"iii":return i.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(s,{width:"short",context:"formatting"});case"iiii":default:return i.day(s,{width:"wide",context:"formatting"})}},a:function(a,n,i){const l=a.getHours()/12>=1?"pm":"am";switch(n){case"a":case"aa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(a,n,i){const s=a.getHours();let l;switch(s===12?l=vv.noon:s===0?l=vv.midnight:l=s/12>=1?"pm":"am",n){case"b":case"bb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(a,n,i){const s=a.getHours();let l;switch(s>=17?l=vv.evening:s>=12?l=vv.afternoon:s>=4?l=vv.morning:l=vv.night,n){case"B":case"BB":case"BBB":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(a,n,i){if(n==="ho"){let s=a.getHours()%12;return s===0&&(s=12),i.ordinalNumber(s,{unit:"hour"})}return jf.h(a,n)},H:function(a,n,i){return n==="Ho"?i.ordinalNumber(a.getHours(),{unit:"hour"}):jf.H(a,n)},K:function(a,n,i){const s=a.getHours()%12;return n==="Ko"?i.ordinalNumber(s,{unit:"hour"}):fi(s,n.length)},k:function(a,n,i){let s=a.getHours();return s===0&&(s=24),n==="ko"?i.ordinalNumber(s,{unit:"hour"}):fi(s,n.length)},m:function(a,n,i){return n==="mo"?i.ordinalNumber(a.getMinutes(),{unit:"minute"}):jf.m(a,n)},s:function(a,n,i){return n==="so"?i.ordinalNumber(a.getSeconds(),{unit:"second"}):jf.s(a,n)},S:function(a,n){return jf.S(a,n)},X:function(a,n,i){const s=a.getTimezoneOffset();if(s===0)return"Z";switch(n){case"X":return eY(s);case"XXXX":case"XX":return o_(s);case"XXXXX":case"XXX":default:return o_(s,":")}},x:function(a,n,i){const s=a.getTimezoneOffset();switch(n){case"x":return eY(s);case"xxxx":case"xx":return o_(s);case"xxxxx":case"xxx":default:return o_(s,":")}},O:function(a,n,i){const s=a.getTimezoneOffset();switch(n){case"O":case"OO":case"OOO":return"GMT"+Zz(s,":");case"OOOO":default:return"GMT"+o_(s,":")}},z:function(a,n,i){const s=a.getTimezoneOffset();switch(n){case"z":case"zz":case"zzz":return"GMT"+Zz(s,":");case"zzzz":default:return"GMT"+o_(s,":")}},t:function(a,n,i){const s=Math.trunc(+a/1e3);return fi(s,n.length)},T:function(a,n,i){return fi(+a,n.length)}};function Zz(a,n=""){const i=a>0?"-":"+",s=Math.abs(a),l=Math.trunc(s/60),p=s%60;return p===0?i+String(l):i+String(l)+n+fi(p,2)}function eY(a,n){return a%60===0?(a>0?"-":"+")+fi(Math.abs(a)/60,2):o_(a,n)}function o_(a,n=""){const i=a>0?"-":"+",s=Math.abs(a),l=fi(Math.trunc(s/60),2),p=fi(s%60,2);return i+l+n+p}const tY=(a,n)=>{switch(a){case"P":return n.date({width:"short"});case"PP":return n.date({width:"medium"});case"PPP":return n.date({width:"long"});case"PPPP":default:return n.date({width:"full"})}},WX=(a,n)=>{switch(a){case"p":return n.time({width:"short"});case"pp":return n.time({width:"medium"});case"ppp":return n.time({width:"long"});case"pppp":default:return n.time({width:"full"})}},DSe=(a,n)=>{const i=a.match(/(P+)(p+)?/)||[],s=i[1],l=i[2];if(!l)return tY(a,n);let p;switch(s){case"P":p=n.dateTime({width:"short"});break;case"PP":p=n.dateTime({width:"medium"});break;case"PPP":p=n.dateTime({width:"long"});break;case"PPPP":default:p=n.dateTime({width:"full"});break}return p.replace("{{date}}",tY(s,n)).replace("{{time}}",WX(l,n))},I2={p:WX,P:DSe},xSe=/^D+$/,PSe=/^Y+$/,kSe=["D","DD","YY","YYYY"];function LSe(a){return xSe.test(a)}function MSe(a){return PSe.test(a)}function jSe(a,n,i){const s=USe(a,n,i);if(console.warn(s),kSe.includes(a))throw new RangeError(s)}function USe(a,n,i){const s=a[0]==="Y"?"years":"days of the month";return`Use \`${a.toLowerCase()}\` instead of \`${a}\` (in \`${n}\`) for formatting ${s} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const VSe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,FSe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,BSe=/^'([^]*?)'?$/,HSe=/''/g,GSe=/[a-zA-Z]/;function nY(a,n,i){var O,k,U,Y,W,ee,K,ie;const s=F_(),l=(i==null?void 0:i.locale)??s.locale??HX,p=(i==null?void 0:i.firstWeekContainsDate)??((k=(O=i==null?void 0:i.locale)==null?void 0:O.options)==null?void 0:k.firstWeekContainsDate)??s.firstWeekContainsDate??((Y=(U=s.locale)==null?void 0:U.options)==null?void 0:Y.firstWeekContainsDate)??1,_=(i==null?void 0:i.weekStartsOn)??((ee=(W=i==null?void 0:i.locale)==null?void 0:W.options)==null?void 0:ee.weekStartsOn)??s.weekStartsOn??((ie=(K=s.locale)==null?void 0:K.options)==null?void 0:ie.weekStartsOn)??0,T=an(a,i==null?void 0:i.in);if(!UO(T))throw new RangeError("Invalid time value");let w=n.match(FSe).map(se=>{const ue=se[0];if(ue==="p"||ue==="P"){const ye=I2[ue];return ye(se,l.formatLong)}return se}).join("").match(VSe).map(se=>{if(se==="''")return{isToken:!1,value:"'"};const ue=se[0];if(ue==="'")return{isToken:!1,value:WSe(se)};if(Jz[ue])return{isToken:!0,value:se};if(ue.match(GSe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ue+"`");return{isToken:!1,value:se}});l.localize.preprocessor&&(w=l.localize.preprocessor(T,w));const C={firstWeekContainsDate:p,weekStartsOn:_,locale:l};return w.map(se=>{if(!se.isToken)return se.value;const ue=se.value;(!(i!=null&&i.useAdditionalWeekYearTokens)&&MSe(ue)||!(i!=null&&i.useAdditionalDayOfYearTokens)&&LSe(ue))&&jSe(ue,n,String(a));const ye=Jz[ue[0]];return ye(T,ue,l.localize,C)}).join("")}function WSe(a){const n=a.match(BSe);return n?n[1].replace(HSe,"'"):a}function rY(a,n){return an(a,n==null?void 0:n.in).getDate()}function zSe(a,n){return an(a,n==null?void 0:n.in).getDay()}function YSe(a,n){const i=an(a,n==null?void 0:n.in),s=i.getFullYear(),l=i.getMonth(),p=_i(i,0);return p.setFullYear(s,l+1,0),p.setHours(0,0,0,0),p.getDate()}function qSe(){return Object.assign({},F_())}function ip(a,n){return an(a,n==null?void 0:n.in).getHours()}function KSe(a,n){const i=an(a,n==null?void 0:n.in).getDay();return i===0?7:i}function sp(a,n){return an(a,n==null?void 0:n.in).getMinutes()}function ho(a,n){return an(a,n==null?void 0:n.in).getMonth()}function Kf(a){return an(a).getSeconds()}function N2(a){return+an(a)}function fr(a,n){return an(a,n==null?void 0:n.in).getFullYear()}function rm(a,n){return+an(a)>+an(n)}function k_(a,n){return+an(a)<+an(n)}function XSe(a,n){return+an(a)==+an(n)}function QSe(a,n){const i=$Se(n)?new n(0):_i(n,0);return i.setFullYear(a.getFullYear(),a.getMonth(),a.getDate()),i.setHours(a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()),i}function $Se(a){var n;return typeof a=="function"&&((n=a.prototype)==null?void 0:n.constructor)===a}const JSe=10;class zX{constructor(){zt(this,"subPriority",0)}validate(n,i){return!0}}class ZSe extends zX{constructor(n,i,s,l,p){super(),this.value=n,this.validateValue=i,this.setValue=s,this.priority=l,p&&(this.subPriority=p)}validate(n,i){return this.validateValue(n,this.value,i)}set(n,i,s){return this.setValue(n,i,this.value,s)}}class eTe extends zX{constructor(i,s){super();zt(this,"priority",JSe);zt(this,"subPriority",-1);this.context=i||(l=>_i(s,l))}set(i,s){return s.timestampIsSet?i:_i(i,QSe(i,this.context))}}class Jr{run(n,i,s,l){const p=this.parse(n,i,s,l);return p?{setter:new ZSe(p.value,this.validate,this.set,this.priority,this.subPriority),rest:p.rest}:null}validate(n,i,s){return!0}}class tTe extends Jr{constructor(){super(...arguments);zt(this,"priority",140);zt(this,"incompatibleTokens",["R","u","t","T"])}parse(i,s,l){switch(s){case"G":case"GG":case"GGG":return l.era(i,{width:"abbreviated"})||l.era(i,{width:"narrow"});case"GGGGG":return l.era(i,{width:"narrow"});case"GGGG":default:return l.era(i,{width:"wide"})||l.era(i,{width:"abbreviated"})||l.era(i,{width:"narrow"})}}set(i,s,l){return s.era=l,i.setFullYear(l,0,1),i.setHours(0,0,0,0),i}}const Us={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},Pu={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function Vs(a,n){return a&&{value:n(a.value),rest:a.rest}}function cs(a,n){const i=n.match(a);return i?{value:parseInt(i[0],10),rest:n.slice(i[0].length)}:null}function ku(a,n){const i=n.match(a);if(!i)return null;if(i[0]==="Z")return{value:0,rest:n.slice(1)};const s=i[1]==="+"?1:-1,l=i[2]?parseInt(i[2],10):0,p=i[3]?parseInt(i[3],10):0,_=i[5]?parseInt(i[5],10):0;return{value:s*(l*PD+p*xD+_*Gve),rest:n.slice(i[0].length)}}function YX(a){return cs(Us.anyDigitsSigned,a)}function Ss(a,n){switch(a){case 1:return cs(Us.singleDigit,n);case 2:return cs(Us.twoDigits,n);case 3:return cs(Us.threeDigits,n);case 4:return cs(Us.fourDigits,n);default:return cs(new RegExp("^\\d{1,"+a+"}"),n)}}function HO(a,n){switch(a){case 1:return cs(Us.singleDigitSigned,n);case 2:return cs(Us.twoDigitsSigned,n);case 3:return cs(Us.threeDigitsSigned,n);case 4:return cs(Us.fourDigitsSigned,n);default:return cs(new RegExp("^-?\\d{1,"+a+"}"),n)}}function Qj(a){switch(a){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function qX(a,n){const i=n>0,s=i?n:1-n;let l;if(s<=50)l=a||100;else{const p=s+50,_=Math.trunc(p/100)*100,T=a>=p%100;l=a+_-(T?100:0)}return i?l:1-l}function KX(a){return a%400===0||a%4===0&&a%100!==0}class nTe extends Jr{constructor(){super(...arguments);zt(this,"priority",130);zt(this,"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"])}parse(i,s,l){const p=_=>({year:_,isTwoDigitYear:s==="yy"});switch(s){case"y":return Vs(Ss(4,i),p);case"yo":return Vs(l.ordinalNumber(i,{unit:"year"}),p);default:return Vs(Ss(s.length,i),p)}}validate(i,s){return s.isTwoDigitYear||s.year>0}set(i,s,l){const p=i.getFullYear();if(l.isTwoDigitYear){const T=qX(l.year,p);return i.setFullYear(T,0,1),i.setHours(0,0,0,0),i}const _=!("era"in s)||s.era===1?l.year:1-l.year;return i.setFullYear(_,0,1),i.setHours(0,0,0,0),i}}class rTe extends Jr{constructor(){super(...arguments);zt(this,"priority",130);zt(this,"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"])}parse(i,s,l){const p=_=>({year:_,isTwoDigitYear:s==="YY"});switch(s){case"Y":return Vs(Ss(4,i),p);case"Yo":return Vs(l.ordinalNumber(i,{unit:"year"}),p);default:return Vs(Ss(s.length,i),p)}}validate(i,s){return s.isTwoDigitYear||s.year>0}set(i,s,l,p){const _=Xj(i,p);if(l.isTwoDigitYear){const w=qX(l.year,_);return i.setFullYear(w,0,p.firstWeekContainsDate),i.setHours(0,0,0,0),fp(i,p)}const T=!("era"in s)||s.era===1?l.year:1-l.year;return i.setFullYear(T,0,p.firstWeekContainsDate),i.setHours(0,0,0,0),fp(i,p)}}class iTe extends Jr{constructor(){super(...arguments);zt(this,"priority",130);zt(this,"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"])}parse(i,s){return HO(s==="R"?4:s.length,i)}set(i,s,l){const p=_i(i,0);return p.setFullYear(l,0,4),p.setHours(0,0,0,0),Wv(p)}}class sTe extends Jr{constructor(){super(...arguments);zt(this,"priority",130);zt(this,"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"])}parse(i,s){return HO(s==="u"?4:s.length,i)}set(i,s,l){return i.setFullYear(l,0,1),i.setHours(0,0,0,0),i}}class aTe extends Jr{constructor(){super(...arguments);zt(this,"priority",120);zt(this,"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"])}parse(i,s,l){switch(s){case"Q":case"QQ":return Ss(s.length,i);case"Qo":return l.ordinalNumber(i,{unit:"quarter"});case"QQQ":return l.quarter(i,{width:"abbreviated",context:"formatting"})||l.quarter(i,{width:"narrow",context:"formatting"});case"QQQQQ":return l.quarter(i,{width:"narrow",context:"formatting"});case"QQQQ":default:return l.quarter(i,{width:"wide",context:"formatting"})||l.quarter(i,{width:"abbreviated",context:"formatting"})||l.quarter(i,{width:"narrow",context:"formatting"})}}validate(i,s){return s>=1&&s<=4}set(i,s,l){return i.setMonth((l-1)*3,1),i.setHours(0,0,0,0),i}}class oTe extends Jr{constructor(){super(...arguments);zt(this,"priority",120);zt(this,"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"])}parse(i,s,l){switch(s){case"q":case"qq":return Ss(s.length,i);case"qo":return l.ordinalNumber(i,{unit:"quarter"});case"qqq":return l.quarter(i,{width:"abbreviated",context:"standalone"})||l.quarter(i,{width:"narrow",context:"standalone"});case"qqqqq":return l.quarter(i,{width:"narrow",context:"standalone"});case"qqqq":default:return l.quarter(i,{width:"wide",context:"standalone"})||l.quarter(i,{width:"abbreviated",context:"standalone"})||l.quarter(i,{width:"narrow",context:"standalone"})}}validate(i,s){return s>=1&&s<=4}set(i,s,l){return i.setMonth((l-1)*3,1),i.setHours(0,0,0,0),i}}class cTe extends Jr{constructor(){super(...arguments);zt(this,"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]);zt(this,"priority",110)}parse(i,s,l){const p=_=>_-1;switch(s){case"M":return Vs(cs(Us.month,i),p);case"MM":return Vs(Ss(2,i),p);case"Mo":return Vs(l.ordinalNumber(i,{unit:"month"}),p);case"MMM":return l.month(i,{width:"abbreviated",context:"formatting"})||l.month(i,{width:"narrow",context:"formatting"});case"MMMMM":return l.month(i,{width:"narrow",context:"formatting"});case"MMMM":default:return l.month(i,{width:"wide",context:"formatting"})||l.month(i,{width:"abbreviated",context:"formatting"})||l.month(i,{width:"narrow",context:"formatting"})}}validate(i,s){return s>=0&&s<=11}set(i,s,l){return i.setMonth(l,1),i.setHours(0,0,0,0),i}}class lTe extends Jr{constructor(){super(...arguments);zt(this,"priority",110);zt(this,"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"])}parse(i,s,l){const p=_=>_-1;switch(s){case"L":return Vs(cs(Us.month,i),p);case"LL":return Vs(Ss(2,i),p);case"Lo":return Vs(l.ordinalNumber(i,{unit:"month"}),p);case"LLL":return l.month(i,{width:"abbreviated",context:"standalone"})||l.month(i,{width:"narrow",context:"standalone"});case"LLLLL":return l.month(i,{width:"narrow",context:"standalone"});case"LLLL":default:return l.month(i,{width:"wide",context:"standalone"})||l.month(i,{width:"abbreviated",context:"standalone"})||l.month(i,{width:"narrow",context:"standalone"})}}validate(i,s){return s>=0&&s<=11}set(i,s,l){return i.setMonth(l,1),i.setHours(0,0,0,0),i}}function dTe(a,n,i){const s=an(a,i==null?void 0:i.in),l=GX(s,i)-n;return s.setDate(s.getDate()-l*7),an(s,i==null?void 0:i.in)}class uTe extends Jr{constructor(){super(...arguments);zt(this,"priority",100);zt(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"])}parse(i,s,l){switch(s){case"w":return cs(Us.week,i);case"wo":return l.ordinalNumber(i,{unit:"week"});default:return Ss(s.length,i)}}validate(i,s){return s>=1&&s<=53}set(i,s,l,p){return fp(dTe(i,l,p),p)}}function hTe(a,n,i){const s=an(a,i==null?void 0:i.in),l=Kj(s,i)-n;return s.setDate(s.getDate()-l*7),s}class pTe extends Jr{constructor(){super(...arguments);zt(this,"priority",100);zt(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"])}parse(i,s,l){switch(s){case"I":return cs(Us.week,i);case"Io":return l.ordinalNumber(i,{unit:"week"});default:return Ss(s.length,i)}}validate(i,s){return s>=1&&s<=53}set(i,s,l){return Wv(hTe(i,l))}}const fTe=[31,28,31,30,31,30,31,31,30,31,30,31],mTe=[31,29,31,30,31,30,31,31,30,31,30,31];class gTe extends Jr{constructor(){super(...arguments);zt(this,"priority",90);zt(this,"subPriority",1);zt(this,"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"])}parse(i,s,l){switch(s){case"d":return cs(Us.date,i);case"do":return l.ordinalNumber(i,{unit:"date"});default:return Ss(s.length,i)}}validate(i,s){const l=i.getFullYear(),p=KX(l),_=i.getMonth();return p?s>=1&&s<=mTe[_]:s>=1&&s<=fTe[_]}set(i,s,l){return i.setDate(l),i.setHours(0,0,0,0),i}}class _Te extends Jr{constructor(){super(...arguments);zt(this,"priority",90);zt(this,"subpriority",1);zt(this,"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"])}parse(i,s,l){switch(s){case"D":case"DD":return cs(Us.dayOfYear,i);case"Do":return l.ordinalNumber(i,{unit:"date"});default:return Ss(s.length,i)}}validate(i,s){const l=i.getFullYear();return KX(l)?s>=1&&s<=366:s>=1&&s<=365}set(i,s,l){return i.setMonth(0,l),i.setHours(0,0,0,0),i}}function $j(a,n,i){var k,U,Y,W;const s=F_(),l=(i==null?void 0:i.weekStartsOn)??((U=(k=i==null?void 0:i.locale)==null?void 0:k.options)==null?void 0:U.weekStartsOn)??s.weekStartsOn??((W=(Y=s.locale)==null?void 0:Y.options)==null?void 0:W.weekStartsOn)??0,p=an(a,i==null?void 0:i.in),_=p.getDay(),w=(n%7+7)%7,C=7-l,O=n<0||n>6?n-(_+C)%7:(w+C)%7-(_+C)%7;return Sd(p,O,i)}class ETe extends Jr{constructor(){super(...arguments);zt(this,"priority",90);zt(this,"incompatibleTokens",["D","i","e","c","t","T"])}parse(i,s,l){switch(s){case"E":case"EE":case"EEE":return l.day(i,{width:"abbreviated",context:"formatting"})||l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"});case"EEEEE":return l.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"});case"EEEE":default:return l.day(i,{width:"wide",context:"formatting"})||l.day(i,{width:"abbreviated",context:"formatting"})||l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"})}}validate(i,s){return s>=0&&s<=6}set(i,s,l,p){return i=$j(i,l,p),i.setHours(0,0,0,0),i}}class yTe extends Jr{constructor(){super(...arguments);zt(this,"priority",90);zt(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"])}parse(i,s,l,p){const _=T=>{const w=Math.floor((T-1)/7)*7;return(T+p.weekStartsOn+6)%7+w};switch(s){case"e":case"ee":return Vs(Ss(s.length,i),_);case"eo":return Vs(l.ordinalNumber(i,{unit:"day"}),_);case"eee":return l.day(i,{width:"abbreviated",context:"formatting"})||l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"});case"eeeee":return l.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"});case"eeee":default:return l.day(i,{width:"wide",context:"formatting"})||l.day(i,{width:"abbreviated",context:"formatting"})||l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"})}}validate(i,s){return s>=0&&s<=6}set(i,s,l,p){return i=$j(i,l,p),i.setHours(0,0,0,0),i}}class vTe extends Jr{constructor(){super(...arguments);zt(this,"priority",90);zt(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"])}parse(i,s,l,p){const _=T=>{const w=Math.floor((T-1)/7)*7;return(T+p.weekStartsOn+6)%7+w};switch(s){case"c":case"cc":return Vs(Ss(s.length,i),_);case"co":return Vs(l.ordinalNumber(i,{unit:"day"}),_);case"ccc":return l.day(i,{width:"abbreviated",context:"standalone"})||l.day(i,{width:"short",context:"standalone"})||l.day(i,{width:"narrow",context:"standalone"});case"ccccc":return l.day(i,{width:"narrow",context:"standalone"});case"cccccc":return l.day(i,{width:"short",context:"standalone"})||l.day(i,{width:"narrow",context:"standalone"});case"cccc":default:return l.day(i,{width:"wide",context:"standalone"})||l.day(i,{width:"abbreviated",context:"standalone"})||l.day(i,{width:"short",context:"standalone"})||l.day(i,{width:"narrow",context:"standalone"})}}validate(i,s){return s>=0&&s<=6}set(i,s,l,p){return i=$j(i,l,p),i.setHours(0,0,0,0),i}}function STe(a,n,i){const s=an(a,i==null?void 0:i.in),l=KSe(s,i),p=n-l;return Sd(s,p,i)}class TTe extends Jr{constructor(){super(...arguments);zt(this,"priority",90);zt(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"])}parse(i,s,l){const p=_=>_===0?7:_;switch(s){case"i":case"ii":return Ss(s.length,i);case"io":return l.ordinalNumber(i,{unit:"day"});case"iii":return Vs(l.day(i,{width:"abbreviated",context:"formatting"})||l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"}),p);case"iiiii":return Vs(l.day(i,{width:"narrow",context:"formatting"}),p);case"iiiiii":return Vs(l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"}),p);case"iiii":default:return Vs(l.day(i,{width:"wide",context:"formatting"})||l.day(i,{width:"abbreviated",context:"formatting"})||l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"}),p)}}validate(i,s){return s>=1&&s<=7}set(i,s,l){return i=STe(i,l),i.setHours(0,0,0,0),i}}class bTe extends Jr{constructor(){super(...arguments);zt(this,"priority",80);zt(this,"incompatibleTokens",["b","B","H","k","t","T"])}parse(i,s,l){switch(s){case"a":case"aa":case"aaa":return l.dayPeriod(i,{width:"abbreviated",context:"formatting"})||l.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaaa":return l.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return l.dayPeriod(i,{width:"wide",context:"formatting"})||l.dayPeriod(i,{width:"abbreviated",context:"formatting"})||l.dayPeriod(i,{width:"narrow",context:"formatting"})}}set(i,s,l){return i.setHours(Qj(l),0,0,0),i}}class wTe extends Jr{constructor(){super(...arguments);zt(this,"priority",80);zt(this,"incompatibleTokens",["a","B","H","k","t","T"])}parse(i,s,l){switch(s){case"b":case"bb":case"bbb":return l.dayPeriod(i,{width:"abbreviated",context:"formatting"})||l.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbbb":return l.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return l.dayPeriod(i,{width:"wide",context:"formatting"})||l.dayPeriod(i,{width:"abbreviated",context:"formatting"})||l.dayPeriod(i,{width:"narrow",context:"formatting"})}}set(i,s,l){return i.setHours(Qj(l),0,0,0),i}}class RTe extends Jr{constructor(){super(...arguments);zt(this,"priority",80);zt(this,"incompatibleTokens",["a","b","t","T"])}parse(i,s,l){switch(s){case"B":case"BB":case"BBB":return l.dayPeriod(i,{width:"abbreviated",context:"formatting"})||l.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBBB":return l.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return l.dayPeriod(i,{width:"wide",context:"formatting"})||l.dayPeriod(i,{width:"abbreviated",context:"formatting"})||l.dayPeriod(i,{width:"narrow",context:"formatting"})}}set(i,s,l){return i.setHours(Qj(l),0,0,0),i}}class CTe extends Jr{constructor(){super(...arguments);zt(this,"priority",70);zt(this,"incompatibleTokens",["H","K","k","t","T"])}parse(i,s,l){switch(s){case"h":return cs(Us.hour12h,i);case"ho":return l.ordinalNumber(i,{unit:"hour"});default:return Ss(s.length,i)}}validate(i,s){return s>=1&&s<=12}set(i,s,l){const p=i.getHours()>=12;return p&&l<12?i.setHours(l+12,0,0,0):!p&&l===12?i.setHours(0,0,0,0):i.setHours(l,0,0,0),i}}class ATe extends Jr{constructor(){super(...arguments);zt(this,"priority",70);zt(this,"incompatibleTokens",["a","b","h","K","k","t","T"])}parse(i,s,l){switch(s){case"H":return cs(Us.hour23h,i);case"Ho":return l.ordinalNumber(i,{unit:"hour"});default:return Ss(s.length,i)}}validate(i,s){return s>=0&&s<=23}set(i,s,l){return i.setHours(l,0,0,0),i}}class ITe extends Jr{constructor(){super(...arguments);zt(this,"priority",70);zt(this,"incompatibleTokens",["h","H","k","t","T"])}parse(i,s,l){switch(s){case"K":return cs(Us.hour11h,i);case"Ko":return l.ordinalNumber(i,{unit:"hour"});default:return Ss(s.length,i)}}validate(i,s){return s>=0&&s<=11}set(i,s,l){return i.getHours()>=12&&l<12?i.setHours(l+12,0,0,0):i.setHours(l,0,0,0),i}}class NTe extends Jr{constructor(){super(...arguments);zt(this,"priority",70);zt(this,"incompatibleTokens",["a","b","h","H","K","t","T"])}parse(i,s,l){switch(s){case"k":return cs(Us.hour24h,i);case"ko":return l.ordinalNumber(i,{unit:"hour"});default:return Ss(s.length,i)}}validate(i,s){return s>=1&&s<=24}set(i,s,l){const p=l<=24?l%24:l;return i.setHours(p,0,0,0),i}}class OTe extends Jr{constructor(){super(...arguments);zt(this,"priority",60);zt(this,"incompatibleTokens",["t","T"])}parse(i,s,l){switch(s){case"m":return cs(Us.minute,i);case"mo":return l.ordinalNumber(i,{unit:"minute"});default:return Ss(s.length,i)}}validate(i,s){return s>=0&&s<=59}set(i,s,l){return i.setMinutes(l,0,0),i}}class DTe extends Jr{constructor(){super(...arguments);zt(this,"priority",50);zt(this,"incompatibleTokens",["t","T"])}parse(i,s,l){switch(s){case"s":return cs(Us.second,i);case"so":return l.ordinalNumber(i,{unit:"second"});default:return Ss(s.length,i)}}validate(i,s){return s>=0&&s<=59}set(i,s,l){return i.setSeconds(l,0),i}}class xTe extends Jr{constructor(){super(...arguments);zt(this,"priority",30);zt(this,"incompatibleTokens",["t","T"])}parse(i,s){const l=p=>Math.trunc(p*Math.pow(10,-s.length+3));return Vs(Ss(s.length,i),l)}set(i,s,l){return i.setMilliseconds(l),i}}class PTe extends Jr{constructor(){super(...arguments);zt(this,"priority",10);zt(this,"incompatibleTokens",["t","T","x"])}parse(i,s){switch(s){case"X":return ku(Pu.basicOptionalMinutes,i);case"XX":return ku(Pu.basic,i);case"XXXX":return ku(Pu.basicOptionalSeconds,i);case"XXXXX":return ku(Pu.extendedOptionalSeconds,i);case"XXX":default:return ku(Pu.extended,i)}}set(i,s,l){return s.timestampIsSet?i:_i(i,i.getTime()-MO(i)-l)}}class kTe extends Jr{constructor(){super(...arguments);zt(this,"priority",10);zt(this,"incompatibleTokens",["t","T","X"])}parse(i,s){switch(s){case"x":return ku(Pu.basicOptionalMinutes,i);case"xx":return ku(Pu.basic,i);case"xxxx":return ku(Pu.basicOptionalSeconds,i);case"xxxxx":return ku(Pu.extendedOptionalSeconds,i);case"xxx":default:return ku(Pu.extended,i)}}set(i,s,l){return s.timestampIsSet?i:_i(i,i.getTime()-MO(i)-l)}}class LTe extends Jr{constructor(){super(...arguments);zt(this,"priority",40);zt(this,"incompatibleTokens","*")}parse(i){return YX(i)}set(i,s,l){return[_i(i,l*1e3),{timestampIsSet:!0}]}}class MTe extends Jr{constructor(){super(...arguments);zt(this,"priority",20);zt(this,"incompatibleTokens","*")}parse(i){return YX(i)}set(i,s,l){return[_i(i,l),{timestampIsSet:!0}]}}const jTe={G:new tTe,y:new nTe,Y:new rTe,R:new iTe,u:new sTe,Q:new aTe,q:new oTe,M:new cTe,L:new lTe,w:new uTe,I:new pTe,d:new gTe,D:new _Te,E:new ETe,e:new yTe,c:new vTe,i:new TTe,a:new bTe,b:new wTe,B:new RTe,h:new CTe,H:new ATe,K:new ITe,k:new NTe,m:new OTe,s:new DTe,S:new xTe,X:new PTe,x:new kTe,t:new LTe,T:new MTe},UTe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,VTe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,FTe=/^'([^]*?)'?$/,BTe=/''/g,HTe=/\S/,GTe=/[a-zA-Z]/;function WTe(a,n,i,s){var K,ie,se,ue,ye,ae,ve,$;const l=()=>_i((s==null?void 0:s.in)||i,NaN),p=qSe(),_=(s==null?void 0:s.locale)??p.locale??HX,T=(s==null?void 0:s.firstWeekContainsDate)??((ie=(K=s==null?void 0:s.locale)==null?void 0:K.options)==null?void 0:ie.firstWeekContainsDate)??p.firstWeekContainsDate??((ue=(se=p.locale)==null?void 0:se.options)==null?void 0:ue.firstWeekContainsDate)??1,w=(s==null?void 0:s.weekStartsOn)??((ae=(ye=s==null?void 0:s.locale)==null?void 0:ye.options)==null?void 0:ae.weekStartsOn)??p.weekStartsOn??(($=(ve=p.locale)==null?void 0:ve.options)==null?void 0:$.weekStartsOn)??0;if(!n)return a?l():an(i,s==null?void 0:s.in);const C={firstWeekContainsDate:T,weekStartsOn:w,locale:_},O=[new eTe(s==null?void 0:s.in,i)],k=n.match(VTe).map(Q=>{const te=Q[0];if(te in I2){const oe=I2[te];return oe(Q,_.formatLong)}return Q}).join("").match(UTe),U=[];for(let Q of k){const te=Q[0],oe=jTe[te];if(oe){const{incompatibleTokens:re}=oe;if(Array.isArray(re)){const pe=U.find(Ne=>re.includes(Ne.token)||Ne.token===te);if(pe)throw new RangeError(`The format string mustn't contain \`${pe.fullToken}\` and \`${Q}\` at the same time`)}else if(oe.incompatibleTokens==="*"&&U.length>0)throw new RangeError(`The format string mustn't contain \`${Q}\` and any other token at the same time`);U.push({token:te,fullToken:Q});const fe=oe.run(a,Q,_.match,C);if(!fe)return l();O.push(fe.setter),a=fe.rest}else{if(te.match(GTe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+te+"`");if(Q==="''"?Q="'":te==="'"&&(Q=zTe(Q)),a.indexOf(Q)===0)a=a.slice(Q.length);else return l()}}if(a.length>0&&HTe.test(a))return l();const Y=O.map(Q=>Q.priority).sort((Q,te)=>te-Q).filter((Q,te,oe)=>oe.indexOf(Q)===te).map(Q=>O.filter(te=>te.priority===Q).sort((te,oe)=>oe.subPriority-te.subPriority)).map(Q=>Q[0]);let W=an(i,s==null?void 0:s.in);if(isNaN(+W))return l();const ee={};for(const Q of Y){if(!Q.validate(W,C))return l();const te=Q.set(W,ee,C);Array.isArray(te)?(W=te[0],Object.assign(ee,te[1])):W=te}return W}function zTe(a){return a.match(FTe)[1].replace(BTe,"'")}function YTe(a,n,i){const[s,l]=gp(i==null?void 0:i.in,a,n);return s.getFullYear()===l.getFullYear()&&s.getMonth()===l.getMonth()}function qTe(a,n,i){const[s,l]=gp(i==null?void 0:i.in,a,n);return+A2(s)==+A2(l)}function KTe(a,n,i){const[s,l]=gp(i==null?void 0:i.in,a,n);return s.getFullYear()===l.getFullYear()}function hR(a,n,i){const s=+an(a,i==null?void 0:i.in),[l,p]=[+an(n.start,i==null?void 0:i.in),+an(n.end,i==null?void 0:i.in)].sort((_,T)=>_-T);return s>=l&&s<=p}function XTe(a,n,i){return Sd(a,-1,i)}function QTe(a,n){const i=()=>_i(n==null?void 0:n.in,NaN),l=ebe(a);let p;if(l.date){const C=tbe(l.date,2);p=nbe(C.restDateString,C.year)}if(!p||isNaN(+p))return i();const _=+p;let T=0,w;if(l.time&&(T=rbe(l.time),isNaN(T)))return i();if(l.timezone){if(w=ibe(l.timezone),isNaN(w))return i()}else{const C=new Date(_+T),O=an(0,n==null?void 0:n.in);return O.setFullYear(C.getUTCFullYear(),C.getUTCMonth(),C.getUTCDate()),O.setHours(C.getUTCHours(),C.getUTCMinutes(),C.getUTCSeconds(),C.getUTCMilliseconds()),O}return an(_+T+w,n==null?void 0:n.in)}const aN={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},$Te=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,JTe=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,ZTe=/^([+-])(\d{2})(?::?(\d{2}))?$/;function ebe(a){const n={},i=a.split(aN.dateTimeDelimiter);let s;if(i.length>2)return n;if(/:/.test(i[0])?s=i[0]:(n.date=i[0],s=i[1],aN.timeZoneDelimiter.test(n.date)&&(n.date=a.split(aN.timeZoneDelimiter)[0],s=a.substr(n.date.length,a.length))),s){const l=aN.timezone.exec(s);l?(n.time=s.replace(l[1],""),n.timezone=l[1]):n.time=s}return n}function tbe(a,n){const i=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+n)+"})|(\\d{2}|[+-]\\d{"+(2+n)+"})$)"),s=a.match(i);if(!s)return{year:NaN,restDateString:""};const l=s[1]?parseInt(s[1]):null,p=s[2]?parseInt(s[2]):null;return{year:p===null?l:p*100,restDateString:a.slice((s[1]||s[2]).length)}}function nbe(a,n){if(n===null)return new Date(NaN);const i=a.match($Te);if(!i)return new Date(NaN);const s=!!i[4],l=Cw(i[1]),p=Cw(i[2])-1,_=Cw(i[3]),T=Cw(i[4]),w=Cw(i[5])-1;if(s)return lbe(n,T,w)?sbe(n,T,w):new Date(NaN);{const C=new Date(0);return!obe(n,p,_)||!cbe(n,l)?new Date(NaN):(C.setUTCFullYear(n,p,Math.max(l,_)),C)}}function Cw(a){return a?parseInt(a):1}function rbe(a){const n=a.match(JTe);if(!n)return NaN;const i=mM(n[1]),s=mM(n[2]),l=mM(n[3]);return dbe(i,s,l)?i*PD+s*xD+l*1e3:NaN}function mM(a){return a&&parseFloat(a.replace(",","."))||0}function ibe(a){if(a==="Z")return 0;const n=a.match(ZTe);if(!n)return 0;const i=n[1]==="+"?-1:1,s=parseInt(n[2]),l=n[3]&&parseInt(n[3])||0;return ube(s,l)?i*(s*PD+l*xD):NaN}function sbe(a,n,i){const s=new Date(0);s.setUTCFullYear(a,0,4);const l=s.getUTCDay()||7,p=(n-1)*7+i+1-l;return s.setUTCDate(s.getUTCDate()+p),s}const abe=[31,null,31,30,31,30,31,31,30,31,30,31];function XX(a){return a%400===0||a%4===0&&a%100!==0}function obe(a,n,i){return n>=0&&n<=11&&i>=1&&i<=(abe[n]||(XX(a)?29:28))}function cbe(a,n){return n>=1&&n<=(XX(a)?366:365)}function lbe(a,n,i){return n>=1&&n<=53&&i>=0&&i<=6}function dbe(a,n,i){return a===24?n===0&&i===0:i>=0&&i<60&&n>=0&&n<60&&a>=0&&a<25}function ube(a,n){return n>=0&&n<=59}function Dl(a,n,i){const s=an(a,i==null?void 0:i.in),l=s.getFullYear(),p=s.getDate(),_=_i(a,0);_.setFullYear(l,n,15),_.setHours(0,0,0,0);const T=YSe(_);return s.setMonth(n,Math.min(p,T)),s}function nO(a,n,i){const s=an(a,i==null?void 0:i.in);return s.setHours(n),s}function rO(a,n,i){const s=an(a,i==null?void 0:i.in);return s.setMinutes(n),s}function Cv(a,n,i){const s=an(a,i==null?void 0:i.in),l=Math.trunc(s.getMonth()/3)+1,p=n-l;return Dl(s,s.getMonth()+p*3)}function iO(a,n,i){const s=an(a,i==null?void 0:i.in);return s.setSeconds(n),s}function Ou(a,n,i){const s=an(a,i==null?void 0:i.in);return isNaN(+s)?_i(a,NaN):(s.setFullYear(n),s)}function w_(a,n,i){return wd(a,-n,i)}function QX(a,n,i){return qj(a,-1,i)}function iY(a,n,i){return jO(a,-1,i)}function Yv(a,n,i){return np(a,-n,i)}function LD(){return typeof window<"u"}function lS(a){return $X(a)?(a.nodeName||"").toLowerCase():"#document"}function Fc(a){var n;return(a==null||(n=a.ownerDocument)==null?void 0:n.defaultView)||window}function Gu(a){var n;return(n=($X(a)?a.ownerDocument:a.document)||window.document)==null?void 0:n.documentElement}function $X(a){return LD()?a instanceof Node||a instanceof Fc(a).Node:!1}function Mo(a){return LD()?a instanceof Element||a instanceof Fc(a).Element:!1}function Bu(a){return LD()?a instanceof HTMLElement||a instanceof Fc(a).HTMLElement:!1}function sY(a){return!LD()||typeof ShadowRoot>"u"?!1:a instanceof ShadowRoot||a instanceof Fc(a).ShadowRoot}const hbe=new Set(["inline","contents"]);function AR(a){const{overflow:n,overflowX:i,overflowY:s,display:l}=kl(a);return/auto|scroll|overlay|hidden|clip/.test(n+s+i)&&!hbe.has(l)}const pbe=new Set(["table","td","th"]);function fbe(a){return pbe.has(lS(a))}const mbe=[":popover-open",":modal"];function MD(a){return mbe.some(n=>{try{return a.matches(n)}catch{return!1}})}const gbe=["transform","translate","scale","rotate","perspective"],_be=["transform","translate","scale","rotate","perspective","filter"],Ebe=["paint","layout","strict","content"];function Jj(a){const n=Zj(),i=Mo(a)?kl(a):a;return gbe.some(s=>i[s]?i[s]!=="none":!1)||(i.containerType?i.containerType!=="normal":!1)||!n&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!n&&(i.filter?i.filter!=="none":!1)||_be.some(s=>(i.willChange||"").includes(s))||Ebe.some(s=>(i.contain||"").includes(s))}function ybe(a){let n=im(a);for(;Bu(n)&&!qv(n);){if(Jj(n))return n;if(MD(n))return null;n=im(n)}return null}function Zj(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const vbe=new Set(["html","body","#document"]);function qv(a){return vbe.has(lS(a))}function kl(a){return Fc(a).getComputedStyle(a)}function jD(a){return Mo(a)?{scrollLeft:a.scrollLeft,scrollTop:a.scrollTop}:{scrollLeft:a.scrollX,scrollTop:a.scrollY}}function im(a){if(lS(a)==="html")return a;const n=a.assignedSlot||a.parentNode||sY(a)&&a.host||Gu(a);return sY(n)?n.host:n}function JX(a){const n=im(a);return qv(n)?a.ownerDocument?a.ownerDocument.body:a.body:Bu(n)&&AR(n)?n:JX(n)}function pR(a,n,i){var s;n===void 0&&(n=[]),i===void 0&&(i=!0);const l=JX(a),p=l===((s=a.ownerDocument)==null?void 0:s.body),_=Fc(l);if(p){const T=O2(_);return n.concat(_,_.visualViewport||[],AR(l)?l:[],T&&i?pR(T):[])}return n.concat(l,pR(l,[],i))}function O2(a){return a.parent&&Object.getPrototypeOf(a.parent)?a.frameElement:null}const Kv=Math.min,R_=Math.max,GO=Math.round,oN=Math.floor,Vu=a=>({x:a,y:a}),Sbe={left:"right",right:"left",bottom:"top",top:"bottom"},Tbe={start:"end",end:"start"};function bbe(a,n,i){return R_(a,Kv(n,i))}function UD(a,n){return typeof a=="function"?a(n):a}function Xv(a){return a.split("-")[0]}function IR(a){return a.split("-")[1]}function wbe(a){return a==="x"?"y":"x"}function eU(a){return a==="y"?"height":"width"}const Rbe=new Set(["top","bottom"]);function g_(a){return Rbe.has(Xv(a))?"y":"x"}function tU(a){return wbe(g_(a))}function Cbe(a,n,i){i===void 0&&(i=!1);const s=IR(a),l=tU(a),p=eU(l);let _=l==="x"?s===(i?"end":"start")?"right":"left":s==="start"?"bottom":"top";return n.reference[p]>n.floating[p]&&(_=WO(_)),[_,WO(_)]}function Abe(a){const n=WO(a);return[D2(a),n,D2(n)]}function D2(a){return a.replace(/start|end/g,n=>Tbe[n])}const aY=["left","right"],oY=["right","left"],Ibe=["top","bottom"],Nbe=["bottom","top"];function Obe(a,n,i){switch(a){case"top":case"bottom":return i?n?oY:aY:n?aY:oY;case"left":case"right":return n?Ibe:Nbe;default:return[]}}function Dbe(a,n,i,s){const l=IR(a);let p=Obe(Xv(a),i==="start",s);return l&&(p=p.map(_=>_+"-"+l),n&&(p=p.concat(p.map(D2)))),p}function WO(a){return a.replace(/left|right|bottom|top/g,n=>Sbe[n])}function xbe(a){return{top:0,right:0,bottom:0,left:0,...a}}function ZX(a){return typeof a!="number"?xbe(a):{top:a,right:a,bottom:a,left:a}}function zO(a){const{x:n,y:i,width:s,height:l}=a;return{width:s,height:l,top:i,left:n,right:n+s,bottom:i+l,x:n,y:i}}var Pbe=typeof document<"u",kbe=function(){},YO=Pbe?F.useLayoutEffect:kbe;const Lbe={...kY},Mbe=Lbe.useInsertionEffect,jbe=Mbe||(a=>a());function Ube(a){const n=F.useRef(()=>{});return jbe(()=>{n.current=a}),F.useCallback(function(){for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n.current==null?void 0:n.current(...s)},[])}function cY(a,n,i){let{reference:s,floating:l}=a;const p=g_(n),_=tU(n),T=eU(_),w=Xv(n),C=p==="y",O=s.x+s.width/2-l.width/2,k=s.y+s.height/2-l.height/2,U=s[T]/2-l[T]/2;let Y;switch(w){case"top":Y={x:O,y:s.y-l.height};break;case"bottom":Y={x:O,y:s.y+s.height};break;case"right":Y={x:s.x+s.width,y:k};break;case"left":Y={x:s.x-l.width,y:k};break;default:Y={x:s.x,y:s.y}}switch(IR(n)){case"start":Y[_]-=U*(i&&C?-1:1);break;case"end":Y[_]+=U*(i&&C?-1:1);break}return Y}const Vbe=async(a,n,i)=>{const{placement:s="bottom",strategy:l="absolute",middleware:p=[],platform:_}=i,T=p.filter(Boolean),w=await(_.isRTL==null?void 0:_.isRTL(n));let C=await _.getElementRects({reference:a,floating:n,strategy:l}),{x:O,y:k}=cY(C,s,w),U=s,Y={},W=0;for(let ee=0;ee<T.length;ee++){const{name:K,fn:ie}=T[ee],{x:se,y:ue,data:ye,reset:ae}=await ie({x:O,y:k,initialPlacement:s,placement:U,strategy:l,middlewareData:Y,rects:C,platform:_,elements:{reference:a,floating:n}});O=se??O,k=ue??k,Y={...Y,[K]:{...Y[K],...ye}},ae&&W<=50&&(W++,typeof ae=="object"&&(ae.placement&&(U=ae.placement),ae.rects&&(C=ae.rects===!0?await _.getElementRects({reference:a,floating:n,strategy:l}):ae.rects),{x:O,y:k}=cY(C,U,w)),ee=-1)}return{x:O,y:k,placement:U,strategy:l,middlewareData:Y}};async function Fbe(a,n){var i;n===void 0&&(n={});const{x:s,y:l,platform:p,rects:_,elements:T,strategy:w}=a,{boundary:C="clippingAncestors",rootBoundary:O="viewport",elementContext:k="floating",altBoundary:U=!1,padding:Y=0}=UD(n,a),W=ZX(Y),K=T[U?k==="floating"?"reference":"floating":k],ie=zO(await p.getClippingRect({element:(i=await(p.isElement==null?void 0:p.isElement(K)))==null||i?K:K.contextElement||await(p.getDocumentElement==null?void 0:p.getDocumentElement(T.floating)),boundary:C,rootBoundary:O,strategy:w})),se=k==="floating"?{x:s,y:l,width:_.floating.width,height:_.floating.height}:_.reference,ue=await(p.getOffsetParent==null?void 0:p.getOffsetParent(T.floating)),ye=await(p.isElement==null?void 0:p.isElement(ue))?await(p.getScale==null?void 0:p.getScale(ue))||{x:1,y:1}:{x:1,y:1},ae=zO(p.convertOffsetParentRelativeRectToViewportRelativeRect?await p.convertOffsetParentRelativeRectToViewportRelativeRect({elements:T,rect:se,offsetParent:ue,strategy:w}):se);return{top:(ie.top-ae.top+W.top)/ye.y,bottom:(ae.bottom-ie.bottom+W.bottom)/ye.y,left:(ie.left-ae.left+W.left)/ye.x,right:(ae.right-ie.right+W.right)/ye.x}}const Bbe=a=>({name:"arrow",options:a,async fn(n){const{x:i,y:s,placement:l,rects:p,platform:_,elements:T,middlewareData:w}=n,{element:C,padding:O=0}=UD(a,n)||{};if(C==null)return{};const k=ZX(O),U={x:i,y:s},Y=tU(l),W=eU(Y),ee=await _.getDimensions(C),K=Y==="y",ie=K?"top":"left",se=K?"bottom":"right",ue=K?"clientHeight":"clientWidth",ye=p.reference[W]+p.reference[Y]-U[Y]-p.floating[W],ae=U[Y]-p.reference[Y],ve=await(_.getOffsetParent==null?void 0:_.getOffsetParent(C));let $=ve?ve[ue]:0;(!$||!await(_.isElement==null?void 0:_.isElement(ve)))&&($=T.floating[ue]||p.floating[W]);const Q=ye/2-ae/2,te=$/2-ee[W]/2-1,oe=Kv(k[ie],te),re=Kv(k[se],te),fe=oe,pe=$-ee[W]-re,Ne=$/2-ee[W]/2+Q,Je=bbe(fe,Ne,pe),be=!w.arrow&&IR(l)!=null&&Ne!==Je&&p.reference[W]/2-(Ne<fe?oe:re)-ee[W]/2<0,Ie=be?Ne<fe?Ne-fe:Ne-pe:0;return{[Y]:U[Y]+Ie,data:{[Y]:Je,centerOffset:Ne-Je-Ie,...be&&{alignmentOffset:Ie}},reset:be}}}),Hbe=function(a){return a===void 0&&(a={}),{name:"flip",options:a,async fn(n){var i,s;const{placement:l,middlewareData:p,rects:_,initialPlacement:T,platform:w,elements:C}=n,{mainAxis:O=!0,crossAxis:k=!0,fallbackPlacements:U,fallbackStrategy:Y="bestFit",fallbackAxisSideDirection:W="none",flipAlignment:ee=!0,...K}=UD(a,n);if((i=p.arrow)!=null&&i.alignmentOffset)return{};const ie=Xv(l),se=g_(T),ue=Xv(T)===T,ye=await(w.isRTL==null?void 0:w.isRTL(C.floating)),ae=U||(ue||!ee?[WO(T)]:Abe(T)),ve=W!=="none";!U&&ve&&ae.push(...Dbe(T,ee,W,ye));const $=[T,...ae],Q=await Fbe(n,K),te=[];let oe=((s=p.flip)==null?void 0:s.overflows)||[];if(O&&te.push(Q[ie]),k){const Ne=Cbe(l,_,ye);te.push(Q[Ne[0]],Q[Ne[1]])}if(oe=[...oe,{placement:l,overflows:te}],!te.every(Ne=>Ne<=0)){var re,fe;const Ne=(((re=p.flip)==null?void 0:re.index)||0)+1,Je=$[Ne];if(Je&&(!(k==="alignment"?se!==g_(Je):!1)||oe.every(Re=>Re.overflows[0]>0&&g_(Re.placement)===se)))return{data:{index:Ne,overflows:oe},reset:{placement:Je}};let be=(fe=oe.filter(Ie=>Ie.overflows[0]<=0).sort((Ie,Re)=>Ie.overflows[1]-Re.overflows[1])[0])==null?void 0:fe.placement;if(!be)switch(Y){case"bestFit":{var pe;const Ie=(pe=oe.filter(Re=>{if(ve){const Me=g_(Re.placement);return Me===se||Me==="y"}return!0}).map(Re=>[Re.placement,Re.overflows.filter(Me=>Me>0).reduce((Me,he)=>Me+he,0)]).sort((Re,Me)=>Re[1]-Me[1])[0])==null?void 0:pe[0];Ie&&(be=Ie);break}case"initialPlacement":be=T;break}if(l!==be)return{reset:{placement:be}}}return{}}}},Gbe=new Set(["left","top"]);async function Wbe(a,n){const{placement:i,platform:s,elements:l}=a,p=await(s.isRTL==null?void 0:s.isRTL(l.floating)),_=Xv(i),T=IR(i),w=g_(i)==="y",C=Gbe.has(_)?-1:1,O=p&&w?-1:1,k=UD(n,a);let{mainAxis:U,crossAxis:Y,alignmentAxis:W}=typeof k=="number"?{mainAxis:k,crossAxis:0,alignmentAxis:null}:{mainAxis:k.mainAxis||0,crossAxis:k.crossAxis||0,alignmentAxis:k.alignmentAxis};return T&&typeof W=="number"&&(Y=T==="end"?W*-1:W),w?{x:Y*O,y:U*C}:{x:U*C,y:Y*O}}const zbe=function(a){return a===void 0&&(a=0),{name:"offset",options:a,async fn(n){var i,s;const{x:l,y:p,placement:_,middlewareData:T}=n,w=await Wbe(n,a);return _===((i=T.offset)==null?void 0:i.placement)&&(s=T.arrow)!=null&&s.alignmentOffset?{}:{x:l+w.x,y:p+w.y,data:{...w,placement:_}}}}};function eQ(a){const n=kl(a);let i=parseFloat(n.width)||0,s=parseFloat(n.height)||0;const l=Bu(a),p=l?a.offsetWidth:i,_=l?a.offsetHeight:s,T=GO(i)!==p||GO(s)!==_;return T&&(i=p,s=_),{width:i,height:s,$:T}}function nU(a){return Mo(a)?a:a.contextElement}function Pv(a){const n=nU(a);if(!Bu(n))return Vu(1);const i=n.getBoundingClientRect(),{width:s,height:l,$:p}=eQ(n);let _=(p?GO(i.width):i.width)/s,T=(p?GO(i.height):i.height)/l;return(!_||!Number.isFinite(_))&&(_=1),(!T||!Number.isFinite(T))&&(T=1),{x:_,y:T}}const Ybe=Vu(0);function tQ(a){const n=Fc(a);return!Zj()||!n.visualViewport?Ybe:{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}}function qbe(a,n,i){return n===void 0&&(n=!1),!i||n&&i!==Fc(a)?!1:n}function L_(a,n,i,s){n===void 0&&(n=!1),i===void 0&&(i=!1);const l=a.getBoundingClientRect(),p=nU(a);let _=Vu(1);n&&(s?Mo(s)&&(_=Pv(s)):_=Pv(a));const T=qbe(p,i,s)?tQ(p):Vu(0);let w=(l.left+T.x)/_.x,C=(l.top+T.y)/_.y,O=l.width/_.x,k=l.height/_.y;if(p){const U=Fc(p),Y=s&&Mo(s)?Fc(s):s;let W=U,ee=O2(W);for(;ee&&s&&Y!==W;){const K=Pv(ee),ie=ee.getBoundingClientRect(),se=kl(ee),ue=ie.left+(ee.clientLeft+parseFloat(se.paddingLeft))*K.x,ye=ie.top+(ee.clientTop+parseFloat(se.paddingTop))*K.y;w*=K.x,C*=K.y,O*=K.x,k*=K.y,w+=ue,C+=ye,W=Fc(ee),ee=O2(W)}}return zO({width:O,height:k,x:w,y:C})}function rU(a,n){const i=jD(a).scrollLeft;return n?n.left+i:L_(Gu(a)).left+i}function nQ(a,n,i){i===void 0&&(i=!1);const s=a.getBoundingClientRect(),l=s.left+n.scrollLeft-(i?0:rU(a,s)),p=s.top+n.scrollTop;return{x:l,y:p}}function Kbe(a){let{elements:n,rect:i,offsetParent:s,strategy:l}=a;const p=l==="fixed",_=Gu(s),T=n?MD(n.floating):!1;if(s===_||T&&p)return i;let w={scrollLeft:0,scrollTop:0},C=Vu(1);const O=Vu(0),k=Bu(s);if((k||!k&&!p)&&((lS(s)!=="body"||AR(_))&&(w=jD(s)),Bu(s))){const Y=L_(s);C=Pv(s),O.x=Y.x+s.clientLeft,O.y=Y.y+s.clientTop}const U=_&&!k&&!p?nQ(_,w,!0):Vu(0);return{width:i.width*C.x,height:i.height*C.y,x:i.x*C.x-w.scrollLeft*C.x+O.x+U.x,y:i.y*C.y-w.scrollTop*C.y+O.y+U.y}}function Xbe(a){return Array.from(a.getClientRects())}function Qbe(a){const n=Gu(a),i=jD(a),s=a.ownerDocument.body,l=R_(n.scrollWidth,n.clientWidth,s.scrollWidth,s.clientWidth),p=R_(n.scrollHeight,n.clientHeight,s.scrollHeight,s.clientHeight);let _=-i.scrollLeft+rU(a);const T=-i.scrollTop;return kl(s).direction==="rtl"&&(_+=R_(n.clientWidth,s.clientWidth)-l),{width:l,height:p,x:_,y:T}}function $be(a,n){const i=Fc(a),s=Gu(a),l=i.visualViewport;let p=s.clientWidth,_=s.clientHeight,T=0,w=0;if(l){p=l.width,_=l.height;const C=Zj();(!C||C&&n==="fixed")&&(T=l.offsetLeft,w=l.offsetTop)}return{width:p,height:_,x:T,y:w}}const Jbe=new Set(["absolute","fixed"]);function Zbe(a,n){const i=L_(a,!0,n==="fixed"),s=i.top+a.clientTop,l=i.left+a.clientLeft,p=Bu(a)?Pv(a):Vu(1),_=a.clientWidth*p.x,T=a.clientHeight*p.y,w=l*p.x,C=s*p.y;return{width:_,height:T,x:w,y:C}}function lY(a,n,i){let s;if(n==="viewport")s=$be(a,i);else if(n==="document")s=Qbe(Gu(a));else if(Mo(n))s=Zbe(n,i);else{const l=tQ(a);s={x:n.x-l.x,y:n.y-l.y,width:n.width,height:n.height}}return zO(s)}function rQ(a,n){const i=im(a);return i===n||!Mo(i)||qv(i)?!1:kl(i).position==="fixed"||rQ(i,n)}function ewe(a,n){const i=n.get(a);if(i)return i;let s=pR(a,[],!1).filter(T=>Mo(T)&&lS(T)!=="body"),l=null;const p=kl(a).position==="fixed";let _=p?im(a):a;for(;Mo(_)&&!qv(_);){const T=kl(_),w=Jj(_);!w&&T.position==="fixed"&&(l=null),(p?!w&&!l:!w&&T.position==="static"&&!!l&&Jbe.has(l.position)||AR(_)&&!w&&rQ(a,_))?s=s.filter(O=>O!==_):l=T,_=im(_)}return n.set(a,s),s}function twe(a){let{element:n,boundary:i,rootBoundary:s,strategy:l}=a;const _=[...i==="clippingAncestors"?MD(n)?[]:ewe(n,this._c):[].concat(i),s],T=_[0],w=_.reduce((C,O)=>{const k=lY(n,O,l);return C.top=R_(k.top,C.top),C.right=Kv(k.right,C.right),C.bottom=Kv(k.bottom,C.bottom),C.left=R_(k.left,C.left),C},lY(n,T,l));return{width:w.right-w.left,height:w.bottom-w.top,x:w.left,y:w.top}}function nwe(a){const{width:n,height:i}=eQ(a);return{width:n,height:i}}function rwe(a,n,i){const s=Bu(n),l=Gu(n),p=i==="fixed",_=L_(a,!0,p,n);let T={scrollLeft:0,scrollTop:0};const w=Vu(0);function C(){w.x=rU(l)}if(s||!s&&!p)if((lS(n)!=="body"||AR(l))&&(T=jD(n)),s){const Y=L_(n,!0,p,n);w.x=Y.x+n.clientLeft,w.y=Y.y+n.clientTop}else l&&C();p&&!s&&l&&C();const O=l&&!s&&!p?nQ(l,T):Vu(0),k=_.left+T.scrollLeft-w.x-O.x,U=_.top+T.scrollTop-w.y-O.y;return{x:k,y:U,width:_.width,height:_.height}}function gM(a){return kl(a).position==="static"}function dY(a,n){if(!Bu(a)||kl(a).position==="fixed")return null;if(n)return n(a);let i=a.offsetParent;return Gu(a)===i&&(i=i.ownerDocument.body),i}function iQ(a,n){const i=Fc(a);if(MD(a))return i;if(!Bu(a)){let l=im(a);for(;l&&!qv(l);){if(Mo(l)&&!gM(l))return l;l=im(l)}return i}let s=dY(a,n);for(;s&&fbe(s)&&gM(s);)s=dY(s,n);return s&&qv(s)&&gM(s)&&!Jj(s)?i:s||ybe(a)||i}const iwe=async function(a){const n=this.getOffsetParent||iQ,i=this.getDimensions,s=await i(a.floating);return{reference:rwe(a.reference,await n(a.floating),a.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function swe(a){return kl(a).direction==="rtl"}const awe={convertOffsetParentRelativeRectToViewportRelativeRect:Kbe,getDocumentElement:Gu,getClippingRect:twe,getOffsetParent:iQ,getElementRects:iwe,getClientRects:Xbe,getDimensions:nwe,getScale:Pv,isElement:Mo,isRTL:swe};function sQ(a,n){return a.x===n.x&&a.y===n.y&&a.width===n.width&&a.height===n.height}function owe(a,n){let i=null,s;const l=Gu(a);function p(){var T;clearTimeout(s),(T=i)==null||T.disconnect(),i=null}function _(T,w){T===void 0&&(T=!1),w===void 0&&(w=1),p();const C=a.getBoundingClientRect(),{left:O,top:k,width:U,height:Y}=C;if(T||n(),!U||!Y)return;const W=oN(k),ee=oN(l.clientWidth-(O+U)),K=oN(l.clientHeight-(k+Y)),ie=oN(O),ue={rootMargin:-W+"px "+-ee+"px "+-K+"px "+-ie+"px",threshold:R_(0,Kv(1,w))||1};let ye=!0;function ae(ve){const $=ve[0].intersectionRatio;if($!==w){if(!ye)return _();$?_(!1,$):s=setTimeout(()=>{_(!1,1e-7)},1e3)}$===1&&!sQ(C,a.getBoundingClientRect())&&_(),ye=!1}try{i=new IntersectionObserver(ae,{...ue,root:l.ownerDocument})}catch{i=new IntersectionObserver(ae,ue)}i.observe(a)}return _(!0),p}function cwe(a,n,i,s){s===void 0&&(s={});const{ancestorScroll:l=!0,ancestorResize:p=!0,elementResize:_=typeof ResizeObserver=="function",layoutShift:T=typeof IntersectionObserver=="function",animationFrame:w=!1}=s,C=nU(a),O=l||p?[...C?pR(C):[],...pR(n)]:[];O.forEach(ie=>{l&&ie.addEventListener("scroll",i,{passive:!0}),p&&ie.addEventListener("resize",i)});const k=C&&T?owe(C,i):null;let U=-1,Y=null;_&&(Y=new ResizeObserver(ie=>{let[se]=ie;se&&se.target===C&&Y&&(Y.unobserve(n),cancelAnimationFrame(U),U=requestAnimationFrame(()=>{var ue;(ue=Y)==null||ue.observe(n)})),i()}),C&&!w&&Y.observe(C),Y.observe(n));let W,ee=w?L_(a):null;w&&K();function K(){const ie=L_(a);ee&&!sQ(ee,ie)&&i(),ee=ie,W=requestAnimationFrame(K)}return i(),()=>{var ie;O.forEach(se=>{l&&se.removeEventListener("scroll",i),p&&se.removeEventListener("resize",i)}),k==null||k(),(ie=Y)==null||ie.disconnect(),Y=null,w&&cancelAnimationFrame(W)}}const lwe=zbe,dwe=Hbe,uY=Bbe,uwe=(a,n,i)=>{const s=new Map,l={platform:awe,...i},p={...l.platform,_c:s};return Vbe(a,n,{...l,platform:p})};var hwe=typeof document<"u",pwe=function(){},sO=hwe?F.useLayoutEffect:pwe;function qO(a,n){if(a===n)return!0;if(typeof a!=typeof n)return!1;if(typeof a=="function"&&a.toString()===n.toString())return!0;let i,s,l;if(a&&n&&typeof a=="object"){if(Array.isArray(a)){if(i=a.length,i!==n.length)return!1;for(s=i;s--!==0;)if(!qO(a[s],n[s]))return!1;return!0}if(l=Object.keys(a),i=l.length,i!==Object.keys(n).length)return!1;for(s=i;s--!==0;)if(!{}.hasOwnProperty.call(n,l[s]))return!1;for(s=i;s--!==0;){const p=l[s];if(!(p==="_owner"&&a.$$typeof)&&!qO(a[p],n[p]))return!1}return!0}return a!==a&&n!==n}function aQ(a){return typeof window>"u"?1:(a.ownerDocument.defaultView||window).devicePixelRatio||1}function hY(a,n){const i=aQ(a);return Math.round(n*i)/i}function _M(a){const n=F.useRef(a);return sO(()=>{n.current=a}),n}function fwe(a){a===void 0&&(a={});const{placement:n="bottom",strategy:i="absolute",middleware:s=[],platform:l,elements:{reference:p,floating:_}={},transform:T=!0,whileElementsMounted:w,open:C}=a,[O,k]=F.useState({x:0,y:0,strategy:i,placement:n,middlewareData:{},isPositioned:!1}),[U,Y]=F.useState(s);qO(U,s)||Y(s);const[W,ee]=F.useState(null),[K,ie]=F.useState(null),se=F.useCallback(Re=>{Re!==ve.current&&(ve.current=Re,ee(Re))},[]),ue=F.useCallback(Re=>{Re!==$.current&&($.current=Re,ie(Re))},[]),ye=p||W,ae=_||K,ve=F.useRef(null),$=F.useRef(null),Q=F.useRef(O),te=w!=null,oe=_M(w),re=_M(l),fe=_M(C),pe=F.useCallback(()=>{if(!ve.current||!$.current)return;const Re={placement:n,strategy:i,middleware:U};re.current&&(Re.platform=re.current),uwe(ve.current,$.current,Re).then(Me=>{const he={...Me,isPositioned:fe.current!==!1};Ne.current&&!qO(Q.current,he)&&(Q.current=he,QY.flushSync(()=>{k(he)}))})},[U,n,i,re,fe]);sO(()=>{C===!1&&Q.current.isPositioned&&(Q.current.isPositioned=!1,k(Re=>({...Re,isPositioned:!1})))},[C]);const Ne=F.useRef(!1);sO(()=>(Ne.current=!0,()=>{Ne.current=!1}),[]),sO(()=>{if(ye&&(ve.current=ye),ae&&($.current=ae),ye&&ae){if(oe.current)return oe.current(ye,ae,pe);pe()}},[ye,ae,pe,oe,te]);const Je=F.useMemo(()=>({reference:ve,floating:$,setReference:se,setFloating:ue}),[se,ue]),be=F.useMemo(()=>({reference:ye,floating:ae}),[ye,ae]),Ie=F.useMemo(()=>{const Re={position:i,left:0,top:0};if(!be.floating)return Re;const Me=hY(be.floating,O.x),he=hY(be.floating,O.y);return T?{...Re,transform:"translate("+Me+"px, "+he+"px)",...aQ(be.floating)>=1.5&&{willChange:"transform"}}:{position:i,left:Me,top:he}},[i,T,be.floating,O.x,O.y]);return F.useMemo(()=>({...O,update:pe,refs:Je,elements:be,floatingStyles:Ie}),[O,pe,Je,be,Ie])}const mwe=a=>{function n(i){return{}.hasOwnProperty.call(i,"current")}return{name:"arrow",options:a,fn(i){const{element:s,padding:l}=typeof a=="function"?a(i):a;return s&&n(s)?s.current!=null?uY({element:s.current,padding:l}).fn(i):{}:s?uY({element:s,padding:l}).fn(i):{}}}},gwe=(a,n)=>({...lwe(a),options:[a,n]}),_we=(a,n)=>({...dwe(a),options:[a,n]}),Ewe=(a,n)=>({...mwe(a),options:[a,n]}),ywe={...kY};let pY=!1,vwe=0;const fY=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+vwe++;function Swe(){const[a,n]=F.useState(()=>pY?fY():void 0);return YO(()=>{a==null&&n(fY())},[]),F.useEffect(()=>{pY=!0},[]),a}const Twe=ywe.useId,oQ=Twe||Swe,bwe=F.forwardRef(function(n,i){const{context:{placement:s,elements:{floating:l},middlewareData:{arrow:p,shift:_}},width:T=14,height:w=7,tipRadius:C=0,strokeWidth:O=0,staticOffset:k,stroke:U,d:Y,style:{transform:W,...ee}={},...K}=n,ie=oQ(),[se,ue]=F.useState(!1);if(YO(()=>{if(!l)return;kl(l).direction==="rtl"&&ue(!0)},[l]),!l)return null;const[ye,ae]=s.split("-"),ve=ye==="top"||ye==="bottom";let $=k;(ve&&_!=null&&_.x||!ve&&_!=null&&_.y)&&($=null);const Q=O*2,te=Q/2,oe=T/2*(C/-8+1),re=w/2*C/4,fe=!!Y,pe=$&&ae==="end"?"bottom":"top";let Ne=$&&ae==="end"?"right":"left";$&&se&&(Ne=ae==="end"?"left":"right");const Je=(p==null?void 0:p.x)!=null?$||p.x:"",be=(p==null?void 0:p.y)!=null?$||p.y:"",Ie=Y||"M0,0"+(" H"+T)+(" L"+(T-oe)+","+(w-re))+(" Q"+T/2+","+w+" "+oe+","+(w-re))+" Z",Re={top:fe?"rotate(180deg)":"",left:fe?"rotate(90deg)":"rotate(-90deg)",bottom:fe?"":"rotate(180deg)",right:fe?"rotate(-90deg)":"rotate(90deg)"}[ye];return m.jsxs("svg",{...K,"aria-hidden":!0,ref:i,width:fe?T:T+Q,height:T,viewBox:"0 0 "+T+" "+(w>T?w:T),style:{position:"absolute",pointerEvents:"none",[Ne]:Je,[pe]:be,[ye]:ve||fe?"100%":"calc(100% - "+Q/2+"px)",transform:[Re,W].filter(Me=>!!Me).join(" "),...ee},children:[Q>0&&m.jsx("path",{clipPath:"url(#"+ie+")",fill:"none",stroke:U,strokeWidth:Q+(Y?0:1),d:Ie}),m.jsx("path",{stroke:Q&&!Y?K.fill:"none",d:Ie}),m.jsx("clipPath",{id:ie,children:m.jsx("rect",{x:-te,y:te*(fe?-1:1),width:T+Q,height:T})})]})});function wwe(){const a=new Map;return{emit(n,i){var s;(s=a.get(n))==null||s.forEach(l=>l(i))},on(n,i){a.has(n)||a.set(n,new Set),a.get(n).add(i)},off(n,i){var s;(s=a.get(n))==null||s.delete(i)}}}const Rwe=F.createContext(null),Cwe=F.createContext(null),Awe=()=>{var a;return((a=F.useContext(Rwe))==null?void 0:a.id)||null},Iwe=()=>F.useContext(Cwe);function Nwe(a){const{open:n=!1,onOpenChange:i,elements:s}=a,l=oQ(),p=F.useRef({}),[_]=F.useState(()=>wwe()),T=Awe()!=null,[w,C]=F.useState(s.reference),O=Ube((Y,W,ee)=>{p.current.openEvent=Y?W:void 0,_.emit("openchange",{open:Y,event:W,reason:ee,nested:T}),i==null||i(Y,W,ee)}),k=F.useMemo(()=>({setPositionReference:C}),[]),U=F.useMemo(()=>({reference:w||s.reference||null,floating:s.floating||null,domReference:s.reference}),[w,s.reference,s.floating]);return F.useMemo(()=>({dataRef:p,open:n,onOpenChange:O,elements:U,events:_,floatingId:l,refs:k}),[n,O,U,_,l,k])}function Owe(a){a===void 0&&(a={});const{nodeId:n}=a,i=Nwe({...a,elements:{reference:null,floating:null,...a.elements}}),s=a.rootContext||i,l=s.elements,[p,_]=F.useState(null),[T,w]=F.useState(null),O=(l==null?void 0:l.domReference)||p,k=F.useRef(null),U=Iwe();YO(()=>{O&&(k.current=O)},[O]);const Y=fwe({...a,elements:{...l,...T&&{reference:T}}}),W=F.useCallback(ue=>{const ye=Mo(ue)?{getBoundingClientRect:()=>ue.getBoundingClientRect(),getClientRects:()=>ue.getClientRects(),contextElement:ue}:ue;w(ye),Y.refs.setReference(ye)},[Y.refs]),ee=F.useCallback(ue=>{(Mo(ue)||ue===null)&&(k.current=ue,_(ue)),(Mo(Y.refs.reference.current)||Y.refs.reference.current===null||ue!==null&&!Mo(ue))&&Y.refs.setReference(ue)},[Y.refs]),K=F.useMemo(()=>({...Y.refs,setReference:ee,setPositionReference:W,domReference:k}),[Y.refs,ee,W]),ie=F.useMemo(()=>({...Y.elements,domReference:O}),[Y.elements,O]),se=F.useMemo(()=>({...Y,...s,refs:K,elements:ie,nodeId:n}),[Y,K,ie,n,s]);return YO(()=>{s.dataRef.current.floatingContext=se;const ue=U==null?void 0:U.nodesRef.current.find(ye=>ye.id===n);ue&&(ue.context=se)}),F.useMemo(()=>({...Y,context:se,refs:K,elements:ie}),[Y,K,ie,se])}/*!
  react-datepicker v8.4.0
  https://github.com/Hacker0x01/react-datepicker
  Released under the MIT License.
*/var x2=function(n,i){return x2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,l){s.__proto__=l}||function(s,l){for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(s[p]=l[p])},x2(n,i)};function wa(a,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");x2(a,n);function i(){this.constructor=a}a.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}var zr=function(){return zr=Object.assign||function(i){for(var s,l=1,p=arguments.length;l<p;l++){s=arguments[l];for(var _ in s)Object.prototype.hasOwnProperty.call(s,_)&&(i[_]=s[_])}return i},zr.apply(this,arguments)};function Mu(a,n,i){if(i||arguments.length===2)for(var s=0,l=n.length,p;s<l;s++)(p||!(s in n))&&(p||(p=Array.prototype.slice.call(n,0,s)),p[s]=n[s]);return a.concat(p||Array.prototype.slice.call(n))}var Dwe=function(a){var n=a.showTimeSelectOnly,i=n===void 0?!1:n,s=a.showTime,l=s===void 0?!1:s,p=a.className,_=a.children,T=i?"Choose Time":"Choose Date".concat(l?" and Time":"");return Ge.createElement("div",{className:p,role:"dialog","aria-label":T,"aria-modal":"true"},_)},xwe=function(a,n){var i=F.useRef(null),s=F.useRef(a);s.current=a;var l=F.useCallback(function(p){var _,T=p.composed&&p.composedPath&&p.composedPath().find(function(w){return w instanceof Node})||p.target;i.current&&!i.current.contains(T)&&(n&&T instanceof HTMLElement&&T.classList.contains(n)||(_=s.current)===null||_===void 0||_.call(s,p))},[n]);return F.useEffect(function(){return document.addEventListener("mousedown",l),function(){document.removeEventListener("mousedown",l)}},[l]),i},VD=function(a){var n=a.children,i=a.onClickOutside,s=a.className,l=a.containerRef,p=a.style,_=a.ignoreClass,T=xwe(i,_);return Ge.createElement("div",{className:s,style:p,ref:function(w){T.current=w,l&&(l.current=w)}},n)},Vt;(function(a){a.ArrowUp="ArrowUp",a.ArrowDown="ArrowDown",a.ArrowLeft="ArrowLeft",a.ArrowRight="ArrowRight",a.PageUp="PageUp",a.PageDown="PageDown",a.Home="Home",a.End="End",a.Enter="Enter",a.Space=" ",a.Tab="Tab",a.Escape="Escape",a.Backspace="Backspace",a.X="x"})(Vt||(Vt={}));function cQ(){var a=typeof window<"u"?window:globalThis;return a}var NR=12;function ii(a){if(a==null)return new Date;var n=typeof a=="string"?QTe(a):an(a);return FD(n)?n:new Date}function EM(a,n,i,s,l){l===void 0&&(l=ii());for(var p=Qv(i)||Qv(iU()),_=Array.isArray(n)?n:[n],T=0,w=_;T<w.length;T++){var C=w[T],O=WTe(a,C,l,{locale:p});if(FD(O)&&(!s||a===Ji(O,C,i)))return O}return null}function FD(a,n){return UO(a)&&!k_(a,new Date("1/1/1800"))}function Ji(a,n,i){if(i==="en")return nY(a,n,{useAdditionalWeekYearTokens:!0,useAdditionalDayOfYearTokens:!0});var s=i?Qv(i):void 0;return i&&!s&&console.warn('A locale object was not found for the provided string ["'.concat(i,'"].')),s=s||Qv(iU()),nY(a,n,{locale:s,useAdditionalWeekYearTokens:!0,useAdditionalDayOfYearTokens:!0})}function Ol(a,n){var i=n.dateFormat,s=n.locale,l=Array.isArray(i)&&i.length>0?i[0]:i;return a&&Ji(a,l,s)||""}var lQ=" - ";function Pwe(a,n,i){if(!a)return"";var s=Ol(a,i),l=n?Ol(n,i):"";return"".concat(s).concat(lQ).concat(l)}function kwe(a,n){if(!(a!=null&&a.length))return"";var i=a[0]?Ol(a[0],n):"";if(a.length===1)return i;if(a.length===2&&a[1]){var s=Ol(a[1],n);return"".concat(i,", ").concat(s)}var l=a.length-1;return"".concat(i," (+").concat(l,")")}function yM(a,n){var i=n.hour,s=i===void 0?0:i,l=n.minute,p=l===void 0?0:l,_=n.second,T=_===void 0?0:_;return nO(rO(iO(a,T),p),s)}function Lwe(a){return Kj(a)}function Mwe(a,n){return Ji(a,"ddd",n)}function aO(a){return P_(a)}function Xf(a,n,i){var s=Qv(n||iU());return fp(a,{locale:s,weekStartsOn:i})}function ap(a){return FX(a)}function Lw(a){return kD(a)}function mY(a){return A2(a)}function gY(){return P_(ii())}function _Y(a){return UX(a)}function jwe(a){return Qve(a)}function Uwe(a){return VX(a)}function Du(a,n){return a&&n?KTe(a,n):!a&&!n}function ko(a,n){return a&&n?YTe(a,n):!a&&!n}function KO(a,n){return a&&n?qTe(a,n):!a&&!n}function Wr(a,n){return a&&n?Kve(a,n):!a&&!n}function __(a,n){return a&&n?XSe(a,n):!a&&!n}function Mw(a,n,i){var s,l=P_(n),p=UX(i);try{s=hR(a,{start:l,end:p})}catch{s=!1}return s}function iU(){var a=cQ();return a.__localeId__}function Qv(a){if(typeof a=="string"){var n=cQ();return n.__localeData__?n.__localeData__[a]:void 0}else return a}function Vwe(a,n,i){return n(Ji(a,"EEEE",i))}function Fwe(a,n){return Ji(a,"EEEEEE",n)}function Bwe(a,n){return Ji(a,"EEE",n)}function sU(a,n){return Ji(Dl(ii(),a),"LLLL",n)}function dQ(a,n){return Ji(Dl(ii(),a),"LLL",n)}function Hwe(a,n){return Ji(Cv(ii(),a),"QQQ",n)}function xl(a,n){var i=n===void 0?{}:n,s=i.minDate,l=i.maxDate,p=i.excludeDates,_=i.excludeDateIntervals,T=i.includeDates,w=i.includeDateIntervals,C=i.filterDate;return OR(a,{minDate:s,maxDate:l})||p&&p.some(function(O){return O instanceof Date?Wr(a,O):Wr(a,O.date)})||_&&_.some(function(O){var k=O.start,U=O.end;return hR(a,{start:k,end:U})})||T&&!T.some(function(O){return Wr(a,O)})||w&&!w.some(function(O){var k=O.start,U=O.end;return hR(a,{start:k,end:U})})||C&&!C(ii(a))||!1}function aU(a,n){var i=n===void 0?{}:n,s=i.excludeDates,l=i.excludeDateIntervals;return l&&l.length>0?l.some(function(p){var _=p.start,T=p.end;return hR(a,{start:_,end:T})}):s&&s.some(function(p){var _;return p instanceof Date?Wr(a,p):Wr(a,(_=p.date)!==null&&_!==void 0?_:new Date)})||!1}function uQ(a,n){var i=n===void 0?{}:n,s=i.minDate,l=i.maxDate,p=i.excludeDates,_=i.includeDates,T=i.filterDate;return OR(a,{minDate:s?FX(s):void 0,maxDate:l?VX(l):void 0})||(p==null?void 0:p.some(function(w){return ko(a,w instanceof Date?w:w.date)}))||_&&!_.some(function(w){return ko(a,w)})||T&&!T(ii(a))||!1}function cN(a,n,i,s){var l=fr(a),p=ho(a),_=fr(n),T=ho(n),w=fr(s);return l===_&&l===w?p<=i&&i<=T:l<_?w===l&&p<=i||w===_&&T>=i||w<_&&w>l:!1}function Gwe(a,n){var i=n===void 0?{}:n,s=i.minDate,l=i.maxDate,p=i.excludeDates,_=i.includeDates;return OR(a,{minDate:s,maxDate:l})||p&&p.some(function(T){return ko(T instanceof Date?T:T.date,a)})||_&&!_.some(function(T){return ko(T,a)})||!1}function lN(a,n){var i=n===void 0?{}:n,s=i.minDate,l=i.maxDate,p=i.excludeDates,_=i.includeDates,T=i.filterDate;return OR(a,{minDate:s,maxDate:l})||(p==null?void 0:p.some(function(w){return KO(a,w instanceof Date?w:w.date)}))||_&&!_.some(function(w){return KO(a,w)})||T&&!T(ii(a))||!1}function dN(a,n,i){if(!n||!i||!UO(n)||!UO(i))return!1;var s=fr(n),l=fr(i);return s<=a&&l>=a}function oO(a,n){var i=n===void 0?{}:n,s=i.minDate,l=i.maxDate,p=i.excludeDates,_=i.includeDates,T=i.filterDate,w=new Date(a,0,1);return OR(w,{minDate:s?kD(s):void 0,maxDate:l?BX(l):void 0})||(p==null?void 0:p.some(function(C){return Du(w,C instanceof Date?C:C.date)}))||_&&!_.some(function(C){return Du(w,C)})||T&&!T(ii(w))||!1}function uN(a,n,i,s){var l=fr(a),p=b_(a),_=fr(n),T=b_(n),w=fr(s);return l===_&&l===w?p<=i&&i<=T:l<_?w===l&&p<=i||w===_&&T>=i||w<_&&w>l:!1}function OR(a,n){var i,s=n===void 0?{}:n,l=s.minDate,p=s.maxDate;return(i=l&&zv(a,l)<0||p&&zv(a,p)>0)!==null&&i!==void 0?i:!1}function EY(a,n){return n.some(function(i){return ip(i)===ip(a)&&sp(i)===sp(a)&&Kf(i)===Kf(a)})}function yY(a,n){var i=n===void 0?{}:n,s=i.excludeTimes,l=i.includeTimes,p=i.filterTime;return s&&EY(a,s)||l&&!EY(a,l)||p&&!p(a)||!1}function vY(a,n){var i=n.minTime,s=n.maxTime;if(!i||!s)throw new Error("Both minTime and maxTime props required");var l=ii();l=nO(l,ip(a)),l=rO(l,sp(a)),l=iO(l,Kf(a));var p=ii();p=nO(p,ip(i)),p=rO(p,sp(i)),p=iO(p,Kf(i));var _=ii();_=nO(_,ip(s)),_=rO(_,sp(s)),_=iO(_,Kf(s));var T;try{T=!hR(l,{start:p,end:_})}catch{T=!1}return T}function SY(a,n){var i=n===void 0?{}:n,s=i.minDate,l=i.includeDates,p=w_(a,1);return s&&VO(s,p)>0||l&&l.every(function(_){return VO(_,p)>0})||!1}function TY(a,n){var i=n===void 0?{}:n,s=i.maxDate,l=i.includeDates,p=wd(a,1);return s&&VO(p,s)>0||l&&l.every(function(_){return VO(p,_)>0})||!1}function Wwe(a,n){var i=n===void 0?{}:n,s=i.minDate,l=i.includeDates,p=kD(a),_=QX(p);return s&&FO(s,_)>0||l&&l.every(function(T){return FO(T,_)>0})||!1}function zwe(a,n){var i=n===void 0?{}:n,s=i.maxDate,l=i.includeDates,p=BX(a),_=qj(p,1);return s&&FO(_,s)>0||l&&l.every(function(T){return FO(_,T)>0})||!1}function bY(a,n){var i=n===void 0?{}:n,s=i.minDate,l=i.includeDates,p=Yv(a,1);return s&&BO(s,p)>0||l&&l.every(function(_){return BO(_,p)>0})||!1}function Ywe(a,n){var i=n===void 0?{}:n,s=i.minDate,l=i.yearItemNumber,p=l===void 0?NR:l,_=Lw(Yv(a,p)),T=Hf(_,p).endPeriod,w=s&&fr(s);return w&&w>T||!1}function wY(a,n){var i=n===void 0?{}:n,s=i.maxDate,l=i.includeDates,p=np(a,1);return s&&BO(p,s)>0||l&&l.every(function(_){return BO(p,_)>0})||!1}function qwe(a,n){var i=n===void 0?{}:n,s=i.maxDate,l=i.yearItemNumber,p=l===void 0?NR:l,_=np(a,p),T=Hf(_,p).startPeriod,w=s&&fr(s);return w&&w<T||!1}function hQ(a){var n=a.minDate,i=a.includeDates;if(i&&n){var s=i.filter(function(l){return zv(l,n)>=0});return Qz(s)}else return i?Qz(i):n}function pQ(a){var n=a.maxDate,i=a.includeDates;if(i&&n){var s=i.filter(function(l){return zv(l,n)<=0});return Xz(s)}else return i?Xz(i):n}function RY(a,n){var i;a===void 0&&(a=[]),n===void 0&&(n="react-datepicker__day--highlighted");for(var s=new Map,l=0,p=a.length;l<p;l++){var _=a[l];if(rp(_)){var T=Ji(_,"MM.dd.yyyy"),w=s.get(T)||[];w.includes(n)||(w.push(n),s.set(T,w))}else if(typeof _=="object"){var C=Object.keys(_),O=(i=C[0])!==null&&i!==void 0?i:"",k=_[O];if(typeof O=="string"&&Array.isArray(k))for(var U=0,Y=k.length;U<Y;U++){var W=k[U];if(W){var T=Ji(W,"MM.dd.yyyy"),w=s.get(T)||[];w.includes(O)||(w.push(O),s.set(T,w))}}}}return s}function Kwe(a,n){return a.length!==n.length?!1:a.every(function(i,s){return i===n[s]})}function Xwe(a,n){a===void 0&&(a=[]),n===void 0&&(n="react-datepicker__day--holidays");var i=new Map;return a.forEach(function(s){var l=s.date,p=s.holidayName;if(rp(l)){var _=Ji(l,"MM.dd.yyyy"),T=i.get(_)||{className:"",holidayNames:[]};if(!("className"in T&&T.className===n&&Kwe(T.holidayNames,[p]))){T.className=n;var w=T.holidayNames;T.holidayNames=w?Mu(Mu([],w,!0),[p],!1):[p],i.set(_,T)}}}),i}function Qwe(a,n,i,s,l){for(var p=l.length,_=[],T=0;T<p;T++){var w=a,C=l[T];C&&(w=Wve(w,ip(C)),w=C2(w,sp(C)),w=qve(w,Kf(C)));var O=C2(a,(i+1)*s);rm(w,n)&&k_(w,O)&&C!=null&&_.push(C)}return _}function CY(a){return a<10?"0".concat(a):"".concat(a)}function Hf(a,n){n===void 0&&(n=NR);var i=Math.ceil(fr(a)/n)*n,s=i-(n-1);return{startPeriod:s,endPeriod:i}}function $we(a){var n=new Date(a.getFullYear(),a.getMonth(),a.getDate()),i=new Date(a.getFullYear(),a.getMonth(),a.getDate(),24);return Math.round((+i-+n)/36e5)}function AY(a){var n=a.getSeconds(),i=a.getMilliseconds();return an(a.getTime()-n*1e3-i)}function Jwe(a,n){return AY(a).getTime()===AY(n).getTime()}function IY(a){if(!rp(a))throw new Error("Invalid date");var n=new Date(a);return n.setHours(0,0,0,0),n}function NY(a,n){if(!rp(a)||!rp(n))throw new Error("Invalid date received");var i=IY(a),s=IY(n);return k_(i,s)}function fQ(a){return a.key===Vt.Space}var Zwe=function(a){wa(n,a);function n(i){var s=a.call(this,i)||this;return s.inputRef=Ge.createRef(),s.onTimeChange=function(l){var p,_;s.setState({time:l});var T=s.props.date,w=T instanceof Date&&!isNaN(+T),C=w?T:new Date;if(l!=null&&l.includes(":")){var O=l.split(":"),k=O[0],U=O[1];C.setHours(Number(k)),C.setMinutes(Number(U))}(_=(p=s.props).onChange)===null||_===void 0||_.call(p,C)},s.renderTimeInput=function(){var l=s.state.time,p=s.props,_=p.date,T=p.timeString,w=p.customTimeInput;return w?F.cloneElement(w,{date:_,value:l,onChange:s.onTimeChange}):Ge.createElement("input",{type:"time",className:"react-datepicker-time__input",placeholder:"Time",name:"time-input",ref:s.inputRef,onClick:function(){var C;(C=s.inputRef.current)===null||C===void 0||C.focus()},required:!0,value:l,onChange:function(C){s.onTimeChange(C.target.value||T)}})},s.state={time:s.props.timeString},s}return n.getDerivedStateFromProps=function(i,s){return i.timeString!==s.time?{time:i.timeString}:null},n.prototype.render=function(){return Ge.createElement("div",{className:"react-datepicker__input-time-container"},Ge.createElement("div",{className:"react-datepicker-time__caption"},this.props.timeInputLabel),Ge.createElement("div",{className:"react-datepicker-time__input-container"},Ge.createElement("div",{className:"react-datepicker-time__input"},this.renderTimeInput())))},n}(F.Component),eRe=function(a){wa(n,a);function n(){var i=a!==null&&a.apply(this,arguments)||this;return i.dayEl=F.createRef(),i.handleClick=function(s){!i.isDisabled()&&i.props.onClick&&i.props.onClick(s)},i.handleMouseEnter=function(s){!i.isDisabled()&&i.props.onMouseEnter&&i.props.onMouseEnter(s)},i.handleOnKeyDown=function(s){var l,p,_=s.key;_===Vt.Space&&(s.preventDefault(),s.key=Vt.Enter),(p=(l=i.props).handleOnKeyDown)===null||p===void 0||p.call(l,s)},i.isSameDay=function(s){return Wr(i.props.day,s)},i.isKeyboardSelected=function(){var s;if(i.props.disabledKeyboardNavigation)return!1;var l=i.props.selectsMultiple?(s=i.props.selectedDates)===null||s===void 0?void 0:s.some(function(_){return i.isSameDayOrWeek(_)}):i.isSameDayOrWeek(i.props.selected),p=i.props.preSelection&&i.isDisabled(i.props.preSelection);return!l&&i.isSameDayOrWeek(i.props.preSelection)&&!p},i.isDisabled=function(s){return s===void 0&&(s=i.props.day),xl(s,{minDate:i.props.minDate,maxDate:i.props.maxDate,excludeDates:i.props.excludeDates,excludeDateIntervals:i.props.excludeDateIntervals,includeDateIntervals:i.props.includeDateIntervals,includeDates:i.props.includeDates,filterDate:i.props.filterDate})},i.isExcluded=function(){return aU(i.props.day,{excludeDates:i.props.excludeDates,excludeDateIntervals:i.props.excludeDateIntervals})},i.isStartOfWeek=function(){return Wr(i.props.day,Xf(i.props.day,i.props.locale,i.props.calendarStartDay))},i.isSameWeek=function(s){return i.props.showWeekPicker&&Wr(s,Xf(i.props.day,i.props.locale,i.props.calendarStartDay))},i.isSameDayOrWeek=function(s){return i.isSameDay(s)||i.isSameWeek(s)},i.getHighLightedClass=function(){var s=i.props,l=s.day,p=s.highlightDates;if(!p)return!1;var _=Ji(l,"MM.dd.yyyy");return p.get(_)},i.getHolidaysClass=function(){var s,l=i.props,p=l.day,_=l.holidays;if(!_)return[void 0];var T=Ji(p,"MM.dd.yyyy");return _.has(T)?[(s=_.get(T))===null||s===void 0?void 0:s.className]:[void 0]},i.isInRange=function(){var s=i.props,l=s.day,p=s.startDate,_=s.endDate;return!p||!_?!1:Mw(l,p,_)},i.isInSelectingRange=function(){var s,l=i.props,p=l.day,_=l.selectsStart,T=l.selectsEnd,w=l.selectsRange,C=l.selectsDisabledDaysInRange,O=l.startDate,k=l.endDate,U=(s=i.props.selectingDate)!==null&&s!==void 0?s:i.props.preSelection;return!(_||T||w)||!U||!C&&i.isDisabled()?!1:_&&k&&(k_(U,k)||__(U,k))?Mw(p,U,k):T&&O&&(rm(U,O)||__(U,O))||w&&O&&!k&&(rm(U,O)||__(U,O))?Mw(p,O,U):!1},i.isSelectingRangeStart=function(){var s;if(!i.isInSelectingRange())return!1;var l=i.props,p=l.day,_=l.startDate,T=l.selectsStart,w=(s=i.props.selectingDate)!==null&&s!==void 0?s:i.props.preSelection;return T?Wr(p,w):Wr(p,_)},i.isSelectingRangeEnd=function(){var s;if(!i.isInSelectingRange())return!1;var l=i.props,p=l.day,_=l.endDate,T=l.selectsEnd,w=l.selectsRange,C=(s=i.props.selectingDate)!==null&&s!==void 0?s:i.props.preSelection;return T||w?Wr(p,C):Wr(p,_)},i.isRangeStart=function(){var s=i.props,l=s.day,p=s.startDate,_=s.endDate;return!p||!_?!1:Wr(p,l)},i.isRangeEnd=function(){var s=i.props,l=s.day,p=s.startDate,_=s.endDate;return!p||!_?!1:Wr(_,l)},i.isWeekend=function(){var s=zSe(i.props.day);return s===0||s===6},i.isAfterMonth=function(){return i.props.month!==void 0&&(i.props.month+1)%12===ho(i.props.day)},i.isBeforeMonth=function(){return i.props.month!==void 0&&(ho(i.props.day)+1)%12===i.props.month},i.isCurrentDay=function(){return i.isSameDay(ii())},i.isSelected=function(){var s;return i.props.selectsMultiple?(s=i.props.selectedDates)===null||s===void 0?void 0:s.some(function(l){return i.isSameDayOrWeek(l)}):i.isSameDayOrWeek(i.props.selected)},i.getClassNames=function(s){var l=i.props.dayClassName?i.props.dayClassName(s):void 0;return $i("react-datepicker__day",l,"react-datepicker__day--"+Mwe(i.props.day),{"react-datepicker__day--disabled":i.isDisabled(),"react-datepicker__day--excluded":i.isExcluded(),"react-datepicker__day--selected":i.isSelected(),"react-datepicker__day--keyboard-selected":i.isKeyboardSelected(),"react-datepicker__day--range-start":i.isRangeStart(),"react-datepicker__day--range-end":i.isRangeEnd(),"react-datepicker__day--in-range":i.isInRange(),"react-datepicker__day--in-selecting-range":i.isInSelectingRange(),"react-datepicker__day--selecting-range-start":i.isSelectingRangeStart(),"react-datepicker__day--selecting-range-end":i.isSelectingRangeEnd(),"react-datepicker__day--today":i.isCurrentDay(),"react-datepicker__day--weekend":i.isWeekend(),"react-datepicker__day--outside-month":i.isAfterMonth()||i.isBeforeMonth()},i.getHighLightedClass(),i.getHolidaysClass())},i.getAriaLabel=function(){var s=i.props,l=s.day,p=s.ariaLabelPrefixWhenEnabled,_=p===void 0?"Choose":p,T=s.ariaLabelPrefixWhenDisabled,w=T===void 0?"Not available":T,C=i.isDisabled()||i.isExcluded()?w:_;return"".concat(C," ").concat(Ji(l,"PPPP",i.props.locale))},i.getTitle=function(){var s=i.props,l=s.day,p=s.holidays,_=p===void 0?new Map:p,T=s.excludeDates,w=Ji(l,"MM.dd.yyyy"),C=[];return _.has(w)&&C.push.apply(C,_.get(w).holidayNames),i.isExcluded()&&C.push(T==null?void 0:T.filter(function(O){return O instanceof Date?Wr(O,l):Wr(O==null?void 0:O.date,l)}).map(function(O){if(!(O instanceof Date))return O==null?void 0:O.message})),C.join(", ")},i.getTabIndex=function(){var s=i.props.selected,l=i.props.preSelection,p=!(i.props.showWeekPicker&&(i.props.showWeekNumber||!i.isStartOfWeek()))&&(i.isKeyboardSelected()||i.isSameDay(s)&&Wr(l,s))?0:-1;return p},i.handleFocusDay=function(){var s;i.shouldFocusDay()&&((s=i.dayEl.current)===null||s===void 0||s.focus({preventScroll:!0}))},i.renderDayContents=function(){return i.props.monthShowsDuplicateDaysEnd&&i.isAfterMonth()||i.props.monthShowsDuplicateDaysStart&&i.isBeforeMonth()?null:i.props.renderDayContents?i.props.renderDayContents(rY(i.props.day),i.props.day):rY(i.props.day)},i.render=function(){return Ge.createElement("div",{ref:i.dayEl,className:i.getClassNames(i.props.day),onKeyDown:i.handleOnKeyDown,onClick:i.handleClick,onMouseEnter:i.props.usePointerEvent?void 0:i.handleMouseEnter,onPointerEnter:i.props.usePointerEvent?i.handleMouseEnter:void 0,tabIndex:i.getTabIndex(),"aria-label":i.getAriaLabel(),role:"option",title:i.getTitle(),"aria-disabled":i.isDisabled(),"aria-current":i.isCurrentDay()?"date":void 0,"aria-selected":i.isSelected()||i.isInRange()},i.renderDayContents(),i.getTitle()!==""&&Ge.createElement("span",{className:"overlay"},i.getTitle()))},i}return n.prototype.componentDidMount=function(){this.handleFocusDay()},n.prototype.componentDidUpdate=function(){this.handleFocusDay()},n.prototype.shouldFocusDay=function(){var i=!1;return this.getTabIndex()===0&&this.isSameDay(this.props.preSelection)&&((!document.activeElement||document.activeElement===document.body)&&(i=!0),this.props.inline&&!this.props.shouldFocusDayInline&&(i=!1),this.isDayActiveElement()&&(i=!0),this.isDuplicateDay()&&(i=!1)),i},n.prototype.isDayActiveElement=function(){var i,s,l;return((s=(i=this.props.containerRef)===null||i===void 0?void 0:i.current)===null||s===void 0?void 0:s.contains(document.activeElement))&&((l=document.activeElement)===null||l===void 0?void 0:l.classList.contains("react-datepicker__day"))},n.prototype.isDuplicateDay=function(){return this.props.monthShowsDuplicateDaysEnd&&this.isAfterMonth()||this.props.monthShowsDuplicateDaysStart&&this.isBeforeMonth()},n}(F.Component),tRe=function(a){wa(n,a);function n(){var i=a!==null&&a.apply(this,arguments)||this;return i.weekNumberEl=F.createRef(),i.handleClick=function(s){i.props.onClick&&i.props.onClick(s)},i.handleOnKeyDown=function(s){var l,p,_=s.key;_===Vt.Space&&(s.preventDefault(),s.key=Vt.Enter),(p=(l=i.props).handleOnKeyDown)===null||p===void 0||p.call(l,s)},i.isKeyboardSelected=function(){return!i.props.disabledKeyboardNavigation&&!Wr(i.props.date,i.props.selected)&&Wr(i.props.date,i.props.preSelection)},i.getTabIndex=function(){return i.props.showWeekPicker&&i.props.showWeekNumber&&(i.isKeyboardSelected()||Wr(i.props.date,i.props.selected)&&Wr(i.props.preSelection,i.props.selected))?0:-1},i.handleFocusWeekNumber=function(s){var l=!1;i.getTabIndex()===0&&!(s!=null&&s.isInputFocused)&&Wr(i.props.date,i.props.preSelection)&&((!document.activeElement||document.activeElement===document.body)&&(l=!0),i.props.inline&&!i.props.shouldFocusDayInline&&(l=!1),i.props.containerRef&&i.props.containerRef.current&&i.props.containerRef.current.contains(document.activeElement)&&document.activeElement&&document.activeElement.classList.contains("react-datepicker__week-number")&&(l=!0)),l&&i.weekNumberEl.current&&i.weekNumberEl.current.focus({preventScroll:!0})},i}return Object.defineProperty(n,"defaultProps",{get:function(){return{ariaLabelPrefix:"week "}},enumerable:!1,configurable:!0}),n.prototype.componentDidMount=function(){this.handleFocusWeekNumber()},n.prototype.componentDidUpdate=function(i){this.handleFocusWeekNumber(i)},n.prototype.render=function(){var i=this.props,s=i.weekNumber,l=i.isWeekDisabled,p=i.ariaLabelPrefix,_=p===void 0?n.defaultProps.ariaLabelPrefix:p,T=i.onClick,w={"react-datepicker__week-number":!0,"react-datepicker__week-number--clickable":!!T&&!l,"react-datepicker__week-number--selected":!!T&&Wr(this.props.date,this.props.selected)};return Ge.createElement("div",{ref:this.weekNumberEl,className:$i(w),"aria-label":"".concat(_," ").concat(this.props.weekNumber),onClick:this.handleClick,onKeyDown:this.handleOnKeyDown,tabIndex:this.getTabIndex()},s)},n}(F.Component),nRe=function(a){wa(n,a);function n(){var i=a!==null&&a.apply(this,arguments)||this;return i.isDisabled=function(s){return xl(s,{minDate:i.props.minDate,maxDate:i.props.maxDate,excludeDates:i.props.excludeDates,excludeDateIntervals:i.props.excludeDateIntervals,includeDateIntervals:i.props.includeDateIntervals,includeDates:i.props.includeDates,filterDate:i.props.filterDate})},i.handleDayClick=function(s,l){i.props.onDayClick&&i.props.onDayClick(s,l)},i.handleDayMouseEnter=function(s){i.props.onDayMouseEnter&&i.props.onDayMouseEnter(s)},i.handleWeekClick=function(s,l,p){for(var _,T,w,C=new Date(s),O=0;O<7;O++){var k=new Date(s);k.setDate(k.getDate()+O);var U=!i.isDisabled(k);if(U){C=k;break}}typeof i.props.onWeekSelect=="function"&&i.props.onWeekSelect(C,l,p),i.props.showWeekPicker&&i.handleDayClick(C,p),((_=i.props.shouldCloseOnSelect)!==null&&_!==void 0?_:n.defaultProps.shouldCloseOnSelect)&&((w=(T=i.props).setOpen)===null||w===void 0||w.call(T,!1))},i.formatWeekNumber=function(s){return i.props.formatWeekNumber?i.props.formatWeekNumber(s):Lwe(s)},i.isWeekDisabled=function(){for(var s=i.startOfWeek(),l=Sd(s,6),p=new Date(s);p<=l;){if(!i.isDisabled(p))return!1;p=Sd(p,1)}return!0},i.renderDays=function(){var s=i.startOfWeek(),l=[],p=i.formatWeekNumber(s);if(i.props.showWeekNumber){var _=i.props.onWeekSelect||i.props.showWeekPicker?i.handleWeekClick.bind(i,s,p):void 0;l.push(Ge.createElement(tRe,zr({key:"W"},n.defaultProps,i.props,{weekNumber:p,isWeekDisabled:i.isWeekDisabled(),date:s,onClick:_})))}return l.concat([0,1,2,3,4,5,6].map(function(T){var w=Sd(s,T);return Ge.createElement(eRe,zr({},n.defaultProps,i.props,{ariaLabelPrefixWhenEnabled:i.props.chooseDayAriaLabelPrefix,ariaLabelPrefixWhenDisabled:i.props.disabledDayAriaLabelPrefix,key:w.valueOf(),day:w,onClick:i.handleDayClick.bind(i,w),onMouseEnter:i.handleDayMouseEnter.bind(i,w)}))}))},i.startOfWeek=function(){return Xf(i.props.day,i.props.locale,i.props.calendarStartDay)},i.isKeyboardSelected=function(){return!i.props.disabledKeyboardNavigation&&!Wr(i.startOfWeek(),i.props.selected)&&Wr(i.startOfWeek(),i.props.preSelection)},i}return Object.defineProperty(n,"defaultProps",{get:function(){return{shouldCloseOnSelect:!0}},enumerable:!1,configurable:!0}),n.prototype.render=function(){var i={"react-datepicker__week":!0,"react-datepicker__week--selected":Wr(this.startOfWeek(),this.props.selected),"react-datepicker__week--keyboard-selected":this.isKeyboardSelected()};return Ge.createElement("div",{className:$i(i)},this.renderDays())},n}(F.Component),Aw,rRe=6,kv={TWO_COLUMNS:"two_columns",THREE_COLUMNS:"three_columns",FOUR_COLUMNS:"four_columns"},vM=(Aw={},Aw[kv.TWO_COLUMNS]={grid:[[0,1],[2,3],[4,5],[6,7],[8,9],[10,11]],verticalNavigationOffset:2},Aw[kv.THREE_COLUMNS]={grid:[[0,1,2],[3,4,5],[6,7,8],[9,10,11]],verticalNavigationOffset:3},Aw[kv.FOUR_COLUMNS]={grid:[[0,1,2,3],[4,5,6,7],[8,9,10,11]],verticalNavigationOffset:4},Aw),hN=1;function OY(a,n){return a?kv.FOUR_COLUMNS:n?kv.TWO_COLUMNS:kv.THREE_COLUMNS}var iRe=function(a){wa(n,a);function n(){var i=a!==null&&a.apply(this,arguments)||this;return i.MONTH_REFS=Mu([],Array(12),!0).map(function(){return F.createRef()}),i.QUARTER_REFS=Mu([],Array(4),!0).map(function(){return F.createRef()}),i.isDisabled=function(s){return xl(s,{minDate:i.props.minDate,maxDate:i.props.maxDate,excludeDates:i.props.excludeDates,excludeDateIntervals:i.props.excludeDateIntervals,includeDateIntervals:i.props.includeDateIntervals,includeDates:i.props.includeDates,filterDate:i.props.filterDate})},i.isExcluded=function(s){return aU(s,{excludeDates:i.props.excludeDates,excludeDateIntervals:i.props.excludeDateIntervals})},i.handleDayClick=function(s,l){var p,_;(_=(p=i.props).onDayClick)===null||_===void 0||_.call(p,s,l,i.props.orderInDisplay)},i.handleDayMouseEnter=function(s){var l,p;(p=(l=i.props).onDayMouseEnter)===null||p===void 0||p.call(l,s)},i.handleMouseLeave=function(){var s,l;(l=(s=i.props).onMouseLeave)===null||l===void 0||l.call(s)},i.isRangeStartMonth=function(s){var l=i.props,p=l.day,_=l.startDate,T=l.endDate;return!_||!T?!1:ko(Dl(p,s),_)},i.isRangeStartQuarter=function(s){var l=i.props,p=l.day,_=l.startDate,T=l.endDate;return!_||!T?!1:KO(Cv(p,s),_)},i.isRangeEndMonth=function(s){var l=i.props,p=l.day,_=l.startDate,T=l.endDate;return!_||!T?!1:ko(Dl(p,s),T)},i.isRangeEndQuarter=function(s){var l=i.props,p=l.day,_=l.startDate,T=l.endDate;return!_||!T?!1:KO(Cv(p,s),T)},i.isInSelectingRangeMonth=function(s){var l,p=i.props,_=p.day,T=p.selectsStart,w=p.selectsEnd,C=p.selectsRange,O=p.startDate,k=p.endDate,U=(l=i.props.selectingDate)!==null&&l!==void 0?l:i.props.preSelection;return!(T||w||C)||!U?!1:T&&k?cN(U,k,s,_):w&&O||C&&O&&!k?cN(O,U,s,_):!1},i.isSelectingMonthRangeStart=function(s){var l;if(!i.isInSelectingRangeMonth(s))return!1;var p=i.props,_=p.day,T=p.startDate,w=p.selectsStart,C=Dl(_,s),O=(l=i.props.selectingDate)!==null&&l!==void 0?l:i.props.preSelection;return w?ko(C,O):ko(C,T)},i.isSelectingMonthRangeEnd=function(s){var l;if(!i.isInSelectingRangeMonth(s))return!1;var p=i.props,_=p.day,T=p.endDate,w=p.selectsEnd,C=p.selectsRange,O=Dl(_,s),k=(l=i.props.selectingDate)!==null&&l!==void 0?l:i.props.preSelection;return w||C?ko(O,k):ko(O,T)},i.isInSelectingRangeQuarter=function(s){var l,p=i.props,_=p.day,T=p.selectsStart,w=p.selectsEnd,C=p.selectsRange,O=p.startDate,k=p.endDate,U=(l=i.props.selectingDate)!==null&&l!==void 0?l:i.props.preSelection;return!(T||w||C)||!U?!1:T&&k?uN(U,k,s,_):w&&O||C&&O&&!k?uN(O,U,s,_):!1},i.isWeekInMonth=function(s){var l=i.props.day,p=Sd(s,6);return ko(s,l)||ko(p,l)},i.isCurrentMonth=function(s,l){return fr(s)===fr(ii())&&l===ho(ii())},i.isCurrentQuarter=function(s,l){return fr(s)===fr(ii())&&l===b_(ii())},i.isSelectedMonth=function(s,l,p){return ho(p)===l&&fr(s)===fr(p)},i.isSelectMonthInList=function(s,l,p){return p.some(function(_){return i.isSelectedMonth(s,l,_)})},i.isSelectedQuarter=function(s,l,p){return b_(s)===l&&fr(s)===fr(p)},i.isMonthSelected=function(){var s=i.props,l=s.day,p=s.selected,_=s.selectedDates,T=s.selectsMultiple,w=ho(l);return T?_==null?void 0:_.some(function(C){return i.isSelectedMonth(l,w,C)}):!!p&&i.isSelectedMonth(l,w,p)},i.renderWeeks=function(){for(var s=[],l=i.props.fixedHeight,p=0,_=!1,T=Xf(ap(i.props.day),i.props.locale,i.props.calendarStartDay),w=function(W){return i.props.showWeekPicker?Xf(W,i.props.locale,i.props.calendarStartDay):i.props.preSelection},C=function(W){return i.props.showWeekPicker?Xf(W,i.props.locale,i.props.calendarStartDay):i.props.selected},O=i.props.selected?C(i.props.selected):void 0,k=i.props.preSelection?w(i.props.preSelection):void 0;s.push(Ge.createElement(nRe,zr({},i.props,{ariaLabelPrefix:i.props.weekAriaLabelPrefix,key:p,day:T,month:ho(i.props.day),onDayClick:i.handleDayClick,onDayMouseEnter:i.handleDayMouseEnter,selected:O,preSelection:k,showWeekNumber:i.props.showWeekNumbers}))),!_;){p++,T=jO(T,1);var U=l&&p>=rRe,Y=!l&&!i.isWeekInMonth(T);if(U||Y)if(i.props.peekNextMonth)_=!0;else break}return s},i.onMonthClick=function(s,l){var p=i.isMonthDisabledForLabelDate(l),_=p.isDisabled,T=p.labelDate;_||i.handleDayClick(ap(T),s)},i.onMonthMouseEnter=function(s){var l=i.isMonthDisabledForLabelDate(s),p=l.isDisabled,_=l.labelDate;p||i.handleDayMouseEnter(ap(_))},i.handleMonthNavigation=function(s,l){var p,_,T,w;(_=(p=i.props).setPreSelection)===null||_===void 0||_.call(p,l),(w=(T=i.MONTH_REFS[s])===null||T===void 0?void 0:T.current)===null||w===void 0||w.focus()},i.handleKeyboardNavigation=function(s,l,p){var _,T=i.props,w=T.selected,C=T.preSelection,O=T.setPreSelection,k=T.minDate,U=T.maxDate,Y=T.showFourColumnMonthYearPicker,W=T.showTwoColumnMonthYearPicker;if(C){var ee=OY(Y,W),K=i.getVerticalOffset(ee),ie=(_=vM[ee])===null||_===void 0?void 0:_.grid,se=function($,Q,te){var oe,re,fe=Q,pe=te;switch($){case Vt.ArrowRight:fe=wd(Q,hN),pe=te===11?0:te+hN;break;case Vt.ArrowLeft:fe=w_(Q,hN),pe=te===0?11:te-hN;break;case Vt.ArrowUp:fe=w_(Q,K),pe=!((oe=ie==null?void 0:ie[0])===null||oe===void 0)&&oe.includes(te)?te+12-K:te-K;break;case Vt.ArrowDown:fe=wd(Q,K),pe=!((re=ie==null?void 0:ie[ie.length-1])===null||re===void 0)&&re.includes(te)?te-12+K:te+K;break}return{newCalculatedDate:fe,newCalculatedMonth:pe}},ue=function($,Q,te){for(var oe=40,re=$,fe=!1,pe=0,Ne=se(re,Q,te),Je=Ne.newCalculatedDate,be=Ne.newCalculatedMonth;!fe;){if(pe>=oe){Je=Q,be=te;break}if(k&&Je<k){re=Vt.ArrowRight;var Ie=se(re,Je,be);Je=Ie.newCalculatedDate,be=Ie.newCalculatedMonth}if(U&&Je>U){re=Vt.ArrowLeft;var Ie=se(re,Je,be);Je=Ie.newCalculatedDate,be=Ie.newCalculatedMonth}if(Gwe(Je,i.props)){var Ie=se(re,Je,be);Je=Ie.newCalculatedDate,be=Ie.newCalculatedMonth}else fe=!0;pe++}return{newCalculatedDate:Je,newCalculatedMonth:be}};if(l===Vt.Enter){i.isMonthDisabled(p)||(i.onMonthClick(s,p),O==null||O(w));return}var ye=ue(l,C,p),ae=ye.newCalculatedDate,ve=ye.newCalculatedMonth;switch(l){case Vt.ArrowRight:case Vt.ArrowLeft:case Vt.ArrowUp:case Vt.ArrowDown:i.handleMonthNavigation(ve,ae);break}}},i.getVerticalOffset=function(s){var l,p;return(p=(l=vM[s])===null||l===void 0?void 0:l.verticalNavigationOffset)!==null&&p!==void 0?p:0},i.onMonthKeyDown=function(s,l){var p=i.props,_=p.disabledKeyboardNavigation,T=p.handleOnMonthKeyDown,w=s.key;w!==Vt.Tab&&s.preventDefault(),_||i.handleKeyboardNavigation(s,w,l),T&&T(s)},i.onQuarterClick=function(s,l){var p=Cv(i.props.day,l);lN(p,i.props)||i.handleDayClick(mY(p),s)},i.onQuarterMouseEnter=function(s){var l=Cv(i.props.day,s);lN(l,i.props)||i.handleDayMouseEnter(mY(l))},i.handleQuarterNavigation=function(s,l){var p,_,T,w;i.isDisabled(l)||i.isExcluded(l)||((_=(p=i.props).setPreSelection)===null||_===void 0||_.call(p,l),(w=(T=i.QUARTER_REFS[s-1])===null||T===void 0?void 0:T.current)===null||w===void 0||w.focus())},i.onQuarterKeyDown=function(s,l){var p,_,T=s.key;if(!i.props.disabledKeyboardNavigation)switch(T){case Vt.Enter:i.onQuarterClick(s,l),(_=(p=i.props).setPreSelection)===null||_===void 0||_.call(p,i.props.selected);break;case Vt.ArrowRight:if(!i.props.preSelection)break;i.handleQuarterNavigation(l===4?1:l+1,qj(i.props.preSelection,1));break;case Vt.ArrowLeft:if(!i.props.preSelection)break;i.handleQuarterNavigation(l===1?4:l-1,QX(i.props.preSelection));break}},i.isMonthDisabledForLabelDate=function(s){var l,p=i.props,_=p.day,T=p.minDate,w=p.maxDate,C=p.excludeDates,O=p.includeDates,k=Dl(_,s);return{isDisabled:(l=(T||w||C||O)&&uQ(k,i.props))!==null&&l!==void 0?l:!1,labelDate:k}},i.isMonthDisabled=function(s){var l=i.isMonthDisabledForLabelDate(s).isDisabled;return l},i.getMonthClassNames=function(s){var l=i.props,p=l.day,_=l.startDate,T=l.endDate,w=l.preSelection,C=l.monthClassName,O=C?C(Dl(p,s)):void 0,k=i.getSelection();return $i("react-datepicker__month-text","react-datepicker__month-".concat(s),O,{"react-datepicker__month-text--disabled":i.isMonthDisabled(s),"react-datepicker__month-text--selected":k?i.isSelectMonthInList(p,s,k):void 0,"react-datepicker__month-text--keyboard-selected":!i.props.disabledKeyboardNavigation&&w&&i.isSelectedMonth(p,s,w)&&!i.isMonthSelected()&&!i.isMonthDisabled(s),"react-datepicker__month-text--in-selecting-range":i.isInSelectingRangeMonth(s),"react-datepicker__month-text--in-range":_&&T?cN(_,T,s,p):void 0,"react-datepicker__month-text--range-start":i.isRangeStartMonth(s),"react-datepicker__month-text--range-end":i.isRangeEndMonth(s),"react-datepicker__month-text--selecting-range-start":i.isSelectingMonthRangeStart(s),"react-datepicker__month-text--selecting-range-end":i.isSelectingMonthRangeEnd(s),"react-datepicker__month-text--today":i.isCurrentMonth(p,s)})},i.getTabIndex=function(s){if(i.props.preSelection==null)return"-1";var l=ho(i.props.preSelection),p=i.isMonthDisabledForLabelDate(l).isDisabled,_=s===l&&!(p||i.props.disabledKeyboardNavigation)?"0":"-1";return _},i.getQuarterTabIndex=function(s){if(i.props.preSelection==null)return"-1";var l=b_(i.props.preSelection),p=lN(i.props.day,i.props),_=s===l&&!(p||i.props.disabledKeyboardNavigation)?"0":"-1";return _},i.getAriaLabel=function(s){var l=i.props,p=l.chooseDayAriaLabelPrefix,_=p===void 0?"Choose":p,T=l.disabledDayAriaLabelPrefix,w=T===void 0?"Not available":T,C=l.day,O=l.locale,k=Dl(C,s),U=i.isDisabled(k)||i.isExcluded(k)?w:_;return"".concat(U," ").concat(Ji(k,"MMMM yyyy",O))},i.getQuarterClassNames=function(s){var l=i.props,p=l.day,_=l.startDate,T=l.endDate,w=l.selected,C=l.minDate,O=l.maxDate,k=l.excludeDates,U=l.includeDates,Y=l.filterDate,W=l.preSelection,ee=l.disabledKeyboardNavigation,K=(C||O||k||U||Y)&&lN(Cv(p,s),i.props);return $i("react-datepicker__quarter-text","react-datepicker__quarter-".concat(s),{"react-datepicker__quarter-text--disabled":K,"react-datepicker__quarter-text--selected":w?i.isSelectedQuarter(p,s,w):void 0,"react-datepicker__quarter-text--keyboard-selected":!ee&&W&&i.isSelectedQuarter(p,s,W)&&!K,"react-datepicker__quarter-text--in-selecting-range":i.isInSelectingRangeQuarter(s),"react-datepicker__quarter-text--in-range":_&&T?uN(_,T,s,p):void 0,"react-datepicker__quarter-text--range-start":i.isRangeStartQuarter(s),"react-datepicker__quarter-text--range-end":i.isRangeEndQuarter(s),"react-datepicker__quarter-text--today":i.isCurrentQuarter(p,s)})},i.getMonthContent=function(s){var l=i.props,p=l.showFullMonthYearPicker,_=l.renderMonthContent,T=l.locale,w=l.day,C=dQ(s,T),O=sU(s,T);return _?_(s,C,O,w):p?O:C},i.getQuarterContent=function(s){var l,p=i.props,_=p.renderQuarterContent,T=p.locale,w=Hwe(s,T);return(l=_==null?void 0:_(s,w))!==null&&l!==void 0?l:w},i.renderMonths=function(){var s,l=i.props,p=l.showTwoColumnMonthYearPicker,_=l.showFourColumnMonthYearPicker,T=l.day,w=l.selected,C=(s=vM[OY(_,p)])===null||s===void 0?void 0:s.grid;return C==null?void 0:C.map(function(O,k){return Ge.createElement("div",{className:"react-datepicker__month-wrapper",key:k},O.map(function(U,Y){return Ge.createElement("div",{ref:i.MONTH_REFS[U],key:Y,onClick:function(W){i.onMonthClick(W,U)},onKeyDown:function(W){fQ(W)&&(W.preventDefault(),W.key=Vt.Enter),i.onMonthKeyDown(W,U)},onMouseEnter:i.props.usePointerEvent?void 0:function(){return i.onMonthMouseEnter(U)},onPointerEnter:i.props.usePointerEvent?function(){return i.onMonthMouseEnter(U)}:void 0,tabIndex:Number(i.getTabIndex(U)),className:i.getMonthClassNames(U),"aria-disabled":i.isMonthDisabled(U),role:"option","aria-label":i.getAriaLabel(U),"aria-current":i.isCurrentMonth(T,U)?"date":void 0,"aria-selected":w?i.isSelectedMonth(T,U,w):void 0},i.getMonthContent(U))}))})},i.renderQuarters=function(){var s=i.props,l=s.day,p=s.selected,_=[1,2,3,4];return Ge.createElement("div",{className:"react-datepicker__quarter-wrapper"},_.map(function(T,w){return Ge.createElement("div",{key:w,ref:i.QUARTER_REFS[w],role:"option",onClick:function(C){i.onQuarterClick(C,T)},onKeyDown:function(C){i.onQuarterKeyDown(C,T)},onMouseEnter:i.props.usePointerEvent?void 0:function(){return i.onQuarterMouseEnter(T)},onPointerEnter:i.props.usePointerEvent?function(){return i.onQuarterMouseEnter(T)}:void 0,className:i.getQuarterClassNames(T),"aria-selected":p?i.isSelectedQuarter(l,T,p):void 0,tabIndex:Number(i.getQuarterTabIndex(T)),"aria-current":i.isCurrentQuarter(l,T)?"date":void 0},i.getQuarterContent(T))}))},i.getClassNames=function(){var s=i.props,l=s.selectingDate,p=s.selectsStart,_=s.selectsEnd,T=s.showMonthYearPicker,w=s.showQuarterYearPicker,C=s.showWeekPicker;return $i("react-datepicker__month",{"react-datepicker__month--selecting-range":l&&(p||_)},{"react-datepicker__monthPicker":T},{"react-datepicker__quarterPicker":w},{"react-datepicker__weekPicker":C})},i}return n.prototype.getSelection=function(){var i=this.props,s=i.selected,l=i.selectedDates,p=i.selectsMultiple;if(p)return l;if(s)return[s]},n.prototype.render=function(){var i=this.props,s=i.showMonthYearPicker,l=i.showQuarterYearPicker,p=i.day,_=i.ariaLabelPrefix,T=_===void 0?"Month ":_,w=T?T.trim()+" ":"";return Ge.createElement("div",{className:this.getClassNames(),onMouseLeave:this.props.usePointerEvent?void 0:this.handleMouseLeave,onPointerLeave:this.props.usePointerEvent?this.handleMouseLeave:void 0,"aria-label":"".concat(w).concat(Ji(p,"MMMM, yyyy",this.props.locale)),role:"listbox"},s?this.renderMonths():l?this.renderQuarters():this.renderWeeks())},n}(F.Component),sRe=function(a){wa(n,a);function n(){var i=a!==null&&a.apply(this,arguments)||this;return i.isSelectedMonth=function(s){return i.props.month===s},i.renderOptions=function(){return i.props.monthNames.map(function(s,l){return Ge.createElement("div",{className:i.isSelectedMonth(l)?"react-datepicker__month-option react-datepicker__month-option--selected_month":"react-datepicker__month-option",key:s,onClick:i.onChange.bind(i,l),"aria-selected":i.isSelectedMonth(l)?"true":void 0},i.isSelectedMonth(l)?Ge.createElement("span",{className:"react-datepicker__month-option--selected"},""):"",s)})},i.onChange=function(s){return i.props.onChange(s)},i.handleClickOutside=function(){return i.props.onCancel()},i}return n.prototype.render=function(){return Ge.createElement(VD,{className:"react-datepicker__month-dropdown",onClickOutside:this.handleClickOutside},this.renderOptions())},n}(F.Component),aRe=function(a){wa(n,a);function n(){var i=a!==null&&a.apply(this,arguments)||this;return i.state={dropdownVisible:!1},i.renderSelectOptions=function(s){return s.map(function(l,p){return Ge.createElement("option",{key:l,value:p},l)})},i.renderSelectMode=function(s){return Ge.createElement("select",{value:i.props.month,className:"react-datepicker__month-select",onChange:function(l){return i.onChange(parseInt(l.target.value))}},i.renderSelectOptions(s))},i.renderReadView=function(s,l){return Ge.createElement("div",{key:"read",style:{visibility:s?"visible":"hidden"},className:"react-datepicker__month-read-view",onClick:i.toggleDropdown},Ge.createElement("span",{className:"react-datepicker__month-read-view--down-arrow"}),Ge.createElement("span",{className:"react-datepicker__month-read-view--selected-month"},l[i.props.month]))},i.renderDropdown=function(s){return Ge.createElement(sRe,zr({key:"dropdown"},i.props,{monthNames:s,onChange:i.onChange,onCancel:i.toggleDropdown}))},i.renderScrollMode=function(s){var l=i.state.dropdownVisible,p=[i.renderReadView(!l,s)];return l&&p.unshift(i.renderDropdown(s)),p},i.onChange=function(s){i.toggleDropdown(),s!==i.props.month&&i.props.onChange(s)},i.toggleDropdown=function(){return i.setState({dropdownVisible:!i.state.dropdownVisible})},i}return n.prototype.render=function(){var i=this,s=[0,1,2,3,4,5,6,7,8,9,10,11].map(this.props.useShortMonthInDropdown?function(p){return dQ(p,i.props.locale)}:function(p){return sU(p,i.props.locale)}),l;switch(this.props.dropdownMode){case"scroll":l=this.renderScrollMode(s);break;case"select":l=this.renderSelectMode(s);break}return Ge.createElement("div",{className:"react-datepicker__month-dropdown-container react-datepicker__month-dropdown-container--".concat(this.props.dropdownMode)},l)},n}(F.Component);function oRe(a,n){for(var i=[],s=ap(a),l=ap(n);!rm(s,l);)i.push(ii(s)),s=wd(s,1);return i}var cRe=function(a){wa(n,a);function n(i){var s=a.call(this,i)||this;return s.renderOptions=function(){return s.state.monthYearsList.map(function(l){var p=N2(l),_=Du(s.props.date,l)&&ko(s.props.date,l);return Ge.createElement("div",{className:_?"react-datepicker__month-year-option--selected_month-year":"react-datepicker__month-year-option",key:p,onClick:s.onChange.bind(s,p),"aria-selected":_?"true":void 0},_?Ge.createElement("span",{className:"react-datepicker__month-year-option--selected"},""):"",Ji(l,s.props.dateFormat,s.props.locale))})},s.onChange=function(l){return s.props.onChange(l)},s.handleClickOutside=function(){s.props.onCancel()},s.state={monthYearsList:oRe(s.props.minDate,s.props.maxDate)},s}return n.prototype.render=function(){var i=$i({"react-datepicker__month-year-dropdown":!0,"react-datepicker__month-year-dropdown--scrollable":this.props.scrollableMonthYearDropdown});return Ge.createElement(VD,{className:i,onClickOutside:this.handleClickOutside},this.renderOptions())},n}(F.Component),lRe=function(a){wa(n,a);function n(){var i=a!==null&&a.apply(this,arguments)||this;return i.state={dropdownVisible:!1},i.renderSelectOptions=function(){for(var s=ap(i.props.minDate),l=ap(i.props.maxDate),p=[];!rm(s,l);){var _=N2(s);p.push(Ge.createElement("option",{key:_,value:_},Ji(s,i.props.dateFormat,i.props.locale))),s=wd(s,1)}return p},i.onSelectChange=function(s){i.onChange(parseInt(s.target.value))},i.renderSelectMode=function(){return Ge.createElement("select",{value:N2(ap(i.props.date)),className:"react-datepicker__month-year-select",onChange:i.onSelectChange},i.renderSelectOptions())},i.renderReadView=function(s){var l=Ji(i.props.date,i.props.dateFormat,i.props.locale);return Ge.createElement("div",{key:"read",style:{visibility:s?"visible":"hidden"},className:"react-datepicker__month-year-read-view",onClick:i.toggleDropdown},Ge.createElement("span",{className:"react-datepicker__month-year-read-view--down-arrow"}),Ge.createElement("span",{className:"react-datepicker__month-year-read-view--selected-month-year"},l))},i.renderDropdown=function(){return Ge.createElement(cRe,zr({key:"dropdown"},i.props,{onChange:i.onChange,onCancel:i.toggleDropdown}))},i.renderScrollMode=function(){var s=i.state.dropdownVisible,l=[i.renderReadView(!s)];return s&&l.unshift(i.renderDropdown()),l},i.onChange=function(s){i.toggleDropdown();var l=ii(s);Du(i.props.date,l)&&ko(i.props.date,l)||i.props.onChange(l)},i.toggleDropdown=function(){return i.setState({dropdownVisible:!i.state.dropdownVisible})},i}return n.prototype.render=function(){var i;switch(this.props.dropdownMode){case"scroll":i=this.renderScrollMode();break;case"select":i=this.renderSelectMode();break}return Ge.createElement("div",{className:"react-datepicker__month-year-dropdown-container react-datepicker__month-year-dropdown-container--".concat(this.props.dropdownMode)},i)},n}(F.Component),dRe=function(a){wa(n,a);function n(){var i=a!==null&&a.apply(this,arguments)||this;return i.state={height:null},i.scrollToTheSelectedTime=function(){requestAnimationFrame(function(){var s,l,p;i.list&&(i.list.scrollTop=(p=i.centerLi&&n.calcCenterPosition(i.props.monthRef?i.props.monthRef.clientHeight-((l=(s=i.header)===null||s===void 0?void 0:s.clientHeight)!==null&&l!==void 0?l:0):i.list.clientHeight,i.centerLi))!==null&&p!==void 0?p:0)})},i.handleClick=function(s){var l,p;(i.props.minTime||i.props.maxTime)&&vY(s,i.props)||(i.props.excludeTimes||i.props.includeTimes||i.props.filterTime)&&yY(s,i.props)||(p=(l=i.props).onChange)===null||p===void 0||p.call(l,s)},i.isSelectedTime=function(s){return i.props.selected&&Jwe(i.props.selected,s)},i.isDisabledTime=function(s){return(i.props.minTime||i.props.maxTime)&&vY(s,i.props)||(i.props.excludeTimes||i.props.includeTimes||i.props.filterTime)&&yY(s,i.props)},i.liClasses=function(s){var l,p=["react-datepicker__time-list-item",i.props.timeClassName?i.props.timeClassName(s):void 0];return i.isSelectedTime(s)&&p.push("react-datepicker__time-list-item--selected"),i.isDisabledTime(s)&&p.push("react-datepicker__time-list-item--disabled"),i.props.injectTimes&&(ip(s)*3600+sp(s)*60+Kf(s))%(((l=i.props.intervals)!==null&&l!==void 0?l:n.defaultProps.intervals)*60)!==0&&p.push("react-datepicker__time-list-item--injected"),p.join(" ")},i.handleOnKeyDown=function(s,l){var p,_;s.key===Vt.Space&&(s.preventDefault(),s.key=Vt.Enter),(s.key===Vt.ArrowUp||s.key===Vt.ArrowLeft)&&s.target instanceof HTMLElement&&s.target.previousSibling&&(s.preventDefault(),s.target.previousSibling instanceof HTMLElement&&s.target.previousSibling.focus()),(s.key===Vt.ArrowDown||s.key===Vt.ArrowRight)&&s.target instanceof HTMLElement&&s.target.nextSibling&&(s.preventDefault(),s.target.nextSibling instanceof HTMLElement&&s.target.nextSibling.focus()),s.key===Vt.Enter&&i.handleClick(l),(_=(p=i.props).handleOnKeyDown)===null||_===void 0||_.call(p,s)},i.renderTimes=function(){for(var s,l=[],p=typeof i.props.format=="string"?i.props.format:"p",_=(s=i.props.intervals)!==null&&s!==void 0?s:n.defaultProps.intervals,T=i.props.selected||i.props.openToDate||ii(),w=aO(T),C=i.props.injectTimes&&i.props.injectTimes.sort(function(K,ie){return K.getTime()-ie.getTime()}),O=60*$we(T),k=O/_,U=0;U<k;U++){var Y=C2(w,U*_);if(l.push(Y),C){var W=Qwe(w,Y,U,_,C);l=l.concat(W)}}var ee=l.reduce(function(K,ie){return ie.getTime()<=T.getTime()?ie:K},l[0]);return l.map(function(K){return Ge.createElement("li",{key:K.valueOf(),onClick:i.handleClick.bind(i,K),className:i.liClasses(K),ref:function(ie){K===ee&&(i.centerLi=ie)},onKeyDown:function(ie){i.handleOnKeyDown(ie,K)},tabIndex:K===ee?0:-1,role:"option","aria-selected":i.isSelectedTime(K)?"true":void 0,"aria-disabled":i.isDisabledTime(K)?"true":void 0},Ji(K,p,i.props.locale))})},i.renderTimeCaption=function(){return i.props.showTimeCaption===!1?Ge.createElement(Ge.Fragment,null):Ge.createElement("div",{className:"react-datepicker__header react-datepicker__header--time ".concat(i.props.showTimeSelectOnly?"react-datepicker__header--time--only":""),ref:function(s){i.header=s}},Ge.createElement("div",{className:"react-datepicker-time__header"},i.props.timeCaption))},i}return Object.defineProperty(n,"defaultProps",{get:function(){return{intervals:30,todayButton:null,timeCaption:"Time",showTimeCaption:!0}},enumerable:!1,configurable:!0}),n.prototype.componentDidMount=function(){this.scrollToTheSelectedTime(),this.observeDatePickerHeightChanges()},n.prototype.componentWillUnmount=function(){var i;(i=this.resizeObserver)===null||i===void 0||i.disconnect()},n.prototype.observeDatePickerHeightChanges=function(){var i=this,s=this.props.monthRef;this.updateContainerHeight(),s&&(this.resizeObserver=new ResizeObserver(function(){i.updateContainerHeight()}),this.resizeObserver.observe(s))},n.prototype.updateContainerHeight=function(){this.props.monthRef&&this.header&&this.setState({height:this.props.monthRef.clientHeight-this.header.clientHeight})},n.prototype.render=function(){var i=this,s,l=this.state.height;return Ge.createElement("div",{className:"react-datepicker__time-container ".concat(((s=this.props.todayButton)!==null&&s!==void 0?s:n.defaultProps.todayButton)?"react-datepicker__time-container--with-today-button":"")},this.renderTimeCaption(),Ge.createElement("div",{className:"react-datepicker__time"},Ge.createElement("div",{className:"react-datepicker__time-box"},Ge.createElement("ul",{className:"react-datepicker__time-list",ref:function(p){i.list=p},style:l?{height:l}:{},role:"listbox","aria-label":this.props.timeCaption},this.renderTimes()))))},n.calcCenterPosition=function(i,s){return s.offsetTop-(i/2-s.clientHeight/2)},n}(F.Component),DY=3,uRe=function(a){wa(n,a);function n(i){var s=a.call(this,i)||this;return s.YEAR_REFS=Mu([],Array(s.props.yearItemNumber),!0).map(function(){return F.createRef()}),s.isDisabled=function(l){return xl(l,{minDate:s.props.minDate,maxDate:s.props.maxDate,excludeDates:s.props.excludeDates,includeDates:s.props.includeDates,filterDate:s.props.filterDate})},s.isExcluded=function(l){return aU(l,{excludeDates:s.props.excludeDates})},s.selectingDate=function(){var l;return(l=s.props.selectingDate)!==null&&l!==void 0?l:s.props.preSelection},s.updateFocusOnPaginate=function(l){var p=function(){var _,T;(T=(_=s.YEAR_REFS[l])===null||_===void 0?void 0:_.current)===null||T===void 0||T.focus()};window.requestAnimationFrame(p)},s.handleYearClick=function(l,p){s.props.onDayClick&&s.props.onDayClick(l,p)},s.handleYearNavigation=function(l,p){var _,T,w,C,O=s.props,k=O.date,U=O.yearItemNumber;if(!(k===void 0||U===void 0)){var Y=Hf(k,U).startPeriod;s.isDisabled(p)||s.isExcluded(p)||((T=(_=s.props).setPreSelection)===null||T===void 0||T.call(_,p),l-Y<0?s.updateFocusOnPaginate(U-(Y-l)):l-Y>=U?s.updateFocusOnPaginate(Math.abs(U-(l-Y))):(C=(w=s.YEAR_REFS[l-Y])===null||w===void 0?void 0:w.current)===null||C===void 0||C.focus())}},s.isSameDay=function(l,p){return Wr(l,p)},s.isCurrentYear=function(l){return l===fr(ii())},s.isRangeStart=function(l){return s.props.startDate&&s.props.endDate&&Du(Ou(ii(),l),s.props.startDate)},s.isRangeEnd=function(l){return s.props.startDate&&s.props.endDate&&Du(Ou(ii(),l),s.props.endDate)},s.isInRange=function(l){return dN(l,s.props.startDate,s.props.endDate)},s.isInSelectingRange=function(l){var p=s.props,_=p.selectsStart,T=p.selectsEnd,w=p.selectsRange,C=p.startDate,O=p.endDate;return!(_||T||w)||!s.selectingDate()?!1:_&&O?dN(l,s.selectingDate(),O):T&&C||w&&C&&!O?dN(l,C,s.selectingDate()):!1},s.isSelectingRangeStart=function(l){var p;if(!s.isInSelectingRange(l))return!1;var _=s.props,T=_.startDate,w=_.selectsStart,C=Ou(ii(),l);return w?Du(C,(p=s.selectingDate())!==null&&p!==void 0?p:null):Du(C,T??null)},s.isSelectingRangeEnd=function(l){var p;if(!s.isInSelectingRange(l))return!1;var _=s.props,T=_.endDate,w=_.selectsEnd,C=_.selectsRange,O=Ou(ii(),l);return w||C?Du(O,(p=s.selectingDate())!==null&&p!==void 0?p:null):Du(O,T??null)},s.isKeyboardSelected=function(l){if(!(s.props.date===void 0||s.props.selected==null||s.props.preSelection==null)){var p=s.props,_=p.minDate,T=p.maxDate,w=p.excludeDates,C=p.includeDates,O=p.filterDate,k=Lw(Ou(s.props.date,l)),U=(_||T||w||C||O)&&oO(l,s.props);return!s.props.disabledKeyboardNavigation&&!s.props.inline&&!Wr(k,Lw(s.props.selected))&&Wr(k,Lw(s.props.preSelection))&&!U}},s.isSelectedYear=function(l){var p=s.props,_=p.selectsMultiple,T=p.selected,w=p.selectedDates;return _?w==null?void 0:w.some(function(C){return l===fr(C)}):!!T&&l===fr(T)},s.onYearClick=function(l,p){var _=s.props.date;_!==void 0&&s.handleYearClick(Lw(Ou(_,p)),l)},s.onYearKeyDown=function(l,p){var _,T,w=l.key,C=s.props,O=C.date,k=C.yearItemNumber,U=C.handleOnKeyDown;if(w!==Vt.Tab&&l.preventDefault(),!s.props.disabledKeyboardNavigation)switch(w){case Vt.Enter:if(s.props.selected==null)break;s.onYearClick(l,p),(T=(_=s.props).setPreSelection)===null||T===void 0||T.call(_,s.props.selected);break;case Vt.ArrowRight:if(s.props.preSelection==null)break;s.handleYearNavigation(p+1,np(s.props.preSelection,1));break;case Vt.ArrowLeft:if(s.props.preSelection==null)break;s.handleYearNavigation(p-1,Yv(s.props.preSelection,1));break;case Vt.ArrowUp:{if(O===void 0||k===void 0||s.props.preSelection==null)break;var Y=Hf(O,k).startPeriod,W=DY,ee=p-W;if(ee<Y){var K=k%W;p>=Y&&p<Y+K?W=K:W+=K,ee=p-W}s.handleYearNavigation(ee,Yv(s.props.preSelection,W));break}case Vt.ArrowDown:{if(O===void 0||k===void 0||s.props.preSelection==null)break;var ie=Hf(O,k).endPeriod,W=DY,ee=p+W;if(ee>ie){var K=k%W;p<=ie&&p>ie-K?W=K:W+=K,ee=p+W}s.handleYearNavigation(ee,np(s.props.preSelection,W));break}}U&&U(l)},s.getYearClassNames=function(l){var p=s.props,_=p.date,T=p.minDate,w=p.maxDate,C=p.excludeDates,O=p.includeDates,k=p.filterDate,U=p.yearClassName;return $i("react-datepicker__year-text","react-datepicker__year-".concat(l),_?U==null?void 0:U(Ou(_,l)):void 0,{"react-datepicker__year-text--selected":s.isSelectedYear(l),"react-datepicker__year-text--disabled":(T||w||C||O||k)&&oO(l,s.props),"react-datepicker__year-text--keyboard-selected":s.isKeyboardSelected(l),"react-datepicker__year-text--range-start":s.isRangeStart(l),"react-datepicker__year-text--range-end":s.isRangeEnd(l),"react-datepicker__year-text--in-range":s.isInRange(l),"react-datepicker__year-text--in-selecting-range":s.isInSelectingRange(l),"react-datepicker__year-text--selecting-range-start":s.isSelectingRangeStart(l),"react-datepicker__year-text--selecting-range-end":s.isSelectingRangeEnd(l),"react-datepicker__year-text--today":s.isCurrentYear(l)})},s.getYearTabIndex=function(l){if(s.props.disabledKeyboardNavigation||s.props.preSelection==null)return"-1";var p=fr(s.props.preSelection),_=oO(l,s.props);return l===p&&!_?"0":"-1"},s.getYearContent=function(l){return s.props.renderYearContent?s.props.renderYearContent(l):l},s}return n.prototype.render=function(){var i=this,s=[],l=this.props,p=l.date,_=l.yearItemNumber,T=l.onYearMouseEnter,w=l.onYearMouseLeave;if(p===void 0)return null;for(var C=Hf(p,_),O=C.startPeriod,k=C.endPeriod,U=function(ee){s.push(Ge.createElement("div",{ref:Y.YEAR_REFS[ee-O],onClick:function(K){i.onYearClick(K,ee)},onKeyDown:function(K){fQ(K)&&(K.preventDefault(),K.key=Vt.Enter),i.onYearKeyDown(K,ee)},tabIndex:Number(Y.getYearTabIndex(ee)),className:Y.getYearClassNames(ee),onMouseEnter:Y.props.usePointerEvent?void 0:function(K){return T(K,ee)},onPointerEnter:Y.props.usePointerEvent?function(K){return T(K,ee)}:void 0,onMouseLeave:Y.props.usePointerEvent?void 0:function(K){return w(K,ee)},onPointerLeave:Y.props.usePointerEvent?function(K){return w(K,ee)}:void 0,key:ee,"aria-current":Y.isCurrentYear(ee)?"date":void 0},Y.getYearContent(ee)))},Y=this,W=O;W<=k;W++)U(W);return Ge.createElement("div",{className:"react-datepicker__year"},Ge.createElement("div",{className:"react-datepicker__year-wrapper",onMouseLeave:this.props.usePointerEvent?void 0:this.props.clearSelectingDate,onPointerLeave:this.props.usePointerEvent?this.props.clearSelectingDate:void 0},s))},n}(F.Component);function hRe(a,n,i,s){for(var l=[],p=0;p<2*n+1;p++){var _=a+n-p,T=!0;i&&(T=fr(i)<=_),s&&T&&(T=fr(s)>=_),T&&l.push(_)}return l}var pRe=function(a){wa(n,a);function n(i){var s=a.call(this,i)||this;s.renderOptions=function(){var T=s.props.year,w=s.state.yearsList.map(function(k){return Ge.createElement("div",{className:T===k?"react-datepicker__year-option react-datepicker__year-option--selected_year":"react-datepicker__year-option",key:k,onClick:s.onChange.bind(s,k),"aria-selected":T===k?"true":void 0},T===k?Ge.createElement("span",{className:"react-datepicker__year-option--selected"},""):"",k)}),C=s.props.minDate?fr(s.props.minDate):null,O=s.props.maxDate?fr(s.props.maxDate):null;return(!O||!s.state.yearsList.find(function(k){return k===O}))&&w.unshift(Ge.createElement("div",{className:"react-datepicker__year-option",key:"upcoming",onClick:s.incrementYears},Ge.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-upcoming"}))),(!C||!s.state.yearsList.find(function(k){return k===C}))&&w.push(Ge.createElement("div",{className:"react-datepicker__year-option",key:"previous",onClick:s.decrementYears},Ge.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-previous"}))),w},s.onChange=function(T){s.props.onChange(T)},s.handleClickOutside=function(){s.props.onCancel()},s.shiftYears=function(T){var w=s.state.yearsList.map(function(C){return C+T});s.setState({yearsList:w})},s.incrementYears=function(){return s.shiftYears(1)},s.decrementYears=function(){return s.shiftYears(-1)};var l=i.yearDropdownItemNumber,p=i.scrollableYearDropdown,_=l||(p?10:5);return s.state={yearsList:hRe(s.props.year,_,s.props.minDate,s.props.maxDate)},s.dropdownRef=F.createRef(),s}return n.prototype.componentDidMount=function(){var i=this.dropdownRef.current;if(i){var s=i.children?Array.from(i.children):null,l=s?s.find(function(p){return p.ariaSelected}):null;i.scrollTop=l&&l instanceof HTMLElement?l.offsetTop+(l.clientHeight-i.clientHeight)/2:(i.scrollHeight-i.clientHeight)/2}},n.prototype.render=function(){var i=$i({"react-datepicker__year-dropdown":!0,"react-datepicker__year-dropdown--scrollable":this.props.scrollableYearDropdown});return Ge.createElement(VD,{className:i,containerRef:this.dropdownRef,onClickOutside:this.handleClickOutside},this.renderOptions())},n}(F.Component),fRe=function(a){wa(n,a);function n(){var i=a!==null&&a.apply(this,arguments)||this;return i.state={dropdownVisible:!1},i.renderSelectOptions=function(){for(var s=i.props.minDate?fr(i.props.minDate):1900,l=i.props.maxDate?fr(i.props.maxDate):2100,p=[],_=s;_<=l;_++)p.push(Ge.createElement("option",{key:_,value:_},_));return p},i.onSelectChange=function(s){i.onChange(parseInt(s.target.value))},i.renderSelectMode=function(){return Ge.createElement("select",{value:i.props.year,className:"react-datepicker__year-select",onChange:i.onSelectChange},i.renderSelectOptions())},i.renderReadView=function(s){return Ge.createElement("div",{key:"read",style:{visibility:s?"visible":"hidden"},className:"react-datepicker__year-read-view",onClick:function(l){return i.toggleDropdown(l)}},Ge.createElement("span",{className:"react-datepicker__year-read-view--down-arrow"}),Ge.createElement("span",{className:"react-datepicker__year-read-view--selected-year"},i.props.year))},i.renderDropdown=function(){return Ge.createElement(pRe,zr({key:"dropdown"},i.props,{onChange:i.onChange,onCancel:i.toggleDropdown}))},i.renderScrollMode=function(){var s=i.state.dropdownVisible,l=[i.renderReadView(!s)];return s&&l.unshift(i.renderDropdown()),l},i.onChange=function(s){i.toggleDropdown(),s!==i.props.year&&i.props.onChange(s)},i.toggleDropdown=function(s){i.setState({dropdownVisible:!i.state.dropdownVisible},function(){i.props.adjustDateOnChange&&i.handleYearChange(i.props.date,s)})},i.handleYearChange=function(s,l){var p;(p=i.onSelect)===null||p===void 0||p.call(i,s,l),i.setOpen()},i.onSelect=function(s,l){var p,_;(_=(p=i.props).onSelect)===null||_===void 0||_.call(p,s,l)},i.setOpen=function(){var s,l;(l=(s=i.props).setOpen)===null||l===void 0||l.call(s,!0)},i}return n.prototype.render=function(){var i;switch(this.props.dropdownMode){case"scroll":i=this.renderScrollMode();break;case"select":i=this.renderSelectMode();break}return Ge.createElement("div",{className:"react-datepicker__year-dropdown-container react-datepicker__year-dropdown-container--".concat(this.props.dropdownMode)},i)},n}(F.Component),mRe=["react-datepicker__year-select","react-datepicker__month-select","react-datepicker__month-year-select"],gRe=function(a){var n=(a.className||"").split(/\s+/);return mRe.some(function(i){return n.indexOf(i)>=0})},_Re=function(a){wa(n,a);function n(i){var s=a.call(this,i)||this;return s.monthContainer=void 0,s.handleClickOutside=function(l){s.props.onClickOutside(l)},s.setClickOutsideRef=function(){return s.containerRef.current},s.handleDropdownFocus=function(l){var p,_;gRe(l.target)&&((_=(p=s.props).onDropdownFocus)===null||_===void 0||_.call(p,l))},s.getDateInView=function(){var l=s.props,p=l.preSelection,_=l.selected,T=l.openToDate,w=hQ(s.props),C=pQ(s.props),O=ii(),k=T||_||p;return k||(w&&k_(O,w)?w:C&&rm(O,C)?C:O)},s.increaseMonth=function(){s.setState(function(l){var p=l.date;return{date:wd(p,1)}},function(){return s.handleMonthChange(s.state.date)})},s.decreaseMonth=function(){s.setState(function(l){var p=l.date;return{date:w_(p,1)}},function(){return s.handleMonthChange(s.state.date)})},s.handleDayClick=function(l,p,_){s.props.onSelect(l,p,_),s.props.setPreSelection&&s.props.setPreSelection(l)},s.handleDayMouseEnter=function(l){s.setState({selectingDate:l}),s.props.onDayMouseEnter&&s.props.onDayMouseEnter(l)},s.handleMonthMouseLeave=function(){s.setState({selectingDate:void 0}),s.props.onMonthMouseLeave&&s.props.onMonthMouseLeave()},s.handleYearMouseEnter=function(l,p){s.setState({selectingDate:Ou(ii(),p)}),s.props.onYearMouseEnter&&s.props.onYearMouseEnter(l,p)},s.handleYearMouseLeave=function(l,p){s.props.onYearMouseLeave&&s.props.onYearMouseLeave(l,p)},s.handleYearChange=function(l){var p,_,T,w;(_=(p=s.props).onYearChange)===null||_===void 0||_.call(p,l),s.setState({isRenderAriaLiveMessage:!0}),s.props.adjustDateOnChange&&(s.props.onSelect(l),(w=(T=s.props).setOpen)===null||w===void 0||w.call(T,!0)),s.props.setPreSelection&&s.props.setPreSelection(l)},s.getEnabledPreSelectionDateForMonth=function(l){if(!xl(l,s.props))return l;for(var p=ap(l),_=Uwe(l),T=Xve(_,p),w=null,C=0;C<=T;C++){var O=Sd(p,C);if(!xl(O,s.props)){w=O;break}}return w},s.handleMonthChange=function(l){var p,_,T,w=(p=s.getEnabledPreSelectionDateForMonth(l))!==null&&p!==void 0?p:l;s.handleCustomMonthChange(w),s.props.adjustDateOnChange&&(s.props.onSelect(w),(T=(_=s.props).setOpen)===null||T===void 0||T.call(_,!0)),s.props.setPreSelection&&s.props.setPreSelection(w)},s.handleCustomMonthChange=function(l){var p,_;(_=(p=s.props).onMonthChange)===null||_===void 0||_.call(p,l),s.setState({isRenderAriaLiveMessage:!0})},s.handleMonthYearChange=function(l){s.handleYearChange(l),s.handleMonthChange(l)},s.changeYear=function(l){s.setState(function(p){var _=p.date;return{date:Ou(_,Number(l))}},function(){return s.handleYearChange(s.state.date)})},s.changeMonth=function(l){s.setState(function(p){var _=p.date;return{date:Dl(_,Number(l))}},function(){return s.handleMonthChange(s.state.date)})},s.changeMonthYear=function(l){s.setState(function(p){var _=p.date;return{date:Ou(Dl(_,ho(l)),fr(l))}},function(){return s.handleMonthYearChange(s.state.date)})},s.header=function(l){l===void 0&&(l=s.state.date);var p=Xf(l,s.props.locale,s.props.calendarStartDay),_=[];return s.props.showWeekNumbers&&_.push(Ge.createElement("div",{key:"W",className:"react-datepicker__day-name"},s.props.weekLabel||"#")),_.concat([0,1,2,3,4,5,6].map(function(T){var w=Sd(p,T),C=s.formatWeekday(w,s.props.locale),O=s.props.weekDayClassName?s.props.weekDayClassName(w):void 0;return Ge.createElement("div",{key:T,"aria-label":Ji(w,"EEEE",s.props.locale),className:$i("react-datepicker__day-name",O)},C)}))},s.formatWeekday=function(l,p){return s.props.formatWeekDay?Vwe(l,s.props.formatWeekDay,p):s.props.useWeekdaysShort?Bwe(l,p):Fwe(l,p)},s.decreaseYear=function(){s.setState(function(l){var p,_=l.date;return{date:Yv(_,s.props.showYearPicker?(p=s.props.yearItemNumber)!==null&&p!==void 0?p:n.defaultProps.yearItemNumber:1)}},function(){return s.handleYearChange(s.state.date)})},s.clearSelectingDate=function(){s.setState({selectingDate:void 0})},s.renderPreviousButton=function(){var l,p,_;if(!s.props.renderCustomHeader){var T=(l=s.props.monthsShown)!==null&&l!==void 0?l:n.defaultProps.monthsShown,w=s.props.showPreviousMonths?T-1:0,C=(p=s.props.monthSelectedIn)!==null&&p!==void 0?p:w,O=w_(s.state.date,C),k;switch(!0){case s.props.showMonthYearPicker:k=bY(s.state.date,s.props);break;case s.props.showYearPicker:k=Ywe(s.state.date,s.props);break;case s.props.showQuarterYearPicker:k=Wwe(s.state.date,s.props);break;default:k=SY(O,s.props);break}if(!(!((_=s.props.forceShowMonthNavigation)!==null&&_!==void 0?_:n.defaultProps.forceShowMonthNavigation)&&!s.props.showDisabledMonthNavigation&&k||s.props.showTimeSelectOnly)){var U=["react-datepicker__navigation-icon","react-datepicker__navigation-icon--previous"],Y=["react-datepicker__navigation","react-datepicker__navigation--previous"],W=s.decreaseMonth;(s.props.showMonthYearPicker||s.props.showQuarterYearPicker||s.props.showYearPicker)&&(W=s.decreaseYear),k&&s.props.showDisabledMonthNavigation&&(Y.push("react-datepicker__navigation--previous--disabled"),W=void 0);var ee=s.props.showMonthYearPicker||s.props.showQuarterYearPicker||s.props.showYearPicker,K=s.props,ie=K.previousMonthButtonLabel,se=ie===void 0?n.defaultProps.previousMonthButtonLabel:ie,ue=K.previousYearButtonLabel,ye=ue===void 0?n.defaultProps.previousYearButtonLabel:ue,ae=s.props,ve=ae.previousMonthAriaLabel,$=ve===void 0?typeof se=="string"?se:"Previous Month":ve,Q=ae.previousYearAriaLabel,te=Q===void 0?typeof ye=="string"?ye:"Previous Year":Q;return Ge.createElement("button",{type:"button",className:Y.join(" "),onClick:W,onKeyDown:s.props.handleOnKeyDown,"aria-label":ee?te:$},Ge.createElement("span",{className:U.join(" ")},ee?ye:se))}}},s.increaseYear=function(){s.setState(function(l){var p,_=l.date;return{date:np(_,s.props.showYearPicker?(p=s.props.yearItemNumber)!==null&&p!==void 0?p:n.defaultProps.yearItemNumber:1)}},function(){return s.handleYearChange(s.state.date)})},s.renderNextButton=function(){var l;if(!s.props.renderCustomHeader){var p;switch(!0){case s.props.showMonthYearPicker:p=wY(s.state.date,s.props);break;case s.props.showYearPicker:p=qwe(s.state.date,s.props);break;case s.props.showQuarterYearPicker:p=zwe(s.state.date,s.props);break;default:p=TY(s.state.date,s.props);break}if(!(!((l=s.props.forceShowMonthNavigation)!==null&&l!==void 0?l:n.defaultProps.forceShowMonthNavigation)&&!s.props.showDisabledMonthNavigation&&p||s.props.showTimeSelectOnly)){var _=["react-datepicker__navigation","react-datepicker__navigation--next"],T=["react-datepicker__navigation-icon","react-datepicker__navigation-icon--next"];s.props.showTimeSelect&&_.push("react-datepicker__navigation--next--with-time"),s.props.todayButton&&_.push("react-datepicker__navigation--next--with-today-button");var w=s.increaseMonth;(s.props.showMonthYearPicker||s.props.showQuarterYearPicker||s.props.showYearPicker)&&(w=s.increaseYear),p&&s.props.showDisabledMonthNavigation&&(_.push("react-datepicker__navigation--next--disabled"),w=void 0);var C=s.props.showMonthYearPicker||s.props.showQuarterYearPicker||s.props.showYearPicker,O=s.props,k=O.nextMonthButtonLabel,U=k===void 0?n.defaultProps.nextMonthButtonLabel:k,Y=O.nextYearButtonLabel,W=Y===void 0?n.defaultProps.nextYearButtonLabel:Y,ee=s.props,K=ee.nextMonthAriaLabel,ie=K===void 0?typeof U=="string"?U:"Next Month":K,se=ee.nextYearAriaLabel,ue=se===void 0?typeof W=="string"?W:"Next Year":se;return Ge.createElement("button",{type:"button",className:_.join(" "),onClick:w,onKeyDown:s.props.handleOnKeyDown,"aria-label":C?ue:ie},Ge.createElement("span",{className:T.join(" ")},C?W:U))}}},s.renderCurrentMonth=function(l){l===void 0&&(l=s.state.date);var p=["react-datepicker__current-month"];return s.props.showYearDropdown&&p.push("react-datepicker__current-month--hasYearDropdown"),s.props.showMonthDropdown&&p.push("react-datepicker__current-month--hasMonthDropdown"),s.props.showMonthYearDropdown&&p.push("react-datepicker__current-month--hasMonthYearDropdown"),Ge.createElement("h2",{className:p.join(" ")},Ji(l,s.props.dateFormat,s.props.locale))},s.renderYearDropdown=function(l){if(l===void 0&&(l=!1),!(!s.props.showYearDropdown||l))return Ge.createElement(fRe,zr({},n.defaultProps,s.props,{date:s.state.date,onChange:s.changeYear,year:fr(s.state.date)}))},s.renderMonthDropdown=function(l){if(l===void 0&&(l=!1),!(!s.props.showMonthDropdown||l))return Ge.createElement(aRe,zr({},n.defaultProps,s.props,{month:ho(s.state.date),onChange:s.changeMonth}))},s.renderMonthYearDropdown=function(l){if(l===void 0&&(l=!1),!(!s.props.showMonthYearDropdown||l))return Ge.createElement(lRe,zr({},n.defaultProps,s.props,{date:s.state.date,onChange:s.changeMonthYear}))},s.handleTodayButtonClick=function(l){s.props.onSelect(gY(),l),s.props.setPreSelection&&s.props.setPreSelection(gY())},s.renderTodayButton=function(){if(!(!s.props.todayButton||s.props.showTimeSelectOnly))return Ge.createElement("div",{className:"react-datepicker__today-button",onClick:s.handleTodayButtonClick},s.props.todayButton)},s.renderDefaultHeader=function(l){var p=l.monthDate,_=l.i;return Ge.createElement("div",{className:"react-datepicker__header ".concat(s.props.showTimeSelect?"react-datepicker__header--has-time-select":"")},s.renderCurrentMonth(p),Ge.createElement("div",{className:"react-datepicker__header__dropdown react-datepicker__header__dropdown--".concat(s.props.dropdownMode),onFocus:s.handleDropdownFocus},s.renderMonthDropdown(_!==0),s.renderMonthYearDropdown(_!==0),s.renderYearDropdown(_!==0)),Ge.createElement("div",{className:"react-datepicker__day-names"},s.header(p)))},s.renderCustomHeader=function(l){var p,_,T=l.monthDate,w=l.i;if(s.props.showTimeSelect&&!s.state.monthContainer||s.props.showTimeSelectOnly)return null;var C=SY(s.state.date,s.props),O=TY(s.state.date,s.props),k=bY(s.state.date,s.props),U=wY(s.state.date,s.props),Y=!s.props.showMonthYearPicker&&!s.props.showQuarterYearPicker&&!s.props.showYearPicker;return Ge.createElement("div",{className:"react-datepicker__header react-datepicker__header--custom",onFocus:s.props.onDropdownFocus},(_=(p=s.props).renderCustomHeader)===null||_===void 0?void 0:_.call(p,zr(zr({},s.state),{customHeaderCount:w,monthDate:T,changeMonth:s.changeMonth,changeYear:s.changeYear,decreaseMonth:s.decreaseMonth,increaseMonth:s.increaseMonth,decreaseYear:s.decreaseYear,increaseYear:s.increaseYear,prevMonthButtonDisabled:C,nextMonthButtonDisabled:O,prevYearButtonDisabled:k,nextYearButtonDisabled:U})),Y&&Ge.createElement("div",{className:"react-datepicker__day-names"},s.header(T)))},s.renderYearHeader=function(l){var p=l.monthDate,_=s.props,T=_.showYearPicker,w=_.yearItemNumber,C=w===void 0?n.defaultProps.yearItemNumber:w,O=Hf(p,C),k=O.startPeriod,U=O.endPeriod;return Ge.createElement("div",{className:"react-datepicker__header react-datepicker-year-header"},T?"".concat(k," - ").concat(U):fr(p))},s.renderHeader=function(l){var p=l.monthDate,_=l.i,T=_===void 0?0:_,w={monthDate:p,i:T};switch(!0){case s.props.renderCustomHeader!==void 0:return s.renderCustomHeader(w);case(s.props.showMonthYearPicker||s.props.showQuarterYearPicker||s.props.showYearPicker):return s.renderYearHeader(w);default:return s.renderDefaultHeader(w)}},s.renderMonths=function(){var l,p;if(!(s.props.showTimeSelectOnly||s.props.showYearPicker)){for(var _=[],T=(l=s.props.monthsShown)!==null&&l!==void 0?l:n.defaultProps.monthsShown,w=s.props.showPreviousMonths?T-1:0,C=s.props.showMonthYearPicker||s.props.showQuarterYearPicker?np(s.state.date,w):w_(s.state.date,w),O=(p=s.props.monthSelectedIn)!==null&&p!==void 0?p:w,k=0;k<T;++k){var U=k-O+w,Y=s.props.showMonthYearPicker||s.props.showQuarterYearPicker?np(C,U):wd(C,U),W="month-".concat(k),ee=k<T-1,K=k>0;_.push(Ge.createElement("div",{key:W,ref:function(ie){s.monthContainer=ie??void 0},className:"react-datepicker__month-container"},s.renderHeader({monthDate:Y,i:k}),Ge.createElement(iRe,zr({},n.defaultProps,s.props,{containerRef:s.containerRef,ariaLabelPrefix:s.props.monthAriaLabelPrefix,day:Y,onDayClick:s.handleDayClick,handleOnKeyDown:s.props.handleOnDayKeyDown,handleOnMonthKeyDown:s.props.handleOnKeyDown,onDayMouseEnter:s.handleDayMouseEnter,onMouseLeave:s.handleMonthMouseLeave,orderInDisplay:k,selectingDate:s.state.selectingDate,monthShowsDuplicateDaysEnd:ee,monthShowsDuplicateDaysStart:K}))))}return _}},s.renderYears=function(){if(!s.props.showTimeSelectOnly&&s.props.showYearPicker)return Ge.createElement("div",{className:"react-datepicker__year--container"},s.renderHeader({monthDate:s.state.date}),Ge.createElement(uRe,zr({},n.defaultProps,s.props,{selectingDate:s.state.selectingDate,date:s.state.date,onDayClick:s.handleDayClick,clearSelectingDate:s.clearSelectingDate,onYearMouseEnter:s.handleYearMouseEnter,onYearMouseLeave:s.handleYearMouseLeave})))},s.renderTimeSection=function(){if(s.props.showTimeSelect&&(s.state.monthContainer||s.props.showTimeSelectOnly))return Ge.createElement(dRe,zr({},n.defaultProps,s.props,{onChange:s.props.onTimeChange,format:s.props.timeFormat,intervals:s.props.timeIntervals,monthRef:s.state.monthContainer}))},s.renderInputTimeSection=function(){var l=s.props.selected?new Date(s.props.selected):void 0,p=l&&FD(l)&&!!s.props.selected,_=p?"".concat(CY(l.getHours()),":").concat(CY(l.getMinutes())):"";if(s.props.showTimeInput)return Ge.createElement(Zwe,zr({},n.defaultProps,s.props,{date:l,timeString:_,onChange:s.props.onTimeChange}))},s.renderAriaLiveRegion=function(){var l,p=Hf(s.state.date,(l=s.props.yearItemNumber)!==null&&l!==void 0?l:n.defaultProps.yearItemNumber),_=p.startPeriod,T=p.endPeriod,w;return s.props.showYearPicker?w="".concat(_," - ").concat(T):s.props.showMonthYearPicker||s.props.showQuarterYearPicker?w=fr(s.state.date):w="".concat(sU(ho(s.state.date),s.props.locale)," ").concat(fr(s.state.date)),Ge.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},s.state.isRenderAriaLiveMessage&&w)},s.renderChildren=function(){if(s.props.children)return Ge.createElement("div",{className:"react-datepicker__children-container"},s.props.children)},s.containerRef=F.createRef(),s.state={date:s.getDateInView(),selectingDate:void 0,monthContainer:void 0,isRenderAriaLiveMessage:!1},s}return Object.defineProperty(n,"defaultProps",{get:function(){return{monthsShown:1,forceShowMonthNavigation:!1,timeCaption:"Time",previousYearButtonLabel:"Previous Year",nextYearButtonLabel:"Next Year",previousMonthButtonLabel:"Previous Month",nextMonthButtonLabel:"Next Month",yearItemNumber:NR}},enumerable:!1,configurable:!0}),n.prototype.componentDidMount=function(){var i=this;this.props.showTimeSelect&&(this.assignMonthContainer=function(){i.setState({monthContainer:i.monthContainer})}())},n.prototype.componentDidUpdate=function(i){var s=this;if(this.props.preSelection&&(!Wr(this.props.preSelection,i.preSelection)||this.props.monthSelectedIn!==i.monthSelectedIn)){var l=!ko(this.state.date,this.props.preSelection);this.setState({date:this.props.preSelection},function(){return l&&s.handleCustomMonthChange(s.state.date)})}else this.props.openToDate&&!Wr(this.props.openToDate,i.openToDate)&&this.setState({date:this.props.openToDate})},n.prototype.render=function(){var i=this.props.container||Dwe;return Ge.createElement(VD,{onClickOutside:this.handleClickOutside,style:{display:"contents"},ignoreClass:this.props.outsideClickIgnoreClass},Ge.createElement("div",{style:{display:"contents"},ref:this.containerRef},Ge.createElement(i,{className:$i("react-datepicker",this.props.className,{"react-datepicker--time-only":this.props.showTimeSelectOnly}),showTime:this.props.showTimeSelect||this.props.showTimeInput,showTimeSelectOnly:this.props.showTimeSelectOnly},this.renderAriaLiveRegion(),this.renderPreviousButton(),this.renderNextButton(),this.renderMonths(),this.renderYears(),this.renderTodayButton(),this.renderTimeSection(),this.renderInputTimeSection(),this.renderChildren())))},n}(F.Component),ERe=function(a){var n=a.icon,i=a.className,s=i===void 0?"":i,l=a.onClick,p="react-datepicker__calendar-icon";if(typeof n=="string")return Ge.createElement("i",{className:"".concat(p," ").concat(n," ").concat(s),"aria-hidden":"true",onClick:l});if(Ge.isValidElement(n)){var _=n;return Ge.cloneElement(_,{className:"".concat(_.props.className||""," ").concat(p," ").concat(s),onClick:function(T){typeof _.props.onClick=="function"&&_.props.onClick(T),typeof l=="function"&&l(T)}})}return Ge.createElement("svg",{className:"".concat(p," ").concat(s),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",onClick:l},Ge.createElement("path",{d:"M96 32V64H48C21.5 64 0 85.5 0 112v48H448V112c0-26.5-21.5-48-48-48H352V32c0-17.7-14.3-32-32-32s-32 14.3-32 32V64H160V32c0-17.7-14.3-32-32-32S96 14.3 96 32zM448 192H0V464c0 26.5 21.5 48 48 48H400c26.5 0 48-21.5 48-48V192z"}))},mQ=function(a){wa(n,a);function n(i){var s=a.call(this,i)||this;return s.portalRoot=null,s.el=document.createElement("div"),s}return n.prototype.componentDidMount=function(){this.portalRoot=(this.props.portalHost||document).getElementById(this.props.portalId),this.portalRoot||(this.portalRoot=document.createElement("div"),this.portalRoot.setAttribute("id",this.props.portalId),(this.props.portalHost||document.body).appendChild(this.portalRoot)),this.portalRoot.appendChild(this.el)},n.prototype.componentWillUnmount=function(){this.portalRoot&&this.portalRoot.removeChild(this.el)},n.prototype.render=function(){return d_.createPortal(this.props.children,this.el)},n}(F.Component),yRe="[tabindex], a, button, input, select, textarea",vRe=function(a){return(a instanceof HTMLAnchorElement||!a.disabled)&&a.tabIndex!==-1},gQ=function(a){wa(n,a);function n(i){var s=a.call(this,i)||this;return s.getTabChildren=function(){var l;return Array.prototype.slice.call((l=s.tabLoopRef.current)===null||l===void 0?void 0:l.querySelectorAll(yRe),1,-1).filter(vRe)},s.handleFocusStart=function(){var l=s.getTabChildren();l&&l.length>1&&l[l.length-1].focus()},s.handleFocusEnd=function(){var l=s.getTabChildren();l&&l.length>1&&l[0].focus()},s.tabLoopRef=F.createRef(),s}return n.prototype.render=function(){var i;return((i=this.props.enableTabLoop)!==null&&i!==void 0?i:n.defaultProps.enableTabLoop)?Ge.createElement("div",{className:"react-datepicker__tab-loop",ref:this.tabLoopRef},Ge.createElement("div",{className:"react-datepicker__tab-loop__start",tabIndex:0,onFocus:this.handleFocusStart}),this.props.children,Ge.createElement("div",{className:"react-datepicker__tab-loop__end",tabIndex:0,onFocus:this.handleFocusEnd})):this.props.children},n.defaultProps={enableTabLoop:!0},n}(F.Component);function SRe(a){var n=function(i){var s,l=typeof i.hidePopper=="boolean"?i.hidePopper:!0,p=F.useRef(null),_=Owe(zr({open:!l,whileElementsMounted:cwe,placement:i.popperPlacement,middleware:Mu([_we({padding:15}),gwe(10),Ewe({element:p})],(s=i.popperModifiers)!==null&&s!==void 0?s:[],!0)},i.popperProps)),T=zr(zr({},i),{hidePopper:l,popperProps:zr(zr({},_),{arrowRef:p})});return Ge.createElement(a,zr({},T))};return n}var TRe=function(a){wa(n,a);function n(){return a!==null&&a.apply(this,arguments)||this}return Object.defineProperty(n,"defaultProps",{get:function(){return{hidePopper:!0}},enumerable:!1,configurable:!0}),n.prototype.render=function(){var i=this.props,s=i.className,l=i.wrapperClassName,p=i.hidePopper,_=p===void 0?n.defaultProps.hidePopper:p,T=i.popperComponent,w=i.targetComponent,C=i.enableTabLoop,O=i.popperOnKeyDown,k=i.portalId,U=i.portalHost,Y=i.popperProps,W=i.showArrow,ee=void 0;if(!_){var K=$i("react-datepicker-popper",s);ee=Ge.createElement(gQ,{enableTabLoop:C},Ge.createElement("div",{ref:Y.refs.setFloating,style:Y.floatingStyles,className:K,"data-placement":Y.placement,onKeyDown:O},T,W&&Ge.createElement(bwe,{ref:Y.arrowRef,context:Y.context,fill:"currentColor",strokeWidth:1,height:8,width:16,style:{transform:"translateY(-1px)"},className:"react-datepicker__triangle"})))}this.props.popperContainer&&(ee=F.createElement(this.props.popperContainer,{},ee)),k&&!_&&(ee=Ge.createElement(mQ,{portalId:k,portalHost:U},ee));var ie=$i("react-datepicker-wrapper",l);return Ge.createElement(Ge.Fragment,null,Ge.createElement("div",{ref:Y.refs.setReference,className:ie},w),ee)},n}(F.Component),bRe=SRe(TRe),xY="react-datepicker-ignore-onclickoutside";function wRe(a,n){return a&&n?ho(a)!==ho(n)||fr(a)!==fr(n):a!==n}var SM="Date input not valid.",PY=function(a){wa(n,a);function n(i){var s=a.call(this,i)||this;return s.calendar=null,s.input=null,s.getPreSelection=function(){return s.props.openToDate?s.props.openToDate:s.props.selectsEnd&&s.props.startDate?s.props.startDate:s.props.selectsStart&&s.props.endDate?s.props.endDate:ii()},s.modifyHolidays=function(){var l;return(l=s.props.holidays)===null||l===void 0?void 0:l.reduce(function(p,_){var T=new Date(_.date);return FD(T)?Mu(Mu([],p,!0),[zr(zr({},_),{date:T})],!1):p},[])},s.calcInitialState=function(){var l,p=s.getPreSelection(),_=hQ(s.props),T=pQ(s.props),w=_&&k_(p,aO(_))?_:T&&rm(p,_Y(T))?T:p;return{open:s.props.startOpen||!1,preventFocus:!1,inputValue:null,preSelection:(l=s.props.selectsRange?s.props.startDate:s.props.selected)!==null&&l!==void 0?l:w,highlightDates:RY(s.props.highlightDates),focused:!1,shouldFocusDayInline:!1,isRenderAriaLiveMessage:!1,wasHidden:!1}},s.resetHiddenStatus=function(){s.setState(zr(zr({},s.state),{wasHidden:!1}))},s.setHiddenStatus=function(){s.setState(zr(zr({},s.state),{wasHidden:!0}))},s.setHiddenStateOnVisibilityHidden=function(){document.visibilityState==="hidden"&&s.setHiddenStatus()},s.clearPreventFocusTimeout=function(){s.preventFocusTimeout&&clearTimeout(s.preventFocusTimeout)},s.setFocus=function(){var l,p;(p=(l=s.input)===null||l===void 0?void 0:l.focus)===null||p===void 0||p.call(l,{preventScroll:!0})},s.setBlur=function(){var l,p;(p=(l=s.input)===null||l===void 0?void 0:l.blur)===null||p===void 0||p.call(l),s.cancelFocusInput()},s.deferBlur=function(){requestAnimationFrame(function(){s.setBlur()})},s.setOpen=function(l,p){p===void 0&&(p=!1),s.setState({open:l,preSelection:l&&s.state.open?s.state.preSelection:s.calcInitialState().preSelection,lastPreSelectChange:TM},function(){l||s.setState(function(_){return{focused:p?_.focused:!1}},function(){!p&&s.deferBlur(),s.setState({inputValue:null})})})},s.inputOk=function(){return rp(s.state.preSelection)},s.isCalendarOpen=function(){return s.props.open===void 0?s.state.open&&!s.props.disabled&&!s.props.readOnly:s.props.open},s.handleFocus=function(l){var p,_,T=s.state.wasHidden,w=T?s.state.open:!0;T&&s.resetHiddenStatus(),s.state.preventFocus||((_=(p=s.props).onFocus)===null||_===void 0||_.call(p,l),w&&!s.props.preventOpenOnFocus&&!s.props.readOnly&&s.setOpen(!0)),s.setState({focused:!0})},s.sendFocusBackToInput=function(){s.preventFocusTimeout&&s.clearPreventFocusTimeout(),s.setState({preventFocus:!0},function(){s.preventFocusTimeout=setTimeout(function(){s.setFocus(),s.setState({preventFocus:!1})})})},s.cancelFocusInput=function(){clearTimeout(s.inputFocusTimeout),s.inputFocusTimeout=void 0},s.deferFocusInput=function(){s.cancelFocusInput(),s.inputFocusTimeout=setTimeout(function(){return s.setFocus()},1)},s.handleDropdownFocus=function(){s.cancelFocusInput()},s.handleBlur=function(l){var p,_;(!s.state.open||s.props.withPortal||s.props.showTimeInput)&&((_=(p=s.props).onBlur)===null||_===void 0||_.call(p,l)),s.state.open&&s.props.open===!1&&s.setOpen(!1),s.setState({focused:!1})},s.handleCalendarClickOutside=function(l){var p,_;s.props.inline||s.setOpen(!1),(_=(p=s.props).onClickOutside)===null||_===void 0||_.call(p,l),s.props.withPortal&&l.preventDefault()},s.handleChange=function(){for(var l,p,_,T,w,C=[],O=0;O<arguments.length;O++)C[O]=arguments[O];var k=C[0];if(!(s.props.onChangeRaw&&(s.props.onChangeRaw.apply(s,C),!k||typeof k.isDefaultPrevented!="function"||k.isDefaultPrevented()))){s.setState({inputValue:(k==null?void 0:k.target)instanceof HTMLInputElement?k.target.value:null,lastPreSelectChange:RRe});var U=s.props,Y=U.selectsRange,W=U.startDate,ee=U.endDate,K=(l=s.props.dateFormat)!==null&&l!==void 0?l:n.defaultProps.dateFormat,ie=(p=s.props.strictParsing)!==null&&p!==void 0?p:n.defaultProps.strictParsing,se=(k==null?void 0:k.target)instanceof HTMLInputElement?k.target.value:"";if(Y){var ue=se.split(K.includes("-")?lQ:"-",2).map(function(re){return re.trim()}),ye=ue[0],ae=ue[1],ve=EM(ye??"",K,s.props.locale,ie),$=EM(ae??"",K,s.props.locale,ie),Q=(W==null?void 0:W.getTime())!==(ve==null?void 0:ve.getTime()),te=(ee==null?void 0:ee.getTime())!==($==null?void 0:$.getTime());if(!Q&&!te||ve&&xl(ve,s.props)||$&&xl($,s.props))return;(T=(_=s.props).onChange)===null||T===void 0||T.call(_,[ve,$],k)}else{var oe=EM(se,K,s.props.locale,ie,(w=s.props.selected)!==null&&w!==void 0?w:void 0);(oe||!se)&&s.setSelected(oe,k,!0)}}},s.handleSelect=function(l,p,_){if(!s.props.readOnly){if(s.props.shouldCloseOnSelect&&!s.props.showTimeSelect&&s.sendFocusBackToInput(),s.props.onChangeRaw&&s.props.onChangeRaw(p),s.setSelected(l,p,!1,_),s.props.showDateSelect&&s.setState({isRenderAriaLiveMessage:!0}),!s.props.shouldCloseOnSelect||s.props.showTimeSelect)s.setPreSelection(l);else if(!s.props.inline){s.props.selectsRange||s.setOpen(!1);var T=s.props,w=T.startDate,C=T.endDate;w&&!C&&(s.props.swapRange||!NY(l,w))&&s.setOpen(!1)}}},s.setSelected=function(l,p,_,T){var w,C,O=l;if(s.props.showYearPicker){if(O!==null&&oO(fr(O),s.props))return}else if(s.props.showMonthYearPicker){if(O!==null&&uQ(O,s.props))return}else if(O!==null&&xl(O,s.props))return;var k=s.props,U=k.onChange,Y=k.selectsRange,W=k.startDate,ee=k.endDate,K=k.selectsMultiple,ie=k.selectedDates,se=k.minTime,ue=k.swapRange;if(!__(s.props.selected,O)||s.props.allowSameDay||Y||K)if(O!==null&&(s.props.selected&&(!_||!s.props.showTimeSelect&&!s.props.showTimeSelectOnly&&!s.props.showTimeInput)&&(O=yM(O,{hour:ip(s.props.selected),minute:sp(s.props.selected),second:Kf(s.props.selected)})),!_&&(s.props.showTimeSelect||s.props.showTimeSelectOnly)&&se&&(O=yM(O,{hour:se.getHours(),minute:se.getMinutes(),second:se.getSeconds()})),s.props.inline||s.setState({preSelection:O}),s.props.focusSelectedMonth||s.setState({monthSelectedIn:T})),Y){var ye=!W&&!ee,ae=W&&!ee,ve=W&&ee;ye?U==null||U([O,null],p):ae&&(O===null?U==null||U([null,null],p):NY(O,W)?ue?U==null||U([O,W],p):U==null||U([O,null],p):U==null||U([W,O],p)),ve&&(U==null||U([O,null],p))}else if(K){if(O!==null)if(!(ie!=null&&ie.length))U==null||U([O],p);else{var $=ie.some(function(te){return Wr(te,O)});if($){var Q=ie.filter(function(te){return!Wr(te,O)});U==null||U(Q,p)}else U==null||U(Mu(Mu([],ie,!0),[O],!1),p)}}else U==null||U(O,p);_||((C=(w=s.props).onSelect)===null||C===void 0||C.call(w,O,p),s.setState({inputValue:null}))},s.setPreSelection=function(l){if(!s.props.readOnly){var p=rp(s.props.minDate),_=rp(s.props.maxDate),T=!0;if(l){var w=aO(l);if(p&&_)T=Mw(l,s.props.minDate,s.props.maxDate);else if(p){var C=aO(s.props.minDate);T=rm(l,C)||__(w,C)}else if(_){var O=_Y(s.props.maxDate);T=k_(l,O)||__(w,O)}}T&&s.setState({preSelection:l})}},s.toggleCalendar=function(){s.setOpen(!s.state.open)},s.handleTimeChange=function(l){var p,_;if(!(s.props.selectsRange||s.props.selectsMultiple)){var T=s.props.selected?s.props.selected:s.getPreSelection(),w=s.props.selected?l:yM(T,{hour:ip(l),minute:sp(l)});s.setState({preSelection:w}),(_=(p=s.props).onChange)===null||_===void 0||_.call(p,w),s.props.shouldCloseOnSelect&&!s.props.showTimeInput&&(s.sendFocusBackToInput(),s.setOpen(!1)),s.props.showTimeInput&&s.setOpen(!0),(s.props.showTimeSelectOnly||s.props.showTimeSelect)&&s.setState({isRenderAriaLiveMessage:!0}),s.setState({inputValue:null})}},s.onInputClick=function(){var l,p;!s.props.disabled&&!s.props.readOnly&&s.setOpen(!0),(p=(l=s.props).onInputClick)===null||p===void 0||p.call(l)},s.onInputKeyDown=function(l){var p,_,T,w,C,O;(_=(p=s.props).onKeyDown)===null||_===void 0||_.call(p,l);var k=l.key;if(!s.state.open&&!s.props.inline&&!s.props.preventOpenOnFocus){(k===Vt.ArrowDown||k===Vt.ArrowUp||k===Vt.Enter)&&((T=s.onInputClick)===null||T===void 0||T.call(s));return}if(s.state.open){if(k===Vt.ArrowDown||k===Vt.ArrowUp){l.preventDefault();var U=s.props.showTimeSelectOnly?".react-datepicker__time-list-item[tabindex='0']":s.props.showWeekPicker&&s.props.showWeekNumbers?'.react-datepicker__week-number[tabindex="0"]':s.props.showFullMonthYearPicker||s.props.showMonthYearPicker?'.react-datepicker__month-text[tabindex="0"]':'.react-datepicker__day[tabindex="0"]',Y=((w=s.calendar)===null||w===void 0?void 0:w.containerRef.current)instanceof Element&&s.calendar.containerRef.current.querySelector(U);Y instanceof HTMLElement&&Y.focus({preventScroll:!0});return}var W=ii(s.state.preSelection);k===Vt.Enter?(l.preventDefault(),l.target.blur(),s.inputOk()&&s.state.lastPreSelectChange===TM?(s.handleSelect(W,l),!s.props.shouldCloseOnSelect&&s.setPreSelection(W)):s.setOpen(!1)):k===Vt.Escape?(l.preventDefault(),l.target.blur(),s.sendFocusBackToInput(),s.setOpen(!1)):k===Vt.Tab&&s.setOpen(!1),s.inputOk()||(O=(C=s.props).onInputError)===null||O===void 0||O.call(C,{code:1,msg:SM})}},s.onPortalKeyDown=function(l){var p=l.key;p===Vt.Escape&&(l.preventDefault(),s.setState({preventFocus:!0},function(){s.setOpen(!1),setTimeout(function(){s.setFocus(),s.setState({preventFocus:!1})})}))},s.onDayKeyDown=function(l){var p,_,T,w,C,O,k=s.props,U=k.minDate,Y=k.maxDate,W=k.disabledKeyboardNavigation,ee=k.showWeekPicker,K=k.shouldCloseOnSelect,ie=k.locale,se=k.calendarStartDay,ue=k.adjustDateOnChange,ye=k.inline;if((_=(p=s.props).onKeyDown)===null||_===void 0||_.call(p,l),!W){var ae=l.key,ve=l.shiftKey,$=ii(s.state.preSelection),Q=function(Je,be){var Ie=be;switch(Je){case Vt.ArrowRight:Ie=ee?jO(be,1):Sd(be,1);break;case Vt.ArrowLeft:Ie=ee?iY(be):XTe(be);break;case Vt.ArrowUp:Ie=iY(be);break;case Vt.ArrowDown:Ie=jO(be,1);break;case Vt.PageUp:Ie=ve?Yv(be,1):w_(be,1);break;case Vt.PageDown:Ie=ve?np(be,1):wd(be,1);break;case Vt.Home:Ie=Xf(be,ie,se);break;case Vt.End:Ie=jwe(be);break}return Ie},te=function(Je,be){for(var Ie=40,Re=Je,Me=!1,he=0,De=Q(Je,be);!Me;){if(he>=Ie){De=be;break}U&&De<U&&(Re=Vt.ArrowRight,De=xl(U,s.props)?Q(Re,De):U),Y&&De>Y&&(Re=Vt.ArrowLeft,De=xl(Y,s.props)?Q(Re,De):Y),xl(De,s.props)?((Re===Vt.PageUp||Re===Vt.Home)&&(Re=Vt.ArrowRight),(Re===Vt.PageDown||Re===Vt.End)&&(Re=Vt.ArrowLeft),De=Q(Re,De)):Me=!0,he++}return De};if(ae===Vt.Enter){l.preventDefault(),s.handleSelect($,l),!K&&s.setPreSelection($);return}else if(ae===Vt.Escape){l.preventDefault(),s.setOpen(!1),s.inputOk()||(w=(T=s.props).onInputError)===null||w===void 0||w.call(T,{code:1,msg:SM});return}var oe=null;switch(ae){case Vt.ArrowLeft:case Vt.ArrowRight:case Vt.ArrowUp:case Vt.ArrowDown:case Vt.PageUp:case Vt.PageDown:case Vt.Home:case Vt.End:oe=te(ae,$);break}if(!oe){(O=(C=s.props).onInputError)===null||O===void 0||O.call(C,{code:1,msg:SM});return}if(l.preventDefault(),s.setState({lastPreSelectChange:TM}),ue&&s.setSelected(oe),s.setPreSelection(oe),ye){var re=ho($),fe=ho(oe),pe=fr($),Ne=fr(oe);re!==fe||pe!==Ne?s.setState({shouldFocusDayInline:!0}):s.setState({shouldFocusDayInline:!1})}}},s.onPopperKeyDown=function(l){var p=l.key;p===Vt.Escape&&(l.preventDefault(),s.sendFocusBackToInput(),s.setOpen(!1))},s.onClearClick=function(l){l&&l.preventDefault&&l.preventDefault(),s.sendFocusBackToInput();var p=s.props,_=p.selectsRange,T=p.onChange;_?T==null||T([null,null],l):T==null||T(null,l),s.setState({inputValue:null})},s.clear=function(){s.onClearClick()},s.onScroll=function(l){typeof s.props.closeOnScroll=="boolean"&&s.props.closeOnScroll?(l.target===document||l.target===document.documentElement||l.target===document.body)&&s.setOpen(!1):typeof s.props.closeOnScroll=="function"&&s.props.closeOnScroll(l)&&s.setOpen(!1)},s.renderCalendar=function(){var l,p;return!s.props.inline&&!s.isCalendarOpen()?null:Ge.createElement(_Re,zr({showMonthYearDropdown:void 0,ref:function(_){s.calendar=_}},s.props,s.state,{setOpen:s.setOpen,dateFormat:(l=s.props.dateFormatCalendar)!==null&&l!==void 0?l:n.defaultProps.dateFormatCalendar,onSelect:s.handleSelect,onClickOutside:s.handleCalendarClickOutside,holidays:Xwe(s.modifyHolidays()),outsideClickIgnoreClass:xY,onDropdownFocus:s.handleDropdownFocus,onTimeChange:s.handleTimeChange,className:s.props.calendarClassName,container:s.props.calendarContainer,handleOnKeyDown:s.props.onKeyDown,handleOnDayKeyDown:s.onDayKeyDown,setPreSelection:s.setPreSelection,dropdownMode:(p=s.props.dropdownMode)!==null&&p!==void 0?p:n.defaultProps.dropdownMode}),s.props.children)},s.renderAriaLiveRegion=function(){var l=s.props,p=l.dateFormat,_=p===void 0?n.defaultProps.dateFormat:p,T=l.locale,w=s.props.showTimeInput||s.props.showTimeSelect,C=w?"PPPPp":"PPPP",O;return s.props.selectsRange?O="Selected start date: ".concat(Ol(s.props.startDate,{dateFormat:C,locale:T}),". ").concat(s.props.endDate?"End date: "+Ol(s.props.endDate,{dateFormat:C,locale:T}):""):s.props.showTimeSelectOnly?O="Selected time: ".concat(Ol(s.props.selected,{dateFormat:_,locale:T})):s.props.showYearPicker?O="Selected year: ".concat(Ol(s.props.selected,{dateFormat:"yyyy",locale:T})):s.props.showMonthYearPicker?O="Selected month: ".concat(Ol(s.props.selected,{dateFormat:"MMMM yyyy",locale:T})):s.props.showQuarterYearPicker?O="Selected quarter: ".concat(Ol(s.props.selected,{dateFormat:"yyyy, QQQ",locale:T})):O="Selected date: ".concat(Ol(s.props.selected,{dateFormat:C,locale:T})),Ge.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},O)},s.renderDateInput=function(){var l,p,_,T=$i(s.props.className,(l={},l[xY]=s.state.open,l)),w=s.props.customInput||Ge.createElement("input",{type:"text"}),C=s.props.customInputRef||"ref",O=s.props,k=O.dateFormat,U=k===void 0?n.defaultProps.dateFormat:k,Y=O.locale,W=typeof s.props.value=="string"?s.props.value:typeof s.state.inputValue=="string"?s.state.inputValue:s.props.selectsRange?Pwe(s.props.startDate,s.props.endDate,{dateFormat:U,locale:Y}):s.props.selectsMultiple?kwe((_=s.props.selectedDates)!==null&&_!==void 0?_:[],{dateFormat:U,locale:Y}):Ol(s.props.selected,{dateFormat:U,locale:Y});return F.cloneElement(w,(p={},p[C]=function(ee){s.input=ee},p.value=W,p.onBlur=s.handleBlur,p.onChange=s.handleChange,p.onClick=s.onInputClick,p.onFocus=s.handleFocus,p.onKeyDown=s.onInputKeyDown,p.id=s.props.id,p.name=s.props.name,p.form=s.props.form,p.autoFocus=s.props.autoFocus,p.placeholder=s.props.placeholderText,p.disabled=s.props.disabled,p.autoComplete=s.props.autoComplete,p.className=$i(w.props.className,T),p.title=s.props.title,p.readOnly=s.props.readOnly,p.required=s.props.required,p.tabIndex=s.props.tabIndex,p["aria-describedby"]=s.props.ariaDescribedBy,p["aria-invalid"]=s.props.ariaInvalid,p["aria-labelledby"]=s.props.ariaLabelledBy,p["aria-required"]=s.props.ariaRequired,p))},s.renderClearButton=function(){var l=s.props,p=l.isClearable,_=l.disabled,T=l.selected,w=l.startDate,C=l.endDate,O=l.clearButtonTitle,k=l.clearButtonClassName,U=k===void 0?"":k,Y=l.ariaLabelClose,W=Y===void 0?"Close":Y,ee=l.selectedDates,K=l.readOnly;return p&&!K&&(T!=null||w!=null||C!=null||ee!=null&&ee.length)?Ge.createElement("button",{type:"button",className:$i("react-datepicker__close-icon",U,{"react-datepicker__close-icon--disabled":_}),disabled:_,"aria-label":W,onClick:s.onClearClick,title:O,tabIndex:-1}):null},s.state=s.calcInitialState(),s.preventFocusTimeout=void 0,s}return Object.defineProperty(n,"defaultProps",{get:function(){return{allowSameDay:!1,dateFormat:"MM/dd/yyyy",dateFormatCalendar:"LLLL yyyy",disabled:!1,disabledKeyboardNavigation:!1,dropdownMode:"scroll",preventOpenOnFocus:!1,monthsShown:1,readOnly:!1,withPortal:!1,selectsDisabledDaysInRange:!1,shouldCloseOnSelect:!0,showTimeSelect:!1,showTimeInput:!1,showPreviousMonths:!1,showMonthYearPicker:!1,showFullMonthYearPicker:!1,showTwoColumnMonthYearPicker:!1,showFourColumnMonthYearPicker:!1,showYearPicker:!1,showQuarterYearPicker:!1,showWeekPicker:!1,strictParsing:!1,swapRange:!1,timeIntervals:30,timeCaption:"Time",previousMonthAriaLabel:"Previous Month",previousMonthButtonLabel:"Previous Month",nextMonthAriaLabel:"Next Month",nextMonthButtonLabel:"Next Month",previousYearAriaLabel:"Previous Year",previousYearButtonLabel:"Previous Year",nextYearAriaLabel:"Next Year",nextYearButtonLabel:"Next Year",timeInputLabel:"Time",enableTabLoop:!0,yearItemNumber:NR,focusSelectedMonth:!1,showPopperArrow:!0,excludeScrollbar:!0,customTimeInput:null,calendarStartDay:void 0,toggleCalendarOnIconClick:!1,usePointerEvent:!1}},enumerable:!1,configurable:!0}),n.prototype.componentDidMount=function(){window.addEventListener("scroll",this.onScroll,!0),document.addEventListener("visibilitychange",this.setHiddenStateOnVisibilityHidden)},n.prototype.componentDidUpdate=function(i,s){var l,p,_,T;i.inline&&wRe(i.selected,this.props.selected)&&this.setPreSelection(this.props.selected),this.state.monthSelectedIn!==void 0&&i.monthsShown!==this.props.monthsShown&&this.setState({monthSelectedIn:0}),i.highlightDates!==this.props.highlightDates&&this.setState({highlightDates:RY(this.props.highlightDates)}),!s.focused&&!__(i.selected,this.props.selected)&&this.setState({inputValue:null}),s.open!==this.state.open&&(s.open===!1&&this.state.open===!0&&((p=(l=this.props).onCalendarOpen)===null||p===void 0||p.call(l)),s.open===!0&&this.state.open===!1&&((T=(_=this.props).onCalendarClose)===null||T===void 0||T.call(_)))},n.prototype.componentWillUnmount=function(){this.clearPreventFocusTimeout(),window.removeEventListener("scroll",this.onScroll,!0),document.removeEventListener("visibilitychange",this.setHiddenStateOnVisibilityHidden)},n.prototype.renderInputContainer=function(){var i=this.props,s=i.showIcon,l=i.icon,p=i.calendarIconClassname,_=i.calendarIconClassName,T=i.toggleCalendarOnIconClick,w=this.state.open;return p&&console.warn("calendarIconClassname props is deprecated. should use calendarIconClassName props."),Ge.createElement("div",{className:"react-datepicker__input-container".concat(s?" react-datepicker__view-calendar-icon":"")},s&&Ge.createElement(ERe,zr({icon:l,className:$i(_,!_&&p,w&&"react-datepicker-ignore-onclickoutside")},T?{onClick:this.toggleCalendar}:null)),this.state.isRenderAriaLiveMessage&&this.renderAriaLiveRegion(),this.renderDateInput(),this.renderClearButton())},n.prototype.render=function(){var i=this.renderCalendar();if(this.props.inline)return i;if(this.props.withPortal){var s=this.state.open?Ge.createElement(gQ,{enableTabLoop:this.props.enableTabLoop},Ge.createElement("div",{className:"react-datepicker__portal",tabIndex:-1,onKeyDown:this.onPortalKeyDown},i)):null;return this.state.open&&this.props.portalId&&(s=Ge.createElement(mQ,zr({portalId:this.props.portalId},this.props),s)),Ge.createElement("div",null,this.renderInputContainer(),s)}return Ge.createElement(bRe,zr({},this.props,{className:this.props.popperClassName,hidePopper:!this.isCalendarOpen(),targetComponent:this.renderInputContainer(),popperComponent:i,popperOnKeyDown:this.onPopperKeyDown,showArrow:this.props.showPopperArrow}))},n}(F.Component),RRe="input",TM="navigate";const CRe=()=>{const a=Li(),{doctorUnavailabilityList:n,doctorUnavailabilityLoading:i,unavailabilityrequest:s,unavailabilityLoading:l,error:p}=Tr(Re=>Re.patientProfile),[_,T]=F.useState(!1),[w,C]=F.useState(null),[O,k]=F.useState(null),[U,Y]=F.useState(""),[W,ee]=F.useState(""),[K,ie]=F.useState(""),se=Re=>{ie(Re.toLowerCase()),Q(1)},ue=Re=>{var Me,he,De,qe,We,Be,bt,St,Tt;return K?((Me=Re.appliedOn)==null?void 0:Me.toLowerCase().includes(K))||((he=Re.fromDate)==null?void 0:he.toLowerCase().includes(K))||((De=Re.fromTime)==null?void 0:De.toLowerCase().includes(K))||((qe=Re.toDate)==null?void 0:qe.toLowerCase().includes(K))||((We=Re.toTime)==null?void 0:We.toLowerCase().includes(K))||((Be=Re.timePeriod)==null?void 0:Be.toLowerCase().includes(K))||((bt=Re.reason)==null?void 0:bt.toLowerCase().includes(K))||((St=Re.type)==null?void 0:St.toLowerCase().includes(K))||((Tt=Re.status)==null?void 0:Tt.toLowerCase().includes(K)):!0},ye=Re=>{if(!Re)return null;const Me=Re.getFullYear(),he=String(Re.getMonth()+1).padStart(2,"0"),De=String(Re.getDate()).padStart(2,"0"),qe=String(Re.getHours()).padStart(2,"0"),We=String(Re.getMinutes()).padStart(2,"0"),Be=String(Re.getSeconds()).padStart(2,"0");return`${Me}-${he}-${De} ${qe}:${We}:${Be}`},ae=()=>{if(!w||!O||!U||!W.trim()){ct.error("Please fill all fields!");return}const Re={from_datetime:ye(w),to_datetime:ye(O),type:U,reason:W};T(!1),a(BN(Re)).then(Me=>{var he,De;(he=Me.payload)!=null&&he.status?(ct.success(Me.payload.message),a(Gw())):ct.error((De=Me.payload)==null?void 0:De.message)}).catch(Me=>{ct.error("An error occurred while Confirming for doctor's leave")}),T(!1),C(null),k(null),Y(""),ee("")},ve=()=>{T(!1),C(null),k(null),Y(""),ee("")},[$,Q]=F.useState(1),te=5;F.useEffect(()=>{a(Gw({search:K}))},[a,K]);const oe=(n==null?void 0:n.filter(ue))||[],re=Math.ceil(oe.length/te),fe=$*te,pe=fe-te,Ne=oe.slice(pe,fe),Je=Re=>{Q(Re)},be=()=>$<re&&Q($+1),Ie=()=>$>1&&Q($-1);return m.jsx(m.Fragment,{children:m.jsx("main",{className:"doctor-panel",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(Ga,{})}),l?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"doc-panel-body",children:[m.jsxs("div",{className:"docpnl-sec-head",style:{display:"flex",alignItems:"center"},children:[m.jsx("h1",{className:"h2-title",children:"Mark Unavailability"}),m.jsxs("div",{style:{display:"flex",justifyContent:"right",width:"50%",gap:"10px"},children:[m.jsx("div",{style:{width:"40%",borderRadius:"10px"},children:m.jsx(R2,{onSearch:se,placeholder:"Search anything here..."})}),m.jsx("div",{className:"mb-4 text-right",children:m.jsxs(Pi,{onClick:()=>T(!0),style:{backgroundColor:"#F47820"},className:"border-0 px-6 py-2 rounded-lg shadow-md text-white flex items-center gap-2 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-75",children:[m.jsx(rj,{style:{marginBottom:5,marginRight:5}}),"Add Request"]})})]})]}),m.jsx("div",{className:"pending-prescriptions-wrp",children:m.jsxs("div",{className:"my-appointments-inr",children:[m.jsx("div",{className:"myapintmnt-content-tab pending",children:m.jsx("div",{className:"pending-presc-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Applied On"}),m.jsx("th",{children:"From"}),m.jsx("th",{children:"To"}),m.jsx("th",{children:"Total Time"}),m.jsx("th",{children:"Reason"}),m.jsx("th",{children:"Type"}),m.jsx("th",{children:"Status"})]})}),m.jsxs("tbody",{children:[Ne.length==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center"},children:i?"Loading...":m.jsx("span",{style:{fontWeight:"400",fontSize:18},children:"No data found"})})}),Ne.map((Re,Me)=>m.jsxs("tr",{children:[m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:String(($-1)*te+Me+1).padStart(2,"0")}),m.jsx("td",{style:{textAlign:"left",maxWidth:"287px",paddingLeft:"165px",color:"#199FD9"},children:Re.appliedOn}),m.jsxs("td",{children:[m.jsx("div",{className:"date",style:{color:"#199FD9",fontSize:20},children:Re.fromDate}),m.jsx("div",{className:"time",style:{color:"#199FD9"},children:Re.fromTime})]}),m.jsxs("td",{children:[m.jsx("div",{className:"date",style:{color:"#199FD9",fontSize:20},children:Re.toDate}),m.jsx("div",{className:"time",style:{color:"#199FD9"},children:Re.toTime})]}),m.jsx("td",{style:{color:"#199FD9"},children:Re.timePeriod}),m.jsx("td",{style:{color:"#199FD9"},children:m.jsx("span",{dangerouslySetInnerHTML:{__html:Re.reason.replace(/(.{20})/g,"$1<br/>")}})}),m.jsx("td",{style:{color:"#199FD9"},children:Re.type}),m.jsx("td",{style:{color:"#199FD9"},children:Re.status})]},Me))]})]})})}),oe.length>0&&m.jsx(xu,{currentPage:$,totalPages:re,onPageChange:Je,onPrevious:Ie,onNext:be})]})})]}),m.jsxs(bn,{show:_,onHide:ve,centered:!0,children:[m.jsx(bn.Header,{closeButton:!0,children:m.jsx(bn.Title,{children:"Add Unavailability Request"})}),m.jsx(bn.Body,{children:m.jsxs(ot,{children:[m.jsxs(ot.Group,{className:"mb-3",children:[m.jsx(ot.Label,{children:"Applied For:"}),m.jsxs("div",{className:"d-flex gap-2",children:[m.jsx(PY,{selected:w,onChange:Re=>C(Re),showTimeSelect:!0,timeIntervals:15,timeCaption:"Time",dateFormat:"MMMM d, yyyy h:mm aa",placeholderText:"From",className:"form-control",minDate:new Date}),m.jsx(PY,{selected:O,onChange:Re=>k(Re),showTimeSelect:!0,timeIntervals:15,timeCaption:"Time",dateFormat:"MMMM d, yyyy h:mm aa",placeholderText:"To",className:"form-control",minDate:w||new Date})]})]}),m.jsxs(ot.Group,{className:"mb-3",children:[m.jsx(ot.Label,{children:"Request Type"}),m.jsxs(ot.Select,{value:U,onChange:Re=>Y(Re.target.value),children:[m.jsx("option",{value:"",children:"Select Request Type"}),m.jsx("option",{value:"emergency",children:"Emergency"}),m.jsx("option",{value:"planned",children:"Planned"})]})]}),m.jsxs(ot.Group,{className:"mb-3",children:[m.jsx(ot.Label,{children:"Reason"}),m.jsx(ot.Control,{type:"text",value:W,onChange:Re=>ee(Re.target.value),placeholder:"Reason..."})]})]})}),m.jsxs(bn.Footer,{children:[m.jsx(Pi,{variant:"secondary",onClick:ve,children:"Cancel"}),m.jsx(Pi,{variant:"primary",onClick:ae,disabled:l,children:l?"Sending...":"Send"})]})]}),m.jsx(po,{})]})})})},ARe=()=>{ds();const a=Li(),{hodScreenRequests:n,hodScreenRequestsLoading:i,hodRequestsConfirmButtonLoading:s,hodRequestsConfirm:l,hodRequestsRespondButtonLoading:p,hodRequestsRespond:_,hodScreenDoctors:T,hodScreenDoctorsListLoading:w,confirmDoctorAvailable:C,markDoctorAvailableLoading:O,doctorUnavailabilitySubmit:k,unavailabilitySubmitByHodLoading:U}=Tr(Qe=>Qe.patientProfile),[Y,W]=F.useState(""),[ee,K]=F.useState("");F.useEffect(()=>{a(p_({search:ee}))},[a,ee]),F.useEffect(()=>{const Qe=setTimeout(()=>{a(f_({search:Y}))},500);return()=>clearTimeout(Qe)},[a,Y]),F.useEffect(()=>{const Qe=setInterval(()=>{const Kt=new Date;T==null||T.forEach(un=>{var yr;if(!un.hasUnavailability)return;const rn=(yr=un.unavailabilities)==null?void 0:yr[0];if(!rn)return;const Dn=new Date(`${rn.fromDate} ${rn.fromTime}`),Ai=new Date(`${rn.toDate} ${rn.toTime}`);Kt.toLocaleString("en-US",{hour12:!0}),Dn.toLocaleString("en-US",{hour12:!0}),Ai.toLocaleString("en-US",{hour12:!0});const ln=Math.abs(Kt-Dn)<60*1e3,mr=Math.abs(Kt-Ai)<60*1e3;(ln||mr)&&a(f_())})},6e4);return()=>clearInterval(Qe)},[T,a]);const ie=Qe=>{W(Qe.toLowerCase()),qe(1)},se=Qe=>{K(Qe.toLowerCase()),ve(1)},ue=Qe=>{var Kt,un,rn,Dn,Ai,ln,mr,yr,oi,Bs,fo,Hs,Gc,za,Ra;return Y?((Kt=Qe.name)==null?void 0:Kt.toLowerCase().includes(Y))||((un=Qe.email)==null?void 0:un.toLowerCase().includes(Y))||((rn=Qe.phone)==null?void 0:rn.toLowerCase().includes(Y))||((Dn=Qe.experience)==null?void 0:Dn.toString().includes(Y))||((Ai=Qe.shiftTiming)==null?void 0:Ai.toLowerCase().includes(Y))||((ln=Qe.signupDate)==null?void 0:ln.toLowerCase().includes(Y))||Qe.hasUnavailability&&(((oi=(yr=(mr=Qe.unavailabilities)==null?void 0:mr[0])==null?void 0:yr.type)==null?void 0:oi.toLowerCase().includes(Y))||((Hs=(fo=(Bs=Qe.unavailabilities)==null?void 0:Bs[0])==null?void 0:fo.status)==null?void 0:Hs.toLowerCase().includes(Y))||((Ra=(za=(Gc=Qe.unavailabilities)==null?void 0:Gc[0])==null?void 0:za.reason)==null?void 0:Ra.toLowerCase().includes(Y))):!0},ye=Qe=>{var Kt,un,rn,Dn,Ai,ln,mr,yr,oi,Bs;return ee?((Kt=Qe.doctorName)==null?void 0:Kt.toLowerCase().includes(ee))||((un=Qe.appliedOn)==null?void 0:un.toLowerCase().includes(ee))||((rn=Qe.fromDate)==null?void 0:rn.toLowerCase().includes(ee))||((Dn=Qe.fromTime)==null?void 0:Dn.toLowerCase().includes(ee))||((Ai=Qe.toDate)==null?void 0:Ai.toLowerCase().includes(ee))||((ln=Qe.toTime)==null?void 0:ln.toLowerCase().includes(ee))||((mr=Qe.type)==null?void 0:mr.toLowerCase().includes(ee))||((yr=Qe.status)==null?void 0:yr.toLowerCase().includes(ee))||((oi=Qe.reason)==null?void 0:oi.toLowerCase().includes(ee))||((Bs=Qe.timePeriod)==null?void 0:Bs.toLowerCase().includes(ee)):!0},[ae,ve]=F.useState(1),$=8,Q=(n==null?void 0:n.filter(ye))||[],te=Math.ceil(Q.length/$),oe=ae*$,re=oe-$,fe=Q.slice(re,oe),pe=Qe=>{ve(Qe)},Ne=()=>ae<te&&ve(ae+1),Je=()=>ae>1&&ve(ae-1),be=Qe=>{a(HN({unavailability_id:Qe})).then(Kt=>{var un,rn;(un=Kt.payload)!=null&&un.status?(ct.success(Kt.payload.message),a(p_())):ct.error((rn=Kt.payload)==null?void 0:rn.message)}).catch(Kt=>{ct.error("An error occurred while Confirming for doctor's leave")})},Ie=(Qe,Kt)=>{a(Ww({unavailability_id:Qe,status:Kt})).then(un=>{var rn,Dn;(rn=un.payload)!=null&&rn.status?(ct.success(un.payload.message),a(p_())):ct.error((Dn=un.payload)==null?void 0:Dn.message)}).catch(un=>{ct.error("An error occurred while Approving doctor's leave'")})},Re=(Qe,Kt)=>{a(Ww({unavailability_id:Qe,status:Kt})).then(un=>{var rn,Dn;(rn=un.payload)!=null&&rn.status?(ct.success(un.payload.message),a(p_())):ct.error((Dn=un.payload)==null?void 0:Dn.message)}).catch(un=>{ct.error("An error occurred while Declining doctor's leave'")})},Me=Qe=>{a(GN({doctor_id:Qe})).then(Kt=>{var un,rn;(un=Kt.payload)!=null&&un.status?(ct.success(Kt.payload.message||"Doctor marked as available successfully"),Ot(!1),a(f_())):ct.error(((rn=Kt.payload)==null?void 0:rn.message)||"Failed to mark doctor as available")}).catch(Kt=>{Ot(!1),ct.error("An error occurred while marking doctor as available")})},he=Qe=>{if(Qe.preventDefault(),!mt.startDate||!mt.endDate||!mt.startTime||!mt.endTime||!mt.reason){ct.error("Please fill all required fields");return}const Kt=`${mt.startDate} ${mt.startTime}:00`,un=`${mt.endDate} ${mt.endTime}:00`,rn={doctor_id:en,from_datetime:Kt,to_datetime:un,type:mt.type,reason:mt.reason};a(WN(rn)).then(Dn=>{var Ai,ln;(Ai=Dn.payload)!=null&&Ai.status?(a(f_()),ct.success(Dn.payload.message||"Unavailability set successfully"),Yt(!1),kt({startDate:"",endDate:"",startTime:"",endTime:"",type:"emergency",reason:""})):ct.error(((ln=Dn.payload)==null?void 0:ln.message)||"Failed to set unavailability")}).catch(Dn=>{Yt(!1),ct.error("An error occurred while setting unavailability")})},[De,qe]=F.useState(1),We=(T==null?void 0:T.filter(ue))||[],Be=Math.ceil(We.length/$),bt=De*$,St=bt-$,Tt=We.slice(St,bt),ut=Qe=>{qe(Qe)},tn=()=>De<Be&&qe(De+1),Mt=()=>De>1&&qe(De-1),[wn,Yt]=F.useState(!1),[Xn,Ot]=F.useState(!1),[en,Dt]=F.useState(null),[mt,kt]=F.useState({startDate:"",endDate:"",startTime:"",endTime:"",type:"emergency",reason:""}),[Gt,Mn]=F.useState("upcoming"),[Ci,bs]=F.useState(!1),[Rr,kn]=F.useState(!1),[Mi,Ht]=F.useState(!1),[sn,wt]=F.useState(null),[mn,jn]=F.useState(""),[Ei,ai]=F.useState(new Date),Cr=Qe=>{const{name:Kt,value:un}=Qe.target;kt(rn=>({...rn,[Kt]:un}))},[ji,zi]=F.useState({patientName:"",age:"",dsCode:"",disease:""}),[ws,ua]=F.useState([]),[Fs,Wa]=F.useState([]),[je,nn]=F.useState(null);F.useEffect(()=>{if(ws){const Qe=ws.find(Kt=>Kt.status===1);nn(Qe||null)}},[ws]),JSON.parse(localStorage.getItem("doctor-app")||"{}").doctorData;const nr=Qe=>{const[Kt,un]=Qe.split(" - "),rn=Dn=>{const[Ai,ln]=Dn.split(":"),mr=new Date;return mr.setHours(Ai,ln),mr.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})};return`${rn(Kt)} - ${rn(un)}`};return m.jsxs("div",{className:"doctor-panel",children:[m.jsxs("div",{className:"container-fluid",children:[m.jsxs("div",{className:"doc-panel-inr",children:[" ",m.jsx(Ga,{})," "]}),i||w?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"doc-panel-body",children:[m.jsx("div",{className:"docpnl-sec-head",children:m.jsx("h1",{className:"h2-title",children:"Unavailability Management"})}),m.jsx("div",{className:"my-appointments-wrp",children:m.jsxs("div",{className:"my-appointments-inr",children:[m.jsxs("div",{className:"my-appointments-tab-header",children:[m.jsx("div",{className:"my-appointments-tab-head",children:m.jsxs("ul",{style:{position:"relative"},children:[m.jsx("li",{className:"tab-bg"}),m.jsxs("li",{style:Gt=="upcoming"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>Mn("upcoming"),children:["Doctors"," "]}),m.jsxs("li",{style:Gt=="completed"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>Mn("completed"),children:[" ","Requests"," "]})]})}),Gt==="upcoming"&&m.jsx(R2,{onSearch:ie,placeholder:"Search anything here...",value:Y}),Gt==="completed"&&m.jsx(R2,{onSearch:se,placeholder:"Search anything here...",value:ee})]}),m.jsxs("div",{className:"my-appointments-tab-content-wrp",children:[m.jsxs("div",{className:`myapintmnt-content-tab ${Gt==="upcoming"?"upcoming":""}`,style:{display:Gt==="upcoming"?"block":"none"},children:[m.jsx("div",{className:"myapintmnt-table tbl-large",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{style:{width:"200px"},children:"Doctor Name"}),m.jsx("th",{children:"Experience"}),m.jsx("th",{children:"phone Number"}),m.jsx("th",{children:"Email Address"}),m.jsx("th",{children:"Shift Timing"}),m.jsx("th",{children:"Sign Up Date"}),m.jsx("th",{children:"Availability Status"}),m.jsx("th",{children:"Upcoming Unavailability"}),m.jsx("th",{children:"Type"}),m.jsx("th",{children:"Status"}),m.jsx("th",{children:"Reason"})]})}),m.jsxs("tbody",{children:[Tt.length==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center"},children:w?"Loading...":m.jsx("span",{style:{fontWeight:"400",fontSize:18},children:"No data found"})})}),Tt.map((Qe,Kt)=>{var un,rn,Dn,Ai,ln,mr,yr,oi,Bs,fo,Hs,Gc,za,Ra,Uo,mo;return m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String((De-1)*$+Kt+1).padStart(2,"0")}),m.jsx("td",{style:{color:"#199FD9"},children:Qe.name}),m.jsx("td",{style:{color:"#199FD9"},children:Qe.experience}),m.jsx("td",{style:{color:"#199FD9"},children:Qe.phone}),m.jsx("td",{style:{color:"#199FD9"},children:Qe.email}),m.jsx("td",{style:{color:"#199FD9"},children:nr(Qe.shiftTiming)}),m.jsx("td",{style:{color:"#199FD9"},children:Qe.signupDate}),m.jsx("td",{children:Qe.isSuspended?"--":m.jsx(m.Fragment,{children:m.jsx("div",{className:"availability-toggle1",children:m.jsxs("div",{className:"status-text1",children:[m.jsx("span",{className:"unavailable",children:"Unavailable"}),m.jsxs("label",{className:"toggle-label1",children:[m.jsx("input",{type:"checkbox",className:"availability-switch",checked:!Qe.hasUnavailability||Qe.hasUnavailability&&!((rn=(un=Qe.unavailabilities)==null?void 0:un[0])!=null&&rn.isRunning),onChange:()=>{var go,Rs;Dt(Qe.doctor_id),Qe.hasUnavailability&&((Rs=(go=Qe.unavailabilities)==null?void 0:go[0])==null?void 0:Rs.isRunning)?Ot(!0):Yt(!0)}}),m.jsx("span",{className:"slider1"})]}),m.jsx("span",{className:"available",children:"Available"})]})})})}),m.jsx("td",{style:{color:"#199FD9"},children:Qe.isSuspended||!Qe.hasUnavailability?"--":m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"tbl-inr-date-slot1",children:[m.jsx("p",{children:"From:"}),m.jsxs("div",{className:"tble-inr-date",children:[m.jsx("div",{className:"date h3-title",children:(Ai=(Dn=Qe==null?void 0:Qe.unavailabilities)==null?void 0:Dn[0])==null?void 0:Ai.fromDate}),m.jsx("div",{className:"time",children:(mr=(ln=Qe==null?void 0:Qe.unavailabilities)==null?void 0:ln[0])==null?void 0:mr.fromTime})]})]}),m.jsxs("div",{className:"tbl-inr-date-slot1",children:[m.jsx("p",{children:"To:"}),m.jsxs("div",{className:"tble-inr-date",children:[m.jsx("div",{className:"date h3-title",children:(oi=(yr=Qe==null?void 0:Qe.unavailabilities)==null?void 0:yr[0])==null?void 0:oi.toDate}),m.jsx("div",{className:"time",children:(fo=(Bs=Qe==null?void 0:Qe.unavailabilities)==null?void 0:Bs[0])==null?void 0:fo.toTime})]})]})]})}),m.jsx("td",{style:{color:"#199FD9"},children:Qe.isSuspended||!Qe.hasUnavailability?"--":(Gc=(Hs=Qe==null?void 0:Qe.unavailabilities)==null?void 0:Hs[0])==null?void 0:Gc.type}),m.jsx("td",{style:{color:"#199FD9"},children:Qe.isSuspended||!Qe.hasUnavailability?"--":(Ra=(za=Qe==null?void 0:Qe.unavailabilities)==null?void 0:za[0])==null?void 0:Ra.status}),m.jsx("td",{style:{color:"#199FD9"},children:Qe.isSuspended||!Qe.hasUnavailability?"--":m.jsx("span",{dangerouslySetInnerHTML:{__html:(mo=(Uo=Qe==null?void 0:Qe.unavailabilities)==null?void 0:Uo[0])==null?void 0:mo.reason.replace(/(.{20})/g,"$1<br/>")}})})]},Kt)})]})]})}),We.length>0&&m.jsx(xu,{currentPage:De,totalPages:Be,onPageChange:ut,onPrevious:Mt,onNext:tn})]}),m.jsxs("div",{className:`myapintmnt-content-tab ${Gt==="completed"?"completed":""}`,style:{display:Gt==="completed"?"block":"none"},children:[m.jsx("div",{className:"myapintmnt-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{style:{width:"200px"},children:"Doctor Name"}),m.jsx("th",{children:"Applied On"}),m.jsx("th",{children:"From"}),m.jsx("th",{children:"To"}),m.jsx("th",{children:"Type"}),m.jsx("th",{children:"Status"}),m.jsx("th",{children:"Reason"}),m.jsx("th",{children:"Total Time"}),m.jsx("th",{children:"Action"})]})}),m.jsxs("tbody",{children:[fe.length==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center"},children:i?"Loading...":m.jsx("span",{style:{fontWeight:"400",fontSize:18},children:"No data found"})})}),fe.map((Qe,Kt)=>m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String((ae-1)*$+Kt+1).padStart(2,"0")}),m.jsx("td",{style:{color:"#199FD9"},children:Qe.doctorName}),m.jsx("td",{style:{textAlign:"left",maxWidth:"287px",color:"#199FD9"},children:Qe.appliedOn}),m.jsxs("td",{children:[m.jsx("div",{className:"date",style:{color:"#199FD9"},children:Qe.fromDate}),m.jsx("div",{className:"time",style:{color:"#199FD9"},children:Qe.fromTime})]}),m.jsxs("td",{children:[m.jsx("div",{className:"date",style:{color:"#199FD9"},children:Qe.toDate}),m.jsx("div",{className:"time",style:{color:"#199FD9"},children:Qe.toTime})]}),m.jsx("td",{style:{color:"#199FD9"},children:Qe.type}),m.jsx("td",{style:{color:"#199FD9"},children:Qe.status}),m.jsx("td",{style:{color:"#199FD9"},children:m.jsx("span",{dangerouslySetInnerHTML:{__html:Qe.reason.replace(/(.{20})/g,"$1<br/>")}})}),m.jsx("td",{style:{color:"#199FD9"},children:Qe.timePeriod}),m.jsx("td",{style:{color:"#199FD9"},children:Qe.status==="Approved"&&Qe.type==="Emergency"?Qe!=null&&Qe.emergency_status?"Approved":m.jsx(Pi,{style:{backgroundColor:"#199FD9"},className:"border-0 px-6 rounded-lg shadow-md text-white flex items-center gap-2",onClick:()=>be(Qe.unavailability_id),children:s?"Confirming..":"Confirm"}):Qe.status=="Approved"&&!Qe.approvalRequired?"Approved":Qe.status=="Rejected"&&!Qe.approvalRequired?"Rejected":Qe.status==="Pending"?m.jsx(m.Fragment,{children:m.jsxs("div",{style:{display:"flex",gap:"4px"},children:[m.jsx(Pi,{style:{backgroundColor:"#28a745",marginRight:"8px"},className:"border-0 px-4 rounded-lg shadow-md text-white flex items-center gap-2",onClick:()=>Ie(Qe.unavailability_id,"approved"),children:p?"Approving..":"Approve"}),m.jsx(Pi,{style:{backgroundColor:"#dc3545"},className:"border-0 px-4 rounded-lg shadow-md text-white flex items-center gap-2",onClick:()=>Re(Qe.unavailability_id,"rejected"),children:p?"Declining..":"Decline"})]})}):null})]},Kt))]})]})}),Q.length>0&&m.jsx(xu,{currentPage:ae,totalPages:te,onPageChange:pe,onPrevious:Je,onNext:Ne})]})]})]})})]}),m.jsx(po,{})]}),m.jsx(bn,{show:wn,onHide:()=>Yt(!1),className:"popup-wrp1 p-dcrse1",children:m.jsxs(bn.Body,{children:[m.jsx("button",{type:"button",className:"close1",onClick:()=>Yt(!1),children:m.jsx("span",{"aria-hidden":"true",children:m.jsx("img",{src:"./images/cross-blue.png",alt:"Icon"})})}),m.jsx("div",{className:"modal-icon1",children:m.jsx("img",{src:"./images/suspend-icon.svg",alt:"Icon"})}),m.jsxs("div",{className:"modal-header1 mb-4",children:[m.jsx("h2",{children:"Confirm Unavailability"}),m.jsx("p",{className:"m-0",children:"Are you sure you want to mark this doctor as unavailable?"}),m.jsxs("div",{className:"note",children:[m.jsx("strong",{children:"Note:"})," All appointments scheduled till the selected end time will be canceled and reassigned to other available doctors."]})]}),m.jsx("div",{className:"modal-body",children:m.jsx("div",{className:"unavailability-form",children:m.jsxs("form",{id:"unavailabilityForm",children:[m.jsxs("div",{className:"unavailability-form-inr1",children:[m.jsxs("div",{className:"formfield",children:[m.jsx("label",{htmlFor:"unavailability-start-date",children:"From"}),m.jsx("div",{className:"cstm-input-lbl1",children:m.jsx("input",{type:"date",id:"unavailability-start-date",name:"startDate",value:mt.startDate,onChange:Cr,placeholder:"Start Date"})})]}),m.jsxs("div",{className:"formfield",children:[m.jsx("label",{htmlFor:"unavailability-end-date",children:"To"}),m.jsx("div",{className:"cstm-input-lbl1",children:m.jsx("input",{type:"date",id:"unavailability-end-date",name:"endDate",value:mt.endDate,onChange:Cr})})]}),m.jsx("div",{className:"formfield",children:m.jsx("div",{className:"cstm-input-lbl1",children:m.jsx("input",{type:"time",id:"unavailability-start-time",name:"startTime",value:mt.startTime,onChange:Cr})})}),m.jsx("div",{className:"formfield",children:m.jsx("div",{className:"cstm-input-lbl1",children:m.jsx("input",{type:"time",id:"unavailability-end-time",name:"endTime",value:mt.endTime,onChange:Cr})})}),m.jsxs("div",{className:"formfield w-100",children:[m.jsx("label",{htmlFor:"unavailability-reason",children:"Reason"}),m.jsx("div",{className:"cstm-input-lbl1",children:m.jsx("input",{type:"text",id:"unavailability-reason",name:"reason",value:mt.reason,onChange:Cr,placeholder:"Enter reason for unavailability",required:!0})})]})]}),m.jsxs("div",{className:"btn-wrp1",children:[m.jsx("button",{type:"submit",id:"confirmUnavailabilityBtn",className:"cmn-btn1",onClick:he,disabled:O,children:O?"Processing...":"Confirm"}),m.jsx("button",{type:"button",onClick:()=>Yt(!1),className:"cmn-btn1",disabled:O,children:"Cancel"})]})]})})})]})}),m.jsx(bn,{show:Xn,onHide:()=>Ot(!1),className:"popup-wrp1",children:m.jsxs(bn.Body,{children:[m.jsx("button",{type:"button",className:"close1",onClick:()=>Ot(!1),children:m.jsx("span",{"aria-hidden":"true",children:m.jsx("img",{src:"./images/cross-blue.png",alt:"Icon"})})}),m.jsx("div",{className:"modal-icon1",children:m.jsx("img",{src:"./images/check-icon-blue.svg",alt:"Icon"})}),m.jsxs("div",{className:"modal-header1",children:[m.jsx("h2",{children:"Confirm Availability"}),m.jsx("p",{className:"m-0",children:"Are you sure you want to mark this doctor as available?"}),m.jsx("div",{className:"note",children:"Note: Patients can now book appointments with this doctor, and any previous restrictions will be lifted."})]}),m.jsxs("div",{className:"modal-footer1 btn-wrp1",children:[m.jsx("button",{type:"submit",id:"confirmAvailabilityBtn",className:"cmn-btn1",onClick:()=>Me(en),children:"Confirm"}),m.jsx("button",{type:"button",onClick:()=>Ot(!1),id:"cancelAvailabilityBtn",className:"cmn-btn1",children:"Cancel"})]})]})})]})},IRe="/images/calendar-tick-success.svg",NRe="/images/calendar-cancelled.svg",ORe="/images/calendar-changes.svg",DRe="/images/login/chat_icon_2.png",xRe=()=>{var K,ie,se,ue,ye,ae,ve,$,Q;const a=Li(),n=ds(),{doctorNotifications:i,loading:s,error:l}=Tr(te=>te.notification);F.useEffect(()=>{a(ep())},[a]);const[p,_]=F.useState([]),[T,w]=F.useState([]);F.useEffect(()=>{var fe,pe,Ne;const te=((fe=i==null?void 0:i.today)==null?void 0:fe.map(Je=>Je.id))??[],oe=((pe=i==null?void 0:i.yesterday)==null?void 0:pe.map(Je=>Je.id))??[],re=((Ne=i==null?void 0:i.older)==null?void 0:Ne.map(Je=>Je.id))??[];w([...te,...oe,...re])},[i]);const C=()=>{p.length===T.length?_([]):(console.log(T,"fff"),_(T))},O=()=>{if(p.length===0){ct.error("Please select atleast one notification");return}a(DN(p)).then(()=>{_([]),a(Av()),a(ep())})},k=te=>{_(oe=>oe.includes(te)?oe.filter(re=>re!==te):[...oe,te])},U=()=>{a(Vw({notification_ids:T})),a(ep()),a(Av())},Y=async te=>{if(te)try{const oe=[String(te)];a(Vw({notification_ids:oe}))}catch(oe){console.error("Error deleting notification:",oe)}},W=te=>{const oe=i[te];return(oe==null?void 0:oe.length)==0?null:m.jsxs("div",{className:"notifications-group",children:[m.jsx("div",{className:"group-header",children:m.jsx("h2",{children:(te==null?void 0:te.charAt(0).toUpperCase())+(te==null?void 0:te.slice(1))})}),m.jsx("ul",{className:"notifications-list",children:oe==null?void 0:oe.map(re=>{var fe,pe,Ne,Je,be,Ie,Re,Me,he;return m.jsxs("li",{className:"notification-item",onClick:()=>{(re==null?void 0:re.type)==="new_message"||k(re==null?void 0:re.id)},style:{backgroundColor:p.includes(re==null?void 0:re.id)?"#c0c0c0":re.is_read==="true"?"#f0f0f0":"#ffffff",borderLeft:p.includes(re==null?void 0:re.id)?"3px solid #d0d0d0":"none",color:(p.includes(re==null?void 0:re.id),"black"),cursor:"pointer"},children:[m.jsxs("div",{className:"notif-left",children:[m.jsx("div",{className:`notif-icon ${(fe=re==null?void 0:re.icon)!=null&&fe.includes("success")?"success":(pe=re==null?void 0:re.type)!=null&&pe.includes("appointment_cancelled")?"cancelled":"changed"}`,children:m.jsx("img",{src:(Ne=re==null?void 0:re.type)!=null&&Ne.includes("appointment_cancelled")?NRe:(Je=re==null?void 0:re.type)!=null&&Je.includes("appointment_success")?IRe:(be=re==null?void 0:re.type)!=null&&be.includes("new_message")?DRe:ORe,alt:"Icon"})}),(re==null?void 0:re.type)=="new_message"?m.jsxs("div",{className:"notif-text",children:[m.jsx("h3",{style:{fontWeight:re.is_read==="true"?"normal":"bold"},onClick:()=>{var De,qe,We,Be,bt,St;n("/completed-appointment-screen",{state:{id:(De=re==null?void 0:re.notification_data)==null?void 0:De.appointment_id,patientId:(qe=re==null?void 0:re.notification_data)==null?void 0:qe.patient_id,chat_id:(We=re==null?void 0:re.notification_data)==null?void 0:We.chat_channel,ds_code:(Be=re==null?void 0:re.notification_data)==null?void 0:Be.ds_code,referred:(bt=re==null?void 0:re.notification_data)==null?void 0:bt.referred,prescription_id:(St=re==null?void 0:re.notification_data)==null?void 0:St.prescription_id}}),Y(re==null?void 0:re.id)},children:re.title}),m.jsxs("p",{onClick:()=>{var De,qe,We,Be,bt,St;n("/completed-appointment-screen",{state:{id:(De=re==null?void 0:re.notification_data)==null?void 0:De.appointment_id,patientId:(qe=re==null?void 0:re.notification_data)==null?void 0:qe.patient_id,chat_id:(We=re==null?void 0:re.notification_data)==null?void 0:We.chat_channel,ds_code:(Be=re==null?void 0:re.notification_data)==null?void 0:Be.ds_code,referred:(bt=re==null?void 0:re.notification_data)==null?void 0:bt.referred,prescription_id:(St=re==null?void 0:re.notification_data)==null?void 0:St.prescription_id}}),Y(re==null?void 0:re.id)},children:[(Ie=re==null?void 0:re.message)==null?void 0:Ie.trim(),(Re=re==null?void 0:re.message)!=null&&Re.trim().endsWith(".")?"":"."]})]}):m.jsxs("div",{className:"notif-text",children:[m.jsx("h3",{style:{fontWeight:re.is_read==="true"?"normal":"bold"},children:re.title}),m.jsxs("p",{children:[(Me=re==null?void 0:re.message)==null?void 0:Me.trim(),(he=re==null?void 0:re.message)!=null&&he.trim().endsWith(".")?"":"."]})]})]}),m.jsxs("div",{style:{},children:[m.jsx("div",{className:"notif-time",style:ee(re.created_at)==="Just now"?{width:"69px"}:{},children:ee(re.created_at)}),(re==null?void 0:re.type)=="new_message"&&m.jsx("div",{style:{display:"flex",alignItems:"center",gap:"5px",marginTop:"10px"},children:m.jsx("input",{type:"checkbox",id:`delete-notification-${re.id}`,name:"delete-notification",value:re.id,onChange:()=>k(re==null?void 0:re.id),checked:p.includes(re==null?void 0:re.id),style:{transform:"scale(1.5)",marginLeft:5}})})]})]},re.id)})})]})},ee=te=>{const oe=new Date,re=new Date(te),fe=Math.floor((oe-re)/1e3);if(fe<60)return"Just now";if(fe<3600)return`${Math.floor(fe/60)}m`;if(fe<86400)return`${Math.floor(fe/3600)}h`;if(fe<172800)return"1d";{const pe=Math.floor(fe/86400);return pe<7?`${pe}d`:`${Math.floor(pe/7)}w`}};return m.jsx("main",{className:"doctor-panel",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(Ga,{})}),s?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsx("div",{className:"doc-panel-body",style:{minHeight:"450px"},children:m.jsxs("div",{className:"notifications-section",children:[m.jsxs("div",{className:"docpnl-sec-head text-center",children:[m.jsx("h1",{className:"h2-title px-5",children:"Notifications"}),m.jsx("div",{className:"back-btn",onClick:()=>window.history.back(),children:m.jsx("a",{href:"#",onClick:te=>te.preventDefault(),children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),(((K=i==null?void 0:i.today)==null?void 0:K.length)>0||((ie=i==null?void 0:i.yesterday)==null?void 0:ie.length)>0||((se=i==null?void 0:i.older)==null?void 0:se.length)>0)&&m.jsxs("div",{className:"bulk-actions",children:[m.jsxs("button",{className:"select-all-btn",onClick:C,children:[m.jsx("label",{htmlFor:"selectAll",children:"Select all"}),m.jsxs("div",{className:"radio-btn-wrp",children:[m.jsx("input",{type:"radio",name:"selectAction",id:"selectAll",checked:T.length>0&&p.length===T.length,readOnly:!0}),m.jsx("span",{})]})]}),m.jsxs("button",{className:"delete-all-btn",onClick:O,children:[m.jsx("label",{htmlFor:"deleteAll",children:"Delete"}),m.jsxs("div",{className:"radio-btn-wrp",children:[m.jsx("input",{type:"radio",name:"selectAction",id:"deleteAll",disabled:p.length===0}),m.jsx("span",{})]})]})]}),(((ue=i==null?void 0:i.today)==null?void 0:ue.length)>0||((ye=i==null?void 0:i.yesterday)==null?void 0:ye.length)>0||((ae=i==null?void 0:i.older)==null?void 0:ae.length)>0)&&m.jsx("div",{className:"group-header",style:{display:"flex",justifyContent:"flex-end"},children:m.jsx("button",{className:"mark-all-btn",onClick:U,children:"Mark all as read"})}),((ve=i==null?void 0:i.today)==null?void 0:ve.length)===0&&(($=i==null?void 0:i.yesterday)==null?void 0:$.length)===0&&((Q=i==null?void 0:i.older)==null?void 0:Q.length)===0?m.jsx("p",{style:{fontSize:"1.5rem",fontWeight:"500",color:"#6b7280",textAlign:"center",margin:"2rem 0",padding:"1.5rem",borderRadius:"0.5rem",width:"100%",maxWidth:"600px",marginLeft:"auto",marginRight:"auto"},children:s?"Loading...":"No Notifications found"}):m.jsxs(m.Fragment,{children:[W("today"),W("yesterday"),W("older")]})]})}),m.jsx(po,{})]})})},PRe=()=>{const[a,n]=F.useState(""),[i,s]=F.useState(""),[l,p]=F.useState(!1),[_,T]=F.useState(!1),[w,C]=F.useState(!1),O=Li(),k=Wi(),{email:U}=k.state||{},Y=async W=>{var K,ie;if(W.preventDefault(),!/^(?=.*[a-z])(?=.*[A-Z])(?=.*[\d\W]).{8,}$/.test(a)){toast.error("Password must be at least 8 characters long and include at least one uppercase letter, one lowercase letter, and one number or special character.");return}if(a!==i){toast.error("Passwords do not match");return}try{const se=await O(wN({email:U,password:a,password_confirmation:i}));(K=se.payload)!=null&&K.status?p(!0):toast.error(((ie=se.payload)==null?void 0:ie.message)||"Password creation failed")}catch{toast.error("An error occurred during password creation")}};return m.jsxs("div",{className:"sign-sec set-pass pt-0",children:[m.jsx("div",{className:"container",children:m.jsxs("div",{className:"sign-sec-inr",children:[m.jsx("div",{className:"docpnl-sec-head",children:m.jsx("div",{className:"back-btn",children:m.jsx(dn,{to:"/login-password",children:m.jsx("img",{src:"/images/left-arrow.svg",alt:"Icon"})})})}),m.jsxs("div",{className:"sign-inr-row row",children:[m.jsx("div",{className:"sign-left-wrp col-lg-7",children:m.jsxs("div",{className:"sign-left has-texture",children:[m.jsx("div",{className:"texture",children:m.jsx("img",{src:"/images/doctor-symbol.png",alt:"Doctor Symbol"})}),m.jsx("div",{className:"sign-left-img",children:m.jsx("img",{src:"/images/new-pass-bnr.png",alt:"Login Left Image"})})]})}),m.jsx("div",{className:"sign-right-wrp col-lg-5",children:m.jsxs("div",{className:"sign-right",children:[m.jsx("div",{className:"logo-wrp",children:m.jsx("div",{className:"logo-inr-wrp",children:m.jsx("span",{children:m.jsx("img",{src:"/images/logo.png",alt:"Logo"})})})}),m.jsx("div",{className:"sign-form",children:m.jsx("form",{onSubmit:Y,children:m.jsx("div",{className:"sign-form-steps-wrp",children:m.jsxs("div",{className:"sign-form-step",children:[m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Create Password"}),m.jsxs("div",{className:"input-pass-field",children:[m.jsx("input",{type:_?"text":"password",placeholder:"Password",required:!0,value:a,onChange:W=>{n(W.target.value)}}),m.jsx("span",{className:"eye-btn",onClick:()=>{T(!_)},style:{cursor:"pointer",position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)"},children:m.jsx("img",{src:_?"/images/eye-open.svg":"/images/eye-close.svg",alt:_?"Hide Password":"Show Password"})})]})]}),m.jsxs("div",{className:"formfield mb-0",children:[m.jsx("label",{children:"Confirm Password"}),m.jsxs("div",{className:"input-pass-field",children:[m.jsx("input",{type:w?"text":"password",placeholder:"Password",required:!0,value:i,onChange:W=>s(W.target.value)}),m.jsx("span",{className:"eye-btn",onClick:()=>{C(!w)},style:{cursor:"pointer",position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)"},children:m.jsx("img",{src:w?"/images/eye-open.svg":"/images/eye-close.svg",alt:w?"Hide Password":"Show Password"})})]})]}),m.jsx(Pi,{type:"submit",className:"orange-btn",children:"Continue"})]})})})})]})})]})]})}),m.jsxs(bn,{show:l,onHide:()=>p(!1),centered:!0,className:"popup-wrp",id:"congratulations",dialogClassName:"custom-modal",children:[m.jsx("style",{children:`
                    .custom-modal .modal-content {
                        padding: 30px 0 50px 0;
                        margin: 0;
                    }
                `}),m.jsx("div",{className:"modal-icon text-center mt-4",children:m.jsx("img",{src:"/images/check-icon.png",alt:"Icon"})}),m.jsxs(bn.Header,{closeButton:!1,className:"border-0 flex-column text-center",children:[m.jsx(bn.Title,{className:"w-100",children:m.jsx("h2",{children:"Congratulations"})}),m.jsx("p",{children:"Your account is ready to use."})]}),m.jsx(bn.Footer,{className:"d-flex justify-content-center border-0",children:m.jsx(dn,{to:"/doctor-home",className:"orange-btn",onClick:()=>p(!1),children:"Go to Dashboard"})})]})]})},kRe=()=>{var C,O;const[a,n]=F.useState(!1),[i,s]=F.useState("");ds();const l=Li(),{reminderPopupData:p,loading:_}=Tr(k=>k.notification),T=k=>k.replace(/(\.\d{3})\d*(Z)/,"$1$2");F.useEffect(()=>{l(LN())},[l]),F.useEffect(()=>{var ie;if(!((ie=p==null?void 0:p[0])!=null&&ie.appointment_datetime))return;const k=T(p[0].appointment_datetime),U=new Date(k);if(isNaN(U)){console.error("Invalid appointment datetime:",p[0].appointment_datetime);return}const Y=new Date,W=U.getTime()-Y.getTime(),ee=[{minutesBefore:10},{minutesBefore:2}],K=[];if(ee.forEach(({minutesBefore:se})=>{const ue=W-se*60*1e3;if(ue>0){const ye=setTimeout(()=>{const ae=`Your Appointment Starts in ${se} Minutes!`;s(ae),n(!0)},ue);K.push(ye)}}),W>0){const se=setTimeout(()=>{},W);K.push(se)}return()=>{K.forEach(clearTimeout)}},[p]);const w=k=>{const U=T(k),Y=new Date(U),W={weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};return Y.toLocaleString("en-US",W)};return m.jsx(m.Fragment,{children:a&&m.jsx("div",{className:"modal fade show",tabIndex:"-1",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.5)"},children:m.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:m.jsxs("div",{className:"modal-content text-center position-relative shadow",style:{width:"400px",minHeight:"280px",borderRadius:"20px",padding:"30px 20px"},children:[m.jsx("button",{type:"button",onClick:()=>n(!1),className:"position-absolute top-0 end-0 m-3 border-0 bg-transparent","aria-label":"Close",children:m.jsx("img",{src:"./images/cross-blue.png",alt:"Close Icon",style:{width:"24px",height:"24px"}})}),m.jsx("div",{className:"modal-icon mb-3",children:m.jsx("img",{src:"./images/bell-icon.svg",alt:"Reminder Icon",style:{width:"40px",height:"40px"}})}),m.jsxs("div",{className:"modal-header border-0 flex-column align-items-center p-0",children:[m.jsx("h2",{className:"fw-bold mb-2",style:{fontSize:"22px",color:"#333"},children:"Reminder:"}),m.jsx("p",{className:"m-0",style:{color:"#009CDE",fontWeight:"500"},children:i})]}),m.jsxs("div",{className:"modal-body p-0 mt-4",children:[m.jsxs("div",{className:"text-muted mb-2",children:["Patient's Name:"," ",m.jsx("span",{className:"fw-medium",style:{color:"#356598"},children:((C=p==null?void 0:p[0])==null?void 0:C.patient_name)||"Sunil"})]}),m.jsxs("div",{className:"text-muted",children:["Date and Time:"," ",m.jsx("span",{className:"fw-medium",style:{color:"#356598"},children:w((O=p==null?void 0:p[0])==null?void 0:O.appointment_datetime)})]}),m.jsx("button",{style:{backgroundColor:"#F47820",color:"white",border:"none",padding:"10px 20px",borderRadius:"5px",cursor:"pointer",marginTop:20},onClick:()=>n(!1),children:"Okay"})]})]})})})})},Sa=({children:a})=>m.jsxs("div",{children:[m.jsx(kRe,{}),m.jsx("main",{children:a})]}),Ta=({children:a})=>{const n=Wi(),i=localStorage.getItem("doctor-app"),[s,l]=F.useState(!1);return F.useEffect(()=>{i||(ct.error("Please Login First"),l(!0))},[i]),s?m.jsx(soe,{to:"/",state:{from:n},replace:!0}):i?a:null},LRe=()=>{var se,ue,ye,ae,ve;const a=Wi(),{id:n,patientId:i}=a.state||{},s=Li(),{symptomUploadDetail:l,loading:p}=Tr($=>$.user),[_,T]=F.useState({patient_name:"",dayDate:"",time:"",name:"",height:"",weight:"",age:"",gender:"",contactno:"",questions:"",files:[]}),[w,C]=F.useState(null),[O,k]=F.useState(!1),[U,Y]=F.useState(null),[W,ee]=F.useState(!1);F.useEffect(()=>{n&&s(NN({symptom_id:n}))},[s,n]),F.useEffect(()=>{l!=null&&l.basicInformation&&T({patient_name:l.patientData.patient_name||"",dayDate:l.patientData.dayDate||"",time:l.patientData.time||"",name:l.basicInformation.name||"",height:l.basicInformation.height||"",weight:l.basicInformation.weight||"",age:l.basicInformation.age||"",gender:l.basicInformation.gender||"",questions:l.symptomAnswers||"",files:l.symptomFiles||[]})},[l]);const K=($,Q)=>$.some(te=>Q.some(oe=>te.file_type.toLowerCase().includes(oe))),ie=$=>{Y($),ee(!0)};return m.jsx("main",{className:"doctor-panel",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(Ga,{})}),p?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"doc-panel-body appoint-details-pg has-texture papd-pg",children:[m.jsx("div",{className:"texture only-img",children:m.jsx("img",{src:"./images/doctor-symbol.png",alt:"Image"})}),m.jsxs("div",{className:"appointments",children:[m.jsxs("div",{className:"start-appointment cmn-mb",children:[m.jsxs("div",{className:"docpnl-sec-head",children:[m.jsx("h1",{className:"h2-title",children:"Symptom Upload Details"}),m.jsx("div",{className:"back-btn",children:m.jsx(dn,{to:"#",onClick:$=>{$.preventDefault(),window.history.back()},children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),m.jsxs("div",{className:"apointment-detail-card",children:[m.jsx("div",{className:"apoint-dtl-img",children:m.jsx("img",{src:`${mi}/${(se=l==null?void 0:l.patientData)==null?void 0:se.patient_profile}`,alt:"Client Image"})}),m.jsxs("div",{className:"appoint-dtl-content",children:[m.jsxs("div",{className:"appoint-dtl-left",children:[m.jsx("div",{className:"appoint-dtl-head",children:m.jsx("h2",{className:"h4-title",children:_.patient_name})}),m.jsx("div",{className:"date h3-title",children:_.dayDate}),m.jsx("div",{className:"time",children:_.time})]}),m.jsx(dn,{to:"/patient-profile",state:{patientId:i,source:"prescription",hideSchedule:!0},className:"cmn-btn",children:"View profile"})]})]})]}),m.jsx("div",{className:"patient-details-wrp",children:m.jsx("form",{children:m.jsxs("div",{className:"patient-dtl-form",children:[m.jsxs("div",{className:"patient-basic-info cmn-mb2",children:[m.jsx("h2",{children:"Basic Information"}),m.jsxs("div",{className:"row",children:[m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Full Name"}),m.jsx("input",{type:"text",placeholder:"Name",value:_.name,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Enter Your Height"}),m.jsx("input",{type:"text",placeholder:"175",value:_.height,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Enter Your Weight"}),m.jsx("input",{type:"text",placeholder:"70kg",value:_.weight,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Gender"}),m.jsx("input",{type:"text",placeholder:"Male",value:_.gender,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Enter Age"}),m.jsx("input",{type:"text",placeholder:"32",value:_.age,readOnly:!0})]})})]})]}),m.jsxs("div",{className:"scheduled-call-consultations cmn-mb2",children:[m.jsx("h2",{children:"Uploaded Symptoms"}),m.jsxs("div",{className:"row",children:[m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{style:{fontSize:"16px"},children:"1. How long are you suffering from this disease?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(ue=_.questions)==null?void 0:ue.answer1,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{style:{fontSize:"16px"},children:"2. Any other problem which you would like to share related to your problem?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(ye=_.questions)==null?void 0:ye.answer2,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{style:{fontSize:"16px"},children:"3. Do you have any history of this disease?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(ae=_.questions)==null?void 0:ae.answer3,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{style:{fontSize:"16px"},children:"4. Are you taking any medicines? If yes, please share the name of medicine and since how long you are taking this medicine?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(ve=_.questions)==null?void 0:ve.answer4,readOnly:!0})]})})]})]}),K(_.files,["jpg","jpeg","png","gif"])&&m.jsxs("div",{className:"view-uploaded-images-wrp",children:[m.jsx("h2",{children:"View Uploaded Images"}),m.jsx("div",{className:"view-uploaded-img",children:_.files.filter($=>["jpg","jpeg","png","gif"].some(Q=>$.file_type.toLowerCase().includes(Q))).map(($,Q)=>m.jsx("div",{className:"img-wrp",children:m.jsx("a",{href:"#",onClick:te=>{te.preventDefault(),C($),k(!0)},children:m.jsx("img",{src:`${mi}/${$.file_path}`,alt:`Symptom Image ${Q+1}`})})},Q))}),O&&w&&m.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center"},children:[m.jsx("button",{onClick:()=>k(!1),style:{position:"fixed",right:"30px",top:"30px",zIndex:1060,background:"transparent",border:"none",cursor:"pointer",padding:0},"aria-label":"Close",children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close",style:{width:"24px",height:"24px",filter:"brightness(0) invert(1)"}})}),m.jsx("div",{style:{maxWidth:"90vw",maxHeight:"90vh",display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsx("img",{src:`${mi}/${w.file_path}`,alt:"Enlarged view",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})})]})]}),K(_.files,["mp4","webm","ogg"])&&m.jsxs("div",{className:"view-uploaded-images-wrp uploaded-vdo-wrp",children:[m.jsx("h2",{children:"View Uploaded Videos"}),m.jsx("div",{className:"view-uploaded-img",children:_.files.filter($=>["mp4","webm","ogg"].some(Q=>$.file_type.toLowerCase().includes(Q))).map(($,Q)=>m.jsx("div",{className:"img-wrp",children:m.jsx("a",{href:"#",onClick:te=>{te.preventDefault(),ie($)},children:m.jsxs("video",{width:"100%",children:[m.jsx("source",{src:`${mi}/${$.file_path}`,type:`video/${$.file_type.split(".").pop()}`}),"Your browser does not support the video tag."]})})},Q))}),W&&U&&m.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center"},children:[m.jsx("button",{onClick:()=>ee(!1),style:{position:"fixed",right:"30px",top:"30px",zIndex:1060,background:"transparent",border:"none",cursor:"pointer",padding:0},"aria-label":"Close",children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close",style:{width:"24px",height:"24px",filter:"brightness(0) invert(1)"}})}),m.jsx("div",{style:{width:"80vw",maxWidth:"800px",maxHeight:"80vh",display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsxs("video",{controls:!0,autoPlay:!0,style:{width:"100%",maxHeight:"100%",objectFit:"contain"},children:[m.jsx("source",{src:`${mi}/${U.file_path}`,type:`video/${U.file_type.split(".").pop()}`}),"Your browser does not support the video tag."]})})]})]}),K(_.files,["pdf","doc","docx"])&&m.jsxs("div",{className:"view-uploaded-images-wrp upload-file-wrp",children:[m.jsx("h2",{children:"View Uploaded Files"}),m.jsx("div",{className:"view-uploaded-img",children:_.files.filter($=>["pdf","doc","docx"].some(Q=>$.file_type.toLowerCase().includes(Q))).map(($,Q)=>m.jsx("div",{className:"img-wrp",children:m.jsxs("a",{href:`${mi}/${$.file_path}`,target:"_blank",rel:"noopener noreferrer",children:[m.jsx("img",{src:"./images/file-icon.svg",alt:"File Icon"}),m.jsx("span",{className:"file-size",children:"Click to view"})]})},Q))})]}),m.jsx("div",{className:"btn-wrp",children:m.jsx(dn,{to:"/CompletedAssignedPrescription",state:{id:n,patientId:i},children:m.jsx("button",{type:"button",className:"orange-btn",children:"Respond"})})})]})})})]})]}),m.jsx(po,{})]})})},MRe=()=>{const a=Li(),n=Wi(),i=500,s=ds(),[l,p]=F.useState(!1),[_,T]=F.useState(""),{medicineSearch:w,loading2:C}=Tr(ut=>ut.user),O=new URLSearchParams(n.search),k=O.get("id"),U=O.get("patientId");F.useEffect(()=>{(!k||!U)&&s("/doctor-home")},[]),F.useEffect(()=>{a(Uw())},[a]);const{allMedicine:Y,loading:W,error:ee}=Tr(ut=>ut.userdata),K=_.length,[ie,se]=F.useState(Y),[ue,ye]=F.useState(!1);F.useEffect(()=>{Y&&se(Y)},[Y]),F.useEffect(()=>{a(Fw({appointment_id:k}))},[a,k]);const ae=F.useMemo(()=>{if(!Y||!Y.treatments)return[];const ut=new Set,tn=[];return Y.treatments.forEach(Mt=>{ut.has(Mt.medicine_name)||(ut.add(Mt.medicine_name),tn.push({medicine_id:Mt.medicine_id,medicine_name:Mt.medicine_name}))}),tn},[Y]),[ve,$]=F.useState(!1),[Q,te]=F.useState(!1),[oe,re]=F.useState(null),[fe,pe]=F.useState({medicine_name:"",dosage:"",duration:"",unit:"",with_water:"",dosage_frequency:"",meal_timing:"",day_time:"",remarks:""}),Ne=ut=>{switch(ut){case"morning":return"Morning";case"morning_afternoon":return"Morning + Afternoon";case"morning_evening":return"Morning + Evening";case"morning_afternoon_evening":return"Morning + Afternoon + Evening";case"morning_afternoon_evening_night":return"Morning + Afternoon + Evening + Night";case"morning_night":return"Morning + Night";case"night":return"Night";default:return ut}},Je=ut=>{switch(ut){case"before":return"Before";case"after":return"After";default:return ut}},be=ut=>{re({...ut,with_water:ut.with_water===1?"Yes":"No"}),$(!0)},Ie=()=>{$(!1),re(null)},Re=ut=>{const{name:tn,value:Mt}=ut.target;re(wn=>({...wn,[tn]:Mt}))},Me=()=>{let ut=!0;const tn=["medicine_name","dosage","duration","unit","with_water","dosage_frequency","meal_timing","day_time"];for(const wn of tn)if(!oe[wn]||String(oe[wn]).trim()===""){ct.error(`Please fill in the "${wn.replace(/_/g," ")}" field.`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),ut=!1;break}if(!ut)return;const Mt={...oe,with_water:oe.with_water==="Yes"?1:0};se(wn=>({...wn,treatments:wn.treatments.map(Yt=>Yt.treatment_id===Mt.treatment_id?Mt:Yt)})),Ie(),ct.success("Medicine updated successfully!")},he=ut=>{se(tn=>({...tn,treatments:tn.treatments.filter(Mt=>Mt.treatment_id!==ut)})),ct.info("Medicine deleted successfully!",{position:"top-center",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})},De=()=>{te(!0),pe({medicine_name:"",dosage:"",duration:"",unit:"",with_water:"",dosage_frequency:"",meal_timing:"",day_time:"",remarks:""})},qe=()=>{te(!1)},We=ut=>{const{name:tn,value:Mt}=ut.target;pe(wn=>{const Yt={...wn,[tn]:Mt};if(tn==="medicine_name"&&Mt){const Xn=w.find(Ot=>Ot.product_name===Mt);Xn&&Xn.unit&&(Yt.unit=Xn.unit)}return Yt})},Be=()=>{let ut=!0;const tn=["medicine_name","dosage","duration","unit","with_water","dosage_frequency","meal_timing","day_time"];for(const Ot of tn)if(!fe[Ot]||String(fe[Ot]).trim()===""){ct.error(`Please fill in the "${Ot.replace(/_/g," ")}" field.`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),ut=!1;break}if(fe.medicine_name.trim()||(ct.error("Please select a Medicine Name.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),ut=!1),ie.treatments&&ie.treatments.some(Ot=>Ot.medicine_name.toLowerCase()===fe.medicine_name.toLowerCase())&&(ct.error("Duplicate medicine not added. This medicine already exists in the table.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),ut=!1),!ut)return;const Mt=ie.treatments&&ie.treatments.length>0?Math.max(...ie.treatments.map(Ot=>Ot.treatment_id||0))+1:1,wn=w.find(Ot=>Ot.product_name===fe.medicine_name),Yt=wn?wn.product_code:Mt,Xn={...fe,treatment_id:Mt,medicine_id:Yt,with_water:fe.with_water==="Yes"?1:0};se(Ot=>({...Ot,treatments:[...Ot.treatments||[],Xn]})),qe(),ct.success("New medicine added successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"})},bt=()=>{ye(!0)},St=async()=>{var wn;if(ye(!1),p(!1),!ie||!ie.disease_name||!ie.treatments||ie.treatments.length===0){ct.warn("No data to submit! Please add at least one medicine.",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"});return}const ut=JSON.parse(localStorage.getItem("doctor-app")),tn=ut==null?void 0:ut.token;if(!tn){ct.error("Authentication token not found. Please log in again.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"});return}const Mt={appointment_id:k,diagnosis:ie.disease_name,notes:_,medicines:ie.treatments.map(Yt=>({medicine_name:Yt.medicine_name,dosage:Yt.dosage,duration:Yt.duration,unit:Yt.unit,with_water:Yt.with_water,dosage_frequency:String(Yt.dosage_frequency),meal_timing:Yt.meal_timing,day_time:Yt.day_time,remarks:Yt.remarks}))};try{p(!0);const Yt=await Ri.post(`${mi}api/doctor/prescriptions/submit_appointment_prescription`,Mt,{headers:{Authorization:`Bearer ${tn}`,"Content-Type":"application/json"}});Yt.data.status?(ct.success("Prescription data submitted successfully!",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark"}),p(!1),window.opener=null,window.open("","_self"),window.close()):(ct.error(Yt.data.message||"An error occurred.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),p(!1))}catch(Yt){console.error("API Call Error:",Yt),Yt.response?(console.error("Error response data:",(wn=Yt.response.data)==null?void 0:wn.message),console.error("Error response status:",Yt.response.status),ct.error(Yt.response.data.message||"Server error. Please try again.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})):Yt.request?ct.error("No response from server. Please check your internet connection.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}):ct.error("An unexpected error occurred. Please try again.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),p(!1)}};if(l)return m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})});if(ee)return m.jsxs("div",{className:"flex justify-center items-center h-screen text-red-600 font-bold text-lg",children:["Error: ",ee]});const Tt=ie&&Array.isArray(ie.treatments)&&ie.treatments.length>0;return m.jsx(m.Fragment,{children:C?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"container p-4 mx-auto font-sans bg-white",children:[m.jsx("div",{style:{width:"200px",border:"1px solid #ccc",padding:"8px",borderRadius:"6px",marginBottom:-40},children:m.jsx("h3",{className:"text-3xl font-bold text-gray-800 m-0",style:{fontSize:20},children:(ie==null?void 0:ie.disease_name)||"N/A"})}),m.jsx("div",{className:"mb-4 text-right",children:m.jsxs(Pi,{onClick:De,style:{backgroundColor:"#F47820"},className:"border-0 px-6 py-2 rounded-lg shadow-md text-white flex items-center gap-2 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-75",children:[m.jsx(rj,{style:{marginBottom:5,marginRight:5}}),"Add New Medicine"]})}),m.jsx("div",{className:"overflow-x-auto bg-white border-[#199FD9]",children:Tt?m.jsxs(Tq,{hover:!0,responsive:!0,className:"min-w-full text-center table-auto rounded-lg overflow-hidden",children:[m.jsx("thead",{style:{backgroundColor:"#199FD9",color:"white"},children:m.jsxs("tr",{children:[m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"S.No."}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Medicine Name"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Dosage"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Duration (For day)"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Unit"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"With Water"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Frequency (Times per day)"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Before/After Meal"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Day Time"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Remarks"}),m.jsx("th",{className:"px-4 py-3",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Actions"})]})}),m.jsx("tbody",{children:ie.treatments.map((ut,tn)=>m.jsxs("tr",{className:"hover:bg-gray-100",children:[m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:tn+1}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:ut.medicine_name}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:ut.dosage}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:ut.duration}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:ut.unit}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:ut.with_water===1?"Yes":"No"}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:ut.dosage_frequency}),m.jsxs("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:[Je(ut.meal_timing)," "]}),m.jsxs("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:[Ne(ut.day_time)," "]}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:ut.remarks}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:m.jsxs("div",{style:{display:"flex",gap:"8px"},children:[m.jsx("button",{onClick:()=>be(ut),style:{border:"none",background:"transparent",padding:"4px"},children:m.jsx(EK,{style:{color:"#199FD9"}})}),m.jsx("button",{onClick:()=>he(ut.treatment_id),style:{border:"none",background:"transparent",padding:"4px"},children:m.jsx(kX,{style:{color:"red"}})})]})})]},ut.treatment_id))})]}):m.jsxs("div",{className:"text-center py-5",children:[m.jsx("p",{className:"text-xl text-gray-600 font-semibold",children:"No Data Found"}),m.jsx("p",{className:"text-gray-500 mt-2",children:'Start by adding new medicines using the "Add New Medicine" button above.'})]})}),m.jsxs("div",{style:{display:"flex",flexDirection:"column",marginTop:10,marginBottom:20,position:"relative",width:"60%"},children:[m.jsx("h3",{children:"Advice/Suggestion/Investigation."}),m.jsx("textarea",{style:{width:"100%",height:100,border:"1px solid #199FD9",backgroundColor:"white",maxHeight:"200px",overflowY:"auto",padding:"8px",boxSizing:"border-box",resize:"vertical"},value:_,onChange:ut=>{ut.target.value.length<=i&&T(ut.target.value)},rows:4,cols:50,placeholder:"Enter your advice, suggestion, or investigation details here...",maxLength:i}),m.jsxs("div",{style:{position:"absolute",bottom:5,right:5,fontSize:"0.8em",color:K===i?"red":"#666",backgroundColor:"rgba(255, 255, 255, 0.7)",padding:"2px 5px",borderRadius:"3px",pointerEvents:"none"},children:[K,"/",i]})]}),Tt&&m.jsx("div",{className:"mt-6 text-center",children:m.jsxs(Pi,{className:"orange-btn",onClick:bt,children:[" ","Submit"]})}),m.jsxs(bn,{show:ve,onHide:Ie,centered:!0,children:[m.jsx(bn.Header,{closeButton:!0,style:{backgroundColor:"#199FD9",color:"white"},className:"add-new-med-close border-b-0 rounded-t-lg",children:m.jsx(bn.Title,{className:"text-xl font-bold",children:"Update Medicine"})}),m.jsx(bn.Body,{className:"p-6 bg-gray-50",children:oe&&m.jsxs(ot,{children:[m.jsxs(ot.Group,{className:"mb-3",controlId:"formMedicineName",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Medicine Name"}),m.jsx(ot.Control,{type:"text",name:"medicine_name",value:oe.medicine_name,onChange:Re,list:"medicineSuggestionsList",disabled:!0,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),m.jsx("datalist",{id:"medicineSuggestionsList",children:ae.map(ut=>m.jsx("option",{value:ut.medicine_name},ut.medicine_id))})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formDosage",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Dosage"}),m.jsx(ot.Control,{type:"text",name:"dosage",value:oe.dosage,onChange:Re,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formDuration",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Duration"}),m.jsx(ot.Control,{type:"text",name:"duration",value:oe.duration,onChange:Re,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formUnit",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Unit"}),m.jsxs(ot.Select,{name:"unit",value:oe.unit,onChange:Re,disabled:!0,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Unit"}),m.jsx("option",{value:"mg",children:"Milligram (mg)"}),m.jsx("option",{value:"g",children:"Gram (g)"}),m.jsx("option",{value:"tab",children:"Tablet (tab)"}),m.jsx("option",{value:"cap",children:"Capsule (cap)"}),m.jsx("option",{value:"ml",children:"Milliliter (mL)"}),m.jsx("option",{value:"drop",children:"Drop (drop)"}),m.jsx("option",{value:"tbsp",children:"Tablespoon (tbsp)"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formWithWater",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"With Water"}),m.jsxs(ot.Select,{name:"with_water",value:oe.with_water,onChange:Re,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select"}),m.jsx("option",{value:"Yes",children:"Yes"}),m.jsx("option",{value:"No",children:"No"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formDosageFrequency",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Dosage Frequency"}),m.jsx(ot.Control,{type:"number",name:"dosage_frequency",value:oe.dosage_frequency,onChange:Re,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formMealTiming",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Meal Timing"}),m.jsxs(ot.Select,{name:"meal_timing",value:oe.meal_timing,onChange:Re,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Before/After Meal"}),m.jsx("option",{value:"before",children:"Before "}),m.jsx("option",{value:"after",children:"After "})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formDayTime",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Day Time"}),m.jsxs(ot.Select,{name:"day_time",value:oe.day_time,onChange:Re,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select"}),m.jsx("option",{value:"morning",children:"Morning"}),m.jsx("option",{value:"morning_afternoon",children:"Morning + Afternoon"}),m.jsx("option",{value:"morning_evening",children:"Morning + Evening"}),m.jsx("option",{value:"morning_afternoon_evening",children:"Morning + Afternoon + Evening"}),m.jsx("option",{value:"morning_night",children:"Morning + Night"}),m.jsx("option",{value:"night",children:"Night"}),m.jsx("option",{value:"morning_afternoon_evening_night",children:"Morning + Afternoon + Evening + Night"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formRemarks",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Remarks (Optional)"}),m.jsx(ot.Control,{as:"textarea",rows:3,name:"remarks",value:oe.remarks||"",onChange:Re,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}),m.jsx(bn.Footer,{className:"justify-content-center p-4 bg-gray-100 border-t-0 rounded-b-lg",children:m.jsx(Pi,{onClick:Me,className:"orange-btn",style:{fontWeight:"600",padding:"0 42px"},children:"Update Changes"})})]}),m.jsxs(bn,{show:Q,onHide:qe,centered:!0,children:[m.jsx(bn.Header,{closeButton:!0,style:{backgroundColor:"#199FD9",color:"#fff"},className:"add-new-med-close border-b-0 rounded-t-lg",children:m.jsx(bn.Title,{className:"text-xl font-bold",children:"Add New Medicine"})}),m.jsx(bn.Body,{className:"p-6 bg-gray-50",children:m.jsxs(ot,{children:[m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewMedicineName",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Medicine Name"}),m.jsxs(ot.Select,{name:"medicine_name",value:fe.medicine_name,onChange:We,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Medicine"})," ",w&&w.length>0?w.map(ut=>m.jsx("option",{value:ut.product_name,children:ut.product_name},ut.product_code)):m.jsx("option",{value:"",disabled:!0,children:"Loading medicines..."})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewDosage",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Dosage"}),m.jsx(ot.Control,{type:"text",name:"dosage",value:fe.dosage,onChange:We,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewDuration",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Duration (For day)"}),m.jsx(ot.Control,{type:"text",name:"duration",value:fe.duration,onChange:We,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewUnit",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Unit"}),m.jsxs(ot.Select,{name:"unit",value:fe.unit,onChange:We,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Unit"}),m.jsx("option",{value:"mg",children:"Milligram (mg)"}),m.jsx("option",{value:"g",children:"Gram (g)"}),m.jsx("option",{value:"tab",children:"Tablet (tab)"}),m.jsx("option",{value:"cap",children:"Capsule (cap)"}),m.jsx("option",{value:"ml",children:"Milliliter (mL)"}),m.jsx("option",{value:"drop",children:"Drop (drop)"}),m.jsx("option",{value:"tbsp",children:"Tablespoon (tbsp)"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewWithWater",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"With Water"}),m.jsxs(ot.Select,{name:"with_water",value:fe.with_water,onChange:We,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select"}),m.jsx("option",{value:"Yes",children:"Yes"}),m.jsx("option",{value:"No",children:"No"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewDosageFrequency",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Dosage Frequency"}),m.jsx(ot.Control,{type:"number",name:"dosage_frequency",value:fe.dosage_frequency,onChange:We,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewMealTiming",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Meal Timing"}),m.jsxs(ot.Select,{name:"meal_timing",value:fe.meal_timing,onChange:We,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Before/After Meal"}),m.jsx("option",{value:"before",children:"Before"}),m.jsx("option",{value:"after",children:"After"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewDayTime",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Day Time"}),m.jsxs(ot.Select,{name:"day_time",value:fe.day_time,onChange:We,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select"}),m.jsx("option",{value:"morning",children:"Morning"}),m.jsx("option",{value:"morning_afternoon",children:"Morning + Afternoon"}),m.jsx("option",{value:"morning_evening",children:"Morning + Evening"}),m.jsx("option",{value:"morning_afternoon_evening",children:"Morning + Afternoon + Evening"}),m.jsx("option",{value:"morning_night",children:"Morning + Night"}),m.jsx("option",{value:"night",children:"Night"}),m.jsx("option",{value:"morning_afternoon_evening_night",children:"Morning + Afternoon + Evening + Night"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewRemarks",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Remarks (Optional)"}),m.jsx(ot.Control,{as:"textarea",rows:3,name:"remarks",value:fe.remarks||"",onChange:We,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}),m.jsx(bn.Footer,{className:"justify-content-center p-4 bg-gray-100 border-t-0 rounded-b-lg",children:m.jsx(Pi,{onClick:Be,className:"orange-btn",style:{fontWeight:"600",padding:"0 42px"},children:"Add Medicine"})})]}),m.jsx(bn,{show:ue,onHide:()=>ye(!1),centered:!0,dialogClassName:"custom-modal-dialog",children:m.jsxs("div",{className:"modal-content text-center position-relative shadow",style:{width:"auto",minHeight:"280px",padding:"30px 20px",backgroundColor:"white",overflow:"hidden"},children:[m.jsx("button",{type:"button",onClick:()=>ye(!1),className:"position-absolute top-0 end-0 m-3 border-0 bg-transparent","aria-label":"Close",children:m.jsx("img",{src:"./images/cross-blue.png",alt:"Close Icon",style:{width:"24px",height:"24px"}})}),m.jsx("div",{className:"modal-icon mb-3 mt-4",children:m.jsx("img",{src:"/images/logout-icon.svg",alt:"Info Icon",style:{width:"60px",height:"60px",color:"#199FD9"}})}),m.jsxs("div",{className:"modal-header border-0 flex-column align-items-center p-0",children:[" ",m.jsx("h2",{className:"fw-bold mb-2",style:{fontSize:"22px",color:"#333"},children:"Confirm Submission"}),m.jsx("p",{className:"m-0",style:{color:"black",fontSize:"16px"},children:"You cannot add more medicine after submission."}),m.jsx("p",{className:"m-0",style:{color:"black",fontSize:"16px",marginTop:"5px"},children:"Are you sure you want to submit the prescription?"})]}),m.jsxs("div",{className:"modal-body p-0 mt-5 d-flex justify-content-center gap-3",children:[" ",m.jsx(Pi,{variant:"outline-primary",onClick:()=>ye(!1),className:"px-4 py-2 rounded-md font-semibold",style:{borderColor:"#199FD9",color:"#199FD9",backgroundColor:"white",minWidth:"120px",fontSize:"16px"},children:"Cancel"}),m.jsx(Pi,{variant:"primary",onClick:St,className:"orange-btn px-4 py-2 rounded-md font-semibold",style:{backgroundColor:"#FF8C00",borderColor:"#FF8C00",color:"white",minWidth:"120px",fontSize:"16px"},children:"Confirm"})]})]})})]})})};function jRe(){return m.jsx(m.Fragment,{children:m.jsxs(ooe,{children:[m.jsx(wi,{path:"/",element:m.jsx(Wpe,{})}),m.jsx(wi,{path:"/login-password",element:m.jsx(zpe,{})}),m.jsx(wi,{path:"/forgot-password",element:m.jsx(Ype,{})}),m.jsx(wi,{path:"/otp-verification",element:m.jsx(qpe,{})}),m.jsx(wi,{path:"/set-password",element:m.jsx(Kpe,{})}),m.jsx(wi,{path:"/header",element:m.jsx(Ga,{})}),m.jsx(wi,{path:"/footer",element:m.jsx(po,{})}),m.jsx(wi,{path:"/doctor-home",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(ofe,{})})})}),m.jsx(wi,{path:"/patient-details",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(cfe,{})})})}),m.jsx(wi,{path:"/patient-profile",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(lfe,{})})})}),m.jsx(wi,{path:"/my-appointments",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(R8,{})})})}),m.jsx(wi,{path:"/schedule-appointment",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(pfe,{})})})}),m.jsx(wi,{path:"/completed-appointment-screen",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(Ave,{})})})}),m.jsx(wi,{path:"/videocall",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(Pve,{})})})}),m.jsx(wi,{path:"/PrescriptiveDoctor",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(MRe,{})})})}),m.jsx(wi,{path:"/pendingprescription",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(Lve,{})})})}),m.jsx(wi,{path:"/PendingAssignedPrescriptionDetails",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(LRe,{})})})}),m.jsx(wi,{path:"/CompletedAssignedPrescription",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(Vve,{})})})}),m.jsx(wi,{path:"/pendingfull",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(Mve,{})})})}),m.jsx(wi,{path:"/UserProfile",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(Fve,{})})})}),m.jsx(wi,{path:"/pastpatient",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(Bve,{})})})}),m.jsx(wi,{path:"/doctorUnavailibility",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(CRe,{})})})}),m.jsx(wi,{path:"/hod",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(ARe,{})})})}),m.jsx(wi,{path:"/create-password",element:m.jsx(PRe,{})}),m.jsx(wi,{path:"/notifications",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(xRe,{})})})}),m.jsx(wi,{path:"/myappointment",element:m.jsx(Ta,{children:m.jsx(Sa,{children:m.jsx(R8,{})})})}),m.jsx(wi,{path:"*",element:m.jsx(kve,{})})]})})}function Uf(){ct.error("Token Expired"),localStorage.removeItem("nfc-admin"),setTimeout(()=>{window.location.href="/"},1e3)}const bM=$t("faq/getAllContacts",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),wM=$t("faq/updateFeedback",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),RM=$t("faq/deleteContact",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),CM=$t("faq/getAllFaq",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)()).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),AM=$t("faq/createFaq",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),IM=$t("faq/editFaq",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),NM=$t("faq/deleteFaq",async(a,{rejectWithValue:n})=>{var i;try{return(await(void 0)(a)).data}catch(s){return n(((i=s.response)==null?void 0:i.data)||s.message)}}),URe=sm({name:"faqSlice",initialState:{allContacts:[],contactLoading:!1,contactError:null,allFaq:[],loading:!1,error:null},reducers:{},extraReducers:a=>{a.addCase(bM.pending,n=>{n.loading=!0,n.error=null}).addCase(bM.fulfilled,(n,i)=>{var s;n.loading=!1,n.allContacts=(s=i.payload)==null?void 0:s.data}).addCase(bM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch Contacts",i.payload.message=="Unauthenticated."&&Uf()}).addCase(wM.pending,n=>{n.loading=!0,n.error=null}).addCase(wM.fulfilled,(n,i)=>{var s;n.loading=!1,n.allContacts=(s=i.payload)==null?void 0:s.data,ct.success("Feedback updated successfully")}).addCase(wM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to update Contacts",ct.error(i.payload.message||"Failed to update Feedback"),i.payload.message=="Unauthenticated."&&Uf()}).addCase(RM.pending,n=>{n.loading=!0,n.error=null}).addCase(RM.fulfilled,(n,i)=>{n.loading=!1,n.allContacts=i.payload.data,ct.success("Contact deleted successfully")}).addCase(RM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to delete Faq",ct.error(i.payload.message||"Failed to delete Faq"),i.payload.message=="Unauthenticated."&&Uf()}).addCase(CM.pending,n=>{n.loading=!0,n.error=null}).addCase(CM.fulfilled,(n,i)=>{var s;n.loading=!1,n.allFaq=(s=i.payload)==null?void 0:s.data}).addCase(CM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch Faq's",i.payload.message=="Unauthenticated."&&Uf()}).addCase(AM.pending,n=>{n.loading=!0,n.error=null}).addCase(AM.fulfilled,(n,i)=>{var s;n.loading=!1,n.allFaq=(s=i.payload)==null?void 0:s.data,ct.success("Faq created successfully")}).addCase(AM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch Faq's",ct.error(i.payload.message||"Failed to create Faq"),i.payload.message=="Unauthenticated."&&Uf()}).addCase(IM.pending,n=>{n.loading=!0,n.error=null}).addCase(IM.fulfilled,(n,i)=>{n.loading=!1,n.allFaq=i.payload.data,n.message="Faq updated successfully",ct.success("Faq updated successfully")}).addCase(IM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to update Faq",ct.error(i.payload.message||"Failed to update Faq"),i.payload.message=="Unauthenticated."&&Uf()}).addCase(NM.pending,n=>{n.loading=!0,n.error=null}).addCase(NM.fulfilled,(n,i)=>{n.loading=!1,n.allFaq=i.payload.data,n.message="Faq deleted successfully",ct.success("Faq deleted successfully"),i.payload.message=="Unauthenticated."&&Uf()}).addCase(NM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to delete Faq",ct.error(i.payload.message||"Failed to delete Faq"),i.payload.message=="Unauthenticated."&&Uf()})}}),VRe=URe.reducer,FRe=ide({reducer:{user:Ppe,faqs:VRe,userdata:Qpe,appointments:Jpe,prescriptions:hfe,patientProfile:efe,notification:Hpe,info:nfe},devTools:!0}),BRe=()=>m.jsx(m.Fragment,{children:m.jsx(Ooe,{children:m.jsx(jRe,{})})});function HRe(){return m.jsxs(Ile,{store:FRe,children:[m.jsx(nj,{}),m.jsx(BRe,{})]})}gae.createRoot(document.getElementById("root")).render(m.jsxs(m.Fragment,{children:[m.jsx(HRe,{}),m.jsx(nj,{})]}));
