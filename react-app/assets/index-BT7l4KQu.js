var oae=Object.defineProperty;var cae=(s,n,i)=>n in s?oae(s,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[n]=i;var Kt=(s,n,i)=>cae(s,typeof n!="symbol"?n+"":n,i);function lae(s,n){for(var i=0;i<n.length;i++){const a=n[i];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in s)){const p=Object.getOwnPropertyDescriptor(a,l);p&&Object.defineProperty(s,l,p.get?p:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const p of l)if(p.type==="childList")for(const _ of p.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&a(_)}).observe(document,{childList:!0,subtree:!0});function i(l){const p={};return l.integrity&&(p.integrity=l.integrity),l.referrerPolicy&&(p.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?p.credentials="include":l.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function a(l){if(l.ep)return;l.ep=!0;const p=i(l);fetch(l.href,p)}})();var gL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _0(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var _L={exports:{}},vw={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TW;function dae(){if(TW)return vw;TW=1;var s=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function i(a,l,p){var _=null;if(p!==void 0&&(_=""+p),l.key!==void 0&&(_=""+l.key),"key"in l){p={};for(var T in l)T!=="key"&&(p[T]=l[T])}else p=l;return l=p.ref,{$$typeof:s,type:a,key:_,ref:l!==void 0?l:null,props:p}}return vw.Fragment=n,vw.jsx=i,vw.jsxs=i,vw}var bW;function uae(){return bW||(bW=1,_L.exports=dae()),_L.exports}var m=uae(),EL={exports:{}},ar={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wW;function hae(){if(wW)return ar;wW=1;var s=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),p=Symbol.for("react.consumer"),_=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),C=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),k=Symbol.iterator;function U(de){return de===null||typeof de!="object"?null:(de=k&&de[k]||de["@@iterator"],typeof de=="function"?de:null)}var G={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},z=Object.assign,J={};function X(de,De,xe){this.props=de,this.context=De,this.refs=J,this.updater=xe||G}X.prototype.isReactComponent={},X.prototype.setState=function(de,De){if(typeof de!="object"&&typeof de!="function"&&de!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,de,De,"setState")},X.prototype.forceUpdate=function(de){this.updater.enqueueForceUpdate(this,de,"forceUpdate")};function ie(){}ie.prototype=X.prototype;function oe(de,De,xe){this.props=de,this.context=De,this.refs=J,this.updater=xe||G}var ce=oe.prototype=new ie;ce.constructor=oe,z(ce,X.prototype),ce.isPureReactComponent=!0;var _e=Array.isArray,se={H:null,A:null,T:null,S:null,V:null},be=Object.prototype.hasOwnProperty;function ee(de,De,xe,Xe,ut,Pt){return xe=Pt.ref,{$$typeof:s,type:de,key:De,ref:xe!==void 0?xe:null,props:Pt}}function Q(de,De){return ee(de.type,De,void 0,void 0,void 0,de.props)}function q(de){return typeof de=="object"&&de!==null&&de.$$typeof===s}function ae(de){var De={"=":"=0",":":"=2"};return"$"+de.replace(/[=:]/g,function(xe){return De[xe]})}var re=/\/+/g;function fe(de,De){return typeof de=="object"&&de!==null&&de.key!=null?ae(""+de.key):De.toString(36)}function pe(){}function Re(de){switch(de.status){case"fulfilled":return de.value;case"rejected":throw de.reason;default:switch(typeof de.status=="string"?de.then(pe,pe):(de.status="pending",de.then(function(De){de.status==="pending"&&(de.status="fulfilled",de.value=De)},function(De){de.status==="pending"&&(de.status="rejected",de.reason=De)})),de.status){case"fulfilled":return de.value;case"rejected":throw de.reason}}throw de}function Ge(de,De,xe,Xe,ut){var Pt=typeof de;(Pt==="undefined"||Pt==="boolean")&&(de=null);var It=!1;if(de===null)It=!0;else switch(Pt){case"bigint":case"string":case"number":It=!0;break;case"object":switch(de.$$typeof){case s:case n:It=!0;break;case O:return It=de._init,Ge(It(de._payload),De,xe,Xe,ut)}}if(It)return ut=ut(de),It=Xe===""?"."+fe(de,0):Xe,_e(ut)?(xe="",It!=null&&(xe=It.replace(re,"$&/")+"/"),Ge(ut,De,xe,"",function(Tt){return Tt})):ut!=null&&(q(ut)&&(ut=Q(ut,xe+(ut.key==null||de&&de.key===ut.key?"":(""+ut.key).replace(re,"$&/")+"/")+It)),De.push(ut)),1;It=0;var zt=Xe===""?".":Xe+":";if(_e(de))for(var $t=0;$t<de.length;$t++)Xe=de[$t],Pt=zt+fe(Xe,$t),It+=Ge(Xe,De,xe,Pt,ut);else if($t=U(de),typeof $t=="function")for(de=$t.call(de),$t=0;!(Xe=de.next()).done;)Xe=Xe.value,Pt=zt+fe(Xe,$t++),It+=Ge(Xe,De,xe,Pt,ut);else if(Pt==="object"){if(typeof de.then=="function")return Ge(Re(de),De,xe,Xe,ut);throw De=String(de),Error("Objects are not valid as a React child (found: "+(De==="[object Object]"?"object with keys {"+Object.keys(de).join(", ")+"}":De)+"). If you meant to render a collection of children, use an array instead.")}return It}function ve(de,De,xe){if(de==null)return de;var Xe=[],ut=0;return Ge(de,Xe,"","",function(Pt){return De.call(xe,Pt,ut++)}),Xe}function Ne(de){if(de._status===-1){var De=de._result;De=De(),De.then(function(xe){(de._status===0||de._status===-1)&&(de._status=1,de._result=xe)},function(xe){(de._status===0||de._status===-1)&&(de._status=2,de._result=xe)}),de._status===-1&&(de._status=0,de._result=De)}if(de._status===1)return de._result.default;throw de._result}var Ce=typeof reportError=="function"?reportError:function(de){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var De=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof de=="object"&&de!==null&&typeof de.message=="string"?String(de.message):String(de),error:de});if(!window.dispatchEvent(De))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",de);return}console.error(de)};function Ue(){}return ar.Children={map:ve,forEach:function(de,De,xe){ve(de,function(){De.apply(this,arguments)},xe)},count:function(de){var De=0;return ve(de,function(){De++}),De},toArray:function(de){return ve(de,function(De){return De})||[]},only:function(de){if(!q(de))throw Error("React.Children.only expected to receive a single React element child.");return de}},ar.Component=X,ar.Fragment=i,ar.Profiler=l,ar.PureComponent=oe,ar.StrictMode=a,ar.Suspense=w,ar.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=se,ar.__COMPILER_RUNTIME={__proto__:null,c:function(de){return se.H.useMemoCache(de)}},ar.cache=function(de){return function(){return de.apply(null,arguments)}},ar.cloneElement=function(de,De,xe){if(de==null)throw Error("The argument must be a React element, but you passed "+de+".");var Xe=z({},de.props),ut=de.key,Pt=void 0;if(De!=null)for(It in De.ref!==void 0&&(Pt=void 0),De.key!==void 0&&(ut=""+De.key),De)!be.call(De,It)||It==="key"||It==="__self"||It==="__source"||It==="ref"&&De.ref===void 0||(Xe[It]=De[It]);var It=arguments.length-2;if(It===1)Xe.children=xe;else if(1<It){for(var zt=Array(It),$t=0;$t<It;$t++)zt[$t]=arguments[$t+2];Xe.children=zt}return ee(de.type,ut,void 0,void 0,Pt,Xe)},ar.createContext=function(de){return de={$$typeof:_,_currentValue:de,_currentValue2:de,_threadCount:0,Provider:null,Consumer:null},de.Provider=de,de.Consumer={$$typeof:p,_context:de},de},ar.createElement=function(de,De,xe){var Xe,ut={},Pt=null;if(De!=null)for(Xe in De.key!==void 0&&(Pt=""+De.key),De)be.call(De,Xe)&&Xe!=="key"&&Xe!=="__self"&&Xe!=="__source"&&(ut[Xe]=De[Xe]);var It=arguments.length-2;if(It===1)ut.children=xe;else if(1<It){for(var zt=Array(It),$t=0;$t<It;$t++)zt[$t]=arguments[$t+2];ut.children=zt}if(de&&de.defaultProps)for(Xe in It=de.defaultProps,It)ut[Xe]===void 0&&(ut[Xe]=It[Xe]);return ee(de,Pt,void 0,void 0,null,ut)},ar.createRef=function(){return{current:null}},ar.forwardRef=function(de){return{$$typeof:T,render:de}},ar.isValidElement=q,ar.lazy=function(de){return{$$typeof:O,_payload:{_status:-1,_result:de},_init:Ne}},ar.memo=function(de,De){return{$$typeof:C,type:de,compare:De===void 0?null:De}},ar.startTransition=function(de){var De=se.T,xe={};se.T=xe;try{var Xe=de(),ut=se.S;ut!==null&&ut(xe,Xe),typeof Xe=="object"&&Xe!==null&&typeof Xe.then=="function"&&Xe.then(Ue,Ce)}catch(Pt){Ce(Pt)}finally{se.T=De}},ar.unstable_useCacheRefresh=function(){return se.H.useCacheRefresh()},ar.use=function(de){return se.H.use(de)},ar.useActionState=function(de,De,xe){return se.H.useActionState(de,De,xe)},ar.useCallback=function(de,De){return se.H.useCallback(de,De)},ar.useContext=function(de){return se.H.useContext(de)},ar.useDebugValue=function(){},ar.useDeferredValue=function(de,De){return se.H.useDeferredValue(de,De)},ar.useEffect=function(de,De,xe){var Xe=se.H;if(typeof xe=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Xe.useEffect(de,De)},ar.useId=function(){return se.H.useId()},ar.useImperativeHandle=function(de,De,xe){return se.H.useImperativeHandle(de,De,xe)},ar.useInsertionEffect=function(de,De){return se.H.useInsertionEffect(de,De)},ar.useLayoutEffect=function(de,De){return se.H.useLayoutEffect(de,De)},ar.useMemo=function(de,De){return se.H.useMemo(de,De)},ar.useOptimistic=function(de,De){return se.H.useOptimistic(de,De)},ar.useReducer=function(de,De,xe){return se.H.useReducer(de,De,xe)},ar.useRef=function(de){return se.H.useRef(de)},ar.useState=function(de){return se.H.useState(de)},ar.useSyncExternalStore=function(de,De,xe){return se.H.useSyncExternalStore(de,De,xe)},ar.useTransition=function(){return se.H.useTransition()},ar.version="19.1.0",ar}var RW;function QO(){return RW||(RW=1,EL.exports=hae()),EL.exports}var F=QO();const We=_0(F),LY=lae({__proto__:null,default:We},[F]);var yL={exports:{}},Sw={},vL={exports:{}},SL={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CW;function pae(){return CW||(CW=1,function(s){function n(ve,Ne){var Ce=ve.length;ve.push(Ne);e:for(;0<Ce;){var Ue=Ce-1>>>1,de=ve[Ue];if(0<l(de,Ne))ve[Ue]=Ne,ve[Ce]=de,Ce=Ue;else break e}}function i(ve){return ve.length===0?null:ve[0]}function a(ve){if(ve.length===0)return null;var Ne=ve[0],Ce=ve.pop();if(Ce!==Ne){ve[0]=Ce;e:for(var Ue=0,de=ve.length,De=de>>>1;Ue<De;){var xe=2*(Ue+1)-1,Xe=ve[xe],ut=xe+1,Pt=ve[ut];if(0>l(Xe,Ce))ut<de&&0>l(Pt,Xe)?(ve[Ue]=Pt,ve[ut]=Ce,Ue=ut):(ve[Ue]=Xe,ve[xe]=Ce,Ue=xe);else if(ut<de&&0>l(Pt,Ce))ve[Ue]=Pt,ve[ut]=Ce,Ue=ut;else break e}}return Ne}function l(ve,Ne){var Ce=ve.sortIndex-Ne.sortIndex;return Ce!==0?Ce:ve.id-Ne.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var p=performance;s.unstable_now=function(){return p.now()}}else{var _=Date,T=_.now();s.unstable_now=function(){return _.now()-T}}var w=[],C=[],O=1,k=null,U=3,G=!1,z=!1,J=!1,X=!1,ie=typeof setTimeout=="function"?setTimeout:null,oe=typeof clearTimeout=="function"?clearTimeout:null,ce=typeof setImmediate<"u"?setImmediate:null;function _e(ve){for(var Ne=i(C);Ne!==null;){if(Ne.callback===null)a(C);else if(Ne.startTime<=ve)a(C),Ne.sortIndex=Ne.expirationTime,n(w,Ne);else break;Ne=i(C)}}function se(ve){if(J=!1,_e(ve),!z)if(i(w)!==null)z=!0,be||(be=!0,fe());else{var Ne=i(C);Ne!==null&&Ge(se,Ne.startTime-ve)}}var be=!1,ee=-1,Q=5,q=-1;function ae(){return X?!0:!(s.unstable_now()-q<Q)}function re(){if(X=!1,be){var ve=s.unstable_now();q=ve;var Ne=!0;try{e:{z=!1,J&&(J=!1,oe(ee),ee=-1),G=!0;var Ce=U;try{t:{for(_e(ve),k=i(w);k!==null&&!(k.expirationTime>ve&&ae());){var Ue=k.callback;if(typeof Ue=="function"){k.callback=null,U=k.priorityLevel;var de=Ue(k.expirationTime<=ve);if(ve=s.unstable_now(),typeof de=="function"){k.callback=de,_e(ve),Ne=!0;break t}k===i(w)&&a(w),_e(ve)}else a(w);k=i(w)}if(k!==null)Ne=!0;else{var De=i(C);De!==null&&Ge(se,De.startTime-ve),Ne=!1}}break e}finally{k=null,U=Ce,G=!1}Ne=void 0}}finally{Ne?fe():be=!1}}}var fe;if(typeof ce=="function")fe=function(){ce(re)};else if(typeof MessageChannel<"u"){var pe=new MessageChannel,Re=pe.port2;pe.port1.onmessage=re,fe=function(){Re.postMessage(null)}}else fe=function(){ie(re,0)};function Ge(ve,Ne){ee=ie(function(){ve(s.unstable_now())},Ne)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(ve){ve.callback=null},s.unstable_forceFrameRate=function(ve){0>ve||125<ve?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<ve?Math.floor(1e3/ve):5},s.unstable_getCurrentPriorityLevel=function(){return U},s.unstable_next=function(ve){switch(U){case 1:case 2:case 3:var Ne=3;break;default:Ne=U}var Ce=U;U=Ne;try{return ve()}finally{U=Ce}},s.unstable_requestPaint=function(){X=!0},s.unstable_runWithPriority=function(ve,Ne){switch(ve){case 1:case 2:case 3:case 4:case 5:break;default:ve=3}var Ce=U;U=ve;try{return Ne()}finally{U=Ce}},s.unstable_scheduleCallback=function(ve,Ne,Ce){var Ue=s.unstable_now();switch(typeof Ce=="object"&&Ce!==null?(Ce=Ce.delay,Ce=typeof Ce=="number"&&0<Ce?Ue+Ce:Ue):Ce=Ue,ve){case 1:var de=-1;break;case 2:de=250;break;case 5:de=1073741823;break;case 4:de=1e4;break;default:de=5e3}return de=Ce+de,ve={id:O++,callback:Ne,priorityLevel:ve,startTime:Ce,expirationTime:de,sortIndex:-1},Ce>Ue?(ve.sortIndex=Ce,n(C,ve),i(w)===null&&ve===i(C)&&(J?(oe(ee),ee=-1):J=!0,Ge(se,Ce-Ue))):(ve.sortIndex=de,n(w,ve),z||G||(z=!0,be||(be=!0,fe()))),ve},s.unstable_shouldYield=ae,s.unstable_wrapCallback=function(ve){var Ne=U;return function(){var Ce=U;U=Ne;try{return ve.apply(this,arguments)}finally{U=Ce}}}}(SL)),SL}var AW;function fae(){return AW||(AW=1,vL.exports=pae()),vL.exports}var TL={exports:{}},oo={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var IW;function mae(){if(IW)return oo;IW=1;var s=QO();function n(w){var C="https://react.dev/errors/"+w;if(1<arguments.length){C+="?args[]="+encodeURIComponent(arguments[1]);for(var O=2;O<arguments.length;O++)C+="&args[]="+encodeURIComponent(arguments[O])}return"Minified React error #"+w+"; visit "+C+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var a={d:{f:i,r:function(){throw Error(n(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},l=Symbol.for("react.portal");function p(w,C,O){var k=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:k==null?null:""+k,children:w,containerInfo:C,implementation:O}}var _=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function T(w,C){if(w==="font")return"";if(typeof C=="string")return C==="use-credentials"?C:""}return oo.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,oo.createPortal=function(w,C){var O=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!C||C.nodeType!==1&&C.nodeType!==9&&C.nodeType!==11)throw Error(n(299));return p(w,C,null,O)},oo.flushSync=function(w){var C=_.T,O=a.p;try{if(_.T=null,a.p=2,w)return w()}finally{_.T=C,a.p=O,a.d.f()}},oo.preconnect=function(w,C){typeof w=="string"&&(C?(C=C.crossOrigin,C=typeof C=="string"?C==="use-credentials"?C:"":void 0):C=null,a.d.C(w,C))},oo.prefetchDNS=function(w){typeof w=="string"&&a.d.D(w)},oo.preinit=function(w,C){if(typeof w=="string"&&C&&typeof C.as=="string"){var O=C.as,k=T(O,C.crossOrigin),U=typeof C.integrity=="string"?C.integrity:void 0,G=typeof C.fetchPriority=="string"?C.fetchPriority:void 0;O==="style"?a.d.S(w,typeof C.precedence=="string"?C.precedence:void 0,{crossOrigin:k,integrity:U,fetchPriority:G}):O==="script"&&a.d.X(w,{crossOrigin:k,integrity:U,fetchPriority:G,nonce:typeof C.nonce=="string"?C.nonce:void 0})}},oo.preinitModule=function(w,C){if(typeof w=="string")if(typeof C=="object"&&C!==null){if(C.as==null||C.as==="script"){var O=T(C.as,C.crossOrigin);a.d.M(w,{crossOrigin:O,integrity:typeof C.integrity=="string"?C.integrity:void 0,nonce:typeof C.nonce=="string"?C.nonce:void 0})}}else C==null&&a.d.M(w)},oo.preload=function(w,C){if(typeof w=="string"&&typeof C=="object"&&C!==null&&typeof C.as=="string"){var O=C.as,k=T(O,C.crossOrigin);a.d.L(w,O,{crossOrigin:k,integrity:typeof C.integrity=="string"?C.integrity:void 0,nonce:typeof C.nonce=="string"?C.nonce:void 0,type:typeof C.type=="string"?C.type:void 0,fetchPriority:typeof C.fetchPriority=="string"?C.fetchPriority:void 0,referrerPolicy:typeof C.referrerPolicy=="string"?C.referrerPolicy:void 0,imageSrcSet:typeof C.imageSrcSet=="string"?C.imageSrcSet:void 0,imageSizes:typeof C.imageSizes=="string"?C.imageSizes:void 0,media:typeof C.media=="string"?C.media:void 0})}},oo.preloadModule=function(w,C){if(typeof w=="string")if(C){var O=T(C.as,C.crossOrigin);a.d.m(w,{as:typeof C.as=="string"&&C.as!=="script"?C.as:void 0,crossOrigin:O,integrity:typeof C.integrity=="string"?C.integrity:void 0})}else a.d.m(w)},oo.requestFormReset=function(w){a.d.r(w)},oo.unstable_batchedUpdates=function(w,C){return w(C)},oo.useFormState=function(w,C,O){return _.H.useFormState(w,C,O)},oo.useFormStatus=function(){return _.H.useHostTransitionStatus()},oo.version="19.1.0",oo}var NW;function MY(){if(NW)return TL.exports;NW=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(n){console.error(n)}}return s(),TL.exports=mae(),TL.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OW;function gae(){if(OW)return Sw;OW=1;var s=fae(),n=QO(),i=MY();function a(d){var h="https://react.dev/errors/"+d;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)h+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+d+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function p(d){var h=d,y=d;if(d.alternate)for(;h.return;)h=h.return;else{d=h;do h=d,(h.flags&4098)!==0&&(y=h.return),d=h.return;while(d)}return h.tag===3?y:null}function _(d){if(d.tag===13){var h=d.memoizedState;if(h===null&&(d=d.alternate,d!==null&&(h=d.memoizedState)),h!==null)return h.dehydrated}return null}function T(d){if(p(d)!==d)throw Error(a(188))}function w(d){var h=d.alternate;if(!h){if(h=p(d),h===null)throw Error(a(188));return h!==d?null:d}for(var y=d,b=h;;){var N=y.return;if(N===null)break;var P=N.alternate;if(P===null){if(b=N.return,b!==null){y=b;continue}break}if(N.child===P.child){for(P=N.child;P;){if(P===y)return T(N),d;if(P===b)return T(N),h;P=P.sibling}throw Error(a(188))}if(y.return!==b.return)y=N,b=P;else{for(var Z=!1,ue=N.child;ue;){if(ue===y){Z=!0,y=N,b=P;break}if(ue===b){Z=!0,b=N,y=P;break}ue=ue.sibling}if(!Z){for(ue=P.child;ue;){if(ue===y){Z=!0,y=P,b=N;break}if(ue===b){Z=!0,b=P,y=N;break}ue=ue.sibling}if(!Z)throw Error(a(189))}}if(y.alternate!==b)throw Error(a(190))}if(y.tag!==3)throw Error(a(188));return y.stateNode.current===y?d:h}function C(d){var h=d.tag;if(h===5||h===26||h===27||h===6)return d;for(d=d.child;d!==null;){if(h=C(d),h!==null)return h;d=d.sibling}return null}var O=Object.assign,k=Symbol.for("react.element"),U=Symbol.for("react.transitional.element"),G=Symbol.for("react.portal"),z=Symbol.for("react.fragment"),J=Symbol.for("react.strict_mode"),X=Symbol.for("react.profiler"),ie=Symbol.for("react.provider"),oe=Symbol.for("react.consumer"),ce=Symbol.for("react.context"),_e=Symbol.for("react.forward_ref"),se=Symbol.for("react.suspense"),be=Symbol.for("react.suspense_list"),ee=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),q=Symbol.for("react.activity"),ae=Symbol.for("react.memo_cache_sentinel"),re=Symbol.iterator;function fe(d){return d===null||typeof d!="object"?null:(d=re&&d[re]||d["@@iterator"],typeof d=="function"?d:null)}var pe=Symbol.for("react.client.reference");function Re(d){if(d==null)return null;if(typeof d=="function")return d.$$typeof===pe?null:d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case z:return"Fragment";case X:return"Profiler";case J:return"StrictMode";case se:return"Suspense";case be:return"SuspenseList";case q:return"Activity"}if(typeof d=="object")switch(d.$$typeof){case G:return"Portal";case ce:return(d.displayName||"Context")+".Provider";case oe:return(d._context.displayName||"Context")+".Consumer";case _e:var h=d.render;return d=d.displayName,d||(d=h.displayName||h.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case ee:return h=d.displayName||null,h!==null?h:Re(d.type)||"Memo";case Q:h=d._payload,d=d._init;try{return Re(d(h))}catch{}}return null}var Ge=Array.isArray,ve=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ne=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ce={pending:!1,data:null,method:null,action:null},Ue=[],de=-1;function De(d){return{current:d}}function xe(d){0>de||(d.current=Ue[de],Ue[de]=null,de--)}function Xe(d,h){de++,Ue[de]=d.current,d.current=h}var ut=De(null),Pt=De(null),It=De(null),zt=De(null);function $t(d,h){switch(Xe(It,h),Xe(Pt,d),Xe(ut,null),h.nodeType){case 9:case 11:d=(d=h.documentElement)&&(d=d.namespaceURI)?aC(d):0;break;default:if(d=h.tagName,h=h.namespaceURI)h=aC(h),d=oC(h,d);else switch(d){case"svg":d=1;break;case"math":d=2;break;default:d=0}}xe(ut),Xe(ut,d)}function Tt(){xe(ut),xe(Pt),xe(It)}function on(d){d.memoizedState!==null&&Xe(zt,d);var h=ut.current,y=oC(h,d.type);h!==y&&(Xe(Pt,d),Xe(ut,y))}function fn(d){Pt.current===d&&(xe(ut),xe(Pt)),zt.current===d&&(xe(zt),Eg._currentValue=Ce)}var Ut=Object.prototype.hasOwnProperty,yt=s.unstable_scheduleCallback,an=s.unstable_cancelCallback,Dt=s.unstable_shouldYield,wt=s.unstable_requestPaint,rt=s.unstable_now,xt=s.unstable_getCurrentPriorityLevel,Mt=s.unstable_ImmediatePriority,Bn=s.unstable_UserBlockingPriority,ki=s.unstable_NormalPriority,zi=s.unstable_LowPriority,Cr=s.unstable_IdlePriority,Un=s.log,Li=s.unstable_setDisableYieldValue,vt=null,Bt=null;function bt(d){if(typeof Un=="function"&&Li(d),Bt&&typeof Bt.setStrictMode=="function")try{Bt.setStrictMode(vt,d)}catch{}}var rn=Math.clz32?Math.clz32:$r,Qn=Math.log,Ar=Math.LN2;function $r(d){return d>>>=0,d===0?32:31-(Qn(d)/Ar|0)|0}var br=256,ji=4194304;function ts(d){var h=d&42;if(h!==0)return h;switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return d&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return d}}function ns(d,h,y){var b=d.pendingLanes;if(b===0)return 0;var N=0,P=d.suspendedLanes,Z=d.pingedLanes;d=d.warmLanes;var ue=b&134217727;return ue!==0?(b=ue&~P,b!==0?N=ts(b):(Z&=ue,Z!==0?N=ts(Z):y||(y=ue&~d,y!==0&&(N=ts(y))))):(ue=b&~P,ue!==0?N=ts(ue):Z!==0?N=ts(Z):y||(y=b&~d,y!==0&&(N=ts(y)))),N===0?0:h!==0&&h!==N&&(h&P)===0&&(P=N&-N,y=h&-h,P>=y||P===32&&(y&4194048)!==0)?h:N}function Ra(d,h){return(d.pendingLanes&~(d.suspendedLanes&~d.pingedLanes)&h)===0}function Cs(d,h){switch(d){case 1:case 2:case 4:case 8:case 64:return h+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ca(){var d=br;return br<<=1,(br&4194048)===0&&(br=256),d}function je(){var d=ji;return ji<<=1,(ji&62914560)===0&&(ji=4194304),d}function sn(d){for(var h=[],y=0;31>y;y++)h.push(d);return h}function cn(d,h){d.pendingLanes|=h,h!==268435456&&(d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0)}function Yn(d,h,y,b,N,P){var Z=d.pendingLanes;d.pendingLanes=y,d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0,d.expiredLanes&=y,d.entangledLanes&=y,d.errorRecoveryDisabledLanes&=y,d.shellSuspendCounter=0;var ue=d.entanglements,we=d.expirationTimes,Be=d.hiddenUpdates;for(y=Z&~y;0<y;){var it=31-rn(y),mt=1<<it;ue[it]=0,we[it]=-1;var qe=Be[it];if(qe!==null)for(Be[it]=null,it=0;it<qe.length;it++){var Qe=qe[it];Qe!==null&&(Qe.lane&=-536870913)}y&=~mt}b!==0&&Ke(d,b,0),P!==0&&N===0&&d.tag!==0&&(d.suspendedLanes|=P&~(Z&~h))}function Ke(d,h,y){d.pendingLanes|=h,d.suspendedLanes&=~h;var b=31-rn(h);d.entangledLanes|=h,d.entanglements[b]=d.entanglements[b]|1073741824|y&4194090}function Yt(d,h){var y=d.entangledLanes|=h;for(d=d.entanglements;y;){var b=31-rn(y),N=1<<b;N&h|d[b]&h&&(d[b]|=h),y&=~N}}function un(d){switch(d){case 2:d=1;break;case 8:d=4;break;case 32:d=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:d=128;break;case 268435456:d=134217728;break;default:d=0}return d}function tn(d){return d&=-d,2<d?8<d?(d&134217727)!==0?32:268435456:8:2}function yn(){var d=Ne.p;return d!==0?d:(d=window.event,d===void 0?32:RC(d.type))}function ri(d,h){var y=Ne.p;try{return Ne.p=d,h()}finally{Ne.p=y}}var ln=Math.random().toString(36).slice(2),or="__reactFiber$"+ln,pr="__reactProps$"+ln,qr="__reactContainer$"+ln,rs="__reactEvents$"+ln,mo="__reactListeners$"+ln,Hs="__reactHandles$"+ln,Wc="__reactResources$"+ln,Ya="__reactMarker$"+ln;function Aa(d){delete d[or],delete d[pr],delete d[rs],delete d[mo],delete d[Hs]}function Vo(d){var h=d[or];if(h)return h;for(var y=d.parentNode;y;){if(h=y[qr]||y[or]){if(y=h.alternate,h.child!==null||y!==null&&y.child!==null)for(d=uC(d);d!==null;){if(y=d[or])return y;d=uC(d)}return h}d=y,y=d.parentNode}return null}function go(d){if(d=d[or]||d[qr]){var h=d.tag;if(h===5||h===6||h===13||h===26||h===27||h===3)return d}return null}function _o(d){var h=d.tag;if(h===5||h===26||h===27||h===6)return d.stateNode;throw Error(a(33))}function As(d){var h=d[Wc];return h||(h=d[Wc]={hoistableStyles:new Map,hoistableScripts:new Map}),h}function Ui(d){d[Ya]=!0}var Yu=new Set,qu={};function fa(d,h){Ml(d,h),Ml(d+"Capture",h)}function Ml(d,h){for(qu[d]=h,d=0;d<h.length;d++)Yu.add(h[d])}var W_=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Eo={},Ku={};function z_(d){return Ut.call(Ku,d)?!0:Ut.call(Eo,d)?!1:W_.test(d)?Ku[d]=!0:(Eo[d]=!0,!1)}function hi(d,h,y){if(z_(h))if(y===null)d.removeAttribute(h);else{switch(typeof y){case"undefined":case"function":case"symbol":d.removeAttribute(h);return;case"boolean":var b=h.toLowerCase().slice(0,5);if(b!=="data-"&&b!=="aria-"){d.removeAttribute(h);return}}d.setAttribute(h,""+y)}}function zc(d,h,y){if(y===null)d.removeAttribute(h);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":d.removeAttribute(h);return}d.setAttribute(h,""+y)}}function na(d,h,y,b){if(b===null)d.removeAttribute(y);else{switch(typeof b){case"undefined":case"function":case"symbol":case"boolean":d.removeAttribute(y);return}d.setAttributeNS(h,y,""+b)}}var Xu,Y_;function pc(d){if(Xu===void 0)try{throw Error()}catch(y){var h=y.stack.trim().match(/\n( *(at )?)/);Xu=h&&h[1]||"",Y_=-1<y.stack.indexOf(`
    at`)?" (<anonymous>)":-1<y.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Xu+d+Y_}var yp=!1;function Qu(d,h){if(!d||yp)return"";yp=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var b={DetermineComponentFrameRoot:function(){try{if(h){var mt=function(){throw Error()};if(Object.defineProperty(mt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(mt,[])}catch(Qe){var qe=Qe}Reflect.construct(d,[],mt)}else{try{mt.call()}catch(Qe){qe=Qe}d.call(mt.prototype)}}else{try{throw Error()}catch(Qe){qe=Qe}(mt=d())&&typeof mt.catch=="function"&&mt.catch(function(){})}}catch(Qe){if(Qe&&qe&&typeof Qe.stack=="string")return[Qe.stack,qe.stack]}return[null,null]}};b.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var N=Object.getOwnPropertyDescriptor(b.DetermineComponentFrameRoot,"name");N&&N.configurable&&Object.defineProperty(b.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var P=b.DetermineComponentFrameRoot(),Z=P[0],ue=P[1];if(Z&&ue){var we=Z.split(`
`),Be=ue.split(`
`);for(N=b=0;b<we.length&&!we[b].includes("DetermineComponentFrameRoot");)b++;for(;N<Be.length&&!Be[N].includes("DetermineComponentFrameRoot");)N++;if(b===we.length||N===Be.length)for(b=we.length-1,N=Be.length-1;1<=b&&0<=N&&we[b]!==Be[N];)N--;for(;1<=b&&0<=N;b--,N--)if(we[b]!==Be[N]){if(b!==1||N!==1)do if(b--,N--,0>N||we[b]!==Be[N]){var it=`
`+we[b].replace(" at new "," at ");return d.displayName&&it.includes("<anonymous>")&&(it=it.replace("<anonymous>",d.displayName)),it}while(1<=b&&0<=N);break}}}finally{yp=!1,Error.prepareStackTrace=y}return(y=d?d.displayName||d.name:"")?pc(y):""}function dm(d){switch(d.tag){case 26:case 27:case 5:return pc(d.type);case 16:return pc("Lazy");case 13:return pc("Suspense");case 19:return pc("SuspenseList");case 0:case 15:return Qu(d.type,!1);case 11:return Qu(d.type.render,!1);case 1:return Qu(d.type,!0);case 31:return pc("Activity");default:return""}}function vp(d){try{var h="";do h+=dm(d),d=d.return;while(d);return h}catch(y){return`
Error generating stack: `+y.message+`
`+y.stack}}function Ia(d){switch(typeof d){case"bigint":case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function Yc(d){var h=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function um(d){var h=Yc(d)?"checked":"value",y=Object.getOwnPropertyDescriptor(d.constructor.prototype,h),b=""+d[h];if(!d.hasOwnProperty(h)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var N=y.get,P=y.set;return Object.defineProperty(d,h,{configurable:!0,get:function(){return N.call(this)},set:function(Z){b=""+Z,P.call(this,Z)}}),Object.defineProperty(d,h,{enumerable:y.enumerable}),{getValue:function(){return b},setValue:function(Z){b=""+Z},stopTracking:function(){d._valueTracker=null,delete d[h]}}}}function Sp(d){d._valueTracker||(d._valueTracker=um(d))}function jr(d){if(!d)return!1;var h=d._valueTracker;if(!h)return!0;var y=h.getValue(),b="";return d&&(b=Yc(d)?d.checked?"true":"false":d.value),d=b,d!==y?(h.setValue(d),!0):!1}function $u(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}var q_=/[\n"\\]/g;function is(d){return d.replace(q_,function(h){return"\\"+h.charCodeAt(0).toString(16)+" "})}function yo(d,h,y,b,N,P,Z,ue){d.name="",Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"?d.type=Z:d.removeAttribute("type"),h!=null?Z==="number"?(h===0&&d.value===""||d.value!=h)&&(d.value=""+Ia(h)):d.value!==""+Ia(h)&&(d.value=""+Ia(h)):Z!=="submit"&&Z!=="reset"||d.removeAttribute("value"),h!=null?Od(d,Z,Ia(h)):y!=null?Od(d,Z,Ia(y)):b!=null&&d.removeAttribute("value"),N==null&&P!=null&&(d.defaultChecked=!!P),N!=null&&(d.checked=N&&typeof N!="function"&&typeof N!="symbol"),ue!=null&&typeof ue!="function"&&typeof ue!="symbol"&&typeof ue!="boolean"?d.name=""+Ia(ue):d.removeAttribute("name")}function Ju(d,h,y,b,N,P,Z,ue){if(P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(d.type=P),h!=null||y!=null){if(!(P!=="submit"&&P!=="reset"||h!=null))return;y=y!=null?""+Ia(y):"",h=h!=null?""+Ia(h):y,ue||h===d.value||(d.value=h),d.defaultValue=h}b=b??N,b=typeof b!="function"&&typeof b!="symbol"&&!!b,d.checked=ue?d.checked:!!b,d.defaultChecked=!!b,Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"&&(d.name=Z)}function Od(d,h,y){h==="number"&&$u(d.ownerDocument)===d||d.defaultValue===""+y||(d.defaultValue=""+y)}function jl(d,h,y,b){if(d=d.options,h){h={};for(var N=0;N<y.length;N++)h["$"+y[N]]=!0;for(y=0;y<d.length;y++)N=h.hasOwnProperty("$"+d[y].value),d[y].selected!==N&&(d[y].selected=N),N&&b&&(d[y].defaultSelected=!0)}else{for(y=""+Ia(y),h=null,N=0;N<d.length;N++){if(d[N].value===y){d[N].selected=!0,b&&(d[N].defaultSelected=!0);return}h!==null||d[N].disabled||(h=d[N])}h!==null&&(h.selected=!0)}}function ii(d,h,y){if(h!=null&&(h=""+Ia(h),h!==d.value&&(d.value=h),y==null)){d.defaultValue!==h&&(d.defaultValue=h);return}d.defaultValue=y!=null?""+Ia(y):""}function Zu(d,h,y,b){if(h==null){if(b!=null){if(y!=null)throw Error(a(92));if(Ge(b)){if(1<b.length)throw Error(a(93));b=b[0]}y=b}y==null&&(y=""),h=y}y=Ia(h),d.defaultValue=y,b=d.textContent,b===y&&b!==""&&b!==null&&(d.value=b)}function qa(d,h){if(h){var y=d.firstChild;if(y&&y===d.lastChild&&y.nodeType===3){y.nodeValue=h;return}}d.textContent=h}var Dd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tp(d,h,y){var b=h.indexOf("--")===0;y==null||typeof y=="boolean"||y===""?b?d.setProperty(h,""):h==="float"?d.cssFloat="":d[h]="":b?d.setProperty(h,y):typeof y!="number"||y===0||Dd.has(h)?h==="float"?d.cssFloat=y:d[h]=(""+y).trim():d[h]=y+"px"}function hm(d,h,y){if(h!=null&&typeof h!="object")throw Error(a(62));if(d=d.style,y!=null){for(var b in y)!y.hasOwnProperty(b)||h!=null&&h.hasOwnProperty(b)||(b.indexOf("--")===0?d.setProperty(b,""):b==="float"?d.cssFloat="":d[b]="");for(var N in h)b=h[N],h.hasOwnProperty(N)&&y[N]!==b&&Tp(d,N,b)}else for(var P in h)h.hasOwnProperty(P)&&Tp(d,P,h[P])}function eh(d){if(d.indexOf("-")===-1)return!1;switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hS=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),K_=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function bp(d){return K_.test(""+d)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":d}var Ul=null;function Fo(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var Vl=null,Fl=null;function pm(d){var h=go(d);if(h&&(d=h.stateNode)){var y=d[pr]||null;e:switch(d=h.stateNode,h.type){case"input":if(yo(d,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name),h=y.name,y.type==="radio"&&h!=null){for(y=d;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll('input[name="'+is(""+h)+'"][type="radio"]'),h=0;h<y.length;h++){var b=y[h];if(b!==d&&b.form===d.form){var N=b[pr]||null;if(!N)throw Error(a(90));yo(b,N.value,N.defaultValue,N.defaultValue,N.checked,N.defaultChecked,N.type,N.name)}}for(h=0;h<y.length;h++)b=y[h],b.form===d.form&&jr(b)}break e;case"textarea":ii(d,y.value,y.defaultValue);break e;case"select":h=y.value,h!=null&&jl(d,!!y.multiple,h,!1)}}}var qc=!1;function X_(d,h,y){if(qc)return d(h,y);qc=!0;try{var b=d(h);return b}finally{if(qc=!1,(Vl!==null||Fl!==null)&&(Ih(),Vl&&(h=Vl,d=Fl,Fl=Vl=null,pm(h),d)))for(h=0;h<d.length;h++)pm(d[h])}}function xd(d,h){var y=d.stateNode;if(y===null)return null;var b=y[pr]||null;if(b===null)return null;y=b[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(b=!b.disabled)||(d=d.type,b=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!b;break e;default:d=!1}if(d)return null;if(y&&typeof y!="function")throw Error(a(231,h,typeof y));return y}var fc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Bo=!1;if(fc)try{var th={};Object.defineProperty(th,"passive",{get:function(){Bo=!0}}),window.addEventListener("test",th,th),window.removeEventListener("test",th,th)}catch{Bo=!1}var Ka=null,Pd=null,Bl=null;function fm(){if(Bl)return Bl;var d,h=Pd,y=h.length,b,N="value"in Ka?Ka.value:Ka.textContent,P=N.length;for(d=0;d<y&&h[d]===N[d];d++);var Z=y-d;for(b=1;b<=Z&&h[y-b]===N[P-b];b++);return Bl=N.slice(d,1<b?1-b:void 0)}function Kc(d){var h=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&h===13&&(d=13)):d=h,d===10&&(d=13),32<=d||d===13?d:0}function mc(){return!0}function mm(){return!1}function Gs(d){function h(y,b,N,P,Z){this._reactName=y,this._targetInst=N,this.type=b,this.nativeEvent=P,this.target=Z,this.currentTarget=null;for(var ue in d)d.hasOwnProperty(ue)&&(y=d[ue],this[ue]=y?y(P):P[ue]);return this.isDefaultPrevented=(P.defaultPrevented!=null?P.defaultPrevented:P.returnValue===!1)?mc:mm,this.isPropagationStopped=mm,this}return O(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=mc)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=mc)},persist:function(){},isPersistent:mc}),h}var Kr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vo=Gs(Kr),Ws=O({},Kr,{view:0,detail:0}),gm=Gs(Ws),wp,Rp,Xc,ss=O({},Ws,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:sh,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==Xc&&(Xc&&d.type==="mousemove"?(wp=d.screenX-Xc.screenX,Rp=d.screenY-Xc.screenY):Rp=wp=0,Xc=d),wp)},movementY:function(d){return"movementY"in d?d.movementY:Rp}}),Ho=Gs(ss),Q_=O({},ss,{dataTransfer:0}),pS=Gs(Q_),Qc=O({},Ws,{relatedTarget:0}),nh=Gs(Qc),_m=O({},Kr,{animationName:0,elapsedTime:0,pseudoElement:0}),kd=Gs(_m),$_=O({},Kr,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),Ld=Gs($_),Em=O({},Kr,{data:0}),rh=Gs(Em),ih={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},J_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$c={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Hl(d){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(d):(d=$c[d])?!!h[d]:!1}function sh(){return Hl}var Z_=O({},Ws,{key:function(d){if(d.key){var h=ih[d.key]||d.key;if(h!=="Unidentified")return h}return d.type==="keypress"?(d=Kc(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?J_[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:sh,charCode:function(d){return d.type==="keypress"?Kc(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?Kc(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),Cp=Gs(Z_),eE=O({},ss,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ym=Gs(eE),Xa=O({},Ws,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:sh}),tE=Gs(Xa),Gl=O({},Kr,{propertyName:0,elapsedTime:0,pseudoElement:0}),vm=Gs(Gl),nE=O({},ss,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=Gs(nE),Na=O({},Kr,{newState:0,oldState:0}),rE=Gs(Na),iE=[9,13,27,32],Jc=fc&&"CompositionEvent"in window,A=null;fc&&"documentMode"in document&&(A=document.documentMode);var B=fc&&"TextEvent"in window&&!A,$=fc&&(!Jc||A&&8<A&&11>=A),ge=" ",Ve=!1;function Je(d,h){switch(d){case"keyup":return iE.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Nt(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var Sr=!1;function Is(d,h){switch(d){case"compositionend":return Nt(h);case"keypress":return h.which!==32?null:(Ve=!0,ge);case"textInput":return d=h.data,d===ge&&Ve?null:d;default:return null}}function qn(d,h){if(Sr)return d==="compositionend"||!Jc&&Je(d,h)?(d=fm(),Bl=Pd=Ka=null,Sr=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return $&&h.locale!=="ko"?null:h.data;default:return null}}var zs={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ns(d){var h=d&&d.nodeName&&d.nodeName.toLowerCase();return h==="input"?!!zs[d.type]:h==="textarea"}function Wl(d,h,y,b){Vl?Fl?Fl.push(b):Fl=[b]:Vl=b,h=ug(h,"onChange"),0<h.length&&(y=new vo("onChange","change",null,y,b),d.push({event:y,listeners:h}))}var Ys=null,Go=null;function Sm(d){ty(d,0)}function sE(d){var h=_o(d);if(jr(h))return d}function k0(d,h){if(d==="change")return h}var So=!1;if(fc){var fS;if(fc){var mS="oninput"in document;if(!mS){var L0=document.createElement("div");L0.setAttribute("oninput","return;"),mS=typeof L0.oninput=="function"}fS=mS}else fS=!1;So=fS&&(!document.documentMode||9<document.documentMode)}function M0(){Ys&&(Ys.detachEvent("onpropertychange",gS),Go=Ys=null)}function gS(d){if(d.propertyName==="value"&&sE(Go)){var h=[];Wl(h,Go,d,Fo(d)),X_(Sm,h)}}function HD(d,h,y){d==="focusin"?(M0(),Ys=h,Go=y,Ys.attachEvent("onpropertychange",gS)):d==="focusout"&&M0()}function GD(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return sE(Go)}function j0(d,h){if(d==="click")return sE(h)}function _S(d,h){if(d==="input"||d==="change")return sE(h)}function WD(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var To=typeof Object.is=="function"?Object.is:WD;function Md(d,h){if(To(d,h))return!0;if(typeof d!="object"||d===null||typeof h!="object"||h===null)return!1;var y=Object.keys(d),b=Object.keys(h);if(y.length!==b.length)return!1;for(b=0;b<y.length;b++){var N=y[b];if(!Ut.call(h,N)||!To(d[N],h[N]))return!1}return!0}function U0(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function V0(d,h){var y=U0(d);d=0;for(var b;y;){if(y.nodeType===3){if(b=d+y.textContent.length,d<=h&&b>=h)return{node:y,offset:h-d};d=b}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=U0(y)}}function F0(d,h){return d&&h?d===h?!0:d&&d.nodeType===3?!1:h&&h.nodeType===3?F0(d,h.parentNode):"contains"in d?d.contains(h):d.compareDocumentPosition?!!(d.compareDocumentPosition(h)&16):!1:!1}function zl(d){d=d!=null&&d.ownerDocument!=null&&d.ownerDocument.defaultView!=null?d.ownerDocument.defaultView:window;for(var h=$u(d.document);h instanceof d.HTMLIFrameElement;){try{var y=typeof h.contentWindow.location.href=="string"}catch{y=!1}if(y)d=h.contentWindow;else break;h=$u(d.document)}return h}function ES(d){var h=d&&d.nodeName&&d.nodeName.toLowerCase();return h&&(h==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||h==="textarea"||d.contentEditable==="true")}var zD=fc&&"documentMode"in document&&11>=document.documentMode,Os=null,yS=null,Tm=null,vS=!1;function B0(d,h,y){var b=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;vS||Os==null||Os!==$u(b)||(b=Os,"selectionStart"in b&&ES(b)?b={start:b.selectionStart,end:b.selectionEnd}:(b=(b.ownerDocument&&b.ownerDocument.defaultView||window).getSelection(),b={anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}),Tm&&Md(Tm,b)||(Tm=b,b=ug(yS,"onSelect"),0<b.length&&(h=new vo("onSelect","select",null,h,y),d.push({event:h,listeners:b}),h.target=Os)))}function jd(d,h){var y={};return y[d.toLowerCase()]=h.toLowerCase(),y["Webkit"+d]="webkit"+h,y["Moz"+d]="moz"+h,y}var Ap={animationend:jd("Animation","AnimationEnd"),animationiteration:jd("Animation","AnimationIteration"),animationstart:jd("Animation","AnimationStart"),transitionrun:jd("Transition","TransitionRun"),transitionstart:jd("Transition","TransitionStart"),transitioncancel:jd("Transition","TransitionCancel"),transitionend:jd("Transition","TransitionEnd")},SS={},H0={};fc&&(H0=document.createElement("div").style,"AnimationEvent"in window||(delete Ap.animationend.animation,delete Ap.animationiteration.animation,delete Ap.animationstart.animation),"TransitionEvent"in window||delete Ap.transitionend.transition);function Ud(d){if(SS[d])return SS[d];if(!Ap[d])return d;var h=Ap[d],y;for(y in h)if(h.hasOwnProperty(y)&&y in H0)return SS[d]=h[y];return d}var G0=Ud("animationend"),W0=Ud("animationiteration"),aE=Ud("animationstart"),TS=Ud("transitionrun"),YD=Ud("transitionstart"),Ze=Ud("transitioncancel"),z0=Ud("transitionend"),Y0=new Map,bS="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");bS.push("scrollEnd");function gc(d,h){Y0.set(d,h),fa(h,[d])}var wS=new WeakMap;function bo(d,h){if(typeof d=="object"&&d!==null){var y=wS.get(d);return y!==void 0?y:(h={value:d,source:h,stack:vp(h)},wS.set(d,h),h)}return{value:d,source:h,stack:vp(h)}}var Wo=[],Ip=0,RS=0;function ah(){for(var d=Ip,h=RS=Ip=0;h<d;){var y=Wo[h];Wo[h++]=null;var b=Wo[h];Wo[h++]=null;var N=Wo[h];Wo[h++]=null;var P=Wo[h];if(Wo[h++]=null,b!==null&&N!==null){var Z=b.pending;Z===null?N.next=N:(N.next=Z.next,Z.next=N),b.pending=N}P!==0&&bm(y,N,P)}}function Vd(d,h,y,b){Wo[Ip++]=d,Wo[Ip++]=h,Wo[Ip++]=y,Wo[Ip++]=b,RS|=b,d.lanes|=b,d=d.alternate,d!==null&&(d.lanes|=b)}function CS(d,h,y,b){return Vd(d,h,y,b),Op(d)}function Np(d,h){return Vd(d,null,null,h),Op(d)}function bm(d,h,y){d.lanes|=y;var b=d.alternate;b!==null&&(b.lanes|=y);for(var N=!1,P=d.return;P!==null;)P.childLanes|=y,b=P.alternate,b!==null&&(b.childLanes|=y),P.tag===22&&(d=P.stateNode,d===null||d._visibility&1||(N=!0)),d=P,P=P.return;return d.tag===3?(P=d.stateNode,N&&h!==null&&(N=31-rn(y),d=P.hiddenUpdates,b=d[N],b===null?d[N]=[h]:b.push(h),h.lane=y|536870912),P):null}function Op(d){if(50<cg)throw cg=0,bT=null,Error(a(185));for(var h=d.return;h!==null;)d=h,h=d.return;return d.tag===3?d.stateNode:null}var Yl={};function qD(d,h,y,b){this.tag=d,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wo(d,h,y,b){return new qD(d,h,y,b)}function AS(d){return d=d.prototype,!(!d||!d.isReactComponent)}function ql(d,h){var y=d.alternate;return y===null?(y=wo(d.tag,h,d.key,d.mode),y.elementType=d.elementType,y.type=d.type,y.stateNode=d.stateNode,y.alternate=d,d.alternate=y):(y.pendingProps=h,y.type=d.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=d.flags&65011712,y.childLanes=d.childLanes,y.lanes=d.lanes,y.child=d.child,y.memoizedProps=d.memoizedProps,y.memoizedState=d.memoizedState,y.updateQueue=d.updateQueue,h=d.dependencies,y.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},y.sibling=d.sibling,y.index=d.index,y.ref=d.ref,y.refCleanup=d.refCleanup,y}function oE(d,h){d.flags&=65011714;var y=d.alternate;return y===null?(d.childLanes=0,d.lanes=h,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=y.childLanes,d.lanes=y.lanes,d.child=y.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=y.memoizedProps,d.memoizedState=y.memoizedState,d.updateQueue=y.updateQueue,d.type=y.type,h=y.dependencies,d.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),d}function cE(d,h,y,b,N,P){var Z=0;if(b=d,typeof d=="function")AS(d)&&(Z=1);else if(typeof d=="string")Z=ZT(d,y,ut.current)?26:d==="html"||d==="head"||d==="body"?27:5;else e:switch(d){case q:return d=wo(31,y,h,N),d.elementType=q,d.lanes=P,d;case z:return Fd(y.children,N,P,h);case J:Z=8,N|=24;break;case X:return d=wo(12,y,h,N|2),d.elementType=X,d.lanes=P,d;case se:return d=wo(13,y,h,N),d.elementType=se,d.lanes=P,d;case be:return d=wo(19,y,h,N),d.elementType=be,d.lanes=P,d;default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case ie:case ce:Z=10;break e;case oe:Z=9;break e;case _e:Z=11;break e;case ee:Z=14;break e;case Q:Z=16,b=null;break e}Z=29,y=Error(a(130,d===null?"null":typeof d,"")),b=null}return h=wo(Z,y,h,N),h.elementType=d,h.type=b,h.lanes=P,h}function Fd(d,h,y,b){return d=wo(7,d,b,h),d.lanes=y,d}function Qa(d,h,y){return d=wo(6,d,null,h),d.lanes=y,d}function IS(d,h,y){return h=wo(4,d.children!==null?d.children:[],d.key,h),h.lanes=y,h.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},h}var Zc=[],Dp=0,lE=null,dE=0,Ro=[],zo=0,oh=null,Kl=1,_c="";function ch(d,h){Zc[Dp++]=dE,Zc[Dp++]=lE,lE=d,dE=h}function NS(d,h,y){Ro[zo++]=Kl,Ro[zo++]=_c,Ro[zo++]=oh,oh=d;var b=Kl;d=_c;var N=32-rn(b)-1;b&=~(1<<N),y+=1;var P=32-rn(h)+N;if(30<P){var Z=N-N%5;P=(b&(1<<Z)-1).toString(32),b>>=Z,N-=Z,Kl=1<<32-rn(h)+N|y<<N|b,_c=P+d}else Kl=1<<P|y<<N|b,_c=d}function uE(d){d.return!==null&&(ch(d,1),NS(d,1,0))}function OS(d){for(;d===lE;)lE=Zc[--Dp],Zc[Dp]=null,dE=Zc[--Dp],Zc[Dp]=null;for(;d===oh;)oh=Ro[--zo],Ro[zo]=null,_c=Ro[--zo],Ro[zo]=null,Kl=Ro[--zo],Ro[zo]=null}var ma=null,Ii=null,Ur=!1,lh=null,el=!1,DS=Error(a(519));function dh(d){var h=Error(a(418,""));throw Rm(bo(h,d)),DS}function xS(d){var h=d.stateNode,y=d.type,b=d.memoizedProps;switch(h[or]=d,h[pr]=b,y){case"dialog":rr("cancel",h),rr("close",h);break;case"iframe":case"object":case"embed":rr("load",h);break;case"video":case"audio":for(y=0;y<af.length;y++)rr(af[y],h);break;case"source":rr("error",h);break;case"img":case"image":case"link":rr("error",h),rr("load",h);break;case"details":rr("toggle",h);break;case"input":rr("invalid",h),Ju(h,b.value,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name,!0),Sp(h);break;case"select":rr("invalid",h);break;case"textarea":rr("invalid",h),Zu(h,b.value,b.defaultValue,b.children),Sp(h)}y=b.children,typeof y!="string"&&typeof y!="number"&&typeof y!="bigint"||h.textContent===""+y||b.suppressHydrationWarning===!0||sy(h.textContent,y)?(b.popover!=null&&(rr("beforetoggle",h),rr("toggle",h)),b.onScroll!=null&&rr("scroll",h),b.onScrollEnd!=null&&rr("scrollend",h),b.onClick!=null&&(h.onclick=hg),h=!0):h=!1,h||dh(d)}function hE(d){for(ma=d.return;ma;)switch(ma.tag){case 5:case 13:el=!1;return;case 27:case 3:el=!0;return;default:ma=ma.return}}function wm(d){if(d!==ma)return!1;if(!Ur)return hE(d),Ur=!0,!1;var h=d.tag,y;if((y=h!==3&&h!==27)&&((y=h===5)&&(y=d.type,y=!(y!=="form"&&y!=="button")||YT(d.type,d.memoizedProps)),y=!y),y&&Ii&&dh(d),hE(d),h===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(a(317));e:{for(d=d.nextSibling,h=0;d;){if(d.nodeType===8)if(y=d.data,y==="/$"){if(h===0){Ii=Cc(d.nextSibling);break e}h--}else y!=="$"&&y!=="$!"&&y!=="$?"||h++;d=d.nextSibling}Ii=null}}else h===27?(h=Ii,iu(d.type)?(d=XT,XT=null,Ii=d):Ii=h):Ii=ma?Cc(d.stateNode.nextSibling):null;return!0}function uh(){Ii=ma=null,Ur=!1}function q0(){var d=lh;return d!==null&&(ks===null?ks=d:ks.push.apply(ks,d),lh=null),d}function Rm(d){lh===null?lh=[d]:lh.push(d)}var PS=De(null),hh=null,Xl=null;function Bd(d,h,y){Xe(PS,h._currentValue),h._currentValue=y}function Ql(d){d._currentValue=PS.current,xe(PS)}function kS(d,h,y){for(;d!==null;){var b=d.alternate;if((d.childLanes&h)!==h?(d.childLanes|=h,b!==null&&(b.childLanes|=h)):b!==null&&(b.childLanes&h)!==h&&(b.childLanes|=h),d===y)break;d=d.return}}function LS(d,h,y,b){var N=d.child;for(N!==null&&(N.return=d);N!==null;){var P=N.dependencies;if(P!==null){var Z=N.child;P=P.firstContext;e:for(;P!==null;){var ue=P;P=N;for(var we=0;we<h.length;we++)if(ue.context===h[we]){P.lanes|=y,ue=P.alternate,ue!==null&&(ue.lanes|=y),kS(P.return,y,d),b||(Z=null);break e}P=ue.next}}else if(N.tag===18){if(Z=N.return,Z===null)throw Error(a(341));Z.lanes|=y,P=Z.alternate,P!==null&&(P.lanes|=y),kS(Z,y,d),Z=null}else Z=N.child;if(Z!==null)Z.return=N;else for(Z=N;Z!==null;){if(Z===d){Z=null;break}if(N=Z.sibling,N!==null){N.return=Z.return,Z=N;break}Z=Z.return}N=Z}}function Cm(d,h,y,b){d=null;for(var N=h,P=!1;N!==null;){if(!P){if((N.flags&524288)!==0)P=!0;else if((N.flags&262144)!==0)break}if(N.tag===10){var Z=N.alternate;if(Z===null)throw Error(a(387));if(Z=Z.memoizedProps,Z!==null){var ue=N.type;To(N.pendingProps.value,Z.value)||(d!==null?d.push(ue):d=[ue])}}else if(N===zt.current){if(Z=N.alternate,Z===null)throw Error(a(387));Z.memoizedState.memoizedState!==N.memoizedState.memoizedState&&(d!==null?d.push(Eg):d=[Eg])}N=N.return}d!==null&&LS(h,d,y,b),h.flags|=262144}function pE(d){for(d=d.firstContext;d!==null;){if(!To(d.context._currentValue,d.memoizedValue))return!0;d=d.next}return!1}function tl(d){hh=d,Xl=null,d=d.dependencies,d!==null&&(d.firstContext=null)}function Ds(d){return K0(hh,d)}function xp(d,h){return hh===null&&tl(d),K0(d,h)}function K0(d,h){var y=h._currentValue;if(h={context:h,memoizedValue:y,next:null},Xl===null){if(d===null)throw Error(a(308));Xl=h,d.dependencies={lanes:0,firstContext:h},d.flags|=524288}else Xl=Xl.next=h;return y}var KD=typeof AbortController<"u"?AbortController:function(){var d=[],h=this.signal={aborted:!1,addEventListener:function(y,b){d.push(b)}};this.abort=function(){h.aborted=!0,d.forEach(function(y){return y()})}},XD=s.unstable_scheduleCallback,X0=s.unstable_NormalPriority,fs={$$typeof:ce,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Am(){return{controller:new KD,data:new Map,refCount:0}}function Im(d){d.refCount--,d.refCount===0&&XD(X0,function(){d.controller.abort()})}var Nm=null,ph=0,Pp=0,kp=null;function QD(d,h){if(Nm===null){var y=Nm=[];ph=0,Pp=sf(),kp={status:"pending",value:void 0,then:function(b){y.push(b)}}}return ph++,h.then(Q0,Q0),h}function Q0(){if(--ph===0&&Nm!==null){kp!==null&&(kp.status="fulfilled");var d=Nm;Nm=null,Pp=0,kp=null;for(var h=0;h<d.length;h++)(0,d[h])()}}function $D(d,h){var y=[],b={status:"pending",value:null,reason:null,then:function(N){y.push(N)}};return d.then(function(){b.status="fulfilled",b.value=h;for(var N=0;N<y.length;N++)(0,y[N])(h)},function(N){for(b.status="rejected",b.reason=N,N=0;N<y.length;N++)(0,y[N])(void 0)}),b}var $0=ve.S;ve.S=function(d,h){typeof h=="object"&&h!==null&&typeof h.then=="function"&&QD(d,h),$0!==null&&$0(d,h)};var Hd=De(null);function MS(){var d=Hd.current;return d!==null?d:wi.pooledCache}function fE(d,h){h===null?Xe(Hd,Hd.current):Xe(Hd,h.pool)}function J0(){var d=MS();return d===null?null:{parent:fs._currentValue,pool:d}}var fh=Error(a(460)),Z0=Error(a(474)),mE=Error(a(542)),Lp={then:function(){}};function eR(d){return d=d.status,d==="fulfilled"||d==="rejected"}function gE(){}function tR(d,h,y){switch(y=d[y],y===void 0?d.push(h):y!==h&&(h.then(gE,gE),h=y),h.status){case"fulfilled":return h.value;case"rejected":throw d=h.reason,rR(d),d;default:if(typeof h.status=="string")h.then(gE,gE);else{if(d=wi,d!==null&&100<d.shellSuspendCounter)throw Error(a(482));d=h,d.status="pending",d.then(function(b){if(h.status==="pending"){var N=h;N.status="fulfilled",N.value=b}},function(b){if(h.status==="pending"){var N=h;N.status="rejected",N.reason=b}})}switch(h.status){case"fulfilled":return h.value;case"rejected":throw d=h.reason,rR(d),d}throw Om=h,fh}}var Om=null;function nR(){if(Om===null)throw Error(a(459));var d=Om;return Om=null,d}function rR(d){if(d===fh||d===mE)throw Error(a(483))}var Ec=!1;function _E(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function jS(d,h){d=d.updateQueue,h.updateQueue===d&&(h.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,callbacks:null})}function Gd(d){return{lane:d,tag:0,payload:null,callback:null,next:null}}function $l(d,h,y){var b=d.updateQueue;if(b===null)return null;if(b=b.shared,(Vr&2)!==0){var N=b.pending;return N===null?h.next=h:(h.next=N.next,N.next=h),b.pending=h,h=Op(d),bm(d,null,y),h}return Vd(d,b,h,y),Op(d)}function Dm(d,h,y){if(h=h.updateQueue,h!==null&&(h=h.shared,(y&4194048)!==0)){var b=h.lanes;b&=d.pendingLanes,y|=b,h.lanes=y,Yt(d,y)}}function US(d,h){var y=d.updateQueue,b=d.alternate;if(b!==null&&(b=b.updateQueue,y===b)){var N=null,P=null;if(y=y.firstBaseUpdate,y!==null){do{var Z={lane:y.lane,tag:y.tag,payload:y.payload,callback:null,next:null};P===null?N=P=Z:P=P.next=Z,y=y.next}while(y!==null);P===null?N=P=h:P=P.next=h}else N=P=h;y={baseState:b.baseState,firstBaseUpdate:N,lastBaseUpdate:P,shared:b.shared,callbacks:b.callbacks},d.updateQueue=y;return}d=y.lastBaseUpdate,d===null?y.firstBaseUpdate=h:d.next=h,y.lastBaseUpdate=h}var VS=!1;function mh(){if(VS){var d=kp;if(d!==null)throw d}}function gh(d,h,y,b){VS=!1;var N=d.updateQueue;Ec=!1;var P=N.firstBaseUpdate,Z=N.lastBaseUpdate,ue=N.shared.pending;if(ue!==null){N.shared.pending=null;var we=ue,Be=we.next;we.next=null,Z===null?P=Be:Z.next=Be,Z=we;var it=d.alternate;it!==null&&(it=it.updateQueue,ue=it.lastBaseUpdate,ue!==Z&&(ue===null?it.firstBaseUpdate=Be:ue.next=Be,it.lastBaseUpdate=we))}if(P!==null){var mt=N.baseState;Z=0,it=Be=we=null,ue=P;do{var qe=ue.lane&-536870913,Qe=qe!==ue.lane;if(Qe?(wr&qe)===qe:(b&qe)===qe){qe!==0&&qe===Pp&&(VS=!0),it!==null&&(it=it.next={lane:0,tag:ue.tag,payload:ue.payload,callback:null,next:null});e:{var kn=d,vn=ue;qe=h;var ai=y;switch(vn.tag){case 1:if(kn=vn.payload,typeof kn=="function"){mt=kn.call(ai,mt,qe);break e}mt=kn;break e;case 3:kn.flags=kn.flags&-65537|128;case 0:if(kn=vn.payload,qe=typeof kn=="function"?kn.call(ai,mt,qe):kn,qe==null)break e;mt=O({},mt,qe);break e;case 2:Ec=!0}}qe=ue.callback,qe!==null&&(d.flags|=64,Qe&&(d.flags|=8192),Qe=N.callbacks,Qe===null?N.callbacks=[qe]:Qe.push(qe))}else Qe={lane:qe,tag:ue.tag,payload:ue.payload,callback:ue.callback,next:null},it===null?(Be=it=Qe,we=mt):it=it.next=Qe,Z|=qe;if(ue=ue.next,ue===null){if(ue=N.shared.pending,ue===null)break;Qe=ue,ue=Qe.next,Qe.next=null,N.lastBaseUpdate=Qe,N.shared.pending=null}}while(!0);it===null&&(we=mt),N.baseState=we,N.firstBaseUpdate=Be,N.lastBaseUpdate=it,P===null&&(N.shared.lanes=0),bc|=Z,d.lanes=Z,d.memoizedState=mt}}function FS(d,h){if(typeof d!="function")throw Error(a(191,d));d.call(h)}function EE(d,h){var y=d.callbacks;if(y!==null)for(d.callbacks=null,d=0;d<y.length;d++)FS(y[d],h)}var _h=De(null),xm=De(0);function Pm(d,h){d=cl,Xe(xm,d),Xe(_h,h),cl=d|h.baseLanes}function Eh(){Xe(xm,cl),Xe(_h,_h.current)}function BS(){cl=xm.current,xe(_h),xe(xm)}var Wd=0,$n=null,si=null,ms=null,km=!1,Mp=!1,yh=!1,yE=0,Lm=0,jp=null,JD=0;function Yi(){throw Error(a(321))}function zd(d,h){if(h===null)return!1;for(var y=0;y<h.length&&y<d.length;y++)if(!To(d[y],h[y]))return!1;return!0}function HS(d,h,y,b,N,P){return Wd=P,$n=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,ve.H=d===null||d.memoizedState===null?vh:qd,yh=!1,P=y(b,N),yh=!1,Mp&&(P=sR(h,y,b,N)),iR(d),P}function iR(d){ve.H=Co;var h=si!==null&&si.next!==null;if(Wd=0,ms=si=$n=null,km=!1,Lm=0,jp=null,h)throw Error(a(300));d===null||qs||(d=d.dependencies,d!==null&&pE(d)&&(qs=!0))}function sR(d,h,y,b){$n=d;var N=0;do{if(Mp&&(jp=null),Lm=0,Mp=!1,25<=N)throw Error(a(301));if(N+=1,ms=si=null,d.updateQueue!=null){var P=d.updateQueue;P.lastEffect=null,P.events=null,P.stores=null,P.memoCache!=null&&(P.memoCache.index=0)}ve.H=wR,P=h(y,b)}while(Mp);return P}function aR(){var d=ve.H,h=d.useState()[0];return h=typeof h.then=="function"?Mm(h):h,d=d.useState()[0],(si!==null?si.memoizedState:null)!==d&&($n.flags|=1024),h}function GS(){var d=yE!==0;return yE=0,d}function vE(d,h,y){h.updateQueue=d.updateQueue,h.flags&=-2053,d.lanes&=~y}function WS(d){if(km){for(d=d.memoizedState;d!==null;){var h=d.queue;h!==null&&(h.pending=null),d=d.next}km=!1}Wd=0,ms=si=$n=null,Mp=!1,Lm=yE=0,jp=null}function $a(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ms===null?$n.memoizedState=ms=d:ms=ms.next=d,ms}function gs(){if(si===null){var d=$n.alternate;d=d!==null?d.memoizedState:null}else d=si.next;var h=ms===null?$n.memoizedState:ms.next;if(h!==null)ms=h,si=d;else{if(d===null)throw $n.alternate===null?Error(a(467)):Error(a(310));si=d,d={memoizedState:si.memoizedState,baseState:si.baseState,baseQueue:si.baseQueue,queue:si.queue,next:null},ms===null?$n.memoizedState=ms=d:ms=ms.next=d}return ms}function Up(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Mm(d){var h=Lm;return Lm+=1,jp===null&&(jp=[]),d=tR(jp,d,h),h=$n,(ms===null?h.memoizedState:ms.next)===null&&(h=h.alternate,ve.H=h===null||h.memoizedState===null?vh:qd),d}function SE(d){if(d!==null&&typeof d=="object"){if(typeof d.then=="function")return Mm(d);if(d.$$typeof===ce)return Ds(d)}throw Error(a(438,String(d)))}function zS(d){var h=null,y=$n.updateQueue;if(y!==null&&(h=y.memoCache),h==null){var b=$n.alternate;b!==null&&(b=b.updateQueue,b!==null&&(b=b.memoCache,b!=null&&(h={data:b.data.map(function(N){return N.slice()}),index:0})))}if(h==null&&(h={data:[],index:0}),y===null&&(y=Up(),$n.updateQueue=y),y.memoCache=h,y=h.data[h.index],y===void 0)for(y=h.data[h.index]=Array(d),b=0;b<d;b++)y[b]=ae;return h.index++,y}function Jl(d,h){return typeof h=="function"?h(d):h}function TE(d){var h=gs();return YS(h,si,d)}function YS(d,h,y){var b=d.queue;if(b===null)throw Error(a(311));b.lastRenderedReducer=y;var N=d.baseQueue,P=b.pending;if(P!==null){if(N!==null){var Z=N.next;N.next=P.next,P.next=Z}h.baseQueue=N=P,b.pending=null}if(P=d.baseState,N===null)d.memoizedState=P;else{h=N.next;var ue=Z=null,we=null,Be=h,it=!1;do{var mt=Be.lane&-536870913;if(mt!==Be.lane?(wr&mt)===mt:(Wd&mt)===mt){var qe=Be.revertLane;if(qe===0)we!==null&&(we=we.next={lane:0,revertLane:0,action:Be.action,hasEagerState:Be.hasEagerState,eagerState:Be.eagerState,next:null}),mt===Pp&&(it=!0);else if((Wd&qe)===qe){Be=Be.next,qe===Pp&&(it=!0);continue}else mt={lane:0,revertLane:Be.revertLane,action:Be.action,hasEagerState:Be.hasEagerState,eagerState:Be.eagerState,next:null},we===null?(ue=we=mt,Z=P):we=we.next=mt,$n.lanes|=qe,bc|=qe;mt=Be.action,yh&&y(P,mt),P=Be.hasEagerState?Be.eagerState:y(P,mt)}else qe={lane:mt,revertLane:Be.revertLane,action:Be.action,hasEagerState:Be.hasEagerState,eagerState:Be.eagerState,next:null},we===null?(ue=we=qe,Z=P):we=we.next=qe,$n.lanes|=mt,bc|=mt;Be=Be.next}while(Be!==null&&Be!==h);if(we===null?Z=P:we.next=ue,!To(P,d.memoizedState)&&(qs=!0,it&&(y=kp,y!==null)))throw y;d.memoizedState=P,d.baseState=Z,d.baseQueue=we,b.lastRenderedState=P}return N===null&&(b.lanes=0),[d.memoizedState,b.dispatch]}function jm(d){var h=gs(),y=h.queue;if(y===null)throw Error(a(311));y.lastRenderedReducer=d;var b=y.dispatch,N=y.pending,P=h.memoizedState;if(N!==null){y.pending=null;var Z=N=N.next;do P=d(P,Z.action),Z=Z.next;while(Z!==N);To(P,h.memoizedState)||(qs=!0),h.memoizedState=P,h.baseQueue===null&&(h.baseState=P),y.lastRenderedState=P}return[P,b]}function oR(d,h,y){var b=$n,N=gs(),P=Ur;if(P){if(y===void 0)throw Error(a(407));y=y()}else y=h();var Z=!To((si||N).memoizedState,y);Z&&(N.memoizedState=y,qs=!0),N=N.queue;var ue=KS.bind(null,b,N,d);if(Bp(2048,8,ue,[d]),N.getSnapshot!==h||Z||ms!==null&&ms.memoizedState.tag&1){if(b.flags|=2048,Fp(9,bE(),cR.bind(null,b,N,y,h),null),wi===null)throw Error(a(349));P||(Wd&124)!==0||qS(b,h,y)}return y}function qS(d,h,y){d.flags|=16384,d={getSnapshot:h,value:y},h=$n.updateQueue,h===null?(h=Up(),$n.updateQueue=h,h.stores=[d]):(y=h.stores,y===null?h.stores=[d]:y.push(d))}function cR(d,h,y,b){h.value=y,h.getSnapshot=b,lR(h)&&dR(d)}function KS(d,h,y){return y(function(){lR(h)&&dR(d)})}function lR(d){var h=d.getSnapshot;d=d.value;try{var y=h();return!To(d,y)}catch{return!0}}function dR(d){var h=Np(d,2);h!==null&&eo(h,d,2)}function XS(d){var h=$a();if(typeof d=="function"){var y=d;if(d=y(),yh){bt(!0);try{y()}finally{bt(!1)}}}return h.memoizedState=h.baseState=d,h.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jl,lastRenderedState:d},h}function uR(d,h,y,b){return d.baseState=y,YS(d,si,typeof b=="function"?b:Jl)}function ZD(d,h,y,b,N){if(Wm(d))throw Error(a(485));if(d=h.action,d!==null){var P={payload:N,action:d,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Z){P.listeners.push(Z)}};ve.T!==null?y(!0):P.isTransition=!1,b(P),y=h.pending,y===null?(P.next=h.pending=P,hR(h,P)):(P.next=y.next,h.pending=y.next=P)}}function hR(d,h){var y=h.action,b=h.payload,N=d.state;if(h.isTransition){var P=ve.T,Z={};ve.T=Z;try{var ue=y(N,b),we=ve.S;we!==null&&we(Z,ue),QS(d,h,ue)}catch(Be){$S(d,h,Be)}finally{ve.T=P}}else try{P=y(N,b),QS(d,h,P)}catch(Be){$S(d,h,Be)}}function QS(d,h,y){y!==null&&typeof y=="object"&&typeof y.then=="function"?y.then(function(b){pR(d,h,b)},function(b){return $S(d,h,b)}):pR(d,h,y)}function pR(d,h,y){h.status="fulfilled",h.value=y,JS(h),d.state=y,h=d.pending,h!==null&&(y=h.next,y===h?d.pending=null:(y=y.next,h.next=y,hR(d,y)))}function $S(d,h,y){var b=d.pending;if(d.pending=null,b!==null){b=b.next;do h.status="rejected",h.reason=y,JS(h),h=h.next;while(h!==b)}d.action=null}function JS(d){d=d.listeners;for(var h=0;h<d.length;h++)(0,d[h])()}function fR(d,h){return h}function Um(d,h){if(Ur){var y=wi.formState;if(y!==null){e:{var b=$n;if(Ur){if(Ii){t:{for(var N=Ii,P=el;N.nodeType!==8;){if(!P){N=null;break t}if(N=Cc(N.nextSibling),N===null){N=null;break t}}P=N.data,N=P==="F!"||P==="F"?N:null}if(N){Ii=Cc(N.nextSibling),b=N.data==="F!";break e}}dh(b)}b=!1}b&&(h=y[0])}}return y=$a(),y.memoizedState=y.baseState=h,b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fR,lastRenderedState:h},y.queue=b,y=IE.bind(null,$n,b),b.dispatch=y,b=XS(!1),P=sT.bind(null,$n,!1,b.queue),b=$a(),N={state:h,dispatch:null,action:d,pending:null},b.queue=N,y=ZD.bind(null,$n,N,P,y),N.dispatch=y,b.memoizedState=d,[h,y,!1]}function ZS(d){var h=gs();return Vp(h,si,d)}function Vp(d,h,y){if(h=YS(d,h,fR)[0],d=TE(Jl)[0],typeof h=="object"&&h!==null&&typeof h.then=="function")try{var b=Mm(h)}catch(Z){throw Z===fh?mE:Z}else b=h;h=gs();var N=h.queue,P=N.dispatch;return y!==h.memoizedState&&($n.flags|=2048,Fp(9,bE(),ex.bind(null,N,y),null)),[b,P,d]}function ex(d,h){d.action=h}function mR(d){var h=gs(),y=si;if(y!==null)return Vp(h,y,d);gs(),h=h.memoizedState,y=gs();var b=y.queue.dispatch;return y.memoizedState=d,[h,b,!1]}function Fp(d,h,y,b){return d={tag:d,create:y,deps:b,inst:h,next:null},h=$n.updateQueue,h===null&&(h=Up(),$n.updateQueue=h),y=h.lastEffect,y===null?h.lastEffect=d.next=d:(b=y.next,y.next=d,d.next=b,h.lastEffect=d),d}function bE(){return{destroy:void 0,resource:void 0}}function Vm(){return gs().memoizedState}function wE(d,h,y,b){var N=$a();b=b===void 0?null:b,$n.flags|=d,N.memoizedState=Fp(1|h,bE(),y,b)}function Bp(d,h,y,b){var N=gs();b=b===void 0?null:b;var P=N.memoizedState.inst;si!==null&&b!==null&&zd(b,si.memoizedState.deps)?N.memoizedState=Fp(h,P,y,b):($n.flags|=d,N.memoizedState=Fp(1|h,P,y,b))}function RE(d,h){wE(8390656,8,d,h)}function CE(d,h){Bp(2048,8,d,h)}function gR(d,h){return Bp(4,2,d,h)}function _R(d,h){return Bp(4,4,d,h)}function ER(d,h){if(typeof h=="function"){d=d();var y=h(d);return function(){typeof y=="function"?y():h(null)}}if(h!=null)return d=d(),h.current=d,function(){h.current=null}}function yR(d,h,y){y=y!=null?y.concat([d]):null,Bp(4,4,ER.bind(null,h,d),y)}function eT(){}function Fm(d,h){var y=gs();h=h===void 0?null:h;var b=y.memoizedState;return h!==null&&zd(h,b[1])?b[0]:(y.memoizedState=[d,h],d)}function vR(d,h){var y=gs();h=h===void 0?null:h;var b=y.memoizedState;if(h!==null&&zd(h,b[1]))return b[0];if(b=d(),yh){bt(!0);try{d()}finally{bt(!1)}}return y.memoizedState=[b,h],b}function Yd(d,h,y){return y===void 0||(Wd&1073741824)!==0?d.memoizedState=h:(d.memoizedState=y,d=YE(),$n.lanes|=d,bc|=d,y)}function AE(d,h,y,b){return To(y,h)?y:_h.current!==null?(d=Yd(d,y,b),To(d,h)||(qs=!0),d):(Wd&42)===0?(qs=!0,d.memoizedState=y):(d=YE(),$n.lanes|=d,bc|=d,h)}function Bm(d,h,y,b,N){var P=Ne.p;Ne.p=P!==0&&8>P?P:8;var Z=ve.T,ue={};ve.T=ue,sT(d,!1,h,y);try{var we=N(),Be=ve.S;if(Be!==null&&Be(ue,we),we!==null&&typeof we=="object"&&typeof we.then=="function"){var it=$D(we,b);Gm(d,h,it,Io(d))}else Gm(d,h,b,Io(d))}catch(mt){Gm(d,h,{then:function(){},status:"rejected",reason:mt},Io())}finally{Ne.p=P,ve.T=Z}}function Hm(){}function Hp(d,h,y,b){if(d.tag!==5)throw Error(a(476));var N=SR(d).queue;Bm(d,N,h,Ce,y===null?Hm:function(){return tT(d),y(b)})}function SR(d){var h=d.memoizedState;if(h!==null)return h;h={memoizedState:Ce,baseState:Ce,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jl,lastRenderedState:Ce},next:null};var y={};return h.next={memoizedState:y,baseState:y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jl,lastRenderedState:y},next:null},d.memoizedState=h,d=d.alternate,d!==null&&(d.memoizedState=h),h}function tT(d){var h=SR(d).next.queue;Gm(d,h,{},Io())}function nT(){return Ds(Eg)}function rT(){return gs().memoizedState}function TR(){return gs().memoizedState}function tx(d){for(var h=d.return;h!==null;){switch(h.tag){case 24:case 3:var y=Io();d=Gd(y);var b=$l(h,d,y);b!==null&&(eo(b,h,y),Dm(b,h,y)),h={cache:Am()},d.payload=h;return}h=h.return}}function iT(d,h,y){var b=Io();y={lane:b,revertLane:0,action:y,hasEagerState:!1,eagerState:null,next:null},Wm(d)?NE(h,y):(y=CS(d,h,y,b),y!==null&&(eo(y,d,b),bR(y,h,b)))}function IE(d,h,y){var b=Io();Gm(d,h,y,b)}function Gm(d,h,y,b){var N={lane:b,revertLane:0,action:y,hasEagerState:!1,eagerState:null,next:null};if(Wm(d))NE(h,N);else{var P=d.alternate;if(d.lanes===0&&(P===null||P.lanes===0)&&(P=h.lastRenderedReducer,P!==null))try{var Z=h.lastRenderedState,ue=P(Z,y);if(N.hasEagerState=!0,N.eagerState=ue,To(ue,Z))return Vd(d,h,N,0),wi===null&&ah(),!1}catch{}finally{}if(y=CS(d,h,N,b),y!==null)return eo(y,d,b),bR(y,h,b),!0}return!1}function sT(d,h,y,b){if(b={lane:2,revertLane:sf(),action:b,hasEagerState:!1,eagerState:null,next:null},Wm(d)){if(h)throw Error(a(479))}else h=CS(d,y,b,2),h!==null&&eo(h,d,2)}function Wm(d){var h=d.alternate;return d===$n||h!==null&&h===$n}function NE(d,h){Mp=km=!0;var y=d.pending;y===null?h.next=h:(h.next=y.next,y.next=h),d.pending=h}function bR(d,h,y){if((y&4194048)!==0){var b=h.lanes;b&=d.pendingLanes,y|=b,h.lanes=y,Yt(d,y)}}var Co={readContext:Ds,use:SE,useCallback:Yi,useContext:Yi,useEffect:Yi,useImperativeHandle:Yi,useLayoutEffect:Yi,useInsertionEffect:Yi,useMemo:Yi,useReducer:Yi,useRef:Yi,useState:Yi,useDebugValue:Yi,useDeferredValue:Yi,useTransition:Yi,useSyncExternalStore:Yi,useId:Yi,useHostTransitionStatus:Yi,useFormState:Yi,useActionState:Yi,useOptimistic:Yi,useMemoCache:Yi,useCacheRefresh:Yi},vh={readContext:Ds,use:SE,useCallback:function(d,h){return $a().memoizedState=[d,h===void 0?null:h],d},useContext:Ds,useEffect:RE,useImperativeHandle:function(d,h,y){y=y!=null?y.concat([d]):null,wE(4194308,4,ER.bind(null,h,d),y)},useLayoutEffect:function(d,h){return wE(4194308,4,d,h)},useInsertionEffect:function(d,h){wE(4,2,d,h)},useMemo:function(d,h){var y=$a();h=h===void 0?null:h;var b=d();if(yh){bt(!0);try{d()}finally{bt(!1)}}return y.memoizedState=[b,h],b},useReducer:function(d,h,y){var b=$a();if(y!==void 0){var N=y(h);if(yh){bt(!0);try{y(h)}finally{bt(!1)}}}else N=h;return b.memoizedState=b.baseState=N,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:N},b.queue=d,d=d.dispatch=iT.bind(null,$n,d),[b.memoizedState,d]},useRef:function(d){var h=$a();return d={current:d},h.memoizedState=d},useState:function(d){d=XS(d);var h=d.queue,y=IE.bind(null,$n,h);return h.dispatch=y,[d.memoizedState,y]},useDebugValue:eT,useDeferredValue:function(d,h){var y=$a();return Yd(y,d,h)},useTransition:function(){var d=XS(!1);return d=Bm.bind(null,$n,d.queue,!0,!1),$a().memoizedState=d,[!1,d]},useSyncExternalStore:function(d,h,y){var b=$n,N=$a();if(Ur){if(y===void 0)throw Error(a(407));y=y()}else{if(y=h(),wi===null)throw Error(a(349));(wr&124)!==0||qS(b,h,y)}N.memoizedState=y;var P={value:y,getSnapshot:h};return N.queue=P,RE(KS.bind(null,b,P,d),[d]),b.flags|=2048,Fp(9,bE(),cR.bind(null,b,P,y,h),null),y},useId:function(){var d=$a(),h=wi.identifierPrefix;if(Ur){var y=_c,b=Kl;y=(b&~(1<<32-rn(b)-1)).toString(32)+y,h=""+h+"R"+y,y=yE++,0<y&&(h+="H"+y.toString(32)),h+=""}else y=JD++,h=""+h+"r"+y.toString(32)+"";return d.memoizedState=h},useHostTransitionStatus:nT,useFormState:Um,useActionState:Um,useOptimistic:function(d){var h=$a();h.memoizedState=h.baseState=d;var y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return h.queue=y,h=sT.bind(null,$n,!0,y),y.dispatch=h,[d,h]},useMemoCache:zS,useCacheRefresh:function(){return $a().memoizedState=tx.bind(null,$n)}},qd={readContext:Ds,use:SE,useCallback:Fm,useContext:Ds,useEffect:CE,useImperativeHandle:yR,useInsertionEffect:gR,useLayoutEffect:_R,useMemo:vR,useReducer:TE,useRef:Vm,useState:function(){return TE(Jl)},useDebugValue:eT,useDeferredValue:function(d,h){var y=gs();return AE(y,si.memoizedState,d,h)},useTransition:function(){var d=TE(Jl)[0],h=gs().memoizedState;return[typeof d=="boolean"?d:Mm(d),h]},useSyncExternalStore:oR,useId:rT,useHostTransitionStatus:nT,useFormState:ZS,useActionState:ZS,useOptimistic:function(d,h){var y=gs();return uR(y,si,d,h)},useMemoCache:zS,useCacheRefresh:TR},wR={readContext:Ds,use:SE,useCallback:Fm,useContext:Ds,useEffect:CE,useImperativeHandle:yR,useInsertionEffect:gR,useLayoutEffect:_R,useMemo:vR,useReducer:jm,useRef:Vm,useState:function(){return jm(Jl)},useDebugValue:eT,useDeferredValue:function(d,h){var y=gs();return si===null?Yd(y,d,h):AE(y,si.memoizedState,d,h)},useTransition:function(){var d=jm(Jl)[0],h=gs().memoizedState;return[typeof d=="boolean"?d:Mm(d),h]},useSyncExternalStore:oR,useId:rT,useHostTransitionStatus:nT,useFormState:mR,useActionState:mR,useOptimistic:function(d,h){var y=gs();return si!==null?uR(y,si,d,h):(y.baseState=d,[d,y.queue.dispatch])},useMemoCache:zS,useCacheRefresh:TR},Sh=null,yc=0;function Gp(d){var h=yc;return yc+=1,Sh===null&&(Sh=[]),tR(Sh,d,h)}function zm(d,h){h=h.props.ref,d.ref=h!==void 0?h:null}function Ym(d,h){throw h.$$typeof===k?Error(a(525)):(d=Object.prototype.toString.call(h),Error(a(31,d==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":d)))}function RR(d){var h=d._init;return h(d._payload)}function aT(d){function h(Me,Oe){if(d){var He=Me.deletions;He===null?(Me.deletions=[Oe],Me.flags|=16):He.push(Oe)}}function y(Me,Oe){if(!d)return null;for(;Oe!==null;)h(Me,Oe),Oe=Oe.sibling;return null}function b(Me){for(var Oe=new Map;Me!==null;)Me.key!==null?Oe.set(Me.key,Me):Oe.set(Me.index,Me),Me=Me.sibling;return Oe}function N(Me,Oe){return Me=ql(Me,Oe),Me.index=0,Me.sibling=null,Me}function P(Me,Oe,He){return Me.index=He,d?(He=Me.alternate,He!==null?(He=He.index,He<Oe?(Me.flags|=67108866,Oe):He):(Me.flags|=67108866,Oe)):(Me.flags|=1048576,Oe)}function Z(Me){return d&&Me.alternate===null&&(Me.flags|=67108866),Me}function ue(Me,Oe,He,ht){return Oe===null||Oe.tag!==6?(Oe=Qa(He,Me.mode,ht),Oe.return=Me,Oe):(Oe=N(Oe,He),Oe.return=Me,Oe)}function we(Me,Oe,He,ht){var Gt=He.type;return Gt===z?it(Me,Oe,He.props.children,ht,He.key):Oe!==null&&(Oe.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===Q&&RR(Gt)===Oe.type)?(Oe=N(Oe,He.props),zm(Oe,He),Oe.return=Me,Oe):(Oe=cE(He.type,He.key,He.props,null,Me.mode,ht),zm(Oe,He),Oe.return=Me,Oe)}function Be(Me,Oe,He,ht){return Oe===null||Oe.tag!==4||Oe.stateNode.containerInfo!==He.containerInfo||Oe.stateNode.implementation!==He.implementation?(Oe=IS(He,Me.mode,ht),Oe.return=Me,Oe):(Oe=N(Oe,He.children||[]),Oe.return=Me,Oe)}function it(Me,Oe,He,ht,Gt){return Oe===null||Oe.tag!==7?(Oe=Fd(He,Me.mode,ht,Gt),Oe.return=Me,Oe):(Oe=N(Oe,He),Oe.return=Me,Oe)}function mt(Me,Oe,He){if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number"||typeof Oe=="bigint")return Oe=Qa(""+Oe,Me.mode,He),Oe.return=Me,Oe;if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case U:return He=cE(Oe.type,Oe.key,Oe.props,null,Me.mode,He),zm(He,Oe),He.return=Me,He;case G:return Oe=IS(Oe,Me.mode,He),Oe.return=Me,Oe;case Q:var ht=Oe._init;return Oe=ht(Oe._payload),mt(Me,Oe,He)}if(Ge(Oe)||fe(Oe))return Oe=Fd(Oe,Me.mode,He,null),Oe.return=Me,Oe;if(typeof Oe.then=="function")return mt(Me,Gp(Oe),He);if(Oe.$$typeof===ce)return mt(Me,xp(Me,Oe),He);Ym(Me,Oe)}return null}function qe(Me,Oe,He,ht){var Gt=Oe!==null?Oe.key:null;if(typeof He=="string"&&He!==""||typeof He=="number"||typeof He=="bigint")return Gt!==null?null:ue(Me,Oe,""+He,ht);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case U:return He.key===Gt?we(Me,Oe,He,ht):null;case G:return He.key===Gt?Be(Me,Oe,He,ht):null;case Q:return Gt=He._init,He=Gt(He._payload),qe(Me,Oe,He,ht)}if(Ge(He)||fe(He))return Gt!==null?null:it(Me,Oe,He,ht,null);if(typeof He.then=="function")return qe(Me,Oe,Gp(He),ht);if(He.$$typeof===ce)return qe(Me,Oe,xp(Me,He),ht);Ym(Me,He)}return null}function Qe(Me,Oe,He,ht,Gt){if(typeof ht=="string"&&ht!==""||typeof ht=="number"||typeof ht=="bigint")return Me=Me.get(He)||null,ue(Oe,Me,""+ht,Gt);if(typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case U:return Me=Me.get(ht.key===null?He:ht.key)||null,we(Oe,Me,ht,Gt);case G:return Me=Me.get(ht.key===null?He:ht.key)||null,Be(Oe,Me,ht,Gt);case Q:var lr=ht._init;return ht=lr(ht._payload),Qe(Me,Oe,He,ht,Gt)}if(Ge(ht)||fe(ht))return Me=Me.get(He)||null,it(Oe,Me,ht,Gt,null);if(typeof ht.then=="function")return Qe(Me,Oe,He,Gp(ht),Gt);if(ht.$$typeof===ce)return Qe(Me,Oe,He,xp(Oe,ht),Gt);Ym(Oe,ht)}return null}function kn(Me,Oe,He,ht){for(var Gt=null,lr=null,hn=Oe,An=Oe=0,Qs=null;hn!==null&&An<He.length;An++){hn.index>An?(Qs=hn,hn=null):Qs=hn.sibling;var Ir=qe(Me,hn,He[An],ht);if(Ir===null){hn===null&&(hn=Qs);break}d&&hn&&Ir.alternate===null&&h(Me,hn),Oe=P(Ir,Oe,An),lr===null?Gt=Ir:lr.sibling=Ir,lr=Ir,hn=Qs}if(An===He.length)return y(Me,hn),Ur&&ch(Me,An),Gt;if(hn===null){for(;An<He.length;An++)hn=mt(Me,He[An],ht),hn!==null&&(Oe=P(hn,Oe,An),lr===null?Gt=hn:lr.sibling=hn,lr=hn);return Ur&&ch(Me,An),Gt}for(hn=b(hn);An<He.length;An++)Qs=Qe(hn,Me,An,He[An],ht),Qs!==null&&(d&&Qs.alternate!==null&&hn.delete(Qs.key===null?An:Qs.key),Oe=P(Qs,Oe,An),lr===null?Gt=Qs:lr.sibling=Qs,lr=Qs);return d&&hn.forEach(function(nd){return h(Me,nd)}),Ur&&ch(Me,An),Gt}function vn(Me,Oe,He,ht){if(He==null)throw Error(a(151));for(var Gt=null,lr=null,hn=Oe,An=Oe=0,Qs=null,Ir=He.next();hn!==null&&!Ir.done;An++,Ir=He.next()){hn.index>An?(Qs=hn,hn=null):Qs=hn.sibling;var nd=qe(Me,hn,Ir.value,ht);if(nd===null){hn===null&&(hn=Qs);break}d&&hn&&nd.alternate===null&&h(Me,hn),Oe=P(nd,Oe,An),lr===null?Gt=nd:lr.sibling=nd,lr=nd,hn=Qs}if(Ir.done)return y(Me,hn),Ur&&ch(Me,An),Gt;if(hn===null){for(;!Ir.done;An++,Ir=He.next())Ir=mt(Me,Ir.value,ht),Ir!==null&&(Oe=P(Ir,Oe,An),lr===null?Gt=Ir:lr.sibling=Ir,lr=Ir);return Ur&&ch(Me,An),Gt}for(hn=b(hn);!Ir.done;An++,Ir=He.next())Ir=Qe(hn,Me,An,Ir.value,ht),Ir!==null&&(d&&Ir.alternate!==null&&hn.delete(Ir.key===null?An:Ir.key),Oe=P(Ir,Oe,An),lr===null?Gt=Ir:lr.sibling=Ir,lr=Ir);return d&&hn.forEach(function(Ux){return h(Me,Ux)}),Ur&&ch(Me,An),Gt}function ai(Me,Oe,He,ht){if(typeof He=="object"&&He!==null&&He.type===z&&He.key===null&&(He=He.props.children),typeof He=="object"&&He!==null){switch(He.$$typeof){case U:e:{for(var Gt=He.key;Oe!==null;){if(Oe.key===Gt){if(Gt=He.type,Gt===z){if(Oe.tag===7){y(Me,Oe.sibling),ht=N(Oe,He.props.children),ht.return=Me,Me=ht;break e}}else if(Oe.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===Q&&RR(Gt)===Oe.type){y(Me,Oe.sibling),ht=N(Oe,He.props),zm(ht,He),ht.return=Me,Me=ht;break e}y(Me,Oe);break}else h(Me,Oe);Oe=Oe.sibling}He.type===z?(ht=Fd(He.props.children,Me.mode,ht,He.key),ht.return=Me,Me=ht):(ht=cE(He.type,He.key,He.props,null,Me.mode,ht),zm(ht,He),ht.return=Me,Me=ht)}return Z(Me);case G:e:{for(Gt=He.key;Oe!==null;){if(Oe.key===Gt)if(Oe.tag===4&&Oe.stateNode.containerInfo===He.containerInfo&&Oe.stateNode.implementation===He.implementation){y(Me,Oe.sibling),ht=N(Oe,He.children||[]),ht.return=Me,Me=ht;break e}else{y(Me,Oe);break}else h(Me,Oe);Oe=Oe.sibling}ht=IS(He,Me.mode,ht),ht.return=Me,Me=ht}return Z(Me);case Q:return Gt=He._init,He=Gt(He._payload),ai(Me,Oe,He,ht)}if(Ge(He))return kn(Me,Oe,He,ht);if(fe(He)){if(Gt=fe(He),typeof Gt!="function")throw Error(a(150));return He=Gt.call(He),vn(Me,Oe,He,ht)}if(typeof He.then=="function")return ai(Me,Oe,Gp(He),ht);if(He.$$typeof===ce)return ai(Me,Oe,xp(Me,He),ht);Ym(Me,He)}return typeof He=="string"&&He!==""||typeof He=="number"||typeof He=="bigint"?(He=""+He,Oe!==null&&Oe.tag===6?(y(Me,Oe.sibling),ht=N(Oe,He),ht.return=Me,Me=ht):(y(Me,Oe),ht=Qa(He,Me.mode,ht),ht.return=Me,Me=ht),Z(Me)):y(Me,Oe)}return function(Me,Oe,He,ht){try{yc=0;var Gt=ai(Me,Oe,He,ht);return Sh=null,Gt}catch(hn){if(hn===fh||hn===mE)throw hn;var lr=wo(29,hn,null,Me.mode);return lr.lanes=ht,lr.return=Me,lr}finally{}}}var Th=aT(!0),CR=aT(!1),xs=De(null),nl=null;function Kd(d){var h=d.alternate;Xe(Ps,Ps.current&1),Xe(xs,d),nl===null&&(h===null||_h.current!==null||h.memoizedState!==null)&&(nl=d)}function AR(d){if(d.tag===22){if(Xe(Ps,Ps.current),Xe(xs,d),nl===null){var h=d.alternate;h!==null&&h.memoizedState!==null&&(nl=d)}}else Xd()}function Xd(){Xe(Ps,Ps.current),Xe(xs,xs.current)}function rl(d){xe(xs),nl===d&&(nl=null),xe(Ps)}var Ps=De(0);function Wp(d){for(var h=d;h!==null;){if(h.tag===13){var y=h.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||oy(y)))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===d)break;for(;h.sibling===null;){if(h.return===null||h.return===d)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}function OE(d,h,y,b){h=d.memoizedState,y=y(b,h),y=y==null?h:O({},h,y),d.memoizedState=y,d.lanes===0&&(d.updateQueue.baseState=y)}var oT={enqueueSetState:function(d,h,y){d=d._reactInternals;var b=Io(),N=Gd(b);N.payload=h,y!=null&&(N.callback=y),h=$l(d,N,b),h!==null&&(eo(h,d,b),Dm(h,d,b))},enqueueReplaceState:function(d,h,y){d=d._reactInternals;var b=Io(),N=Gd(b);N.tag=1,N.payload=h,y!=null&&(N.callback=y),h=$l(d,N,b),h!==null&&(eo(h,d,b),Dm(h,d,b))},enqueueForceUpdate:function(d,h){d=d._reactInternals;var y=Io(),b=Gd(y);b.tag=2,h!=null&&(b.callback=h),h=$l(d,b,y),h!==null&&(eo(h,d,y),Dm(h,d,y))}};function cT(d,h,y,b,N,P,Z){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(b,P,Z):h.prototype&&h.prototype.isPureReactComponent?!Md(y,b)||!Md(N,P):!0}function IR(d,h,y,b){d=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(y,b),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(y,b),h.state!==d&&oT.enqueueReplaceState(h,h.state,null)}function bh(d,h){var y=h;if("ref"in h){y={};for(var b in h)b!=="ref"&&(y[b]=h[b])}if(d=d.defaultProps){y===h&&(y=O({},y));for(var N in d)y[N]===void 0&&(y[N]=d[N])}return y}var DE=typeof reportError=="function"?reportError:function(d){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var h=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof d=="object"&&d!==null&&typeof d.message=="string"?String(d.message):String(d),error:d});if(!window.dispatchEvent(h))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",d);return}console.error(d)};function NR(d){DE(d)}function OR(d){console.error(d)}function DR(d){DE(d)}function xE(d,h){try{var y=d.onUncaughtError;y(h.value,{componentStack:h.stack})}catch(b){setTimeout(function(){throw b})}}function lT(d,h,y){try{var b=d.onCaughtError;b(y.value,{componentStack:y.stack,errorBoundary:h.tag===1?h.stateNode:null})}catch(N){setTimeout(function(){throw N})}}function vc(d,h,y){return y=Gd(y),y.tag=3,y.payload={element:null},y.callback=function(){xE(d,h)},y}function xR(d){return d=Gd(d),d.tag=3,d}function PR(d,h,y,b){var N=y.type.getDerivedStateFromError;if(typeof N=="function"){var P=b.value;d.payload=function(){return N(P)},d.callback=function(){lT(h,y,b)}}var Z=y.stateNode;Z!==null&&typeof Z.componentDidCatch=="function"&&(d.callback=function(){lT(h,y,b),typeof N!="function"&&(ed===null?ed=new Set([this]):ed.add(this));var ue=b.stack;this.componentDidCatch(b.value,{componentStack:ue!==null?ue:""})})}function nx(d,h,y,b,N){if(y.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){if(h=y.alternate,h!==null&&Cm(h,y,N,!0),y=xs.current,y!==null){switch(y.tag){case 13:return nl===null?Dh():y.alternate===null&&Vi===0&&(Vi=3),y.flags&=-257,y.flags|=65536,y.lanes=N,b===Lp?y.flags|=16384:(h=y.updateQueue,h===null?y.updateQueue=new Set([b]):h.add(b),nf(d,b,N)),!1;case 22:return y.flags|=65536,b===Lp?y.flags|=16384:(h=y.updateQueue,h===null?(h={transitions:null,markerInstances:null,retryQueue:new Set([b])},y.updateQueue=h):(y=h.retryQueue,y===null?h.retryQueue=new Set([b]):y.add(b)),nf(d,b,N)),!1}throw Error(a(435,y.tag))}return nf(d,b,N),Dh(),!1}if(Ur)return h=xs.current,h!==null?((h.flags&65536)===0&&(h.flags|=256),h.flags|=65536,h.lanes=N,b!==DS&&(d=Error(a(422),{cause:b}),Rm(bo(d,y)))):(b!==DS&&(h=Error(a(423),{cause:b}),Rm(bo(h,y))),d=d.current.alternate,d.flags|=65536,N&=-N,d.lanes|=N,b=bo(b,y),N=vc(d.stateNode,b,N),US(d,N),Vi!==4&&(Vi=2)),!1;var P=Error(a(520),{cause:b});if(P=bo(P,y),$p===null?$p=[P]:$p.push(P),Vi!==4&&(Vi=2),h===null)return!0;b=bo(b,y),y=h;do{switch(y.tag){case 3:return y.flags|=65536,d=N&-N,y.lanes|=d,d=vc(y.stateNode,b,d),US(y,d),!1;case 1:if(h=y.type,P=y.stateNode,(y.flags&128)===0&&(typeof h.getDerivedStateFromError=="function"||P!==null&&typeof P.componentDidCatch=="function"&&(ed===null||!ed.has(P))))return y.flags|=65536,N&=-N,y.lanes|=N,N=xR(N),PR(N,d,y,b),US(y,N),!1}y=y.return}while(y!==null);return!1}var kR=Error(a(461)),qs=!1;function ra(d,h,y,b){h.child=d===null?CR(h,null,y,b):Th(h,d.child,y,b)}function PE(d,h,y,b,N){y=y.render;var P=h.ref;if("ref"in b){var Z={};for(var ue in b)ue!=="ref"&&(Z[ue]=b[ue])}else Z=b;return tl(h),b=HS(d,h,y,Z,P,N),ue=GS(),d!==null&&!qs?(vE(d,h,N),il(d,h,N)):(Ur&&ue&&uE(h),h.flags|=1,ra(d,h,b,N),h.child)}function LR(d,h,y,b,N){if(d===null){var P=y.type;return typeof P=="function"&&!AS(P)&&P.defaultProps===void 0&&y.compare===null?(h.tag=15,h.type=P,MR(d,h,P,b,N)):(d=cE(y.type,null,b,h,h.mode,N),d.ref=h.ref,d.return=h,h.child=d)}if(P=d.child,!LE(d,N)){var Z=P.memoizedProps;if(y=y.compare,y=y!==null?y:Md,y(Z,b)&&d.ref===h.ref)return il(d,h,N)}return h.flags|=1,d=ql(P,b),d.ref=h.ref,d.return=h,h.child=d}function MR(d,h,y,b,N){if(d!==null){var P=d.memoizedProps;if(Md(P,b)&&d.ref===h.ref)if(qs=!1,h.pendingProps=b=P,LE(d,N))(d.flags&131072)!==0&&(qs=!0);else return h.lanes=d.lanes,il(d,h,N)}return dT(d,h,y,b,N)}function jR(d,h,y){var b=h.pendingProps,N=b.children,P=d!==null?d.memoizedState:null;if(b.mode==="hidden"){if((h.flags&128)!==0){if(b=P!==null?P.baseLanes|y:y,d!==null){for(N=h.child=d.child,P=0;N!==null;)P=P|N.lanes|N.childLanes,N=N.sibling;h.childLanes=P&~b}else h.childLanes=0,h.child=null;return UR(d,h,b,y)}if((y&536870912)!==0)h.memoizedState={baseLanes:0,cachePool:null},d!==null&&fE(h,P!==null?P.cachePool:null),P!==null?Pm(h,P):Eh(),AR(h);else return h.lanes=h.childLanes=536870912,UR(d,h,P!==null?P.baseLanes|y:y,y)}else P!==null?(fE(h,P.cachePool),Pm(h,P),Xd(),h.memoizedState=null):(d!==null&&fE(h,null),Eh(),Xd());return ra(d,h,N,y),h.child}function UR(d,h,y,b){var N=MS();return N=N===null?null:{parent:fs._currentValue,pool:N},h.memoizedState={baseLanes:y,cachePool:N},d!==null&&fE(h,null),Eh(),AR(h),d!==null&&Cm(d,h,b,!0),null}function kE(d,h){var y=h.ref;if(y===null)d!==null&&d.ref!==null&&(h.flags|=4194816);else{if(typeof y!="function"&&typeof y!="object")throw Error(a(284));(d===null||d.ref!==y)&&(h.flags|=4194816)}}function dT(d,h,y,b,N){return tl(h),y=HS(d,h,y,b,void 0,N),b=GS(),d!==null&&!qs?(vE(d,h,N),il(d,h,N)):(Ur&&b&&uE(h),h.flags|=1,ra(d,h,y,N),h.child)}function uT(d,h,y,b,N,P){return tl(h),h.updateQueue=null,y=sR(h,b,y,N),iR(d),b=GS(),d!==null&&!qs?(vE(d,h,P),il(d,h,P)):(Ur&&b&&uE(h),h.flags|=1,ra(d,h,y,P),h.child)}function hT(d,h,y,b,N){if(tl(h),h.stateNode===null){var P=Yl,Z=y.contextType;typeof Z=="object"&&Z!==null&&(P=Ds(Z)),P=new y(b,P),h.memoizedState=P.state!==null&&P.state!==void 0?P.state:null,P.updater=oT,h.stateNode=P,P._reactInternals=h,P=h.stateNode,P.props=b,P.state=h.memoizedState,P.refs={},_E(h),Z=y.contextType,P.context=typeof Z=="object"&&Z!==null?Ds(Z):Yl,P.state=h.memoizedState,Z=y.getDerivedStateFromProps,typeof Z=="function"&&(OE(h,y,Z,b),P.state=h.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof P.getSnapshotBeforeUpdate=="function"||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(Z=P.state,typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount(),Z!==P.state&&oT.enqueueReplaceState(P,P.state,null),gh(h,b,P,N),mh(),P.state=h.memoizedState),typeof P.componentDidMount=="function"&&(h.flags|=4194308),b=!0}else if(d===null){P=h.stateNode;var ue=h.memoizedProps,we=bh(y,ue);P.props=we;var Be=P.context,it=y.contextType;Z=Yl,typeof it=="object"&&it!==null&&(Z=Ds(it));var mt=y.getDerivedStateFromProps;it=typeof mt=="function"||typeof P.getSnapshotBeforeUpdate=="function",ue=h.pendingProps!==ue,it||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(ue||Be!==Z)&&IR(h,P,b,Z),Ec=!1;var qe=h.memoizedState;P.state=qe,gh(h,b,P,N),mh(),Be=h.memoizedState,ue||qe!==Be||Ec?(typeof mt=="function"&&(OE(h,y,mt,b),Be=h.memoizedState),(we=Ec||cT(h,y,we,b,qe,Be,Z))?(it||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount()),typeof P.componentDidMount=="function"&&(h.flags|=4194308)):(typeof P.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=b,h.memoizedState=Be),P.props=b,P.state=Be,P.context=Z,b=we):(typeof P.componentDidMount=="function"&&(h.flags|=4194308),b=!1)}else{P=h.stateNode,jS(d,h),Z=h.memoizedProps,it=bh(y,Z),P.props=it,mt=h.pendingProps,qe=P.context,Be=y.contextType,we=Yl,typeof Be=="object"&&Be!==null&&(we=Ds(Be)),ue=y.getDerivedStateFromProps,(Be=typeof ue=="function"||typeof P.getSnapshotBeforeUpdate=="function")||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(Z!==mt||qe!==we)&&IR(h,P,b,we),Ec=!1,qe=h.memoizedState,P.state=qe,gh(h,b,P,N),mh();var Qe=h.memoizedState;Z!==mt||qe!==Qe||Ec||d!==null&&d.dependencies!==null&&pE(d.dependencies)?(typeof ue=="function"&&(OE(h,y,ue,b),Qe=h.memoizedState),(it=Ec||cT(h,y,it,b,qe,Qe,we)||d!==null&&d.dependencies!==null&&pE(d.dependencies))?(Be||typeof P.UNSAFE_componentWillUpdate!="function"&&typeof P.componentWillUpdate!="function"||(typeof P.componentWillUpdate=="function"&&P.componentWillUpdate(b,Qe,we),typeof P.UNSAFE_componentWillUpdate=="function"&&P.UNSAFE_componentWillUpdate(b,Qe,we)),typeof P.componentDidUpdate=="function"&&(h.flags|=4),typeof P.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof P.componentDidUpdate!="function"||Z===d.memoizedProps&&qe===d.memoizedState||(h.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||Z===d.memoizedProps&&qe===d.memoizedState||(h.flags|=1024),h.memoizedProps=b,h.memoizedState=Qe),P.props=b,P.state=Qe,P.context=we,b=it):(typeof P.componentDidUpdate!="function"||Z===d.memoizedProps&&qe===d.memoizedState||(h.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||Z===d.memoizedProps&&qe===d.memoizedState||(h.flags|=1024),b=!1)}return P=b,kE(d,h),b=(h.flags&128)!==0,P||b?(P=h.stateNode,y=b&&typeof y.getDerivedStateFromError!="function"?null:P.render(),h.flags|=1,d!==null&&b?(h.child=Th(h,d.child,null,N),h.child=Th(h,null,y,N)):ra(d,h,y,N),h.memoizedState=P.state,d=h.child):d=il(d,h,N),d}function VR(d,h,y,b){return uh(),h.flags|=256,ra(d,h,y,b),h.child}var pT={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function zp(d){return{baseLanes:d,cachePool:J0()}}function qm(d,h,y){return d=d!==null?d.childLanes&~y:0,h&&(d|=qo),d}function fT(d,h,y){var b=h.pendingProps,N=!1,P=(h.flags&128)!==0,Z;if((Z=P)||(Z=d!==null&&d.memoizedState===null?!1:(Ps.current&2)!==0),Z&&(N=!0,h.flags&=-129),Z=(h.flags&32)!==0,h.flags&=-33,d===null){if(Ur){if(N?Kd(h):Xd(),Ur){var ue=Ii,we;if(we=ue){e:{for(we=ue,ue=el;we.nodeType!==8;){if(!ue){ue=null;break e}if(we=Cc(we.nextSibling),we===null){ue=null;break e}}ue=we}ue!==null?(h.memoizedState={dehydrated:ue,treeContext:oh!==null?{id:Kl,overflow:_c}:null,retryLane:536870912,hydrationErrors:null},we=wo(18,null,null,0),we.stateNode=ue,we.return=h,h.child=we,ma=h,Ii=null,we=!0):we=!1}we||dh(h)}if(ue=h.memoizedState,ue!==null&&(ue=ue.dehydrated,ue!==null))return oy(ue)?h.lanes=32:h.lanes=536870912,null;rl(h)}return ue=b.children,b=b.fallback,N?(Xd(),N=h.mode,ue=Km({mode:"hidden",children:ue},N),b=Fd(b,N,y,null),ue.return=h,b.return=h,ue.sibling=b,h.child=ue,N=h.child,N.memoizedState=zp(y),N.childLanes=qm(d,Z,y),h.memoizedState=pT,b):(Kd(h),Yp(h,ue))}if(we=d.memoizedState,we!==null&&(ue=we.dehydrated,ue!==null)){if(P)h.flags&256?(Kd(h),h.flags&=-257,h=mT(d,h,y)):h.memoizedState!==null?(Xd(),h.child=d.child,h.flags|=128,h=null):(Xd(),N=b.fallback,ue=h.mode,b=Km({mode:"visible",children:b.children},ue),N=Fd(N,ue,y,null),N.flags|=2,b.return=h,N.return=h,b.sibling=N,h.child=b,Th(h,d.child,null,y),b=h.child,b.memoizedState=zp(y),b.childLanes=qm(d,Z,y),h.memoizedState=pT,h=N);else if(Kd(h),oy(ue)){if(Z=ue.nextSibling&&ue.nextSibling.dataset,Z)var Be=Z.dgst;Z=Be,b=Error(a(419)),b.stack="",b.digest=Z,Rm({value:b,source:null,stack:null}),h=mT(d,h,y)}else if(qs||Cm(d,h,y,!1),Z=(y&d.childLanes)!==0,qs||Z){if(Z=wi,Z!==null&&(b=y&-y,b=(b&42)!==0?1:un(b),b=(b&(Z.suspendedLanes|y))!==0?0:b,b!==0&&b!==we.retryLane))throw we.retryLane=b,Np(d,b),eo(Z,d,b),kR;ue.data==="$?"||Dh(),h=mT(d,h,y)}else ue.data==="$?"?(h.flags|=192,h.child=d.child,h=null):(d=we.treeContext,Ii=Cc(ue.nextSibling),ma=h,Ur=!0,lh=null,el=!1,d!==null&&(Ro[zo++]=Kl,Ro[zo++]=_c,Ro[zo++]=oh,Kl=d.id,_c=d.overflow,oh=h),h=Yp(h,b.children),h.flags|=4096);return h}return N?(Xd(),N=b.fallback,ue=h.mode,we=d.child,Be=we.sibling,b=ql(we,{mode:"hidden",children:b.children}),b.subtreeFlags=we.subtreeFlags&65011712,Be!==null?N=ql(Be,N):(N=Fd(N,ue,y,null),N.flags|=2),N.return=h,b.return=h,b.sibling=N,h.child=b,b=N,N=h.child,ue=d.child.memoizedState,ue===null?ue=zp(y):(we=ue.cachePool,we!==null?(Be=fs._currentValue,we=we.parent!==Be?{parent:Be,pool:Be}:we):we=J0(),ue={baseLanes:ue.baseLanes|y,cachePool:we}),N.memoizedState=ue,N.childLanes=qm(d,Z,y),h.memoizedState=pT,b):(Kd(h),y=d.child,d=y.sibling,y=ql(y,{mode:"visible",children:b.children}),y.return=h,y.sibling=null,d!==null&&(Z=h.deletions,Z===null?(h.deletions=[d],h.flags|=16):Z.push(d)),h.child=y,h.memoizedState=null,y)}function Yp(d,h){return h=Km({mode:"visible",children:h},d.mode),h.return=d,d.child=h}function Km(d,h){return d=wo(22,d,null,h),d.lanes=0,d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},d}function mT(d,h,y){return Th(h,d.child,null,y),d=Yp(h,h.pendingProps.children),d.flags|=2,h.memoizedState=null,d}function gT(d,h,y){d.lanes|=h;var b=d.alternate;b!==null&&(b.lanes|=h),kS(d.return,h,y)}function qp(d,h,y,b,N){var P=d.memoizedState;P===null?d.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:b,tail:y,tailMode:N}:(P.isBackwards=h,P.rendering=null,P.renderingStartTime=0,P.last=b,P.tail=y,P.tailMode=N)}function FR(d,h,y){var b=h.pendingProps,N=b.revealOrder,P=b.tail;if(ra(d,h,b.children,y),b=Ps.current,(b&2)!==0)b=b&1|2,h.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=h.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&gT(d,y,h);else if(d.tag===19)gT(d,y,h);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===h)break e;for(;d.sibling===null;){if(d.return===null||d.return===h)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}b&=1}switch(Xe(Ps,b),N){case"forwards":for(y=h.child,N=null;y!==null;)d=y.alternate,d!==null&&Wp(d)===null&&(N=y),y=y.sibling;y=N,y===null?(N=h.child,h.child=null):(N=y.sibling,y.sibling=null),qp(h,!1,N,y,P);break;case"backwards":for(y=null,N=h.child,h.child=null;N!==null;){if(d=N.alternate,d!==null&&Wp(d)===null){h.child=N;break}d=N.sibling,N.sibling=y,y=N,N=d}qp(h,!0,y,null,P);break;case"together":qp(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function il(d,h,y){if(d!==null&&(h.dependencies=d.dependencies),bc|=h.lanes,(y&h.childLanes)===0)if(d!==null){if(Cm(d,h,y,!1),(y&h.childLanes)===0)return null}else return null;if(d!==null&&h.child!==d.child)throw Error(a(153));if(h.child!==null){for(d=h.child,y=ql(d,d.pendingProps),h.child=y,y.return=h;d.sibling!==null;)d=d.sibling,y=y.sibling=ql(d,d.pendingProps),y.return=h;y.sibling=null}return h.child}function LE(d,h){return(d.lanes&h)!==0?!0:(d=d.dependencies,!!(d!==null&&pE(d)))}function rx(d,h,y){switch(h.tag){case 3:$t(h,h.stateNode.containerInfo),Bd(h,fs,d.memoizedState.cache),uh();break;case 27:case 5:on(h);break;case 4:$t(h,h.stateNode.containerInfo);break;case 10:Bd(h,h.type,h.memoizedProps.value);break;case 13:var b=h.memoizedState;if(b!==null)return b.dehydrated!==null?(Kd(h),h.flags|=128,null):(y&h.child.childLanes)!==0?fT(d,h,y):(Kd(h),d=il(d,h,y),d!==null?d.sibling:null);Kd(h);break;case 19:var N=(d.flags&128)!==0;if(b=(y&h.childLanes)!==0,b||(Cm(d,h,y,!1),b=(y&h.childLanes)!==0),N){if(b)return FR(d,h,y);h.flags|=128}if(N=h.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),Xe(Ps,Ps.current),b)break;return null;case 22:case 23:return h.lanes=0,jR(d,h,y);case 24:Bd(h,fs,d.memoizedState.cache)}return il(d,h,y)}function Xm(d,h,y){if(d!==null)if(d.memoizedProps!==h.pendingProps)qs=!0;else{if(!LE(d,y)&&(h.flags&128)===0)return qs=!1,rx(d,h,y);qs=(d.flags&131072)!==0}else qs=!1,Ur&&(h.flags&1048576)!==0&&NS(h,dE,h.index);switch(h.lanes=0,h.tag){case 16:e:{d=h.pendingProps;var b=h.elementType,N=b._init;if(b=N(b._payload),h.type=b,typeof b=="function")AS(b)?(d=bh(b,d),h.tag=1,h=hT(null,h,b,d,y)):(h.tag=0,h=dT(null,h,b,d,y));else{if(b!=null){if(N=b.$$typeof,N===_e){h.tag=11,h=PE(null,h,b,d,y);break e}else if(N===ee){h.tag=14,h=LR(null,h,b,d,y);break e}}throw h=Re(b)||b,Error(a(306,h,""))}}return h;case 0:return dT(d,h,h.type,h.pendingProps,y);case 1:return b=h.type,N=bh(b,h.pendingProps),hT(d,h,b,N,y);case 3:e:{if($t(h,h.stateNode.containerInfo),d===null)throw Error(a(387));b=h.pendingProps;var P=h.memoizedState;N=P.element,jS(d,h),gh(h,b,null,y);var Z=h.memoizedState;if(b=Z.cache,Bd(h,fs,b),b!==P.cache&&LS(h,[fs],y,!0),mh(),b=Z.element,P.isDehydrated)if(P={element:b,isDehydrated:!1,cache:Z.cache},h.updateQueue.baseState=P,h.memoizedState=P,h.flags&256){h=VR(d,h,b,y);break e}else if(b!==N){N=bo(Error(a(424)),h),Rm(N),h=VR(d,h,b,y);break e}else{switch(d=h.stateNode.containerInfo,d.nodeType){case 9:d=d.body;break;default:d=d.nodeName==="HTML"?d.ownerDocument.body:d}for(Ii=Cc(d.firstChild),ma=h,Ur=!0,lh=null,el=!0,y=CR(h,null,b,y),h.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling}else{if(uh(),b===N){h=il(d,h,y);break e}ra(d,h,b,y)}h=h.child}return h;case 26:return kE(d,h),d===null?(y=gC(h.type,null,h.pendingProps,null))?h.memoizedState=y:Ur||(y=h.type,d=h.pendingProps,b=ay(It.current).createElement(y),b[or]=h,b[pr]=d,Xs(b,y,d),Ui(b),h.stateNode=b):h.memoizedState=gC(h.type,d.memoizedProps,h.pendingProps,d.memoizedState),null;case 27:return on(h),d===null&&Ur&&(b=h.stateNode=hC(h.type,h.pendingProps,It.current),ma=h,el=!0,N=Ii,iu(h.type)?(XT=N,Ii=Cc(b.firstChild)):Ii=N),ra(d,h,h.pendingProps.children,y),kE(d,h),d===null&&(h.flags|=4194304),h.child;case 5:return d===null&&Ur&&((N=b=Ii)&&(b=Sx(b,h.type,h.pendingProps,el),b!==null?(h.stateNode=b,ma=h,Ii=Cc(b.firstChild),el=!1,N=!0):N=!1),N||dh(h)),on(h),N=h.type,P=h.pendingProps,Z=d!==null?d.memoizedProps:null,b=P.children,YT(N,P)?b=null:Z!==null&&YT(N,Z)&&(h.flags|=32),h.memoizedState!==null&&(N=HS(d,h,aR,null,null,y),Eg._currentValue=N),kE(d,h),ra(d,h,b,y),h.child;case 6:return d===null&&Ur&&((d=y=Ii)&&(y=Tx(y,h.pendingProps,el),y!==null?(h.stateNode=y,ma=h,Ii=null,d=!0):d=!1),d||dh(h)),null;case 13:return fT(d,h,y);case 4:return $t(h,h.stateNode.containerInfo),b=h.pendingProps,d===null?h.child=Th(h,null,b,y):ra(d,h,b,y),h.child;case 11:return PE(d,h,h.type,h.pendingProps,y);case 7:return ra(d,h,h.pendingProps,y),h.child;case 8:return ra(d,h,h.pendingProps.children,y),h.child;case 12:return ra(d,h,h.pendingProps.children,y),h.child;case 10:return b=h.pendingProps,Bd(h,h.type,b.value),ra(d,h,b.children,y),h.child;case 9:return N=h.type._context,b=h.pendingProps.children,tl(h),N=Ds(N),b=b(N),h.flags|=1,ra(d,h,b,y),h.child;case 14:return LR(d,h,h.type,h.pendingProps,y);case 15:return MR(d,h,h.type,h.pendingProps,y);case 19:return FR(d,h,y);case 31:return b=h.pendingProps,y=h.mode,b={mode:b.mode,children:b.children},d===null?(y=Km(b,y),y.ref=h.ref,h.child=y,y.return=h,h=y):(y=ql(d.child,b),y.ref=h.ref,h.child=y,y.return=h,h=y),h;case 22:return jR(d,h,y);case 24:return tl(h),b=Ds(fs),d===null?(N=MS(),N===null&&(N=wi,P=Am(),N.pooledCache=P,P.refCount++,P!==null&&(N.pooledCacheLanes|=y),N=P),h.memoizedState={parent:b,cache:N},_E(h),Bd(h,fs,N)):((d.lanes&y)!==0&&(jS(d,h),gh(h,null,null,y),mh()),N=d.memoizedState,P=h.memoizedState,N.parent!==b?(N={parent:b,cache:b},h.memoizedState=N,h.lanes===0&&(h.memoizedState=h.updateQueue.baseState=N),Bd(h,fs,b)):(b=P.cache,Bd(h,fs,b),b!==N.cache&&LS(h,[fs],y,!0))),ra(d,h,h.pendingProps.children,y),h.child;case 29:throw h.pendingProps}throw Error(a(156,h.tag))}function sl(d){d.flags|=4}function BR(d,h){if(h.type!=="stylesheet"||(h.state.loading&4)!==0)d.flags&=-16777217;else if(d.flags|=16777216,!yC(h)){if(h=xs.current,h!==null&&((wr&4194048)===wr?nl!==null:(wr&62914560)!==wr&&(wr&536870912)===0||h!==nl))throw Om=Lp,Z0;d.flags|=8192}}function ME(d,h){h!==null&&(d.flags|=4),d.flags&16384&&(h=d.tag!==22?je():536870912,d.lanes|=h,Ah|=h)}function Qm(d,h){if(!Ur)switch(d.tailMode){case"hidden":h=d.tail;for(var y=null;h!==null;)h.alternate!==null&&(y=h),h=h.sibling;y===null?d.tail=null:y.sibling=null;break;case"collapsed":y=d.tail;for(var b=null;y!==null;)y.alternate!==null&&(b=y),y=y.sibling;b===null?h||d.tail===null?d.tail=null:d.tail.sibling=null:b.sibling=null}}function bi(d){var h=d.alternate!==null&&d.alternate.child===d.child,y=0,b=0;if(h)for(var N=d.child;N!==null;)y|=N.lanes|N.childLanes,b|=N.subtreeFlags&65011712,b|=N.flags&65011712,N.return=d,N=N.sibling;else for(N=d.child;N!==null;)y|=N.lanes|N.childLanes,b|=N.subtreeFlags,b|=N.flags,N.return=d,N=N.sibling;return d.subtreeFlags|=b,d.childLanes=y,h}function ix(d,h,y){var b=h.pendingProps;switch(OS(h),h.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bi(h),null;case 1:return bi(h),null;case 3:return y=h.stateNode,b=null,d!==null&&(b=d.memoizedState.cache),h.memoizedState.cache!==b&&(h.flags|=2048),Ql(fs),Tt(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(d===null||d.child===null)&&(wm(h)?sl(h):d===null||d.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,q0())),bi(h),null;case 26:return y=h.memoizedState,d===null?(sl(h),y!==null?(bi(h),BR(h,y)):(bi(h),h.flags&=-16777217)):y?y!==d.memoizedState?(sl(h),bi(h),BR(h,y)):(bi(h),h.flags&=-16777217):(d.memoizedProps!==b&&sl(h),bi(h),h.flags&=-16777217),null;case 27:fn(h),y=It.current;var N=h.type;if(d!==null&&h.stateNode!=null)d.memoizedProps!==b&&sl(h);else{if(!b){if(h.stateNode===null)throw Error(a(166));return bi(h),null}d=ut.current,wm(h)?xS(h):(d=hC(N,b,y),h.stateNode=d,sl(h))}return bi(h),null;case 5:if(fn(h),y=h.type,d!==null&&h.stateNode!=null)d.memoizedProps!==b&&sl(h);else{if(!b){if(h.stateNode===null)throw Error(a(166));return bi(h),null}if(d=ut.current,wm(h))xS(h);else{switch(N=ay(It.current),d){case 1:d=N.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:d=N.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":d=N.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":d=N.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":d=N.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild);break;case"select":d=typeof b.is=="string"?N.createElement("select",{is:b.is}):N.createElement("select"),b.multiple?d.multiple=!0:b.size&&(d.size=b.size);break;default:d=typeof b.is=="string"?N.createElement(y,{is:b.is}):N.createElement(y)}}d[or]=h,d[pr]=b;e:for(N=h.child;N!==null;){if(N.tag===5||N.tag===6)d.appendChild(N.stateNode);else if(N.tag!==4&&N.tag!==27&&N.child!==null){N.child.return=N,N=N.child;continue}if(N===h)break e;for(;N.sibling===null;){if(N.return===null||N.return===h)break e;N=N.return}N.sibling.return=N.return,N=N.sibling}h.stateNode=d;e:switch(Xs(d,y,b),y){case"button":case"input":case"select":case"textarea":d=!!b.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&sl(h)}}return bi(h),h.flags&=-16777217,null;case 6:if(d&&h.stateNode!=null)d.memoizedProps!==b&&sl(h);else{if(typeof b!="string"&&h.stateNode===null)throw Error(a(166));if(d=It.current,wm(h)){if(d=h.stateNode,y=h.memoizedProps,b=null,N=ma,N!==null)switch(N.tag){case 27:case 5:b=N.memoizedProps}d[or]=h,d=!!(d.nodeValue===y||b!==null&&b.suppressHydrationWarning===!0||sy(d.nodeValue,y)),d||dh(h)}else d=ay(d).createTextNode(b),d[or]=h,h.stateNode=d}return bi(h),null;case 13:if(b=h.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(N=wm(h),b!==null&&b.dehydrated!==null){if(d===null){if(!N)throw Error(a(318));if(N=h.memoizedState,N=N!==null?N.dehydrated:null,!N)throw Error(a(317));N[or]=h}else uh(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;bi(h),N=!1}else N=q0(),d!==null&&d.memoizedState!==null&&(d.memoizedState.hydrationErrors=N),N=!0;if(!N)return h.flags&256?(rl(h),h):(rl(h),null)}if(rl(h),(h.flags&128)!==0)return h.lanes=y,h;if(y=b!==null,d=d!==null&&d.memoizedState!==null,y){b=h.child,N=null,b.alternate!==null&&b.alternate.memoizedState!==null&&b.alternate.memoizedState.cachePool!==null&&(N=b.alternate.memoizedState.cachePool.pool);var P=null;b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(P=b.memoizedState.cachePool.pool),P!==N&&(b.flags|=2048)}return y!==d&&y&&(h.child.flags|=8192),ME(h,h.updateQueue),bi(h),null;case 4:return Tt(),d===null&&ry(h.stateNode.containerInfo),bi(h),null;case 10:return Ql(h.type),bi(h),null;case 19:if(xe(Ps),N=h.memoizedState,N===null)return bi(h),null;if(b=(h.flags&128)!==0,P=N.rendering,P===null)if(b)Qm(N,!1);else{if(Vi!==0||d!==null&&(d.flags&128)!==0)for(d=h.child;d!==null;){if(P=Wp(d),P!==null){for(h.flags|=128,Qm(N,!1),d=P.updateQueue,h.updateQueue=d,ME(h,d),h.subtreeFlags=0,d=y,y=h.child;y!==null;)oE(y,d),y=y.sibling;return Xe(Ps,Ps.current&1|2),h.child}d=d.sibling}N.tail!==null&&rt()>Jp&&(h.flags|=128,b=!0,Qm(N,!1),h.lanes=4194304)}else{if(!b)if(d=Wp(P),d!==null){if(h.flags|=128,b=!0,d=d.updateQueue,h.updateQueue=d,ME(h,d),Qm(N,!0),N.tail===null&&N.tailMode==="hidden"&&!P.alternate&&!Ur)return bi(h),null}else 2*rt()-N.renderingStartTime>Jp&&y!==536870912&&(h.flags|=128,b=!0,Qm(N,!1),h.lanes=4194304);N.isBackwards?(P.sibling=h.child,h.child=P):(d=N.last,d!==null?d.sibling=P:h.child=P,N.last=P)}return N.tail!==null?(h=N.tail,N.rendering=h,N.tail=h.sibling,N.renderingStartTime=rt(),h.sibling=null,d=Ps.current,Xe(Ps,b?d&1|2:d&1),h):(bi(h),null);case 22:case 23:return rl(h),BS(),b=h.memoizedState!==null,d!==null?d.memoizedState!==null!==b&&(h.flags|=8192):b&&(h.flags|=8192),b?(y&536870912)!==0&&(h.flags&128)===0&&(bi(h),h.subtreeFlags&6&&(h.flags|=8192)):bi(h),y=h.updateQueue,y!==null&&ME(h,y.retryQueue),y=null,d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(y=d.memoizedState.cachePool.pool),b=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(b=h.memoizedState.cachePool.pool),b!==y&&(h.flags|=2048),d!==null&&xe(Hd),null;case 24:return y=null,d!==null&&(y=d.memoizedState.cache),h.memoizedState.cache!==y&&(h.flags|=2048),Ql(fs),bi(h),null;case 25:return null;case 30:return null}throw Error(a(156,h.tag))}function sx(d,h){switch(OS(h),h.tag){case 1:return d=h.flags,d&65536?(h.flags=d&-65537|128,h):null;case 3:return Ql(fs),Tt(),d=h.flags,(d&65536)!==0&&(d&128)===0?(h.flags=d&-65537|128,h):null;case 26:case 27:case 5:return fn(h),null;case 13:if(rl(h),d=h.memoizedState,d!==null&&d.dehydrated!==null){if(h.alternate===null)throw Error(a(340));uh()}return d=h.flags,d&65536?(h.flags=d&-65537|128,h):null;case 19:return xe(Ps),null;case 4:return Tt(),null;case 10:return Ql(h.type),null;case 22:case 23:return rl(h),BS(),d!==null&&xe(Hd),d=h.flags,d&65536?(h.flags=d&-65537|128,h):null;case 24:return Ql(fs),null;case 25:return null;default:return null}}function HR(d,h){switch(OS(h),h.tag){case 3:Ql(fs),Tt();break;case 26:case 27:case 5:fn(h);break;case 4:Tt();break;case 13:rl(h);break;case 19:xe(Ps);break;case 10:Ql(h.type);break;case 22:case 23:rl(h),BS(),d!==null&&xe(Hd);break;case 24:Ql(fs)}}function Kp(d,h){try{var y=h.updateQueue,b=y!==null?y.lastEffect:null;if(b!==null){var N=b.next;y=N;do{if((y.tag&d)===d){b=void 0;var P=y.create,Z=y.inst;b=P(),Z.destroy=b}y=y.next}while(y!==N)}}catch(ue){pi(h,h.return,ue)}}function Qd(d,h,y){try{var b=h.updateQueue,N=b!==null?b.lastEffect:null;if(N!==null){var P=N.next;b=P;do{if((b.tag&d)===d){var Z=b.inst,ue=Z.destroy;if(ue!==void 0){Z.destroy=void 0,N=h;var we=y,Be=ue;try{Be()}catch(it){pi(N,we,it)}}}b=b.next}while(b!==P)}}catch(it){pi(h,h.return,it)}}function GR(d){var h=d.updateQueue;if(h!==null){var y=d.stateNode;try{EE(h,y)}catch(b){pi(d,d.return,b)}}}function jE(d,h,y){y.props=bh(d.type,d.memoizedProps),y.state=d.memoizedState;try{y.componentWillUnmount()}catch(b){pi(d,h,b)}}function $m(d,h){try{var y=d.ref;if(y!==null){switch(d.tag){case 26:case 27:case 5:var b=d.stateNode;break;case 30:b=d.stateNode;break;default:b=d.stateNode}typeof y=="function"?d.refCleanup=y(b):y.current=b}}catch(N){pi(d,h,N)}}function Yo(d,h){var y=d.ref,b=d.refCleanup;if(y!==null)if(typeof b=="function")try{b()}catch(N){pi(d,h,N)}finally{d.refCleanup=null,d=d.alternate,d!=null&&(d.refCleanup=null)}else if(typeof y=="function")try{y(null)}catch(N){pi(d,h,N)}else y.current=null}function WR(d){var h=d.type,y=d.memoizedProps,b=d.stateNode;try{e:switch(h){case"button":case"input":case"select":case"textarea":y.autoFocus&&b.focus();break e;case"img":y.src?b.src=y.src:y.srcSet&&(b.srcset=y.srcSet)}}catch(N){pi(d,d.return,N)}}function UE(d,h,y){try{var b=d.stateNode;gx(b,d.type,y,h),b[pr]=h}catch(N){pi(d,d.return,N)}}function zR(d){return d.tag===5||d.tag===3||d.tag===26||d.tag===27&&iu(d.type)||d.tag===4}function _T(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||zR(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.tag===27&&iu(d.type)||d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function VE(d,h,y){var b=d.tag;if(b===5||b===6)d=d.stateNode,h?(y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y).insertBefore(d,h):(h=y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y,h.appendChild(d),y=y._reactRootContainer,y!=null||h.onclick!==null||(h.onclick=hg));else if(b!==4&&(b===27&&iu(d.type)&&(y=d.stateNode,h=null),d=d.child,d!==null))for(VE(d,h,y),d=d.sibling;d!==null;)VE(d,h,y),d=d.sibling}function FE(d,h,y){var b=d.tag;if(b===5||b===6)d=d.stateNode,h?y.insertBefore(d,h):y.appendChild(d);else if(b!==4&&(b===27&&iu(d.type)&&(y=d.stateNode),d=d.child,d!==null))for(FE(d,h,y),d=d.sibling;d!==null;)FE(d,h,y),d=d.sibling}function YR(d){var h=d.stateNode,y=d.memoizedProps;try{for(var b=d.type,N=h.attributes;N.length;)h.removeAttributeNode(N[0]);Xs(h,b,y),h[or]=d,h[pr]=y}catch(P){pi(d,d.return,P)}}var al=!1,qi=!1,Jm=!1,qR=typeof WeakSet=="function"?WeakSet:Set,Ks=null;function Zm(d,h){if(d=d.containerInfo,zT=fy,d=zl(d),ES(d)){if("selectionStart"in d)var y={start:d.selectionStart,end:d.selectionEnd};else e:{y=(y=d.ownerDocument)&&y.defaultView||window;var b=y.getSelection&&y.getSelection();if(b&&b.rangeCount!==0){y=b.anchorNode;var N=b.anchorOffset,P=b.focusNode;b=b.focusOffset;try{y.nodeType,P.nodeType}catch{y=null;break e}var Z=0,ue=-1,we=-1,Be=0,it=0,mt=d,qe=null;t:for(;;){for(var Qe;mt!==y||N!==0&&mt.nodeType!==3||(ue=Z+N),mt!==P||b!==0&&mt.nodeType!==3||(we=Z+b),mt.nodeType===3&&(Z+=mt.nodeValue.length),(Qe=mt.firstChild)!==null;)qe=mt,mt=Qe;for(;;){if(mt===d)break t;if(qe===y&&++Be===N&&(ue=Z),qe===P&&++it===b&&(we=Z),(Qe=mt.nextSibling)!==null)break;mt=qe,qe=mt.parentNode}mt=Qe}y=ue===-1||we===-1?null:{start:ue,end:we}}else y=null}y=y||{start:0,end:0}}else y=null;for(df={focusedElem:d,selectionRange:y},fy=!1,Ks=h;Ks!==null;)if(h=Ks,d=h.child,(h.subtreeFlags&1024)!==0&&d!==null)d.return=h,Ks=d;else for(;Ks!==null;){switch(h=Ks,P=h.alternate,d=h.flags,h.tag){case 0:break;case 11:case 15:break;case 1:if((d&1024)!==0&&P!==null){d=void 0,y=h,N=P.memoizedProps,P=P.memoizedState,b=y.stateNode;try{var kn=bh(y.type,N,y.elementType===y.type);d=b.getSnapshotBeforeUpdate(kn,P),b.__reactInternalSnapshotBeforeUpdate=d}catch(vn){pi(y,y.return,vn)}}break;case 3:if((d&1024)!==0){if(d=h.stateNode.containerInfo,y=d.nodeType,y===9)KT(d);else if(y===1)switch(d.nodeName){case"HEAD":case"HTML":case"BODY":KT(d);break;default:d.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((d&1024)!==0)throw Error(a(163))}if(d=h.sibling,d!==null){d.return=h.return,Ks=d;break}Ks=h.return}}function ET(d,h,y){var b=y.flags;switch(y.tag){case 0:case 11:case 15:Da(d,y),b&4&&Kp(5,y);break;case 1:if(Da(d,y),b&4)if(d=y.stateNode,h===null)try{d.componentDidMount()}catch(Z){pi(y,y.return,Z)}else{var N=bh(y.type,h.memoizedProps);h=h.memoizedState;try{d.componentDidUpdate(N,h,d.__reactInternalSnapshotBeforeUpdate)}catch(Z){pi(y,y.return,Z)}}b&64&&GR(y),b&512&&$m(y,y.return);break;case 3:if(Da(d,y),b&64&&(d=y.updateQueue,d!==null)){if(h=null,y.child!==null)switch(y.child.tag){case 27:case 5:h=y.child.stateNode;break;case 1:h=y.child.stateNode}try{EE(d,h)}catch(Z){pi(y,y.return,Z)}}break;case 27:h===null&&b&4&&YR(y);case 26:case 5:Da(d,y),h===null&&b&4&&WR(y),b&512&&$m(y,y.return);break;case 12:Da(d,y);break;case 13:Da(d,y),b&4&&KR(d,y),b&64&&(d=y.memoizedState,d!==null&&(d=d.dehydrated,d!==null&&(y=ux.bind(null,y),bx(d,y))));break;case 22:if(b=y.memoizedState!==null||al,!b){h=h!==null&&h.memoizedState!==null||qi,N=al;var P=qi;al=b,(qi=h)&&!P?Za(d,y,(y.subtreeFlags&8772)!==0):Da(d,y),al=N,qi=P}break;case 30:break;default:Da(d,y)}}function Xp(d){var h=d.alternate;h!==null&&(d.alternate=null,Xp(h)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(h=d.stateNode,h!==null&&Aa(h)),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}var Jr=null,Oa=!1;function Sc(d,h,y){for(y=y.child;y!==null;)eg(d,h,y),y=y.sibling}function eg(d,h,y){if(Bt&&typeof Bt.onCommitFiberUnmount=="function")try{Bt.onCommitFiberUnmount(vt,y)}catch{}switch(y.tag){case 26:qi||Yo(y,h),Sc(d,h,y),y.memoizedState?y.memoizedState.count--:y.stateNode&&(y=y.stateNode,y.parentNode.removeChild(y));break;case 27:qi||Yo(y,h);var b=Jr,N=Oa;iu(y.type)&&(Jr=y.stateNode,Oa=!1),Sc(d,h,y),pg(y.stateNode),Jr=b,Oa=N;break;case 5:qi||Yo(y,h);case 6:if(b=Jr,N=Oa,Jr=null,Sc(d,h,y),Jr=b,Oa=N,Jr!==null)if(Oa)try{(Jr.nodeType===9?Jr.body:Jr.nodeName==="HTML"?Jr.ownerDocument.body:Jr).removeChild(y.stateNode)}catch(P){pi(y,h,P)}else try{Jr.removeChild(y.stateNode)}catch(P){pi(y,h,P)}break;case 18:Jr!==null&&(Oa?(d=Jr,dC(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,y.stateNode),bg(d)):dC(Jr,y.stateNode));break;case 4:b=Jr,N=Oa,Jr=y.stateNode.containerInfo,Oa=!0,Sc(d,h,y),Jr=b,Oa=N;break;case 0:case 11:case 14:case 15:qi||Qd(2,y,h),qi||Qd(4,y,h),Sc(d,h,y);break;case 1:qi||(Yo(y,h),b=y.stateNode,typeof b.componentWillUnmount=="function"&&jE(y,h,b)),Sc(d,h,y);break;case 21:Sc(d,h,y);break;case 22:qi=(b=qi)||y.memoizedState!==null,Sc(d,h,y),qi=b;break;default:Sc(d,h,y)}}function KR(d,h){if(h.memoizedState===null&&(d=h.alternate,d!==null&&(d=d.memoizedState,d!==null&&(d=d.dehydrated,d!==null))))try{bg(d)}catch(y){pi(h,h.return,y)}}function ax(d){switch(d.tag){case 13:case 19:var h=d.stateNode;return h===null&&(h=d.stateNode=new qR),h;case 22:return d=d.stateNode,h=d._retryCache,h===null&&(h=d._retryCache=new qR),h;default:throw Error(a(435,d.tag))}}function yT(d,h){var y=ax(d);h.forEach(function(b){var N=hx.bind(null,d,b);y.has(b)||(y.add(b),b.then(N,N))})}function Ja(d,h){var y=h.deletions;if(y!==null)for(var b=0;b<y.length;b++){var N=y[b],P=d,Z=h,ue=Z;e:for(;ue!==null;){switch(ue.tag){case 27:if(iu(ue.type)){Jr=ue.stateNode,Oa=!1;break e}break;case 5:Jr=ue.stateNode,Oa=!1;break e;case 3:case 4:Jr=ue.stateNode.containerInfo,Oa=!0;break e}ue=ue.return}if(Jr===null)throw Error(a(160));eg(P,Z,N),Jr=null,Oa=!1,P=N.alternate,P!==null&&(P.return=null),N.return=null}if(h.subtreeFlags&13878)for(h=h.child;h!==null;)XR(h,d),h=h.sibling}var Tc=null;function XR(d,h){var y=d.alternate,b=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:Ja(h,d),Ao(d),b&4&&(Qd(3,d,d.return),Kp(3,d),Qd(5,d,d.return));break;case 1:Ja(h,d),Ao(d),b&512&&(qi||y===null||Yo(y,y.return)),b&64&&al&&(d=d.updateQueue,d!==null&&(b=d.callbacks,b!==null&&(y=d.shared.hiddenCallbacks,d.shared.hiddenCallbacks=y===null?b:y.concat(b))));break;case 26:var N=Tc;if(Ja(h,d),Ao(d),b&512&&(qi||y===null||Yo(y,y.return)),b&4){var P=y!==null?y.memoizedState:null;if(b=d.memoizedState,y===null)if(b===null)if(d.stateNode===null){e:{b=d.type,y=d.memoizedProps,N=N.ownerDocument||N;t:switch(b){case"title":P=N.getElementsByTagName("title")[0],(!P||P[Ya]||P[or]||P.namespaceURI==="http://www.w3.org/2000/svg"||P.hasAttribute("itemprop"))&&(P=N.createElement(b),N.head.insertBefore(P,N.querySelector("head > title"))),Xs(P,b,y),P[or]=d,Ui(P),b=P;break e;case"link":var Z=JT("link","href",N).get(b+(y.href||""));if(Z){for(var ue=0;ue<Z.length;ue++)if(P=Z[ue],P.getAttribute("href")===(y.href==null||y.href===""?null:y.href)&&P.getAttribute("rel")===(y.rel==null?null:y.rel)&&P.getAttribute("title")===(y.title==null?null:y.title)&&P.getAttribute("crossorigin")===(y.crossOrigin==null?null:y.crossOrigin)){Z.splice(ue,1);break t}}P=N.createElement(b),Xs(P,b,y),N.head.appendChild(P);break;case"meta":if(Z=JT("meta","content",N).get(b+(y.content||""))){for(ue=0;ue<Z.length;ue++)if(P=Z[ue],P.getAttribute("content")===(y.content==null?null:""+y.content)&&P.getAttribute("name")===(y.name==null?null:y.name)&&P.getAttribute("property")===(y.property==null?null:y.property)&&P.getAttribute("http-equiv")===(y.httpEquiv==null?null:y.httpEquiv)&&P.getAttribute("charset")===(y.charSet==null?null:y.charSet)){Z.splice(ue,1);break t}}P=N.createElement(b),Xs(P,b,y),N.head.appendChild(P);break;default:throw Error(a(468,b))}P[or]=d,Ui(P),b=P}d.stateNode=b}else EC(N,d.type,d.stateNode);else d.stateNode=dy(N,b,d.memoizedProps);else P!==b?(P===null?y.stateNode!==null&&(y=y.stateNode,y.parentNode.removeChild(y)):P.count--,b===null?EC(N,d.type,d.stateNode):dy(N,b,d.memoizedProps)):b===null&&d.stateNode!==null&&UE(d,d.memoizedProps,y.memoizedProps)}break;case 27:Ja(h,d),Ao(d),b&512&&(qi||y===null||Yo(y,y.return)),y!==null&&b&4&&UE(d,d.memoizedProps,y.memoizedProps);break;case 5:if(Ja(h,d),Ao(d),b&512&&(qi||y===null||Yo(y,y.return)),d.flags&32){N=d.stateNode;try{qa(N,"")}catch(Qe){pi(d,d.return,Qe)}}b&4&&d.stateNode!=null&&(N=d.memoizedProps,UE(d,N,y!==null?y.memoizedProps:N)),b&1024&&(Jm=!0);break;case 6:if(Ja(h,d),Ao(d),b&4){if(d.stateNode===null)throw Error(a(162));b=d.memoizedProps,y=d.stateNode;try{y.nodeValue=b}catch(Qe){pi(d,d.return,Qe)}}break;case 3:if(hy=null,N=Tc,Tc=cy(h.containerInfo),Ja(h,d),Tc=N,Ao(d),b&4&&y!==null&&y.memoizedState.isDehydrated)try{bg(h.containerInfo)}catch(Qe){pi(d,d.return,Qe)}Jm&&(Jm=!1,BE(d));break;case 4:b=Tc,Tc=cy(d.stateNode.containerInfo),Ja(h,d),Ao(d),Tc=b;break;case 12:Ja(h,d),Ao(d);break;case 13:Ja(h,d),Ao(d),d.child.flags&8192&&d.memoizedState!==null!=(y!==null&&y.memoizedState!==null)&&(sg=rt()),b&4&&(b=d.updateQueue,b!==null&&(d.updateQueue=null,yT(d,b)));break;case 22:N=d.memoizedState!==null;var we=y!==null&&y.memoizedState!==null,Be=al,it=qi;if(al=Be||N,qi=it||we,Ja(h,d),qi=it,al=Be,Ao(d),b&8192)e:for(h=d.stateNode,h._visibility=N?h._visibility&-2:h._visibility|1,N&&(y===null||we||al||qi||wh(d)),y=null,h=d;;){if(h.tag===5||h.tag===26){if(y===null){we=y=h;try{if(P=we.stateNode,N)Z=P.style,typeof Z.setProperty=="function"?Z.setProperty("display","none","important"):Z.display="none";else{ue=we.stateNode;var mt=we.memoizedProps.style,qe=mt!=null&&mt.hasOwnProperty("display")?mt.display:null;ue.style.display=qe==null||typeof qe=="boolean"?"":(""+qe).trim()}}catch(Qe){pi(we,we.return,Qe)}}}else if(h.tag===6){if(y===null){we=h;try{we.stateNode.nodeValue=N?"":we.memoizedProps}catch(Qe){pi(we,we.return,Qe)}}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===d)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===d)break e;for(;h.sibling===null;){if(h.return===null||h.return===d)break e;y===h&&(y=null),h=h.return}y===h&&(y=null),h.sibling.return=h.return,h=h.sibling}b&4&&(b=d.updateQueue,b!==null&&(y=b.retryQueue,y!==null&&(b.retryQueue=null,yT(d,y))));break;case 19:Ja(h,d),Ao(d),b&4&&(b=d.updateQueue,b!==null&&(d.updateQueue=null,yT(d,b)));break;case 30:break;case 21:break;default:Ja(h,d),Ao(d)}}function Ao(d){var h=d.flags;if(h&2){try{for(var y,b=d.return;b!==null;){if(zR(b)){y=b;break}b=b.return}if(y==null)throw Error(a(160));switch(y.tag){case 27:var N=y.stateNode,P=_T(d);FE(d,P,N);break;case 5:var Z=y.stateNode;y.flags&32&&(qa(Z,""),y.flags&=-33);var ue=_T(d);FE(d,ue,Z);break;case 3:case 4:var we=y.stateNode.containerInfo,Be=_T(d);VE(d,Be,we);break;default:throw Error(a(161))}}catch(it){pi(d,d.return,it)}d.flags&=-3}h&4096&&(d.flags&=-4097)}function BE(d){if(d.subtreeFlags&1024)for(d=d.child;d!==null;){var h=d;BE(h),h.tag===5&&h.flags&1024&&h.stateNode.reset(),d=d.sibling}}function Da(d,h){if(h.subtreeFlags&8772)for(h=h.child;h!==null;)ET(d,h.alternate,h),h=h.sibling}function wh(d){for(d=d.child;d!==null;){var h=d;switch(h.tag){case 0:case 11:case 14:case 15:Qd(4,h,h.return),wh(h);break;case 1:Yo(h,h.return);var y=h.stateNode;typeof y.componentWillUnmount=="function"&&jE(h,h.return,y),wh(h);break;case 27:pg(h.stateNode);case 26:case 5:Yo(h,h.return),wh(h);break;case 22:h.memoizedState===null&&wh(h);break;case 30:wh(h);break;default:wh(h)}d=d.sibling}}function Za(d,h,y){for(y=y&&(h.subtreeFlags&8772)!==0,h=h.child;h!==null;){var b=h.alternate,N=d,P=h,Z=P.flags;switch(P.tag){case 0:case 11:case 15:Za(N,P,y),Kp(4,P);break;case 1:if(Za(N,P,y),b=P,N=b.stateNode,typeof N.componentDidMount=="function")try{N.componentDidMount()}catch(Be){pi(b,b.return,Be)}if(b=P,N=b.updateQueue,N!==null){var ue=b.stateNode;try{var we=N.shared.hiddenCallbacks;if(we!==null)for(N.shared.hiddenCallbacks=null,N=0;N<we.length;N++)FS(we[N],ue)}catch(Be){pi(b,b.return,Be)}}y&&Z&64&&GR(P),$m(P,P.return);break;case 27:YR(P);case 26:case 5:Za(N,P,y),y&&b===null&&Z&4&&WR(P),$m(P,P.return);break;case 12:Za(N,P,y);break;case 13:Za(N,P,y),y&&Z&4&&KR(N,P);break;case 22:P.memoizedState===null&&Za(N,P,y),$m(P,P.return);break;case 30:break;default:Za(N,P,y)}h=h.sibling}}function HE(d,h){var y=null;d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(y=d.memoizedState.cachePool.pool),d=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(d=h.memoizedState.cachePool.pool),d!==y&&(d!=null&&d.refCount++,y!=null&&Im(y))}function xa(d,h){d=null,h.alternate!==null&&(d=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==d&&(h.refCount++,d!=null&&Im(d))}function ol(d,h,y,b){if(h.subtreeFlags&10256)for(h=h.child;h!==null;)QR(d,h,y,b),h=h.sibling}function QR(d,h,y,b){var N=h.flags;switch(h.tag){case 0:case 11:case 15:ol(d,h,y,b),N&2048&&Kp(9,h);break;case 1:ol(d,h,y,b);break;case 3:ol(d,h,y,b),N&2048&&(d=null,h.alternate!==null&&(d=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==d&&(h.refCount++,d!=null&&Im(d)));break;case 12:if(N&2048){ol(d,h,y,b),d=h.stateNode;try{var P=h.memoizedProps,Z=P.id,ue=P.onPostCommit;typeof ue=="function"&&ue(Z,h.alternate===null?"mount":"update",d.passiveEffectDuration,-0)}catch(we){pi(h,h.return,we)}}else ol(d,h,y,b);break;case 13:ol(d,h,y,b);break;case 23:break;case 22:P=h.stateNode,Z=h.alternate,h.memoizedState!==null?P._visibility&2?ol(d,h,y,b):tg(d,h):P._visibility&2?ol(d,h,y,b):(P._visibility|=2,Rh(d,h,y,b,(h.subtreeFlags&10256)!==0)),N&2048&&HE(Z,h);break;case 24:ol(d,h,y,b),N&2048&&xa(h.alternate,h);break;default:ol(d,h,y,b)}}function Rh(d,h,y,b,N){for(N=N&&(h.subtreeFlags&10256)!==0,h=h.child;h!==null;){var P=d,Z=h,ue=y,we=b,Be=Z.flags;switch(Z.tag){case 0:case 11:case 15:Rh(P,Z,ue,we,N),Kp(8,Z);break;case 23:break;case 22:var it=Z.stateNode;Z.memoizedState!==null?it._visibility&2?Rh(P,Z,ue,we,N):tg(P,Z):(it._visibility|=2,Rh(P,Z,ue,we,N)),N&&Be&2048&&HE(Z.alternate,Z);break;case 24:Rh(P,Z,ue,we,N),N&&Be&2048&&xa(Z.alternate,Z);break;default:Rh(P,Z,ue,we,N)}h=h.sibling}}function tg(d,h){if(h.subtreeFlags&10256)for(h=h.child;h!==null;){var y=d,b=h,N=b.flags;switch(b.tag){case 22:tg(y,b),N&2048&&HE(b.alternate,b);break;case 24:tg(y,b),N&2048&&xa(b.alternate,b);break;default:tg(y,b)}h=h.sibling}}var Qp=8192;function Ch(d){if(d.subtreeFlags&Qp)for(d=d.child;d!==null;)$R(d),d=d.sibling}function $R(d){switch(d.tag){case 26:Ch(d),d.flags&Qp&&d.memoizedState!==null&&Px(Tc,d.memoizedState,d.memoizedProps);break;case 5:Ch(d);break;case 3:case 4:var h=Tc;Tc=cy(d.stateNode.containerInfo),Ch(d),Tc=h;break;case 22:d.memoizedState===null&&(h=d.alternate,h!==null&&h.memoizedState!==null?(h=Qp,Qp=16777216,Ch(d),Qp=h):Ch(d));break;default:Ch(d)}}function vT(d){var h=d.alternate;if(h!==null&&(d=h.child,d!==null)){h.child=null;do h=d.sibling,d.sibling=null,d=h;while(d!==null)}}function ng(d){var h=d.deletions;if((d.flags&16)!==0){if(h!==null)for(var y=0;y<h.length;y++){var b=h[y];Ks=b,WE(b,d)}vT(d)}if(d.subtreeFlags&10256)for(d=d.child;d!==null;)JR(d),d=d.sibling}function JR(d){switch(d.tag){case 0:case 11:case 15:ng(d),d.flags&2048&&Qd(9,d,d.return);break;case 3:ng(d);break;case 12:ng(d);break;case 22:var h=d.stateNode;d.memoizedState!==null&&h._visibility&2&&(d.return===null||d.return.tag!==13)?(h._visibility&=-3,GE(d)):ng(d);break;default:ng(d)}}function GE(d){var h=d.deletions;if((d.flags&16)!==0){if(h!==null)for(var y=0;y<h.length;y++){var b=h[y];Ks=b,WE(b,d)}vT(d)}for(d=d.child;d!==null;){switch(h=d,h.tag){case 0:case 11:case 15:Qd(8,h,h.return),GE(h);break;case 22:y=h.stateNode,y._visibility&2&&(y._visibility&=-3,GE(h));break;default:GE(h)}d=d.sibling}}function WE(d,h){for(;Ks!==null;){var y=Ks;switch(y.tag){case 0:case 11:case 15:Qd(8,y,h);break;case 23:case 22:if(y.memoizedState!==null&&y.memoizedState.cachePool!==null){var b=y.memoizedState.cachePool.pool;b!=null&&b.refCount++}break;case 24:Im(y.memoizedState.cache)}if(b=y.child,b!==null)b.return=y,Ks=b;else e:for(y=d;Ks!==null;){b=Ks;var N=b.sibling,P=b.return;if(Xp(b),b===y){Ks=null;break e}if(N!==null){N.return=P,Ks=N;break e}Ks=P}}}var ST={getCacheForType:function(d){var h=Ds(fs),y=h.data.get(d);return y===void 0&&(y=d(),h.data.set(d,y)),y}},ox=typeof WeakMap=="function"?WeakMap:Map,Vr=0,wi=null,cr=null,wr=0,Fr=0,ia=null,Zl=!1,$d=!1,rg=!1,cl=0,Vi=0,bc=0,Jd=0,TT=0,qo=0,Ah=0,$p=null,ks=null,ig=!1,sg=0,Jp=1/0,ag=null,ed=null,sa=0,Zd=null,wc=null,Zp=0,zE=0,og=null,ZR=null,cg=0,bT=null;function Io(){if((Vr&2)!==0&&wr!==0)return wr&-wr;if(ve.T!==null){var d=Pp;return d!==0?d:sf()}return yn()}function YE(){qo===0&&(qo=(wr&536870912)===0||Ur?Ca():536870912);var d=xs.current;return d!==null&&(d.flags|=32),qo}function eo(d,h,y){(d===wi&&(Fr===2||Fr===9)||d.cancelPendingCommit!==null)&&(Nh(d,0),ll(d,wr,qo,!1)),cn(d,y),((Vr&2)===0||d!==wi)&&(d===wi&&((Vr&2)===0&&(Jd|=y),Vi===4&&ll(d,wr,qo,!1)),Ko(d))}function wT(d,h,y){if((Vr&6)!==0)throw Error(a(327));var b=!y&&(h&124)===0&&(h&d.expiredLanes)===0||Ra(d,h),N=b?lx(d,h):CT(d,h,!0),P=b;do{if(N===0){$d&&!b&&ll(d,h,0,!1);break}else{if(y=d.current.alternate,P&&!qE(y)){N=CT(d,h,!1),P=!1;continue}if(N===2){if(P=h,d.errorRecoveryDisabledLanes&P)var Z=0;else Z=d.pendingLanes&-536870913,Z=Z!==0?Z:Z&536870912?536870912:0;if(Z!==0){h=Z;e:{var ue=d;N=$p;var we=ue.current.memoizedState.isDehydrated;if(we&&(Nh(ue,Z).flags|=256),Z=CT(ue,Z,!1),Z!==2){if(rg&&!we){ue.errorRecoveryDisabledLanes|=P,Jd|=P,N=4;break e}P=ks,ks=N,P!==null&&(ks===null?ks=P:ks.push.apply(ks,P))}N=Z}if(P=!1,N!==2)continue}}if(N===1){Nh(d,0),ll(d,h,0,!0);break}e:{switch(b=d,P=N,P){case 0:case 1:throw Error(a(345));case 4:if((h&4194048)!==h)break;case 6:ll(b,h,qo,!Zl);break e;case 2:ks=null;break;case 3:case 5:break;default:throw Error(a(329))}if((h&62914560)===h&&(N=sg+300-rt(),10<N)){if(ll(b,h,qo,!Zl),ns(b,0,!0)!==0)break e;b.timeoutHandle=cC(RT.bind(null,b,y,ks,ag,ig,h,qo,Jd,Ah,Zl,P,2,-0,0),N);break e}RT(b,y,ks,ag,ig,h,qo,Jd,Ah,Zl,P,0,-0,0)}}break}while(!0);Ko(d)}function RT(d,h,y,b,N,P,Z,ue,we,Be,it,mt,qe,Qe){if(d.timeoutHandle=-1,mt=h.subtreeFlags,(mt&8192||(mt&16785408)===16785408)&&(mg={stylesheets:null,count:0,unsuspend:xx},$R(h),mt=vC(),mt!==null)){d.cancelPendingCommit=mt(tC.bind(null,d,h,P,y,b,N,Z,ue,we,it,1,qe,Qe)),ll(d,P,Z,!Be);return}tC(d,h,P,y,b,N,Z,ue,we)}function qE(d){for(var h=d;;){var y=h.tag;if((y===0||y===11||y===15)&&h.flags&16384&&(y=h.updateQueue,y!==null&&(y=y.stores,y!==null)))for(var b=0;b<y.length;b++){var N=y[b],P=N.getSnapshot;N=N.value;try{if(!To(P(),N))return!1}catch{return!1}}if(y=h.child,h.subtreeFlags&16384&&y!==null)y.return=h,h=y;else{if(h===d)break;for(;h.sibling===null;){if(h.return===null||h.return===d)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function ll(d,h,y,b){h&=~TT,h&=~Jd,d.suspendedLanes|=h,d.pingedLanes&=~h,b&&(d.warmLanes|=h),b=d.expirationTimes;for(var N=h;0<N;){var P=31-rn(N),Z=1<<P;b[P]=-1,N&=~Z}y!==0&&Ke(d,y,h)}function Ih(){return(Vr&6)===0?(lg(0),!1):!0}function ef(){if(cr!==null){if(Fr===0)var d=cr.return;else d=cr,Xl=hh=null,WS(d),Sh=null,yc=0,d=cr;for(;d!==null;)HR(d.alternate,d),d=d.return;cr=null}}function Nh(d,h){var y=d.timeoutHandle;y!==-1&&(d.timeoutHandle=-1,Ex(y)),y=d.cancelPendingCommit,y!==null&&(d.cancelPendingCommit=null,y()),ef(),wi=d,cr=y=ql(d.current,null),wr=h,Fr=0,ia=null,Zl=!1,$d=Ra(d,h),rg=!1,Ah=qo=TT=Jd=bc=Vi=0,ks=$p=null,ig=!1,(h&8)!==0&&(h|=h&32);var b=d.entangledLanes;if(b!==0)for(d=d.entanglements,b&=h;0<b;){var N=31-rn(b),P=1<<N;h|=d[N],b&=~P}return cl=h,ah(),y}function Oh(d,h){$n=null,ve.H=Co,h===fh||h===mE?(h=nR(),Fr=3):h===Z0?(h=nR(),Fr=4):Fr=h===kR?8:h!==null&&typeof h=="object"&&typeof h.then=="function"?6:1,ia=h,cr===null&&(Vi=1,xE(d,bo(h,d.current)))}function eu(){var d=ve.H;return ve.H=Co,d===null?Co:d}function eC(){var d=ve.A;return ve.A=ST,d}function Dh(){Vi=4,Zl||(wr&4194048)!==wr&&xs.current!==null||($d=!0),(bc&134217727)===0&&(Jd&134217727)===0||wi===null||ll(wi,wr,qo,!1)}function CT(d,h,y){var b=Vr;Vr|=2;var N=eu(),P=eC();(wi!==d||wr!==h)&&(ag=null,Nh(d,h)),h=!1;var Z=Vi;e:do try{if(Fr!==0&&cr!==null){var ue=cr,we=ia;switch(Fr){case 8:ef(),Z=6;break e;case 3:case 2:case 9:case 6:xs.current===null&&(h=!0);var Be=Fr;if(Fr=0,ia=null,xh(d,ue,we,Be),y&&$d){Z=0;break e}break;default:Be=Fr,Fr=0,ia=null,xh(d,ue,we,Be)}}cx(),Z=Vi;break}catch(it){Oh(d,it)}while(!0);return h&&d.shellSuspendCounter++,Xl=hh=null,Vr=b,ve.H=N,ve.A=P,cr===null&&(wi=null,wr=0,ah()),Z}function cx(){for(;cr!==null;)AT(cr)}function lx(d,h){var y=Vr;Vr|=2;var b=eu(),N=eC();wi!==d||wr!==h?(ag=null,Jp=rt()+500,Nh(d,h)):$d=Ra(d,h);e:do try{if(Fr!==0&&cr!==null){h=cr;var P=ia;t:switch(Fr){case 1:Fr=0,ia=null,xh(d,h,P,1);break;case 2:case 9:if(eR(P)){Fr=0,ia=null,KE(h);break}h=function(){Fr!==2&&Fr!==9||wi!==d||(Fr=7),Ko(d)},P.then(h,h);break e;case 3:Fr=7;break e;case 4:Fr=5;break e;case 7:eR(P)?(Fr=0,ia=null,KE(h)):(Fr=0,ia=null,xh(d,h,P,7));break;case 5:var Z=null;switch(cr.tag){case 26:Z=cr.memoizedState;case 5:case 27:var ue=cr;if(!Z||yC(Z)){Fr=0,ia=null;var we=ue.sibling;if(we!==null)cr=we;else{var Be=ue.return;Be!==null?(cr=Be,XE(Be)):cr=null}break t}}Fr=0,ia=null,xh(d,h,P,5);break;case 6:Fr=0,ia=null,xh(d,h,P,6);break;case 8:ef(),Vi=6;break e;default:throw Error(a(462))}}dx();break}catch(it){Oh(d,it)}while(!0);return Xl=hh=null,ve.H=b,ve.A=N,Vr=y,cr!==null?0:(wi=null,wr=0,ah(),Vi)}function dx(){for(;cr!==null&&!Dt();)AT(cr)}function AT(d){var h=Xm(d.alternate,d,cl);d.memoizedProps=d.pendingProps,h===null?XE(d):cr=h}function KE(d){var h=d,y=h.alternate;switch(h.tag){case 15:case 0:h=uT(y,h,h.pendingProps,h.type,void 0,wr);break;case 11:h=uT(y,h,h.pendingProps,h.type.render,h.ref,wr);break;case 5:WS(h);default:HR(y,h),h=cr=oE(h,cl),h=Xm(y,h,cl)}d.memoizedProps=d.pendingProps,h===null?XE(d):cr=h}function xh(d,h,y,b){Xl=hh=null,WS(h),Sh=null,yc=0;var N=h.return;try{if(nx(d,N,h,y,wr)){Vi=1,xE(d,bo(y,d.current)),cr=null;return}}catch(P){if(N!==null)throw cr=N,P;Vi=1,xE(d,bo(y,d.current)),cr=null;return}h.flags&32768?(Ur||b===1?d=!0:$d||(wr&536870912)!==0?d=!1:(Zl=d=!0,(b===2||b===9||b===3||b===6)&&(b=xs.current,b!==null&&b.tag===13&&(b.flags|=16384))),IT(h,d)):XE(h)}function XE(d){var h=d;do{if((h.flags&32768)!==0){IT(h,Zl);return}d=h.return;var y=ix(h.alternate,h,cl);if(y!==null){cr=y;return}if(h=h.sibling,h!==null){cr=h;return}cr=h=d}while(h!==null);Vi===0&&(Vi=5)}function IT(d,h){do{var y=sx(d.alternate,d);if(y!==null){y.flags&=32767,cr=y;return}if(y=d.return,y!==null&&(y.flags|=32768,y.subtreeFlags=0,y.deletions=null),!h&&(d=d.sibling,d!==null)){cr=d;return}cr=d=y}while(d!==null);Vi=6,cr=null}function tC(d,h,y,b,N,P,Z,ue,we){d.cancelPendingCommit=null;do QE();while(sa!==0);if((Vr&6)!==0)throw Error(a(327));if(h!==null){if(h===d.current)throw Error(a(177));if(P=h.lanes|h.childLanes,P|=RS,Yn(d,y,P,Z,ue,we),d===wi&&(cr=wi=null,wr=0),wc=h,Zd=d,Zp=y,zE=P,og=N,ZR=b,(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?(d.callbackNode=null,d.callbackPriority=0,px(ki,function(){return $E(),null})):(d.callbackNode=null,d.callbackPriority=0),b=(h.flags&13878)!==0,(h.subtreeFlags&13878)!==0||b){b=ve.T,ve.T=null,N=Ne.p,Ne.p=2,Z=Vr,Vr|=4;try{Zm(d,h,y)}finally{Vr=Z,Ne.p=N,ve.T=b}}sa=1,tf(),Rc(),NT()}}function tf(){if(sa===1){sa=0;var d=Zd,h=wc,y=(h.flags&13878)!==0;if((h.subtreeFlags&13878)!==0||y){y=ve.T,ve.T=null;var b=Ne.p;Ne.p=2;var N=Vr;Vr|=4;try{XR(h,d);var P=df,Z=zl(d.containerInfo),ue=P.focusedElem,we=P.selectionRange;if(Z!==ue&&ue&&ue.ownerDocument&&F0(ue.ownerDocument.documentElement,ue)){if(we!==null&&ES(ue)){var Be=we.start,it=we.end;if(it===void 0&&(it=Be),"selectionStart"in ue)ue.selectionStart=Be,ue.selectionEnd=Math.min(it,ue.value.length);else{var mt=ue.ownerDocument||document,qe=mt&&mt.defaultView||window;if(qe.getSelection){var Qe=qe.getSelection(),kn=ue.textContent.length,vn=Math.min(we.start,kn),ai=we.end===void 0?vn:Math.min(we.end,kn);!Qe.extend&&vn>ai&&(Z=ai,ai=vn,vn=Z);var Me=V0(ue,vn),Oe=V0(ue,ai);if(Me&&Oe&&(Qe.rangeCount!==1||Qe.anchorNode!==Me.node||Qe.anchorOffset!==Me.offset||Qe.focusNode!==Oe.node||Qe.focusOffset!==Oe.offset)){var He=mt.createRange();He.setStart(Me.node,Me.offset),Qe.removeAllRanges(),vn>ai?(Qe.addRange(He),Qe.extend(Oe.node,Oe.offset)):(He.setEnd(Oe.node,Oe.offset),Qe.addRange(He))}}}}for(mt=[],Qe=ue;Qe=Qe.parentNode;)Qe.nodeType===1&&mt.push({element:Qe,left:Qe.scrollLeft,top:Qe.scrollTop});for(typeof ue.focus=="function"&&ue.focus(),ue=0;ue<mt.length;ue++){var ht=mt[ue];ht.element.scrollLeft=ht.left,ht.element.scrollTop=ht.top}}fy=!!zT,df=zT=null}finally{Vr=N,Ne.p=b,ve.T=y}}d.current=h,sa=2}}function Rc(){if(sa===2){sa=0;var d=Zd,h=wc,y=(h.flags&8772)!==0;if((h.subtreeFlags&8772)!==0||y){y=ve.T,ve.T=null;var b=Ne.p;Ne.p=2;var N=Vr;Vr|=4;try{ET(d,h.alternate,h)}finally{Vr=N,Ne.p=b,ve.T=y}}sa=3}}function NT(){if(sa===4||sa===3){sa=0,wt();var d=Zd,h=wc,y=Zp,b=ZR;(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?sa=5:(sa=0,wc=Zd=null,nC(d,d.pendingLanes));var N=d.pendingLanes;if(N===0&&(ed=null),tn(y),h=h.stateNode,Bt&&typeof Bt.onCommitFiberRoot=="function")try{Bt.onCommitFiberRoot(vt,h,void 0,(h.current.flags&128)===128)}catch{}if(b!==null){h=ve.T,N=Ne.p,Ne.p=2,ve.T=null;try{for(var P=d.onRecoverableError,Z=0;Z<b.length;Z++){var ue=b[Z];P(ue.value,{componentStack:ue.stack})}}finally{ve.T=h,Ne.p=N}}(Zp&3)!==0&&QE(),Ko(d),N=d.pendingLanes,(y&4194090)!==0&&(N&42)!==0?d===bT?cg++:(cg=0,bT=d):cg=0,lg(0)}}function nC(d,h){(d.pooledCacheLanes&=h)===0&&(h=d.pooledCache,h!=null&&(d.pooledCache=null,Im(h)))}function QE(d){return tf(),Rc(),NT(),$E()}function $E(){if(sa!==5)return!1;var d=Zd,h=zE;zE=0;var y=tn(Zp),b=ve.T,N=Ne.p;try{Ne.p=32>y?32:y,ve.T=null,y=og,og=null;var P=Zd,Z=Zp;if(sa=0,wc=Zd=null,Zp=0,(Vr&6)!==0)throw Error(a(331));var ue=Vr;if(Vr|=4,JR(P.current),QR(P,P.current,Z,y),Vr=ue,lg(0,!1),Bt&&typeof Bt.onPostCommitFiberRoot=="function")try{Bt.onPostCommitFiberRoot(vt,P)}catch{}return!0}finally{Ne.p=N,ve.T=b,nC(d,h)}}function OT(d,h,y){h=bo(y,h),h=vc(d.stateNode,h,2),d=$l(d,h,2),d!==null&&(cn(d,2),Ko(d))}function pi(d,h,y){if(d.tag===3)OT(d,d,y);else for(;h!==null;){if(h.tag===3){OT(h,d,y);break}else if(h.tag===1){var b=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(ed===null||!ed.has(b))){d=bo(y,d),y=xR(2),b=$l(h,y,2),b!==null&&(PR(y,b,h,d),cn(b,2),Ko(b));break}}h=h.return}}function nf(d,h,y){var b=d.pingCache;if(b===null){b=d.pingCache=new ox;var N=new Set;b.set(h,N)}else N=b.get(h),N===void 0&&(N=new Set,b.set(h,N));N.has(y)||(rg=!0,N.add(y),d=tu.bind(null,d,h,y),h.then(d,d))}function tu(d,h,y){var b=d.pingCache;b!==null&&b.delete(h),d.pingedLanes|=d.suspendedLanes&y,d.warmLanes&=~y,wi===d&&(wr&y)===y&&(Vi===4||Vi===3&&(wr&62914560)===wr&&300>rt()-sg?(Vr&2)===0&&Nh(d,0):TT|=y,Ah===wr&&(Ah=0)),Ko(d)}function rf(d,h){h===0&&(h=je()),d=Np(d,h),d!==null&&(cn(d,h),Ko(d))}function ux(d){var h=d.memoizedState,y=0;h!==null&&(y=h.retryLane),rf(d,y)}function hx(d,h){var y=0;switch(d.tag){case 13:var b=d.stateNode,N=d.memoizedState;N!==null&&(y=N.retryLane);break;case 19:b=d.stateNode;break;case 22:b=d.stateNode._retryCache;break;default:throw Error(a(314))}b!==null&&b.delete(h),rf(d,y)}function px(d,h){return yt(d,h)}var JE=null,nu=null,DT=!1,ZE=!1,xT=!1,ru=0;function Ko(d){d!==nu&&d.next===null&&(nu===null?JE=nu=d:nu=nu.next=d),ZE=!0,DT||(DT=!0,iC())}function lg(d,h){if(!xT&&ZE){xT=!0;do for(var y=!1,b=JE;b!==null;){if(d!==0){var N=b.pendingLanes;if(N===0)var P=0;else{var Z=b.suspendedLanes,ue=b.pingedLanes;P=(1<<31-rn(42|d)+1)-1,P&=N&~(Z&~ue),P=P&201326741?P&201326741|1:P?P|2:0}P!==0&&(y=!0,kT(b,P))}else P=wr,P=ns(b,b===wi?P:0,b.cancelPendingCommit!==null||b.timeoutHandle!==-1),(P&3)===0||Ra(b,P)||(y=!0,kT(b,P));b=b.next}while(y);xT=!1}}function fx(){rC()}function rC(){ZE=DT=!1;var d=0;ru!==0&&(_x()&&(d=ru),ru=0);for(var h=rt(),y=null,b=JE;b!==null;){var N=b.next,P=PT(b,h);P===0?(b.next=null,y===null?JE=N:y.next=N,N===null&&(nu=y)):(y=b,(d!==0||(P&3)!==0)&&(ZE=!0)),b=N}lg(d)}function PT(d,h){for(var y=d.suspendedLanes,b=d.pingedLanes,N=d.expirationTimes,P=d.pendingLanes&-62914561;0<P;){var Z=31-rn(P),ue=1<<Z,we=N[Z];we===-1?((ue&y)===0||(ue&b)!==0)&&(N[Z]=Cs(ue,h)):we<=h&&(d.expiredLanes|=ue),P&=~ue}if(h=wi,y=wr,y=ns(d,d===h?y:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),b=d.callbackNode,y===0||d===h&&(Fr===2||Fr===9)||d.cancelPendingCommit!==null)return b!==null&&b!==null&&an(b),d.callbackNode=null,d.callbackPriority=0;if((y&3)===0||Ra(d,y)){if(h=y&-y,h===d.callbackPriority)return h;switch(b!==null&&an(b),tn(y)){case 2:case 8:y=Bn;break;case 32:y=ki;break;case 268435456:y=Cr;break;default:y=ki}return b=ey.bind(null,d),y=yt(y,b),d.callbackPriority=h,d.callbackNode=y,h}return b!==null&&b!==null&&an(b),d.callbackPriority=2,d.callbackNode=null,2}function ey(d,h){if(sa!==0&&sa!==5)return d.callbackNode=null,d.callbackPriority=0,null;var y=d.callbackNode;if(QE()&&d.callbackNode!==y)return null;var b=wr;return b=ns(d,d===wi?b:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),b===0?null:(wT(d,b,h),PT(d,rt()),d.callbackNode!=null&&d.callbackNode===y?ey.bind(null,d):null)}function kT(d,h){if(QE())return null;wT(d,h,!0)}function iC(){yx(function(){(Vr&6)!==0?yt(Mt,fx):rC()})}function sf(){return ru===0&&(ru=Ca()),ru}function LT(d){return d==null||typeof d=="symbol"||typeof d=="boolean"?null:typeof d=="function"?d:bp(""+d)}function sC(d,h){var y=h.ownerDocument.createElement("input");return y.name=h.name,y.value=h.value,d.id&&y.setAttribute("form",d.id),h.parentNode.insertBefore(y,h),d=new FormData(d),y.parentNode.removeChild(y),d}function MT(d,h,y,b,N){if(h==="submit"&&y&&y.stateNode===N){var P=LT((N[pr]||null).action),Z=b.submitter;Z&&(h=(h=Z[pr]||null)?LT(h.formAction):Z.getAttribute("formAction"),h!==null&&(P=h,Z=null));var ue=new vo("action","action",null,b,N);d.push({event:ue,listeners:[{instance:null,listener:function(){if(b.defaultPrevented){if(ru!==0){var we=Z?sC(N,Z):new FormData(N);Hp(y,{pending:!0,data:we,method:N.method,action:P},null,we)}}else typeof P=="function"&&(ue.preventDefault(),we=Z?sC(N,Z):new FormData(N),Hp(y,{pending:!0,data:we,method:N.method,action:P},P,we))},currentTarget:N}]})}}for(var jT=0;jT<bS.length;jT++){var UT=bS[jT],dg=UT.toLowerCase(),VT=UT[0].toUpperCase()+UT.slice(1);gc(dg,"on"+VT)}gc(G0,"onAnimationEnd"),gc(W0,"onAnimationIteration"),gc(aE,"onAnimationStart"),gc("dblclick","onDoubleClick"),gc("focusin","onFocus"),gc("focusout","onBlur"),gc(TS,"onTransitionRun"),gc(YD,"onTransitionStart"),gc(Ze,"onTransitionCancel"),gc(z0,"onTransitionEnd"),Ml("onMouseEnter",["mouseout","mouseover"]),Ml("onMouseLeave",["mouseout","mouseover"]),Ml("onPointerEnter",["pointerout","pointerover"]),Ml("onPointerLeave",["pointerout","pointerover"]),fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fa("onBeforeInput",["compositionend","keypress","textInput","paste"]),fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var af="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),FT=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(af));function ty(d,h){h=(h&4)!==0;for(var y=0;y<d.length;y++){var b=d[y],N=b.event;b=b.listeners;e:{var P=void 0;if(h)for(var Z=b.length-1;0<=Z;Z--){var ue=b[Z],we=ue.instance,Be=ue.currentTarget;if(ue=ue.listener,we!==P&&N.isPropagationStopped())break e;P=ue,N.currentTarget=Be;try{P(N)}catch(it){DE(it)}N.currentTarget=null,P=we}else for(Z=0;Z<b.length;Z++){if(ue=b[Z],we=ue.instance,Be=ue.currentTarget,ue=ue.listener,we!==P&&N.isPropagationStopped())break e;P=ue,N.currentTarget=Be;try{P(N)}catch(it){DE(it)}N.currentTarget=null,P=we}}}}function rr(d,h){var y=h[rs];y===void 0&&(y=h[rs]=new Set);var b=d+"__bubble";y.has(b)||(HT(h,d,2,!1),y.add(b))}function BT(d,h,y){var b=0;h&&(b|=4),HT(y,d,b,h)}var ny="_reactListening"+Math.random().toString(36).slice(2);function ry(d){if(!d[ny]){d[ny]=!0,Yu.forEach(function(y){y!=="selectionchange"&&(FT.has(y)||BT(y,!1,d),BT(y,!0,d))});var h=d.nodeType===9?d:d.ownerDocument;h===null||h[ny]||(h[ny]=!0,BT("selectionchange",!1,h))}}function HT(d,h,y,b){switch(RC(h)){case 2:var N=Lx;break;case 8:N=Mx;break;default:N=my}y=N.bind(null,h,y,d),N=void 0,!Bo||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(N=!0),b?N!==void 0?d.addEventListener(h,y,{capture:!0,passive:N}):d.addEventListener(h,y,!0):N!==void 0?d.addEventListener(h,y,{passive:N}):d.addEventListener(h,y,!1)}function iy(d,h,y,b,N){var P=b;if((h&1)===0&&(h&2)===0&&b!==null)e:for(;;){if(b===null)return;var Z=b.tag;if(Z===3||Z===4){var ue=b.stateNode.containerInfo;if(ue===N)break;if(Z===4)for(Z=b.return;Z!==null;){var we=Z.tag;if((we===3||we===4)&&Z.stateNode.containerInfo===N)return;Z=Z.return}for(;ue!==null;){if(Z=Vo(ue),Z===null)return;if(we=Z.tag,we===5||we===6||we===26||we===27){b=P=Z;continue e}ue=ue.parentNode}}b=b.return}X_(function(){var Be=P,it=Fo(y),mt=[];e:{var qe=Y0.get(d);if(qe!==void 0){var Qe=vo,kn=d;switch(d){case"keypress":if(Kc(y)===0)break e;case"keydown":case"keyup":Qe=Cp;break;case"focusin":kn="focus",Qe=nh;break;case"focusout":kn="blur",Qe=nh;break;case"beforeblur":case"afterblur":Qe=nh;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Qe=Ho;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Qe=pS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Qe=tE;break;case G0:case W0:case aE:Qe=kd;break;case z0:Qe=vm;break;case"scroll":case"scrollend":Qe=gm;break;case"wheel":Qe=Pn;break;case"copy":case"cut":case"paste":Qe=Ld;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Qe=ym;break;case"toggle":case"beforetoggle":Qe=rE}var vn=(h&4)!==0,ai=!vn&&(d==="scroll"||d==="scrollend"),Me=vn?qe!==null?qe+"Capture":null:qe;vn=[];for(var Oe=Be,He;Oe!==null;){var ht=Oe;if(He=ht.stateNode,ht=ht.tag,ht!==5&&ht!==26&&ht!==27||He===null||Me===null||(ht=xd(Oe,Me),ht!=null&&vn.push(of(Oe,ht,He))),ai)break;Oe=Oe.return}0<vn.length&&(qe=new Qe(qe,kn,null,y,it),mt.push({event:qe,listeners:vn}))}}if((h&7)===0){e:{if(qe=d==="mouseover"||d==="pointerover",Qe=d==="mouseout"||d==="pointerout",qe&&y!==Ul&&(kn=y.relatedTarget||y.fromElement)&&(Vo(kn)||kn[qr]))break e;if((Qe||qe)&&(qe=it.window===it?it:(qe=it.ownerDocument)?qe.defaultView||qe.parentWindow:window,Qe?(kn=y.relatedTarget||y.toElement,Qe=Be,kn=kn?Vo(kn):null,kn!==null&&(ai=p(kn),vn=kn.tag,kn!==ai||vn!==5&&vn!==27&&vn!==6)&&(kn=null)):(Qe=null,kn=Be),Qe!==kn)){if(vn=Ho,ht="onMouseLeave",Me="onMouseEnter",Oe="mouse",(d==="pointerout"||d==="pointerover")&&(vn=ym,ht="onPointerLeave",Me="onPointerEnter",Oe="pointer"),ai=Qe==null?qe:_o(Qe),He=kn==null?qe:_o(kn),qe=new vn(ht,Oe+"leave",Qe,y,it),qe.target=ai,qe.relatedTarget=He,ht=null,Vo(it)===Be&&(vn=new vn(Me,Oe+"enter",kn,y,it),vn.target=He,vn.relatedTarget=ai,ht=vn),ai=ht,Qe&&kn)t:{for(vn=Qe,Me=kn,Oe=0,He=vn;He;He=cf(He))Oe++;for(He=0,ht=Me;ht;ht=cf(ht))He++;for(;0<Oe-He;)vn=cf(vn),Oe--;for(;0<He-Oe;)Me=cf(Me),He--;for(;Oe--;){if(vn===Me||Me!==null&&vn===Me.alternate)break t;vn=cf(vn),Me=cf(Me)}vn=null}else vn=null;Qe!==null&&GT(mt,qe,Qe,vn,!1),kn!==null&&ai!==null&&GT(mt,ai,kn,vn,!0)}}e:{if(qe=Be?_o(Be):window,Qe=qe.nodeName&&qe.nodeName.toLowerCase(),Qe==="select"||Qe==="input"&&qe.type==="file")var Gt=k0;else if(Ns(qe))if(So)Gt=_S;else{Gt=GD;var lr=HD}else Qe=qe.nodeName,!Qe||Qe.toLowerCase()!=="input"||qe.type!=="checkbox"&&qe.type!=="radio"?Be&&eh(Be.elementType)&&(Gt=k0):Gt=j0;if(Gt&&(Gt=Gt(d,Be))){Wl(mt,Gt,y,it);break e}lr&&lr(d,qe,Be),d==="focusout"&&Be&&qe.type==="number"&&Be.memoizedProps.value!=null&&Od(qe,"number",qe.value)}switch(lr=Be?_o(Be):window,d){case"focusin":(Ns(lr)||lr.contentEditable==="true")&&(Os=lr,yS=Be,Tm=null);break;case"focusout":Tm=yS=Os=null;break;case"mousedown":vS=!0;break;case"contextmenu":case"mouseup":case"dragend":vS=!1,B0(mt,y,it);break;case"selectionchange":if(zD)break;case"keydown":case"keyup":B0(mt,y,it)}var hn;if(Jc)e:{switch(d){case"compositionstart":var An="onCompositionStart";break e;case"compositionend":An="onCompositionEnd";break e;case"compositionupdate":An="onCompositionUpdate";break e}An=void 0}else Sr?Je(d,y)&&(An="onCompositionEnd"):d==="keydown"&&y.keyCode===229&&(An="onCompositionStart");An&&($&&y.locale!=="ko"&&(Sr||An!=="onCompositionStart"?An==="onCompositionEnd"&&Sr&&(hn=fm()):(Ka=it,Pd="value"in Ka?Ka.value:Ka.textContent,Sr=!0)),lr=ug(Be,An),0<lr.length&&(An=new rh(An,d,null,y,it),mt.push({event:An,listeners:lr}),hn?An.data=hn:(hn=Nt(y),hn!==null&&(An.data=hn)))),(hn=B?Is(d,y):qn(d,y))&&(An=ug(Be,"onBeforeInput"),0<An.length&&(lr=new rh("onBeforeInput","beforeinput",null,y,it),mt.push({event:lr,listeners:An}),lr.data=hn)),MT(mt,d,Be,y,it)}ty(mt,h)})}function of(d,h,y){return{instance:d,listener:h,currentTarget:y}}function ug(d,h){for(var y=h+"Capture",b=[];d!==null;){var N=d,P=N.stateNode;if(N=N.tag,N!==5&&N!==26&&N!==27||P===null||(N=xd(d,y),N!=null&&b.unshift(of(d,N,P)),N=xd(d,h),N!=null&&b.push(of(d,N,P))),d.tag===3)return b;d=d.return}return[]}function cf(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5&&d.tag!==27);return d||null}function GT(d,h,y,b,N){for(var P=h._reactName,Z=[];y!==null&&y!==b;){var ue=y,we=ue.alternate,Be=ue.stateNode;if(ue=ue.tag,we!==null&&we===b)break;ue!==5&&ue!==26&&ue!==27||Be===null||(we=Be,N?(Be=xd(y,P),Be!=null&&Z.unshift(of(y,Be,we))):N||(Be=xd(y,P),Be!=null&&Z.push(of(y,Be,we)))),y=y.return}Z.length!==0&&d.push({event:h,listeners:Z})}var mx=/\r\n?/g,lf=/\u0000|\uFFFD/g;function Ph(d){return(typeof d=="string"?d:""+d).replace(mx,`
`).replace(lf,"")}function sy(d,h){return h=Ph(h),Ph(d)===h}function hg(){}function Zr(d,h,y,b,N,P){switch(y){case"children":typeof b=="string"?h==="body"||h==="textarea"&&b===""||qa(d,b):(typeof b=="number"||typeof b=="bigint")&&h!=="body"&&qa(d,""+b);break;case"className":zc(d,"class",b);break;case"tabIndex":zc(d,"tabindex",b);break;case"dir":case"role":case"viewBox":case"width":case"height":zc(d,y,b);break;case"style":hm(d,b,P);break;case"data":if(h!=="object"){zc(d,"data",b);break}case"src":case"href":if(b===""&&(h!=="a"||y!=="href")){d.removeAttribute(y);break}if(b==null||typeof b=="function"||typeof b=="symbol"||typeof b=="boolean"){d.removeAttribute(y);break}b=bp(""+b),d.setAttribute(y,b);break;case"action":case"formAction":if(typeof b=="function"){d.setAttribute(y,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof P=="function"&&(y==="formAction"?(h!=="input"&&Zr(d,h,"name",N.name,N,null),Zr(d,h,"formEncType",N.formEncType,N,null),Zr(d,h,"formMethod",N.formMethod,N,null),Zr(d,h,"formTarget",N.formTarget,N,null)):(Zr(d,h,"encType",N.encType,N,null),Zr(d,h,"method",N.method,N,null),Zr(d,h,"target",N.target,N,null)));if(b==null||typeof b=="symbol"||typeof b=="boolean"){d.removeAttribute(y);break}b=bp(""+b),d.setAttribute(y,b);break;case"onClick":b!=null&&(d.onclick=hg);break;case"onScroll":b!=null&&rr("scroll",d);break;case"onScrollEnd":b!=null&&rr("scrollend",d);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error(a(61));if(y=b.__html,y!=null){if(N.children!=null)throw Error(a(60));d.innerHTML=y}}break;case"multiple":d.multiple=b&&typeof b!="function"&&typeof b!="symbol";break;case"muted":d.muted=b&&typeof b!="function"&&typeof b!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(b==null||typeof b=="function"||typeof b=="boolean"||typeof b=="symbol"){d.removeAttribute("xlink:href");break}y=bp(""+b),d.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",y);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":b!=null&&typeof b!="function"&&typeof b!="symbol"?d.setAttribute(y,""+b):d.removeAttribute(y);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":b&&typeof b!="function"&&typeof b!="symbol"?d.setAttribute(y,""):d.removeAttribute(y);break;case"capture":case"download":b===!0?d.setAttribute(y,""):b!==!1&&b!=null&&typeof b!="function"&&typeof b!="symbol"?d.setAttribute(y,b):d.removeAttribute(y);break;case"cols":case"rows":case"size":case"span":b!=null&&typeof b!="function"&&typeof b!="symbol"&&!isNaN(b)&&1<=b?d.setAttribute(y,b):d.removeAttribute(y);break;case"rowSpan":case"start":b==null||typeof b=="function"||typeof b=="symbol"||isNaN(b)?d.removeAttribute(y):d.setAttribute(y,b);break;case"popover":rr("beforetoggle",d),rr("toggle",d),hi(d,"popover",b);break;case"xlinkActuate":na(d,"http://www.w3.org/1999/xlink","xlink:actuate",b);break;case"xlinkArcrole":na(d,"http://www.w3.org/1999/xlink","xlink:arcrole",b);break;case"xlinkRole":na(d,"http://www.w3.org/1999/xlink","xlink:role",b);break;case"xlinkShow":na(d,"http://www.w3.org/1999/xlink","xlink:show",b);break;case"xlinkTitle":na(d,"http://www.w3.org/1999/xlink","xlink:title",b);break;case"xlinkType":na(d,"http://www.w3.org/1999/xlink","xlink:type",b);break;case"xmlBase":na(d,"http://www.w3.org/XML/1998/namespace","xml:base",b);break;case"xmlLang":na(d,"http://www.w3.org/XML/1998/namespace","xml:lang",b);break;case"xmlSpace":na(d,"http://www.w3.org/XML/1998/namespace","xml:space",b);break;case"is":hi(d,"is",b);break;case"innerText":case"textContent":break;default:(!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(y=hS.get(y)||y,hi(d,y,b))}}function WT(d,h,y,b,N,P){switch(y){case"style":hm(d,b,P);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error(a(61));if(y=b.__html,y!=null){if(N.children!=null)throw Error(a(60));d.innerHTML=y}}break;case"children":typeof b=="string"?qa(d,b):(typeof b=="number"||typeof b=="bigint")&&qa(d,""+b);break;case"onScroll":b!=null&&rr("scroll",d);break;case"onScrollEnd":b!=null&&rr("scrollend",d);break;case"onClick":b!=null&&(d.onclick=hg);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!qu.hasOwnProperty(y))e:{if(y[0]==="o"&&y[1]==="n"&&(N=y.endsWith("Capture"),h=y.slice(2,N?y.length-7:void 0),P=d[pr]||null,P=P!=null?P[y]:null,typeof P=="function"&&d.removeEventListener(h,P,N),typeof b=="function")){typeof P!="function"&&P!==null&&(y in d?d[y]=null:d.hasAttribute(y)&&d.removeAttribute(y)),d.addEventListener(h,b,N);break e}y in d?d[y]=b:b===!0?d.setAttribute(y,""):hi(d,y,b)}}}function Xs(d,h,y){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":rr("error",d),rr("load",d);var b=!1,N=!1,P;for(P in y)if(y.hasOwnProperty(P)){var Z=y[P];if(Z!=null)switch(P){case"src":b=!0;break;case"srcSet":N=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,h));default:Zr(d,h,P,Z,y,null)}}N&&Zr(d,h,"srcSet",y.srcSet,y,null),b&&Zr(d,h,"src",y.src,y,null);return;case"input":rr("invalid",d);var ue=P=Z=N=null,we=null,Be=null;for(b in y)if(y.hasOwnProperty(b)){var it=y[b];if(it!=null)switch(b){case"name":N=it;break;case"type":Z=it;break;case"checked":we=it;break;case"defaultChecked":Be=it;break;case"value":P=it;break;case"defaultValue":ue=it;break;case"children":case"dangerouslySetInnerHTML":if(it!=null)throw Error(a(137,h));break;default:Zr(d,h,b,it,y,null)}}Ju(d,P,ue,we,Be,Z,N,!1),Sp(d);return;case"select":rr("invalid",d),b=Z=P=null;for(N in y)if(y.hasOwnProperty(N)&&(ue=y[N],ue!=null))switch(N){case"value":P=ue;break;case"defaultValue":Z=ue;break;case"multiple":b=ue;default:Zr(d,h,N,ue,y,null)}h=P,y=Z,d.multiple=!!b,h!=null?jl(d,!!b,h,!1):y!=null&&jl(d,!!b,y,!0);return;case"textarea":rr("invalid",d),P=N=b=null;for(Z in y)if(y.hasOwnProperty(Z)&&(ue=y[Z],ue!=null))switch(Z){case"value":b=ue;break;case"defaultValue":N=ue;break;case"children":P=ue;break;case"dangerouslySetInnerHTML":if(ue!=null)throw Error(a(91));break;default:Zr(d,h,Z,ue,y,null)}Zu(d,b,N,P),Sp(d);return;case"option":for(we in y)if(y.hasOwnProperty(we)&&(b=y[we],b!=null))switch(we){case"selected":d.selected=b&&typeof b!="function"&&typeof b!="symbol";break;default:Zr(d,h,we,b,y,null)}return;case"dialog":rr("beforetoggle",d),rr("toggle",d),rr("cancel",d),rr("close",d);break;case"iframe":case"object":rr("load",d);break;case"video":case"audio":for(b=0;b<af.length;b++)rr(af[b],d);break;case"image":rr("error",d),rr("load",d);break;case"details":rr("toggle",d);break;case"embed":case"source":case"link":rr("error",d),rr("load",d);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Be in y)if(y.hasOwnProperty(Be)&&(b=y[Be],b!=null))switch(Be){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,h));default:Zr(d,h,Be,b,y,null)}return;default:if(eh(h)){for(it in y)y.hasOwnProperty(it)&&(b=y[it],b!==void 0&&WT(d,h,it,b,y,void 0));return}}for(ue in y)y.hasOwnProperty(ue)&&(b=y[ue],b!=null&&Zr(d,h,ue,b,y,null))}function gx(d,h,y,b){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var N=null,P=null,Z=null,ue=null,we=null,Be=null,it=null;for(Qe in y){var mt=y[Qe];if(y.hasOwnProperty(Qe)&&mt!=null)switch(Qe){case"checked":break;case"value":break;case"defaultValue":we=mt;default:b.hasOwnProperty(Qe)||Zr(d,h,Qe,null,b,mt)}}for(var qe in b){var Qe=b[qe];if(mt=y[qe],b.hasOwnProperty(qe)&&(Qe!=null||mt!=null))switch(qe){case"type":P=Qe;break;case"name":N=Qe;break;case"checked":Be=Qe;break;case"defaultChecked":it=Qe;break;case"value":Z=Qe;break;case"defaultValue":ue=Qe;break;case"children":case"dangerouslySetInnerHTML":if(Qe!=null)throw Error(a(137,h));break;default:Qe!==mt&&Zr(d,h,qe,Qe,b,mt)}}yo(d,Z,ue,we,Be,it,P,N);return;case"select":Qe=Z=ue=qe=null;for(P in y)if(we=y[P],y.hasOwnProperty(P)&&we!=null)switch(P){case"value":break;case"multiple":Qe=we;default:b.hasOwnProperty(P)||Zr(d,h,P,null,b,we)}for(N in b)if(P=b[N],we=y[N],b.hasOwnProperty(N)&&(P!=null||we!=null))switch(N){case"value":qe=P;break;case"defaultValue":ue=P;break;case"multiple":Z=P;default:P!==we&&Zr(d,h,N,P,b,we)}h=ue,y=Z,b=Qe,qe!=null?jl(d,!!y,qe,!1):!!b!=!!y&&(h!=null?jl(d,!!y,h,!0):jl(d,!!y,y?[]:"",!1));return;case"textarea":Qe=qe=null;for(ue in y)if(N=y[ue],y.hasOwnProperty(ue)&&N!=null&&!b.hasOwnProperty(ue))switch(ue){case"value":break;case"children":break;default:Zr(d,h,ue,null,b,N)}for(Z in b)if(N=b[Z],P=y[Z],b.hasOwnProperty(Z)&&(N!=null||P!=null))switch(Z){case"value":qe=N;break;case"defaultValue":Qe=N;break;case"children":break;case"dangerouslySetInnerHTML":if(N!=null)throw Error(a(91));break;default:N!==P&&Zr(d,h,Z,N,b,P)}ii(d,qe,Qe);return;case"option":for(var kn in y)if(qe=y[kn],y.hasOwnProperty(kn)&&qe!=null&&!b.hasOwnProperty(kn))switch(kn){case"selected":d.selected=!1;break;default:Zr(d,h,kn,null,b,qe)}for(we in b)if(qe=b[we],Qe=y[we],b.hasOwnProperty(we)&&qe!==Qe&&(qe!=null||Qe!=null))switch(we){case"selected":d.selected=qe&&typeof qe!="function"&&typeof qe!="symbol";break;default:Zr(d,h,we,qe,b,Qe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var vn in y)qe=y[vn],y.hasOwnProperty(vn)&&qe!=null&&!b.hasOwnProperty(vn)&&Zr(d,h,vn,null,b,qe);for(Be in b)if(qe=b[Be],Qe=y[Be],b.hasOwnProperty(Be)&&qe!==Qe&&(qe!=null||Qe!=null))switch(Be){case"children":case"dangerouslySetInnerHTML":if(qe!=null)throw Error(a(137,h));break;default:Zr(d,h,Be,qe,b,Qe)}return;default:if(eh(h)){for(var ai in y)qe=y[ai],y.hasOwnProperty(ai)&&qe!==void 0&&!b.hasOwnProperty(ai)&&WT(d,h,ai,void 0,b,qe);for(it in b)qe=b[it],Qe=y[it],!b.hasOwnProperty(it)||qe===Qe||qe===void 0&&Qe===void 0||WT(d,h,it,qe,b,Qe);return}}for(var Me in y)qe=y[Me],y.hasOwnProperty(Me)&&qe!=null&&!b.hasOwnProperty(Me)&&Zr(d,h,Me,null,b,qe);for(mt in b)qe=b[mt],Qe=y[mt],!b.hasOwnProperty(mt)||qe===Qe||qe==null&&Qe==null||Zr(d,h,mt,qe,b,Qe)}var zT=null,df=null;function ay(d){return d.nodeType===9?d:d.ownerDocument}function aC(d){switch(d){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function oC(d,h){if(d===0)switch(h){case"svg":return 1;case"math":return 2;default:return 0}return d===1&&h==="foreignObject"?0:d}function YT(d,h){return d==="textarea"||d==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.children=="bigint"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var qT=null;function _x(){var d=window.event;return d&&d.type==="popstate"?d===qT?!1:(qT=d,!0):(qT=null,!1)}var cC=typeof setTimeout=="function"?setTimeout:void 0,Ex=typeof clearTimeout=="function"?clearTimeout:void 0,lC=typeof Promise=="function"?Promise:void 0,yx=typeof queueMicrotask=="function"?queueMicrotask:typeof lC<"u"?function(d){return lC.resolve(null).then(d).catch(vx)}:cC;function vx(d){setTimeout(function(){throw d})}function iu(d){return d==="head"}function dC(d,h){var y=h,b=0,N=0;do{var P=y.nextSibling;if(d.removeChild(y),P&&P.nodeType===8)if(y=P.data,y==="/$"){if(0<b&&8>b){y=b;var Z=d.ownerDocument;if(y&1&&pg(Z.documentElement),y&2&&pg(Z.body),y&4)for(y=Z.head,pg(y),Z=y.firstChild;Z;){var ue=Z.nextSibling,we=Z.nodeName;Z[Ya]||we==="SCRIPT"||we==="STYLE"||we==="LINK"&&Z.rel.toLowerCase()==="stylesheet"||y.removeChild(Z),Z=ue}}if(N===0){d.removeChild(P),bg(h);return}N--}else y==="$"||y==="$?"||y==="$!"?N++:b=y.charCodeAt(0)-48;else b=0;y=P}while(y);bg(h)}function KT(d){var h=d.firstChild;for(h&&h.nodeType===10&&(h=h.nextSibling);h;){var y=h;switch(h=h.nextSibling,y.nodeName){case"HTML":case"HEAD":case"BODY":KT(y),Aa(y);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(y.rel.toLowerCase()==="stylesheet")continue}d.removeChild(y)}}function Sx(d,h,y,b){for(;d.nodeType===1;){var N=y;if(d.nodeName.toLowerCase()!==h.toLowerCase()){if(!b&&(d.nodeName!=="INPUT"||d.type!=="hidden"))break}else if(b){if(!d[Ya])switch(h){case"meta":if(!d.hasAttribute("itemprop"))break;return d;case"link":if(P=d.getAttribute("rel"),P==="stylesheet"&&d.hasAttribute("data-precedence"))break;if(P!==N.rel||d.getAttribute("href")!==(N.href==null||N.href===""?null:N.href)||d.getAttribute("crossorigin")!==(N.crossOrigin==null?null:N.crossOrigin)||d.getAttribute("title")!==(N.title==null?null:N.title))break;return d;case"style":if(d.hasAttribute("data-precedence"))break;return d;case"script":if(P=d.getAttribute("src"),(P!==(N.src==null?null:N.src)||d.getAttribute("type")!==(N.type==null?null:N.type)||d.getAttribute("crossorigin")!==(N.crossOrigin==null?null:N.crossOrigin))&&P&&d.hasAttribute("async")&&!d.hasAttribute("itemprop"))break;return d;default:return d}}else if(h==="input"&&d.type==="hidden"){var P=N.name==null?null:""+N.name;if(N.type==="hidden"&&d.getAttribute("name")===P)return d}else return d;if(d=Cc(d.nextSibling),d===null)break}return null}function Tx(d,h,y){if(h==="")return null;for(;d.nodeType!==3;)if((d.nodeType!==1||d.nodeName!=="INPUT"||d.type!=="hidden")&&!y||(d=Cc(d.nextSibling),d===null))return null;return d}function oy(d){return d.data==="$!"||d.data==="$?"&&d.ownerDocument.readyState==="complete"}function bx(d,h){var y=d.ownerDocument;if(d.data!=="$?"||y.readyState==="complete")h();else{var b=function(){h(),y.removeEventListener("DOMContentLoaded",b)};y.addEventListener("DOMContentLoaded",b),d._reactRetry=b}}function Cc(d){for(;d!=null;d=d.nextSibling){var h=d.nodeType;if(h===1||h===3)break;if(h===8){if(h=d.data,h==="$"||h==="$!"||h==="$?"||h==="F!"||h==="F")break;if(h==="/$")return null}}return d}var XT=null;function uC(d){d=d.previousSibling;for(var h=0;d;){if(d.nodeType===8){var y=d.data;if(y==="$"||y==="$!"||y==="$?"){if(h===0)return d;h--}else y==="/$"&&h++}d=d.previousSibling}return null}function hC(d,h,y){switch(h=ay(y),d){case"html":if(d=h.documentElement,!d)throw Error(a(452));return d;case"head":if(d=h.head,!d)throw Error(a(453));return d;case"body":if(d=h.body,!d)throw Error(a(454));return d;default:throw Error(a(451))}}function pg(d){for(var h=d.attributes;h.length;)d.removeAttributeNode(h[0]);Aa(d)}var Xo=new Map,pC=new Set;function cy(d){return typeof d.getRootNode=="function"?d.getRootNode():d.nodeType===9?d:d.ownerDocument}var td=Ne.d;Ne.d={f:wx,r:Rx,D:Cx,C:Ax,L:Ix,m:mC,X:Ox,S:Nx,M:Dx};function wx(){var d=td.f(),h=Ih();return d||h}function Rx(d){var h=go(d);h!==null&&h.tag===5&&h.type==="form"?tT(h):td.r(d)}var uf=typeof document>"u"?null:document;function fC(d,h,y){var b=uf;if(b&&typeof h=="string"&&h){var N=is(h);N='link[rel="'+d+'"][href="'+N+'"]',typeof y=="string"&&(N+='[crossorigin="'+y+'"]'),pC.has(N)||(pC.add(N),d={rel:d,crossOrigin:y,href:h},b.querySelector(N)===null&&(h=b.createElement("link"),Xs(h,"link",d),Ui(h),b.head.appendChild(h)))}}function Cx(d){td.D(d),fC("dns-prefetch",d,null)}function Ax(d,h){td.C(d,h),fC("preconnect",d,h)}function Ix(d,h,y){td.L(d,h,y);var b=uf;if(b&&d&&h){var N='link[rel="preload"][as="'+is(h)+'"]';h==="image"&&y&&y.imageSrcSet?(N+='[imagesrcset="'+is(y.imageSrcSet)+'"]',typeof y.imageSizes=="string"&&(N+='[imagesizes="'+is(y.imageSizes)+'"]')):N+='[href="'+is(d)+'"]';var P=N;switch(h){case"style":P=hf(d);break;case"script":P=ff(d)}Xo.has(P)||(d=O({rel:"preload",href:h==="image"&&y&&y.imageSrcSet?void 0:d,as:h},y),Xo.set(P,d),b.querySelector(N)!==null||h==="style"&&b.querySelector(pf(P))||h==="script"&&b.querySelector(fg(P))||(h=b.createElement("link"),Xs(h,"link",d),Ui(h),b.head.appendChild(h)))}}function mC(d,h){td.m(d,h);var y=uf;if(y&&d){var b=h&&typeof h.as=="string"?h.as:"script",N='link[rel="modulepreload"][as="'+is(b)+'"][href="'+is(d)+'"]',P=N;switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":P=ff(d)}if(!Xo.has(P)&&(d=O({rel:"modulepreload",href:d},h),Xo.set(P,d),y.querySelector(N)===null)){switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(y.querySelector(fg(P)))return}b=y.createElement("link"),Xs(b,"link",d),Ui(b),y.head.appendChild(b)}}}function Nx(d,h,y){td.S(d,h,y);var b=uf;if(b&&d){var N=As(b).hoistableStyles,P=hf(d);h=h||"default";var Z=N.get(P);if(!Z){var ue={loading:0,preload:null};if(Z=b.querySelector(pf(P)))ue.loading=5;else{d=O({rel:"stylesheet",href:d,"data-precedence":h},y),(y=Xo.get(P))&&QT(d,y);var we=Z=b.createElement("link");Ui(we),Xs(we,"link",d),we._p=new Promise(function(Be,it){we.onload=Be,we.onerror=it}),we.addEventListener("load",function(){ue.loading|=1}),we.addEventListener("error",function(){ue.loading|=2}),ue.loading|=4,uy(Z,h,b)}Z={type:"stylesheet",instance:Z,count:1,state:ue},N.set(P,Z)}}}function Ox(d,h){td.X(d,h);var y=uf;if(y&&d){var b=As(y).hoistableScripts,N=ff(d),P=b.get(N);P||(P=y.querySelector(fg(N)),P||(d=O({src:d,async:!0},h),(h=Xo.get(N))&&$T(d,h),P=y.createElement("script"),Ui(P),Xs(P,"link",d),y.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},b.set(N,P))}}function Dx(d,h){td.M(d,h);var y=uf;if(y&&d){var b=As(y).hoistableScripts,N=ff(d),P=b.get(N);P||(P=y.querySelector(fg(N)),P||(d=O({src:d,async:!0,type:"module"},h),(h=Xo.get(N))&&$T(d,h),P=y.createElement("script"),Ui(P),Xs(P,"link",d),y.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},b.set(N,P))}}function gC(d,h,y,b){var N=(N=It.current)?cy(N):null;if(!N)throw Error(a(446));switch(d){case"meta":case"title":return null;case"style":return typeof y.precedence=="string"&&typeof y.href=="string"?(h=hf(y.href),y=As(N).hoistableStyles,b=y.get(h),b||(b={type:"style",instance:null,count:0,state:null},y.set(h,b)),b):{type:"void",instance:null,count:0,state:null};case"link":if(y.rel==="stylesheet"&&typeof y.href=="string"&&typeof y.precedence=="string"){d=hf(y.href);var P=As(N).hoistableStyles,Z=P.get(d);if(Z||(N=N.ownerDocument||N,Z={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},P.set(d,Z),(P=N.querySelector(pf(d)))&&!P._p&&(Z.instance=P,Z.state.loading=5),Xo.has(d)||(y={rel:"preload",as:"style",href:y.href,crossOrigin:y.crossOrigin,integrity:y.integrity,media:y.media,hrefLang:y.hrefLang,referrerPolicy:y.referrerPolicy},Xo.set(d,y),P||_C(N,d,y,Z.state))),h&&b===null)throw Error(a(528,""));return Z}if(h&&b!==null)throw Error(a(529,""));return null;case"script":return h=y.async,y=y.src,typeof y=="string"&&h&&typeof h!="function"&&typeof h!="symbol"?(h=ff(y),y=As(N).hoistableScripts,b=y.get(h),b||(b={type:"script",instance:null,count:0,state:null},y.set(h,b)),b):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,d))}}function hf(d){return'href="'+is(d)+'"'}function pf(d){return'link[rel="stylesheet"]['+d+"]"}function ly(d){return O({},d,{"data-precedence":d.precedence,precedence:null})}function _C(d,h,y,b){d.querySelector('link[rel="preload"][as="style"]['+h+"]")?b.loading=1:(h=d.createElement("link"),b.preload=h,h.addEventListener("load",function(){return b.loading|=1}),h.addEventListener("error",function(){return b.loading|=2}),Xs(h,"link",y),Ui(h),d.head.appendChild(h))}function ff(d){return'[src="'+is(d)+'"]'}function fg(d){return"script[async]"+d}function dy(d,h,y){if(h.count++,h.instance===null)switch(h.type){case"style":var b=d.querySelector('style[data-href~="'+is(y.href)+'"]');if(b)return h.instance=b,Ui(b),b;var N=O({},y,{"data-href":y.href,"data-precedence":y.precedence,href:null,precedence:null});return b=(d.ownerDocument||d).createElement("style"),Ui(b),Xs(b,"style",N),uy(b,y.precedence,d),h.instance=b;case"stylesheet":N=hf(y.href);var P=d.querySelector(pf(N));if(P)return h.state.loading|=4,h.instance=P,Ui(P),P;b=ly(y),(N=Xo.get(N))&&QT(b,N),P=(d.ownerDocument||d).createElement("link"),Ui(P);var Z=P;return Z._p=new Promise(function(ue,we){Z.onload=ue,Z.onerror=we}),Xs(P,"link",b),h.state.loading|=4,uy(P,y.precedence,d),h.instance=P;case"script":return P=ff(y.src),(N=d.querySelector(fg(P)))?(h.instance=N,Ui(N),N):(b=y,(N=Xo.get(P))&&(b=O({},y),$T(b,N)),d=d.ownerDocument||d,N=d.createElement("script"),Ui(N),Xs(N,"link",b),d.head.appendChild(N),h.instance=N);case"void":return null;default:throw Error(a(443,h.type))}else h.type==="stylesheet"&&(h.state.loading&4)===0&&(b=h.instance,h.state.loading|=4,uy(b,y.precedence,d));return h.instance}function uy(d,h,y){for(var b=y.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),N=b.length?b[b.length-1]:null,P=N,Z=0;Z<b.length;Z++){var ue=b[Z];if(ue.dataset.precedence===h)P=ue;else if(P!==N)break}P?P.parentNode.insertBefore(d,P.nextSibling):(h=y.nodeType===9?y.head:y,h.insertBefore(d,h.firstChild))}function QT(d,h){d.crossOrigin==null&&(d.crossOrigin=h.crossOrigin),d.referrerPolicy==null&&(d.referrerPolicy=h.referrerPolicy),d.title==null&&(d.title=h.title)}function $T(d,h){d.crossOrigin==null&&(d.crossOrigin=h.crossOrigin),d.referrerPolicy==null&&(d.referrerPolicy=h.referrerPolicy),d.integrity==null&&(d.integrity=h.integrity)}var hy=null;function JT(d,h,y){if(hy===null){var b=new Map,N=hy=new Map;N.set(y,b)}else N=hy,b=N.get(y),b||(b=new Map,N.set(y,b));if(b.has(d))return b;for(b.set(d,null),y=y.getElementsByTagName(d),N=0;N<y.length;N++){var P=y[N];if(!(P[Ya]||P[or]||d==="link"&&P.getAttribute("rel")==="stylesheet")&&P.namespaceURI!=="http://www.w3.org/2000/svg"){var Z=P.getAttribute(h)||"";Z=d+Z;var ue=b.get(Z);ue?ue.push(P):b.set(Z,[P])}}return b}function EC(d,h,y){d=d.ownerDocument||d,d.head.insertBefore(y,h==="title"?d.querySelector("head > title"):null)}function ZT(d,h,y){if(y===1||h.itemProp!=null)return!1;switch(d){case"meta":case"title":return!0;case"style":if(typeof h.precedence!="string"||typeof h.href!="string"||h.href==="")break;return!0;case"link":if(typeof h.rel!="string"||typeof h.href!="string"||h.href===""||h.onLoad||h.onError)break;switch(h.rel){case"stylesheet":return d=h.disabled,typeof h.precedence=="string"&&d==null;default:return!0}case"script":if(h.async&&typeof h.async!="function"&&typeof h.async!="symbol"&&!h.onLoad&&!h.onError&&h.src&&typeof h.src=="string")return!0}return!1}function yC(d){return!(d.type==="stylesheet"&&(d.state.loading&3)===0)}var mg=null;function xx(){}function Px(d,h,y){if(mg===null)throw Error(a(475));var b=mg;if(h.type==="stylesheet"&&(typeof y.media!="string"||matchMedia(y.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var N=hf(y.href),P=d.querySelector(pf(N));if(P){d=P._p,d!==null&&typeof d=="object"&&typeof d.then=="function"&&(b.count++,b=py.bind(b),d.then(b,b)),h.state.loading|=4,h.instance=P,Ui(P);return}P=d.ownerDocument||d,y=ly(y),(N=Xo.get(N))&&QT(y,N),P=P.createElement("link"),Ui(P);var Z=P;Z._p=new Promise(function(ue,we){Z.onload=ue,Z.onerror=we}),Xs(P,"link",y),h.instance=P}b.stylesheets===null&&(b.stylesheets=new Map),b.stylesheets.set(h,d),(d=h.state.preload)&&(h.state.loading&3)===0&&(b.count++,h=py.bind(b),d.addEventListener("load",h),d.addEventListener("error",h))}}function vC(){if(mg===null)throw Error(a(475));var d=mg;return d.stylesheets&&d.count===0&&_g(d,d.stylesheets),0<d.count?function(h){var y=setTimeout(function(){if(d.stylesheets&&_g(d,d.stylesheets),d.unsuspend){var b=d.unsuspend;d.unsuspend=null,b()}},6e4);return d.unsuspend=h,function(){d.unsuspend=null,clearTimeout(y)}}:null}function py(){if(this.count--,this.count===0){if(this.stylesheets)_g(this,this.stylesheets);else if(this.unsuspend){var d=this.unsuspend;this.unsuspend=null,d()}}}var gg=null;function _g(d,h){d.stylesheets=null,d.unsuspend!==null&&(d.count++,gg=new Map,h.forEach(kx,d),gg=null,py.call(d))}function kx(d,h){if(!(h.state.loading&4)){var y=gg.get(d);if(y)var b=y.get(null);else{y=new Map,gg.set(d,y);for(var N=d.querySelectorAll("link[data-precedence],style[data-precedence]"),P=0;P<N.length;P++){var Z=N[P];(Z.nodeName==="LINK"||Z.getAttribute("media")!=="not all")&&(y.set(Z.dataset.precedence,Z),b=Z)}b&&y.set(null,b)}N=h.instance,Z=N.getAttribute("data-precedence"),P=y.get(Z)||b,P===b&&y.set(null,N),y.set(Z,N),this.count++,b=py.bind(this),N.addEventListener("load",b),N.addEventListener("error",b),P?P.parentNode.insertBefore(N,P.nextSibling):(d=d.nodeType===9?d.head:d,d.insertBefore(N,d.firstChild)),h.state.loading|=4}}var Eg={$$typeof:ce,Provider:null,Consumer:null,_currentValue:Ce,_currentValue2:Ce,_threadCount:0};function SC(d,h,y,b,N,P,Z,ue){this.tag=1,this.containerInfo=d,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=sn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sn(0),this.hiddenUpdates=sn(null),this.identifierPrefix=b,this.onUncaughtError=N,this.onCaughtError=P,this.onRecoverableError=Z,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ue,this.incompleteTransitions=new Map}function TC(d,h,y,b,N,P,Z,ue,we,Be,it,mt){return d=new SC(d,h,y,Z,ue,we,Be,mt),h=1,P===!0&&(h|=24),P=wo(3,null,null,h),d.current=P,P.stateNode=d,h=Am(),h.refCount++,d.pooledCache=h,h.refCount++,P.memoizedState={element:b,isDehydrated:y,cache:h},_E(P),d}function eb(d){return d?(d=Yl,d):Yl}function tb(d,h,y,b,N,P){N=eb(N),b.context===null?b.context=N:b.pendingContext=N,b=Gd(h),b.payload={element:y},P=P===void 0?null:P,P!==null&&(b.callback=P),y=$l(d,b,h),y!==null&&(eo(y,d,h),Dm(y,d,h))}function bC(d,h){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var y=d.retryLane;d.retryLane=y!==0&&y<h?y:h}}function nb(d,h){bC(d,h),(d=d.alternate)&&bC(d,h)}function wC(d){if(d.tag===13){var h=Np(d,67108864);h!==null&&eo(h,d,67108864),nb(d,67108864)}}var fy=!0;function Lx(d,h,y,b){var N=ve.T;ve.T=null;var P=Ne.p;try{Ne.p=2,my(d,h,y,b)}finally{Ne.p=P,ve.T=N}}function Mx(d,h,y,b){var N=ve.T;ve.T=null;var P=Ne.p;try{Ne.p=8,my(d,h,y,b)}finally{Ne.p=P,ve.T=N}}function my(d,h,y,b){if(fy){var N=yg(b);if(N===null)iy(d,h,b,vg,y),ib(d,b);else if(CC(N,d,h,y,b))b.stopPropagation();else if(ib(d,b),h&4&&-1<Pa.indexOf(d)){for(;N!==null;){var P=go(N);if(P!==null)switch(P.tag){case 3:if(P=P.stateNode,P.current.memoizedState.isDehydrated){var Z=ts(P.pendingLanes);if(Z!==0){var ue=P;for(ue.pendingLanes|=2,ue.entangledLanes|=2;Z;){var we=1<<31-rn(Z);ue.entanglements[1]|=we,Z&=~we}Ko(P),(Vr&6)===0&&(Jp=rt()+500,lg(0))}}break;case 13:ue=Np(P,2),ue!==null&&eo(ue,P,2),Ih(),nb(P,2)}if(P=yg(b),P===null&&iy(d,h,b,vg,y),P===N)break;N=P}N!==null&&b.stopPropagation()}else iy(d,h,b,null,y)}}function yg(d){return d=Fo(d),tt(d)}var vg=null;function tt(d){if(vg=null,d=Vo(d),d!==null){var h=p(d);if(h===null)d=null;else{var y=h.tag;if(y===13){if(d=_(h),d!==null)return d;d=null}else if(y===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;d=null}else h!==d&&(d=null)}}return vg=d,null}function RC(d){switch(d){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(xt()){case Mt:return 2;case Bn:return 8;case ki:case zi:return 32;case Cr:return 268435456;default:return 32}default:return 32}}var rb=!1,su=null,au=null,ou=null,kh=new Map,Sg=new Map,cu=[],Pa="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ib(d,h){switch(d){case"focusin":case"focusout":su=null;break;case"dragenter":case"dragleave":au=null;break;case"mouseover":case"mouseout":ou=null;break;case"pointerover":case"pointerout":kh.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":Sg.delete(h.pointerId)}}function Tg(d,h,y,b,N,P){return d===null||d.nativeEvent!==P?(d={blockedOn:h,domEventName:y,eventSystemFlags:b,nativeEvent:P,targetContainers:[N]},h!==null&&(h=go(h),h!==null&&wC(h)),d):(d.eventSystemFlags|=b,h=d.targetContainers,N!==null&&h.indexOf(N)===-1&&h.push(N),d)}function CC(d,h,y,b,N){switch(h){case"focusin":return su=Tg(su,d,h,y,b,N),!0;case"dragenter":return au=Tg(au,d,h,y,b,N),!0;case"mouseover":return ou=Tg(ou,d,h,y,b,N),!0;case"pointerover":var P=N.pointerId;return kh.set(P,Tg(kh.get(P)||null,d,h,y,b,N)),!0;case"gotpointercapture":return P=N.pointerId,Sg.set(P,Tg(Sg.get(P)||null,d,h,y,b,N)),!0}return!1}function AC(d){var h=Vo(d.target);if(h!==null){var y=p(h);if(y!==null){if(h=y.tag,h===13){if(h=_(y),h!==null){d.blockedOn=h,ri(d.priority,function(){if(y.tag===13){var b=Io();b=un(b);var N=Np(y,b);N!==null&&eo(N,y,b),nb(y,b)}});return}}else if(h===3&&y.stateNode.current.memoizedState.isDehydrated){d.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}d.blockedOn=null}function mf(d){if(d.blockedOn!==null)return!1;for(var h=d.targetContainers;0<h.length;){var y=yg(d.nativeEvent);if(y===null){y=d.nativeEvent;var b=new y.constructor(y.type,y);Ul=b,y.target.dispatchEvent(b),Ul=null}else return h=go(y),h!==null&&wC(h),d.blockedOn=y,!1;h.shift()}return!0}function sb(d,h,y){mf(d)&&y.delete(h)}function IC(){rb=!1,su!==null&&mf(su)&&(su=null),au!==null&&mf(au)&&(au=null),ou!==null&&mf(ou)&&(ou=null),kh.forEach(sb),Sg.forEach(sb)}function gy(d,h){d.blockedOn===h&&(d.blockedOn=null,rb||(rb=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,IC)))}var _y=null;function ab(d){_y!==d&&(_y=d,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){_y===d&&(_y=null);for(var h=0;h<d.length;h+=3){var y=d[h],b=d[h+1],N=d[h+2];if(typeof b!="function"){if(tt(b||y)===null)continue;break}var P=go(y);P!==null&&(d.splice(h,3),h-=3,Hp(P,{pending:!0,data:N,method:y.method,action:b},b,N))}}))}function bg(d){function h(we){return gy(we,d)}su!==null&&gy(su,d),au!==null&&gy(au,d),ou!==null&&gy(ou,d),kh.forEach(h),Sg.forEach(h);for(var y=0;y<cu.length;y++){var b=cu[y];b.blockedOn===d&&(b.blockedOn=null)}for(;0<cu.length&&(y=cu[0],y.blockedOn===null);)AC(y),y.blockedOn===null&&cu.shift();if(y=(d.ownerDocument||d).$$reactFormReplay,y!=null)for(b=0;b<y.length;b+=3){var N=y[b],P=y[b+1],Z=N[pr]||null;if(typeof P=="function")Z||ab(y);else if(Z){var ue=null;if(P&&P.hasAttribute("formAction")){if(N=P,Z=P[pr]||null)ue=Z.formAction;else if(tt(N)!==null)continue}else ue=Z.action;typeof ue=="function"?y[b+1]=ue:(y.splice(b,3),b-=3),ab(y)}}}function ob(d){this._internalRoot=d}wg.prototype.render=ob.prototype.render=function(d){var h=this._internalRoot;if(h===null)throw Error(a(409));var y=h.current,b=Io();tb(y,b,d,h,null,null)},wg.prototype.unmount=ob.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var h=d.containerInfo;tb(d.current,2,null,d,null,null),Ih(),h[qr]=null}};function wg(d){this._internalRoot=d}wg.prototype.unstable_scheduleHydration=function(d){if(d){var h=yn();d={blockedOn:null,target:d,priority:h};for(var y=0;y<cu.length&&h!==0&&h<cu[y].priority;y++);cu.splice(y,0,d),y===0&&AC(d)}};var NC=n.version;if(NC!=="19.1.0")throw Error(a(527,NC,"19.1.0"));Ne.findDOMNode=function(d){var h=d._reactInternals;if(h===void 0)throw typeof d.render=="function"?Error(a(188)):(d=Object.keys(d).join(","),Error(a(268,d)));return d=w(h),d=d!==null?C(d):null,d=d===null?null:d.stateNode,d};var jx={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:ve,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Rg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Rg.isDisabled&&Rg.supportsFiber)try{vt=Rg.inject(jx),Bt=Rg}catch{}}return Sw.createRoot=function(d,h){if(!l(d))throw Error(a(299));var y=!1,b="",N=NR,P=OR,Z=DR,ue=null;return h!=null&&(h.unstable_strictMode===!0&&(y=!0),h.identifierPrefix!==void 0&&(b=h.identifierPrefix),h.onUncaughtError!==void 0&&(N=h.onUncaughtError),h.onCaughtError!==void 0&&(P=h.onCaughtError),h.onRecoverableError!==void 0&&(Z=h.onRecoverableError),h.unstable_transitionCallbacks!==void 0&&(ue=h.unstable_transitionCallbacks)),h=TC(d,1,!1,null,null,y,b,N,P,Z,ue,null),d[qr]=h.current,ry(d),new ob(h)},Sw.hydrateRoot=function(d,h,y){if(!l(d))throw Error(a(299));var b=!1,N="",P=NR,Z=OR,ue=DR,we=null,Be=null;return y!=null&&(y.unstable_strictMode===!0&&(b=!0),y.identifierPrefix!==void 0&&(N=y.identifierPrefix),y.onUncaughtError!==void 0&&(P=y.onUncaughtError),y.onCaughtError!==void 0&&(Z=y.onCaughtError),y.onRecoverableError!==void 0&&(ue=y.onRecoverableError),y.unstable_transitionCallbacks!==void 0&&(we=y.unstable_transitionCallbacks),y.formState!==void 0&&(Be=y.formState)),h=TC(d,1,!0,h,y??null,b,N,P,Z,ue,we,Be),h.context=eb(null),y=h.current,b=Io(),b=un(b),N=Gd(b),N.callback=null,$l(y,N,b),y=b,h.current.lanes=y,cn(h,y),Ko(h),d[qr]=h.current,ry(d),new wg(h)},Sw.version="19.1.0",Sw}var DW;function _ae(){if(DW)return yL.exports;DW=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(n){console.error(n)}}return s(),yL.exports=gae(),yL.exports}var Eae=_ae();/**
 * react-router v7.7.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var xW="popstate";function yae(s={}){function n(a,l){let{pathname:p,search:_,hash:T}=a.location;return xM("",{pathname:p,search:_,hash:T},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function i(a,l){return typeof l=="string"?l:e0(l)}return Sae(n,i,null,s)}function Zi(s,n){if(s===!1||s===null||typeof s>"u")throw new Error(n)}function wd(s,n){if(!s){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function vae(){return Math.random().toString(36).substring(2,10)}function PW(s,n){return{usr:s.state,key:s.key,idx:n}}function xM(s,n,i=null,a){return{pathname:typeof s=="string"?s:s.pathname,search:"",hash:"",...typeof n=="string"?eS(n):n,state:i,key:n&&n.key||a||vae()}}function e0({pathname:s="/",search:n="",hash:i=""}){return n&&n!=="?"&&(s+=n.charAt(0)==="?"?n:"?"+n),i&&i!=="#"&&(s+=i.charAt(0)==="#"?i:"#"+i),s}function eS(s){let n={};if(s){let i=s.indexOf("#");i>=0&&(n.hash=s.substring(i),s=s.substring(0,i));let a=s.indexOf("?");a>=0&&(n.search=s.substring(a),s=s.substring(0,a)),s&&(n.pathname=s)}return n}function Sae(s,n,i,a={}){let{window:l=document.defaultView,v5Compat:p=!1}=a,_=l.history,T="POP",w=null,C=O();C==null&&(C=0,_.replaceState({..._.state,idx:C},""));function O(){return(_.state||{idx:null}).idx}function k(){T="POP";let X=O(),ie=X==null?null:X-C;C=X,w&&w({action:T,location:J.location,delta:ie})}function U(X,ie){T="PUSH";let oe=xM(J.location,X,ie);C=O()+1;let ce=PW(oe,C),_e=J.createHref(oe);try{_.pushState(ce,"",_e)}catch(se){if(se instanceof DOMException&&se.name==="DataCloneError")throw se;l.location.assign(_e)}p&&w&&w({action:T,location:J.location,delta:1})}function G(X,ie){T="REPLACE";let oe=xM(J.location,X,ie);C=O();let ce=PW(oe,C),_e=J.createHref(oe);_.replaceState(ce,"",_e),p&&w&&w({action:T,location:J.location,delta:0})}function z(X){return Tae(X)}let J={get action(){return T},get location(){return s(l,_)},listen(X){if(w)throw new Error("A history only accepts one active listener");return l.addEventListener(xW,k),w=X,()=>{l.removeEventListener(xW,k),w=null}},createHref(X){return n(l,X)},createURL:z,encodeLocation(X){let ie=z(X);return{pathname:ie.pathname,search:ie.search,hash:ie.hash}},push:U,replace:G,go(X){return _.go(X)}};return J}function Tae(s,n=!1){let i="http://localhost";typeof window<"u"&&(i=window.location.origin!=="null"?window.location.origin:window.location.href),Zi(i,"No window.location.(origin|href) available to create URL");let a=typeof s=="string"?s:e0(s);return a=a.replace(/ $/,"%20"),!n&&a.startsWith("//")&&(a=i+a),new URL(a,i)}function jY(s,n,i="/"){return bae(s,n,i,!1)}function bae(s,n,i,a){let l=typeof n=="string"?eS(n):n,p=lp(l.pathname||"/",i);if(p==null)return null;let _=UY(s);wae(_);let T=null;for(let w=0;T==null&&w<_.length;++w){let C=Lae(p);T=Pae(_[w],C,a)}return T}function UY(s,n=[],i=[],a=""){let l=(p,_,T)=>{let w={relativePath:T===void 0?p.path||"":T,caseSensitive:p.caseSensitive===!0,childrenIndex:_,route:p};w.relativePath.startsWith("/")&&(Zi(w.relativePath.startsWith(a),`Absolute route path "${w.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),w.relativePath=w.relativePath.slice(a.length));let C=Zh([a,w.relativePath]),O=i.concat(w);p.children&&p.children.length>0&&(Zi(p.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${C}".`),UY(p.children,n,O,C)),!(p.path==null&&!p.index)&&n.push({path:C,score:Dae(C,p.index),routesMeta:O})};return s.forEach((p,_)=>{var T;if(p.path===""||!((T=p.path)!=null&&T.includes("?")))l(p,_);else for(let w of VY(p.path))l(p,_,w)}),n}function VY(s){let n=s.split("/");if(n.length===0)return[];let[i,...a]=n,l=i.endsWith("?"),p=i.replace(/\?$/,"");if(a.length===0)return l?[p,""]:[p];let _=VY(a.join("/")),T=[];return T.push(..._.map(w=>w===""?p:[p,w].join("/"))),l&&T.push(..._),T.map(w=>s.startsWith("/")&&w===""?"/":w)}function wae(s){s.sort((n,i)=>n.score!==i.score?i.score-n.score:xae(n.routesMeta.map(a=>a.childrenIndex),i.routesMeta.map(a=>a.childrenIndex)))}var Rae=/^:[\w-]+$/,Cae=3,Aae=2,Iae=1,Nae=10,Oae=-2,kW=s=>s==="*";function Dae(s,n){let i=s.split("/"),a=i.length;return i.some(kW)&&(a+=Oae),n&&(a+=Aae),i.filter(l=>!kW(l)).reduce((l,p)=>l+(Rae.test(p)?Cae:p===""?Iae:Nae),a)}function xae(s,n){return s.length===n.length&&s.slice(0,-1).every((a,l)=>a===n[l])?s[s.length-1]-n[n.length-1]:0}function Pae(s,n,i=!1){let{routesMeta:a}=s,l={},p="/",_=[];for(let T=0;T<a.length;++T){let w=a[T],C=T===a.length-1,O=p==="/"?n:n.slice(p.length)||"/",k=dO({path:w.relativePath,caseSensitive:w.caseSensitive,end:C},O),U=w.route;if(!k&&C&&i&&!a[a.length-1].route.index&&(k=dO({path:w.relativePath,caseSensitive:w.caseSensitive,end:!1},O)),!k)return null;Object.assign(l,k.params),_.push({params:l,pathname:Zh([p,k.pathname]),pathnameBase:Vae(Zh([p,k.pathnameBase])),route:U}),k.pathnameBase!=="/"&&(p=Zh([p,k.pathnameBase]))}return _}function dO(s,n){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[i,a]=kae(s.path,s.caseSensitive,s.end),l=n.match(i);if(!l)return null;let p=l[0],_=p.replace(/(.)\/+$/,"$1"),T=l.slice(1);return{params:a.reduce((C,{paramName:O,isOptional:k},U)=>{if(O==="*"){let z=T[U]||"";_=p.slice(0,p.length-z.length).replace(/(.)\/+$/,"$1")}const G=T[U];return k&&!G?C[O]=void 0:C[O]=(G||"").replace(/%2F/g,"/"),C},{}),pathname:p,pathnameBase:_,pattern:s}}function kae(s,n=!1,i=!0){wd(s==="*"||!s.endsWith("*")||s.endsWith("/*"),`Route path "${s}" will be treated as if it were "${s.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${s.replace(/\*$/,"/*")}".`);let a=[],l="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,T,w)=>(a.push({paramName:T,isOptional:w!=null}),w?"/?([^\\/]+)?":"/([^\\/]+)"));return s.endsWith("*")?(a.push({paramName:"*"}),l+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?l+="\\/*$":s!==""&&s!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,n?void 0:"i"),a]}function Lae(s){try{return s.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return wd(!1,`The URL path "${s}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${n}).`),s}}function lp(s,n){if(n==="/")return s;if(!s.toLowerCase().startsWith(n.toLowerCase()))return null;let i=n.endsWith("/")?n.length-1:n.length,a=s.charAt(i);return a&&a!=="/"?null:s.slice(i)||"/"}function Mae(s,n="/"){let{pathname:i,search:a="",hash:l=""}=typeof s=="string"?eS(s):s;return{pathname:i?i.startsWith("/")?i:jae(i,n):n,search:Fae(a),hash:Bae(l)}}function jae(s,n){let i=n.replace(/\/+$/,"").split("/");return s.split("/").forEach(l=>{l===".."?i.length>1&&i.pop():l!=="."&&i.push(l)}),i.length>1?i.join("/"):"/"}function bL(s,n,i,a){return`Cannot include a '${s}' character in a manually specified \`to.${n}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${i}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Uae(s){return s.filter((n,i)=>i===0||n.route.path&&n.route.path.length>0)}function k2(s){let n=Uae(s);return n.map((i,a)=>a===n.length-1?i.pathname:i.pathnameBase)}function L2(s,n,i,a=!1){let l;typeof s=="string"?l=eS(s):(l={...s},Zi(!l.pathname||!l.pathname.includes("?"),bL("?","pathname","search",l)),Zi(!l.pathname||!l.pathname.includes("#"),bL("#","pathname","hash",l)),Zi(!l.search||!l.search.includes("#"),bL("#","search","hash",l)));let p=s===""||l.pathname==="",_=p?"/":l.pathname,T;if(_==null)T=i;else{let k=n.length-1;if(!a&&_.startsWith("..")){let U=_.split("/");for(;U[0]==="..";)U.shift(),k-=1;l.pathname=U.join("/")}T=k>=0?n[k]:"/"}let w=Mae(l,T),C=_&&_!=="/"&&_.endsWith("/"),O=(p||_===".")&&i.endsWith("/");return!w.pathname.endsWith("/")&&(C||O)&&(w.pathname+="/"),w}var Zh=s=>s.join("/").replace(/\/\/+/g,"/"),Vae=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),Fae=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,Bae=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function Hae(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}var FY=["POST","PUT","PATCH","DELETE"];new Set(FY);var Gae=["GET",...FY];new Set(Gae);var tS=F.createContext(null);tS.displayName="DataRouter";var $O=F.createContext(null);$O.displayName="DataRouterState";F.createContext(!1);var BY=F.createContext({isTransitioning:!1});BY.displayName="ViewTransition";var Wae=F.createContext(new Map);Wae.displayName="Fetchers";var zae=F.createContext(null);zae.displayName="Await";var Ad=F.createContext(null);Ad.displayName="Navigation";var E0=F.createContext(null);E0.displayName="Location";var Id=F.createContext({outlet:null,matches:[],isDataRoute:!1});Id.displayName="Route";var M2=F.createContext(null);M2.displayName="RouteError";function Yae(s,{relative:n}={}){Zi(nS(),"useHref() may be used only in the context of a <Router> component.");let{basename:i,navigator:a}=F.useContext(Ad),{hash:l,pathname:p,search:_}=y0(s,{relative:n}),T=p;return i!=="/"&&(T=p==="/"?i:Zh([i,p])),a.createHref({pathname:T,search:_,hash:l})}function nS(){return F.useContext(E0)!=null}function Wi(){return Zi(nS(),"useLocation() may be used only in the context of a <Router> component."),F.useContext(E0).location}var HY="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function GY(s){F.useContext(Ad).static||F.useLayoutEffect(s)}function es(){let{isDataRoute:s}=F.useContext(Id);return s?aoe():qae()}function qae(){Zi(nS(),"useNavigate() may be used only in the context of a <Router> component.");let s=F.useContext(tS),{basename:n,navigator:i}=F.useContext(Ad),{matches:a}=F.useContext(Id),{pathname:l}=Wi(),p=JSON.stringify(k2(a)),_=F.useRef(!1);return GY(()=>{_.current=!0}),F.useCallback((w,C={})=>{if(wd(_.current,HY),!_.current)return;if(typeof w=="number"){i.go(w);return}let O=L2(w,JSON.parse(p),l,C.relative==="path");s==null&&n!=="/"&&(O.pathname=O.pathname==="/"?n:Zh([n,O.pathname])),(C.replace?i.replace:i.push)(O,C.state,C)},[n,i,p,l,s])}F.createContext(null);function Kae(){let{matches:s}=F.useContext(Id),n=s[s.length-1];return n?n.params:{}}function y0(s,{relative:n}={}){let{matches:i}=F.useContext(Id),{pathname:a}=Wi(),l=JSON.stringify(k2(i));return F.useMemo(()=>L2(s,JSON.parse(l),a,n==="path"),[s,l,a,n])}function Xae(s,n){return WY(s,n)}function WY(s,n,i,a){var ie;Zi(nS(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=F.useContext(Ad),{matches:p}=F.useContext(Id),_=p[p.length-1],T=_?_.params:{},w=_?_.pathname:"/",C=_?_.pathnameBase:"/",O=_&&_.route;{let oe=O&&O.path||"";zY(w,!O||oe.endsWith("*")||oe.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${w}" (under <Route path="${oe}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${oe}"> to <Route path="${oe==="/"?"*":`${oe}/*`}">.`)}let k=Wi(),U;if(n){let oe=typeof n=="string"?eS(n):n;Zi(C==="/"||((ie=oe.pathname)==null?void 0:ie.startsWith(C)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${C}" but pathname "${oe.pathname}" was given in the \`location\` prop.`),U=oe}else U=k;let G=U.pathname||"/",z=G;if(C!=="/"){let oe=C.replace(/^\//,"").split("/");z="/"+G.replace(/^\//,"").split("/").slice(oe.length).join("/")}let J=jY(s,{pathname:z});wd(O||J!=null,`No routes matched location "${U.pathname}${U.search}${U.hash}" `),wd(J==null||J[J.length-1].route.element!==void 0||J[J.length-1].route.Component!==void 0||J[J.length-1].route.lazy!==void 0,`Matched leaf route at location "${U.pathname}${U.search}${U.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let X=eoe(J&&J.map(oe=>Object.assign({},oe,{params:Object.assign({},T,oe.params),pathname:Zh([C,l.encodeLocation?l.encodeLocation(oe.pathname).pathname:oe.pathname]),pathnameBase:oe.pathnameBase==="/"?C:Zh([C,l.encodeLocation?l.encodeLocation(oe.pathnameBase).pathname:oe.pathnameBase])})),p,i,a);return n&&X?F.createElement(E0.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...U},navigationType:"POP"}},X):X}function Qae(){let s=soe(),n=Hae(s)?`${s.status} ${s.statusText}`:s instanceof Error?s.message:JSON.stringify(s),i=s instanceof Error?s.stack:null,a="rgba(200,200,200, 0.5)",l={padding:"0.5rem",backgroundColor:a},p={padding:"2px 4px",backgroundColor:a},_=null;return console.error("Error handled by React Router default ErrorBoundary:",s),_=F.createElement(F.Fragment,null,F.createElement("p",null," Hey developer "),F.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",F.createElement("code",{style:p},"ErrorBoundary")," or"," ",F.createElement("code",{style:p},"errorElement")," prop on your route.")),F.createElement(F.Fragment,null,F.createElement("h2",null,"Unexpected Application Error!"),F.createElement("h3",{style:{fontStyle:"italic"}},n),i?F.createElement("pre",{style:l},i):null,_)}var $ae=F.createElement(Qae,null),Jae=class extends F.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,n){return n.location!==s.location||n.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:n.error,location:n.location,revalidation:s.revalidation||n.revalidation}}componentDidCatch(s,n){console.error("React Router caught the following error during render",s,n)}render(){return this.state.error!==void 0?F.createElement(Id.Provider,{value:this.props.routeContext},F.createElement(M2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Zae({routeContext:s,match:n,children:i}){let a=F.useContext(tS);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),F.createElement(Id.Provider,{value:s},i)}function eoe(s,n=[],i=null,a=null){if(s==null){if(!i)return null;if(i.errors)s=i.matches;else if(n.length===0&&!i.initialized&&i.matches.length>0)s=i.matches;else return null}let l=s,p=i==null?void 0:i.errors;if(p!=null){let w=l.findIndex(C=>C.route.id&&(p==null?void 0:p[C.route.id])!==void 0);Zi(w>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(p).join(",")}`),l=l.slice(0,Math.min(l.length,w+1))}let _=!1,T=-1;if(i)for(let w=0;w<l.length;w++){let C=l[w];if((C.route.HydrateFallback||C.route.hydrateFallbackElement)&&(T=w),C.route.id){let{loaderData:O,errors:k}=i,U=C.route.loader&&!O.hasOwnProperty(C.route.id)&&(!k||k[C.route.id]===void 0);if(C.route.lazy||U){_=!0,T>=0?l=l.slice(0,T+1):l=[l[0]];break}}}return l.reduceRight((w,C,O)=>{let k,U=!1,G=null,z=null;i&&(k=p&&C.route.id?p[C.route.id]:void 0,G=C.route.errorElement||$ae,_&&(T<0&&O===0?(zY("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),U=!0,z=null):T===O&&(U=!0,z=C.route.hydrateFallbackElement||null)));let J=n.concat(l.slice(0,O+1)),X=()=>{let ie;return k?ie=G:U?ie=z:C.route.Component?ie=F.createElement(C.route.Component,null):C.route.element?ie=C.route.element:ie=w,F.createElement(Zae,{match:C,routeContext:{outlet:w,matches:J,isDataRoute:i!=null},children:ie})};return i&&(C.route.ErrorBoundary||C.route.errorElement||O===0)?F.createElement(Jae,{location:i.location,revalidation:i.revalidation,component:G,error:k,children:X(),routeContext:{outlet:null,matches:J,isDataRoute:!0}}):X()},null)}function j2(s){return`${s} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function toe(s){let n=F.useContext(tS);return Zi(n,j2(s)),n}function noe(s){let n=F.useContext($O);return Zi(n,j2(s)),n}function roe(s){let n=F.useContext(Id);return Zi(n,j2(s)),n}function U2(s){let n=roe(s),i=n.matches[n.matches.length-1];return Zi(i.route.id,`${s} can only be used on routes that contain a unique "id"`),i.route.id}function ioe(){return U2("useRouteId")}function soe(){var a;let s=F.useContext(M2),n=noe("useRouteError"),i=U2("useRouteError");return s!==void 0?s:(a=n.errors)==null?void 0:a[i]}function aoe(){let{router:s}=toe("useNavigate"),n=U2("useNavigate"),i=F.useRef(!1);return GY(()=>{i.current=!0}),F.useCallback(async(l,p={})=>{wd(i.current,HY),i.current&&(typeof l=="number"?s.navigate(l):await s.navigate(l,{fromRouteId:n,...p}))},[s,n])}var LW={};function zY(s,n,i){!n&&!LW[s]&&(LW[s]=!0,wd(!1,i))}F.memo(ooe);function ooe({routes:s,future:n,state:i}){return WY(s,void 0,i,n)}function coe({to:s,replace:n,state:i,relative:a}){Zi(nS(),"<Navigate> may be used only in the context of a <Router> component.");let{static:l}=F.useContext(Ad);wd(!l,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:p}=F.useContext(Id),{pathname:_}=Wi(),T=es(),w=L2(s,k2(p),_,a==="path"),C=JSON.stringify(w);return F.useEffect(()=>{T(JSON.parse(C),{replace:n,state:i,relative:a})},[T,C,a,n,i]),null}function Ei(s){Zi(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function loe({basename:s="/",children:n=null,location:i,navigationType:a="POP",navigator:l,static:p=!1}){Zi(!nS(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let _=s.replace(/^\/*/,"/"),T=F.useMemo(()=>({basename:_,navigator:l,static:p,future:{}}),[_,l,p]);typeof i=="string"&&(i=eS(i));let{pathname:w="/",search:C="",hash:O="",state:k=null,key:U="default"}=i,G=F.useMemo(()=>{let z=lp(w,_);return z==null?null:{location:{pathname:z,search:C,hash:O,state:k,key:U},navigationType:a}},[_,w,C,O,k,U,a]);return wd(G!=null,`<Router basename="${_}"> is not able to match the URL "${w}${C}${O}" because it does not start with the basename, so the <Router> won't render anything.`),G==null?null:F.createElement(Ad.Provider,{value:T},F.createElement(E0.Provider,{children:n,value:G}))}function doe({children:s,location:n}){return Xae(PM(s),n)}function PM(s,n=[]){let i=[];return F.Children.forEach(s,(a,l)=>{if(!F.isValidElement(a))return;let p=[...n,l];if(a.type===F.Fragment){i.push.apply(i,PM(a.props.children,p));return}Zi(a.type===Ei,`[${typeof a.type=="string"?a.type:a.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Zi(!a.props.index||!a.props.children,"An index route cannot have child routes.");let _={id:a.props.id||p.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,hydrateFallbackElement:a.props.hydrateFallbackElement,HydrateFallback:a.props.HydrateFallback,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.hasErrorBoundary===!0||a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(_.children=PM(a.props.children,p)),i.push(_)}),i}var gN="get",_N="application/x-www-form-urlencoded";function JO(s){return s!=null&&typeof s.tagName=="string"}function uoe(s){return JO(s)&&s.tagName.toLowerCase()==="button"}function hoe(s){return JO(s)&&s.tagName.toLowerCase()==="form"}function poe(s){return JO(s)&&s.tagName.toLowerCase()==="input"}function foe(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}function moe(s,n){return s.button===0&&(!n||n==="_self")&&!foe(s)}var XI=null;function goe(){if(XI===null)try{new FormData(document.createElement("form"),0),XI=!1}catch{XI=!0}return XI}var _oe=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function wL(s){return s!=null&&!_oe.has(s)?(wd(!1,`"${s}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${_N}"`),null):s}function Eoe(s,n){let i,a,l,p,_;if(hoe(s)){let T=s.getAttribute("action");a=T?lp(T,n):null,i=s.getAttribute("method")||gN,l=wL(s.getAttribute("enctype"))||_N,p=new FormData(s)}else if(uoe(s)||poe(s)&&(s.type==="submit"||s.type==="image")){let T=s.form;if(T==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let w=s.getAttribute("formaction")||T.getAttribute("action");if(a=w?lp(w,n):null,i=s.getAttribute("formmethod")||T.getAttribute("method")||gN,l=wL(s.getAttribute("formenctype"))||wL(T.getAttribute("enctype"))||_N,p=new FormData(T,s),!goe()){let{name:C,type:O,value:k}=s;if(O==="image"){let U=C?`${C}.`:"";p.append(`${U}x`,"0"),p.append(`${U}y`,"0")}else C&&p.append(C,k)}}else{if(JO(s))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');i=gN,a=null,l=_N,_=s}return p&&l==="text/plain"&&(_=p,p=void 0),{action:a,method:i.toLowerCase(),encType:l,formData:p,body:_}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function V2(s,n){if(s===!1||s===null||typeof s>"u")throw new Error(n)}function yoe(s,n,i){let a=typeof s=="string"?new URL(s,typeof window>"u"?"server://singlefetch/":window.location.origin):s;return a.pathname==="/"?a.pathname=`_root.${i}`:n&&lp(a.pathname,n)==="/"?a.pathname=`${n.replace(/\/$/,"")}/_root.${i}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${i}`,a}async function voe(s,n){if(s.id in n)return n[s.id];try{let i=await import(s.module);return n[s.id]=i,i}catch(i){return console.error(`Error loading route module \`${s.module}\`, reloading page...`),console.error(i),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Soe(s){return s==null?!1:s.href==null?s.rel==="preload"&&typeof s.imageSrcSet=="string"&&typeof s.imageSizes=="string":typeof s.rel=="string"&&typeof s.href=="string"}async function Toe(s,n,i){let a=await Promise.all(s.map(async l=>{let p=n.routes[l.route.id];if(p){let _=await voe(p,i);return _.links?_.links():[]}return[]}));return Coe(a.flat(1).filter(Soe).filter(l=>l.rel==="stylesheet"||l.rel==="preload").map(l=>l.rel==="stylesheet"?{...l,rel:"prefetch",as:"style"}:{...l,rel:"prefetch"}))}function MW(s,n,i,a,l,p){let _=(w,C)=>i[C]?w.route.id!==i[C].route.id:!0,T=(w,C)=>{var O;return i[C].pathname!==w.pathname||((O=i[C].route.path)==null?void 0:O.endsWith("*"))&&i[C].params["*"]!==w.params["*"]};return p==="assets"?n.filter((w,C)=>_(w,C)||T(w,C)):p==="data"?n.filter((w,C)=>{var k;let O=a.routes[w.route.id];if(!O||!O.hasLoader)return!1;if(_(w,C)||T(w,C))return!0;if(w.route.shouldRevalidate){let U=w.route.shouldRevalidate({currentUrl:new URL(l.pathname+l.search+l.hash,window.origin),currentParams:((k=i[0])==null?void 0:k.params)||{},nextUrl:new URL(s,window.origin),nextParams:w.params,defaultShouldRevalidate:!0});if(typeof U=="boolean")return U}return!0}):[]}function boe(s,n,{includeHydrateFallback:i}={}){return woe(s.map(a=>{let l=n.routes[a.route.id];if(!l)return[];let p=[l.module];return l.clientActionModule&&(p=p.concat(l.clientActionModule)),l.clientLoaderModule&&(p=p.concat(l.clientLoaderModule)),i&&l.hydrateFallbackModule&&(p=p.concat(l.hydrateFallbackModule)),l.imports&&(p=p.concat(l.imports)),p}).flat(1))}function woe(s){return[...new Set(s)]}function Roe(s){let n={},i=Object.keys(s).sort();for(let a of i)n[a]=s[a];return n}function Coe(s,n){let i=new Set;return new Set(n),s.reduce((a,l)=>{let p=JSON.stringify(Roe(l));return i.has(p)||(i.add(p),a.push({key:p,link:l})),a},[])}function YY(){let s=F.useContext(tS);return V2(s,"You must render this element inside a <DataRouterContext.Provider> element"),s}function Aoe(){let s=F.useContext($O);return V2(s,"You must render this element inside a <DataRouterStateContext.Provider> element"),s}var F2=F.createContext(void 0);F2.displayName="FrameworkContext";function qY(){let s=F.useContext(F2);return V2(s,"You must render this element inside a <HydratedRouter> element"),s}function Ioe(s,n){let i=F.useContext(F2),[a,l]=F.useState(!1),[p,_]=F.useState(!1),{onFocus:T,onBlur:w,onMouseEnter:C,onMouseLeave:O,onTouchStart:k}=n,U=F.useRef(null);F.useEffect(()=>{if(s==="render"&&_(!0),s==="viewport"){let J=ie=>{ie.forEach(oe=>{_(oe.isIntersecting)})},X=new IntersectionObserver(J,{threshold:.5});return U.current&&X.observe(U.current),()=>{X.disconnect()}}},[s]),F.useEffect(()=>{if(a){let J=setTimeout(()=>{_(!0)},100);return()=>{clearTimeout(J)}}},[a]);let G=()=>{l(!0)},z=()=>{l(!1),_(!1)};return i?s!=="intent"?[p,U,{}]:[p,U,{onFocus:Tw(T,G),onBlur:Tw(w,z),onMouseEnter:Tw(C,G),onMouseLeave:Tw(O,z),onTouchStart:Tw(k,G)}]:[!1,U,{}]}function Tw(s,n){return i=>{s&&s(i),i.defaultPrevented||n(i)}}function Noe({page:s,...n}){let{router:i}=YY(),a=F.useMemo(()=>jY(i.routes,s,i.basename),[i.routes,s,i.basename]);return a?F.createElement(Doe,{page:s,matches:a,...n}):null}function Ooe(s){let{manifest:n,routeModules:i}=qY(),[a,l]=F.useState([]);return F.useEffect(()=>{let p=!1;return Toe(s,n,i).then(_=>{p||l(_)}),()=>{p=!0}},[s,n,i]),a}function Doe({page:s,matches:n,...i}){let a=Wi(),{manifest:l,routeModules:p}=qY(),{basename:_}=YY(),{loaderData:T,matches:w}=Aoe(),C=F.useMemo(()=>MW(s,n,w,l,a,"data"),[s,n,w,l,a]),O=F.useMemo(()=>MW(s,n,w,l,a,"assets"),[s,n,w,l,a]),k=F.useMemo(()=>{if(s===a.pathname+a.search+a.hash)return[];let z=new Set,J=!1;if(n.forEach(ie=>{var ce;let oe=l.routes[ie.route.id];!oe||!oe.hasLoader||(!C.some(_e=>_e.route.id===ie.route.id)&&ie.route.id in T&&((ce=p[ie.route.id])!=null&&ce.shouldRevalidate)||oe.hasClientLoader?J=!0:z.add(ie.route.id))}),z.size===0)return[];let X=yoe(s,_,"data");return J&&z.size>0&&X.searchParams.set("_routes",n.filter(ie=>z.has(ie.route.id)).map(ie=>ie.route.id).join(",")),[X.pathname+X.search]},[_,T,a,l,C,n,s,p]),U=F.useMemo(()=>boe(O,l),[O,l]),G=Ooe(O);return F.createElement(F.Fragment,null,k.map(z=>F.createElement("link",{key:z,rel:"prefetch",as:"fetch",href:z,...i})),U.map(z=>F.createElement("link",{key:z,rel:"modulepreload",href:z,...i})),G.map(({key:z,link:J})=>F.createElement("link",{key:z,...J})))}function xoe(...s){return n=>{s.forEach(i=>{typeof i=="function"?i(n):i!=null&&(i.current=n)})}}var KY=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{KY&&(window.__reactRouterVersion="7.7.0")}catch{}function Poe({basename:s,children:n,window:i}){let a=F.useRef();a.current==null&&(a.current=yae({window:i,v5Compat:!0}));let l=a.current,[p,_]=F.useState({action:l.action,location:l.location}),T=F.useCallback(w=>{F.startTransition(()=>_(w))},[_]);return F.useLayoutEffect(()=>l.listen(T),[l,T]),F.createElement(loe,{basename:s,children:n,location:p.location,navigationType:p.action,navigator:l})}var XY=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,mn=F.forwardRef(function({onClick:n,discover:i="render",prefetch:a="none",relative:l,reloadDocument:p,replace:_,state:T,target:w,to:C,preventScrollReset:O,viewTransition:k,...U},G){let{basename:z}=F.useContext(Ad),J=typeof C=="string"&&XY.test(C),X,ie=!1;if(typeof C=="string"&&J&&(X=C,KY))try{let q=new URL(window.location.href),ae=C.startsWith("//")?new URL(q.protocol+C):new URL(C),re=lp(ae.pathname,z);ae.origin===q.origin&&re!=null?C=re+ae.search+ae.hash:ie=!0}catch{wd(!1,`<Link to="${C}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let oe=Yae(C,{relative:l}),[ce,_e,se]=Ioe(a,U),be=joe(C,{replace:_,state:T,target:w,preventScrollReset:O,relative:l,viewTransition:k});function ee(q){n&&n(q),q.defaultPrevented||be(q)}let Q=F.createElement("a",{...U,...se,href:X||oe,onClick:ie||p?n:ee,ref:xoe(G,_e),target:w,"data-discover":!J&&i==="render"?"true":void 0});return ce&&!J?F.createElement(F.Fragment,null,Q,F.createElement(Noe,{page:oe})):Q});mn.displayName="Link";var koe=F.forwardRef(function({"aria-current":n="page",caseSensitive:i=!1,className:a="",end:l=!1,style:p,to:_,viewTransition:T,children:w,...C},O){let k=y0(_,{relative:C.relative}),U=Wi(),G=F.useContext($O),{navigator:z,basename:J}=F.useContext(Ad),X=G!=null&&Hoe(k)&&T===!0,ie=z.encodeLocation?z.encodeLocation(k).pathname:k.pathname,oe=U.pathname,ce=G&&G.navigation&&G.navigation.location?G.navigation.location.pathname:null;i||(oe=oe.toLowerCase(),ce=ce?ce.toLowerCase():null,ie=ie.toLowerCase()),ce&&J&&(ce=lp(ce,J)||ce);const _e=ie!=="/"&&ie.endsWith("/")?ie.length-1:ie.length;let se=oe===ie||!l&&oe.startsWith(ie)&&oe.charAt(_e)==="/",be=ce!=null&&(ce===ie||!l&&ce.startsWith(ie)&&ce.charAt(ie.length)==="/"),ee={isActive:se,isPending:be,isTransitioning:X},Q=se?n:void 0,q;typeof a=="function"?q=a(ee):q=[a,se?"active":null,be?"pending":null,X?"transitioning":null].filter(Boolean).join(" ");let ae=typeof p=="function"?p(ee):p;return F.createElement(mn,{...C,"aria-current":Q,className:q,ref:O,style:ae,to:_,viewTransition:T},typeof w=="function"?w(ee):w)});koe.displayName="NavLink";var Loe=F.forwardRef(({discover:s="render",fetcherKey:n,navigate:i,reloadDocument:a,replace:l,state:p,method:_=gN,action:T,onSubmit:w,relative:C,preventScrollReset:O,viewTransition:k,...U},G)=>{let z=Foe(),J=Boe(T,{relative:C}),X=_.toLowerCase()==="get"?"get":"post",ie=typeof T=="string"&&XY.test(T),oe=ce=>{if(w&&w(ce),ce.defaultPrevented)return;ce.preventDefault();let _e=ce.nativeEvent.submitter,se=(_e==null?void 0:_e.getAttribute("formmethod"))||_;z(_e||ce.currentTarget,{fetcherKey:n,method:se,navigate:i,replace:l,state:p,relative:C,preventScrollReset:O,viewTransition:k})};return F.createElement("form",{ref:G,method:X,action:J,onSubmit:a?w:oe,...U,"data-discover":!ie&&s==="render"?"true":void 0})});Loe.displayName="Form";function Moe(s){return`${s} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function QY(s){let n=F.useContext(tS);return Zi(n,Moe(s)),n}function joe(s,{target:n,replace:i,state:a,preventScrollReset:l,relative:p,viewTransition:_}={}){let T=es(),w=Wi(),C=y0(s,{relative:p});return F.useCallback(O=>{if(moe(O,n)){O.preventDefault();let k=i!==void 0?i:e0(w)===e0(C);T(s,{replace:k,state:a,preventScrollReset:l,relative:p,viewTransition:_})}},[w,T,C,i,a,n,s,l,p,_])}var Uoe=0,Voe=()=>`__${String(++Uoe)}__`;function Foe(){let{router:s}=QY("useSubmit"),{basename:n}=F.useContext(Ad),i=ioe();return F.useCallback(async(a,l={})=>{let{action:p,method:_,encType:T,formData:w,body:C}=Eoe(a,n);if(l.navigate===!1){let O=l.fetcherKey||Voe();await s.fetch(O,i,l.action||p,{preventScrollReset:l.preventScrollReset,formData:w,body:C,formMethod:l.method||_,formEncType:l.encType||T,flushSync:l.flushSync})}else await s.navigate(l.action||p,{preventScrollReset:l.preventScrollReset,formData:w,body:C,formMethod:l.method||_,formEncType:l.encType||T,replace:l.replace,state:l.state,fromRouteId:i,flushSync:l.flushSync,viewTransition:l.viewTransition})},[s,n,i])}function Boe(s,{relative:n}={}){let{basename:i}=F.useContext(Ad),a=F.useContext(Id);Zi(a,"useFormAction must be used inside a RouteContext");let[l]=a.matches.slice(-1),p={...y0(s||".",{relative:n})},_=Wi();if(s==null){p.search=_.search;let T=new URLSearchParams(p.search),w=T.getAll("index");if(w.some(O=>O==="")){T.delete("index"),w.filter(k=>k).forEach(k=>T.append("index",k));let O=T.toString();p.search=O?`?${O}`:""}}return(!s||s===".")&&l.route.index&&(p.search=p.search?p.search.replace(/^\?/,"?index&"):"?index"),i!=="/"&&(p.pathname=p.pathname==="/"?i:Zh([i,p.pathname])),e0(p)}function Hoe(s,n={}){let i=F.useContext(BY);Zi(i!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=QY("useViewTransitionState"),l=y0(s,{relative:n.relative});if(!i.isTransitioning)return!1;let p=lp(i.currentLocation.pathname,a)||i.currentLocation.pathname,_=lp(i.nextLocation.pathname,a)||i.nextLocation.pathname;return dO(l.pathname,_)!=null||dO(l.pathname,p)!=null}var $Y=MY();const h_=_0($Y);var RL={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var jW;function Goe(){return jW||(jW=1,function(s){(function(){var n={}.hasOwnProperty;function i(){for(var p="",_=0;_<arguments.length;_++){var T=arguments[_];T&&(p=l(p,a(T)))}return p}function a(p){if(typeof p=="string"||typeof p=="number")return p;if(typeof p!="object")return"";if(Array.isArray(p))return i.apply(null,p);if(p.toString!==Object.prototype.toString&&!p.toString.toString().includes("[native code]"))return p.toString();var _="";for(var T in p)n.call(p,T)&&p[T]&&(_=l(_,T));return _}function l(p,_){return _?p?p+" "+_:p+_:p}s.exports?(i.default=i,s.exports=i):window.classNames=i})()}(RL)),RL.exports}var Woe=Goe();const Si=_0(Woe);function zoe(s,n){if(s==null)return{};var i={};for(var a in s)if({}.hasOwnProperty.call(s,a)){if(n.indexOf(a)!==-1)continue;i[a]=s[a]}return i}function kM(s,n){return kM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},kM(s,n)}function Yoe(s,n){s.prototype=Object.create(n.prototype),s.prototype.constructor=s,kM(s,n)}const qoe=["xxl","xl","lg","md","sm","xs"],Koe="xs",v0=F.createContext({prefixes:{},breakpoints:qoe,minBreakpoint:Koe}),{Consumer:X0e,Provider:Q0e}=v0;function Ts(s,n){const{prefixes:i}=F.useContext(v0);return s||i[n]||n}function JY(){const{breakpoints:s}=F.useContext(v0);return s}function ZY(){const{minBreakpoint:s}=F.useContext(v0);return s}function Xoe(){const{dir:s}=F.useContext(v0);return s==="rtl"}function ZO(s){return s&&s.ownerDocument||document}function Qoe(s){var n=ZO(s);return n&&n.defaultView||window}function $oe(s,n){return Qoe(s).getComputedStyle(s,n)}var Joe=/([A-Z])/g;function Zoe(s){return s.replace(Joe,"-$1").toLowerCase()}var ece=/^ms-/;function QI(s){return Zoe(s).replace(ece,"-ms-")}var tce=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function nce(s){return!!(s&&tce.test(s))}function v_(s,n){var i="",a="";if(typeof n=="string")return s.style.getPropertyValue(QI(n))||$oe(s).getPropertyValue(QI(n));Object.keys(n).forEach(function(l){var p=n[l];!p&&p!==0?s.style.removeProperty(QI(l)):nce(l)?a+=l+"("+p+") ":i+=QI(l)+": "+p+";"}),a&&(i+="transform: "+a+";"),s.style.cssText+=";"+i}var CL={exports:{}},AL,UW;function rce(){if(UW)return AL;UW=1;var s="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return AL=s,AL}var IL,VW;function ice(){if(VW)return IL;VW=1;var s=rce();function n(){}function i(){}return i.resetWarningCache=n,IL=function(){function a(_,T,w,C,O,k){if(k!==s){var U=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw U.name="Invariant Violation",U}}a.isRequired=a;function l(){return a}var p={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:n};return p.PropTypes=p,p},IL}var FW;function sce(){return FW||(FW=1,CL.exports=ice()()),CL.exports}var ace=sce();const ep=_0(ace),BW={disabled:!1},eq=We.createContext(null);var oce=function(n){return n.scrollTop},Ow="unmounted",s_="exited",Bf="entering",d_="entered",LM="exiting",_p=function(s){Yoe(n,s);function n(a,l){var p;p=s.call(this,a,l)||this;var _=l,T=_&&!_.isMounting?a.enter:a.appear,w;return p.appearStatus=null,a.in?T?(w=s_,p.appearStatus=Bf):w=d_:a.unmountOnExit||a.mountOnEnter?w=Ow:w=s_,p.state={status:w},p.nextCallback=null,p}n.getDerivedStateFromProps=function(l,p){var _=l.in;return _&&p.status===Ow?{status:s_}:null};var i=n.prototype;return i.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},i.componentDidUpdate=function(l){var p=null;if(l!==this.props){var _=this.state.status;this.props.in?_!==Bf&&_!==d_&&(p=Bf):(_===Bf||_===d_)&&(p=LM)}this.updateStatus(!1,p)},i.componentWillUnmount=function(){this.cancelNextCallback()},i.getTimeouts=function(){var l=this.props.timeout,p,_,T;return p=_=T=l,l!=null&&typeof l!="number"&&(p=l.exit,_=l.enter,T=l.appear!==void 0?l.appear:_),{exit:p,enter:_,appear:T}},i.updateStatus=function(l,p){if(l===void 0&&(l=!1),p!==null)if(this.cancelNextCallback(),p===Bf){if(this.props.unmountOnExit||this.props.mountOnEnter){var _=this.props.nodeRef?this.props.nodeRef.current:h_.findDOMNode(this);_&&oce(_)}this.performEnter(l)}else this.performExit();else this.props.unmountOnExit&&this.state.status===s_&&this.setState({status:Ow})},i.performEnter=function(l){var p=this,_=this.props.enter,T=this.context?this.context.isMounting:l,w=this.props.nodeRef?[T]:[h_.findDOMNode(this),T],C=w[0],O=w[1],k=this.getTimeouts(),U=T?k.appear:k.enter;if(!l&&!_||BW.disabled){this.safeSetState({status:d_},function(){p.props.onEntered(C)});return}this.props.onEnter(C,O),this.safeSetState({status:Bf},function(){p.props.onEntering(C,O),p.onTransitionEnd(U,function(){p.safeSetState({status:d_},function(){p.props.onEntered(C,O)})})})},i.performExit=function(){var l=this,p=this.props.exit,_=this.getTimeouts(),T=this.props.nodeRef?void 0:h_.findDOMNode(this);if(!p||BW.disabled){this.safeSetState({status:s_},function(){l.props.onExited(T)});return}this.props.onExit(T),this.safeSetState({status:LM},function(){l.props.onExiting(T),l.onTransitionEnd(_.exit,function(){l.safeSetState({status:s_},function(){l.props.onExited(T)})})})},i.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},i.safeSetState=function(l,p){p=this.setNextCallback(p),this.setState(l,p)},i.setNextCallback=function(l){var p=this,_=!0;return this.nextCallback=function(T){_&&(_=!1,p.nextCallback=null,l(T))},this.nextCallback.cancel=function(){_=!1},this.nextCallback},i.onTransitionEnd=function(l,p){this.setNextCallback(p);var _=this.props.nodeRef?this.props.nodeRef.current:h_.findDOMNode(this),T=l==null&&!this.props.addEndListener;if(!_||T){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var w=this.props.nodeRef?[this.nextCallback]:[_,this.nextCallback],C=w[0],O=w[1];this.props.addEndListener(C,O)}l!=null&&setTimeout(this.nextCallback,l)},i.render=function(){var l=this.state.status;if(l===Ow)return null;var p=this.props,_=p.children;p.in,p.mountOnEnter,p.unmountOnExit,p.appear,p.enter,p.exit,p.timeout,p.addEndListener,p.onEnter,p.onEntering,p.onEntered,p.onExit,p.onExiting,p.onExited,p.nodeRef;var T=zoe(p,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return We.createElement(eq.Provider,{value:null},typeof _=="function"?_(l,T):We.cloneElement(We.Children.only(_),T))},n}(We.Component);_p.contextType=eq;_p.propTypes={};function vv(){}_p.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:vv,onEntering:vv,onEntered:vv,onExit:vv,onExiting:vv,onExited:vv};_p.UNMOUNTED=Ow;_p.EXITED=s_;_p.ENTERING=Bf;_p.ENTERED=d_;_p.EXITING=LM;function cce(s){return s.code==="Escape"||s.keyCode===27}function lce(){const s=F.version.split(".");return{major:+s[0],minor:+s[1],patch:+s[2]}}function eD(s){if(!s||typeof s=="function")return null;const{major:n}=lce();return n>=19?s.props.ref:s.ref}const rS=!!(typeof window<"u"&&window.document&&window.document.createElement);var MM=!1,jM=!1;try{var NL={get passive(){return MM=!0},get once(){return jM=MM=!0}};rS&&(window.addEventListener("test",NL,NL),window.removeEventListener("test",NL,!0))}catch{}function tq(s,n,i,a){if(a&&typeof a!="boolean"&&!jM){var l=a.once,p=a.capture,_=i;!jM&&l&&(_=i.__once||function T(w){this.removeEventListener(n,T,p),i.call(this,w)},i.__once=_),s.addEventListener(n,_,MM?a:p)}s.addEventListener(n,i,a)}function UM(s,n,i,a){var l=a&&typeof a!="boolean"?a.capture:a;s.removeEventListener(n,i,l),i.__once&&s.removeEventListener(n,i.__once,l)}function uO(s,n,i,a){return tq(s,n,i,a),function(){UM(s,n,i,a)}}function dce(s,n,i,a){if(a===void 0&&(a=!0),s){var l=document.createEvent("HTMLEvents");l.initEvent(n,i,a),s.dispatchEvent(l)}}function uce(s){var n=v_(s,"transitionDuration")||"",i=n.indexOf("ms")===-1?1e3:1;return parseFloat(n)*i}function hce(s,n,i){i===void 0&&(i=5);var a=!1,l=setTimeout(function(){a||dce(s,"transitionend",!0)},n+i),p=uO(s,"transitionend",function(){a=!0},{once:!0});return function(){clearTimeout(l),p()}}function nq(s,n,i,a){i==null&&(i=uce(s)||0);var l=hce(s,i,a),p=uO(s,"transitionend",n);return function(){l(),p()}}function HW(s,n){const i=v_(s,n)||"",a=i.indexOf("ms")===-1?1e3:1;return parseFloat(i)*a}function pce(s,n){const i=HW(s,"transitionDuration"),a=HW(s,"transitionDelay"),l=nq(s,p=>{p.target===s&&(l(),n(p))},i+a)}function fce(s){s.offsetHeight}const GW=s=>!s||typeof s=="function"?s:n=>{s.current=n};function mce(s,n){const i=GW(s),a=GW(n);return l=>{i&&i(l),a&&a(l)}}function rq(s,n){return F.useMemo(()=>mce(s,n),[s,n])}function gce(s){return s&&"setState"in s?h_.findDOMNode(s):s??null}const _ce=We.forwardRef(({onEnter:s,onEntering:n,onEntered:i,onExit:a,onExiting:l,onExited:p,addEndListener:_,children:T,childRef:w,...C},O)=>{const k=F.useRef(null),U=rq(k,w),G=be=>{U(gce(be))},z=be=>ee=>{be&&k.current&&be(k.current,ee)},J=F.useCallback(z(s),[s]),X=F.useCallback(z(n),[n]),ie=F.useCallback(z(i),[i]),oe=F.useCallback(z(a),[a]),ce=F.useCallback(z(l),[l]),_e=F.useCallback(z(p),[p]),se=F.useCallback(z(_),[_]);return m.jsx(_p,{ref:O,...C,onEnter:J,onEntered:ie,onEntering:X,onExit:oe,onExited:_e,onExiting:ce,addEndListener:se,nodeRef:k,children:typeof T=="function"?(be,ee)=>T(be,{...ee,ref:G}):We.cloneElement(T,{ref:G})})});function Ece(s){const n=F.useRef(s);return F.useEffect(()=>{n.current=s},[s]),n}function VM(s){const n=Ece(s);return F.useCallback(function(...i){return n.current&&n.current(...i)},[n])}const yce=s=>F.forwardRef((n,i)=>m.jsx("div",{...n,ref:i,className:Si(n.className,s)}));function vce(s){const n=F.useRef(s);return F.useEffect(()=>{n.current=s},[s]),n}function u_(s){const n=vce(s);return F.useCallback(function(...i){return n.current&&n.current(...i)},[n])}function Sce(){const s=F.useRef(!0),n=F.useRef(()=>s.current);return F.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[]),n.current}function Tce(s){const n=F.useRef(null);return F.useEffect(()=>{n.current=s}),n.current}const bce=typeof global<"u"&&global.navigator&&global.navigator.product==="ReactNative",wce=typeof document<"u",WW=wce||bce?F.useLayoutEffect:F.useEffect,Rce=["as","disabled"];function Cce(s,n){if(s==null)return{};var i={};for(var a in s)if({}.hasOwnProperty.call(s,a)){if(n.indexOf(a)>=0)continue;i[a]=s[a]}return i}function Ace(s){return!s||s.trim()==="#"}function iq({tagName:s,disabled:n,href:i,target:a,rel:l,role:p,onClick:_,tabIndex:T=0,type:w}){s||(i!=null||a!=null||l!=null?s="a":s="button");const C={tagName:s};if(s==="button")return[{type:w||"button",disabled:n},C];const O=U=>{if((n||s==="a"&&Ace(i))&&U.preventDefault(),n){U.stopPropagation();return}_==null||_(U)},k=U=>{U.key===" "&&(U.preventDefault(),O(U))};return s==="a"&&(i||(i="#"),n&&(i=void 0)),[{role:p??"button",disabled:void 0,tabIndex:n?void 0:T,href:i,target:s==="a"?a:void 0,"aria-disabled":n||void 0,rel:s==="a"?l:void 0,onClick:O,onKeyDown:k},C]}const Ice=F.forwardRef((s,n)=>{let{as:i,disabled:a}=s,l=Cce(s,Rce);const[p,{tagName:_}]=iq(Object.assign({tagName:i,disabled:a},l));return m.jsx(_,Object.assign({},l,p,{ref:n}))});Ice.displayName="Button";const Nce={[Bf]:"show",[d_]:"show"},B2=F.forwardRef(({className:s,children:n,transitionClasses:i={},onEnter:a,...l},p)=>{const _={in:!1,timeout:300,mountOnEnter:!1,unmountOnExit:!1,appear:!1,...l},T=F.useCallback((w,C)=>{fce(w),a==null||a(w,C)},[a]);return m.jsx(_ce,{ref:p,addEndListener:pce,..._,onEnter:T,childRef:eD(n),children:(w,C)=>F.cloneElement(n,{...C,className:Si("fade",s,n.props.className,Nce[w],i[w])})})});B2.displayName="Fade";const Oce={"aria-label":ep.string,onClick:ep.func,variant:ep.oneOf(["white"])},H2=F.forwardRef(({className:s,variant:n,"aria-label":i="Close",...a},l)=>m.jsx("button",{ref:l,type:"button",className:Si("btn-close",n&&`btn-close-${n}`,s),"aria-label":i,...a}));H2.displayName="CloseButton";H2.propTypes=Oce;const Qr=F.forwardRef(({as:s,bsPrefix:n,variant:i="primary",size:a,active:l=!1,disabled:p=!1,className:_,...T},w)=>{const C=Ts(n,"btn"),[O,{tagName:k}]=iq({tagName:s,disabled:p,...T}),U=k;return m.jsx(U,{...O,...T,ref:w,disabled:p,className:Si(_,C,l&&"active",i&&`${C}-${i}`,a&&`${C}-${a}`,T.href&&p&&"disabled")})});Qr.displayName="Button";function Dce(s){const n=F.useRef(s);return n.current=s,n}function xce(s){const n=Dce(s);F.useEffect(()=>()=>n.current(),[])}function Pce(s,n){return F.Children.toArray(s).some(i=>F.isValidElement(i)&&i.type===n)}function kce({as:s,bsPrefix:n,className:i,...a}){n=Ts(n,"col");const l=JY(),p=ZY(),_=[],T=[];return l.forEach(w=>{const C=a[w];delete a[w];let O,k,U;typeof C=="object"&&C!=null?{span:O,offset:k,order:U}=C:O=C;const G=w!==p?`-${w}`:"";O&&_.push(O===!0?`${n}${G}`:`${n}${G}-${O}`),U!=null&&T.push(`order${G}-${U}`),k!=null&&T.push(`offset${G}-${k}`)}),[{...a,className:Si(i,..._,...T)},{as:s,bsPrefix:n,spans:_}]}const ea=F.forwardRef((s,n)=>{const[{className:i,...a},{as:l="div",bsPrefix:p,spans:_}]=kce(s);return m.jsx(l,{...a,ref:n,className:Si(i,!_.length&&p)})});ea.displayName="Col";const sq=F.forwardRef(({bsPrefix:s,fluid:n=!1,as:i="div",className:a,...l},p)=>{const _=Ts(s,"container"),T=typeof n=="string"?`-${n}`:"-fluid";return m.jsx(i,{ref:p,...l,className:Si(a,n?`${_}${T}`:_)})});sq.displayName="Container";var Lce=Function.prototype.bind.call(Function.prototype.call,[].slice);function Sv(s,n){return Lce(s.querySelectorAll(n))}function zW(s,n){if(s.contains)return s.contains(n);if(s.compareDocumentPosition)return s===n||!!(s.compareDocumentPosition(n)&16)}const Mce="data-rr-ui-";function jce(s){return`${Mce}${s}`}const aq=F.createContext(rS?window:void 0);aq.Provider;function G2(){return F.useContext(aq)}const Uce={type:ep.string,tooltip:ep.bool,as:ep.elementType},tD=F.forwardRef(({as:s="div",className:n,type:i="valid",tooltip:a=!1,...l},p)=>m.jsx(s,{...l,ref:p,className:Si(n,`${i}-${a?"tooltip":"feedback"}`)}));tD.displayName="Feedback";tD.propTypes=Uce;const dp=F.createContext({}),W2=F.forwardRef(({id:s,bsPrefix:n,className:i,type:a="checkbox",isValid:l=!1,isInvalid:p=!1,as:_="input",...T},w)=>{const{controlId:C}=F.useContext(dp);return n=Ts(n,"form-check-input"),m.jsx(_,{...T,ref:w,type:a,id:s||C,className:Si(i,n,l&&"is-valid",p&&"is-invalid")})});W2.displayName="FormCheckInput";const hO=F.forwardRef(({bsPrefix:s,className:n,htmlFor:i,...a},l)=>{const{controlId:p}=F.useContext(dp);return s=Ts(s,"form-check-label"),m.jsx("label",{...a,ref:l,htmlFor:i||p,className:Si(n,s)})});hO.displayName="FormCheckLabel";const oq=F.forwardRef(({id:s,bsPrefix:n,bsSwitchPrefix:i,inline:a=!1,reverse:l=!1,disabled:p=!1,isValid:_=!1,isInvalid:T=!1,feedbackTooltip:w=!1,feedback:C,feedbackType:O,className:k,style:U,title:G="",type:z="checkbox",label:J,children:X,as:ie="input",...oe},ce)=>{n=Ts(n,"form-check"),i=Ts(i,"form-switch");const{controlId:_e}=F.useContext(dp),se=F.useMemo(()=>({controlId:s||_e}),[_e,s]),be=!X&&J!=null&&J!==!1||Pce(X,hO),ee=m.jsx(W2,{...oe,type:z==="switch"?"checkbox":z,ref:ce,isValid:_,isInvalid:T,disabled:p,as:ie});return m.jsx(dp.Provider,{value:se,children:m.jsx("div",{style:U,className:Si(k,be&&n,a&&`${n}-inline`,l&&`${n}-reverse`,z==="switch"&&i),children:X||m.jsxs(m.Fragment,{children:[ee,be&&m.jsx(hO,{title:G,children:J}),C&&m.jsx(tD,{type:O,tooltip:w,children:C})]})})})});oq.displayName="FormCheck";const pO=Object.assign(oq,{Input:W2,Label:hO}),cq=F.forwardRef(({bsPrefix:s,type:n,size:i,htmlSize:a,id:l,className:p,isValid:_=!1,isInvalid:T=!1,plaintext:w,readOnly:C,as:O="input",...k},U)=>{const{controlId:G}=F.useContext(dp);return s=Ts(s,"form-control"),m.jsx(O,{...k,type:n,size:a,ref:U,readOnly:C,id:l||G,className:Si(p,w?`${s}-plaintext`:s,i&&`${s}-${i}`,n==="color"&&`${s}-color`,_&&"is-valid",T&&"is-invalid")})});cq.displayName="FormControl";const Vce=Object.assign(cq,{Feedback:tD}),lq=F.forwardRef(({className:s,bsPrefix:n,as:i="div",...a},l)=>(n=Ts(n,"form-floating"),m.jsx(i,{ref:l,className:Si(s,n),...a})));lq.displayName="FormFloating";const z2=F.forwardRef(({controlId:s,as:n="div",...i},a)=>{const l=F.useMemo(()=>({controlId:s}),[s]);return m.jsx(dp.Provider,{value:l,children:m.jsx(n,{...i,ref:a})})});z2.displayName="FormGroup";const dq=F.forwardRef(({as:s="label",bsPrefix:n,column:i=!1,visuallyHidden:a=!1,className:l,htmlFor:p,..._},T)=>{const{controlId:w}=F.useContext(dp);n=Ts(n,"form-label");let C="col-form-label";typeof i=="string"&&(C=`${C} ${C}-${i}`);const O=Si(l,n,a&&"visually-hidden",i&&C);return p=p||w,i?m.jsx(ea,{ref:T,as:"label",className:O,htmlFor:p,..._}):m.jsx(s,{ref:T,className:O,htmlFor:p,..._})});dq.displayName="FormLabel";const uq=F.forwardRef(({bsPrefix:s,className:n,id:i,...a},l)=>{const{controlId:p}=F.useContext(dp);return s=Ts(s,"form-range"),m.jsx("input",{...a,type:"range",ref:l,className:Si(n,s),id:i||p})});uq.displayName="FormRange";const hq=F.forwardRef(({bsPrefix:s,size:n,htmlSize:i,className:a,isValid:l=!1,isInvalid:p=!1,id:_,...T},w)=>{const{controlId:C}=F.useContext(dp);return s=Ts(s,"form-select"),m.jsx("select",{...T,size:i,ref:w,className:Si(a,s,n&&`${s}-${n}`,l&&"is-valid",p&&"is-invalid"),id:_||C})});hq.displayName="FormSelect";const pq=F.forwardRef(({bsPrefix:s,className:n,as:i="small",muted:a,...l},p)=>(s=Ts(s,"form-text"),m.jsx(i,{...l,ref:p,className:Si(n,s,a&&"text-muted")})));pq.displayName="FormText";const fq=F.forwardRef((s,n)=>m.jsx(pO,{...s,ref:n,type:"switch"}));fq.displayName="Switch";const Fce=Object.assign(fq,{Input:pO.Input,Label:pO.Label}),mq=F.forwardRef(({bsPrefix:s,className:n,children:i,controlId:a,label:l,...p},_)=>(s=Ts(s,"form-floating"),m.jsxs(z2,{ref:_,className:Si(n,s),controlId:a,...p,children:[i,m.jsx("label",{htmlFor:a,children:l})]})));mq.displayName="FloatingLabel";const Bce={_ref:ep.any,validated:ep.bool,as:ep.elementType},Y2=F.forwardRef(({className:s,validated:n,as:i="form",...a},l)=>m.jsx(i,{...a,ref:l,className:Si(s,n&&"was-validated")}));Y2.displayName="Form";Y2.propTypes=Bce;const ot=Object.assign(Y2,{Group:z2,Control:Vce,Floating:lq,Check:pO,Switch:Fce,Label:dq,Text:pq,Range:uq,Select:hq,FloatingLabel:mq}),YW=s=>!s||typeof s=="function"?s:n=>{s.current=n};function Hce(s,n){const i=YW(s),a=YW(n);return l=>{i&&i(l),a&&a(l)}}function q2(s,n){return F.useMemo(()=>Hce(s,n),[s,n])}var $I;function qW(s){if((!$I&&$I!==0||s)&&rS){var n=document.createElement("div");n.style.position="absolute",n.style.top="-9999px",n.style.width="50px",n.style.height="50px",n.style.overflow="scroll",document.body.appendChild(n),$I=n.offsetWidth-n.clientWidth,document.body.removeChild(n)}return $I}function Gce(){return F.useState(null)}function OL(s){s===void 0&&(s=ZO());try{var n=s.activeElement;return!n||!n.nodeName?null:n}catch{return s.body}}function Wce(s){const n=F.useRef(s);return n.current=s,n}function zce(s){const n=Wce(s);F.useEffect(()=>()=>n.current(),[])}function Yce(s=document){const n=s.defaultView;return Math.abs(n.innerWidth-s.documentElement.clientWidth)}const KW=jce("modal-open");class K2{constructor({ownerDocument:n,handleContainerOverflow:i=!0,isRTL:a=!1}={}){this.handleContainerOverflow=i,this.isRTL=a,this.modals=[],this.ownerDocument=n}getScrollbarWidth(){return Yce(this.ownerDocument)}getElement(){return(this.ownerDocument||document).body}setModalAttributes(n){}removeModalAttributes(n){}setContainerStyle(n){const i={overflow:"hidden"},a=this.isRTL?"paddingLeft":"paddingRight",l=this.getElement();n.style={overflow:l.style.overflow,[a]:l.style[a]},n.scrollBarWidth&&(i[a]=`${parseInt(v_(l,a)||"0",10)+n.scrollBarWidth}px`),l.setAttribute(KW,""),v_(l,i)}reset(){[...this.modals].forEach(n=>this.remove(n))}removeContainerStyle(n){const i=this.getElement();i.removeAttribute(KW),Object.assign(i.style,n.style)}add(n){let i=this.modals.indexOf(n);return i!==-1||(i=this.modals.length,this.modals.push(n),this.setModalAttributes(n),i!==0)||(this.state={scrollBarWidth:this.getScrollbarWidth(),style:{}},this.handleContainerOverflow&&this.setContainerStyle(this.state)),i}remove(n){const i=this.modals.indexOf(n);i!==-1&&(this.modals.splice(i,1),!this.modals.length&&this.handleContainerOverflow&&this.removeContainerStyle(this.state),this.removeModalAttributes(n))}isTopModal(n){return!!this.modals.length&&this.modals[this.modals.length-1]===n}}const DL=(s,n)=>rS?s==null?(n||ZO()).body:(typeof s=="function"&&(s=s()),s&&"current"in s&&(s=s.current),s&&("nodeType"in s||s.getBoundingClientRect)?s:null):null;function qce(s,n){const i=G2(),[a,l]=F.useState(()=>DL(s,i==null?void 0:i.document));if(!a){const p=DL(s);p&&l(p)}return F.useEffect(()=>{},[n,a]),F.useEffect(()=>{const p=DL(s);p!==a&&l(p)},[s,a]),a}function Kce({children:s,in:n,onExited:i,mountOnEnter:a,unmountOnExit:l}){const p=F.useRef(null),_=F.useRef(n),T=u_(i);F.useEffect(()=>{n?_.current=!0:T(p.current)},[n,T]);const w=q2(p,eD(s)),C=F.cloneElement(s,{ref:w});return n?C:l||!_.current&&a?null:C}const Xce=["onEnter","onEntering","onEntered","onExit","onExiting","onExited","addEndListener","children"];function Qce(s,n){if(s==null)return{};var i={};for(var a in s)if({}.hasOwnProperty.call(s,a)){if(n.indexOf(a)>=0)continue;i[a]=s[a]}return i}function $ce(s){let{onEnter:n,onEntering:i,onEntered:a,onExit:l,onExiting:p,onExited:_,addEndListener:T,children:w}=s,C=Qce(s,Xce);const O=F.useRef(null),k=q2(O,eD(w)),U=_e=>se=>{_e&&O.current&&_e(O.current,se)},G=F.useCallback(U(n),[n]),z=F.useCallback(U(i),[i]),J=F.useCallback(U(a),[a]),X=F.useCallback(U(l),[l]),ie=F.useCallback(U(p),[p]),oe=F.useCallback(U(_),[_]),ce=F.useCallback(U(T),[T]);return Object.assign({},C,{nodeRef:O},n&&{onEnter:G},i&&{onEntering:z},a&&{onEntered:J},l&&{onExit:X},p&&{onExiting:ie},_&&{onExited:oe},T&&{addEndListener:ce},{children:typeof w=="function"?(_e,se)=>w(_e,Object.assign({},se,{ref:k})):F.cloneElement(w,{ref:k})})}const Jce=["component"];function Zce(s,n){if(s==null)return{};var i={};for(var a in s)if({}.hasOwnProperty.call(s,a)){if(n.indexOf(a)>=0)continue;i[a]=s[a]}return i}const ele=F.forwardRef((s,n)=>{let{component:i}=s,a=Zce(s,Jce);const l=$ce(a);return m.jsx(i,Object.assign({ref:n},l))});function tle({in:s,onTransition:n}){const i=F.useRef(null),a=F.useRef(!0),l=u_(n);return WW(()=>{if(!i.current)return;let p=!1;return l({in:s,element:i.current,initial:a.current,isStale:()=>p}),()=>{p=!0}},[s,l]),WW(()=>(a.current=!1,()=>{a.current=!0}),[]),i}function nle({children:s,in:n,onExited:i,onEntered:a,transition:l}){const[p,_]=F.useState(!n);n&&p&&_(!1);const T=tle({in:!!n,onTransition:C=>{const O=()=>{C.isStale()||(C.in?a==null||a(C.element,C.initial):(_(!0),i==null||i(C.element)))};Promise.resolve(l(C)).then(O,k=>{throw C.in||_(!0),k})}}),w=q2(T,eD(s));return p&&!n?null:F.cloneElement(s,{ref:w})}function XW(s,n,i){return s?m.jsx(ele,Object.assign({},i,{component:s})):n?m.jsx(nle,Object.assign({},i,{transition:n})):m.jsx(Kce,Object.assign({},i))}const rle=["show","role","className","style","children","backdrop","keyboard","onBackdropClick","onEscapeKeyDown","transition","runTransition","backdropTransition","runBackdropTransition","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","renderDialog","renderBackdrop","manager","container","onShow","onHide","onExit","onExited","onExiting","onEnter","onEntering","onEntered"];function ile(s,n){if(s==null)return{};var i={};for(var a in s)if({}.hasOwnProperty.call(s,a)){if(n.indexOf(a)>=0)continue;i[a]=s[a]}return i}let xL;function sle(s){return xL||(xL=new K2({ownerDocument:s==null?void 0:s.document})),xL}function ale(s){const n=G2(),i=s||sle(n),a=F.useRef({dialog:null,backdrop:null});return Object.assign(a.current,{add:()=>i.add(a.current),remove:()=>i.remove(a.current),isTopModal:()=>i.isTopModal(a.current),setDialogRef:F.useCallback(l=>{a.current.dialog=l},[]),setBackdropRef:F.useCallback(l=>{a.current.backdrop=l},[])})}const gq=F.forwardRef((s,n)=>{let{show:i=!1,role:a="dialog",className:l,style:p,children:_,backdrop:T=!0,keyboard:w=!0,onBackdropClick:C,onEscapeKeyDown:O,transition:k,runTransition:U,backdropTransition:G,runBackdropTransition:z,autoFocus:J=!0,enforceFocus:X=!0,restoreFocus:ie=!0,restoreFocusOptions:oe,renderDialog:ce,renderBackdrop:_e=Dt=>m.jsx("div",Object.assign({},Dt)),manager:se,container:be,onShow:ee,onHide:Q=()=>{},onExit:q,onExited:ae,onExiting:re,onEnter:fe,onEntering:pe,onEntered:Re}=s,Ge=ile(s,rle);const ve=G2(),Ne=qce(be),Ce=ale(se),Ue=Sce(),de=Tce(i),[De,xe]=F.useState(!i),Xe=F.useRef(null);F.useImperativeHandle(n,()=>Ce,[Ce]),rS&&!de&&i&&(Xe.current=OL(ve==null?void 0:ve.document)),i&&De&&xe(!1);const ut=u_(()=>{if(Ce.add(),on.current=uO(document,"keydown",$t),Tt.current=uO(document,"focus",()=>setTimeout(It),!0),ee&&ee(),J){var Dt,wt;const rt=OL((Dt=(wt=Ce.dialog)==null?void 0:wt.ownerDocument)!=null?Dt:ve==null?void 0:ve.document);Ce.dialog&&rt&&!zW(Ce.dialog,rt)&&(Xe.current=rt,Ce.dialog.focus())}}),Pt=u_(()=>{if(Ce.remove(),on.current==null||on.current(),Tt.current==null||Tt.current(),ie){var Dt;(Dt=Xe.current)==null||Dt.focus==null||Dt.focus(oe),Xe.current=null}});F.useEffect(()=>{!i||!Ne||ut()},[i,Ne,ut]),F.useEffect(()=>{De&&Pt()},[De,Pt]),zce(()=>{Pt()});const It=u_(()=>{if(!X||!Ue()||!Ce.isTopModal())return;const Dt=OL(ve==null?void 0:ve.document);Ce.dialog&&Dt&&!zW(Ce.dialog,Dt)&&Ce.dialog.focus()}),zt=u_(Dt=>{Dt.target===Dt.currentTarget&&(C==null||C(Dt),T===!0&&Q())}),$t=u_(Dt=>{w&&cce(Dt)&&Ce.isTopModal()&&(O==null||O(Dt),Dt.defaultPrevented||Q())}),Tt=F.useRef(),on=F.useRef(),fn=(...Dt)=>{xe(!0),ae==null||ae(...Dt)};if(!Ne)return null;const Ut=Object.assign({role:a,ref:Ce.setDialogRef,"aria-modal":a==="dialog"?!0:void 0},Ge,{style:p,className:l,tabIndex:-1});let yt=ce?ce(Ut):m.jsx("div",Object.assign({},Ut,{children:F.cloneElement(_,{role:"document"})}));yt=XW(k,U,{unmountOnExit:!0,mountOnEnter:!0,appear:!0,in:!!i,onExit:q,onExiting:re,onExited:fn,onEnter:fe,onEntering:pe,onEntered:Re,children:yt});let an=null;return T&&(an=_e({ref:Ce.setBackdropRef,onClick:zt}),an=XW(G,z,{in:!!i,appear:!0,mountOnEnter:!0,unmountOnExit:!0,children:an})),m.jsx(m.Fragment,{children:h_.createPortal(m.jsxs(m.Fragment,{children:[an,yt]}),Ne)})});gq.displayName="Modal";const ole=Object.assign(gq,{Manager:K2});function cle(s,n){return s.classList?s.classList.contains(n):(" "+(s.className.baseVal||s.className)+" ").indexOf(" "+n+" ")!==-1}function lle(s,n){s.classList?s.classList.add(n):cle(s,n)||(typeof s.className=="string"?s.className=s.className+" "+n:s.setAttribute("class",(s.className&&s.className.baseVal||"")+" "+n))}function QW(s,n){return s.replace(new RegExp("(^|\\s)"+n+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function dle(s,n){s.classList?s.classList.remove(n):typeof s.className=="string"?s.className=QW(s.className,n):s.setAttribute("class",QW(s.className&&s.className.baseVal||"",n))}const Tv={FIXED_CONTENT:".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",STICKY_CONTENT:".sticky-top",NAVBAR_TOGGLER:".navbar-toggler"};class ule extends K2{adjustAndStore(n,i,a){const l=i.style[n];i.dataset[n]=l,v_(i,{[n]:`${parseFloat(v_(i,n))+a}px`})}restore(n,i){const a=i.dataset[n];a!==void 0&&(delete i.dataset[n],v_(i,{[n]:a}))}setContainerStyle(n){super.setContainerStyle(n);const i=this.getElement();if(lle(i,"modal-open"),!n.scrollBarWidth)return;const a=this.isRTL?"paddingLeft":"paddingRight",l=this.isRTL?"marginLeft":"marginRight";Sv(i,Tv.FIXED_CONTENT).forEach(p=>this.adjustAndStore(a,p,n.scrollBarWidth)),Sv(i,Tv.STICKY_CONTENT).forEach(p=>this.adjustAndStore(l,p,-n.scrollBarWidth)),Sv(i,Tv.NAVBAR_TOGGLER).forEach(p=>this.adjustAndStore(l,p,n.scrollBarWidth))}removeContainerStyle(n){super.removeContainerStyle(n);const i=this.getElement();dle(i,"modal-open");const a=this.isRTL?"paddingLeft":"paddingRight",l=this.isRTL?"marginLeft":"marginRight";Sv(i,Tv.FIXED_CONTENT).forEach(p=>this.restore(a,p)),Sv(i,Tv.STICKY_CONTENT).forEach(p=>this.restore(l,p)),Sv(i,Tv.NAVBAR_TOGGLER).forEach(p=>this.restore(l,p))}}let PL;function hle(s){return PL||(PL=new ule(s)),PL}const _q=F.forwardRef(({className:s,bsPrefix:n,as:i="div",...a},l)=>(n=Ts(n,"modal-body"),m.jsx(i,{ref:l,className:Si(s,n),...a})));_q.displayName="ModalBody";const Eq=F.createContext({onHide(){}}),X2=F.forwardRef(({bsPrefix:s,className:n,contentClassName:i,centered:a,size:l,fullscreen:p,children:_,scrollable:T,...w},C)=>{s=Ts(s,"modal");const O=`${s}-dialog`,k=typeof p=="string"?`${s}-fullscreen-${p}`:`${s}-fullscreen`;return m.jsx("div",{...w,ref:C,className:Si(O,n,l&&`${s}-${l}`,a&&`${O}-centered`,T&&`${O}-scrollable`,p&&k),children:m.jsx("div",{className:Si(`${s}-content`,i),children:_})})});X2.displayName="ModalDialog";const yq=F.forwardRef(({className:s,bsPrefix:n,as:i="div",...a},l)=>(n=Ts(n,"modal-footer"),m.jsx(i,{ref:l,className:Si(s,n),...a})));yq.displayName="ModalFooter";const ple=F.forwardRef(({closeLabel:s="Close",closeVariant:n,closeButton:i=!1,onHide:a,children:l,...p},_)=>{const T=F.useContext(Eq),w=VM(()=>{T==null||T.onHide(),a==null||a()});return m.jsxs("div",{ref:_,...p,children:[l,i&&m.jsx(H2,{"aria-label":s,variant:n,onClick:w})]})}),vq=F.forwardRef(({bsPrefix:s,className:n,closeLabel:i="Close",closeButton:a=!1,...l},p)=>(s=Ts(s,"modal-header"),m.jsx(ple,{ref:p,...l,className:Si(n,s),closeLabel:i,closeButton:a})));vq.displayName="ModalHeader";const fle=yce("h4"),Sq=F.forwardRef(({className:s,bsPrefix:n,as:i=fle,...a},l)=>(n=Ts(n,"modal-title"),m.jsx(i,{ref:l,className:Si(s,n),...a})));Sq.displayName="ModalTitle";function mle(s){return m.jsx(B2,{...s,timeout:null})}function gle(s){return m.jsx(B2,{...s,timeout:null})}const Tq=F.forwardRef(({bsPrefix:s,className:n,style:i,dialogClassName:a,contentClassName:l,children:p,dialogAs:_=X2,"data-bs-theme":T,"aria-labelledby":w,"aria-describedby":C,"aria-label":O,show:k=!1,animation:U=!0,backdrop:G=!0,keyboard:z=!0,onEscapeKeyDown:J,onShow:X,onHide:ie,container:oe,autoFocus:ce=!0,enforceFocus:_e=!0,restoreFocus:se=!0,restoreFocusOptions:be,onEntered:ee,onExit:Q,onExiting:q,onEnter:ae,onEntering:re,onExited:fe,backdropClassName:pe,manager:Re,...Ge},ve)=>{const[Ne,Ce]=F.useState({}),[Ue,de]=F.useState(!1),De=F.useRef(!1),xe=F.useRef(!1),Xe=F.useRef(null),[ut,Pt]=Gce(),It=rq(ve,Pt),zt=VM(ie),$t=Xoe();s=Ts(s,"modal");const Tt=F.useMemo(()=>({onHide:zt}),[zt]);function on(){return Re||hle({isRTL:$t})}function fn(vt){if(!rS)return;const Bt=on().getScrollbarWidth()>0,bt=vt.scrollHeight>ZO(vt).documentElement.clientHeight;Ce({paddingRight:Bt&&!bt?qW():void 0,paddingLeft:!Bt&&bt?qW():void 0})}const Ut=VM(()=>{ut&&fn(ut.dialog)});xce(()=>{UM(window,"resize",Ut),Xe.current==null||Xe.current()});const yt=()=>{De.current=!0},an=vt=>{De.current&&ut&&vt.target===ut.dialog&&(xe.current=!0),De.current=!1},Dt=()=>{de(!0),Xe.current=nq(ut.dialog,()=>{de(!1)})},wt=vt=>{vt.target===vt.currentTarget&&Dt()},rt=vt=>{if(G==="static"){wt(vt);return}if(xe.current||vt.target!==vt.currentTarget){xe.current=!1;return}ie==null||ie()},xt=vt=>{z?J==null||J(vt):(vt.preventDefault(),G==="static"&&Dt())},Mt=(vt,Bt)=>{vt&&fn(vt),ae==null||ae(vt,Bt)},Bn=vt=>{Xe.current==null||Xe.current(),Q==null||Q(vt)},ki=(vt,Bt)=>{re==null||re(vt,Bt),tq(window,"resize",Ut)},zi=vt=>{vt&&(vt.style.display=""),fe==null||fe(vt),UM(window,"resize",Ut)},Cr=F.useCallback(vt=>m.jsx("div",{...vt,className:Si(`${s}-backdrop`,pe,!U&&"show")}),[U,pe,s]),Un={...i,...Ne};Un.display="block";const Li=vt=>m.jsx("div",{role:"dialog",...vt,style:Un,className:Si(n,s,Ue&&`${s}-static`,!U&&"show"),onClick:G?rt:void 0,onMouseUp:an,"data-bs-theme":T,"aria-label":O,"aria-labelledby":w,"aria-describedby":C,children:m.jsx(_,{...Ge,onMouseDown:yt,className:a,contentClassName:l,children:p})});return m.jsx(Eq.Provider,{value:Tt,children:m.jsx(ole,{show:k,ref:It,backdrop:G,container:oe,keyboard:!0,autoFocus:ce,enforceFocus:_e,restoreFocus:se,restoreFocusOptions:be,onEscapeKeyDown:xt,onShow:X,onHide:ie,onEnter:Mt,onEntering:ki,onEntered:ee,onExit:Bn,onExiting:q,onExited:zi,manager:on(),transition:U?mle:void 0,backdropTransition:U?gle:void 0,renderBackdrop:Cr,renderDialog:Li})})});Tq.displayName="Modal";const Cn=Object.assign(Tq,{Body:_q,Header:vq,Title:Sq,Footer:yq,Dialog:X2,TRANSITION_DURATION:300,BACKDROP_TRANSITION_DURATION:150}),Td=F.forwardRef(({bsPrefix:s,className:n,as:i="div",...a},l)=>{const p=Ts(s,"row"),_=JY(),T=ZY(),w=`${p}-cols`,C=[];return _.forEach(O=>{const k=a[O];delete a[O];let U;k!=null&&typeof k=="object"?{cols:U}=k:U=k;const G=O!==T?`-${O}`:"";U!=null&&C.push(`${w}${G}-${U}`)}),m.jsx(i,{ref:l,...a,className:Si(n,p,...C)})});Td.displayName="Row";const bq=F.forwardRef(({bsPrefix:s,className:n,striped:i,bordered:a,borderless:l,hover:p,size:_,variant:T,responsive:w,...C},O)=>{const k=Ts(s,"table"),U=Si(n,k,T&&`${k}-${T}`,_&&`${k}-${_}`,i&&`${k}-${typeof i=="string"?`striped-${i}`:"striped"}`,a&&`${k}-bordered`,l&&`${k}-borderless`,p&&`${k}-hover`),G=m.jsx("table",{...C,className:U,ref:O});if(w){let z=`${k}-responsive`;return typeof w=="string"&&(z=`${z}-${w}`),m.jsx("div",{className:z,children:G})}return G});var kL={exports:{}},LL={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $W;function _le(){if($W)return LL;$W=1;var s=QO();function n(w,C){return w===C&&(w!==0||1/w===1/C)||w!==w&&C!==C}var i=typeof Object.is=="function"?Object.is:n,a=s.useSyncExternalStore,l=s.useRef,p=s.useEffect,_=s.useMemo,T=s.useDebugValue;return LL.useSyncExternalStoreWithSelector=function(w,C,O,k,U){var G=l(null);if(G.current===null){var z={hasValue:!1,value:null};G.current=z}else z=G.current;G=_(function(){function X(se){if(!ie){if(ie=!0,oe=se,se=k(se),U!==void 0&&z.hasValue){var be=z.value;if(U(be,se))return ce=be}return ce=se}if(be=ce,i(oe,se))return be;var ee=k(se);return U!==void 0&&U(be,ee)?(oe=se,be):(oe=se,ce=ee)}var ie=!1,oe,ce,_e=O===void 0?null:O;return[function(){return X(C())},_e===null?void 0:function(){return X(_e())}]},[C,O,k,U]);var J=a(w,G[0],G[1]);return p(function(){z.hasValue=!0,z.value=J},[J]),T(J),J},LL}var JW;function Ele(){return JW||(JW=1,kL.exports=_le()),kL.exports}var yle=Ele();function vle(s){s()}function Sle(){let s=null,n=null;return{clear(){s=null,n=null},notify(){vle(()=>{let i=s;for(;i;)i.callback(),i=i.next})},get(){const i=[];let a=s;for(;a;)i.push(a),a=a.next;return i},subscribe(i){let a=!0;const l=n={callback:i,next:null,prev:n};return l.prev?l.prev.next=l:s=l,function(){!a||s===null||(a=!1,l.next?l.next.prev=l.prev:n=l.prev,l.prev?l.prev.next=l.next:s=l.next)}}}}var ZW={notify(){},get:()=>[]};function Tle(s,n){let i,a=ZW,l=0,p=!1;function _(J){O();const X=a.subscribe(J);let ie=!1;return()=>{ie||(ie=!0,X(),k())}}function T(){a.notify()}function w(){z.onStateChange&&z.onStateChange()}function C(){return p}function O(){l++,i||(i=s.subscribe(w),a=Sle())}function k(){l--,i&&l===0&&(i(),i=void 0,a.clear(),a=ZW)}function U(){p||(p=!0,O())}function G(){p&&(p=!1,k())}const z={addNestedSub:_,notifyNestedSubs:T,handleChangeWrapper:w,isSubscribed:C,trySubscribe:U,tryUnsubscribe:G,getListeners:()=>a};return z}var ble=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",wle=ble(),Rle=()=>typeof navigator<"u"&&navigator.product==="ReactNative",Cle=Rle(),Ale=()=>wle||Cle?F.useLayoutEffect:F.useEffect,Ile=Ale(),ML=Symbol.for("react-redux-context"),jL=typeof globalThis<"u"?globalThis:{};function Nle(){if(!F.createContext)return{};const s=jL[ML]??(jL[ML]=new Map);let n=s.get(F.createContext);return n||(n=F.createContext(null),s.set(F.createContext,n)),n}var Jf=Nle();function Ole(s){const{children:n,context:i,serverState:a,store:l}=s,p=F.useMemo(()=>{const w=Tle(l);return{store:l,subscription:w,getServerState:a?()=>a:void 0}},[l,a]),_=F.useMemo(()=>l.getState(),[l]);Ile(()=>{const{subscription:w}=p;return w.onStateChange=w.notifyNestedSubs,w.trySubscribe(),_!==l.getState()&&w.notifyNestedSubs(),()=>{w.tryUnsubscribe(),w.onStateChange=void 0}},[p,_]);const T=i||Jf;return F.createElement(T.Provider,{value:p},n)}var Dle=Ole;function Q2(s=Jf){return function(){return F.useContext(s)}}var wq=Q2();function Rq(s=Jf){const n=s===Jf?wq:Q2(s),i=()=>{const{store:a}=n();return a};return Object.assign(i,{withTypes:()=>i}),i}var xle=Rq();function Ple(s=Jf){const n=s===Jf?xle:Rq(s),i=()=>n().dispatch;return Object.assign(i,{withTypes:()=>i}),i}var Pi=Ple(),kle=(s,n)=>s===n;function Lle(s=Jf){const n=s===Jf?wq:Q2(s),i=(a,l={})=>{const{equalityFn:p=kle}=typeof l=="function"?{equalityFn:l}:l,_=n(),{store:T,subscription:w,getServerState:C}=_;F.useRef(!0);const O=F.useCallback({[a.name](U){return a(U)}}[a.name],[a]),k=yle.useSyncExternalStoreWithSelector(w.addNestedSub,T.getState,C||T.getState,O,p);return F.useDebugValue(k),k};return Object.assign(i,{withTypes:()=>i}),i}var hr=Lle();function Ba(s){return`Minified Redux error #${s}; visit https://redux.js.org/Errors?code=${s} for the full message or use the non-minified dev environment for full errors. `}var Mle=typeof Symbol=="function"&&Symbol.observable||"@@observable",e8=Mle,UL=()=>Math.random().toString(36).substring(7).split("").join("."),jle={INIT:`@@redux/INIT${UL()}`,REPLACE:`@@redux/REPLACE${UL()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${UL()}`},fO=jle;function $2(s){if(typeof s!="object"||s===null)return!1;let n=s;for(;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return Object.getPrototypeOf(s)===n||Object.getPrototypeOf(s)===null}function Cq(s,n,i){if(typeof s!="function")throw new Error(Ba(2));if(typeof n=="function"&&typeof i=="function"||typeof i=="function"&&typeof arguments[3]=="function")throw new Error(Ba(0));if(typeof n=="function"&&typeof i>"u"&&(i=n,n=void 0),typeof i<"u"){if(typeof i!="function")throw new Error(Ba(1));return i(Cq)(s,n)}let a=s,l=n,p=new Map,_=p,T=0,w=!1;function C(){_===p&&(_=new Map,p.forEach((X,ie)=>{_.set(ie,X)}))}function O(){if(w)throw new Error(Ba(3));return l}function k(X){if(typeof X!="function")throw new Error(Ba(4));if(w)throw new Error(Ba(5));let ie=!0;C();const oe=T++;return _.set(oe,X),function(){if(ie){if(w)throw new Error(Ba(6));ie=!1,C(),_.delete(oe),p=null}}}function U(X){if(!$2(X))throw new Error(Ba(7));if(typeof X.type>"u")throw new Error(Ba(8));if(typeof X.type!="string")throw new Error(Ba(17));if(w)throw new Error(Ba(9));try{w=!0,l=a(l,X)}finally{w=!1}return(p=_).forEach(oe=>{oe()}),X}function G(X){if(typeof X!="function")throw new Error(Ba(10));a=X,U({type:fO.REPLACE})}function z(){const X=k;return{subscribe(ie){if(typeof ie!="object"||ie===null)throw new Error(Ba(11));function oe(){const _e=ie;_e.next&&_e.next(O())}return oe(),{unsubscribe:X(oe)}},[e8](){return this}}}return U({type:fO.INIT}),{dispatch:U,subscribe:k,getState:O,replaceReducer:G,[e8]:z}}function Ule(s){Object.keys(s).forEach(n=>{const i=s[n];if(typeof i(void 0,{type:fO.INIT})>"u")throw new Error(Ba(12));if(typeof i(void 0,{type:fO.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Ba(13))})}function Vle(s){const n=Object.keys(s),i={};for(let p=0;p<n.length;p++){const _=n[p];typeof s[_]=="function"&&(i[_]=s[_])}const a=Object.keys(i);let l;try{Ule(i)}catch(p){l=p}return function(_={},T){if(l)throw l;let w=!1;const C={};for(let O=0;O<a.length;O++){const k=a[O],U=i[k],G=_[k],z=U(G,T);if(typeof z>"u")throw T&&T.type,new Error(Ba(14));C[k]=z,w=w||z!==G}return w=w||a.length!==Object.keys(_).length,w?C:_}}function mO(...s){return s.length===0?n=>n:s.length===1?s[0]:s.reduce((n,i)=>(...a)=>n(i(...a)))}function Fle(...s){return n=>(i,a)=>{const l=n(i,a);let p=()=>{throw new Error(Ba(15))};const _={getState:l.getState,dispatch:(w,...C)=>p(w,...C)},T=s.map(w=>w(_));return p=mO(...T)(l.dispatch),{...l,dispatch:p}}}function Ble(s){return $2(s)&&"type"in s&&typeof s.type=="string"}var Aq=Symbol.for("immer-nothing"),t8=Symbol.for("immer-draftable"),Hc=Symbol.for("immer-state");function Sd(s,...n){throw new Error(`[Immer] minified error nr: ${s}. Full error at: https://bit.ly/3cXEKWf`)}var Uv=Object.getPrototypeOf;function I_(s){return!!s&&!!s[Hc]}function up(s){var n;return s?Iq(s)||Array.isArray(s)||!!s[t8]||!!((n=s.constructor)!=null&&n[t8])||rD(s)||iD(s):!1}var Hle=Object.prototype.constructor.toString();function Iq(s){if(!s||typeof s!="object")return!1;const n=Uv(s);if(n===null)return!0;const i=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return i===Object?!0:typeof i=="function"&&Function.toString.call(i)===Hle}function gO(s,n){nD(s)===0?Reflect.ownKeys(s).forEach(i=>{n(i,s[i],s)}):s.forEach((i,a)=>n(a,i,s))}function nD(s){const n=s[Hc];return n?n.type_:Array.isArray(s)?1:rD(s)?2:iD(s)?3:0}function FM(s,n){return nD(s)===2?s.has(n):Object.prototype.hasOwnProperty.call(s,n)}function Nq(s,n,i){const a=nD(s);a===2?s.set(n,i):a===3?s.add(i):s[n]=i}function Gle(s,n){return s===n?s!==0||1/s===1/n:s!==s&&n!==n}function rD(s){return s instanceof Map}function iD(s){return s instanceof Set}function a_(s){return s.copy_||s.base_}function BM(s,n){if(rD(s))return new Map(s);if(iD(s))return new Set(s);if(Array.isArray(s))return Array.prototype.slice.call(s);const i=Iq(s);if(n===!0||n==="class_only"&&!i){const a=Object.getOwnPropertyDescriptors(s);delete a[Hc];let l=Reflect.ownKeys(a);for(let p=0;p<l.length;p++){const _=l[p],T=a[_];T.writable===!1&&(T.writable=!0,T.configurable=!0),(T.get||T.set)&&(a[_]={configurable:!0,writable:!0,enumerable:T.enumerable,value:s[_]})}return Object.create(Uv(s),a)}else{const a=Uv(s);if(a!==null&&i)return{...s};const l=Object.create(a);return Object.assign(l,s)}}function J2(s,n=!1){return sD(s)||I_(s)||!up(s)||(nD(s)>1&&(s.set=s.add=s.clear=s.delete=Wle),Object.freeze(s),n&&Object.entries(s).forEach(([i,a])=>J2(a,!0))),s}function Wle(){Sd(2)}function sD(s){return Object.isFrozen(s)}var zle={};function N_(s){const n=zle[s];return n||Sd(0,s),n}var t0;function Oq(){return t0}function Yle(s,n){return{drafts_:[],parent_:s,immer_:n,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function n8(s,n){n&&(N_("Patches"),s.patches_=[],s.inversePatches_=[],s.patchListener_=n)}function HM(s){GM(s),s.drafts_.forEach(qle),s.drafts_=null}function GM(s){s===t0&&(t0=s.parent_)}function r8(s){return t0=Yle(t0,s)}function qle(s){const n=s[Hc];n.type_===0||n.type_===1?n.revoke_():n.revoked_=!0}function i8(s,n){n.unfinalizedDrafts_=n.drafts_.length;const i=n.drafts_[0];return s!==void 0&&s!==i?(i[Hc].modified_&&(HM(n),Sd(4)),up(s)&&(s=_O(n,s),n.parent_||EO(n,s)),n.patches_&&N_("Patches").generateReplacementPatches_(i[Hc].base_,s,n.patches_,n.inversePatches_)):s=_O(n,i,[]),HM(n),n.patches_&&n.patchListener_(n.patches_,n.inversePatches_),s!==Aq?s:void 0}function _O(s,n,i){if(sD(n))return n;const a=n[Hc];if(!a)return gO(n,(l,p)=>s8(s,a,n,l,p,i)),n;if(a.scope_!==s)return n;if(!a.modified_)return EO(s,a.base_,!0),a.base_;if(!a.finalized_){a.finalized_=!0,a.scope_.unfinalizedDrafts_--;const l=a.copy_;let p=l,_=!1;a.type_===3&&(p=new Set(l),l.clear(),_=!0),gO(p,(T,w)=>s8(s,a,l,T,w,i,_)),EO(s,l,!1),i&&s.patches_&&N_("Patches").generatePatches_(a,i,s.patches_,s.inversePatches_)}return a.copy_}function s8(s,n,i,a,l,p,_){if(I_(l)){const T=p&&n&&n.type_!==3&&!FM(n.assigned_,a)?p.concat(a):void 0,w=_O(s,l,T);if(Nq(i,a,w),I_(w))s.canAutoFreeze_=!1;else return}else _&&i.add(l);if(up(l)&&!sD(l)){if(!s.immer_.autoFreeze_&&s.unfinalizedDrafts_<1)return;_O(s,l),(!n||!n.scope_.parent_)&&typeof a!="symbol"&&Object.prototype.propertyIsEnumerable.call(i,a)&&EO(s,l)}}function EO(s,n,i=!1){!s.parent_&&s.immer_.autoFreeze_&&s.canAutoFreeze_&&J2(n,i)}function Kle(s,n){const i=Array.isArray(s),a={type_:i?1:0,scope_:n?n.scope_:Oq(),modified_:!1,finalized_:!1,assigned_:{},parent_:n,base_:s,draft_:null,copy_:null,revoke_:null,isManual_:!1};let l=a,p=Z2;i&&(l=[a],p=n0);const{revoke:_,proxy:T}=Proxy.revocable(l,p);return a.draft_=T,a.revoke_=_,T}var Z2={get(s,n){if(n===Hc)return s;const i=a_(s);if(!FM(i,n))return Xle(s,i,n);const a=i[n];return s.finalized_||!up(a)?a:a===VL(s.base_,n)?(FL(s),s.copy_[n]=zM(a,s)):a},has(s,n){return n in a_(s)},ownKeys(s){return Reflect.ownKeys(a_(s))},set(s,n,i){const a=Dq(a_(s),n);if(a!=null&&a.set)return a.set.call(s.draft_,i),!0;if(!s.modified_){const l=VL(a_(s),n),p=l==null?void 0:l[Hc];if(p&&p.base_===i)return s.copy_[n]=i,s.assigned_[n]=!1,!0;if(Gle(i,l)&&(i!==void 0||FM(s.base_,n)))return!0;FL(s),WM(s)}return s.copy_[n]===i&&(i!==void 0||n in s.copy_)||Number.isNaN(i)&&Number.isNaN(s.copy_[n])||(s.copy_[n]=i,s.assigned_[n]=!0),!0},deleteProperty(s,n){return VL(s.base_,n)!==void 0||n in s.base_?(s.assigned_[n]=!1,FL(s),WM(s)):delete s.assigned_[n],s.copy_&&delete s.copy_[n],!0},getOwnPropertyDescriptor(s,n){const i=a_(s),a=Reflect.getOwnPropertyDescriptor(i,n);return a&&{writable:!0,configurable:s.type_!==1||n!=="length",enumerable:a.enumerable,value:i[n]}},defineProperty(){Sd(11)},getPrototypeOf(s){return Uv(s.base_)},setPrototypeOf(){Sd(12)}},n0={};gO(Z2,(s,n)=>{n0[s]=function(){return arguments[0]=arguments[0][0],n.apply(this,arguments)}});n0.deleteProperty=function(s,n){return n0.set.call(this,s,n,void 0)};n0.set=function(s,n,i){return Z2.set.call(this,s[0],n,i,s[0])};function VL(s,n){const i=s[Hc];return(i?a_(i):s)[n]}function Xle(s,n,i){var l;const a=Dq(n,i);return a?"value"in a?a.value:(l=a.get)==null?void 0:l.call(s.draft_):void 0}function Dq(s,n){if(!(n in s))return;let i=Uv(s);for(;i;){const a=Object.getOwnPropertyDescriptor(i,n);if(a)return a;i=Uv(i)}}function WM(s){s.modified_||(s.modified_=!0,s.parent_&&WM(s.parent_))}function FL(s){s.copy_||(s.copy_=BM(s.base_,s.scope_.immer_.useStrictShallowCopy_))}var Qle=class{constructor(s){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(n,i,a)=>{if(typeof n=="function"&&typeof i!="function"){const p=i;i=n;const _=this;return function(w=p,...C){return _.produce(w,O=>i.call(this,O,...C))}}typeof i!="function"&&Sd(6),a!==void 0&&typeof a!="function"&&Sd(7);let l;if(up(n)){const p=r8(this),_=zM(n,void 0);let T=!0;try{l=i(_),T=!1}finally{T?HM(p):GM(p)}return n8(p,a),i8(l,p)}else if(!n||typeof n!="object"){if(l=i(n),l===void 0&&(l=n),l===Aq&&(l=void 0),this.autoFreeze_&&J2(l,!0),a){const p=[],_=[];N_("Patches").generateReplacementPatches_(n,l,p,_),a(p,_)}return l}else Sd(1,n)},this.produceWithPatches=(n,i)=>{if(typeof n=="function")return(_,...T)=>this.produceWithPatches(_,w=>n(w,...T));let a,l;return[this.produce(n,i,(_,T)=>{a=_,l=T}),a,l]},typeof(s==null?void 0:s.autoFreeze)=="boolean"&&this.setAutoFreeze(s.autoFreeze),typeof(s==null?void 0:s.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(s.useStrictShallowCopy)}createDraft(s){up(s)||Sd(8),I_(s)&&(s=$le(s));const n=r8(this),i=zM(s,void 0);return i[Hc].isManual_=!0,GM(n),i}finishDraft(s,n){const i=s&&s[Hc];(!i||!i.isManual_)&&Sd(9);const{scope_:a}=i;return n8(a,n),i8(void 0,a)}setAutoFreeze(s){this.autoFreeze_=s}setUseStrictShallowCopy(s){this.useStrictShallowCopy_=s}applyPatches(s,n){let i;for(i=n.length-1;i>=0;i--){const l=n[i];if(l.path.length===0&&l.op==="replace"){s=l.value;break}}i>-1&&(n=n.slice(i+1));const a=N_("Patches").applyPatches_;return I_(s)?a(s,n):this.produce(s,l=>a(l,n))}};function zM(s,n){const i=rD(s)?N_("MapSet").proxyMap_(s,n):iD(s)?N_("MapSet").proxySet_(s,n):Kle(s,n);return(n?n.scope_:Oq()).drafts_.push(i),i}function $le(s){return I_(s)||Sd(10,s),xq(s)}function xq(s){if(!up(s)||sD(s))return s;const n=s[Hc];let i;if(n){if(!n.modified_)return n.base_;n.finalized_=!0,i=BM(s,n.scope_.immer_.useStrictShallowCopy_)}else i=BM(s,!0);return gO(i,(a,l)=>{Nq(i,a,xq(l))}),n&&(n.finalized_=!1),i}var Gc=new Qle,Pq=Gc.produce;Gc.produceWithPatches.bind(Gc);Gc.setAutoFreeze.bind(Gc);Gc.setUseStrictShallowCopy.bind(Gc);Gc.applyPatches.bind(Gc);Gc.createDraft.bind(Gc);Gc.finishDraft.bind(Gc);function kq(s){return({dispatch:i,getState:a})=>l=>p=>typeof p=="function"?p(i,a,s):l(p)}var Jle=kq(),Zle=kq,ede=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?mO:mO.apply(null,arguments)},tde=s=>s&&typeof s.match=="function";function Vw(s,n){function i(...a){if(n){let l=n(...a);if(!l)throw new Error(tp(0));return{type:s,payload:l.payload,..."meta"in l&&{meta:l.meta},..."error"in l&&{error:l.error}}}return{type:s,payload:a[0]}}return i.toString=()=>`${s}`,i.type=s,i.match=a=>Ble(a)&&a.type===s,i}var Lq=class Dw extends Array{constructor(...n){super(...n),Object.setPrototypeOf(this,Dw.prototype)}static get[Symbol.species](){return Dw}concat(...n){return super.concat.apply(this,n)}prepend(...n){return n.length===1&&Array.isArray(n[0])?new Dw(...n[0].concat(this)):new Dw(...n.concat(this))}};function a8(s){return up(s)?Pq(s,()=>{}):s}function JI(s,n,i){return s.has(n)?s.get(n):s.set(n,i(n)).get(n)}function nde(s){return typeof s=="boolean"}var rde=()=>function(n){const{thunk:i=!0,immutableCheck:a=!0,serializableCheck:l=!0,actionCreatorCheck:p=!0}=n??{};let _=new Lq;return i&&(nde(i)?_.push(Jle):_.push(Zle(i.extraArgument))),_},ide="RTK_autoBatch",o8=s=>n=>{setTimeout(n,s)},sde=(s={type:"raf"})=>n=>(...i)=>{const a=n(...i);let l=!0,p=!1,_=!1;const T=new Set,w=s.type==="tick"?queueMicrotask:s.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:o8(10):s.type==="callback"?s.queueNotification:o8(s.timeout),C=()=>{_=!1,p&&(p=!1,T.forEach(O=>O()))};return Object.assign({},a,{subscribe(O){const k=()=>l&&O(),U=a.subscribe(k);return T.add(O),()=>{U(),T.delete(O)}},dispatch(O){var k;try{return l=!((k=O==null?void 0:O.meta)!=null&&k[ide]),p=!l,p&&(_||(_=!0,w(C))),a.dispatch(O)}finally{l=!0}}})},ade=s=>function(i){const{autoBatch:a=!0}=i??{};let l=new Lq(s);return a&&l.push(sde(typeof a=="object"?a:void 0)),l};function ode(s){const n=rde(),{reducer:i=void 0,middleware:a,devTools:l=!0,preloadedState:p=void 0,enhancers:_=void 0}=s||{};let T;if(typeof i=="function")T=i;else if($2(i))T=Vle(i);else throw new Error(tp(1));let w;typeof a=="function"?w=a(n):w=n();let C=mO;l&&(C=ede({trace:!1,...typeof l=="object"&&l}));const O=Fle(...w),k=ade(O);let U=typeof _=="function"?_(k):k();const G=C(...U);return Cq(T,p,G)}function Mq(s){const n={},i=[];let a;const l={addCase(p,_){const T=typeof p=="string"?p:p.type;if(!T)throw new Error(tp(28));if(T in n)throw new Error(tp(29));return n[T]=_,l},addMatcher(p,_){return i.push({matcher:p,reducer:_}),l},addDefaultCase(p){return a=p,l}};return s(l),[n,i,a]}function cde(s){return typeof s=="function"}function lde(s,n){let[i,a,l]=Mq(n),p;if(cde(s))p=()=>a8(s());else{const T=a8(s);p=()=>T}function _(T=p(),w){let C=[i[w.type],...a.filter(({matcher:O})=>O(w)).map(({reducer:O})=>O)];return C.filter(O=>!!O).length===0&&(C=[l]),C.reduce((O,k)=>{if(k)if(I_(O)){const G=k(O,w);return G===void 0?O:G}else{if(up(O))return Pq(O,U=>k(U,w));{const U=k(O,w);if(U===void 0){if(O===null)return O;throw Error("A case reducer on a non-draftable value must not return undefined")}return U}}return O},T)}return _.getInitialState=p,_}var dde=(s,n)=>tde(s)?s.match(n):s(n);function ude(...s){return n=>s.some(i=>dde(i,n))}var hde="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",pde=(s=21)=>{let n="",i=s;for(;i--;)n+=hde[Math.random()*64|0];return n},fde=["name","message","stack","code"],BL=class{constructor(s,n){Kt(this,"_type");this.payload=s,this.meta=n}},c8=class{constructor(s,n){Kt(this,"_type");this.payload=s,this.meta=n}},mde=s=>{if(typeof s=="object"&&s!==null){const n={};for(const i of fde)typeof s[i]=="string"&&(n[i]=s[i]);return n}return{message:String(s)}},l8="External signal was aborted",Zt=(()=>{function s(n,i,a){const l=Vw(n+"/fulfilled",(w,C,O,k)=>({payload:w,meta:{...k||{},arg:O,requestId:C,requestStatus:"fulfilled"}})),p=Vw(n+"/pending",(w,C,O)=>({payload:void 0,meta:{...O||{},arg:C,requestId:w,requestStatus:"pending"}})),_=Vw(n+"/rejected",(w,C,O,k,U)=>({payload:k,error:(a&&a.serializeError||mde)(w||"Rejected"),meta:{...U||{},arg:O,requestId:C,rejectedWithValue:!!k,requestStatus:"rejected",aborted:(w==null?void 0:w.name)==="AbortError",condition:(w==null?void 0:w.name)==="ConditionError"}}));function T(w,{signal:C}={}){return(O,k,U)=>{const G=a!=null&&a.idGenerator?a.idGenerator(w):pde(),z=new AbortController;let J,X;function ie(ce){X=ce,z.abort()}C&&(C.aborted?ie(l8):C.addEventListener("abort",()=>ie(l8),{once:!0}));const oe=async function(){var se,be;let ce;try{let ee=(se=a==null?void 0:a.condition)==null?void 0:se.call(a,w,{getState:k,extra:U});if(_de(ee)&&(ee=await ee),ee===!1||z.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const Q=new Promise((q,ae)=>{J=()=>{ae({name:"AbortError",message:X||"Aborted"})},z.signal.addEventListener("abort",J)});O(p(G,w,(be=a==null?void 0:a.getPendingMeta)==null?void 0:be.call(a,{requestId:G,arg:w},{getState:k,extra:U}))),ce=await Promise.race([Q,Promise.resolve(i(w,{dispatch:O,getState:k,extra:U,requestId:G,signal:z.signal,abort:ie,rejectWithValue:(q,ae)=>new BL(q,ae),fulfillWithValue:(q,ae)=>new c8(q,ae)})).then(q=>{if(q instanceof BL)throw q;return q instanceof c8?l(q.payload,G,w,q.meta):l(q,G,w)})])}catch(ee){ce=ee instanceof BL?_(null,G,w,ee.payload,ee.meta):_(ee,G,w)}finally{J&&z.signal.removeEventListener("abort",J)}return a&&!a.dispatchConditionRejection&&_.match(ce)&&ce.meta.condition||O(ce),ce}();return Object.assign(oe,{abort:ie,requestId:G,arg:w,unwrap(){return oe.then(gde)}})}}return Object.assign(T,{pending:p,rejected:_,fulfilled:l,settled:ude(_,l),typePrefix:n})}return s.withTypes=()=>s,s})();function gde(s){if(s.meta&&s.meta.rejectedWithValue)throw s.payload;if(s.error)throw s.error;return s.payload}function _de(s){return s!==null&&typeof s=="object"&&typeof s.then=="function"}var Ede=Symbol.for("rtk-slice-createasyncthunk");function yde(s,n){return`${s}/${n}`}function vde({creators:s}={}){var i;const n=(i=s==null?void 0:s.asyncThunk)==null?void 0:i[Ede];return function(l){const{name:p,reducerPath:_=p}=l;if(!p)throw new Error(tp(11));const T=(typeof l.reducers=="function"?l.reducers(Tde()):l.reducers)||{},w=Object.keys(T),C={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},O={addCase(_e,se){const be=typeof _e=="string"?_e:_e.type;if(!be)throw new Error(tp(12));if(be in C.sliceCaseReducersByType)throw new Error(tp(13));return C.sliceCaseReducersByType[be]=se,O},addMatcher(_e,se){return C.sliceMatchers.push({matcher:_e,reducer:se}),O},exposeAction(_e,se){return C.actionCreators[_e]=se,O},exposeCaseReducer(_e,se){return C.sliceCaseReducersByName[_e]=se,O}};w.forEach(_e=>{const se=T[_e],be={reducerName:_e,type:yde(p,_e),createNotation:typeof l.reducers=="function"};wde(se)?Cde(be,se,O,n):bde(be,se,O)});function k(){const[_e={},se=[],be=void 0]=typeof l.extraReducers=="function"?Mq(l.extraReducers):[l.extraReducers],ee={..._e,...C.sliceCaseReducersByType};return lde(l.initialState,Q=>{for(let q in ee)Q.addCase(q,ee[q]);for(let q of C.sliceMatchers)Q.addMatcher(q.matcher,q.reducer);for(let q of se)Q.addMatcher(q.matcher,q.reducer);be&&Q.addDefaultCase(be)})}const U=_e=>_e,G=new Map,z=new WeakMap;let J;function X(_e,se){return J||(J=k()),J(_e,se)}function ie(){return J||(J=k()),J.getInitialState()}function oe(_e,se=!1){function be(Q){let q=Q[_e];return typeof q>"u"&&se&&(q=JI(z,be,ie)),q}function ee(Q=U){const q=JI(G,se,()=>new WeakMap);return JI(q,Q,()=>{const ae={};for(const[re,fe]of Object.entries(l.selectors??{}))ae[re]=Sde(fe,Q,()=>JI(z,Q,ie),se);return ae})}return{reducerPath:_e,getSelectors:ee,get selectors(){return ee(be)},selectSlice:be}}const ce={name:p,reducer:X,actions:C.actionCreators,caseReducers:C.sliceCaseReducersByName,getInitialState:ie,...oe(_),injectInto(_e,{reducerPath:se,...be}={}){const ee=se??_;return _e.inject({reducerPath:ee,reducer:X},be),{...ce,...oe(ee,!0)}}};return ce}}function Sde(s,n,i,a){function l(p,..._){let T=n(p);return typeof T>"u"&&a&&(T=i()),s(T,..._)}return l.unwrapped=s,l}var om=vde();function Tde(){function s(n,i){return{_reducerDefinitionType:"asyncThunk",payloadCreator:n,...i}}return s.withTypes=()=>s,{reducer(n){return Object.assign({[n.name](...i){return n(...i)}}[n.name],{_reducerDefinitionType:"reducer"})},preparedReducer(n,i){return{_reducerDefinitionType:"reducerWithPrepare",prepare:n,reducer:i}},asyncThunk:s}}function bde({type:s,reducerName:n,createNotation:i},a,l){let p,_;if("reducer"in a){if(i&&!Rde(a))throw new Error(tp(17));p=a.reducer,_=a.prepare}else p=a;l.addCase(s,p).exposeCaseReducer(n,p).exposeAction(n,_?Vw(s,_):Vw(s))}function wde(s){return s._reducerDefinitionType==="asyncThunk"}function Rde(s){return s._reducerDefinitionType==="reducerWithPrepare"}function Cde({type:s,reducerName:n},i,a,l){if(!l)throw new Error(tp(18));const{payloadCreator:p,fulfilled:_,pending:T,rejected:w,settled:C,options:O}=i,k=l(s,p,O);a.exposeAction(n,k),_&&a.addCase(k.fulfilled,_),T&&a.addCase(k.pending,T),w&&a.addCase(k.rejected,w),C&&a.addMatcher(k.settled,C),a.exposeCaseReducer(n,{fulfilled:_||ZI,pending:T||ZI,rejected:w||ZI,settled:C||ZI})}function ZI(){}function tp(s){return`Minified Redux Toolkit error #${s}; visit https://redux-toolkit.js.org/Errors?code=${s} for the full message or use the non-minified dev environment for full errors. `}function jq(s,n){return function(){return s.apply(n,arguments)}}const{toString:Ade}=Object.prototype,{getPrototypeOf:ej}=Object,{iterator:aD,toStringTag:Uq}=Symbol,oD=(s=>n=>{const i=Ade.call(n);return s[i]||(s[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Nd=s=>(s=s.toLowerCase(),n=>oD(n)===s),cD=s=>n=>typeof n===s,{isArray:iS}=Array,r0=cD("undefined");function Ide(s){return s!==null&&!r0(s)&&s.constructor!==null&&!r0(s.constructor)&&uc(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const Vq=Nd("ArrayBuffer");function Nde(s){let n;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?n=ArrayBuffer.isView(s):n=s&&s.buffer&&Vq(s.buffer),n}const Ode=cD("string"),uc=cD("function"),Fq=cD("number"),lD=s=>s!==null&&typeof s=="object",Dde=s=>s===!0||s===!1,EN=s=>{if(oD(s)!=="object")return!1;const n=ej(s);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Uq in s)&&!(aD in s)},xde=Nd("Date"),Pde=Nd("File"),kde=Nd("Blob"),Lde=Nd("FileList"),Mde=s=>lD(s)&&uc(s.pipe),jde=s=>{let n;return s&&(typeof FormData=="function"&&s instanceof FormData||uc(s.append)&&((n=oD(s))==="formdata"||n==="object"&&uc(s.toString)&&s.toString()==="[object FormData]"))},Ude=Nd("URLSearchParams"),[Vde,Fde,Bde,Hde]=["ReadableStream","Request","Response","Headers"].map(Nd),Gde=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function S0(s,n,{allOwnKeys:i=!1}={}){if(s===null||typeof s>"u")return;let a,l;if(typeof s!="object"&&(s=[s]),iS(s))for(a=0,l=s.length;a<l;a++)n.call(null,s[a],a,s);else{const p=i?Object.getOwnPropertyNames(s):Object.keys(s),_=p.length;let T;for(a=0;a<_;a++)T=p[a],n.call(null,s[T],T,s)}}function Bq(s,n){n=n.toLowerCase();const i=Object.keys(s);let a=i.length,l;for(;a-- >0;)if(l=i[a],n===l.toLowerCase())return l;return null}const p_=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Hq=s=>!r0(s)&&s!==p_;function YM(){const{caseless:s}=Hq(this)&&this||{},n={},i=(a,l)=>{const p=s&&Bq(n,l)||l;EN(n[p])&&EN(a)?n[p]=YM(n[p],a):EN(a)?n[p]=YM({},a):iS(a)?n[p]=a.slice():n[p]=a};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&S0(arguments[a],i);return n}const Wde=(s,n,i,{allOwnKeys:a}={})=>(S0(n,(l,p)=>{i&&uc(l)?s[p]=jq(l,i):s[p]=l},{allOwnKeys:a}),s),zde=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),Yde=(s,n,i,a)=>{s.prototype=Object.create(n.prototype,a),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:n.prototype}),i&&Object.assign(s.prototype,i)},qde=(s,n,i,a)=>{let l,p,_;const T={};if(n=n||{},s==null)return n;do{for(l=Object.getOwnPropertyNames(s),p=l.length;p-- >0;)_=l[p],(!a||a(_,s,n))&&!T[_]&&(n[_]=s[_],T[_]=!0);s=i!==!1&&ej(s)}while(s&&(!i||i(s,n))&&s!==Object.prototype);return n},Kde=(s,n,i)=>{s=String(s),(i===void 0||i>s.length)&&(i=s.length),i-=n.length;const a=s.indexOf(n,i);return a!==-1&&a===i},Xde=s=>{if(!s)return null;if(iS(s))return s;let n=s.length;if(!Fq(n))return null;const i=new Array(n);for(;n-- >0;)i[n]=s[n];return i},Qde=(s=>n=>s&&n instanceof s)(typeof Uint8Array<"u"&&ej(Uint8Array)),$de=(s,n)=>{const a=(s&&s[aD]).call(s);let l;for(;(l=a.next())&&!l.done;){const p=l.value;n.call(s,p[0],p[1])}},Jde=(s,n)=>{let i;const a=[];for(;(i=s.exec(n))!==null;)a.push(i);return a},Zde=Nd("HTMLFormElement"),eue=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,a,l){return a.toUpperCase()+l}),d8=(({hasOwnProperty:s})=>(n,i)=>s.call(n,i))(Object.prototype),tue=Nd("RegExp"),Gq=(s,n)=>{const i=Object.getOwnPropertyDescriptors(s),a={};S0(i,(l,p)=>{let _;(_=n(l,p,s))!==!1&&(a[p]=_||l)}),Object.defineProperties(s,a)},nue=s=>{Gq(s,(n,i)=>{if(uc(s)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const a=s[i];if(uc(a)){if(n.enumerable=!1,"writable"in n){n.writable=!1;return}n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},rue=(s,n)=>{const i={},a=l=>{l.forEach(p=>{i[p]=!0})};return iS(s)?a(s):a(String(s).split(n)),i},iue=()=>{},sue=(s,n)=>s!=null&&Number.isFinite(s=+s)?s:n;function aue(s){return!!(s&&uc(s.append)&&s[Uq]==="FormData"&&s[aD])}const oue=s=>{const n=new Array(10),i=(a,l)=>{if(lD(a)){if(n.indexOf(a)>=0)return;if(!("toJSON"in a)){n[l]=a;const p=iS(a)?[]:{};return S0(a,(_,T)=>{const w=i(_,l+1);!r0(w)&&(p[T]=w)}),n[l]=void 0,p}}return a};return i(s,0)},cue=Nd("AsyncFunction"),lue=s=>s&&(lD(s)||uc(s))&&uc(s.then)&&uc(s.catch),Wq=((s,n)=>s?setImmediate:n?((i,a)=>(p_.addEventListener("message",({source:l,data:p})=>{l===p_&&p===i&&a.length&&a.shift()()},!1),l=>{a.push(l),p_.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",uc(p_.postMessage)),due=typeof queueMicrotask<"u"?queueMicrotask.bind(p_):typeof process<"u"&&process.nextTick||Wq,uue=s=>s!=null&&uc(s[aD]),nt={isArray:iS,isArrayBuffer:Vq,isBuffer:Ide,isFormData:jde,isArrayBufferView:Nde,isString:Ode,isNumber:Fq,isBoolean:Dde,isObject:lD,isPlainObject:EN,isReadableStream:Vde,isRequest:Fde,isResponse:Bde,isHeaders:Hde,isUndefined:r0,isDate:xde,isFile:Pde,isBlob:kde,isRegExp:tue,isFunction:uc,isStream:Mde,isURLSearchParams:Ude,isTypedArray:Qde,isFileList:Lde,forEach:S0,merge:YM,extend:Wde,trim:Gde,stripBOM:zde,inherits:Yde,toFlatObject:qde,kindOf:oD,kindOfTest:Nd,endsWith:Kde,toArray:Xde,forEachEntry:$de,matchAll:Jde,isHTMLForm:Zde,hasOwnProperty:d8,hasOwnProp:d8,reduceDescriptors:Gq,freezeMethods:nue,toObjectSet:rue,toCamelCase:eue,noop:iue,toFiniteNumber:sue,findKey:Bq,global:p_,isContextDefined:Hq,isSpecCompliantForm:aue,toJSONObject:oue,isAsyncFn:cue,isThenable:lue,setImmediate:Wq,asap:due,isIterable:uue};function nr(s,n,i,a,l){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",n&&(this.code=n),i&&(this.config=i),a&&(this.request=a),l&&(this.response=l,this.status=l.status?l.status:null)}nt.inherits(nr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:nt.toJSONObject(this.config),code:this.code,status:this.status}}});const zq=nr.prototype,Yq={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{Yq[s]={value:s}});Object.defineProperties(nr,Yq);Object.defineProperty(zq,"isAxiosError",{value:!0});nr.from=(s,n,i,a,l,p)=>{const _=Object.create(zq);return nt.toFlatObject(s,_,function(w){return w!==Error.prototype},T=>T!=="isAxiosError"),nr.call(_,s.message,n,i,a,l),_.cause=s,_.name=s.name,p&&Object.assign(_,p),_};const hue=null;function qM(s){return nt.isPlainObject(s)||nt.isArray(s)}function qq(s){return nt.endsWith(s,"[]")?s.slice(0,-2):s}function u8(s,n,i){return s?s.concat(n).map(function(l,p){return l=qq(l),!i&&p?"["+l+"]":l}).join(i?".":""):n}function pue(s){return nt.isArray(s)&&!s.some(qM)}const fue=nt.toFlatObject(nt,{},null,function(n){return/^is[A-Z]/.test(n)});function dD(s,n,i){if(!nt.isObject(s))throw new TypeError("target must be an object");n=n||new FormData,i=nt.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(J,X){return!nt.isUndefined(X[J])});const a=i.metaTokens,l=i.visitor||O,p=i.dots,_=i.indexes,w=(i.Blob||typeof Blob<"u"&&Blob)&&nt.isSpecCompliantForm(n);if(!nt.isFunction(l))throw new TypeError("visitor must be a function");function C(z){if(z===null)return"";if(nt.isDate(z))return z.toISOString();if(!w&&nt.isBlob(z))throw new nr("Blob is not supported. Use a Buffer instead.");return nt.isArrayBuffer(z)||nt.isTypedArray(z)?w&&typeof Blob=="function"?new Blob([z]):Buffer.from(z):z}function O(z,J,X){let ie=z;if(z&&!X&&typeof z=="object"){if(nt.endsWith(J,"{}"))J=a?J:J.slice(0,-2),z=JSON.stringify(z);else if(nt.isArray(z)&&pue(z)||(nt.isFileList(z)||nt.endsWith(J,"[]"))&&(ie=nt.toArray(z)))return J=qq(J),ie.forEach(function(ce,_e){!(nt.isUndefined(ce)||ce===null)&&n.append(_===!0?u8([J],_e,p):_===null?J:J+"[]",C(ce))}),!1}return qM(z)?!0:(n.append(u8(X,J,p),C(z)),!1)}const k=[],U=Object.assign(fue,{defaultVisitor:O,convertValue:C,isVisitable:qM});function G(z,J){if(!nt.isUndefined(z)){if(k.indexOf(z)!==-1)throw Error("Circular reference detected in "+J.join("."));k.push(z),nt.forEach(z,function(ie,oe){(!(nt.isUndefined(ie)||ie===null)&&l.call(n,ie,nt.isString(oe)?oe.trim():oe,J,U))===!0&&G(ie,J?J.concat(oe):[oe])}),k.pop()}}if(!nt.isObject(s))throw new TypeError("data must be an object");return G(s),n}function h8(s){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(a){return n[a]})}function tj(s,n){this._pairs=[],s&&dD(s,this,n)}const Kq=tj.prototype;Kq.append=function(n,i){this._pairs.push([n,i])};Kq.toString=function(n){const i=n?function(a){return n.call(this,a,h8)}:h8;return this._pairs.map(function(l){return i(l[0])+"="+i(l[1])},"").join("&")};function mue(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Xq(s,n,i){if(!n)return s;const a=i&&i.encode||mue;nt.isFunction(i)&&(i={serialize:i});const l=i&&i.serialize;let p;if(l?p=l(n,i):p=nt.isURLSearchParams(n)?n.toString():new tj(n,i).toString(a),p){const _=s.indexOf("#");_!==-1&&(s=s.slice(0,_)),s+=(s.indexOf("?")===-1?"?":"&")+p}return s}class p8{constructor(){this.handlers=[]}use(n,i,a){return this.handlers.push({fulfilled:n,rejected:i,synchronous:a?a.synchronous:!1,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){nt.forEach(this.handlers,function(a){a!==null&&n(a)})}}const Qq={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},gue=typeof URLSearchParams<"u"?URLSearchParams:tj,_ue=typeof FormData<"u"?FormData:null,Eue=typeof Blob<"u"?Blob:null,yue={isBrowser:!0,classes:{URLSearchParams:gue,FormData:_ue,Blob:Eue},protocols:["http","https","file","blob","url","data"]},nj=typeof window<"u"&&typeof document<"u",KM=typeof navigator=="object"&&navigator||void 0,vue=nj&&(!KM||["ReactNative","NativeScript","NS"].indexOf(KM.product)<0),Sue=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Tue=nj&&window.location.href||"http://localhost",bue=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:nj,hasStandardBrowserEnv:vue,hasStandardBrowserWebWorkerEnv:Sue,navigator:KM,origin:Tue},Symbol.toStringTag,{value:"Module"})),ho={...bue,...yue};function wue(s,n){return dD(s,new ho.classes.URLSearchParams,Object.assign({visitor:function(i,a,l,p){return ho.isNode&&nt.isBuffer(i)?(this.append(a,i.toString("base64")),!1):p.defaultVisitor.apply(this,arguments)}},n))}function Rue(s){return nt.matchAll(/\w+|\[(\w*)]/g,s).map(n=>n[0]==="[]"?"":n[1]||n[0])}function Cue(s){const n={},i=Object.keys(s);let a;const l=i.length;let p;for(a=0;a<l;a++)p=i[a],n[p]=s[p];return n}function $q(s){function n(i,a,l,p){let _=i[p++];if(_==="__proto__")return!0;const T=Number.isFinite(+_),w=p>=i.length;return _=!_&&nt.isArray(l)?l.length:_,w?(nt.hasOwnProp(l,_)?l[_]=[l[_],a]:l[_]=a,!T):((!l[_]||!nt.isObject(l[_]))&&(l[_]=[]),n(i,a,l[_],p)&&nt.isArray(l[_])&&(l[_]=Cue(l[_])),!T)}if(nt.isFormData(s)&&nt.isFunction(s.entries)){const i={};return nt.forEachEntry(s,(a,l)=>{n(Rue(a),l,i,0)}),i}return null}function Aue(s,n,i){if(nt.isString(s))try{return(n||JSON.parse)(s),nt.trim(s)}catch(a){if(a.name!=="SyntaxError")throw a}return(i||JSON.stringify)(s)}const T0={transitional:Qq,adapter:["xhr","http","fetch"],transformRequest:[function(n,i){const a=i.getContentType()||"",l=a.indexOf("application/json")>-1,p=nt.isObject(n);if(p&&nt.isHTMLForm(n)&&(n=new FormData(n)),nt.isFormData(n))return l?JSON.stringify($q(n)):n;if(nt.isArrayBuffer(n)||nt.isBuffer(n)||nt.isStream(n)||nt.isFile(n)||nt.isBlob(n)||nt.isReadableStream(n))return n;if(nt.isArrayBufferView(n))return n.buffer;if(nt.isURLSearchParams(n))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let T;if(p){if(a.indexOf("application/x-www-form-urlencoded")>-1)return wue(n,this.formSerializer).toString();if((T=nt.isFileList(n))||a.indexOf("multipart/form-data")>-1){const w=this.env&&this.env.FormData;return dD(T?{"files[]":n}:n,w&&new w,this.formSerializer)}}return p||l?(i.setContentType("application/json",!1),Aue(n)):n}],transformResponse:[function(n){const i=this.transitional||T0.transitional,a=i&&i.forcedJSONParsing,l=this.responseType==="json";if(nt.isResponse(n)||nt.isReadableStream(n))return n;if(n&&nt.isString(n)&&(a&&!this.responseType||l)){const _=!(i&&i.silentJSONParsing)&&l;try{return JSON.parse(n)}catch(T){if(_)throw T.name==="SyntaxError"?nr.from(T,nr.ERR_BAD_RESPONSE,this,null,this.response):T}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ho.classes.FormData,Blob:ho.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};nt.forEach(["delete","get","head","post","put","patch"],s=>{T0.headers[s]={}});const Iue=nt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Nue=s=>{const n={};let i,a,l;return s&&s.split(`
`).forEach(function(_){l=_.indexOf(":"),i=_.substring(0,l).trim().toLowerCase(),a=_.substring(l+1).trim(),!(!i||n[i]&&Iue[i])&&(i==="set-cookie"?n[i]?n[i].push(a):n[i]=[a]:n[i]=n[i]?n[i]+", "+a:a)}),n},f8=Symbol("internals");function bw(s){return s&&String(s).trim().toLowerCase()}function yN(s){return s===!1||s==null?s:nt.isArray(s)?s.map(yN):String(s)}function Oue(s){const n=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=i.exec(s);)n[a[1]]=a[2];return n}const Due=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function HL(s,n,i,a,l){if(nt.isFunction(a))return a.call(this,n,i);if(l&&(n=i),!!nt.isString(n)){if(nt.isString(a))return n.indexOf(a)!==-1;if(nt.isRegExp(a))return a.test(n)}}function xue(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(n,i,a)=>i.toUpperCase()+a)}function Pue(s,n){const i=nt.toCamelCase(" "+n);["get","set","has"].forEach(a=>{Object.defineProperty(s,a+i,{value:function(l,p,_){return this[a].call(this,n,l,p,_)},configurable:!0})})}let hc=class{constructor(n){n&&this.set(n)}set(n,i,a){const l=this;function p(T,w,C){const O=bw(w);if(!O)throw new Error("header name must be a non-empty string");const k=nt.findKey(l,O);(!k||l[k]===void 0||C===!0||C===void 0&&l[k]!==!1)&&(l[k||w]=yN(T))}const _=(T,w)=>nt.forEach(T,(C,O)=>p(C,O,w));if(nt.isPlainObject(n)||n instanceof this.constructor)_(n,i);else if(nt.isString(n)&&(n=n.trim())&&!Due(n))_(Nue(n),i);else if(nt.isObject(n)&&nt.isIterable(n)){let T={},w,C;for(const O of n){if(!nt.isArray(O))throw TypeError("Object iterator must return a key-value pair");T[C=O[0]]=(w=T[C])?nt.isArray(w)?[...w,O[1]]:[w,O[1]]:O[1]}_(T,i)}else n!=null&&p(i,n,a);return this}get(n,i){if(n=bw(n),n){const a=nt.findKey(this,n);if(a){const l=this[a];if(!i)return l;if(i===!0)return Oue(l);if(nt.isFunction(i))return i.call(this,l,a);if(nt.isRegExp(i))return i.exec(l);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,i){if(n=bw(n),n){const a=nt.findKey(this,n);return!!(a&&this[a]!==void 0&&(!i||HL(this,this[a],a,i)))}return!1}delete(n,i){const a=this;let l=!1;function p(_){if(_=bw(_),_){const T=nt.findKey(a,_);T&&(!i||HL(a,a[T],T,i))&&(delete a[T],l=!0)}}return nt.isArray(n)?n.forEach(p):p(n),l}clear(n){const i=Object.keys(this);let a=i.length,l=!1;for(;a--;){const p=i[a];(!n||HL(this,this[p],p,n,!0))&&(delete this[p],l=!0)}return l}normalize(n){const i=this,a={};return nt.forEach(this,(l,p)=>{const _=nt.findKey(a,p);if(_){i[_]=yN(l),delete i[p];return}const T=n?xue(p):String(p).trim();T!==p&&delete i[p],i[T]=yN(l),a[T]=!0}),this}concat(...n){return this.constructor.concat(this,...n)}toJSON(n){const i=Object.create(null);return nt.forEach(this,(a,l)=>{a!=null&&a!==!1&&(i[l]=n&&nt.isArray(a)?a.join(", "):a)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([n,i])=>n+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n,...i){const a=new this(n);return i.forEach(l=>a.set(l)),a}static accessor(n){const a=(this[f8]=this[f8]={accessors:{}}).accessors,l=this.prototype;function p(_){const T=bw(_);a[T]||(Pue(l,_),a[T]=!0)}return nt.isArray(n)?n.forEach(p):p(n),this}};hc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);nt.reduceDescriptors(hc.prototype,({value:s},n)=>{let i=n[0].toUpperCase()+n.slice(1);return{get:()=>s,set(a){this[i]=a}}});nt.freezeMethods(hc);function GL(s,n){const i=this||T0,a=n||i,l=hc.from(a.headers);let p=a.data;return nt.forEach(s,function(T){p=T.call(i,p,l.normalize(),n?n.status:void 0)}),l.normalize(),p}function Jq(s){return!!(s&&s.__CANCEL__)}function sS(s,n,i){nr.call(this,s??"canceled",nr.ERR_CANCELED,n,i),this.name="CanceledError"}nt.inherits(sS,nr,{__CANCEL__:!0});function Zq(s,n,i){const a=i.config.validateStatus;!i.status||!a||a(i.status)?s(i):n(new nr("Request failed with status code "+i.status,[nr.ERR_BAD_REQUEST,nr.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function kue(s){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return n&&n[1]||""}function Lue(s,n){s=s||10;const i=new Array(s),a=new Array(s);let l=0,p=0,_;return n=n!==void 0?n:1e3,function(w){const C=Date.now(),O=a[p];_||(_=C),i[l]=w,a[l]=C;let k=p,U=0;for(;k!==l;)U+=i[k++],k=k%s;if(l=(l+1)%s,l===p&&(p=(p+1)%s),C-_<n)return;const G=O&&C-O;return G?Math.round(U*1e3/G):void 0}}function Mue(s,n){let i=0,a=1e3/n,l,p;const _=(C,O=Date.now())=>{i=O,l=null,p&&(clearTimeout(p),p=null),s.apply(null,C)};return[(...C)=>{const O=Date.now(),k=O-i;k>=a?_(C,O):(l=C,p||(p=setTimeout(()=>{p=null,_(l)},a-k)))},()=>l&&_(l)]}const yO=(s,n,i=3)=>{let a=0;const l=Lue(50,250);return Mue(p=>{const _=p.loaded,T=p.lengthComputable?p.total:void 0,w=_-a,C=l(w),O=_<=T;a=_;const k={loaded:_,total:T,progress:T?_/T:void 0,bytes:w,rate:C||void 0,estimated:C&&T&&O?(T-_)/C:void 0,event:p,lengthComputable:T!=null,[n?"download":"upload"]:!0};s(k)},i)},m8=(s,n)=>{const i=s!=null;return[a=>n[0]({lengthComputable:i,total:s,loaded:a}),n[1]]},g8=s=>(...n)=>nt.asap(()=>s(...n)),jue=ho.hasStandardBrowserEnv?((s,n)=>i=>(i=new URL(i,ho.origin),s.protocol===i.protocol&&s.host===i.host&&(n||s.port===i.port)))(new URL(ho.origin),ho.navigator&&/(msie|trident)/i.test(ho.navigator.userAgent)):()=>!0,Uue=ho.hasStandardBrowserEnv?{write(s,n,i,a,l,p){const _=[s+"="+encodeURIComponent(n)];nt.isNumber(i)&&_.push("expires="+new Date(i).toGMTString()),nt.isString(a)&&_.push("path="+a),nt.isString(l)&&_.push("domain="+l),p===!0&&_.push("secure"),document.cookie=_.join("; ")},read(s){const n=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Vue(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function Fue(s,n){return n?s.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):s}function eK(s,n,i){let a=!Vue(n);return s&&(a||i==!1)?Fue(s,n):n}const _8=s=>s instanceof hc?{...s}:s;function O_(s,n){n=n||{};const i={};function a(C,O,k,U){return nt.isPlainObject(C)&&nt.isPlainObject(O)?nt.merge.call({caseless:U},C,O):nt.isPlainObject(O)?nt.merge({},O):nt.isArray(O)?O.slice():O}function l(C,O,k,U){if(nt.isUndefined(O)){if(!nt.isUndefined(C))return a(void 0,C,k,U)}else return a(C,O,k,U)}function p(C,O){if(!nt.isUndefined(O))return a(void 0,O)}function _(C,O){if(nt.isUndefined(O)){if(!nt.isUndefined(C))return a(void 0,C)}else return a(void 0,O)}function T(C,O,k){if(k in n)return a(C,O);if(k in s)return a(void 0,C)}const w={url:p,method:p,data:p,baseURL:_,transformRequest:_,transformResponse:_,paramsSerializer:_,timeout:_,timeoutMessage:_,withCredentials:_,withXSRFToken:_,adapter:_,responseType:_,xsrfCookieName:_,xsrfHeaderName:_,onUploadProgress:_,onDownloadProgress:_,decompress:_,maxContentLength:_,maxBodyLength:_,beforeRedirect:_,transport:_,httpAgent:_,httpsAgent:_,cancelToken:_,socketPath:_,responseEncoding:_,validateStatus:T,headers:(C,O,k)=>l(_8(C),_8(O),k,!0)};return nt.forEach(Object.keys(Object.assign({},s,n)),function(O){const k=w[O]||l,U=k(s[O],n[O],O);nt.isUndefined(U)&&k!==T||(i[O]=U)}),i}const tK=s=>{const n=O_({},s);let{data:i,withXSRFToken:a,xsrfHeaderName:l,xsrfCookieName:p,headers:_,auth:T}=n;n.headers=_=hc.from(_),n.url=Xq(eK(n.baseURL,n.url,n.allowAbsoluteUrls),s.params,s.paramsSerializer),T&&_.set("Authorization","Basic "+btoa((T.username||"")+":"+(T.password?unescape(encodeURIComponent(T.password)):"")));let w;if(nt.isFormData(i)){if(ho.hasStandardBrowserEnv||ho.hasStandardBrowserWebWorkerEnv)_.setContentType(void 0);else if((w=_.getContentType())!==!1){const[C,...O]=w?w.split(";").map(k=>k.trim()).filter(Boolean):[];_.setContentType([C||"multipart/form-data",...O].join("; "))}}if(ho.hasStandardBrowserEnv&&(a&&nt.isFunction(a)&&(a=a(n)),a||a!==!1&&jue(n.url))){const C=l&&p&&Uue.read(p);C&&_.set(l,C)}return n},Bue=typeof XMLHttpRequest<"u",Hue=Bue&&function(s){return new Promise(function(i,a){const l=tK(s);let p=l.data;const _=hc.from(l.headers).normalize();let{responseType:T,onUploadProgress:w,onDownloadProgress:C}=l,O,k,U,G,z;function J(){G&&G(),z&&z(),l.cancelToken&&l.cancelToken.unsubscribe(O),l.signal&&l.signal.removeEventListener("abort",O)}let X=new XMLHttpRequest;X.open(l.method.toUpperCase(),l.url,!0),X.timeout=l.timeout;function ie(){if(!X)return;const ce=hc.from("getAllResponseHeaders"in X&&X.getAllResponseHeaders()),se={data:!T||T==="text"||T==="json"?X.responseText:X.response,status:X.status,statusText:X.statusText,headers:ce,config:s,request:X};Zq(function(ee){i(ee),J()},function(ee){a(ee),J()},se),X=null}"onloadend"in X?X.onloadend=ie:X.onreadystatechange=function(){!X||X.readyState!==4||X.status===0&&!(X.responseURL&&X.responseURL.indexOf("file:")===0)||setTimeout(ie)},X.onabort=function(){X&&(a(new nr("Request aborted",nr.ECONNABORTED,s,X)),X=null)},X.onerror=function(){a(new nr("Network Error",nr.ERR_NETWORK,s,X)),X=null},X.ontimeout=function(){let _e=l.timeout?"timeout of "+l.timeout+"ms exceeded":"timeout exceeded";const se=l.transitional||Qq;l.timeoutErrorMessage&&(_e=l.timeoutErrorMessage),a(new nr(_e,se.clarifyTimeoutError?nr.ETIMEDOUT:nr.ECONNABORTED,s,X)),X=null},p===void 0&&_.setContentType(null),"setRequestHeader"in X&&nt.forEach(_.toJSON(),function(_e,se){X.setRequestHeader(se,_e)}),nt.isUndefined(l.withCredentials)||(X.withCredentials=!!l.withCredentials),T&&T!=="json"&&(X.responseType=l.responseType),C&&([U,z]=yO(C,!0),X.addEventListener("progress",U)),w&&X.upload&&([k,G]=yO(w),X.upload.addEventListener("progress",k),X.upload.addEventListener("loadend",G)),(l.cancelToken||l.signal)&&(O=ce=>{X&&(a(!ce||ce.type?new sS(null,s,X):ce),X.abort(),X=null)},l.cancelToken&&l.cancelToken.subscribe(O),l.signal&&(l.signal.aborted?O():l.signal.addEventListener("abort",O)));const oe=kue(l.url);if(oe&&ho.protocols.indexOf(oe)===-1){a(new nr("Unsupported protocol "+oe+":",nr.ERR_BAD_REQUEST,s));return}X.send(p||null)})},Gue=(s,n)=>{const{length:i}=s=s?s.filter(Boolean):[];if(n||i){let a=new AbortController,l;const p=function(C){if(!l){l=!0,T();const O=C instanceof Error?C:this.reason;a.abort(O instanceof nr?O:new sS(O instanceof Error?O.message:O))}};let _=n&&setTimeout(()=>{_=null,p(new nr(`timeout ${n} of ms exceeded`,nr.ETIMEDOUT))},n);const T=()=>{s&&(_&&clearTimeout(_),_=null,s.forEach(C=>{C.unsubscribe?C.unsubscribe(p):C.removeEventListener("abort",p)}),s=null)};s.forEach(C=>C.addEventListener("abort",p));const{signal:w}=a;return w.unsubscribe=()=>nt.asap(T),w}},Wue=function*(s,n){let i=s.byteLength;if(i<n){yield s;return}let a=0,l;for(;a<i;)l=a+n,yield s.slice(a,l),a=l},zue=async function*(s,n){for await(const i of Yue(s))yield*Wue(i,n)},Yue=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const n=s.getReader();try{for(;;){const{done:i,value:a}=await n.read();if(i)break;yield a}}finally{await n.cancel()}},E8=(s,n,i,a)=>{const l=zue(s,n);let p=0,_,T=w=>{_||(_=!0,a&&a(w))};return new ReadableStream({async pull(w){try{const{done:C,value:O}=await l.next();if(C){T(),w.close();return}let k=O.byteLength;if(i){let U=p+=k;i(U)}w.enqueue(new Uint8Array(O))}catch(C){throw T(C),C}},cancel(w){return T(w),l.return()}},{highWaterMark:2})},uD=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",nK=uD&&typeof ReadableStream=="function",que=uD&&(typeof TextEncoder=="function"?(s=>n=>s.encode(n))(new TextEncoder):async s=>new Uint8Array(await new Response(s).arrayBuffer())),rK=(s,...n)=>{try{return!!s(...n)}catch{return!1}},Kue=nK&&rK(()=>{let s=!1;const n=new Request(ho.origin,{body:new ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type");return s&&!n}),y8=64*1024,XM=nK&&rK(()=>nt.isReadableStream(new Response("").body)),vO={stream:XM&&(s=>s.body)};uD&&(s=>{["text","arrayBuffer","blob","formData","stream"].forEach(n=>{!vO[n]&&(vO[n]=nt.isFunction(s[n])?i=>i[n]():(i,a)=>{throw new nr(`Response type '${n}' is not supported`,nr.ERR_NOT_SUPPORT,a)})})})(new Response);const Xue=async s=>{if(s==null)return 0;if(nt.isBlob(s))return s.size;if(nt.isSpecCompliantForm(s))return(await new Request(ho.origin,{method:"POST",body:s}).arrayBuffer()).byteLength;if(nt.isArrayBufferView(s)||nt.isArrayBuffer(s))return s.byteLength;if(nt.isURLSearchParams(s)&&(s=s+""),nt.isString(s))return(await que(s)).byteLength},Que=async(s,n)=>{const i=nt.toFiniteNumber(s.getContentLength());return i??Xue(n)},$ue=uD&&(async s=>{let{url:n,method:i,data:a,signal:l,cancelToken:p,timeout:_,onDownloadProgress:T,onUploadProgress:w,responseType:C,headers:O,withCredentials:k="same-origin",fetchOptions:U}=tK(s);C=C?(C+"").toLowerCase():"text";let G=Gue([l,p&&p.toAbortSignal()],_),z;const J=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let X;try{if(w&&Kue&&i!=="get"&&i!=="head"&&(X=await Que(O,a))!==0){let se=new Request(n,{method:"POST",body:a,duplex:"half"}),be;if(nt.isFormData(a)&&(be=se.headers.get("content-type"))&&O.setContentType(be),se.body){const[ee,Q]=m8(X,yO(g8(w)));a=E8(se.body,y8,ee,Q)}}nt.isString(k)||(k=k?"include":"omit");const ie="credentials"in Request.prototype;z=new Request(n,{...U,signal:G,method:i.toUpperCase(),headers:O.normalize().toJSON(),body:a,duplex:"half",credentials:ie?k:void 0});let oe=await fetch(z);const ce=XM&&(C==="stream"||C==="response");if(XM&&(T||ce&&J)){const se={};["status","statusText","headers"].forEach(q=>{se[q]=oe[q]});const be=nt.toFiniteNumber(oe.headers.get("content-length")),[ee,Q]=T&&m8(be,yO(g8(T),!0))||[];oe=new Response(E8(oe.body,y8,ee,()=>{Q&&Q(),J&&J()}),se)}C=C||"text";let _e=await vO[nt.findKey(vO,C)||"text"](oe,s);return!ce&&J&&J(),await new Promise((se,be)=>{Zq(se,be,{data:_e,headers:hc.from(oe.headers),status:oe.status,statusText:oe.statusText,config:s,request:z})})}catch(ie){throw J&&J(),ie&&ie.name==="TypeError"&&/Load failed|fetch/i.test(ie.message)?Object.assign(new nr("Network Error",nr.ERR_NETWORK,s,z),{cause:ie.cause||ie}):nr.from(ie,ie&&ie.code,s,z)}}),QM={http:hue,xhr:Hue,fetch:$ue};nt.forEach(QM,(s,n)=>{if(s){try{Object.defineProperty(s,"name",{value:n})}catch{}Object.defineProperty(s,"adapterName",{value:n})}});const v8=s=>`- ${s}`,Jue=s=>nt.isFunction(s)||s===null||s===!1,iK={getAdapter:s=>{s=nt.isArray(s)?s:[s];const{length:n}=s;let i,a;const l={};for(let p=0;p<n;p++){i=s[p];let _;if(a=i,!Jue(i)&&(a=QM[(_=String(i)).toLowerCase()],a===void 0))throw new nr(`Unknown adapter '${_}'`);if(a)break;l[_||"#"+p]=a}if(!a){const p=Object.entries(l).map(([T,w])=>`adapter ${T} `+(w===!1?"is not supported by the environment":"is not available in the build"));let _=n?p.length>1?`since :
`+p.map(v8).join(`
`):" "+v8(p[0]):"as no adapter specified";throw new nr("There is no suitable adapter to dispatch the request "+_,"ERR_NOT_SUPPORT")}return a},adapters:QM};function WL(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new sS(null,s)}function S8(s){return WL(s),s.headers=hc.from(s.headers),s.data=GL.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),iK.getAdapter(s.adapter||T0.adapter)(s).then(function(a){return WL(s),a.data=GL.call(s,s.transformResponse,a),a.headers=hc.from(a.headers),a},function(a){return Jq(a)||(WL(s),a&&a.response&&(a.response.data=GL.call(s,s.transformResponse,a.response),a.response.headers=hc.from(a.response.headers))),Promise.reject(a)})}const sK="1.9.0",hD={};["object","boolean","number","function","string","symbol"].forEach((s,n)=>{hD[s]=function(a){return typeof a===s||"a"+(n<1?"n ":" ")+s}});const T8={};hD.transitional=function(n,i,a){function l(p,_){return"[Axios v"+sK+"] Transitional option '"+p+"'"+_+(a?". "+a:"")}return(p,_,T)=>{if(n===!1)throw new nr(l(_," has been removed"+(i?" in "+i:"")),nr.ERR_DEPRECATED);return i&&!T8[_]&&(T8[_]=!0,console.warn(l(_," has been deprecated since v"+i+" and will be removed in the near future"))),n?n(p,_,T):!0}};hD.spelling=function(n){return(i,a)=>(console.warn(`${a} is likely a misspelling of ${n}`),!0)};function Zue(s,n,i){if(typeof s!="object")throw new nr("options must be an object",nr.ERR_BAD_OPTION_VALUE);const a=Object.keys(s);let l=a.length;for(;l-- >0;){const p=a[l],_=n[p];if(_){const T=s[p],w=T===void 0||_(T,p,s);if(w!==!0)throw new nr("option "+p+" must be "+w,nr.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new nr("Unknown option "+p,nr.ERR_BAD_OPTION)}}const vN={assertOptions:Zue,validators:hD},Nu=vN.validators;let S_=class{constructor(n){this.defaults=n||{},this.interceptors={request:new p8,response:new p8}}async request(n,i){try{return await this._request(n,i)}catch(a){if(a instanceof Error){let l={};Error.captureStackTrace?Error.captureStackTrace(l):l=new Error;const p=l.stack?l.stack.replace(/^.+\n/,""):"";try{a.stack?p&&!String(a.stack).endsWith(p.replace(/^.+\n.+\n/,""))&&(a.stack+=`
`+p):a.stack=p}catch{}}throw a}}_request(n,i){typeof n=="string"?(i=i||{},i.url=n):i=n||{},i=O_(this.defaults,i);const{transitional:a,paramsSerializer:l,headers:p}=i;a!==void 0&&vN.assertOptions(a,{silentJSONParsing:Nu.transitional(Nu.boolean),forcedJSONParsing:Nu.transitional(Nu.boolean),clarifyTimeoutError:Nu.transitional(Nu.boolean)},!1),l!=null&&(nt.isFunction(l)?i.paramsSerializer={serialize:l}:vN.assertOptions(l,{encode:Nu.function,serialize:Nu.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),vN.assertOptions(i,{baseUrl:Nu.spelling("baseURL"),withXsrfToken:Nu.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let _=p&&nt.merge(p.common,p[i.method]);p&&nt.forEach(["delete","get","head","post","put","patch","common"],z=>{delete p[z]}),i.headers=hc.concat(_,p);const T=[];let w=!0;this.interceptors.request.forEach(function(J){typeof J.runWhen=="function"&&J.runWhen(i)===!1||(w=w&&J.synchronous,T.unshift(J.fulfilled,J.rejected))});const C=[];this.interceptors.response.forEach(function(J){C.push(J.fulfilled,J.rejected)});let O,k=0,U;if(!w){const z=[S8.bind(this),void 0];for(z.unshift.apply(z,T),z.push.apply(z,C),U=z.length,O=Promise.resolve(i);k<U;)O=O.then(z[k++],z[k++]);return O}U=T.length;let G=i;for(k=0;k<U;){const z=T[k++],J=T[k++];try{G=z(G)}catch(X){J.call(this,X);break}}try{O=S8.call(this,G)}catch(z){return Promise.reject(z)}for(k=0,U=C.length;k<U;)O=O.then(C[k++],C[k++]);return O}getUri(n){n=O_(this.defaults,n);const i=eK(n.baseURL,n.url,n.allowAbsoluteUrls);return Xq(i,n.params,n.paramsSerializer)}};nt.forEach(["delete","get","head","options"],function(n){S_.prototype[n]=function(i,a){return this.request(O_(a||{},{method:n,url:i,data:(a||{}).data}))}});nt.forEach(["post","put","patch"],function(n){function i(a){return function(p,_,T){return this.request(O_(T||{},{method:n,headers:a?{"Content-Type":"multipart/form-data"}:{},url:p,data:_}))}}S_.prototype[n]=i(),S_.prototype[n+"Form"]=i(!0)});let ehe=class aK{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(p){i=p});const a=this;this.promise.then(l=>{if(!a._listeners)return;let p=a._listeners.length;for(;p-- >0;)a._listeners[p](l);a._listeners=null}),this.promise.then=l=>{let p;const _=new Promise(T=>{a.subscribe(T),p=T}).then(l);return _.cancel=function(){a.unsubscribe(p)},_},n(function(p,_,T){a.reason||(a.reason=new sS(p,_,T),i(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const i=this._listeners.indexOf(n);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const n=new AbortController,i=a=>{n.abort(a)};return this.subscribe(i),n.signal.unsubscribe=()=>this.unsubscribe(i),n.signal}static source(){let n;return{token:new aK(function(l){n=l}),cancel:n}}};function the(s){return function(i){return s.apply(null,i)}}function nhe(s){return nt.isObject(s)&&s.isAxiosError===!0}const $M={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries($M).forEach(([s,n])=>{$M[n]=s});function oK(s){const n=new S_(s),i=jq(S_.prototype.request,n);return nt.extend(i,S_.prototype,n,{allOwnKeys:!0}),nt.extend(i,n,null,{allOwnKeys:!0}),i.create=function(l){return oK(O_(s,l))},i}const vi=oK(T0);vi.Axios=S_;vi.CanceledError=sS;vi.CancelToken=ehe;vi.isCancel=Jq;vi.VERSION=sK;vi.toFormData=dD;vi.AxiosError=nr;vi.Cancel=vi.CanceledError;vi.all=function(n){return Promise.all(n)};vi.spread=the;vi.isAxiosError=nhe;vi.mergeConfig=O_;vi.AxiosHeaders=hc;vi.formToJSON=s=>$q(nt.isHTMLForm(s)?new FormData(s):s);vi.getAdapter=iK.getAdapter;vi.HttpStatusCode=$M;vi.default=vi;const{Axios:Z0e,AxiosError:eRe,CanceledError:tRe,isCancel:nRe,CancelToken:rRe,VERSION:iRe,all:sRe,Cancel:aRe,isAxiosError:oRe,spread:cRe,toFormData:lRe,AxiosHeaders:dRe,HttpStatusCode:uRe,formToJSON:hRe,getAdapter:pRe,mergeConfig:fRe}=vi,li="https://awplconnectadmin.tgastaging.com/",xn=vi.create({baseURL:`${li}api`}),rhe=s=>xn.post("/email-valid",s),ihe=s=>xn.post("/login-password",s),she=s=>xn.post("/forgot-password",s),ahe=s=>xn.post("/otp-verfication",s),ohe=s=>xn.post("/resend-otp",s),che=s=>xn.post("/reset-password",s),lhe=s=>xn.post("/first-login",s),dhe=()=>{var s;return xn.get("/doctor/profile",{headers:{Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:s.token}`}})},uhe=s=>{var n;return xn.post("/doctor/profile/update",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},hhe=s=>{var n;return xn.post("/doctor/profile/photo",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},phe=()=>{var s;return xn.delete("/doctor/profile/photo",{headers:{Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:s.token}`}})},fhe=()=>{var s;return xn.get("/doctor/prescriptions/pending",{headers:{Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:s.token}`}})},mhe=()=>{var s;return xn.get("/doctor/prescriptions/completed",{headers:{Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:s.token}`}})},ghe=s=>{var n;return xn.post("/getScheduleTime",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`}})},_he=s=>{var n;return xn.post("/get_symptom",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Ehe=s=>{var n;return xn.post("/doctor/prescriptions/submit",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"application/json"}})},yhe=s=>{var n;return xn.post("/create-channel",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"application/json"}})},vhe=s=>{var n;return xn.post("/call-joined",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"application/json"}})},She=s=>{var n;return xn.post("/doctor-home",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},The=s=>{var n;return xn.post("/api/logout",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`}})},bhe=()=>{var s;return xn.post("/doctor/appointments/upcoming",{},{headers:{Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:s.token}`}})},whe=()=>{var s;return xn.post("/doctor/appointments/completed",{},{headers:{Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:s.token}`}})},Rhe=()=>{var s;return xn.post("/doctor/appointments/cancelled",{},{headers:{Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:s.token}`}})},Che=()=>{var s;return xn.post("/doctor/appointments/incomplete",{},{headers:{Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:s.token}`}})},Ahe=()=>{var s;return xn.post("/doctor/appointments/missed",{},{headers:{Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:s.token}`}})},Ihe=s=>{var n;return xn.post("/doctor/appointments/cancel",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Nhe=s=>{var n;return xn.post("/doctor/appointments/details",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Ohe=s=>{var n;return xn.post("/doctor/prescriptions/details",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Dhe=s=>{var n;return xn.post("/doctor/patients/profile",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},xhe=s=>{var n;return xn.post("/doctor/prescriptions/download",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"},responseType:"blob"})},Phe=()=>{var s;return xn.get("/doctor/notifications",{headers:{Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:s.token}`}})},khe=s=>{var n;return xn.delete("/doctor/notifications/delete",{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"application/json"},data:{notification_ids:s}})},Lhe=s=>{var n;return xn.patch("/doctor/notifications/read",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"application/json"}})},Mhe=s=>{var n;return xn.post("/doctor/medicines/search",null,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},jhe=()=>{var s;return xn.get("/doctor/notifications/unread-count",{headers:{Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:s.token}`}})},Uhe=()=>{var s;return xn.get("/doctor/appointment-notifications-status",{headers:{Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:s.token}`}})},Vhe=s=>{var n;return xn.patch("/doctor/appointment-notifications-toggle",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`}})},Fhe=s=>{var n;return xn.post("/doctor/patients/past",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Bhe=s=>{var n;return xn.post("/doctor/appointments/reminders",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`}})},Hhe=s=>{var n;return xn.post("/doctor/appointments/scheduleAppointmentByDoctor",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Ghe=s=>{var n;return xn.post("/doctor/prescriptions/submit_appointment_prescription",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"application/json"}})},Whe=s=>{var n;return xn.post("/doctor/treatments",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},zhe=s=>{var n;return xn.post("/getChat",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Yhe=s=>{var n;return xn.post("/doctor/unavailability/submit",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},qhe=()=>{var s;return xn.get("/doctor/unavailability/list",{headers:{Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:s.token}`}})},Khe=()=>{var s;return xn.get("/doctor/unavailability/all-list",{headers:{Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:s.token}`}})},Xhe=s=>{var n;return xn.post("/doctor/unavailability/confirm",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Qhe=s=>{var n;return xn.post("/doctor/unavailability/respond",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},$he=s=>{var n;return xn.post("/doctor/unavailability/doctors",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Jhe=s=>{var n;return xn.post("/doctor/unavailability/mark-doctor-available",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},Zhe=s=>{var n;return xn.post("/doctor/unavailability/submit-by-hod",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})},epe=s=>{var n;return xn.post("/submitFeedback",s,{headers:{Authorization:`Bearer ${(n=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:n.token}`,"Content-Type":"multipart/form-data"}})};function cK(s){var n,i,a="";if(typeof s=="string"||typeof s=="number")a+=s;else if(typeof s=="object")if(Array.isArray(s)){var l=s.length;for(n=0;n<l;n++)s[n]&&(i=cK(s[n]))&&(a&&(a+=" "),a+=i)}else for(i in s)s[i]&&(a&&(a+=" "),a+=i);return a}function $i(){for(var s,n,i=0,a="",l=arguments.length;i<l;i++)(s=arguments[i])&&(n=cK(s))&&(a&&(a+=" "),a+=n);return a}function tpe(s){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=s:i.appendChild(document.createTextNode(s))}tpe(`:root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
`);var b0=s=>typeof s=="number"&&!isNaN(s),D_=s=>typeof s=="string",hp=s=>typeof s=="function",npe=s=>D_(s)||b0(s),JM=s=>D_(s)||hp(s)?s:null,rpe=(s,n)=>s===!1||b0(s)&&s>0?s:n,ZM=s=>F.isValidElement(s)||D_(s)||hp(s)||b0(s);function ipe(s,n,i=300){let{scrollHeight:a,style:l}=s;requestAnimationFrame(()=>{l.minHeight="initial",l.height=a+"px",l.transition=`all ${i}ms`,requestAnimationFrame(()=>{l.height="0",l.padding="0",l.margin="0",setTimeout(n,i)})})}function spe({enter:s,exit:n,appendPosition:i=!1,collapse:a=!0,collapseDuration:l=300}){return function({children:p,position:_,preventExitTransition:T,done:w,nodeRef:C,isIn:O,playToast:k}){let U=i?`${s}--${_}`:s,G=i?`${n}--${_}`:n,z=F.useRef(0);return F.useLayoutEffect(()=>{let J=C.current,X=U.split(" "),ie=oe=>{oe.target===C.current&&(k(),J.removeEventListener("animationend",ie),J.removeEventListener("animationcancel",ie),z.current===0&&oe.type!=="animationcancel"&&J.classList.remove(...X))};J.classList.add(...X),J.addEventListener("animationend",ie),J.addEventListener("animationcancel",ie)},[]),F.useEffect(()=>{let J=C.current,X=()=>{J.removeEventListener("animationend",X),a?ipe(J,w,l):w()};O||(T?X():(z.current=1,J.className+=` ${G}`,J.addEventListener("animationend",X)))},[O]),We.createElement(We.Fragment,null,p)}}function b8(s,n){return{content:lK(s.content,s.props),containerId:s.props.containerId,id:s.props.toastId,theme:s.props.theme,type:s.props.type,data:s.props.data||{},isLoading:s.props.isLoading,icon:s.props.icon,reason:s.removalReason,status:n}}function lK(s,n,i=!1){return F.isValidElement(s)&&!D_(s.type)?F.cloneElement(s,{closeToast:n.closeToast,toastProps:n,data:n.data,isPaused:i}):hp(s)?s({closeToast:n.closeToast,toastProps:n,data:n.data,isPaused:i}):s}function ape({closeToast:s,theme:n,ariaLabel:i="close"}){return We.createElement("button",{className:`Toastify__close-button Toastify__close-button--${n}`,type:"button",onClick:a=>{a.stopPropagation(),s(!0)},"aria-label":i},We.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},We.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function ope({delay:s,isRunning:n,closeToast:i,type:a="default",hide:l,className:p,controlledProgress:_,progress:T,rtl:w,isIn:C,theme:O}){let k=l||_&&T===0,U={animationDuration:`${s}ms`,animationPlayState:n?"running":"paused"};_&&(U.transform=`scaleX(${T})`);let G=$i("Toastify__progress-bar",_?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${O}`,`Toastify__progress-bar--${a}`,{"Toastify__progress-bar--rtl":w}),z=hp(p)?p({rtl:w,type:a,defaultClassName:G}):$i(G,p),J={[_&&T>=1?"onTransitionEnd":"onAnimationEnd"]:_&&T<1?null:()=>{C&&i()}};return We.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":k},We.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${O} Toastify__progress-bar--${a}`}),We.createElement("div",{role:"progressbar","aria-hidden":k?"true":"false","aria-label":"notification timer",className:z,style:U,...J}))}var cpe=1,dK=()=>`${cpe++}`;function lpe(s,n,i){let a=1,l=0,p=[],_=[],T=n,w=new Map,C=new Set,O=oe=>(C.add(oe),()=>C.delete(oe)),k=()=>{_=Array.from(w.values()),C.forEach(oe=>oe())},U=({containerId:oe,toastId:ce,updateId:_e})=>{let se=oe?oe!==s:s!==1,be=w.has(ce)&&_e==null;return se||be},G=(oe,ce)=>{w.forEach(_e=>{var se;(ce==null||ce===_e.props.toastId)&&((se=_e.toggle)==null||se.call(_e,oe))})},z=oe=>{var ce,_e;(_e=(ce=oe.props)==null?void 0:ce.onClose)==null||_e.call(ce,oe.removalReason),oe.isActive=!1},J=oe=>{if(oe==null)w.forEach(z);else{let ce=w.get(oe);ce&&z(ce)}k()},X=()=>{l-=p.length,p=[]},ie=oe=>{var ce,_e;let{toastId:se,updateId:be}=oe.props,ee=be==null;oe.staleId&&w.delete(oe.staleId),oe.isActive=!0,w.set(se,oe),k(),i(b8(oe,ee?"added":"updated")),ee&&((_e=(ce=oe.props).onOpen)==null||_e.call(ce))};return{id:s,props:T,observe:O,toggle:G,removeToast:J,toasts:w,clearQueue:X,buildToast:(oe,ce)=>{if(U(ce))return;let{toastId:_e,updateId:se,data:be,staleId:ee,delay:Q}=ce,q=se==null;q&&l++;let ae={...T,style:T.toastStyle,key:a++,...Object.fromEntries(Object.entries(ce).filter(([fe,pe])=>pe!=null)),toastId:_e,updateId:se,data:be,isIn:!1,className:JM(ce.className||T.toastClassName),progressClassName:JM(ce.progressClassName||T.progressClassName),autoClose:ce.isLoading?!1:rpe(ce.autoClose,T.autoClose),closeToast(fe){w.get(_e).removalReason=fe,J(_e)},deleteToast(){let fe=w.get(_e);if(fe!=null){if(i(b8(fe,"removed")),w.delete(_e),l--,l<0&&(l=0),p.length>0){ie(p.shift());return}k()}}};ae.closeButton=T.closeButton,ce.closeButton===!1||ZM(ce.closeButton)?ae.closeButton=ce.closeButton:ce.closeButton===!0&&(ae.closeButton=ZM(T.closeButton)?T.closeButton:!0);let re={content:oe,props:ae,staleId:ee};T.limit&&T.limit>0&&l>T.limit&&q?p.push(re):b0(Q)?setTimeout(()=>{ie(re)},Q):ie(re)},setProps(oe){T=oe},setToggle:(oe,ce)=>{let _e=w.get(oe);_e&&(_e.toggle=ce)},isToastActive:oe=>{var ce;return(ce=w.get(oe))==null?void 0:ce.isActive},getSnapshot:()=>_}}var Mo=new Map,i0=[],e2=new Set,dpe=s=>e2.forEach(n=>n(s)),uK=()=>Mo.size>0;function upe(){i0.forEach(s=>pK(s.content,s.options)),i0=[]}var hpe=(s,{containerId:n})=>{var i;return(i=Mo.get(n||1))==null?void 0:i.toasts.get(s)};function hK(s,n){var i;if(n)return!!((i=Mo.get(n))!=null&&i.isToastActive(s));let a=!1;return Mo.forEach(l=>{l.isToastActive(s)&&(a=!0)}),a}function ppe(s){if(!uK()){i0=i0.filter(n=>s!=null&&n.options.toastId!==s);return}if(s==null||npe(s))Mo.forEach(n=>{n.removeToast(s)});else if(s&&("containerId"in s||"id"in s)){let n=Mo.get(s.containerId);n?n.removeToast(s.id):Mo.forEach(i=>{i.removeToast(s.id)})}}var fpe=(s={})=>{Mo.forEach(n=>{n.props.limit&&(!s.containerId||n.id===s.containerId)&&n.clearQueue()})};function pK(s,n){ZM(s)&&(uK()||i0.push({content:s,options:n}),Mo.forEach(i=>{i.buildToast(s,n)}))}function mpe(s){var n;(n=Mo.get(s.containerId||1))==null||n.setToggle(s.id,s.fn)}function fK(s,n){Mo.forEach(i=>{(n==null||!(n!=null&&n.containerId)||(n==null?void 0:n.containerId)===i.id)&&i.toggle(s,n==null?void 0:n.id)})}function gpe(s){let n=s.containerId||1;return{subscribe(i){let a=lpe(n,s,dpe);Mo.set(n,a);let l=a.observe(i);return upe(),()=>{l(),Mo.delete(n)}},setProps(i){var a;(a=Mo.get(n))==null||a.setProps(i)},getSnapshot(){var i;return(i=Mo.get(n))==null?void 0:i.getSnapshot()}}}function _pe(s){return e2.add(s),()=>{e2.delete(s)}}function Epe(s){return s&&(D_(s.toastId)||b0(s.toastId))?s.toastId:dK()}function w0(s,n){return pK(s,n),n.toastId}function pD(s,n){return{...n,type:n&&n.type||s,toastId:Epe(n)}}function fD(s){return(n,i)=>w0(n,pD(s,i))}function ct(s,n){return w0(s,pD("default",n))}ct.loading=(s,n)=>w0(s,pD("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...n}));function ype(s,{pending:n,error:i,success:a},l){let p;n&&(p=D_(n)?ct.loading(n,l):ct.loading(n.render,{...l,...n}));let _={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},T=(C,O,k)=>{if(O==null){ct.dismiss(p);return}let U={type:C,..._,...l,data:k},G=D_(O)?{render:O}:O;return p?ct.update(p,{...U,...G}):ct(G.render,{...U,...G}),k},w=hp(s)?s():s;return w.then(C=>T("success",a,C)).catch(C=>T("error",i,C)),w}ct.promise=ype;ct.success=fD("success");ct.info=fD("info");ct.error=fD("error");ct.warning=fD("warning");ct.warn=ct.warning;ct.dark=(s,n)=>w0(s,pD("default",{theme:"dark",...n}));function vpe(s){ppe(s)}ct.dismiss=vpe;ct.clearWaitingQueue=fpe;ct.isActive=hK;ct.update=(s,n={})=>{let i=hpe(s,n);if(i){let{props:a,content:l}=i,p={delay:100,...a,...n,toastId:n.toastId||s,updateId:dK()};p.toastId!==s&&(p.staleId=s);let _=p.render||l;delete p.render,w0(_,p)}};ct.done=s=>{ct.update(s,{progress:1})};ct.onChange=_pe;ct.play=s=>fK(!0,s);ct.pause=s=>fK(!1,s);function Spe(s){var n;let{subscribe:i,getSnapshot:a,setProps:l}=F.useRef(gpe(s)).current;l(s);let p=(n=F.useSyncExternalStore(i,a,a))==null?void 0:n.slice();function _(T){if(!p)return[];let w=new Map;return s.newestOnTop&&p.reverse(),p.forEach(C=>{let{position:O}=C.props;w.has(O)||w.set(O,[]),w.get(O).push(C)}),Array.from(w,C=>T(C[0],C[1]))}return{getToastToRender:_,isToastActive:hK,count:p==null?void 0:p.length}}function Tpe(s){let[n,i]=F.useState(!1),[a,l]=F.useState(!1),p=F.useRef(null),_=F.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:T,pauseOnHover:w,closeToast:C,onClick:O,closeOnClick:k}=s;mpe({id:s.toastId,containerId:s.containerId,fn:i}),F.useEffect(()=>{if(s.pauseOnFocusLoss)return U(),()=>{G()}},[s.pauseOnFocusLoss]);function U(){document.hasFocus()||ie(),window.addEventListener("focus",X),window.addEventListener("blur",ie)}function G(){window.removeEventListener("focus",X),window.removeEventListener("blur",ie)}function z(ee){if(s.draggable===!0||s.draggable===ee.pointerType){oe();let Q=p.current;_.canCloseOnClick=!0,_.canDrag=!0,Q.style.transition="none",s.draggableDirection==="x"?(_.start=ee.clientX,_.removalDistance=Q.offsetWidth*(s.draggablePercent/100)):(_.start=ee.clientY,_.removalDistance=Q.offsetHeight*(s.draggablePercent===80?s.draggablePercent*1.5:s.draggablePercent)/100)}}function J(ee){let{top:Q,bottom:q,left:ae,right:re}=p.current.getBoundingClientRect();ee.nativeEvent.type!=="touchend"&&s.pauseOnHover&&ee.clientX>=ae&&ee.clientX<=re&&ee.clientY>=Q&&ee.clientY<=q?ie():X()}function X(){i(!0)}function ie(){i(!1)}function oe(){_.didMove=!1,document.addEventListener("pointermove",_e),document.addEventListener("pointerup",se)}function ce(){document.removeEventListener("pointermove",_e),document.removeEventListener("pointerup",se)}function _e(ee){let Q=p.current;if(_.canDrag&&Q){_.didMove=!0,n&&ie(),s.draggableDirection==="x"?_.delta=ee.clientX-_.start:_.delta=ee.clientY-_.start,_.start!==ee.clientX&&(_.canCloseOnClick=!1);let q=s.draggableDirection==="x"?`${_.delta}px, var(--y)`:`0, calc(${_.delta}px + var(--y))`;Q.style.transform=`translate3d(${q},0)`,Q.style.opacity=`${1-Math.abs(_.delta/_.removalDistance)}`}}function se(){ce();let ee=p.current;if(_.canDrag&&_.didMove&&ee){if(_.canDrag=!1,Math.abs(_.delta)>_.removalDistance){l(!0),s.closeToast(!0),s.collapseAll();return}ee.style.transition="transform 0.2s, opacity 0.2s",ee.style.removeProperty("transform"),ee.style.removeProperty("opacity")}}let be={onPointerDown:z,onPointerUp:J};return T&&w&&(be.onMouseEnter=ie,s.stacked||(be.onMouseLeave=X)),k&&(be.onClick=ee=>{O&&O(ee),_.canCloseOnClick&&C(!0)}),{playToast:X,pauseToast:ie,isRunning:n,preventExitTransition:a,toastRef:p,eventHandlers:be}}var bpe=typeof window<"u"?F.useLayoutEffect:F.useEffect,mD=({theme:s,type:n,isLoading:i,...a})=>We.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:s==="colored"?"currentColor":`var(--toastify-icon-color-${n})`,...a});function wpe(s){return We.createElement(mD,{...s},We.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))}function Rpe(s){return We.createElement(mD,{...s},We.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))}function Cpe(s){return We.createElement(mD,{...s},We.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))}function Ape(s){return We.createElement(mD,{...s},We.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))}function Ipe(){return We.createElement("div",{className:"Toastify__spinner"})}var t2={info:Rpe,warning:wpe,success:Cpe,error:Ape,spinner:Ipe},Npe=s=>s in t2;function Ope({theme:s,type:n,isLoading:i,icon:a}){let l=null,p={theme:s,type:n};return a===!1||(hp(a)?l=a({...p,isLoading:i}):F.isValidElement(a)?l=F.cloneElement(a,p):i?l=t2.spinner():Npe(n)&&(l=t2[n](p))),l}var Dpe=s=>{let{isRunning:n,preventExitTransition:i,toastRef:a,eventHandlers:l,playToast:p}=Tpe(s),{closeButton:_,children:T,autoClose:w,onClick:C,type:O,hideProgressBar:k,closeToast:U,transition:G,position:z,className:J,style:X,progressClassName:ie,updateId:oe,role:ce,progress:_e,rtl:se,toastId:be,deleteToast:ee,isIn:Q,isLoading:q,closeOnClick:ae,theme:re,ariaLabel:fe}=s,pe=$i("Toastify__toast",`Toastify__toast-theme--${re}`,`Toastify__toast--${O}`,{"Toastify__toast--rtl":se},{"Toastify__toast--close-on-click":ae}),Re=hp(J)?J({rtl:se,position:z,type:O,defaultClassName:pe}):$i(pe,J),Ge=Ope(s),ve=!!_e||!w,Ne={closeToast:U,type:O,theme:re},Ce=null;return _===!1||(hp(_)?Ce=_(Ne):F.isValidElement(_)?Ce=F.cloneElement(_,Ne):Ce=ape(Ne)),We.createElement(G,{isIn:Q,done:ee,position:z,preventExitTransition:i,nodeRef:a,playToast:p},We.createElement("div",{id:be,tabIndex:0,onClick:C,"data-in":Q,className:Re,...l,style:X,ref:a,...Q&&{role:ce,"aria-label":fe}},Ge!=null&&We.createElement("div",{className:$i("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!q})},Ge),lK(T,s,!n),Ce,!s.customProgressBar&&We.createElement(ope,{...oe&&!ve?{key:`p-${oe}`}:{},rtl:se,theme:re,delay:w,isRunning:n,isIn:Q,closeToast:U,hide:k,type:O,className:ie,controlledProgress:ve,progress:_e||0})))},xpe=(s,n=!1)=>({enter:`Toastify--animate Toastify__${s}-enter`,exit:`Toastify--animate Toastify__${s}-exit`,appendPosition:n}),Ppe=spe(xpe("bounce",!0)),kpe={position:"top-right",transition:Ppe,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light","aria-label":"Notifications Alt+T",hotKeys:s=>s.altKey&&s.code==="KeyT"};function rj(s){let n={...kpe,...s},i=s.stacked,[a,l]=F.useState(!0),p=F.useRef(null),{getToastToRender:_,isToastActive:T,count:w}=Spe(n),{className:C,style:O,rtl:k,containerId:U,hotKeys:G}=n;function z(X){let ie=$i("Toastify__toast-container",`Toastify__toast-container--${X}`,{"Toastify__toast-container--rtl":k});return hp(C)?C({position:X,rtl:k,defaultClassName:ie}):$i(ie,JM(C))}function J(){i&&(l(!0),ct.play())}return bpe(()=>{var X;if(i){let ie=p.current.querySelectorAll('[data-in="true"]'),oe=12,ce=(X=n.position)==null?void 0:X.includes("top"),_e=0,se=0;Array.from(ie).reverse().forEach((be,ee)=>{let Q=be;Q.classList.add("Toastify__toast--stacked"),ee>0&&(Q.dataset.collapsed=`${a}`),Q.dataset.pos||(Q.dataset.pos=ce?"top":"bot");let q=_e*(a?.2:1)+(a?0:oe*ee);Q.style.setProperty("--y",`${ce?q:q*-1}px`),Q.style.setProperty("--g",`${oe}`),Q.style.setProperty("--s",`${1-(a?se:0)}`),_e+=Q.offsetHeight,se+=.025})}},[a,w,i]),F.useEffect(()=>{function X(ie){var oe;let ce=p.current;G(ie)&&((oe=ce.querySelector('[tabIndex="0"]'))==null||oe.focus(),l(!1),ct.pause()),ie.key==="Escape"&&(document.activeElement===ce||ce!=null&&ce.contains(document.activeElement))&&(l(!0),ct.play())}return document.addEventListener("keydown",X),()=>{document.removeEventListener("keydown",X)}},[G]),We.createElement("section",{ref:p,className:"Toastify",id:U,onMouseEnter:()=>{i&&(l(!1),ct.pause())},onMouseLeave:J,"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text","aria-label":n["aria-label"]},_((X,ie)=>{let oe=ie.length?{...O}:{...O,pointerEvents:"none"};return We.createElement("div",{tabIndex:-1,className:z(X),"data-stacked":i,style:oe,key:`c-${X}`},ie.map(({content:ce,props:_e})=>We.createElement(Dpe,{..._e,stacked:i,collapseAll:J,isIn:T(_e.toastId,_e.containerId),key:`t-${_e.key}`},ce)))}))}function eN(){const s=localStorage.removeItem("doctor-app"),n=localStorage.getItem("anyoneJoin");!n&&!s&&ct.error("Token Expired"),localStorage.removeItem("nfc-admin"),setTimeout(()=>{n||(window.location.href="/")},1e3)}const SN=Zt("doctor/emailCheck",async(s,{rejectWithValue:n})=>{var i;try{return(await rhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),TN=Zt("doctor/login",async(s,{rejectWithValue:n})=>{var i;try{return(await ihe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),bN=Zt("doctor/forgotPassword",async(s,{rejectWithValue:n})=>{var i;try{return(await she(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),wN=Zt("doctor/otpVerification",async(s,{rejectWithValue:n})=>{var i;try{return(await ahe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),RN=Zt("doctor/resendOtp",async(s,{rejectWithValue:n})=>{var i;try{return(await ohe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),CN=Zt("doctor/resetPassword",async(s,{rejectWithValue:n})=>{var i;try{return(await che(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),AN=Zt("doctor/firstLogin",async(s,{rejectWithValue:n})=>{var i;try{return(await lhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),T_=Zt("doctor/getDoctorProfile",async(s,{rejectWithValue:n})=>{var i;try{return(await dhe()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),IN=Zt("doctor/doctorProfileUpdate",async(s,{rejectWithValue:n})=>{var i;try{return(await uhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),NN=Zt("doctor/doctorPhotoUpdate",async(s,{rejectWithValue:n})=>{var i;try{return(await hhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),ON=Zt("doctor/deleteDoctorPhoto",async(s,{rejectWithValue:n})=>{var i;try{return(await phe()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),DN=Zt("doctor/doctorPendingPrescriptions",async(s,{rejectWithValue:n})=>{var i;try{return(await fhe()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),zL=Zt("doctor/doctorCompletedPrescriptions",async(s,{rejectWithValue:n})=>{var i;try{return(await mhe()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),xN=Zt("doctor/symptomUploadDetails",async(s,{rejectWithValue:n})=>{var i;try{return(await _he(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),YL=Zt("doctor/completePrescription",async(s,{rejectWithValue:n})=>{var i;try{return(await Ehe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),PN=Zt("doctor/logout",async(s,{rejectWithValue:n})=>{var i;try{return(await The(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),Fw=Zt("user/medicineSearch",async(s,{rejectWithValue:n})=>{var i;try{return(await Mhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),qL=Zt("user/getAllUser",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}});Zt("user/userId",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}});const KL=Zt("user/create",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),XL=Zt("user/editUser",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),QL=Zt("user/delete",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),Lpe=om({name:"user",initialState:{user:[],pendingPrescription:[],completedPrescription:[],symptomUploadDetail:[],medicineSearch:[],completeAssignedPrescription:null,loading:!1,loading2:!1,error:null,message:null},reducers:{},extraReducers:s=>{s.addCase(SN.pending,n=>{n.loading=!0,n.error=null}).addCase(SN.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(SN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(TN.pending,n=>{n.loading=!0,n.error=null}).addCase(TN.fulfilled,(n,i)=>{var a,l;n.loading=!1,n.user=i.payload,localStorage.setItem("doctor-app",JSON.stringify({doctorData:(a=i.payload.data)==null?void 0:a.doctor,token:(l=i.payload.data)==null?void 0:l.token}))}).addCase(TN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload,ct.error(i.payload.message)}).addCase(bN.pending,n=>{n.loading=!0,n.error=null}).addCase(bN.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(bN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(wN.pending,n=>{n.loading=!0,n.error=null}).addCase(wN.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(wN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(RN.pending,n=>{n.loading=!0,n.error=null}).addCase(RN.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(RN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(CN.pending,n=>{n.loading=!0,n.error=null}).addCase(CN.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(CN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(AN.pending,n=>{n.loading=!0,n.error=null}).addCase(AN.fulfilled,(n,i)=>{var a,l;n.loading=!1,n.user=i.payload,localStorage.setItem("doctor-app",JSON.stringify({doctorData:(a=i.payload.data)==null?void 0:a.doctor,token:(l=i.payload.data)==null?void 0:l.token}))}).addCase(AN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(T_.pending,n=>{n.loading=!0,n.error=null}).addCase(T_.fulfilled,(n,i)=>{var a,l;n.loading=!1,n.user=(l=(a=i.payload)==null?void 0:a.data)==null?void 0:l.doctor}).addCase(T_.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(IN.pending,n=>{n.loading=!0,n.error=null}).addCase(IN.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(IN.rejected,(n,i)=>{var a,l,p,_,T,w;n.loading=!1,n.error=i.payload,ct.error(((p=(l=(a=i.payload)==null?void 0:a.data)==null?void 0:l.experience)==null?void 0:p[0])||((w=(T=(_=i.payload)==null?void 0:_.data)==null?void 0:T.contact_no)==null?void 0:w[0]))}).addCase(NN.pending,n=>{n.loading=!0,n.error=null}).addCase(NN.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(NN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(ON.pending,n=>{n.loading=!0,n.error=null}).addCase(ON.fulfilled,(n,i)=>{n.loading=!1,n.user&&(n.user.profile_path=null)}).addCase(ON.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(DN.pending,n=>{n.loading=!0,n.error=null}).addCase(DN.fulfilled,(n,i)=>{var a;n.loading=!1,n.pendingPrescription=(a=i.payload.data)==null?void 0:a.pending_prescriptions}).addCase(DN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(zL.pending,n=>{n.loading=!0,n.error=null}).addCase(zL.fulfilled,(n,i)=>{var a;n.loading=!1,n.completedPrescription=(a=i.payload.data)==null?void 0:a.completed_prescriptions}).addCase(zL.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(xN.pending,n=>{n.loading=!0,n.error=null}).addCase(xN.fulfilled,(n,i)=>{n.loading=!1,n.symptomUploadDetail=i.payload.data}).addCase(xN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(YL.pending,n=>{n.loading=!0,n.error=null}).addCase(YL.fulfilled,(n,i)=>{n.loading=!1,n.completeAssignedPrescription=i.payload}).addCase(YL.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(PN.pending,n=>{n.loading=!0,n.error=null}).addCase(PN.fulfilled,n=>{n.loading=!1,n.user=null,localStorage.removeItem("doctor-app")}).addCase(PN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(Fw.pending,n=>{n.loading2=!0,n.error=null}).addCase(Fw.fulfilled,(n,i)=>{var a,l;n.loading2=!1,n.medicineSearch=(l=(a=i.payload)==null?void 0:a.data)==null?void 0:l.results}).addCase(Fw.rejected,(n,i)=>{n.loading2=!1,n.error=i.payload||"Failed to search medicine",ct.error(i.payload.message||"Failed to search medicine")}).addCase(qL.pending,n=>{n.loading=!0,n.error=null}).addCase(qL.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(qL.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&eN()}).addCase(KL.pending,n=>{n.loading=!0,n.error=null}).addCase(KL.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload,n.message="User created successfully",ct.success(i.payload.message||"User created successfully")}).addCase(KL.rejected,(n,i)=>{var a;n.loading=!1,n.error=((a=i.payload)==null?void 0:a.errors)||"User creation failed",i.payload.message=="Unauthenticated."&&eN()}).addCase(XL.pending,n=>{n.loading=!0,n.error=null}).addCase(XL.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload,n.message="User updated successfully"}).addCase(XL.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to update user",i.payload.message=="Unauthenticated."&&eN()}).addCase(QL.pending,n=>{n.loading=!0,n.error=null}).addCase(QL.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload,n.message="User Deleted successfully",ct.success(i.payload.message||"User deleted successfully")}).addCase(QL.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to delete user",ct.error(i.payload.message||"Failed to delete user"),i.payload.message=="Unauthenticated."&&eN()})}}),Mpe=Lpe.reducer;var mK={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},w8=We.createContext&&We.createContext(mK),jpe=["attr","size","title"];function Upe(s,n){if(s==null)return{};var i=Vpe(s,n),a,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(s);for(l=0;l<p.length;l++)a=p[l],!(n.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(s,a)&&(i[a]=s[a])}return i}function Vpe(s,n){if(s==null)return{};var i={};for(var a in s)if(Object.prototype.hasOwnProperty.call(s,a)){if(n.indexOf(a)>=0)continue;i[a]=s[a]}return i}function SO(){return SO=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(s[a]=i[a])}return s},SO.apply(this,arguments)}function R8(s,n){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),i.push.apply(i,a)}return i}function TO(s){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?R8(Object(i),!0).forEach(function(a){Fpe(s,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):R8(Object(i)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(i,a))})}return s}function Fpe(s,n,i){return n=Bpe(n),n in s?Object.defineProperty(s,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[n]=i,s}function Bpe(s){var n=Hpe(s,"string");return typeof n=="symbol"?n:n+""}function Hpe(s,n){if(typeof s!="object"||!s)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var a=i.call(s,n);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(s)}function gK(s){return s&&s.map((n,i)=>We.createElement(n.tag,TO({key:i},n.attr),gK(n.child)))}function U_(s){return n=>We.createElement(Gpe,SO({attr:TO({},s.attr)},n),gK(s.child))}function Gpe(s){var n=i=>{var{attr:a,size:l,title:p}=s,_=Upe(s,jpe),T=l||i.size||"1em",w;return i.className&&(w=i.className),s.className&&(w=(w?w+" ":"")+s.className),We.createElement("svg",SO({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,a,_,{className:w,style:TO(TO({color:s.color||i.color},i.style),s.style),height:T,width:T,xmlns:"http://www.w3.org/2000/svg"}),p&&We.createElement("title",null,p),s.children)};return w8!==void 0?We.createElement(w8.Consumer,null,i=>n(i)):n(mK)}function $L(){const s=localStorage.removeItem("doctor-app"),n=localStorage.getItem("anyoneJoin");!n&&!s&&ct.error("Token Expired"),localStorage.removeItem("nfc-admin"),setTimeout(()=>{n||(window.location.href="/")},1e3)}const np=Zt("notification/getAllNotifications",async(s,{rejectWithValue:n})=>{var i;try{return(await Phe()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),kN=Zt("doctor/deleteNotification",async(s,{rejectWithValue:n})=>{var i;try{const a=await khe(s);return{deletedIds:s}}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),Bw=Zt("doctor/markAllRead",async(s,{rejectWithValue:n})=>{var i;try{return(await Lhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),Ov=Zt("/doctor/unreadCount",async(s,{rejectWithValue:n})=>{var i;try{return(await jhe()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),LN=Zt("/doctor/checkToggleNotification",async(s,{rejectWithValue:n})=>{var i;try{return(await Uhe()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),MN=Zt("/doctor/changeAppointmentNotificaiton",async(s,{rejectWithValue:n})=>{var i;try{return(await Vhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),jN=Zt("/getChat",async(s,{rejectWithValue:n})=>{var i;try{return(await zhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}});Zt("/doctor/toggleNotifications",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}});const Hw=Zt("/doctor/reminderPopup",async(s,{rejectWithValue:n})=>{var i;try{return(await Bhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),Wpe=om({name:"Notification",initialState:{doctorNotifications:[],unreadCounts:[],isNotificationActive:!1,reminderPopupData:[],loading:!1,error:null,newNotificaion:null},reducer:{},extraReducers:s=>{s.addCase(np.pending,n=>{n.loading=!0,n.error=null}).addCase(np.fulfilled,(n,i)=>{n.loading=!1,n.doctorNotifications=i.payload.data}).addCase(np.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&$L()}).addCase(kN.pending,n=>{n.loading=!0,n.error=null}).addCase(kN.fulfilled,(n,i)=>{const a=i.payload.deletedIds,l=p=>(p==null?void 0:p.filter(_=>!a.includes(_.id)))??[];n.doctorNotifications.today=l(n.doctorNotifications.today),n.doctorNotifications.yesterday=l(n.doctorNotifications.yesterday),n.doctorNotifications.older=l(n.doctorNotifications.older)}).addCase(kN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&$L()}).addCase(Bw.pending,n=>{n.loading=!0,n.error=null}).addCase(Bw.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload}).addCase(Bw.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to update user",i.payload.message=="Unauthenticated."&&$L()}).addCase(Ov.pending,n=>{n.loading=!0,n.error=null}).addCase(Ov.fulfilled,(n,i)=>{n.loading=!1,n.unreadCounts=i.payload.data.count}).addCase(Ov.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch unread count"}).addCase(LN.pending,n=>{n.loading=!0}).addCase(LN.fulfilled,(n,i)=>{n.loading=!1,n.isNotificationActive=i.payload.data.isActive}).addCase(LN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to Get Notification Status"}).addCase(jN.pending,n=>{n.loading=!0}).addCase(jN.fulfilled,(n,i)=>{var a,l,p;n.loading=!1,n.newNotificaion=i.payload.data,((a=i.payload.data)==null?void 0:a.notification_count)==0||(l=i.payload.data)!=null&&l.notification_message&&ct.success((p=i.payload.data)==null?void 0:p.notification_message)}).addCase(jN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to Get Notification Status"}).addCase(MN.pending,n=>{n.loading=!0}).addCase(MN.fulfilled,(n,i)=>{n.loading=!1,n.isNotificationActive=i.payload.data.isActive}).addCase(MN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to Update Notification Status"}).addCase(Hw.pending,n=>{n.loading=!0}).addCase(Hw.fulfilled,(n,i)=>{n.loading=!1,n.reminderPopupData=i.payload.data}).addCase(Hw.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to Update Notification Status"})}}),zpe=Wpe.reducer,Ype="https://awplconnectadmin.tgastaging.com",jc={BaseUrl:Ype},za=()=>{var ce,_e,se;const{invitedUser:s}=hr(({info:be})=>be),[n,i]=F.useState(!1),[a,l]=F.useState(!1),[p,_]=F.useState(!1),T=es(),w=Pi(),C=Wi(),{user:O}=hr(be=>be.user),{unreadCounts:k,isNotificationActive:U}=hr(be=>be.notification),{doctorNotifications:G,loading:z,error:J}=hr(be=>be.notification),X=G==null?void 0:G.unread_new_message_count;F.useEffect(()=>{w(Ov()),w(LN())},[w]),F.useEffect(()=>{O!=null&&O.profile_path||w(T_())},[w,O]);const ie=()=>{i(!1),localStorage.removeItem("doctor-app"),w(PN()),T("/"),localStorage.removeItem("feedbackPopup")};F.useEffect(()=>{const be=JSON.parse(localStorage.getItem("doctor-app")).doctorData;be&&_(be.is_hod)},[]),F.useEffect(()=>{w(jN()),w(np())},[C==null?void 0:C.pathname]);const oe=()=>{w(MN({isActive:!U}))};return m.jsxs(m.Fragment,{children:[a&&m.jsx("div",{onClick:()=>l(!1),style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.3)",zIndex:999}}),m.jsx("div",{className:"sidebar",style:{transform:a?"translateX(0)":"translateX(-100%)",transition:"transform 0.3s ease-in-out",position:"fixed",left:0,top:0,width:"280px",height:"100%",backgroundColor:"#fff",zIndex:1e3},children:m.jsxs("div",{className:"sidebar-inr",children:[m.jsx("div",{className:"sidebar-close",onClick:()=>l(!1),style:{cursor:"pointer",padding:"10px",textAlign:"right"},children:m.jsx("i",{className:"fa-solid fa-times-circle"})}),m.jsxs("div",{className:"doc-profile-wrp",children:[m.jsx("div",{className:"doc-img ml-0 ms-0",children:m.jsx("img",{src:`${jc==null?void 0:jc.BaseUrl}${O==null?void 0:O.profile_path}`,alt:"Doctor"})}),m.jsxs("div",{className:"doc-profile-body",children:[m.jsx("p",{children:(O==null?void 0:O.prefixed_name)||"Doctor Name"}),m.jsx(mn,{to:"/UserProfile",className:"view-profile",onClick:()=>l(!1),children:"View my profile"})]})]}),m.jsx("div",{className:"sidebar-nav",children:m.jsxs("ul",{children:[m.jsxs("li",{children:[m.jsx("img",{src:"/images/dash.svg",alt:"Icon",style:{height:"18px",width:"18px"}}),m.jsx(mn,{to:"/doctor-home",onClick:()=>l(!1),children:"Dashboard"})]}),m.jsx("li",{children:m.jsxs("div",{className:"notification-set",children:[m.jsxs("div",{className:"not-set-left",children:[m.jsx("img",{src:"/images/notification-icon.svg",alt:"Notification",style:{height:"18px",width:"18px"}}),m.jsx("span",{children:"Notification"})]}),m.jsx("div",{className:"not-set-right",children:m.jsxs("div",{className:"not-toggler",children:[m.jsx("input",{type:"checkbox",id:"notificationToggle",checked:U,onChange:oe}),m.jsx("label",{htmlFor:"notificationToggle"})]})})]})}),m.jsxs("li",{children:[m.jsx("img",{src:"/images/appointment-icon.svg",alt:"Icon",style:{height:"18px",width:"18px"}}),m.jsx(mn,{to:"/my-appointments",onClick:()=>l(!1),children:"My Appointments"})]}),m.jsxs("li",{children:[m.jsx("img",{src:"/images/pending-prescription-icon.svg",alt:"Icon",style:{height:"18px",width:"18px"}}),m.jsx(mn,{to:"/pendingprescription",onClick:()=>l(!1),children:"Pending prescriptions"})]}),m.jsxs("li",{children:[m.jsx("img",{src:"/images/past-patients-icon.svg",alt:"Icon",style:{height:"18px",width:"18px"}}),m.jsx(mn,{to:"/pastpatient",onClick:()=>l(!1),children:"My Past Patients"})]}),m.jsxs("li",{children:[m.jsx("img",{src:"https://uxwing.com/wp-content/themes/uxwing/download/web-app-development/database-delete-icon.png",alt:"Icon",style:{height:"18px",width:"18px"}}),m.jsx(mn,{to:"/doctorUnavailibility",onClick:()=>l(!1),children:"Mark Unavailability"})]}),p&&(O==null?void 0:O.is_hod)&&m.jsxs("li",{children:[m.jsx("img",{src:"/images/user-tie.com.svg",alt:"Icon",style:{height:"18px",width:"18px"}}),m.jsx(mn,{to:"/hod",onClick:()=>l(!1),children:"Unavailability Management"})]}),m.jsxs("li",{className:"logout",children:[m.jsx("img",{src:"/images/menu-logout-icon.svg",alt:"Icon",style:{height:"18px",width:"18px"}}),m.jsxs(Qr,{variant:"link",style:{textDecoration:"none",color:"black",fontWeight:"600",textTransform:"none"},onClick:()=>i(!0),children:["Logout ",m.jsx("i",{className:"fa-solid fa-chevron-right"})]})]})]})})]})}),m.jsxs("div",{className:"doc-panel-header",style:{display:"flex",alignItems:"center",padding:"15px 10px",background:"#fff",justifyContent:"space-between"},children:[m.jsx("button",{type:"button",className:"docpnl-hdr-toggler",onClick:()=>l(!0),style:{background:"transparent",border:"none",cursor:"pointer"},children:((ce=s==null?void 0:s.data)==null?void 0:ce.type)==="admin"?null:m.jsx("img",{src:"/images/bars.svg",alt:"Menu"})}),m.jsx("div",{className:"logo",children:m.jsx(mn,{to:"/doctor-home",children:m.jsx("img",{src:"/images/logo.png",alt:"Logo"})})}),m.jsxs("div",{className:"notifications",children:[((_e=s==null?void 0:s.data)==null?void 0:_e.type)==="admin"?null:m.jsx(mn,{to:"/notifications",children:m.jsx("img",{src:"/images/notification-icon-2.svg",alt:"Notification"})}),((se=s==null?void 0:s.data)==null?void 0:se.type)==="admin"?null:X>0&&m.jsx("div",{style:{backgroundColor:"red",width:X>9?"25px":"20px",height:"20px",borderRadius:"10px",color:"white",position:"absolute",top:-10,right:0},children:m.jsx("p",{style:{fontWeight:"bold",marginLeft:5},children:X>9?"9+":X})}),X===0&&k>0&&m.jsx("span",{})]})]}),n&&m.jsx("div",{className:"modal fade show popup-wrp small-pop dash-pop",tabIndex:"-1",style:{display:"block",background:"rgba(0,0,0,0.5)"},children:m.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:m.jsxs("div",{className:"modal-content",children:[m.jsx("button",{type:"button",className:"close",onClick:()=>i(!1),"aria-label":"Close",children:m.jsx("span",{"aria-hidden":"true",children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close"})})}),m.jsx("div",{className:"modal-icon",children:m.jsx("img",{src:"/images/logout-icon.svg",alt:"Icon"})}),m.jsxs("div",{className:"modal-header",children:[m.jsx("h2",{children:"Logout"}),m.jsx("p",{children:"Are you sure you want to logout?"})]}),m.jsxs("div",{className:"modal-footer btn-wrp",children:[m.jsx("button",{type:"button",className:"cmn-btn",onClick:()=>i(!1),children:"Cancel"}),m.jsx("button",{type:"button",className:"cmn-btn orange-btn",onClick:ie,children:"Logout"})]})]})})})]})},fo=()=>m.jsxs("div",{className:"panel-footer",children:[m.jsx("div",{className:"copyright",children:m.jsxs("p",{children:[" ",m.jsx("span",{className:"curryr",children:new Date().getFullYear()})," . All rights reserved."]})}),m.jsx("div",{className:"ftr-right"})]}),qpe=()=>{const[s,n]=F.useState(!1),i=Pi(),{loading:a}=hr(O=>O.user),[l,p]=F.useState(""),[_,T]=F.useState(""),w=es();F.useEffect(()=>{localStorage.getItem("doctor-app")&&w("/doctor-home")},[]);const C=async O=>{var G,z,J,X;if(O.preventDefault(),!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(l)){T("Please enter a valid email address");return}T("");const U=await i(SN({email:l}));((G=U.payload.data)==null?void 0:G.verified)==1&&((z=U.payload.data)==null?void 0:z.new_user)==1?w("/create-password",{state:{email:l}}):((J=U.payload.data)==null?void 0:J.verified)==1&&((X=U.payload.data)==null?void 0:X.new_user)==0?w("/login-password",{state:{email:l}}):n(!0)};return m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"sign-sec",children:m.jsx("div",{className:"container",children:m.jsx("div",{className:"sign-sec-inr",children:m.jsxs("div",{className:"sign-inr-row row",children:[m.jsx("div",{className:"sign-left-wrp col-lg-7",children:m.jsxs("div",{className:"sign-left has-texture",children:[m.jsx("div",{className:"texture",children:m.jsx("img",{src:"./images/doctor-symbol.png",alt:"Doctor Symbol"})}),m.jsx("div",{className:"sign-left-img",children:m.jsx("img",{src:"./images/login-left-img.png",alt:"Login Left Image"})})]})}),m.jsx("div",{className:"sign-right-wrp col-lg-5",children:m.jsxs("div",{className:"sign-right",children:[m.jsx("div",{className:"logo-wrp",children:m.jsx("div",{className:"logo-inr-wrp",children:m.jsx("span",{children:m.jsx("img",{src:"./images/logo.png",alt:"Logo"})})})}),m.jsxs("div",{className:"sign-inr-head",children:[m.jsx("h1",{children:"Login as Doctor"}),m.jsx("p",{children:"Use credentials to access your account"})]}),m.jsx("div",{className:"sign-form",children:m.jsx("form",{onSubmit:C,children:m.jsx("div",{className:"sign-form-steps-wrp",children:m.jsxs("div",{className:"sign-form-step email-step",children:[m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Enter Email Id"}),m.jsx("input",{type:"email",placeholder:"Enter Your Email Id",required:!0,value:l,onChange:O=>{p(O.target.value),_&&T("")}}),_&&m.jsx("div",{className:"text-danger mt-1",style:{fontSize:"0.9rem"},children:_})]}),m.jsx("input",{type:"submit",value:"Next"})]})})})})]})})]})})})}),m.jsx(Cn,{show:s,onHide:()=>n(!1),centered:!0,className:"popup-wrp",children:m.jsxs(Cn.Body,{className:"text-center",children:[m.jsx("div",{className:"modal-icon",children:m.jsx("img",{src:"/images/wrong-mail-icon.png",alt:"Icon"})}),m.jsxs(Cn.Header,{className:"modal-header",children:[m.jsx("h2",{children:"Unrecognized Email Id"}),m.jsx("p",{children:"Your Email Id is not registered yet."})]}),m.jsx(Cn.Footer,{className:"modal-footer",children:m.jsx(Qr,{className:"orange-btn",onClick:()=>n(!1),children:"OK"})})]})})]})},Kpe=()=>{const s=es(),n=Pi(),{loading:i}=hr(J=>J.user),a=Wi(),{email:l,password:p}=a.state||{},[_,T]=F.useState(""),[w,C]=F.useState(!1),[O,k]=F.useState(!1),U=async J=>{if(J.preventDefault(),!/^(?=.*[a-z])(?=.*[A-Z])(?=.*[\d\W]).{8,}$/.test(_)){ct.error("Please enter a valid password");return}const ie=await n(TN({email:l,password:_}));ie.payload&&ie.payload.status&&C(!0)},G=()=>{k(J=>!J)},z=()=>{C(!1),s("/doctor-home",{replace:!0})};return m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"sign-sec",children:m.jsx("div",{className:"container",children:m.jsx("div",{className:"sign-sec-inr",children:m.jsxs("div",{className:"sign-inr-row row",children:[m.jsx("div",{className:"sign-left-wrp col-lg-7",children:m.jsxs("div",{className:"sign-left has-texture",children:[m.jsx("div",{className:"texture",children:m.jsx("img",{src:"./images/doctor-symbol.png",alt:"Doctor Symbol"})}),m.jsx("div",{className:"sign-left-img",children:m.jsx("img",{src:"./images/login-left-img.png",alt:"Login Left Image"})})]})}),m.jsx("div",{className:"sign-right-wrp col-lg-5",children:m.jsxs("div",{className:"sign-right",children:[m.jsx("div",{className:"logo-wrp",children:m.jsx("div",{className:"logo-inr-wrp",children:m.jsx("span",{children:m.jsx("img",{src:"./images/logo.png",alt:"Logo"})})})}),m.jsxs("div",{className:"sign-inr-head",children:[m.jsx("h1",{children:"Login as Doctor"}),m.jsx("p",{children:"Use credentials to access your account"})]}),m.jsx("div",{className:"sign-form",children:m.jsx("form",{onSubmit:U,children:m.jsx("div",{className:"sign-form-steps-wrp",children:m.jsxs("div",{className:"sign-form-step",children:[m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Enter Password"}),m.jsxs("div",{className:"input-pass-field",children:[m.jsx("input",{type:O?"text":"password",id:"password",placeholder:"Password",required:!0,value:_,onChange:J=>T(J.target.value)}),m.jsx("span",{className:"eye-btn",onClick:G,style:{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",cursor:"pointer"},children:m.jsx("img",{src:O?"./images/eye-open.svg":"./images/eye-close.svg",alt:O?"Hide password":"Show password"})})]})]}),m.jsx("div",{className:"text-right",children:m.jsx(mn,{to:"/forgot-password",className:"forgot-pass",children:"Forgot password?"})}),m.jsxs("button",{type:"submit",className:"orange-btn",children:[" ","Login"," "]})]})})})})]})})]})})})}),m.jsxs(Cn,{show:w,onHide:()=>{},centered:!0,className:"popup-wrp",id:"congratulations",dialogClassName:"custom-modal",children:[m.jsx("style",{children:`
                      .custom-modal .modal-content{
                        padding:30px 0 50px 0;
                        margin:0;
                      }
            
                    `}),m.jsx("div",{className:"modal-icon text-center mt-4",children:m.jsx("img",{src:"/images/check-icon.png",alt:"Icon"})}),m.jsxs(Cn.Header,{className:"border-0 flex-column text-center",children:[m.jsx(Cn.Title,{id:"exampleModalLongTitle",className:"w-100",children:m.jsx("h2",{children:"Login Successful"})}),m.jsx("p",{children:"Welcome to the world of health."})]}),m.jsx(Cn.Footer,{className:"d-flex justify-content-center border-0",children:m.jsx("button",{className:"orange-btn",onClick:z,children:"Ok"})})]})]})},Xpe=()=>{const s=es(),n=Pi(),[i,a]=F.useState(""),{loading:l}=hr(_=>_.user),p=async _=>{if(_.preventDefault(),!i.trim()){ct.error("Please enter the email");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){ct.error("Invalid email");return}(await n(bN({email:i}))).payload.status?s("/otp-verification",{state:{sendEmail:i}}):ct.error("Email is not registered")};return m.jsx("div",{className:"sign-sec pt-0",children:m.jsx("div",{className:"container",children:m.jsxs("div",{className:"sign-sec-inr",children:[m.jsx("div",{className:"docpnl-sec-head",style:{padding:"0",margin:"0"},children:m.jsx("div",{className:"back-btn",style:{padding:"0",margin:"0"},children:m.jsx(mn,{to:"/",children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})}),m.jsxs("div",{className:"sign-inr-row row",style:{padding:"0",margin:"0"},children:[m.jsx("div",{className:"sign-left-wrp col-lg-7",style:{padding:"0",margin:"0"},children:m.jsxs("div",{className:"sign-left has-texture",children:[m.jsx("div",{className:"texture",children:m.jsx("img",{src:"./images/doctor-symbol.png",alt:"Doctor Symbol"})}),m.jsx("div",{className:"sign-left-img",children:m.jsx("img",{src:"./images/forgot-pass-bnr.png",alt:"Forgot Password Banner",style:{width:"80%"}})})]})}),m.jsx("div",{className:"sign-right-wrp col-lg-5",style:{padding:"0",margin:"0"},children:m.jsxs("div",{className:"sign-right",children:[m.jsx("div",{className:"logo-wrp",children:m.jsx("div",{className:"logo-inr-wrp",children:m.jsx("span",{children:m.jsx("img",{src:"./images/logo.png",alt:"Logo"})})})}),m.jsxs("div",{className:"sign-inr-head",children:[m.jsx("h1",{children:"Forgot Password"}),m.jsx("p",{children:"Select which contact details should be used to reset your password"})]}),m.jsx("div",{className:"sign-form",children:m.jsx("form",{onSubmit:p,children:m.jsx("div",{className:"sign-form-steps-wrp",children:m.jsxs("div",{className:"sign-form-step",children:[m.jsxs("div",{className:"formfield mb-0",children:[m.jsx("label",{children:"Enter Email Id"}),m.jsx("input",{type:"email",placeholder:"Enter Your Email Id",value:i,onChange:_=>a(_.target.value)})]}),m.jsx("input",{type:"submit",value:l?"Loading...":"Continue"})]})})})})]})})]})]})})})},Qpe=()=>{const s=Pi(),n=es(),i=Wi(),[a,l]=F.useState(0),{sendEmail:p}=i.state||{},[_,T]=F.useState(!1),w=p,[C,O]=F.useState(["","","","",""]),k=F.useRef([]);F.useEffect(()=>{if(a>0){const oe=setInterval(()=>{l(ce=>ce-1)},1e3);return()=>clearInterval(oe)}},[a]);const U=(oe,ce)=>{if(ce.length>1)return;const _e=[...C];_e[oe]=ce,O(_e),ce&&oe<4&&k.current[oe+1].focus()},G=(oe,ce)=>{ce.key==="Backspace"&&!C[oe]&&oe>0&&k.current[oe-1].focus()},z=oe=>{oe.preventDefault();const ce=oe.clipboardData.getData("text/plain").slice(0,5),_e=[...C];ce.split("").forEach((se,be)=>{be<5&&(_e[be]=se,be<4&&k.current[be+1].focus())}),O(_e)},J=async oe=>{if(oe.preventDefault(),C.some(_e=>_e===""))return ct.error("Please enter the OTP");(await s(wN({email:p,otp:C.join("")}))).payload.status?n("/set-password",{state:{email:w}}):ct.error("Please enter the correct OTP.")},X=async oe=>{if(oe.preventDefault(),a>0)return;(await s(RN({email:w,otp:C.join("")}))).payload.status?(ct.success("OTP resent successfully."),l(120)):ct.error("Failed to resend OTP.")},ie=oe=>{const ce=Math.floor(oe/60),_e=oe%60,se=String(ce).padStart(2,"0"),be=String(_e).padStart(2,"0");return`${se}:${be}`};return m.jsx(m.Fragment,{children:m.jsx("div",{className:"sign-sec pt-0",children:m.jsx("div",{className:"container",children:m.jsxs("div",{className:"sign-sec-inr",children:[m.jsx("div",{className:"docpnl-sec-head",style:{padding:"0",margin:"0"},children:m.jsx("div",{className:"back-btn",style:{padding:"0",margin:"0"},children:m.jsx(mn,{to:"/forgot-password",children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})}),m.jsxs("div",{className:"sign-inr-row row",style:{padding:"0",margin:"0"},children:[m.jsx("div",{className:"sign-left-wrp col-lg-7",style:{padding:"0",margin:"0"},children:m.jsxs("div",{className:"sign-left has-texture",children:[m.jsx("div",{className:"texture",children:m.jsx("img",{src:"./images/doctor-symbol.png",alt:"Doctor Symbol"})}),m.jsx("div",{className:"sign-left-img",children:m.jsx("img",{src:"./images/otp-bnr.png",alt:"OTP Banner",style:{width:"63%"}})})]})}),m.jsx("div",{className:"sign-right-wrp col-lg-5",style:{padding:"0",margin:"0"},children:m.jsxs("div",{className:"sign-right",children:[m.jsx("div",{className:"logo-wrp",children:m.jsx("div",{className:"logo-inr-wrp",children:m.jsx("span",{children:m.jsx("img",{src:"./images/logo.png",alt:"Logo"})})})}),m.jsxs("div",{className:"sign-inr-head",children:[m.jsx("h1",{children:"Enter Verification Code"}),m.jsx("p",{children:"We have sent the code verification to your registered email id"})]}),m.jsx("div",{className:"sign-form",children:m.jsx("form",{onSubmit:J,children:m.jsx("div",{className:"sign-form-steps-wrp",children:m.jsxs("div",{className:"sign-form-step",children:[m.jsx("div",{className:"formfield",children:m.jsx("div",{className:"otp-container",style:{display:"flex",gap:"10px",justifyContent:"center",marginBottom:"10px"},children:[0,1,2,3,4].map(oe=>m.jsx("input",{id:`otp-${oe}`,ref:ce=>k.current[oe]=ce,type:"number",maxLength:1,value:C[oe],className:"otp-verification-code-in",onChange:ce=>U(oe,ce.target.value),onKeyDown:ce=>G(oe,ce),onPaste:z},oe))})}),m.jsx("div",{className:"resend-code",style:{paddingRight:"18px"},children:m.jsxs("p",{children:["Didnt get a Code?",a>0?m.jsxs("span",{style:{color:"#888",marginLeft:5},children:["Resend in"," ",m.jsxs("span",{style:{color:"#199FD9"},children:[ie(a),"sec"]})]}):m.jsx(mn,{to:"#",onClick:X,style:{color:"#199FD9",marginLeft:5},children:"Resend"})]})}),m.jsx("input",{type:"submit",value:"Continue"})]})})})})]})})]})]})})})})},$pe=()=>{const[s,n]=F.useState(""),[i,a]=F.useState(""),[l,p]=F.useState(!1),[_,T]=F.useState(!1),[w,C]=F.useState(!1),O=es(),k=Pi(),U=Wi(),{email:G}=U.state||{},z=async J=>{var ie,oe;if(J.preventDefault(),s.trim()||ct.error("Please enter the password"),!i.trim()){ct.error("Please confirm your password");return}if(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*[\d\W]).{8,}$/.test(s)){ct.error("Password must be at least 8 characters long and include at least one uppercase letter, one lowercase letter, and one number or special character.");return}if(s!==i){ct.error("Passwords do not match");return}try{const ce=await k(CN({email:G,password:s}));(ie=ce.payload)!=null&&ie.status?C(!0):ct.error(((oe=ce.payload)==null?void 0:oe.message)||"Password reset failed")}catch{ct.error("An error occurred during password reset")}};return m.jsxs("div",{className:"sign-sec set-pass pt-0",children:[m.jsx("div",{className:"container",children:m.jsxs("div",{className:"sign-sec-inr",children:[m.jsx("div",{className:"docpnl-sec-head",children:m.jsx("div",{className:"back-btn",children:m.jsx(mn,{to:"/login-password",children:m.jsx("img",{src:"/images/left-arrow.svg",alt:"Icon"})})})}),m.jsxs("div",{className:"sign-inr-row row",children:[m.jsx("div",{className:"sign-left-wrp col-lg-7",children:m.jsxs("div",{className:"sign-left has-texture",children:[m.jsx("div",{className:"texture",children:m.jsx("img",{src:"/images/doctor-symbol.png",alt:"Doctor Symbol"})}),m.jsx("div",{className:"sign-left-img",children:m.jsx("img",{src:"/images/new-pass-bnr.png",alt:"Login Left Image"})})]})}),m.jsx("div",{className:"sign-right-wrp col-lg-5",children:m.jsxs("div",{className:"sign-right",children:[m.jsx("div",{className:"logo-wrp",children:m.jsx("div",{className:"logo-inr-wrp",children:m.jsx("span",{children:m.jsx("img",{src:"/images/logo.png",alt:"Logo"})})})}),m.jsxs("div",{className:"sign-inr-head",children:[m.jsx("h1",{children:"Enter New Password"}),m.jsx("p",{children:"Please enter your new password"})]}),m.jsx("div",{className:"sign-form",children:m.jsx("form",{onSubmit:z,children:m.jsx("div",{className:"sign-form-steps-wrp",children:m.jsxs("div",{className:"sign-form-step",children:[m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Enter New Password"}),m.jsxs("div",{className:"input-pass-field position-relative",children:[m.jsx("input",{type:l?"text":"password",placeholder:"Password",value:s,onChange:J=>{n(J.target.value)}}),m.jsx("span",{className:"eye-btn",onClick:()=>{p(!l)},style:{cursor:"pointer",position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)"},children:m.jsx("img",{src:l?"/images/eye-open.svg":"/images/eye-close.svg",alt:l?"Hide Password":"Show Password"})})]})]}),m.jsxs("div",{className:"formfield mb-0",children:[m.jsx("label",{children:"Confirm New Password"}),m.jsxs("div",{className:"input-pass-field position-relative",children:[m.jsx("input",{type:_?"text":"password",placeholder:"Password",value:i,onChange:J=>{a(J.target.value)}}),m.jsx("span",{className:"eye-btn",onClick:()=>{T(!_)},style:{cursor:"pointer",position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)"},children:m.jsx("img",{src:_?"/images/eye-open.svg":"/images/eye-close.svg",alt:_?"Hide Password":"Show Password"})})]})]}),m.jsx(Qr,{type:"submit",className:"orange-btn mt-3",children:"Continue"})]})})})})]})})]})]})}),m.jsxs(Cn,{show:w,onHide:()=>C(!1),centered:!0,className:"popup-wrp",dialogClassName:"custom-modal",children:[m.jsx("style",{children:`
    .custom-modal .modal-content {
      padding: 30px 0 50px 0;
      margin: 0;
      position: relative; /* needed for absolute close icon */
    }
  `}),m.jsx("div",{className:"modal-icon text-center mt-4",children:m.jsx("img",{src:"/images/check-icon.png",alt:"Success"})}),m.jsx("span",{"aria-hidden":"true",onClick:()=>{C(!1),O("/login-password")},style:{position:"absolute",top:"15px",right:"15px",cursor:"pointer",zIndex:1051},children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close"})}),m.jsxs(Cn.Header,{className:"border-0 flex-column text-center",children:[m.jsx(Cn.Title,{className:"w-100",children:m.jsx("h2",{children:"Congratulations"})}),m.jsx("p",{children:"Your account is ready to use."})]}),m.jsx(Cn.Footer,{className:"d-flex justify-content-center border-0",children:m.jsx(mn,{to:"/",className:"orange-btn",onClick:()=>C(!1),children:"Continue"})})]})]})},rp=({visible:s,title:n,subtitle:i,onCancel:a,onConfirm:l,inputField:p=!1,inputValue:_="",onInputChange:T=()=>{},actionType:w="cancel"})=>{if(!s)return null;const C=()=>{switch(w){case"cancel":return"/images/cancel-icon.png";case"success":return"/images/check-icon.png";default:return null}};return m.jsx("div",{className:"modal fade show d-block popup-wrp dash-pop",tabIndex:"-1",role:"dialog",children:m.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:m.jsxs("div",{className:`modal-content ${w==="info"?"large-pop":"small-pop"}`,children:[w!=="info"&&m.jsx("div",{className:"modal-icon",style:{cursor:w==="cancel"?"pointer":"default"},onClick:w==="cancel"?a:null,children:m.jsx("img",{src:C(),alt:"Icon"})}),w!=="success"&&m.jsx("button",{type:"button",className:"close",onClick:a,"aria-label":"Close",children:m.jsx("span",{"aria-hidden":"true",children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close"})})}),m.jsxs("div",{className:"modal-header",children:[m.jsx("h2",{children:n}),w!=="info"&&m.jsx("p",{children:i})]}),p&&m.jsx("div",{className:"modal-body",children:m.jsx("form",{children:m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Reason for cancellation."}),m.jsx("textarea",{placeholder:"Give the reason.",required:!0,value:_,onChange:O=>T(O.target.value)})]})})}),m.jsx("div",{className:"modal-footer btn-wrp",children:w==="cancel"?m.jsxs(m.Fragment,{children:[m.jsx("button",{className:"cmn-btn white-input",onClick:a,children:"No"}),m.jsx("button",{className:"orange-btn",onClick:l,children:"Yes"})]}):w==="info"?m.jsx("button",{className:"orange-btn",onClick:l,children:"Submit"}):m.jsx("button",{className:"orange-btn",onClick:l,children:"Ok"})})]})})})},f_=Zt("doctor/doctorHomeDashboard",async(s,{rejectWithValue:n})=>{var i;try{return(await She(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),Dv=Zt("/doctor/patients/past",async(s,{rejectWithValue:n})=>{var i;try{return(await Fhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),Gw=Zt("/doctor/treatments",async(s,{rejectWithValue:n})=>{var i;try{return(await Whe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),JL=Zt("doctor/videoCallSubmit",async(s,{rejectWithValue:n})=>{var i;try{return(await Ghe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),Jpe=om({name:"dataSlice",initialState:{userdata:[],pastPatients:[],videoSubmit:null,loading:!1,error:null,message:null,allMedicine:{}},reducers:{},extraReducers:s=>{s.addCase(f_.pending,n=>{n.loading=!0,n.error=null}).addCase(f_.fulfilled,(n,i)=>{n.loading=!1,n.userdata=i.payload.data}).addCase(f_.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(Gw.pending,n=>{n.loading=!0,n.error=null}).addCase(Gw.fulfilled,(n,i)=>{n.loading=!1,n.allMedicine=i.payload.data}).addCase(Gw.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(Dv.pending,n=>{n.loading=!0,n.error=null}).addCase(Dv.fulfilled,(n,i)=>{var a,l;n.loading=!1,n.pastPatients=(l=(a=i.payload)==null?void 0:a.data)==null?void 0:l.past_patients}).addCase(Dv.rejected,(n,i)=>{n.loading=!1,n.error=i.payload}).addCase(JL.pending,n=>{n.loading=!0,n.error=null}).addCase(JL.fulfilled,(n,i)=>{n.loading=!1,n.videoSubmit=i.payload}).addCase(JL.rejected,(n,i)=>{n.loading=!1,n.error=i.payload})}}),Zpe=Jpe.reducer;function Ou(){const s=localStorage.removeItem("doctor-app"),n=localStorage.getItem("anyoneJoin");!n&&!s&&ct.error("Token Expired"),localStorage.removeItem("nfc-admin"),setTimeout(()=>{n||(window.location.href="/")},1e3)}const Ww=Zt("user/getAllUpcomingAppointment",async(s,{rejectWithValue:n})=>{var i;try{return(await bhe()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),UN=Zt("user/getAllIncompletedAppointment",async(s,{rejectWithValue:n})=>{var i;try{return(await Che()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),VN=Zt("user/getAllMissedAppointment",async(s,{rejectWithValue:n})=>{var i;try{return(await Ahe()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),ZL=Zt("create-channel",async(s,{rejectWithValue:n})=>{var i;try{return(await yhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),zw=Zt("/call-notification",async(s,{rejectWithValue:n})=>{var i;try{return(await vhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),FN=Zt("user/getAllCompletedAppointment",async(s,{rejectWithValue:n})=>{var i;try{return(await whe()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),BN=Zt("user/getAllCanceledAppointment",async(s,{rejectWithValue:n})=>{var i;try{return(await Rhe()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),xv=Zt("user/doctorCanceledAppointment",async(s,{rejectWithValue:n})=>{var i;try{return(await Ihe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),HN=Zt("user/patientAppointmentDetails",async(s,{rejectWithValue:n})=>{var i;try{return(await Nhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}});Zt("user/userId",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}});const eM=Zt("user/delete",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),efe=om({name:"Appointment",initialState:{upcommingAppointment:[],upcomingLoading:!1,completedAppointment:[],completedLoading:!1,cancelledAppointment:[],cancelledLoading:!1,incompletedAppointment:[],missedAppointment:[],incompletedLoading:!1,missedLoading:!1,doctorCancelledAppointment:[],doctorcancelledLoading:!1,patientAppointmentsDetail:[],patientAppointmentsDetailLoading:!1,channelDetails:null,channelDetailsLoading:!1,pushNotificationLoading:!1,pushnotification:null,error:null},reducers:{},extraReducers:s=>{s.addCase(Ww.pending,n=>{n.upcomingLoading=!0,n.error=null}).addCase(Ww.fulfilled,(n,i)=>{var a,l;n.upcomingLoading=!1,n.upcommingAppointment=(l=(a=i.payload)==null?void 0:a.data)==null?void 0:l.upcomingAppointments}).addCase(Ww.rejected,(n,i)=>{n.upcomingLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Ou()}).addCase(FN.pending,n=>{n.completedLoading=!0,n.error=null}).addCase(FN.fulfilled,(n,i)=>{n.completedLoading=!1,n.completedAppointment=i.payload.data.completed_appointments}).addCase(FN.rejected,(n,i)=>{n.completedLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Ou()}).addCase(BN.pending,n=>{n.cancelledLoading=!0,n.error=null}).addCase(BN.fulfilled,(n,i)=>{n.cancelledLoading=!1,n.cancelledAppointment=i.payload.data.cancelled_appointments}).addCase(BN.rejected,(n,i)=>{n.cancelledLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Ou()}).addCase(UN.pending,n=>{n.incompletedLoading=!0,n.error=null}).addCase(UN.fulfilled,(n,i)=>{var a,l;n.incompletedLoading=!1,n.incompletedAppointment=(l=(a=i.payload)==null?void 0:a.data)==null?void 0:l.incomplete_appointments}).addCase(UN.rejected,(n,i)=>{n.incompletedLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Ou()}).addCase(VN.pending,n=>{n.missedLoading=!0,n.error=null}).addCase(VN.fulfilled,(n,i)=>{var a,l;n.missedLoading=!1,n.missedAppointment=(l=(a=i.payload)==null?void 0:a.data)==null?void 0:l.missed_appointments}).addCase(VN.rejected,(n,i)=>{n.missedLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Ou()}).addCase(xv.pending,n=>{n.doctorcancelledLoading=!0,n.error=null}).addCase(xv.fulfilled,(n,i)=>{n.doctorcancelledLoading=!1,n.doctorcancelledAppointment=i.payload}).addCase(xv.rejected,(n,i)=>{n.doctorcancelledLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Ou()}).addCase(HN.pending,n=>{n.patientAppointmentsDetailLoading=!0,n.error=null}).addCase(HN.fulfilled,(n,i)=>{n.patientAppointmentsDetailLoading=!1,n.patientAppointmentsDetail=i.payload.data}).addCase(HN.rejected,(n,i)=>{n.patientAppointmentsDetailLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Ou()}).addCase(zw.pending,n=>{n.pushNotificationLoading=!0,n.error=null}).addCase(zw.fulfilled,(n,i)=>{n.pushNotificationLoading=!1,n.pushnotification=i.payload.data}).addCase(zw.rejected,(n,i)=>{n.pushNotificationLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Ou()}).addCase(ZL.pending,n=>{n.channelDetailsLoading=!0,n.error=null}).addCase(ZL.fulfilled,(n,i)=>{n.channelDetailsLoading=!1,n.channelDetails=i.payload.data}).addCase(ZL.rejected,(n,i)=>{n.channelDetailsLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Ou()}).addCase(eM.pending,n=>{n.loading=!0,n.error=null}).addCase(eM.fulfilled,(n,i)=>{n.loading=!1,n.user=i.payload,n.message="User Deleted successfully",ct.success(i.payload.message||"User deleted successfully")}).addCase(eM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to delete user",ct.error(i.payload.message||"Failed to delete user"),i.payload.message=="Unauthenticated."&&Ou()})}}),tfe=efe.reducer;function Du(){const s=localStorage.removeItem("doctor-app"),n=localStorage.getItem("anyoneJoin");!n&&!s&&ct.error("Token Expired"),localStorage.removeItem("nfc-admin"),setTimeout(()=>{n||(window.location.href="/")},1e3)}const Pv=Zt("doctor/getPatientProfileData",async(s,{rejectWithValue:n})=>{var i;try{return(await Dhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),GN=Zt("doctor/unavailabilityRequest",async(s,{rejectWithValue:n})=>{var i;try{return(await Yhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),Yw=Zt("doctor/doctorUnavailability",async(s,{rejectWithValue:n})=>{var i;try{return(await qhe()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),m_=Zt("doctor/hodScreenRequestsList",async(s,{rejectWithValue:n})=>{var i;try{return(await Khe()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),WN=Zt("doctor/hodRequestsConfirmButton",async(s,{rejectWithValue:n})=>{var i;try{return(await Xhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),qw=Zt("doctor/hodRequestsRespondButton",async(s,{rejectWithValue:n})=>{var i;try{return(await Qhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),g_=Zt("doctor/hodScreenDoctorsList",async(s,{rejectWithValue:n})=>{var i;try{return(await $he(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),zN=Zt("doctor/markDoctorAvailable",async(s,{rejectWithValue:n})=>{var i;try{return(await Jhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),YN=Zt("doctor/unavailabilitySubmitByHod",async(s,{rejectWithValue:n})=>{var i;try{return(await Zhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),qN=Zt("doctor/feedbackapi",async(s,{rejectWithValue:n})=>{var i;try{return(await epe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),nfe=om({name:"patientProfile",initialState:{patientProfileData:[],unavailabilityrequest:null,unavailabilityLoading:!1,doctorUnavailabilityList:[],doctorUnavailabilityLoading:!1,hodScreenRequests:[],hodScreenRequestsLoading:!1,hodRequestsConfirmButtonLoading:!1,hodRequestsRespondButtonLoading:!1,hodRequestsRespond:[],hodRequestsConfirm:[],hodScreenDoctorsListLoading:!1,hodScreenDoctors:[],confirmDoctorAvailable:[],markDoctorAvailableLoading:!1,unavailabilitySubmitByHodLoading:!1,doctorUnavailabilitySubmit:[],loading:!1,error:null,feedbackLoading:!1,feedbackSubmit:[]},reducers:{},extraReducers:s=>{s.addCase(Pv.pending,n=>{n.loading=!0,n.error=null}).addCase(Pv.fulfilled,(n,i)=>{var a;n.loading=!1,n.patientProfileData=(a=i.payload)==null?void 0:a.data}).addCase(Pv.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&Du()}).addCase(GN.pending,n=>{n.unavailabilityLoading=!0,n.error=null}).addCase(GN.fulfilled,(n,i)=>{n.unavailabilityLoading=!1,n.patientProfileData=i.payload}).addCase(GN.rejected,(n,i)=>{n.unavailabilityLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Du()}).addCase(Yw.pending,n=>{n.doctorUnavailabilityLoading=!0,n.error=null}).addCase(Yw.fulfilled,(n,i)=>{var a;n.doctorUnavailabilityLoading=!1,n.doctorUnavailabilityList=(a=i.payload)==null?void 0:a.data}).addCase(Yw.rejected,(n,i)=>{n.doctorUnavailabilityLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Du()}).addCase(m_.pending,n=>{n.hodScreenRequestsListLoading=!0,n.error=null}).addCase(m_.fulfilled,(n,i)=>{var a;n.hodScreenRequestsListLoading=!1,n.hodScreenRequests=(a=i.payload)==null?void 0:a.data}).addCase(m_.rejected,(n,i)=>{n.hodScreenRequestsListLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Du()}).addCase(WN.pending,n=>{n.hodRequestsConfirmButtonLoading=!0,n.error=null}).addCase(WN.fulfilled,(n,i)=>{n.hodRequestsConfirmButtonLoading=!1,n.hodRequestsConfirm=i.payload}).addCase(WN.rejected,(n,i)=>{n.hodRequestsConfirmButtonLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Du()}).addCase(qw.pending,n=>{n.hodRequestsRespondButtonLoading=!0,n.error=null}).addCase(qw.fulfilled,(n,i)=>{n.hodRequestsRespondButtonLoading=!1,n.hodRequestsRespond=i.payload}).addCase(qw.rejected,(n,i)=>{n.hodRequestsRespondButtonLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Du()}).addCase(g_.pending,n=>{n.hodScreenDoctorsListLoading=!0,n.error=null}).addCase(g_.fulfilled,(n,i)=>{var a;n.hodScreenDoctorsListLoading=!1,n.hodScreenDoctors=(a=i.payload)==null?void 0:a.data}).addCase(g_.rejected,(n,i)=>{n.hodScreenDoctorsListLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Du()}).addCase(zN.pending,n=>{n.markDoctorAvailableLoading=!0,n.error=null}).addCase(zN.fulfilled,(n,i)=>{n.markDoctorAvailableLoading=!1,n.confirmDoctorAvailable=i.payload}).addCase(zN.rejected,(n,i)=>{n.markDoctorAvailableLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Du()}).addCase(YN.pending,n=>{n.unavailabilitySubmitByHodLoading=!0,n.error=null}).addCase(YN.fulfilled,(n,i)=>{n.unavailabilitySubmitByHodLoading=!1,n.doctorUnavailabilitySubmit=i.payload}).addCase(YN.rejected,(n,i)=>{n.unavailabilitySubmitByHodLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Du()}).addCase(qN.pending,n=>{n.feedbackLoading=!0,n.error=null}).addCase(qN.fulfilled,(n,i)=>{n.feedbackLoading=!1,n.feedbackSubmit=i.payload,localStorage.setItem("feedbackPopup","1")}).addCase(qN.rejected,(n,i)=>{n.feedbackLoading=!1,n.error=i.payload,i.payload.message=="Unauthenticated."&&Du()})}}),rfe=nfe.reducer,ife={channelDetails:null,invitedUser:null},_K=om({name:"info",initialState:ife,reducers:{setVideoData:(s,n)=>{s.channelDetails=n.payload},setInvitedUserData:(s,n)=>{s.invitedUser=n.payload}}}),{setVideoData:EK,setInvitedUserData:yK}=_K.actions,sfe=_K.reducer,afe=({visible:s,onClose:n})=>{if(!s)return null;const i={position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},a={backgroundColor:"#fff",padding:"40px 30px",borderRadius:"10px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",maxWidth:"400px",width:"90%",textAlign:"center",color:"#333",display:"flex",flexDirection:"column",alignItems:"center",gap:"20px"},l={width:"80px",height:"80px",borderRadius:"50%",border:"4px solid #199fd9",display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"10px"},p={color:"#199fd9",fontSize:"50px",fontWeight:"bold",lineHeight:"1"},_={color:"#333",fontSize:"1.8em",fontWeight:"600",margin:"0"},T={color:"#777",fontSize:"1em",margin:"0",marginBottom:"20px"},w={backgroundColor:"#ff7f00",color:"white",border:"none",padding:"12px 30px",borderRadius:"5px",cursor:"pointer",fontSize:"1.1em",fontWeight:"bold",transition:"background-color 0.3s ease",width:"60%"};return m.jsx("div",{style:i,children:m.jsxs("div",{style:a,children:[m.jsxs("div",{style:l,children:[m.jsx("span",{style:p,children:""})," "]}),m.jsx("h2",{style:_,children:"Access Suspended"}),m.jsxs("p",{style:T,children:["Your access has been suspended by the admin. For support, please contact our admin team at",m.jsx("span",{style:{color:"#199FD9"},children:"awplconnect@asclepiuswellness.co.in"})]}),m.jsx("button",{onClick:n,style:w,children:"Ok"})]})})};function vK(s){return U_({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"},child:[]}]})(s)}function ofe(s){return U_({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(s)}function cfe(s){return U_({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(s)}function ij(s){return U_({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M352 240v32c0 6.6-5.4 12-12 12h-88v88c0 6.6-5.4 12-12 12h-32c-6.6 0-12-5.4-12-12v-88h-88c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h88v-88c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v88h88c6.6 0 12 5.4 12 12zm96-160v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48zm-48 346V86c0-3.3-2.7-6-6-6H54c-3.3 0-6 2.7-6 6v340c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"},child:[]}]})(s)}const lfe=({rating:s,onRatingChange:n})=>m.jsx("div",{children:[...Array(5)].map((i,a)=>{const l=a+1;return m.jsxs("label",{children:[m.jsx("input",{type:"radio",name:"rating",value:l,onClick:()=>n(l),style:{display:"none"}}),m.jsx(cfe,{className:"star",color:l<=s?"#ffc107":"#e4e5e9",size:30,style:{cursor:"pointer"}})]},a)})}),dfe=()=>{const s=Wi(),n=es(),[i,a]=F.useState(null),l=JSON.parse(localStorage.getItem("feedbackPopup"));JSON.parse(localStorage.getItem("doctor-app")||"{}").doctorData;const _=Pi(),{userdata:T,loading:w,error:C}=hr(bt=>bt.userdata),{appointmentIdd:O,modaleOpen:k}=s.state||{},{channelDetails:U}=hr(bt=>bt.appointments),[G,z]=F.useState(!1),{feedbackSubmit:J,feedbackLoading:X}=hr(bt=>bt.patientProfile),{user:ie}=hr(bt=>bt.user);F.useEffect(()=>{ie!=null&&ie.profile_path||_(T_())},[_,ie]),F.useEffect(()=>{_(f_()).then(bt=>{var Qn;const rn=(Qn=bt.payload)==null?void 0:Qn.data;if(rn&&rn.upcomingAppointments&&rn.upcomingAppointments.length>0){const Ar=rn.upcomingAppointments[0].appointment_starttime;a(new Date(Ar))}}).catch(bt=>{console.error("Error fetching dashboard data:",bt)})},[_]),F.useEffect(()=>{if(i){const bt=new Date,rn=i.getTime()-bt.getTime();if(rn>0){const Qn=setTimeout(()=>{_(f_())},rn);return()=>clearTimeout(Qn)}else _(f_())}},[i,_]);const[oe,ce]=F.useState(!1),[_e,se]=F.useState(!1),[be,ee]=F.useState(!1),[Q,q]=F.useState(null),[ae,re]=F.useState(""),[fe,pe]=F.useState(!1),[Re,Ge]=F.useState(!1),[ve,Ne]=F.useState(!1),[Ce,Ue]=F.useState(!1),[de,De]=F.useState(!0),xe=()=>{z(!1),n("/login-password"),localStorage.removeItem("doctor-app")},[Xe,ut]=F.useState(!1),[Pt,It]=F.useState(!1),[zt,$t]=F.useState(null);F.useEffect(()=>{if(T!=null&&T.upcomingAppointments){const bt=T.upcomingAppointments.find(rn=>rn.status===1);bt?($t(bt),It(!0)):($t(null),It(!1))}},[T==null?void 0:T.upcomingAppointments]);const Tt=bt=>{q(bt),ce(!0)},on=()=>{ce(!1),se(!0)},fn=()=>{_(xv({appointment_id:Q,cancel_message:ae})).then(()=>{_(f_()),se(!1),re(""),q(null),ee(!0)})};F.useEffect(()=>{const bt=setTimeout(()=>{},1e3),rn=setTimeout(()=>{It(!0)},3e3);return()=>{clearTimeout(bt),clearTimeout(rn)}},[]);const Ut=(T==null?void 0:T.upcomingAppointments)||[],yt=(T==null?void 0:T.pendingPrescriptions)||[],an=fe?Ut:Ut.slice(0,6),Dt=Re?yt:yt.slice(0,3),wt=async bt=>{await _(zw({appointmentId:bt}))};F.useEffect(()=>{_(np())},[]);const rt=async bt=>{var rn,Qn,Ar;ut(!0);try{const $r=(rn=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:rn.token,br=await vi.post(`${li}api/create-channel`,{appointmentId:bt},{headers:{Authorization:`Bearer ${$r}`,"Content-Type":"application/json"}});br.data?(_(EK((Qn=br==null?void 0:br.data)==null?void 0:Qn.data)),n("/VideoCall",{state:{id:zt.appointment_id,patientId:zt.patient_id,name:zt==null?void 0:zt.patient_name,time_period:zt==null?void 0:zt.time}}),wt(bt)):console.error("Channel creation failed:",(Ar=br.data)==null?void 0:Ar.message)}catch($r){console.error("Error creating channel:",$r)}finally{ut(!1)}},xt=(bt,rn)=>{try{const[Qn,Ar,$r]=bt.split(" "),br=new Date().getFullYear(),[ji,ts]=rn.split(" - "),ns=ts.trim().slice(-2),Ra=`${ji.trim()} ${ns}`,Cs=ts.trim(),Ca=new Date(`${Ar} ${$r}, ${br} ${Ra}`),je=new Date(`${Ar} ${$r}, ${br} ${Cs}`),sn=new Date;return sn>=Ca&&sn<=je}catch(Qn){return console.error("Error parsing appointment time:",Qn),!1}},Mt=bt=>{if(!bt)return"N/A";const rn=new Date().getFullYear(),Qn=`${bt} ${rn}`,Ar=new Date(Qn);if(isNaN(Ar))return"Invalid Date";const $r=String(Ar.getDate()).padStart(2,"0"),br=String(Ar.getMonth()+1).padStart(2,"0"),ji=Ar.getFullYear();return`${$r}/${br}/${ji}`},Bn=F.useCallback(async()=>{var rn;const bt=`${li}api/doctor/is_suspended`;try{const Qn=JSON.parse(localStorage.getItem("doctor-app")),Ar=Qn==null?void 0:Qn.token;if(!Ar){console.warn("No token found in localStorage. User might not be logged in.");return}const $r=await vi.post(bt,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${Ar}`}}),br=$r.data;$r.data?br.data.is_suspended?z(!0):z(!1):console.error("API Error (unexpected Axios success path):",br.message)}catch(Qn){vi.isAxiosError(Qn)?Qn.response?((rn=Qn.response.data)!=null&&rn.message||Qn.message,console.error("Axios API Error Response:",Qn.response.data)):Qn.request?console.error("Axios No Response Error:",Qn.request):console.error("Axios Request Setup Error:",Qn.message):console.error("General Error:",Qn)}},[n]);F.useEffect(()=>{Bn()},[Bn]);const[ki,zi]=F.useState(!1),[Cr,Un]=F.useState(0),[Li,vt]=F.useState("");F.useEffect(()=>{k&&O&&l!="1"&&zi(!0)},[k,O]);const Bt=()=>{_(qN({appointment_id:O,rating:Cr,comment:Li})),zi(!1)};return m.jsx(m.Fragment,{children:m.jsxs("main",{className:"doctor-panel",children:[m.jsxs("div",{className:"container-fluid",children:[m.jsx(afe,{visible:G,onClose:xe}),m.jsxs("div",{className:"doc-panel-inr",style:{display:"flex",gap:"20px"},children:[m.jsx("div",{style:{width:"100%"},children:m.jsx(za,{})}),m.jsxs("div",{children:[m.jsx("div",{className:"doc-img",children:m.jsx("img",{src:`${jc==null?void 0:jc.BaseUrl}${ie==null?void 0:ie.profile_path}`,alt:"Doctor"})}),m.jsx("div",{className:"doc-profile-body",children:m.jsx(mn,{to:"/UserProfile",children:m.jsx("p",{style:{color:"#199FD9"},children:(ie==null?void 0:ie.prefixed_name)||"Doctor Name"})})})]})]}),w?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsx("div",{className:"doc-panel-body",children:m.jsxs("div",{className:"appointments",children:[Pt&&zt&&m.jsxs("div",{className:"start-appointment mt-0",style:{marginBottom:"60px"},children:[m.jsx("div",{className:"docpnl-sec-head",children:m.jsx("h6",{className:"h2-title",children:"Start Appointment"})}),m.jsxs("div",{className:"apointment-detail-card",children:[m.jsx("div",{className:"apoint-dtl-img",children:zt.is_referred_patient==!0?m.jsx("div",{style:{border:"2px solid #199FD9",borderRadius:8},children:m.jsx("img",{src:"./images/referredProfile.png",alt:"referred patient"})}):m.jsx("img",{src:`${li}/${zt.patient_profile}`,alt:zt.patient_name,style:{height:180,resize:"contain"}})}),m.jsxs("div",{className:"appoint-dtl-content",children:[m.jsxs("div",{className:"appoint-dtl-left",children:[m.jsxs("div",{className:"appoint-dtl-head",children:[m.jsx("h2",{className:"h3-title",children:zt.patient_name}),zt.is_referred_patient==!0?m.jsxs("p",{children:[m.jsxs("span",{style:{color:"black"},children:["Referred by DS Code:"," "]}),m.jsx("span",{style:{color:"#199FD9"},children:zt.ds_code})]}):m.jsxs("p",{children:[m.jsxs("span",{style:{color:"black"},children:["DS Code:"," "]}),m.jsx("span",{style:{color:"#199FD9"},children:zt.ds_code})]})]}),m.jsxs("div",{className:"appoint-btm",children:[m.jsxs("p",{children:[m.jsx("img",{src:"/images/clock-icon.svg",alt:"Icon"}),zt.date]}),m.jsx("p",{className:"appoint-time",children:zt.time}),m.jsx("a",{className:"orange-btn",onClick:()=>rt(String(zt.appointment_id)),style:{cursor:Xe?"not-allowed":"pointer",pointerEvents:Xe?"none":"auto"},children:Xe?"Loading...":"Start now"})]})]}),m.jsx(mn,{to:"/patient-profile",state:{patientId:zt.patient_id},className:"cmn-btn",children:"View profile"})]})]})]}),m.jsxs("div",{className:"upcoming-apoints cmn-mb",children:[m.jsxs("div",{className:"docpnl-sec-head",children:[m.jsx("h1",{className:"h2-title",children:"Upcoming Appointments"}),m.jsx("button",{className:"cmn-btn",onClick:()=>n("/my-appointments"),children:"See all"})]}),m.jsx("div",{className:"appointments-row-wrp cmn-mb",style:{marginTop:-35},children:m.jsxs("div",{className:"appointments-row row",children:[an.length==0&&m.jsx("h3",{style:{textAlign:"center",padding:"25px 0",fontWeight:"400",color:"#199FD9",fontSize:18},children:"No upcoming appointments."}),an.map((bt,rn)=>m.jsx("div",{className:"appointment-card-wrp col-lg-2 col-md-4 col-sm-6",children:m.jsxs("div",{className:"appointment-card",children:[m.jsx("div",{className:"card-img",children:bt.is_referred_patient==!0?m.jsx("img",{src:"./images/referredProfile.png",alt:"referred patient"}):m.jsx("img",{src:`${li}/${bt.patient_profile}`,alt:bt.patient_name})}),m.jsxs("div",{className:"card-body",children:[m.jsx(mn,{to:"/patient-details",state:{id:bt.appointment_id,patientId:bt.patient_id,referrerDscode:bt.ds_code,referrer:bt.referred_patient_name},className:"cmn-btn",children:"View full detail"}),m.jsxs("div",{className:"appointment-datetime",children:[m.jsx("p",{className:"date",children:bt.date}),m.jsx("p",{className:"time",children:bt.time})]}),m.jsx("div",{style:{minHeight:"24px"},children:bt.is_referred_patient?m.jsxs("p",{children:[m.jsxs("span",{style:{color:"black"},children:["Referred by DS Code:"," "]}),m.jsx("span",{style:{color:"#199FD9"},children:bt.ds_code})]}):m.jsxs("p",{children:[m.jsxs("span",{style:{color:"black"},children:["DS Code:"," "]}),m.jsx("span",{style:{color:"#199FD9"},children:bt.ds_code})]})}),m.jsx("h3",{style:{fontSize:22},children:bt.patient_name})," ",m.jsxs("h3",{style:{fontSize:22},children:["Disease:",m.jsxs("span",{style:{color:"#199FD9",fontSize:16},children:[" ",bt.diseaseName]})]}),xt(bt.date,bt.time)?m.jsx("input",{type:"submit",value:"Start now",className:"w-100",onClick:()=>rt(String(bt.appointment_id)),style:{cursor:"pointer"}}):m.jsx("input",{type:"submit",value:"Cancel",className:"w-100 up-btn",onClick:()=>Tt(bt.appointment_id),style:{cursor:"pointer"}})]})]})},rn))]})}),m.jsxs("div",{className:"pending-prescriptions",style:{marginTop:-40},children:[m.jsxs("div",{className:"docpnl-sec-head",children:[m.jsx("h2",{children:"Pending Prescriptions"}),m.jsx("button",{className:"cmn-btn",onClick:()=>n("/pendingprescription"),children:"See all"})]}),m.jsx("div",{className:"pending-presc-table",style:{marginTop:-20},children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Patient Name"}),m.jsx("th",{children:"Upload Date"}),m.jsx("th",{children:"View Details"})]})}),m.jsxs("tbody",{children:[Dt.length==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center",fontWeight:"400",fontSize:18},children:w?"Loading...":"No data found"})}),Dt.map((bt,rn)=>m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String(rn+1).padStart(2,"0")}),m.jsxs("td",{style:{textAlign:"left",paddingLeft:"45px",width:"200px"},children:[m.jsx(mn,{to:"/patient-profile",state:{patientId:bt.patient_id},className:"no-underline-link",style:{display:"inline-block",fontSize:21,marginLeft:-5},children:bt.patient_name}),(bt==null?void 0:bt.is_referred_patient)==!0?m.jsxs("div",{className:"time",style:{color:"#199fd9",marginTop:"2px",fontSize:16,marginLeft:-5,fontWeight:"400"},children:[m.jsx("span",{style:{color:"black",fontWeight:"400"},children:"(Referred by DS Code:"}),bt.ds_code,m.jsx("spna",{style:{color:"black",fontWeight:"400"},children:")"})]}):m.jsxs("div",{className:"time",style:{color:"#199fd9",marginTop:"2px",fontSize:16,marginLeft:-5,fontWeight:"400"},children:[m.jsx("span",{style:{color:"black",fontWeight:"400"},children:"(DS Code:"}),bt.ds_code,m.jsx("span",{style:{color:"black",fontWeight:"bold"},children:")"})]})]}),m.jsxs("td",{children:[m.jsx("div",{className:"date",style:{fontSize:21,color:"#199FD9"},children:Mt(bt.date)}),m.jsx("div",{className:"time",style:{fontSize:16,color:"#199fd9"},children:bt.time})]}),m.jsx("td",{children:m.jsx(mn,{to:"/patient-details",state:{id:bt.appointment_id,patientId:bt.patient_id,referrerDscode:bt.ds_code,referrer:bt.referred_patient_name},style:{fontSize:21,marginLeft:-50},children:"View"})})]},rn))]})]})})]})]})]})}),!Pt&&Ce&&m.jsx("div",{className:"modal fade show",tabIndex:"-1",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.5)"},children:m.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:m.jsxs("div",{className:"modal-content text-center position-relative shadow",style:{width:"400px",minHeight:"280px",borderRadius:"20px",padding:"30px 20px"},children:[m.jsx("button",{type:"button",onClick:()=>Ue(!1),className:"position-absolute top-0 end-0 m-3 border-0 bg-transparent","aria-label":"Close",children:m.jsx("img",{src:"./images/cross-blue.png",alt:"Close Icon",style:{width:"24px",height:"24px"}})}),m.jsx("div",{className:"modal-icon mb-3",children:m.jsx("img",{src:"./images/bell-icon.svg",alt:"Reminder Icon",style:{width:"40px",height:"40px"}})}),m.jsxs("div",{className:"modal-header border-0 flex-column align-items-center p-0",children:[m.jsx("h2",{className:"fw-bold mb-2",style:{fontSize:"22px",color:"#333"},children:"Reminder:"}),m.jsx("p",{className:"m-0",style:{color:"#009CDE",fontWeight:"500"},children:"Your Appointment Starts in 2 Minutes!"})]}),m.jsxs("div",{className:"modal-body p-0 mt-4",children:[m.jsxs("div",{className:"text-muted mb-2",children:["Patients Name:"," ",m.jsx("span",{className:"fw-medium",style:{color:"#356598"},children:"John Smith"})]}),m.jsxs("div",{className:"text-muted",children:["Date and Time:"," ",m.jsx("span",{className:"fw-medium",style:{color:"#356598"},children:"December 26, 2024, 3:00 PM"})]})]})]})})}),m.jsx(fo,{})]}),m.jsx(rp,{visible:oe,title:"Cancel Appointment",subtitle:"Are you sure you want to cancel the appointment?",onConfirm:on,onCancel:()=>ce(!1),actionType:"cancel"}),m.jsx(rp,{visible:_e,title:"Cancel Appointment",subtitle:"Reason for cancellation",inputField:!0,inputValue:ae,onInputChange:bt=>re(bt),onCancel:()=>{se(!1),re("")},onConfirm:fn,actionType:"info"}),m.jsx(rp,{visible:be,title:"Appointment Cancelled",subtitle:"Your appointment is cancelled successfully.",onConfirm:()=>ee(!1),onCancel:()=>ee(!1),actionType:"success"}),ki&&m.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},children:m.jsx("div",{className:"modal-dialog modal-dialog-centered",children:m.jsxs("div",{className:"modal-content",style:{padding:"20px",borderRadius:"10px"},children:[m.jsxs("div",{className:"modal-header",children:[m.jsx("h5",{className:"modal-title",children:"Rate Your Experience"}),m.jsx("button",{type:"button",className:"close",onClick:()=>zi(!1),style:{color:"#199FD9",fontSize:30},children:""})]}),m.jsxs("div",{className:"modal-body text-center",children:[m.jsx(lfe,{rating:Cr,onRatingChange:Un}),m.jsx("textarea",{className:"form-control mt-3",placeholder:"Share your feedback (optional)",value:Li,onChange:bt=>vt(bt.target.value),rows:"3"})]}),m.jsxs("div",{className:"modal-footer justify-content-center",children:[m.jsx("button",{type:"button",className:"btn btn-secondary mr-2",onClick:()=>zi(!1),children:"Skip"}),m.jsx("button",{type:"button",className:"btn btn-primary",style:{backgroundColor:"#199FD9"},onClick:Bt,children:X?"Submitting...":"Submit"})]})]})})})]})})},ufe=()=>{var Re,Ge,ve,Ne,Ce,Ue,de,De,xe,Xe,ut,Pt,It,zt,$t,Tt,on,fn,Ut,yt,an,Dt,wt;const s=es(),n=Wi(),{id:i,patientId:a,referrerDscode:l,referrer:p}=n.state||{},[_,T]=F.useState(!1),[w,C]=F.useState(!1),[O,k]=F.useState(!1),[U,G]=F.useState(null),[z,J]=F.useState(""),[X,ie]=F.useState(null),[oe,ce]=F.useState(!1),_e=Pi(),{patientAppointmentsDetail:se,doctorcancelledAppointment:be,patientAppointmentsDetailLoading:ee,doctorcancelledLoading:Q}=hr(rt=>rt.appointments);F.useEffect(()=>{i&&_e(HN({appointmentId:i}))},[_e,i]);const q=rt=>{G(rt),T(!0)},ae=()=>{T(!1),C(!0)},re=()=>{_e(xv({appointment_id:U,cancel_message:z})).then(()=>{C(!1),J(""),G(null),k(!0)})},fe=rt=>{ie(rt),ce(!0)},pe=()=>{var Mt,Bn;const rt=(Mt=se==null?void 0:se.patientData)==null?void 0:Mt.dayDate,xt=(Bn=se==null?void 0:se.patientData)==null?void 0:Bn.time;if(!rt||!xt)return!1;try{const[,ki,zi]=rt.split(" "),Cr=new Date().getFullYear(),[Un,Li]=xt.split(" - "),vt=Li.trim().slice(-2),Bt=`${Un.trim()} ${vt}`,bt=new Date(`${ki} ${zi} ${Cr} ${Bt}`);return new Date>=bt}catch(ki){return console.error("Time parse error:",ki),!1}};return m.jsx(m.Fragment,{children:m.jsxs("main",{className:"doctor-panel",children:[m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(za,{})}),ee?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"doc-panel-body appoint-details-pg has-texture",children:[m.jsx("div",{className:"texture only-img",children:m.jsx("img",{src:"/images/doctor-symbol.png",alt:"Image"})}),m.jsxs("div",{className:"appointments",children:[m.jsxs("div",{className:"start-appointment cmn-mb mb-4",children:[m.jsxs("div",{className:"docpnl-sec-head",children:[m.jsx("h1",{className:"h2-title mb-1",children:"Appointment Details"}),m.jsx("div",{className:"back-btn",children:m.jsx(mn,{to:"#",onClick:rt=>{rt.preventDefault(),window.history.back()},children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),((Re=se==null?void 0:se.patientData)==null?void 0:Re.is_referred_patient)&&m.jsx("div",{className:"refered-by-cd",children:m.jsxs("p",{children:["Referred by ",p," (",l,")"]})}),m.jsxs("div",{className:"apointment-detail-card",style:{border:"2px solid #199FD9"},children:[!((Ge=se==null?void 0:se.patientData)!=null&&Ge.is_referred_patient)&&m.jsx("div",{className:"apoint-dtl-img",children:m.jsx("img",{src:`${li}/${(ve=se==null?void 0:se.patientData)==null?void 0:ve.patient_profile}`,alt:"Client"})}),m.jsxs("div",{className:`appoint-dtl-content ${(Ne=se==null?void 0:se.patientData)!=null&&Ne.is_referred_patient?"w-100 p-0":""}`,children:[m.jsxs("div",{className:"appoint-dtl-left",children:[m.jsxs("div",{className:"appoint-dtl-head",children:[m.jsxs("h2",{className:"h3-title",children:[(Ce=se==null?void 0:se.patientData)==null?void 0:Ce.patient_name,!((Ue=se==null?void 0:se.patientData)!=null&&Ue.is_referred_patient)&&m.jsxs("div",{style:{fontSize:"15px"},children:["(",m.jsxs("span",{style:{color:"black"},children:["DS Code:"," "]}),m.jsx("span",{style:{color:"#199FD9"},children:l}),")"]})]}),m.jsx("h2",{className:"h3-title",children:m.jsxs("span",{style:{color:"black",fontSize:16},children:["Disease :",m.jsxs("span",{style:{color:"#199FD9"},children:[" ",(de=se==null?void 0:se.patientData)==null?void 0:de.diseaseName]})]})})]}),m.jsxs("div",{className:"appoint-btm",style:{marginTop:-10},children:[m.jsxs("p",{children:[m.jsx("img",{src:"/images/clock-icon.svg",alt:"Icon"}),(De=se==null?void 0:se.patientData)==null?void 0:De.dayDate]}),m.jsx("p",{className:"appoint-time",children:(xe=se==null?void 0:se.patientData)==null?void 0:xe.time})]})]}),m.jsx(mn,{to:"/patient-profile",state:{patientId:a,hideSchedule:!0},className:"cmn-btn",children:"View profile"})]})]})]}),m.jsx("div",{className:"patient-details-wrp",children:m.jsx("form",{children:m.jsxs("div",{className:"patient-dtl-form",children:[m.jsxs("div",{className:"patient-basic-info cmn-mb2",children:[m.jsx("h2",{children:"Basic Information"}),m.jsxs("div",{className:"row",children:[m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Full Name"}),m.jsx("input",{type:"text",placeholder:"Name",value:(Xe=se==null?void 0:se.basicInformation)==null?void 0:Xe.name,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Height"}),m.jsx("input",{type:"text",placeholder:"26",value:(ut=se==null?void 0:se.basicInformation)==null?void 0:ut.height,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Weight"}),m.jsx("input",{type:"text",placeholder:"50kg",value:(Pt=se==null?void 0:se.basicInformation)==null?void 0:Pt.weight,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Gender"}),m.jsx("input",{type:"text",placeholder:"Male",value:((zt=(It=se==null?void 0:se.basicInformation)==null?void 0:It.gender)==null?void 0:zt.charAt(0).toUpperCase())+((Tt=($t=se==null?void 0:se.basicInformation)==null?void 0:$t.gender)==null?void 0:Tt.slice(1).toLowerCase()),readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Age"}),m.jsx("input",{type:"text",placeholder:"26",value:(on=se==null?void 0:se.basicInformation)==null?void 0:on.age,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Disease"}),m.jsx("input",{type:"text",placeholder:"26",value:(fn=se==null?void 0:se.basicInformation)==null?void 0:fn.diseaseName,readOnly:!0})]})})]})]}),m.jsxs("div",{className:"scheduled-call-consultations cmn-mb2",children:[m.jsx("h2",{children:"Scheduled Call Consultations"}),m.jsxs("div",{className:"row",children:[m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"1. How long are you suffering from this disease?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(Ut=se==null?void 0:se.symptomAnswers)==null?void 0:Ut.answer1,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"2. Any other problem which you would like to share related to your problem?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(yt=se==null?void 0:se.symptomAnswers)==null?void 0:yt.answer2,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"3. Do you have any history of this disease?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(an=se==null?void 0:se.symptomAnswers)==null?void 0:an.answer3,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"4. Are you taking any medicines? If yes, please share the name of medicine and since how long you are taking this medicine?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(Dt=se==null?void 0:se.symptomAnswers)==null?void 0:Dt.answer4,readOnly:!0})]})})]})]}),Array.isArray(se==null?void 0:se.symptomFiles)&&(se==null?void 0:se.symptomFiles.length)>0&&m.jsxs("div",{className:"view-uploaded-images-wrp",children:[m.jsx("h2",{children:"View Uploaded Images"}),m.jsx("div",{className:"view-uploaded-img",children:se==null?void 0:se.symptomFiles.filter(rt=>rt.file_type.toLowerCase().match(/jpg|jpeg|png|gif/)).map((rt,xt)=>m.jsx("div",{className:"img-wrp",children:m.jsx("a",{href:"#",onClick:Mt=>{Mt.preventDefault(),fe(rt)},children:m.jsx("img",{src:`${li}/${rt.file_path}`,alt:`Symptom Image ${xt+1}`})})},xt))})]}),((wt=se==null?void 0:se.patientData)==null?void 0:wt.need_prescription)==!0?m.jsx("div",{className:"btn-wrp",children:m.jsx(mn,{to:"/CompletedAssignedPrescription",state:{id:i,patientId:a},children:m.jsx("button",{type:"button",className:"orange-btn",children:"Respond"})})}):pe()?null:m.jsx("div",{className:"btn-wrp",children:m.jsx("button",{type:"button",className:"orange-btn",onClick:()=>q(i),children:"Cancel"})})]})})})]})]}),m.jsx(fo,{})]}),m.jsx(rp,{visible:_,title:"Cancel Appointment",subtitle:"Are you sure you want to cancel the appointment?",onConfirm:ae,onCancel:()=>T(!1),actionType:"cancel"}),m.jsx(rp,{visible:w,title:"Cancel Appointment",subtitle:"Reason for cancellation",inputField:!0,inputValue:z,onInputChange:rt=>J(rt),onCancel:()=>{C(!1),J("")},onConfirm:re,actionType:"info"}),m.jsx(rp,{visible:O,title:"Appointment Cancelled",subtitle:"Your appointment is cancelled successfully.",onConfirm:()=>{k(!1),s("/doctor-home")},onCancel:()=>k(!1),actionType:"success"}),oe&&X&&m.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",overflow:"auto"},children:[m.jsx("button",{onClick:()=>ce(!1),style:{position:"fixed",right:"30px",top:"30px",zIndex:1060,background:"transparent",border:"none",cursor:"pointer",padding:0},"aria-label":"Close",children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close",style:{width:"24px",height:"24px",filter:"brightness(0) invert(1)"}})}),m.jsx("div",{style:{maxWidth:"90vw",maxHeight:"90vh",display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsx("img",{src:`${li}/${X.file_path}`,alt:"Enlarged view",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})})]})]})})},hfe=()=>{var ce,_e,se,be,ee,Q,q,ae,re,fe,pe,Re,Ge,ve,Ne,Ce,Ue;const s=Wi();es();const{patientId:n,appointmentId:i,hideSchedule:a,source:l}=s.state||{},p=Pi(),{patientProfileData:_,loading:T}=hr(de=>de.patientProfile),[w,C]=F.useState(null),[O,k]=F.useState(null),[U,G]=F.useState(!1);F.useEffect(()=>{n&&p(Pv({patientId:n,source:l}))},[p,n,l]);const z=(_==null?void 0:_.basic_information)||{},J=(_==null?void 0:_.appointment_date_time)||{},X=(_==null?void 0:_.appointment_history)||{},ie=(_==null?void 0:_.referred_patients)||{},oe=de=>{k(de),G(!0)};return m.jsx(m.Fragment,{children:m.jsx("main",{className:"doctor-panel",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(za,{})}),T?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsx("div",{className:"doc-panel-body has-texture",children:m.jsxs("div",{className:"start-appointment cmn-mb",children:[m.jsxs("div",{className:"docpnl-sec-head text-center",children:[m.jsx("h1",{className:"h2-title",children:"Patient Profile"}),m.jsx("div",{className:"back-btn",children:m.jsx(mn,{to:"#",onClick:de=>{de.preventDefault(),window.history.back()},children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),m.jsxs("div",{className:"patient-details-wrp",children:[m.jsx("div",{className:"patient-profile-wrp cmn-mb2",style:(ce=_==null?void 0:_.basic_information)!=null&&ce.is_referred?{}:{width:"100%",maxWidth:"100%"},children:m.jsx("div",{className:"patient-profile",style:{width:"100%",maxWidth:"100%"},children:m.jsxs("div",{className:"patient-profile-inr",style:{display:"flex",width:"100%",alignItems:"flex-start"},children:[!((_e=_==null?void 0:_.basic_information)!=null&&_e.is_referred)&&m.jsx("div",{className:"patient-profile-left",children:m.jsx("div",{className:"patient-profile-img-cover",children:m.jsx("div",{className:"patient-profile-cover-inr",children:m.jsx("div",{className:"patient-profile-img",children:m.jsx("img",{src:`${li}/${z.patient_profile}`,alt:"Patinet Profile Image"})})})})}),m.jsxs("div",{className:"patient-profile-right",style:{maxWidth:(se=_==null?void 0:_.basic_information)!=null&&se.is_referred?"100%":void 0},children:[m.jsxs("div",{className:"patient-id",children:[m.jsx("h2",{children:z.name}),m.jsx("p",{className:"dscode",children:(be=_==null?void 0:_.basic_information)!=null&&be.is_referred?m.jsxs(m.Fragment,{children:[m.jsx("span",{style:{color:"black"},children:"Referred by"}),m.jsx(mn,{to:"/patient-profile",state:{patientId:(ee=_==null?void 0:_.basic_information)==null?void 0:ee.referred_id},style:{color:"#199fd9",textDecoration:"none",marginLeft:5,display:"inline"},children:m.jsx("span",{children:(Q=_==null?void 0:_.basic_information)==null?void 0:Q.referred_by})}),m.jsxs("span",{style:{color:"#000"},children:["(DS Code:",m.jsxs("span",{style:{color:"#199fd9"},children:[" ",z.ds_code]}),")"]})]}):m.jsxs("span",{children:["(",m.jsx("span",{style:{color:"black"},children:"DS Code:"}),z.ds_code,m.jsx("span",{children:")"})]})})]}),m.jsxs("div",{className:"patient-info",style:{display:"flex",flexWrap:"wrap",gap:"16px",padding:"0 16px"},children:[m.jsxs("div",{className:"patient-info-card",style:{flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[m.jsx("h3",{children:"Gender"}),m.jsx("p",{style:{color:"#199FD9"},children:((q=z.gender)==null?void 0:q.charAt(0).toUpperCase())+((ae=z.gender)==null?void 0:ae.slice(1).toLowerCase())})]}),m.jsxs("div",{className:"patient-info-card",style:{flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[m.jsx("h3",{children:"Age"}),m.jsx("p",{style:{color:"#199FD9"},children:z.age})]}),m.jsxs("div",{className:"patient-info-card",style:{flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[m.jsx("h3",{children:"Height"}),m.jsx("p",{style:{color:"#199FD9"},children:z.height})]}),m.jsxs("div",{className:"patient-info-card",style:{flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[m.jsx("h3",{children:"Weight"}),m.jsx("p",{style:{color:"#199FD9"},children:z.weight})]})]}),!((re=_==null?void 0:_.basic_information)!=null&&re.is_referred)&&m.jsxs("div",{className:"patient-info",children:[m.jsxs("div",{className:"patient-info-card",style:{marginLeft:12,flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[m.jsx("h3",{children:"Phone number"}),m.jsx("p",{style:{color:"#199FD9"},children:z.phone_no})]}),m.jsxs("div",{className:"patient-info-card",style:{flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[m.jsx("h3",{style:{marginLeft:15},children:"Email ID"}),m.jsx("p",{style:{marginLeft:15,color:"#199FD9"},children:z.email})]})]})]})]})})}),(_==null?void 0:_.is_appointment_present)&&m.jsxs("div",{className:"patient-basic-info cmn-mb2",children:[m.jsx("h2",{children:"Appointment Date & Time"}),m.jsxs("div",{className:"appointment-timing",children:[m.jsx("div",{className:"appointment-date",children:J.date}),m.jsx("div",{className:"appointment-time",children:J.time})]})]}),(_==null?void 0:_.is_appointment_present)&&!((fe=_==null?void 0:_.basic_information)!=null&&fe.is_referred)&&m.jsx("div",{className:"patient-detail-form-wrp cmn-mb2",children:m.jsx("form",{children:m.jsx("div",{className:"patient-dtl-form",children:m.jsxs("div",{className:"health-issues-symptoms cmn-mb2",children:[m.jsx("h2",{children:"Appointment Details"}),m.jsxs("div",{className:"health-symptoms-inr",children:[m.jsxs("div",{className:"health-symptoms-content",children:[m.jsxs("div",{className:"formfield white-input",children:[m.jsx("label",{children:"What symptoms are you facing? Please describe your symptoms in brief."}),m.jsx("input",{type:"text",placeholder:"Answer",value:((pe=_==null?void 0:_.appointment_details)==null?void 0:pe.answer1)||"No symptoms reported",readOnly:!0})]}),m.jsxs("div",{className:"formfield white-input",children:[m.jsx("label",{children:"How long have you been experiencing these symptoms?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:((Re=_==null?void 0:_.appointment_details)==null?void 0:Re.answer2)||"No duration specified",readOnly:!0})]}),m.jsxs("div",{className:"formfield white-input",children:[m.jsx("label",{children:"Any knows Diseases / Health Conditions you are facing?"}),m.jsx("input",{type:"text",placeholder:"Parasitic diseases",value:((Ge=_==null?void 0:_.appointment_details)==null?void 0:Ge.answer3)||"No known diseases",readOnly:!0})]}),m.jsxs("div",{className:"formfield white-input",children:[m.jsx("label",{children:"Any past medical conditions?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:((ve=_==null?void 0:_.appointment_details)==null?void 0:ve.answer4)||"No past conditions reported",readOnly:!0})]})]}),Array.isArray(_==null?void 0:_.viewUploadedImages)&&((Ne=_==null?void 0:_.viewUploadedImages)==null?void 0:Ne.length)>0&&m.jsxs("div",{className:"view-uploaded-images-wrp",children:[m.jsx("h2",{className:"h5-title",children:"View Uploaded Images"}),m.jsx("div",{className:"view-uploaded-img",children:((Ce=_==null?void 0:_.viewUploadedImages)==null?void 0:Ce.length)>0?_.viewUploadedImages.map((de,De)=>m.jsx("div",{className:"img-wrp",children:m.jsx("a",{href:"#",onClick:xe=>{xe.preventDefault(),oe(de)},children:m.jsx("img",{src:`${li}/${de.file_path}`,alt:`Symptom ${De+1}`})})},De)):m.jsx("p",{children:"No images uploaded"})}),U&&O&&m.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",overflow:"auto"},children:[m.jsx("button",{onClick:()=>G(!1),style:{position:"fixed",right:"30px",top:"30px",zIndex:1060,background:"transparent",border:"none",cursor:"pointer",padding:0},"aria-label":"Close",children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close",style:{width:"24px",height:"24px",filter:"brightness(0) invert(1)"}})}),m.jsx("div",{style:{maxWidth:"90vw",maxHeight:"90vh",display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsx("img",{src:`${li}/${O.file_path}`,alt:"Enlarged view",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})})]})]})]})]})})})}),m.jsxs("div",{className:"pending-prescriptions cmn-mb2 bg-blue",children:[m.jsx("h2",{children:"Appointment History"}),m.jsx("div",{className:"pending-presc-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Appointment Date"}),m.jsx("th",{children:"Disease"}),m.jsx("th",{children:"View Prescription"})]})}),m.jsx("tbody",{children:X.length>0?X.map((de,De)=>{var xe;return m.jsxs("tr",{children:[m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:String(De+1).padStart(2,"0")}),m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:de.appointment_date}),m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:de.diagnosis}),m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:m.jsx(mn,{to:"/completed-appointment-screen",state:{id:de==null?void 0:de.appointment_id,patientId:(xe=_==null?void 0:_.appointment_details)==null?void 0:xe.patient_id,chat_id:de.chat_id,ds_code:z.ds_code,prescription_id:de==null?void 0:de.prescription_id},className:"link",children:"View"})})]},de.id||De)}):m.jsx("tr",{children:m.jsx("td",{colSpan:"4",className:"text-center",style:{fontSize:20,color:"#199FD9"},children:"No Appointment history found"})})})]})})]}),!((Ue=_==null?void 0:_.basic_information)!=null&&Ue.is_referred)&&m.jsxs("div",{className:"pending-prescriptions",children:[m.jsx("h2",{children:"Referred Patient list"}),m.jsx("div",{className:"pending-presc-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Patient Name"}),m.jsx("th",{children:"Gender"}),m.jsx("th",{children:"Age"}),m.jsx("th",{children:"Weight (kg)"}),m.jsx("th",{children:"Height"}),m.jsx("th",{children:"View Profile"})]})}),m.jsx("tbody",{children:ie.length>0?ie.map((de,De)=>{var xe,Xe;return m.jsxs("tr",{children:[m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:String(De+1).padStart(2,"0")}),m.jsx("td",{style:{textAlign:"left",paddingLeft:"60px",fontSize:20,color:"#199FD9"},children:m.jsx(mn,{to:"/patient-profile",state:{patientid:n},className:"no-underline-link",style:{color:"#199FD9",display:"inline-block"},children:de.name.charAt(0).toUpperCase()+de.name.slice(1).toLowerCase()})}),m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:((xe=z.gender)==null?void 0:xe.charAt(0).toUpperCase())+((Xe=z.gender)==null?void 0:Xe.slice(1).toLowerCase())}),m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:de.age}),m.jsxs("td",{style:{fontSize:20,color:"#199FD9"},children:[" ",de.weight]}),m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:de.height}),m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:m.jsx(mn,{to:"/patient-profile",state:{referrer:z.name,referrerDscode:z.ds_code,id:de.id,patientId:de.id},style:{color:"#199FD9",textDecoration:"underline !important"},className:"text-decoration-underline",children:"View Profile"})})]},de.id||De)}):m.jsx("tr",{children:m.jsx("td",{colSpan:"7",className:"text-center",style:{color:"#199FD9",fontSize:20},children:"No Referred patients found"})})})]})})]})]}),!(_!=null&&_.is_appointment_present)&&!a&&m.jsx("div",{className:"schedule-appoinment-btn",children:m.jsx(mn,{to:"/schedule-appointment",state:{patientId:n,appointmentId:i,patientName:z.name},className:"orange-btn",children:"Schedule Appointment"})})]})}),m.jsx(fo,{})]})})})},pfe=({onFilterChange:s,onSearch:n,activeTab:i,onSearchDate:a})=>{const[l,p]=F.useState(""),[_,T]=F.useState([]),[w,C]=F.useState(""),[O,k]=F.useState(!1),[U,G]=F.useState([]),[z,J]=F.useState({name:"",age:"",dscode:"",diagnosis:""}),[X,ie]=F.useState(!1),[oe,ce]=F.useState(new Date().getMonth()),[_e,se]=F.useState(new Date().getFullYear()),[be,ee]=F.useState(!0),[Q,q]=F.useState(""),[ae,re]=F.useState(""),[fe,pe]=F.useState(""),[Re,Ge]=F.useState(!1),[ve,Ne]=F.useState(!1);Pi();const{completedAppointment:Ce}=hr(wt=>wt.appointments),Ue=["January","February","March","April","May","June","July","August","September","October","November","December"];F.useEffect(()=>{de()},[]),F.useEffect(()=>{de(),a(null),s({name:"",age:"",dscode:"",diagnosis:""})},[i]),F.useEffect(()=>{if(Ce&&Ce.length>0){const wt=[...new Set(Ce.map(rt=>rt.diagnosis).filter(rt=>rt&&rt.trim()!==""&&rt.trim()!=="-"))];G(wt)}},[Ce]);const de=()=>{p(""),C(""),J({name:"",age:"",diagnosis:""}),k(!1),q(""),re(""),ie(!1),ce(new Date().getMonth()),se(new Date().getFullYear()),pe("")},De=wt=>{const rt=wt.target.value;pe(rt),n(rt)},xe=wt=>{const{name:rt,value:xt}=wt.target;if(rt==="name"){const Mt=xt.replace(/[^A-Za-z\s]/g,"");J(Bn=>({...Bn,[rt]:Mt}))}else rt==="age"?(xt===""||/^[0-9\b]+$/.test(xt))&&J(Mt=>({...Mt,[rt]:xt})):J(rt==="dscode"?Mt=>({...Mt,[rt]:xt}):Mt=>({...Mt,[rt]:xt}))},Xe=()=>{k(wt=>!wt)},ut=wt=>{let rt=oe+wt,xt=_e;rt>11?(rt=0,xt++):rt<0&&(rt=11,xt--),ce(rt),se(xt)},Pt=()=>{const wt=new Date(_e,oe,1).getDay(),rt=new Date(_e,oe+1,0).getDate(),xt=[];let Mt=[];for(let Bn=0;Bn<wt;Bn++)Mt.push(m.jsx("td",{className:"empty-cell"},`empty-${Bn}`));for(let Bn=1;Bn<=rt;Bn++){const ki=Q&&Q.startsWith(`${Bn}/${oe+1}`),zi=ae&&ae.startsWith(`${Bn}/${oe+1}`);let Cr=!1;if(!be&&Q){const Un=Q.split("/"),Li=new Date(Un[2],Un[1]-1,Un[0]);Cr=new Date(_e,oe,Bn)<=Li}Mt.push(m.jsx("td",{className:`calendar-day 
            ${ki?"selected-from":""} 
            ${zi?"selected-to":""}
            ${Cr?"disabled-day":""}`,onClick:()=>!Cr&&It(Bn),style:Cr?{color:"#ccc",cursor:"not-allowed"}:{},children:Bn},`day-${Bn}`)),((wt+Bn)%7===0||Bn===rt)&&(xt.push(m.jsx("tr",{children:Mt},`week-${xt.length}`)),Mt=[])}return xt},It=wt=>{const rt=`${wt}/${oe+1}/${_e}`;if(be){if(q(rt),ee(!1),ae){const xt=ae.split("/"),Mt=new Date(xt[2],xt[1]-1,xt[0]),Bn=new Date(_e,oe,wt);Mt<=Bn&&re("")}}else{const xt=Q.split("/"),Mt=new Date(xt[2],xt[1]-1,xt[0]);if(new Date(_e,oe,wt)>Mt)re(rt);else{alert("To Date must be after From Date");return}}},zt=()=>{ie(wt=>!wt),!X&&!Q&&!ae&&ee(!0)},$t=wt=>{wt==="clear"?(J({name:"",age:"",dscode:"",diagnosis:""}),s({patientName:"",age:"",dscode:"",disease:""}),k(!1)):(s({patientName:z.name,age:z.age,dscode:z.dscode,disease:z.diagnosis}),k(!1))},Tt=()=>{q(""),re(""),ee(!0),a(null),ie(!1)},on=()=>{if(Q&&ae){const wt=Q.split("/"),rt=ae.split("/"),xt=new Date(wt[2],wt[1]-1,wt[0]),Mt=new Date(rt[2],rt[1]-1,rt[0]);Mt.setHours(23,59,59,999),a([xt,Mt]),ie(!1)}},Ut=(()=>{const wt=[],rt=new Set;return Ce&&Ce.forEach(xt=>{xt.patient_name&&!rt.has(xt.patient_name.toLowerCase())&&(rt.add(xt.patient_name.toLowerCase()),wt.push({name:xt.patient_name,dsCode:xt.ds_code||""}))}),wt})(),yt=z.name?Ut.filter(wt=>wt.name.toLowerCase().includes(z.name.toLowerCase())):Ut,an=wt=>{J(rt=>({...rt,name:wt.name})),Ge(!1)},Dt=wt=>{if(!wt)return"";const[rt,xt,Mt]=wt.split("/").map(Number);return`${rt.toString().padStart(2,"0")}/${xt.toString().padStart(2,"0")}/${Mt}`};return m.jsxs("div",{className:"my-appointments-search-wrp",style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px"},children:[m.jsxs("div",{className:"datepicker-wrp",style:i==="upcoming"?{display:"none"}:["cancelled","incompleted","missed"].includes(i)?{width:"50%"}:{},children:[m.jsx("input",{type:"text",id:"dateRangeInput",placeholder:"Select date range",readOnly:!0,value:Q&&ae?`${Dt(Q)} - ${Dt(ae)}`:"",onClick:zt}),X&&m.jsxs("div",{className:"calendar-popup",style:{display:"block",position:"absolute",zIndex:1e3,background:"white",padding:"0px",borderRadius:"5px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)",width:"300px",left:0,overflow:"hidden"},children:[m.jsxs("div",{className:"calendar-header",children:[m.jsx("div",{className:"cal-head-btn-wrp",children:m.jsx("button",{type:"button",className:`range-btn ${be?"active":""}`,onClick:()=>ee(!0),children:m.jsx("span",{id:"fromDateLabel",children:Q?Dt(Q):"From Date"})})}),m.jsx("div",{className:"cal-head-btn-wrp",children:m.jsx("button",{type:"button",className:`range-btn ${be?"":"active"}`,onClick:()=>ee(!1),children:m.jsx("span",{id:"toDateLabel",children:ae?Dt(ae):"To Date"})})}),m.jsxs("div",{className:"monthyear-wrp w-100",style:{display:"flex",justifyContent:"space-between",alignItems:"center",margin:"10px 0"},children:[m.jsx("button",{type:"button",className:"arrow-btn",onClick:()=>ut(-1),style:{border:"none",background:"none",cursor:"pointer",fontSize:"16px"},children:""}),m.jsxs("span",{id:"monthYearLabel",style:{fontWeight:"bold"},children:[Ue[oe]," ",_e]}),m.jsx("button",{type:"button",className:"arrow-btn",onClick:()=>ut(1),style:{border:"none",background:"none",cursor:"pointer",fontSize:"16px"},children:""})]})]}),m.jsxs("table",{className:"calendar-grid",style:{width:"100%",borderCollapse:"collapse"},children:[m.jsx("thead",{children:m.jsx("tr",{children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(wt=>m.jsx("th",{style:{padding:"5px",textAlign:"center"},children:wt},wt))})}),m.jsx("tbody",{children:Pt()})]}),m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"10px",borderTop:"1px solid #eee"},children:[m.jsx("button",{onClick:Tt,style:{padding:"5px 10px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:"3px",cursor:"pointer"},children:"Clear"}),m.jsx("button",{onClick:on,disabled:!Q||!ae,style:{padding:"5px 10px",background:Q&&ae?"#0066cc":"#ccc",color:"white",border:"none",borderRadius:"3px",cursor:Q&&ae?"pointer":"not-allowed"},children:"Apply"})]})]})]}),m.jsxs("div",{className:"formfield",style:i=="completed"?{display:"none"}:["cancelled","incompleted","missed"].includes(i)?{width:"50%"}:{},children:[m.jsx("input",{placeholder:"Search anything here",type:"text",value:fe,onChange:De}),m.jsx("input",{type:"submit"})]}),m.jsxs("div",{className:"past-patient-filter-wrp",style:i==="cancelled"||i==="upcoming"||i==="incompleted"||i==="missed"?{display:"none"}:{},children:[m.jsxs("button",{type:"button",onClick:Xe,children:["Filter",m.jsx("img",{src:"./images/filter-icon.svg",alt:"Icon"})]}),m.jsx("div",{className:`filter-options-drpdn ${O?"active":""}`,children:m.jsxs("form",{children:[m.jsxs("div",{className:"filter-form",children:[m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"Patient Name"}),m.jsxs("div",{className:"suggestion-container",style:{position:"relative"},children:[m.jsx("input",{type:"text",name:"name",value:z.name,onChange:xe,placeholder:"Patient Name",pattern:"[A-Za-z\\s]+",title:"Only letters and spaces allowed",autoComplete:"off",onFocus:()=>{Ne(!0),z.name&&Ge(!0)},onBlur:()=>{setTimeout(()=>{Ne(!1),Ge(!1)},200)}}),(Re||ve)&&yt.length>0&&m.jsx("ul",{className:"suggestions-dropdown",style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"#fff",border:"1px solid #ddd",borderRadius:"4px",maxHeight:"200px",overflowY:"auto",zIndex:1e3,marginTop:"5px",padding:0,listStyle:"none"},children:yt.map((wt,rt)=>m.jsxs("li",{onClick:()=>an(wt),style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid #eee",display:"flex",flexDirection:"column"},children:[m.jsx("div",{children:wt.name}),wt.dsCode&&m.jsxs("div",{style:{color:"#199fd9",fontSize:"0.8em"},children:["(DS Code: ",wt.dsCode,")"]})]},rt))})]})]}),m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"Age"}),m.jsx("input",{type:"text",name:"age",value:z.age,onChange:xe,placeholder:"Age",pattern:"[0-9]*"})]}),m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"DS Code"}),m.jsx("input",{id:"dscode",type:"text",name:"dscode",value:z.dscode,onChange:xe,placeholder:"DS Code"})]}),m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"Disease"}),m.jsxs("select",{name:"diagnosis",value:z.diagnosis,onChange:xe,children:[m.jsx("option",{value:"",children:"Disease"}),U.map((wt,rt)=>m.jsx("option",{value:wt,children:wt},rt))]})]})]}),m.jsxs("div",{className:"filter-form-btn-wrp",children:[m.jsx("button",{type:"button",className:"orange-btn",onClick:()=>$t("clear"),style:{borderRadius:0},children:"Clear Filter"}),m.jsx("button",{type:"button",className:"orange-btn",onClick:()=>$t("apply"),style:{borderRadius:0},children:"Apply Filter"})]})]})})]})]})},Lu=({currentPage:s,totalPages:n,onPageChange:i,onNext:a,onPrevious:l})=>{const p=[];if(n<=5)for(let _=1;_<=n;_++)p.push(_);else s<=3?p.push(1,2,3,4,"...",n):s>=n-2?p.push(1,"...",n-3,n-2,n-1,n):p.push(1,"...",s-1,s,s+1,"...",n);return m.jsxs("div",{className:"tablepagination",children:[m.jsx("div",{className:"tbl-pagination-inr",children:m.jsxs("ul",{children:[m.jsx("li",{children:m.jsxs(mn,{to:"#url",onClick:_=>{_.preventDefault(),l()},children:[m.jsx("img",{src:"./images/arrow-left-black.svg",alt:"Icon"}),"Previous"]})}),p.map((_,T)=>m.jsx("li",{className:s===_?"active":"",children:_==="..."?m.jsx(mn,{to:"#url",onClick:w=>w.preventDefault(),children:"..."}):m.jsx(mn,{to:"#url",onClick:w=>{w.preventDefault(),i(_)},children:_})},T)),m.jsx("li",{children:m.jsxs(mn,{to:"#url",onClick:_=>{_.preventDefault(),a()},children:["Next",m.jsx("img",{src:"./images/arrow-right-black.svg",alt:"Icon"})]})})]})}),m.jsxs("div",{className:"pages-select",children:[m.jsx("form",{children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Page"}),m.jsx("select",{value:s,onChange:_=>i(Number(_.target.value)),children:Array.from({length:n},(_,T)=>T+1).map(_=>m.jsx("option",{value:_,children:_},`page-${_}`))})]})}),m.jsxs("p",{children:["of ",n]})]})]})},C8=()=>{var Qn,Ar,$r,br,ji,ts,ns,Ra,Cs,Ca;const s=es(),{channelDetails:n}=hr(je=>je.appointments),[i,a]=F.useState(!1),l=Pi(),{upcommingAppointment:p,completedAppointment:_,cancelledAppointment:T,incompletedAppointment:w,doctorcancelledAppointment:C,missedAppointment:O,upcomingLoading:k,completedLoading:U,cancelledLoading:G,incompletedLoading:z,doctorcancelledLoading:J,missedLoading:X}=hr(je=>je.appointments),[ie,oe]=F.useState("upcoming"),[ce,_e]=F.useState(!1),[se,be]=F.useState(!1),[ee,Q]=F.useState(!1),[q,ae]=F.useState(null),[re,fe]=F.useState(""),[pe,Re]=F.useState(1),[Ge,ve]=F.useState(new Date),Ne=8,[Ce,Ue]=F.useState({patientName:"",age:"",dsCode:"",disease:""}),[de,De]=F.useState([]),[xe,Xe]=F.useState([]),[ut,Pt]=F.useState([]),[It,zt]=F.useState([]),[$t,Tt]=F.useState([]);F.useEffect(()=>{l(Ww()),l(FN()),l(BN()),l(UN()),l(VN())},[l]),F.useEffect(()=>{Re(1),Ue({patientName:"",age:"",dsCode:"",disease:""}),De(p),Xe(_),Pt(T),zt(w),Tt(O)},[ie,p,_,T,w,O]),F.useEffect(()=>{Xe(on(_,"completed"))},[Ce]);const on=(je,sn)=>je.filter(cn=>{var tn;const Yn=!Ce.patientName||((tn=cn.patient_name)==null?void 0:tn.toLowerCase().includes(Ce.patientName.toLowerCase())),Ke=!Ce.age||cn.patient_age.toString().includes(Ce.age),Yt=!Ce.dscode||cn.ds_code&&cn.ds_code.toLowerCase().includes(Ce.dscode.toLowerCase());if(sn==="cancelled"||sn==="incompleted"||sn==="missed")return Yn&&Ke&&Yt;const un=!Ce.disease||cn.diagnosis&&cn.diagnosis!=="-"&&cn.diagnosis.toLowerCase()===Ce.disease.toLowerCase();return Yn&&Ke&&Yt&&un}),[fn,Ut]=F.useState(null);F.useEffect(()=>{if(de){const je=de.find(sn=>sn.status===1);Ut(je||null)}},[de]);const yt=je=>{switch(Ue({patientName:je.patientName||"",age:je.age||"",dscode:je.dscode||"",disease:je.disease||""}),ie){case"upcoming":De(on(p,"upcoming"));break;case"completed":Xe(on(_,"completed"));break;case"cancelled":Pt(on(T,"cancelled"));break;case"incompleted":zt(on(w,"incompleted"));break;case"missed":Tt(on(O,"missed"));break}Re(1)};JSON.parse(localStorage.getItem("doctor-app")||"{}").doctorData;const Dt=async je=>{var sn,cn,Yn;a(!0);try{const Ke=(sn=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:sn.token,Yt=await vi.post(`${li}api/create-channel`,{appointmentId:je},{headers:{Authorization:`Bearer ${Ke}`,"Content-Type":"application/json"}});Yt.data?(l(EK((cn=Yt==null?void 0:Yt.data)==null?void 0:cn.data)),s("/VideoCall",{state:{id:fn.appointment_id,patientId:fn.patient_id,name:fn==null?void 0:fn.patient_name,time_period:fn==null?void 0:fn.time}}),wt(je)):console.error("Channel creation failed:",(Yn=Yt.data)==null?void 0:Yn.message)}catch(Ke){console.error("Error creating channel:",Ke)}finally{a(!1)}},wt=async je=>{console.log("call 222"),await l(zw({appointmentId:je}))},rt=je=>{const sn=je.toLowerCase().trim(),cn=/^\d+$/.test(je),Yn=Ke=>Ke.filter(Yt=>{var ln,or,pr,qr,rs,mo,Hs;const un=((ln=Yt.patient_age)==null?void 0:ln.toString())||"",tn=((or=Yt.patient_phone)==null?void 0:or.toString())||"",yn=Yt.datetime?new Date(Yt.datetime).getDate().toString():"",ri=((pr=Yt.ds_code)==null?void 0:pr.toLowerCase())||"";return cn?un===je||tn.includes(je)||ri.includes(sn):((qr=Yt.patient_name)==null?void 0:qr.toLowerCase().includes(sn))||((rs=Yt.patient_gender)==null?void 0:rs.toLowerCase())===sn||tn.includes(je)||yn.includes(sn)||ri.includes(sn)||((mo=Yt.datetime)==null?void 0:mo.toLowerCase().includes(sn))||ie==="completed"&&((Hs=Yt.diagnosis)==null?void 0:Hs.toLowerCase().includes(sn))});switch(ie){case"upcoming":De(Yn(p));break;case"completed":Xe(Yn(_));break;case"cancelled":Pt(Yn(T));break;case"incompleted":zt(Yn(w));break;case"missed":Tt(Yn(O));break}Re(1)},xt=je=>{const[sn,cn,Yn]=je.split(" "),[Ke,Yt,un]=sn.split("/").map(Number);let[tn,yn]=cn.split(":").map(Number);return Yn==="PM"&&tn!==12&&(tn+=12),Yn==="AM"&&tn===12&&(tn=0),new Date(un,Yt-1,Ke,tn,yn)},Mt=je=>{if(je==null){switch(ie){case"completed":Xe(_);break;case"cancelled":Pt(T);break;case"incompleted":Pt(T);break;case"missed":Pt(T);break}return}if(!je||je.length!==2)return;const[sn,cn]=je;switch(ie){case"completed":const Yn=_.filter(tn=>{const yn=xt(tn.datetime);return yn>=sn&&yn<=cn});Xe(Yn);break;case"cancelled":const Ke=T.filter(tn=>{const yn=xt(tn.datetime);return yn>=sn&&yn<=cn});Pt(Ke);break;case"incompleted":const Yt=w.filter(tn=>{const yn=xt(tn.datetime);return yn>=sn&&yn<=cn});zt(Yt);break;case"missed":const un=O.filter(tn=>{const yn=xt(tn.datetime);return yn>=sn&&yn<=cn});Tt(un);break}},Bn=je=>{ae(je),_e(!0)},ki=()=>{_e(!1),be(!0)},zi=()=>{l(xv({appointment_id:q,cancel_message:re})).then(()=>{l(Ww()),be(!1),fe(""),ae(null),Q(!0)})},Cr=je=>{const sn=pe*Ne,cn=sn-Ne;return je==null?void 0:je.slice(cn,sn)},Un=je=>Math.ceil((je==null?void 0:je.length)/Ne),Li=je=>{Re(je)},vt=()=>{const je=Un(ie==="upcoming"?de:ie==="completed"?xe:ie==="cancelled"?ut:ie==="incompleted"?It:$t);pe<je&&Re(pe+1)},Bt=()=>{pe>1&&Re(pe-1)};Un(ie==="upcoming"?de:ie==="completed"?xe:ie==="cancelled"?ut:ie==="incompleted"?It:$t);const rn=je=>xt(je)<new Date;return m.jsxs("div",{className:"doctor-panel",children:[m.jsxs("div",{className:"container-fluid",children:[m.jsxs("div",{className:"doc-panel-inr",children:[" ",m.jsx(za,{})," "]}),k||U||G||z?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"doc-panel-body",children:[m.jsx("div",{className:"docpnl-sec-head",children:m.jsx("h1",{className:"h2-title",children:"My Appointments"})}),m.jsx("div",{className:"my-appointments-wrp",children:m.jsxs("div",{className:"my-appointments-inr",children:[m.jsxs("div",{className:"my-appointments-tab-header",children:[m.jsx("div",{className:"my-appointments-tab-head",children:m.jsxs("ul",{style:{position:"relative"},children:[m.jsx("li",{className:"tab-bg"}),m.jsxs("li",{style:ie=="upcoming"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>oe("upcoming"),children:[" ","Upcoming"," "]}),m.jsxs("li",{style:ie=="completed"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>oe("completed"),children:[" ","Completed"," "]}),m.jsxs("li",{style:ie=="cancelled"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>oe("cancelled"),children:[" ","Cancelled"," "]}),m.jsxs("li",{style:ie=="incompleted"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>oe("incompleted"),children:[" ","Incompleted"," "]}),m.jsxs("li",{style:ie=="missed"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>oe("missed"),children:[" ","Missed"," "]})]})}),m.jsx(pfe,{onFilterChange:yt,onSearch:rt,onSearchDate:Mt,activeTab:ie})]}),m.jsxs("div",{className:"my-appointments-tab-content-wrp",children:[m.jsxs("div",{className:`myapintmnt-content-tab ${ie==="upcoming"?"upcoming":""}`,style:{display:ie==="upcoming"?"block":"none"},children:[m.jsx("div",{className:"myapintmnt-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Name"}),m.jsx("th",{children:"Age"}),m.jsx("th",{children:"Gender"}),m.jsx("th",{children:"Phone number"}),m.jsx("th",{children:"Appointment date"}),m.jsx("th",{children:"Disease"}),m.jsx("th",{children:"Status"}),m.jsx("th",{children:"Action"})]})}),m.jsxs("tbody",{children:[console.log("filteredUpcomingPatients1234: ",de),((Qn=Cr(de))==null?void 0:Qn.length)==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"25px 0",fontSize:18,fontWeight:"400",color:"#199FD9"},children:"No data found"})}),(Ar=Cr(de))==null?void 0:Ar.map((je,sn)=>{var cn,Yn;return m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String((pe-1)*Ne+sn+1).padStart(2,"0")}),m.jsxs("td",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[m.jsx("img",{src:li+"/"+(je==null?void 0:je.patient_profile),alt:"Patient"}),m.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[m.jsx(mn,{to:"/patient-profile",state:{patientId:je.patient_id},children:m.jsx("h3",{style:{margin:0,textAlign:"left",color:"#199FD9"},children:je.patient_name||"-"})}),(je==null?void 0:je.referred)==!0?m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(Referred by DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]}):m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]})]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_age||"-"}),m.jsx("td",{style:{color:"#199FD9"},children:((cn=je.patient_gender)==null?void 0:cn.charAt(0).toUpperCase())+((Yn=je.patient_gender)==null?void 0:Yn.slice(1).toLowerCase())}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_phone||"-"}),m.jsxs("td",{style:{color:"#199FD9"},children:[m.jsx("div",{className:"date h3-title",style:{color:"#199FD9"},children:je.datetime.split(" ")[0]}),m.jsxs("div",{className:"time",style:{color:"#199FD9"},children:[je.datetime.split(" ")[1]," ",je.datetime.split(" ")[2]]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.diseaseName}),m.jsx("td",{children:je.status===1?m.jsx("a",{className:"orange-btn",style:{cursor:i?"not-allowed":"pointer",pointerEvents:i?"none":"auto"},onClick:()=>Dt(je.appointment_id),children:i?"Loading...":"Start now"}):m.jsx("button",{type:"button",className:"cmn-btn blue-bg",onClick:()=>Bn(je.appointment_id),disabled:rn(je.datetime),style:{opacity:rn(je.datetime)?.6:1,cursor:rn(je.datetime)?"not-allowed":"pointer"},children:"Cancel"})}),m.jsx("td",{children:m.jsx(mn,{to:"/patient-profile",state:{patientId:je.patient_id},className:"cmn-btn",children:"View Profile"})})]},`upcoming-${sn}`)})]})]})}),(de==null?void 0:de.length)>0&&m.jsx(Lu,{currentPage:pe,totalPages:Un(de),onPageChange:Li,onPrevious:Bt,onNext:vt})]}),m.jsxs("div",{className:`myapintmnt-content-tab ${ie==="completed"?"completed":""}`,style:{display:ie==="completed"?"block":"none"},children:[m.jsx("div",{className:"myapintmnt-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Name"}),m.jsx("th",{children:"Age"}),m.jsx("th",{children:"Gender"}),m.jsx("th",{children:"Phone number"}),m.jsx("th",{children:"Appointment date"}),m.jsx("th",{children:"Disease"}),m.jsx("th",{children:"Prescription Details"}),m.jsx("th",{children:"Action"})]})}),m.jsxs("tbody",{children:[(($r=Cr(xe))==null?void 0:$r.length)==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"25px 0",fontSize:18,fontWeight:"400",color:"#199FD9"},children:"No data found"})}),(br=Cr(xe))==null?void 0:br.map((je,sn)=>{var cn,Yn;return m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String((pe-1)*Ne+sn+1).padStart(2,"0")}),m.jsxs("td",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[m.jsx("img",{src:li+"/"+(je==null?void 0:je.patient_profile),alt:"Patient"}),m.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[m.jsx(mn,{to:"/patient-profile",state:{patientId:je.patient_id},children:m.jsx("h3",{style:{margin:0,textAlign:"left",color:"#199FD9"},children:je.patient_name||"-"})}),(je==null?void 0:je.referred)==!0?m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(Referred by DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]}):m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black",fontSize:15},children:[" ","(DS Code:"," "]}),je.ds_code," ",m.jsx("span",{style:{color:"black"},children:")"})]})]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_age||"-"}),m.jsx("td",{style:{color:"#199FD9"},children:((cn=je.patient_gender)==null?void 0:cn.charAt(0).toUpperCase())+((Yn=je.patient_gender)==null?void 0:Yn.slice(1).toLowerCase())}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_phone||"-"}),m.jsxs("td",{children:[m.jsx("div",{className:"date h3-title",style:{color:"#199FD9"},children:je.datetime.split(" ")[0]}),m.jsxs("div",{className:"time",style:{color:"#199FD9"},children:[je.datetime.split(" ")[1]," ",je.datetime.split(" ")[2]]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.diseaseName}),m.jsx("td",{children:m.jsx(mn,{to:"/completed-appointment-screen",state:{id:je.appointment_id,patientId:je.patient_id,chat_id:je.chat_id,ds_code:je.ds_code,referred:je.referred,prescription_id:je==null?void 0:je.prescription_id},style:{color:"#199FD9",textDecoration:"underline !important"},className:" text-decoration-underline",children:"View"})}),m.jsx("td",{children:m.jsx(mn,{to:"/patient-profile",state:{patientId:je.patient_id,appointmentId:je.appointment_id,source:"completed",hideSchedule:!1},className:"cmn-btn",children:"View Profile"})})]},`completed-${sn}`)})]})]})}),(xe==null?void 0:xe.length)>0&&m.jsx(Lu,{currentPage:pe,totalPages:Un(xe),onPageChange:Li,onPrevious:Bt,onNext:vt})]}),m.jsxs("div",{className:`myapintmnt-content-tab ${ie==="cancelled"?"cancelled":""}`,style:{display:ie==="cancelled"?"block":"none"},children:[m.jsx("div",{className:"myapintmnt-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Name"}),m.jsx("th",{children:"Age"}),m.jsx("th",{children:"Gender"}),m.jsx("th",{children:"Phone number"}),m.jsx("th",{children:"Appointment date"}),m.jsx("th",{children:"Disease"}),m.jsx("th",{children:"Action"})]})}),m.jsxs("tbody",{children:[((ji=Cr(ut))==null?void 0:ji.length)==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"25px 0",fontSize:18,color:"#199FD9",fontWeight:"400"},children:"No data found"})}),(ts=Cr(ut))==null?void 0:ts.map((je,sn)=>{var cn,Yn;return m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String((pe-1)*Ne+sn+1).padStart(2,"0")}),m.jsxs("td",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[m.jsx("img",{src:li+"/"+(je==null?void 0:je.patient_profile),alt:"Patient"}),m.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[m.jsx(mn,{to:"/patient-profile",state:{patientId:je.patient_id},children:m.jsx("h3",{style:{margin:0,textAlign:"left",color:"#199FD9"},children:je.patient_name||"-"})}),(je==null?void 0:je.referred)==!0?m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(Referred by DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]}):m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]})]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_age||"-"}),m.jsx("td",{style:{color:"#199FD9"},children:((cn=je.patient_gender)==null?void 0:cn.charAt(0).toUpperCase())+((Yn=je.patient_gender)==null?void 0:Yn.slice(1).toLowerCase())}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_phone||"-"}),m.jsxs("td",{style:{color:"#199FD9"},children:[m.jsx("div",{className:"date h3-title",style:{color:"#199FD9"},children:je.datetime.split(" ")[0]}),m.jsxs("div",{className:"time",style:{color:"#199FD9"},children:[je.datetime.split(" ")[1]," ",je.datetime.split(" ")[2]]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.diseaseName}),m.jsx("td",{children:m.jsx(mn,{to:"/patient-profile",state:{patientId:je.patient_id,appointmentId:je.appointment_id,source:"cancelled",hideSchedule:!0},className:"cmn-btn",children:"View Profile"})})]},`cancelled-${sn}`)})]})]})}),(ut==null?void 0:ut.length)>0&&m.jsx(Lu,{currentPage:pe,totalPages:Un(ut),onPageChange:Li,onPrevious:Bt,onNext:vt})]}),m.jsxs("div",{className:`myapintmnt-content-tab ${ie==="incompleted"?"incompleted":""}`,style:{display:ie==="incompleted"?"block":"none"},children:[m.jsx("div",{className:"myapintmnt-table incomp_tbl",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Name"}),m.jsx("th",{children:"Age"}),m.jsx("th",{children:"Gender"}),m.jsx("th",{children:"Phone number"}),m.jsx("th",{children:"Appointment date"}),m.jsx("th",{children:"Disease"}),m.jsx("th",{children:"Reason"})]})}),m.jsxs("tbody",{children:[((ns=Cr(It))==null?void 0:ns.length)==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"25px 0",fontSize:18,fontWeight:"400",color:"#199FD9"},children:"No data found"})}),(Ra=Cr(It))==null?void 0:Ra.map((je,sn)=>{var cn,Yn;return m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String((pe-1)*Ne+sn+1).padStart(2,"0")}),m.jsxs("td",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[m.jsx("img",{src:li+"/"+(je==null?void 0:je.patient_profile),alt:"Patient"}),m.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[m.jsx("h3",{style:{margin:0,textAlign:"left",color:"#199FD9"},children:je.patient_name||"-"}),(je==null?void 0:je.referred)==!0?m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(Referred by DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]}):m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]})]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_age||"-"}),m.jsx("td",{style:{color:"#199FD9"},children:((cn=je.patient_gender)==null?void 0:cn.charAt(0).toUpperCase())+((Yn=je.patient_gender)==null?void 0:Yn.slice(1).toLowerCase())}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_phone||"-"}),m.jsxs("td",{children:[m.jsx("div",{className:"date h3-title",style:{color:"#199FD9"},children:je.datetime.split(" ")[0]}),m.jsxs("div",{className:"time",style:{color:"#199FD9"},children:[je.datetime.split(" ")[1]," ",je.datetime.split(" ")[2]]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.diseaseName}),m.jsx("td",{style:{color:"#199FD9"},children:je.reason})]},`incompleted-${sn}`)})]})]})}),(It==null?void 0:It.length)>0&&m.jsx(Lu,{currentPage:pe,totalPages:Un(It),onPageChange:Li,onPrevious:Bt,onNext:vt})]}),m.jsxs("div",{className:`myapintmnt-content-tab ${ie==="missed"?"missed":""}`,style:{display:ie==="missed"?"block":"none"},children:[m.jsx("div",{className:"myapintmnt-table incomp_tbl",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Name"}),m.jsx("th",{children:"Age"}),m.jsx("th",{children:"Gender"}),m.jsx("th",{children:"Phone number"}),m.jsx("th",{children:"Appointment date"}),m.jsx("th",{children:"Disease"})]})}),m.jsxs("tbody",{children:[((Cs=Cr($t))==null?void 0:Cs.length)==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"25px 0",fontSize:18,fontWeight:"400",color:"#199FD9"},children:"No data found"})}),(Ca=Cr($t))==null?void 0:Ca.map((je,sn)=>{var cn,Yn;return m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String((pe-1)*Ne+sn+1).padStart(2,"0")}),m.jsxs("td",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[m.jsx("img",{src:li+"/"+(je==null?void 0:je.patient_profile),alt:"Patient"}),m.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[m.jsx("h3",{style:{margin:0,textAlign:"left",color:"#199FD9"},children:je.patient_name||"-"}),(je==null?void 0:je.referred)==!0?m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(Referred by DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]}):m.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:[m.jsxs("span",{style:{color:"black"},children:[" ","(DS Code:"," "]}),je.ds_code,m.jsx("span",{style:{color:"black"},children:")"})]})]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_age||"-"}),m.jsx("td",{style:{color:"#199FD9"},children:((cn=je.patient_gender)==null?void 0:cn.charAt(0).toUpperCase())+((Yn=je.patient_gender)==null?void 0:Yn.slice(1).toLowerCase())}),m.jsx("td",{style:{color:"#199FD9"},children:je.patient_phone||"-"}),m.jsxs("td",{children:[m.jsx("div",{className:"date h3-title",style:{color:"#199FD9"},children:je.datetime.split(" ")[0]}),m.jsxs("div",{className:"time",style:{color:"#199FD9"},children:[je.datetime.split(" ")[1]," ",je.datetime.split(" ")[2]]})]}),m.jsx("td",{style:{color:"#199FD9"},children:je.diseaseName})]},`missed-${sn}`)})]})]})}),($t==null?void 0:$t.length)>0&&m.jsx(Lu,{currentPage:pe,totalPages:Un($t),onPageChange:Li,onPrevious:Bt,onNext:vt})]})]})]})})]}),m.jsx(fo,{})]}),m.jsx(rp,{visible:ce,title:"Cancel Appointment",subtitle:"Are you sure you want to cancel the appointment?",onConfirm:ki,onCancel:()=>_e(!1),actionType:"cancel"}),m.jsx(rp,{visible:se,title:"Cancel Appointment",subtitle:"Reason for cancellation",inputField:!0,inputValue:re,onInputChange:je=>fe(je),onCancel:()=>{be(!1),fe("")},onConfirm:zi,actionType:"info"}),m.jsx(rp,{visible:ee,title:"Appointment Cancelled",subtitle:"Your appointment is cancelled successfully.",onConfirm:()=>Q(!1),onCancel:()=>Q(!1),actionType:"success"})]})};function tN(){const s=localStorage.getItem("anyoneJoin");localStorage.removeItem("doctor-app"),s&&ct.error("Token Expired"),localStorage.removeItem("nfc-admin"),setTimeout(()=>{s||(window.location.href="/")},1e3)}const KN=Zt("doctor/getScheduleTime",async(s,{rejectWithValue:n})=>{var i;try{return(await ghe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),XN=Zt("doctor/completeAppointmentPatientDetails",async(s,{rejectWithValue:n})=>{var i;try{return(await Ohe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),Kw=Zt("doctor/prescriptionDownload",async(s,{rejectWithValue:n})=>{var i;try{return(await xhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),QN=Zt("doctor/bookAppointment",async(s,{rejectWithValue:n})=>{var i;try{return(await Hhe(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),ffe=om({name:"prescriptions",initialState:{scheduleTime:[],bookAppointments:[],prescription_Download:[],completeAppointmentPatientDetail:[],loading:!1,error:null},reducers:{},extraReducers:s=>{s.addCase(KN.pending,n=>{n.upcomingLoading=!0,n.error=null}).addCase(KN.fulfilled,(n,i)=>{var a,l;n.upcomingLoading=!1,n.scheduleTime=(l=(a=i.payload)==null?void 0:a.data)==null?void 0:l.available_time_slots}).addCase(KN.rejected,(n,i)=>{n.upcomingLoading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&tN()}).addCase(XN.pending,n=>{n.loading=!0,n.error=null}).addCase(XN.fulfilled,(n,i)=>{var a;n.loading=!1,n.completeAppointmentPatientDetail=(a=i.payload)==null?void 0:a.data}).addCase(XN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&tN()}).addCase(Kw.pending,n=>{n.loading=!0,n.error=null}).addCase(Kw.fulfilled,(n,i)=>{n.loading=!1}).addCase(Kw.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&tN()}).addCase(QN.pending,n=>{n.loading=!0,n.error=null}).addCase(QN.fulfilled,(n,i)=>{n.loading=!1,n.bookAppointments=i.payload}).addCase(QN.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch users",i.payload.message=="Unauthenticated."&&tN()})}}),mfe=ffe.reducer,gfe=()=>{const s=Wi(),{patientId:n,appointmentId:i,patientName:a}=s.state||{},l=Pi(),{scheduleTime:p,loading:_}=hr(Re=>Re.prescriptions),{patientProfileData:T}=hr(Re=>Re.patientProfile),[w,C]=F.useState(new Date),[O,k]=F.useState(),[U,G]=F.useState(!1),[z,J]=F.useState(w.getMonth()),[X,ie]=F.useState(w.getFullYear());function oe(Re){const Ge=new Date(Re),ve=Ge.getFullYear(),Ne=String(Ge.getMonth()+1).padStart(2,"0"),Ce=String(Ge.getDate()).padStart(2,"0");return`${ve}-${Ne}-${Ce}`}F.useEffect(()=>{J(w.getMonth()),ie(w.getFullYear())},[w]),F.useEffect(()=>{l(KN({date:oe(w)}))},[l,w]);const _e=(()=>{const Re=[],Ge=new Date(X,z,1).getDay(),ve=Ge===0?7:Ge,Ne=new Date(X,z+1,0).getDate(),Ce=new Date(X,z,0).getDate();for(let de=ve-1;de>0;de--)Re.push({day:Ce-de+1,currentMonth:!1,date:new Date(X,z-1,Ce-de+1)});for(let de=1;de<=Ne;de++)Re.push({day:de,currentMonth:!0,date:new Date(X,z,de)});const Ue=7-Re.length%7;if(Ue<7)for(let de=1;de<=Ue;de++)Re.push({day:de,currentMonth:!1,date:new Date(X,z+1,de)});return Re})(),se=()=>{let Re=z-1,Ge=X;Re<0&&(Re=11,Ge-=1),J(Re),ie(Ge),C(new Date(Ge,Re,1)),k(void 0)},be=()=>{let Re=z+1,Ge=X;Re>11&&(Re=0,Ge+=1),J(Re),ie(Ge),C(new Date(Ge,Re,1)),k(void 0)},ee=Re=>{Re.currentMonth&&(C(Re.date),k(void 0))},Q=(Re,Ge=w)=>{if(!Re||!Ge)return!1;const ve=Re.match(/(\d{1,2}:\d{2})\s*(AM|PM)/i);if(!ve)return!1;const[,Ne,Ce]=ve;let[Ue,de]=Ne.split(":").map(Number);Ce.toLowerCase()==="pm"&&Ue!==12&&(Ue+=12),Ce.toLowerCase()==="am"&&Ue===12&&(Ue=0);const De=new Date,xe=new Date(Ge);if(xe.setHours(0,0,0,0),De.setSeconds(0,0),!(xe.toDateString()===De.toDateString()))return!1;const ut=new Date;return ut.setHours(Ue,de,0,0),ut<=De},q=(Re,Ge=w)=>{if(!Re||!Ge)return!1;const ve=Re.match(/(\d{1,2}:\d{2})\s*(AM|PM)/i);if(!ve)return!1;const[,Ne,Ce]=ve;let[Ue,de]=Ne.split(":").map(Number);Ce.toLowerCase()==="pm"&&Ue!==12&&(Ue+=12),Ce.toLowerCase()==="am"&&Ue===12&&(Ue=0);const De=new Date,xe=new Date(Ge);return xe.setHours(Ue,de,0,0),(xe-De)/(1e3*60*60)>=2},ae=(Re,Ge)=>{Ge&&(Q(Re)||k(Re))},re=async()=>{var Re,Ge;if(!O){ct.error("Please select a time");return}if(!q(O)){ct.error("Appointments must be booked at least 2 hours in advance");return}try{const ve=await l(QN({date:oe(w),time:O,patient_id:n,appointment_id:i}));(Re=ve.payload)!=null&&Re.status?G(!0):ct.error(((Ge=ve.payload)==null?void 0:Ge.message)||"Failed to book appointment")}catch{ct.error("An error occurred while booking the appointment")}},fe=()=>G(!1),pe=Re=>{const Ge=new Date;return Ge.setHours(0,0,0,0),Re<Ge};return m.jsxs("div",{className:"doctor-panel",children:[m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(za,{})}),_?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsx("div",{className:"doc-panel-body has-texture",children:m.jsxs("div",{className:"start-appointment cmn-mb",children:[m.jsxs("div",{className:"docpnl-sec-head text-center",children:[m.jsx("h1",{className:"h2-title",children:"Schedule Appointment"}),m.jsx("div",{className:"back-btn",children:m.jsx(mn,{to:"#",onClick:Re=>{Re.preventDefault(),window.history.back()},children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),m.jsx("div",{className:"schedule-appointment-wrp",children:m.jsxs("div",{className:"schedule-appointment row",children:[m.jsx("div",{className:"schedule-appointment-left-wrp col-lg-6",children:m.jsx("div",{className:"schedule-appointmnet-left",children:m.jsx("img",{src:"./images/schedule-aapointment-left-img.png",alt:"Schedule"})})}),m.jsx("div",{className:"schedule-appointment-right-wrp col-lg-6",children:m.jsx("div",{className:"schedule-appointment-right",children:m.jsxs("div",{className:"calender-wrp",children:[m.jsx("div",{className:"caleder-heading",children:m.jsx("h2",{className:"h3-title",children:"Select Date and Time"})}),m.jsxs("div",{className:"calender",children:[m.jsxs("div",{className:"calender-monthyear",children:[m.jsx("button",{className:"prev-month",onClick:se,type:"button",children:m.jsx("img",{src:"./images/chevron-left.svg",alt:"Icon"})}),m.jsx("h2",{className:"h3-title",children:new Date(X,z).toLocaleString("default",{month:"long",year:"numeric"})}),m.jsx("button",{className:"next-month",onClick:be,type:"button",children:m.jsx("img",{src:"./images/chevron-right.svg",alt:"Icon"})})]}),m.jsx("div",{className:"calneder-body",children:m.jsxs("div",{className:"calender-body-inr",children:[m.jsxs("div",{className:"week-days-wrp",children:[m.jsx("div",{children:"Mon"}),m.jsx("div",{children:"Tue"}),m.jsx("div",{children:"Wed"}),m.jsx("div",{children:"Thu"}),m.jsx("div",{children:"Fri"}),m.jsx("div",{children:"Sat"}),m.jsx("div",{children:"Sun"})]}),m.jsx("div",{className:"moth-days-wrp",children:_e.map((Re,Ge)=>{const ve=oe(Re.date)===oe(w),Ne=oe(Re.date)===oe(new Date),Ce=!Re.currentMonth||pe(Re.date);return m.jsx("div",{className:`day ${ve?"selected-day":Ne?"today":""} ${Re.currentMonth?"":"not-current-month"} ${Ce?"disabled-day":""}`,onClick:()=>ee(Re),style:{cursor:Ce?"default":"pointer",color:Re.currentMonth?Ce?"#999":ve?"#fff":"#356598":"#ccc",backgroundColor:ve?"#199FD9":Ne?"#ccc":"transparent",borderRadius:ve?"50%":"0",userSelect:"none",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",margin:"2px",fontWeight:ve?"bold":"normal"},children:Re.day},Ge)})})]})}),m.jsxs("div",{className:"selected-date",style:{marginTop:"15px",fontWeight:"bold"},children:["Selected:"," ",w.toLocaleString("default",{month:"long",day:"numeric",year:"numeric"})]}),m.jsxs("div",{className:"select-time-wrp",style:{marginTop:"15px"},children:[_&&m.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",minHeight:"100px"},children:m.jsx("span",{className:"loader"})}),p.map(Re=>{const Ge=!(Re!=null&&Re.is_available),ve=Q(Re==null?void 0:Re.display_time),Ne=O===(Re==null?void 0:Re.display_time);return m.jsx("div",{className:`available-time 
                                      ${Ge?"booked-time":""}
                                      ${ve?"disabled-time":""}
                                      ${Ne?"selected":""}`,onClick:()=>ae(Re==null?void 0:Re.display_time,Re==null?void 0:Re.is_available),style:{pointerEvents:Ge||ve?"none":"auto",opacity:Ge||ve?.5:1,cursor:Ge||ve?"default":"pointer",userSelect:"none",padding:"8px 12px",borderRadius:"4px",margin:"4px",display:"inline-block",border:Ne?"2px solid #199FD9":"1px solid #ccc",fontWeight:Ne?"bold":"normal"},children:Re==null?void 0:Re.display_time},Re==null?void 0:Re.value)})]}),m.jsx("button",{type:"button",className:"orange-btn book-btn",onClick:re,disabled:!w||!O,style:{marginTop:"20px"},children:"Book Now"})]})]})})})]})})]})}),m.jsx(fo,{})]}),m.jsxs(Cn,{show:U,onHide:fe,centered:!0,className:"popup-wrp",id:"congratulations",dialogClassName:"custom-modal",children:[m.jsx("style",{children:`
            .custom-modal .modal-content {
              padding: 30px 0 50px 0;
              margin: 0;
            }
          `}),m.jsx("button",{type:"button",className:"close",onClick:fe,"aria-label":"Close",children:m.jsx("span",{"aria-hidden":"true",children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close"})})}),m.jsx("div",{className:"modal-icon text-center mt-4",children:m.jsx("img",{src:"./images/check-icon.png",alt:"Icon"})}),m.jsxs(Cn.Header,{className:"border-0 flex-column text-center",children:[m.jsx(Cn.Title,{id:"exampleModalLongTitle",className:"w-100",children:m.jsx("h2",{children:"Congratulations"})}),m.jsxs("p",{style:{padding:"20px",fontSize:"20px",color:"#858484"},children:["Your appointment with",m.jsx("br",{})," ",a," is confirmed for ",m.jsx("br",{}),m.jsx("span",{className:"bookingDateTime",children:w&&O?`${w.toLocaleString("default",{month:"long",day:"numeric",year:"numeric"})} at ${O}`:""}),"."]})]}),m.jsx(Cn.Footer,{className:"d-flex justify-content-center border-0",children:m.jsx(mn,{to:"/doctor-home",className:"orange-btn",onClick:fe,children:"Ok"})})]})]})},_fe=()=>{};var A8={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SK=function(s){const n=[];let i=0;for(let a=0;a<s.length;a++){let l=s.charCodeAt(a);l<128?n[i++]=l:l<2048?(n[i++]=l>>6|192,n[i++]=l&63|128):(l&64512)===55296&&a+1<s.length&&(s.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(s.charCodeAt(++a)&1023),n[i++]=l>>18|240,n[i++]=l>>12&63|128,n[i++]=l>>6&63|128,n[i++]=l&63|128):(n[i++]=l>>12|224,n[i++]=l>>6&63|128,n[i++]=l&63|128)}return n},Efe=function(s){const n=[];let i=0,a=0;for(;i<s.length;){const l=s[i++];if(l<128)n[a++]=String.fromCharCode(l);else if(l>191&&l<224){const p=s[i++];n[a++]=String.fromCharCode((l&31)<<6|p&63)}else if(l>239&&l<365){const p=s[i++],_=s[i++],T=s[i++],w=((l&7)<<18|(p&63)<<12|(_&63)<<6|T&63)-65536;n[a++]=String.fromCharCode(55296+(w>>10)),n[a++]=String.fromCharCode(56320+(w&1023))}else{const p=s[i++],_=s[i++];n[a++]=String.fromCharCode((l&15)<<12|(p&63)<<6|_&63)}}return n.join("")},TK={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,n){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=n?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<s.length;l+=3){const p=s[l],_=l+1<s.length,T=_?s[l+1]:0,w=l+2<s.length,C=w?s[l+2]:0,O=p>>2,k=(p&3)<<4|T>>4;let U=(T&15)<<2|C>>6,G=C&63;w||(G=64,_||(U=64)),a.push(i[O],i[k],i[U],i[G])}return a.join("")},encodeString(s,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(s):this.encodeByteArray(SK(s),n)},decodeString(s,n){return this.HAS_NATIVE_SUPPORT&&!n?atob(s):Efe(this.decodeStringToByteArray(s,n))},decodeStringToByteArray(s,n){this.init_();const i=n?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<s.length;){const p=i[s.charAt(l++)],T=l<s.length?i[s.charAt(l)]:0;++l;const C=l<s.length?i[s.charAt(l)]:64;++l;const k=l<s.length?i[s.charAt(l)]:64;if(++l,p==null||T==null||C==null||k==null)throw new yfe;const U=p<<2|T>>4;if(a.push(U),C!==64){const G=T<<4&240|C>>2;if(a.push(G),k!==64){const z=C<<6&192|k;a.push(z)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class yfe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const vfe=function(s){const n=SK(s);return TK.encodeByteArray(n,!0)},bO=function(s){return vfe(s).replace(/\./g,"")},Sfe=function(s){try{return TK.decodeString(s,!0)}catch(n){console.error("base64Decode failed: ",n)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tfe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bfe=()=>Tfe().__FIREBASE_DEFAULTS__,wfe=()=>{if(typeof process>"u"||typeof A8>"u")return;const s=A8.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},Rfe=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const n=s&&Sfe(s[1]);return n&&JSON.parse(n)},sj=()=>{try{return _fe()||bfe()||wfe()||Rfe()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},Cfe=s=>{var n,i;return(i=(n=sj())===null||n===void 0?void 0:n.emulatorHosts)===null||i===void 0?void 0:i[s]},bK=s=>{const n=Cfe(s);if(!n)return;const i=n.lastIndexOf(":");if(i<=0||i+1===n.length)throw new Error(`Invalid host ${n} with no separate hostname and port!`);const a=parseInt(n.substring(i+1),10);return n[0]==="["?[n.substring(1,i-1),a]:[n.substring(0,i),a]},wK=()=>{var s;return(s=sj())===null||s===void 0?void 0:s.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Afe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((n,i)=>{this.resolve=n,this.reject=i})}wrapCallback(n){return(i,a)=>{i?this.reject(i):this.resolve(a),typeof n=="function"&&(this.promise.catch(()=>{}),n.length===1?n(i):n(i,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RK(s,n){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},a=n||"demo-project",l=s.iat||0,p=s.sub||s.user_id;if(!p)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const _=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:p,user_id:p,firebase:{sign_in_provider:"custom",identities:{}}},s);return[bO(JSON.stringify(i)),bO(JSON.stringify(_)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ife(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Nfe(){var s;const n=(s=sj())===null||s===void 0?void 0:s.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Ofe(){return!Nfe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Dfe(){try{return typeof indexedDB=="object"}catch{return!1}}function xfe(){return new Promise((s,n)=>{try{let i=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(a),s(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var p;n(((p=l.error)===null||p===void 0?void 0:p.message)||"")}}catch(i){n(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pfe="FirebaseError";class V_ extends Error{constructor(n,i,a){super(i),this.code=n,this.customData=a,this.name=Pfe,Object.setPrototypeOf(this,V_.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,CK.prototype.create)}}class CK{constructor(n,i,a){this.service=n,this.serviceName=i,this.errors=a}create(n,...i){const a=i[0]||{},l=`${this.service}/${n}`,p=this.errors[n],_=p?kfe(p,a):"Error",T=`${this.serviceName}: ${_} (${l}).`;return new V_(l,T,a)}}function kfe(s,n){return s.replace(Lfe,(i,a)=>{const l=n[a];return l!=null?String(l):`<${a}?>`})}const Lfe=/\{\$([^}]+)}/g;function wO(s,n){if(s===n)return!0;const i=Object.keys(s),a=Object.keys(n);for(const l of i){if(!a.includes(l))return!1;const p=s[l],_=n[l];if(I8(p)&&I8(_)){if(!wO(p,_))return!1}else if(p!==_)return!1}for(const l of a)if(!i.includes(l))return!1;return!0}function I8(s){return s!==null&&typeof s=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uo(s){return s&&s._delegate?s._delegate:s}class Vv{constructor(n,i,a){this.name=n,this.instanceFactory=i,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(n){return this.instantiationMode=n,this}setMultipleInstances(n){return this.multipleInstances=n,this}setServiceProps(n){return this.serviceProps=n,this}setInstanceCreatedCallback(n){return this.onInstanceCreated=n,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o_="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mfe{constructor(n,i){this.name=n,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(n){const i=this.normalizeInstanceIdentifier(n);if(!this.instancesDeferred.has(i)){const a=new Afe;if(this.instancesDeferred.set(i,a),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(n){var i;const a=this.normalizeInstanceIdentifier(n==null?void 0:n.identifier),l=(i=n==null?void 0:n.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(p){if(l)return null;throw p}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(n){if(n.name!==this.name)throw Error(`Mismatching Component ${n.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=n,!!this.shouldAutoInitialize()){if(Ufe(n))try{this.getOrInitializeService({instanceIdentifier:o_})}catch{}for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const p=this.getOrInitializeService({instanceIdentifier:l});a.resolve(p)}catch{}}}}clearInstance(n=o_){this.instancesDeferred.delete(n),this.instancesOptions.delete(n),this.instances.delete(n)}async delete(){const n=Array.from(this.instances.values());await Promise.all([...n.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...n.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(n=o_){return this.instances.has(n)}getOptions(n=o_){return this.instancesOptions.get(n)||{}}initialize(n={}){const{options:i={}}=n,a=this.normalizeInstanceIdentifier(n.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:i});for(const[p,_]of this.instancesDeferred.entries()){const T=this.normalizeInstanceIdentifier(p);a===T&&_.resolve(l)}return l}onInit(n,i){var a;const l=this.normalizeInstanceIdentifier(i),p=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;p.add(n),this.onInitCallbacks.set(l,p);const _=this.instances.get(l);return _&&n(_,l),()=>{p.delete(n)}}invokeOnInitCallbacks(n,i){const a=this.onInitCallbacks.get(i);if(a)for(const l of a)try{l(n,i)}catch{}}getOrInitializeService({instanceIdentifier:n,options:i={}}){let a=this.instances.get(n);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:jfe(n),options:i}),this.instances.set(n,a),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(a,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,a)}catch{}return a||null}normalizeInstanceIdentifier(n=o_){return this.component?this.component.multipleInstances?n:o_:n}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function jfe(s){return s===o_?void 0:s}function Ufe(s){return s.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vfe{constructor(n){this.name=n,this.providers=new Map}addComponent(n){const i=this.getProvider(n.name);if(i.isComponentSet())throw new Error(`Component ${n.name} has already been registered with ${this.name}`);i.setComponent(n)}addOrOverwriteComponent(n){this.getProvider(n.name).isComponentSet()&&this.providers.delete(n.name),this.addComponent(n)}getProvider(n){if(this.providers.has(n))return this.providers.get(n);const i=new Mfe(n,this);return this.providers.set(n,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Mr;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(Mr||(Mr={}));const Ffe={debug:Mr.DEBUG,verbose:Mr.VERBOSE,info:Mr.INFO,warn:Mr.WARN,error:Mr.ERROR,silent:Mr.SILENT},Bfe=Mr.INFO,Hfe={[Mr.DEBUG]:"log",[Mr.VERBOSE]:"log",[Mr.INFO]:"info",[Mr.WARN]:"warn",[Mr.ERROR]:"error"},Gfe=(s,n,...i)=>{if(n<s.logLevel)return;const a=new Date().toISOString(),l=Hfe[n];if(l)console[l](`[${a}]  ${s.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${n})`)};class AK{constructor(n){this.name=n,this._logLevel=Bfe,this._logHandler=Gfe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(n){if(!(n in Mr))throw new TypeError(`Invalid value "${n}" assigned to \`logLevel\``);this._logLevel=n}setLogLevel(n){this._logLevel=typeof n=="string"?Ffe[n]:n}get logHandler(){return this._logHandler}set logHandler(n){if(typeof n!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=n}get userLogHandler(){return this._userLogHandler}set userLogHandler(n){this._userLogHandler=n}debug(...n){this._userLogHandler&&this._userLogHandler(this,Mr.DEBUG,...n),this._logHandler(this,Mr.DEBUG,...n)}log(...n){this._userLogHandler&&this._userLogHandler(this,Mr.VERBOSE,...n),this._logHandler(this,Mr.VERBOSE,...n)}info(...n){this._userLogHandler&&this._userLogHandler(this,Mr.INFO,...n),this._logHandler(this,Mr.INFO,...n)}warn(...n){this._userLogHandler&&this._userLogHandler(this,Mr.WARN,...n),this._logHandler(this,Mr.WARN,...n)}error(...n){this._userLogHandler&&this._userLogHandler(this,Mr.ERROR,...n),this._logHandler(this,Mr.ERROR,...n)}}const Wfe=(s,n)=>n.some(i=>s instanceof i);let N8,O8;function zfe(){return N8||(N8=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Yfe(){return O8||(O8=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const IK=new WeakMap,n2=new WeakMap,NK=new WeakMap,tM=new WeakMap,aj=new WeakMap;function qfe(s){const n=new Promise((i,a)=>{const l=()=>{s.removeEventListener("success",p),s.removeEventListener("error",_)},p=()=>{i(zf(s.result)),l()},_=()=>{a(s.error),l()};s.addEventListener("success",p),s.addEventListener("error",_)});return n.then(i=>{i instanceof IDBCursor&&IK.set(i,s)}).catch(()=>{}),aj.set(n,s),n}function Kfe(s){if(n2.has(s))return;const n=new Promise((i,a)=>{const l=()=>{s.removeEventListener("complete",p),s.removeEventListener("error",_),s.removeEventListener("abort",_)},p=()=>{i(),l()},_=()=>{a(s.error||new DOMException("AbortError","AbortError")),l()};s.addEventListener("complete",p),s.addEventListener("error",_),s.addEventListener("abort",_)});n2.set(s,n)}let r2={get(s,n,i){if(s instanceof IDBTransaction){if(n==="done")return n2.get(s);if(n==="objectStoreNames")return s.objectStoreNames||NK.get(s);if(n==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return zf(s[n])},set(s,n,i){return s[n]=i,!0},has(s,n){return s instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in s}};function Xfe(s){r2=s(r2)}function Qfe(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(n,...i){const a=s.call(nM(this),n,...i);return NK.set(a,n.sort?n.sort():[n]),zf(a)}:Yfe().includes(s)?function(...n){return s.apply(nM(this),n),zf(IK.get(this))}:function(...n){return zf(s.apply(nM(this),n))}}function $fe(s){return typeof s=="function"?Qfe(s):(s instanceof IDBTransaction&&Kfe(s),Wfe(s,zfe())?new Proxy(s,r2):s)}function zf(s){if(s instanceof IDBRequest)return qfe(s);if(tM.has(s))return tM.get(s);const n=$fe(s);return n!==s&&(tM.set(s,n),aj.set(n,s)),n}const nM=s=>aj.get(s);function Jfe(s,n,{blocked:i,upgrade:a,blocking:l,terminated:p}={}){const _=indexedDB.open(s,n),T=zf(_);return a&&_.addEventListener("upgradeneeded",w=>{a(zf(_.result),w.oldVersion,w.newVersion,zf(_.transaction),w)}),i&&_.addEventListener("blocked",w=>i(w.oldVersion,w.newVersion,w)),T.then(w=>{p&&w.addEventListener("close",()=>p()),l&&w.addEventListener("versionchange",C=>l(C.oldVersion,C.newVersion,C))}).catch(()=>{}),T}const Zfe=["get","getKey","getAll","getAllKeys","count"],eme=["put","add","delete","clear"],rM=new Map;function D8(s,n){if(!(s instanceof IDBDatabase&&!(n in s)&&typeof n=="string"))return;if(rM.get(n))return rM.get(n);const i=n.replace(/FromIndex$/,""),a=n!==i,l=eme.includes(i);if(!(i in(a?IDBIndex:IDBObjectStore).prototype)||!(l||Zfe.includes(i)))return;const p=async function(_,...T){const w=this.transaction(_,l?"readwrite":"readonly");let C=w.store;return a&&(C=C.index(T.shift())),(await Promise.all([C[i](...T),l&&w.done]))[0]};return rM.set(n,p),p}Xfe(s=>({...s,get:(n,i,a)=>D8(n,i)||s.get(n,i,a),has:(n,i)=>!!D8(n,i)||s.has(n,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tme{constructor(n){this.container=n}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(nme(i)){const a=i.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(i=>i).join(" ")}}function nme(s){const n=s.getComponent();return(n==null?void 0:n.type)==="VERSION"}const i2="@firebase/app",x8="0.11.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pp=new AK("@firebase/app"),rme="@firebase/app-compat",ime="@firebase/analytics-compat",sme="@firebase/analytics",ame="@firebase/app-check-compat",ome="@firebase/app-check",cme="@firebase/auth",lme="@firebase/auth-compat",dme="@firebase/database",ume="@firebase/data-connect",hme="@firebase/database-compat",pme="@firebase/functions",fme="@firebase/functions-compat",mme="@firebase/installations",gme="@firebase/installations-compat",_me="@firebase/messaging",Eme="@firebase/messaging-compat",yme="@firebase/performance",vme="@firebase/performance-compat",Sme="@firebase/remote-config",Tme="@firebase/remote-config-compat",bme="@firebase/storage",wme="@firebase/storage-compat",Rme="@firebase/firestore",Cme="@firebase/vertexai",Ame="@firebase/firestore-compat",Ime="firebase",Nme="11.6.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s2="[DEFAULT]",Ome={[i2]:"fire-core",[rme]:"fire-core-compat",[sme]:"fire-analytics",[ime]:"fire-analytics-compat",[ome]:"fire-app-check",[ame]:"fire-app-check-compat",[cme]:"fire-auth",[lme]:"fire-auth-compat",[dme]:"fire-rtdb",[ume]:"fire-data-connect",[hme]:"fire-rtdb-compat",[pme]:"fire-fn",[fme]:"fire-fn-compat",[mme]:"fire-iid",[gme]:"fire-iid-compat",[_me]:"fire-fcm",[Eme]:"fire-fcm-compat",[yme]:"fire-perf",[vme]:"fire-perf-compat",[Sme]:"fire-rc",[Tme]:"fire-rc-compat",[bme]:"fire-gcs",[wme]:"fire-gcs-compat",[Rme]:"fire-fst",[Ame]:"fire-fst-compat",[Cme]:"fire-vertex","fire-js":"fire-js",[Ime]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RO=new Map,Dme=new Map,a2=new Map;function P8(s,n){try{s.container.addComponent(n)}catch(i){pp.debug(`Component ${n.name} failed to register with FirebaseApp ${s.name}`,i)}}function s0(s){const n=s.name;if(a2.has(n))return pp.debug(`There were multiple attempts to register component ${n}.`),!1;a2.set(n,s);for(const i of RO.values())P8(i,s);for(const i of Dme.values())P8(i,s);return!0}function OK(s,n){const i=s.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),s.container.getProvider(n)}function DK(s){return s==null?!1:s.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xme={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Yf=new CK("app","Firebase",xme);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pme{constructor(n,i,a){this._isDeleted=!1,this._options=Object.assign({},n),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Vv("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(n){this.checkDestroyed(),this._automaticDataCollectionEnabled=n}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(n){this._isDeleted=n}checkDestroyed(){if(this.isDeleted)throw Yf.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xK=Nme;function PK(s,n={}){let i=s;typeof n!="object"&&(n={name:n});const a=Object.assign({name:s2,automaticDataCollectionEnabled:!1},n),l=a.name;if(typeof l!="string"||!l)throw Yf.create("bad-app-name",{appName:String(l)});if(i||(i=wK()),!i)throw Yf.create("no-options");const p=RO.get(l);if(p){if(wO(i,p.options)&&wO(a,p.config))return p;throw Yf.create("duplicate-app",{appName:l})}const _=new Vfe(l);for(const w of a2.values())_.addComponent(w);const T=new Pme(i,a,_);return RO.set(l,T),T}function kK(s=s2){const n=RO.get(s);if(!n&&s===s2&&wK())return PK();if(!n)throw Yf.create("no-app",{appName:s});return n}function qf(s,n,i){var a;let l=(a=Ome[s])!==null&&a!==void 0?a:s;i&&(l+=`-${i}`);const p=l.match(/\s|\//),_=n.match(/\s|\//);if(p||_){const T=[`Unable to register library "${l}" with version "${n}":`];p&&T.push(`library name "${l}" contains illegal characters (whitespace or "/")`),p&&_&&T.push("and"),_&&T.push(`version name "${n}" contains illegal characters (whitespace or "/")`),pp.warn(T.join(" "));return}s0(new Vv(`${l}-version`,()=>({library:l,version:n}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kme="firebase-heartbeat-database",Lme=1,a0="firebase-heartbeat-store";let iM=null;function LK(){return iM||(iM=Jfe(kme,Lme,{upgrade:(s,n)=>{switch(n){case 0:try{s.createObjectStore(a0)}catch(i){console.warn(i)}}}}).catch(s=>{throw Yf.create("idb-open",{originalErrorMessage:s.message})})),iM}async function Mme(s){try{const i=(await LK()).transaction(a0),a=await i.objectStore(a0).get(MK(s));return await i.done,a}catch(n){if(n instanceof V_)pp.warn(n.message);else{const i=Yf.create("idb-get",{originalErrorMessage:n==null?void 0:n.message});pp.warn(i.message)}}}async function k8(s,n){try{const a=(await LK()).transaction(a0,"readwrite");await a.objectStore(a0).put(n,MK(s)),await a.done}catch(i){if(i instanceof V_)pp.warn(i.message);else{const a=Yf.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});pp.warn(a.message)}}}function MK(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jme=1024,Ume=30;class Vme{constructor(n){this.container=n,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new Bme(i),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var n,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),p=L8();if(((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===p||this._heartbeatsCache.heartbeats.some(_=>_.date===p))return;if(this._heartbeatsCache.heartbeats.push({date:p,agent:l}),this._heartbeatsCache.heartbeats.length>Ume){const _=Hme(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(_,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){pp.warn(a)}}async getHeartbeatsHeader(){var n;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=L8(),{heartbeatsToSend:a,unsentEntries:l}=Fme(this._heartbeatsCache.heartbeats),p=bO(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),p}catch(i){return pp.warn(i),""}}}function L8(){return new Date().toISOString().substring(0,10)}function Fme(s,n=jme){const i=[];let a=s.slice();for(const l of s){const p=i.find(_=>_.agent===l.agent);if(p){if(p.dates.push(l.date),M8(i)>n){p.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),M8(i)>n){i.pop();break}a=a.slice(1)}return{heartbeatsToSend:i,unsentEntries:a}}class Bme{constructor(n){this.app=n,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Dfe()?xfe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await Mme(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(n){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return k8(this.app,{lastSentHeartbeatDate:(i=n.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:n.heartbeats})}else return}async add(n){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return k8(this.app,{lastSentHeartbeatDate:(i=n.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...n.heartbeats]})}else return}}function M8(s){return bO(JSON.stringify({version:2,heartbeats:s})).length}function Hme(s){if(s.length===0)return-1;let n=0,i=s[0].date;for(let a=1;a<s.length;a++)s[a].date<i&&(i=s[a].date,n=a);return n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gme(s){s0(new Vv("platform-logger",n=>new tme(n),"PRIVATE")),s0(new Vv("heartbeat",n=>new Vme(n),"PRIVATE")),qf(i2,x8,s),qf(i2,x8,"esm2017"),qf("fire-js","")}Gme("");var j8=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Kf,jK;(function(){var s;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function n(ee,Q){function q(){}q.prototype=Q.prototype,ee.D=Q.prototype,ee.prototype=new q,ee.prototype.constructor=ee,ee.C=function(ae,re,fe){for(var pe=Array(arguments.length-2),Re=2;Re<arguments.length;Re++)pe[Re-2]=arguments[Re];return Q.prototype[re].apply(ae,pe)}}function i(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}n(a,i),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(ee,Q,q){q||(q=0);var ae=Array(16);if(typeof Q=="string")for(var re=0;16>re;++re)ae[re]=Q.charCodeAt(q++)|Q.charCodeAt(q++)<<8|Q.charCodeAt(q++)<<16|Q.charCodeAt(q++)<<24;else for(re=0;16>re;++re)ae[re]=Q[q++]|Q[q++]<<8|Q[q++]<<16|Q[q++]<<24;Q=ee.g[0],q=ee.g[1],re=ee.g[2];var fe=ee.g[3],pe=Q+(fe^q&(re^fe))+ae[0]+3614090360&4294967295;Q=q+(pe<<7&4294967295|pe>>>25),pe=fe+(re^Q&(q^re))+ae[1]+3905402710&4294967295,fe=Q+(pe<<12&4294967295|pe>>>20),pe=re+(q^fe&(Q^q))+ae[2]+606105819&4294967295,re=fe+(pe<<17&4294967295|pe>>>15),pe=q+(Q^re&(fe^Q))+ae[3]+3250441966&4294967295,q=re+(pe<<22&4294967295|pe>>>10),pe=Q+(fe^q&(re^fe))+ae[4]+4118548399&4294967295,Q=q+(pe<<7&4294967295|pe>>>25),pe=fe+(re^Q&(q^re))+ae[5]+1200080426&4294967295,fe=Q+(pe<<12&4294967295|pe>>>20),pe=re+(q^fe&(Q^q))+ae[6]+2821735955&4294967295,re=fe+(pe<<17&4294967295|pe>>>15),pe=q+(Q^re&(fe^Q))+ae[7]+4249261313&4294967295,q=re+(pe<<22&4294967295|pe>>>10),pe=Q+(fe^q&(re^fe))+ae[8]+1770035416&4294967295,Q=q+(pe<<7&4294967295|pe>>>25),pe=fe+(re^Q&(q^re))+ae[9]+2336552879&4294967295,fe=Q+(pe<<12&4294967295|pe>>>20),pe=re+(q^fe&(Q^q))+ae[10]+4294925233&4294967295,re=fe+(pe<<17&4294967295|pe>>>15),pe=q+(Q^re&(fe^Q))+ae[11]+2304563134&4294967295,q=re+(pe<<22&4294967295|pe>>>10),pe=Q+(fe^q&(re^fe))+ae[12]+1804603682&4294967295,Q=q+(pe<<7&4294967295|pe>>>25),pe=fe+(re^Q&(q^re))+ae[13]+4254626195&4294967295,fe=Q+(pe<<12&4294967295|pe>>>20),pe=re+(q^fe&(Q^q))+ae[14]+2792965006&4294967295,re=fe+(pe<<17&4294967295|pe>>>15),pe=q+(Q^re&(fe^Q))+ae[15]+1236535329&4294967295,q=re+(pe<<22&4294967295|pe>>>10),pe=Q+(re^fe&(q^re))+ae[1]+4129170786&4294967295,Q=q+(pe<<5&4294967295|pe>>>27),pe=fe+(q^re&(Q^q))+ae[6]+3225465664&4294967295,fe=Q+(pe<<9&4294967295|pe>>>23),pe=re+(Q^q&(fe^Q))+ae[11]+643717713&4294967295,re=fe+(pe<<14&4294967295|pe>>>18),pe=q+(fe^Q&(re^fe))+ae[0]+3921069994&4294967295,q=re+(pe<<20&4294967295|pe>>>12),pe=Q+(re^fe&(q^re))+ae[5]+3593408605&4294967295,Q=q+(pe<<5&4294967295|pe>>>27),pe=fe+(q^re&(Q^q))+ae[10]+38016083&4294967295,fe=Q+(pe<<9&4294967295|pe>>>23),pe=re+(Q^q&(fe^Q))+ae[15]+3634488961&4294967295,re=fe+(pe<<14&4294967295|pe>>>18),pe=q+(fe^Q&(re^fe))+ae[4]+3889429448&4294967295,q=re+(pe<<20&4294967295|pe>>>12),pe=Q+(re^fe&(q^re))+ae[9]+568446438&4294967295,Q=q+(pe<<5&4294967295|pe>>>27),pe=fe+(q^re&(Q^q))+ae[14]+3275163606&4294967295,fe=Q+(pe<<9&4294967295|pe>>>23),pe=re+(Q^q&(fe^Q))+ae[3]+4107603335&4294967295,re=fe+(pe<<14&4294967295|pe>>>18),pe=q+(fe^Q&(re^fe))+ae[8]+1163531501&4294967295,q=re+(pe<<20&4294967295|pe>>>12),pe=Q+(re^fe&(q^re))+ae[13]+2850285829&4294967295,Q=q+(pe<<5&4294967295|pe>>>27),pe=fe+(q^re&(Q^q))+ae[2]+4243563512&4294967295,fe=Q+(pe<<9&4294967295|pe>>>23),pe=re+(Q^q&(fe^Q))+ae[7]+1735328473&4294967295,re=fe+(pe<<14&4294967295|pe>>>18),pe=q+(fe^Q&(re^fe))+ae[12]+2368359562&4294967295,q=re+(pe<<20&4294967295|pe>>>12),pe=Q+(q^re^fe)+ae[5]+4294588738&4294967295,Q=q+(pe<<4&4294967295|pe>>>28),pe=fe+(Q^q^re)+ae[8]+2272392833&4294967295,fe=Q+(pe<<11&4294967295|pe>>>21),pe=re+(fe^Q^q)+ae[11]+1839030562&4294967295,re=fe+(pe<<16&4294967295|pe>>>16),pe=q+(re^fe^Q)+ae[14]+4259657740&4294967295,q=re+(pe<<23&4294967295|pe>>>9),pe=Q+(q^re^fe)+ae[1]+2763975236&4294967295,Q=q+(pe<<4&4294967295|pe>>>28),pe=fe+(Q^q^re)+ae[4]+1272893353&4294967295,fe=Q+(pe<<11&4294967295|pe>>>21),pe=re+(fe^Q^q)+ae[7]+4139469664&4294967295,re=fe+(pe<<16&4294967295|pe>>>16),pe=q+(re^fe^Q)+ae[10]+3200236656&4294967295,q=re+(pe<<23&4294967295|pe>>>9),pe=Q+(q^re^fe)+ae[13]+681279174&4294967295,Q=q+(pe<<4&4294967295|pe>>>28),pe=fe+(Q^q^re)+ae[0]+3936430074&4294967295,fe=Q+(pe<<11&4294967295|pe>>>21),pe=re+(fe^Q^q)+ae[3]+3572445317&4294967295,re=fe+(pe<<16&4294967295|pe>>>16),pe=q+(re^fe^Q)+ae[6]+76029189&4294967295,q=re+(pe<<23&4294967295|pe>>>9),pe=Q+(q^re^fe)+ae[9]+3654602809&4294967295,Q=q+(pe<<4&4294967295|pe>>>28),pe=fe+(Q^q^re)+ae[12]+3873151461&4294967295,fe=Q+(pe<<11&4294967295|pe>>>21),pe=re+(fe^Q^q)+ae[15]+530742520&4294967295,re=fe+(pe<<16&4294967295|pe>>>16),pe=q+(re^fe^Q)+ae[2]+3299628645&4294967295,q=re+(pe<<23&4294967295|pe>>>9),pe=Q+(re^(q|~fe))+ae[0]+4096336452&4294967295,Q=q+(pe<<6&4294967295|pe>>>26),pe=fe+(q^(Q|~re))+ae[7]+1126891415&4294967295,fe=Q+(pe<<10&4294967295|pe>>>22),pe=re+(Q^(fe|~q))+ae[14]+2878612391&4294967295,re=fe+(pe<<15&4294967295|pe>>>17),pe=q+(fe^(re|~Q))+ae[5]+4237533241&4294967295,q=re+(pe<<21&4294967295|pe>>>11),pe=Q+(re^(q|~fe))+ae[12]+1700485571&4294967295,Q=q+(pe<<6&4294967295|pe>>>26),pe=fe+(q^(Q|~re))+ae[3]+2399980690&4294967295,fe=Q+(pe<<10&4294967295|pe>>>22),pe=re+(Q^(fe|~q))+ae[10]+4293915773&4294967295,re=fe+(pe<<15&4294967295|pe>>>17),pe=q+(fe^(re|~Q))+ae[1]+2240044497&4294967295,q=re+(pe<<21&4294967295|pe>>>11),pe=Q+(re^(q|~fe))+ae[8]+1873313359&4294967295,Q=q+(pe<<6&4294967295|pe>>>26),pe=fe+(q^(Q|~re))+ae[15]+4264355552&4294967295,fe=Q+(pe<<10&4294967295|pe>>>22),pe=re+(Q^(fe|~q))+ae[6]+2734768916&4294967295,re=fe+(pe<<15&4294967295|pe>>>17),pe=q+(fe^(re|~Q))+ae[13]+1309151649&4294967295,q=re+(pe<<21&4294967295|pe>>>11),pe=Q+(re^(q|~fe))+ae[4]+4149444226&4294967295,Q=q+(pe<<6&4294967295|pe>>>26),pe=fe+(q^(Q|~re))+ae[11]+3174756917&4294967295,fe=Q+(pe<<10&4294967295|pe>>>22),pe=re+(Q^(fe|~q))+ae[2]+718787259&4294967295,re=fe+(pe<<15&4294967295|pe>>>17),pe=q+(fe^(re|~Q))+ae[9]+3951481745&4294967295,ee.g[0]=ee.g[0]+Q&4294967295,ee.g[1]=ee.g[1]+(re+(pe<<21&4294967295|pe>>>11))&4294967295,ee.g[2]=ee.g[2]+re&4294967295,ee.g[3]=ee.g[3]+fe&4294967295}a.prototype.u=function(ee,Q){Q===void 0&&(Q=ee.length);for(var q=Q-this.blockSize,ae=this.B,re=this.h,fe=0;fe<Q;){if(re==0)for(;fe<=q;)l(this,ee,fe),fe+=this.blockSize;if(typeof ee=="string"){for(;fe<Q;)if(ae[re++]=ee.charCodeAt(fe++),re==this.blockSize){l(this,ae),re=0;break}}else for(;fe<Q;)if(ae[re++]=ee[fe++],re==this.blockSize){l(this,ae),re=0;break}}this.h=re,this.o+=Q},a.prototype.v=function(){var ee=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);ee[0]=128;for(var Q=1;Q<ee.length-8;++Q)ee[Q]=0;var q=8*this.o;for(Q=ee.length-8;Q<ee.length;++Q)ee[Q]=q&255,q/=256;for(this.u(ee),ee=Array(16),Q=q=0;4>Q;++Q)for(var ae=0;32>ae;ae+=8)ee[q++]=this.g[Q]>>>ae&255;return ee};function p(ee,Q){var q=T;return Object.prototype.hasOwnProperty.call(q,ee)?q[ee]:q[ee]=Q(ee)}function _(ee,Q){this.h=Q;for(var q=[],ae=!0,re=ee.length-1;0<=re;re--){var fe=ee[re]|0;ae&&fe==Q||(q[re]=fe,ae=!1)}this.g=q}var T={};function w(ee){return-128<=ee&&128>ee?p(ee,function(Q){return new _([Q|0],0>Q?-1:0)}):new _([ee|0],0>ee?-1:0)}function C(ee){if(isNaN(ee)||!isFinite(ee))return k;if(0>ee)return X(C(-ee));for(var Q=[],q=1,ae=0;ee>=q;ae++)Q[ae]=ee/q|0,q*=4294967296;return new _(Q,0)}function O(ee,Q){if(ee.length==0)throw Error("number format error: empty string");if(Q=Q||10,2>Q||36<Q)throw Error("radix out of range: "+Q);if(ee.charAt(0)=="-")return X(O(ee.substring(1),Q));if(0<=ee.indexOf("-"))throw Error('number format error: interior "-" character');for(var q=C(Math.pow(Q,8)),ae=k,re=0;re<ee.length;re+=8){var fe=Math.min(8,ee.length-re),pe=parseInt(ee.substring(re,re+fe),Q);8>fe?(fe=C(Math.pow(Q,fe)),ae=ae.j(fe).add(C(pe))):(ae=ae.j(q),ae=ae.add(C(pe)))}return ae}var k=w(0),U=w(1),G=w(16777216);s=_.prototype,s.m=function(){if(J(this))return-X(this).m();for(var ee=0,Q=1,q=0;q<this.g.length;q++){var ae=this.i(q);ee+=(0<=ae?ae:4294967296+ae)*Q,Q*=4294967296}return ee},s.toString=function(ee){if(ee=ee||10,2>ee||36<ee)throw Error("radix out of range: "+ee);if(z(this))return"0";if(J(this))return"-"+X(this).toString(ee);for(var Q=C(Math.pow(ee,6)),q=this,ae="";;){var re=_e(q,Q).g;q=ie(q,re.j(Q));var fe=((0<q.g.length?q.g[0]:q.h)>>>0).toString(ee);if(q=re,z(q))return fe+ae;for(;6>fe.length;)fe="0"+fe;ae=fe+ae}},s.i=function(ee){return 0>ee?0:ee<this.g.length?this.g[ee]:this.h};function z(ee){if(ee.h!=0)return!1;for(var Q=0;Q<ee.g.length;Q++)if(ee.g[Q]!=0)return!1;return!0}function J(ee){return ee.h==-1}s.l=function(ee){return ee=ie(this,ee),J(ee)?-1:z(ee)?0:1};function X(ee){for(var Q=ee.g.length,q=[],ae=0;ae<Q;ae++)q[ae]=~ee.g[ae];return new _(q,~ee.h).add(U)}s.abs=function(){return J(this)?X(this):this},s.add=function(ee){for(var Q=Math.max(this.g.length,ee.g.length),q=[],ae=0,re=0;re<=Q;re++){var fe=ae+(this.i(re)&65535)+(ee.i(re)&65535),pe=(fe>>>16)+(this.i(re)>>>16)+(ee.i(re)>>>16);ae=pe>>>16,fe&=65535,pe&=65535,q[re]=pe<<16|fe}return new _(q,q[q.length-1]&-2147483648?-1:0)};function ie(ee,Q){return ee.add(X(Q))}s.j=function(ee){if(z(this)||z(ee))return k;if(J(this))return J(ee)?X(this).j(X(ee)):X(X(this).j(ee));if(J(ee))return X(this.j(X(ee)));if(0>this.l(G)&&0>ee.l(G))return C(this.m()*ee.m());for(var Q=this.g.length+ee.g.length,q=[],ae=0;ae<2*Q;ae++)q[ae]=0;for(ae=0;ae<this.g.length;ae++)for(var re=0;re<ee.g.length;re++){var fe=this.i(ae)>>>16,pe=this.i(ae)&65535,Re=ee.i(re)>>>16,Ge=ee.i(re)&65535;q[2*ae+2*re]+=pe*Ge,oe(q,2*ae+2*re),q[2*ae+2*re+1]+=fe*Ge,oe(q,2*ae+2*re+1),q[2*ae+2*re+1]+=pe*Re,oe(q,2*ae+2*re+1),q[2*ae+2*re+2]+=fe*Re,oe(q,2*ae+2*re+2)}for(ae=0;ae<Q;ae++)q[ae]=q[2*ae+1]<<16|q[2*ae];for(ae=Q;ae<2*Q;ae++)q[ae]=0;return new _(q,0)};function oe(ee,Q){for(;(ee[Q]&65535)!=ee[Q];)ee[Q+1]+=ee[Q]>>>16,ee[Q]&=65535,Q++}function ce(ee,Q){this.g=ee,this.h=Q}function _e(ee,Q){if(z(Q))throw Error("division by zero");if(z(ee))return new ce(k,k);if(J(ee))return Q=_e(X(ee),Q),new ce(X(Q.g),X(Q.h));if(J(Q))return Q=_e(ee,X(Q)),new ce(X(Q.g),Q.h);if(30<ee.g.length){if(J(ee)||J(Q))throw Error("slowDivide_ only works with positive integers.");for(var q=U,ae=Q;0>=ae.l(ee);)q=se(q),ae=se(ae);var re=be(q,1),fe=be(ae,1);for(ae=be(ae,2),q=be(q,2);!z(ae);){var pe=fe.add(ae);0>=pe.l(ee)&&(re=re.add(q),fe=pe),ae=be(ae,1),q=be(q,1)}return Q=ie(ee,re.j(Q)),new ce(re,Q)}for(re=k;0<=ee.l(Q);){for(q=Math.max(1,Math.floor(ee.m()/Q.m())),ae=Math.ceil(Math.log(q)/Math.LN2),ae=48>=ae?1:Math.pow(2,ae-48),fe=C(q),pe=fe.j(Q);J(pe)||0<pe.l(ee);)q-=ae,fe=C(q),pe=fe.j(Q);z(fe)&&(fe=U),re=re.add(fe),ee=ie(ee,pe)}return new ce(re,ee)}s.A=function(ee){return _e(this,ee).h},s.and=function(ee){for(var Q=Math.max(this.g.length,ee.g.length),q=[],ae=0;ae<Q;ae++)q[ae]=this.i(ae)&ee.i(ae);return new _(q,this.h&ee.h)},s.or=function(ee){for(var Q=Math.max(this.g.length,ee.g.length),q=[],ae=0;ae<Q;ae++)q[ae]=this.i(ae)|ee.i(ae);return new _(q,this.h|ee.h)},s.xor=function(ee){for(var Q=Math.max(this.g.length,ee.g.length),q=[],ae=0;ae<Q;ae++)q[ae]=this.i(ae)^ee.i(ae);return new _(q,this.h^ee.h)};function se(ee){for(var Q=ee.g.length+1,q=[],ae=0;ae<Q;ae++)q[ae]=ee.i(ae)<<1|ee.i(ae-1)>>>31;return new _(q,ee.h)}function be(ee,Q){var q=Q>>5;Q%=32;for(var ae=ee.g.length-q,re=[],fe=0;fe<ae;fe++)re[fe]=0<Q?ee.i(fe+q)>>>Q|ee.i(fe+q+1)<<32-Q:ee.i(fe+q);return new _(re,ee.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,jK=a,_.prototype.add=_.prototype.add,_.prototype.multiply=_.prototype.j,_.prototype.modulo=_.prototype.A,_.prototype.compare=_.prototype.l,_.prototype.toNumber=_.prototype.m,_.prototype.toString=_.prototype.toString,_.prototype.getBits=_.prototype.i,_.fromNumber=C,_.fromString=O,Kf=_}).apply(typeof j8<"u"?j8:typeof self<"u"?self:typeof window<"u"?window:{});var nN=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var UK,xw,VK,$N,o2,FK,BK,HK;(function(){var s,n=typeof Object.defineProperties=="function"?Object.defineProperty:function(A,B,$){return A==Array.prototype||A==Object.prototype||(A[B]=$.value),A};function i(A){A=[typeof globalThis=="object"&&globalThis,A,typeof window=="object"&&window,typeof self=="object"&&self,typeof nN=="object"&&nN];for(var B=0;B<A.length;++B){var $=A[B];if($&&$.Math==Math)return $}throw Error("Cannot find global object")}var a=i(this);function l(A,B){if(B)e:{var $=a;A=A.split(".");for(var ge=0;ge<A.length-1;ge++){var Ve=A[ge];if(!(Ve in $))break e;$=$[Ve]}A=A[A.length-1],ge=$[A],B=B(ge),B!=ge&&B!=null&&n($,A,{configurable:!0,writable:!0,value:B})}}function p(A,B){A instanceof String&&(A+="");var $=0,ge=!1,Ve={next:function(){if(!ge&&$<A.length){var Je=$++;return{value:B(Je,A[Je]),done:!1}}return ge=!0,{done:!0,value:void 0}}};return Ve[Symbol.iterator]=function(){return Ve},Ve}l("Array.prototype.values",function(A){return A||function(){return p(this,function(B,$){return $})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var _=_||{},T=this||self;function w(A){var B=typeof A;return B=B!="object"?B:A?Array.isArray(A)?"array":B:"null",B=="array"||B=="object"&&typeof A.length=="number"}function C(A){var B=typeof A;return B=="object"&&A!=null||B=="function"}function O(A,B,$){return A.call.apply(A.bind,arguments)}function k(A,B,$){if(!A)throw Error();if(2<arguments.length){var ge=Array.prototype.slice.call(arguments,2);return function(){var Ve=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ve,ge),A.apply(B,Ve)}}return function(){return A.apply(B,arguments)}}function U(A,B,$){return U=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?O:k,U.apply(null,arguments)}function G(A,B){var $=Array.prototype.slice.call(arguments,1);return function(){var ge=$.slice();return ge.push.apply(ge,arguments),A.apply(this,ge)}}function z(A,B){function $(){}$.prototype=B.prototype,A.aa=B.prototype,A.prototype=new $,A.prototype.constructor=A,A.Qb=function(ge,Ve,Je){for(var Nt=Array(arguments.length-2),Sr=2;Sr<arguments.length;Sr++)Nt[Sr-2]=arguments[Sr];return B.prototype[Ve].apply(ge,Nt)}}function J(A){const B=A.length;if(0<B){const $=Array(B);for(let ge=0;ge<B;ge++)$[ge]=A[ge];return $}return[]}function X(A,B){for(let $=1;$<arguments.length;$++){const ge=arguments[$];if(w(ge)){const Ve=A.length||0,Je=ge.length||0;A.length=Ve+Je;for(let Nt=0;Nt<Je;Nt++)A[Ve+Nt]=ge[Nt]}else A.push(ge)}}class ie{constructor(B,$){this.i=B,this.j=$,this.h=0,this.g=null}get(){let B;return 0<this.h?(this.h--,B=this.g,this.g=B.next,B.next=null):B=this.i(),B}}function oe(A){return/^[\s\xa0]*$/.test(A)}function ce(){var A=T.navigator;return A&&(A=A.userAgent)?A:""}function _e(A){return _e[" "](A),A}_e[" "]=function(){};var se=ce().indexOf("Gecko")!=-1&&!(ce().toLowerCase().indexOf("webkit")!=-1&&ce().indexOf("Edge")==-1)&&!(ce().indexOf("Trident")!=-1||ce().indexOf("MSIE")!=-1)&&ce().indexOf("Edge")==-1;function be(A,B,$){for(const ge in A)B.call($,A[ge],ge,A)}function ee(A,B){for(const $ in A)B.call(void 0,A[$],$,A)}function Q(A){const B={};for(const $ in A)B[$]=A[$];return B}const q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ae(A,B){let $,ge;for(let Ve=1;Ve<arguments.length;Ve++){ge=arguments[Ve];for($ in ge)A[$]=ge[$];for(let Je=0;Je<q.length;Je++)$=q[Je],Object.prototype.hasOwnProperty.call(ge,$)&&(A[$]=ge[$])}}function re(A){var B=1;A=A.split(":");const $=[];for(;0<B&&A.length;)$.push(A.shift()),B--;return A.length&&$.push(A.join(":")),$}function fe(A){T.setTimeout(()=>{throw A},0)}function pe(){var A=Ue;let B=null;return A.g&&(B=A.g,A.g=A.g.next,A.g||(A.h=null),B.next=null),B}class Re{constructor(){this.h=this.g=null}add(B,$){const ge=Ge.get();ge.set(B,$),this.h?this.h.next=ge:this.g=ge,this.h=ge}}var Ge=new ie(()=>new ve,A=>A.reset());class ve{constructor(){this.next=this.g=this.h=null}set(B,$){this.h=B,this.g=$,this.next=null}reset(){this.next=this.g=this.h=null}}let Ne,Ce=!1,Ue=new Re,de=()=>{const A=T.Promise.resolve(void 0);Ne=()=>{A.then(De)}};var De=()=>{for(var A;A=pe();){try{A.h.call(A.g)}catch($){fe($)}var B=Ge;B.j(A),100>B.h&&(B.h++,A.next=B.g,B.g=A)}Ce=!1};function xe(){this.s=this.s,this.C=this.C}xe.prototype.s=!1,xe.prototype.ma=function(){this.s||(this.s=!0,this.N())},xe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Xe(A,B){this.type=A,this.g=this.target=B,this.defaultPrevented=!1}Xe.prototype.h=function(){this.defaultPrevented=!0};var ut=function(){if(!T.addEventListener||!Object.defineProperty)return!1;var A=!1,B=Object.defineProperty({},"passive",{get:function(){A=!0}});try{const $=()=>{};T.addEventListener("test",$,B),T.removeEventListener("test",$,B)}catch{}return A}();function Pt(A,B){if(Xe.call(this,A?A.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,A){var $=this.type=A.type,ge=A.changedTouches&&A.changedTouches.length?A.changedTouches[0]:null;if(this.target=A.target||A.srcElement,this.g=B,B=A.relatedTarget){if(se){e:{try{_e(B.nodeName);var Ve=!0;break e}catch{}Ve=!1}Ve||(B=null)}}else $=="mouseover"?B=A.fromElement:$=="mouseout"&&(B=A.toElement);this.relatedTarget=B,ge?(this.clientX=ge.clientX!==void 0?ge.clientX:ge.pageX,this.clientY=ge.clientY!==void 0?ge.clientY:ge.pageY,this.screenX=ge.screenX||0,this.screenY=ge.screenY||0):(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0),this.button=A.button,this.key=A.key||"",this.ctrlKey=A.ctrlKey,this.altKey=A.altKey,this.shiftKey=A.shiftKey,this.metaKey=A.metaKey,this.pointerId=A.pointerId||0,this.pointerType=typeof A.pointerType=="string"?A.pointerType:It[A.pointerType]||"",this.state=A.state,this.i=A,A.defaultPrevented&&Pt.aa.h.call(this)}}z(Pt,Xe);var It={2:"touch",3:"pen",4:"mouse"};Pt.prototype.h=function(){Pt.aa.h.call(this);var A=this.i;A.preventDefault?A.preventDefault():A.returnValue=!1};var zt="closure_listenable_"+(1e6*Math.random()|0),$t=0;function Tt(A,B,$,ge,Ve){this.listener=A,this.proxy=null,this.src=B,this.type=$,this.capture=!!ge,this.ha=Ve,this.key=++$t,this.da=this.fa=!1}function on(A){A.da=!0,A.listener=null,A.proxy=null,A.src=null,A.ha=null}function fn(A){this.src=A,this.g={},this.h=0}fn.prototype.add=function(A,B,$,ge,Ve){var Je=A.toString();A=this.g[Je],A||(A=this.g[Je]=[],this.h++);var Nt=yt(A,B,ge,Ve);return-1<Nt?(B=A[Nt],$||(B.fa=!1)):(B=new Tt(B,this.src,Je,!!ge,Ve),B.fa=$,A.push(B)),B};function Ut(A,B){var $=B.type;if($ in A.g){var ge=A.g[$],Ve=Array.prototype.indexOf.call(ge,B,void 0),Je;(Je=0<=Ve)&&Array.prototype.splice.call(ge,Ve,1),Je&&(on(B),A.g[$].length==0&&(delete A.g[$],A.h--))}}function yt(A,B,$,ge){for(var Ve=0;Ve<A.length;++Ve){var Je=A[Ve];if(!Je.da&&Je.listener==B&&Je.capture==!!$&&Je.ha==ge)return Ve}return-1}var an="closure_lm_"+(1e6*Math.random()|0),Dt={};function wt(A,B,$,ge,Ve){if(Array.isArray(B)){for(var Je=0;Je<B.length;Je++)wt(A,B[Je],$,ge,Ve);return null}return $=Li($),A&&A[zt]?A.K(B,$,C(ge)?!!ge.capture:!1,Ve):rt(A,B,$,!1,ge,Ve)}function rt(A,B,$,ge,Ve,Je){if(!B)throw Error("Invalid event type");var Nt=C(Ve)?!!Ve.capture:!!Ve,Sr=Cr(A);if(Sr||(A[an]=Sr=new fn(A)),$=Sr.add(B,$,ge,Nt,Je),$.proxy)return $;if(ge=xt(),$.proxy=ge,ge.src=A,ge.listener=$,A.addEventListener)ut||(Ve=Nt),Ve===void 0&&(Ve=!1),A.addEventListener(B.toString(),ge,Ve);else if(A.attachEvent)A.attachEvent(ki(B.toString()),ge);else if(A.addListener&&A.removeListener)A.addListener(ge);else throw Error("addEventListener and attachEvent are unavailable.");return $}function xt(){function A($){return B.call(A.src,A.listener,$)}const B=zi;return A}function Mt(A,B,$,ge,Ve){if(Array.isArray(B))for(var Je=0;Je<B.length;Je++)Mt(A,B[Je],$,ge,Ve);else ge=C(ge)?!!ge.capture:!!ge,$=Li($),A&&A[zt]?(A=A.i,B=String(B).toString(),B in A.g&&(Je=A.g[B],$=yt(Je,$,ge,Ve),-1<$&&(on(Je[$]),Array.prototype.splice.call(Je,$,1),Je.length==0&&(delete A.g[B],A.h--)))):A&&(A=Cr(A))&&(B=A.g[B.toString()],A=-1,B&&(A=yt(B,$,ge,Ve)),($=-1<A?B[A]:null)&&Bn($))}function Bn(A){if(typeof A!="number"&&A&&!A.da){var B=A.src;if(B&&B[zt])Ut(B.i,A);else{var $=A.type,ge=A.proxy;B.removeEventListener?B.removeEventListener($,ge,A.capture):B.detachEvent?B.detachEvent(ki($),ge):B.addListener&&B.removeListener&&B.removeListener(ge),($=Cr(B))?(Ut($,A),$.h==0&&($.src=null,B[an]=null)):on(A)}}}function ki(A){return A in Dt?Dt[A]:Dt[A]="on"+A}function zi(A,B){if(A.da)A=!0;else{B=new Pt(B,this);var $=A.listener,ge=A.ha||A.src;A.fa&&Bn(A),A=$.call(ge,B)}return A}function Cr(A){return A=A[an],A instanceof fn?A:null}var Un="__closure_events_fn_"+(1e9*Math.random()>>>0);function Li(A){return typeof A=="function"?A:(A[Un]||(A[Un]=function(B){return A.handleEvent(B)}),A[Un])}function vt(){xe.call(this),this.i=new fn(this),this.M=this,this.F=null}z(vt,xe),vt.prototype[zt]=!0,vt.prototype.removeEventListener=function(A,B,$,ge){Mt(this,A,B,$,ge)};function Bt(A,B){var $,ge=A.F;if(ge)for($=[];ge;ge=ge.F)$.push(ge);if(A=A.M,ge=B.type||B,typeof B=="string")B=new Xe(B,A);else if(B instanceof Xe)B.target=B.target||A;else{var Ve=B;B=new Xe(ge,A),ae(B,Ve)}if(Ve=!0,$)for(var Je=$.length-1;0<=Je;Je--){var Nt=B.g=$[Je];Ve=bt(Nt,ge,!0,B)&&Ve}if(Nt=B.g=A,Ve=bt(Nt,ge,!0,B)&&Ve,Ve=bt(Nt,ge,!1,B)&&Ve,$)for(Je=0;Je<$.length;Je++)Nt=B.g=$[Je],Ve=bt(Nt,ge,!1,B)&&Ve}vt.prototype.N=function(){if(vt.aa.N.call(this),this.i){var A=this.i,B;for(B in A.g){for(var $=A.g[B],ge=0;ge<$.length;ge++)on($[ge]);delete A.g[B],A.h--}}this.F=null},vt.prototype.K=function(A,B,$,ge){return this.i.add(String(A),B,!1,$,ge)},vt.prototype.L=function(A,B,$,ge){return this.i.add(String(A),B,!0,$,ge)};function bt(A,B,$,ge){if(B=A.i.g[String(B)],!B)return!0;B=B.concat();for(var Ve=!0,Je=0;Je<B.length;++Je){var Nt=B[Je];if(Nt&&!Nt.da&&Nt.capture==$){var Sr=Nt.listener,Is=Nt.ha||Nt.src;Nt.fa&&Ut(A.i,Nt),Ve=Sr.call(Is,ge)!==!1&&Ve}}return Ve&&!ge.defaultPrevented}function rn(A,B,$){if(typeof A=="function")$&&(A=U(A,$));else if(A&&typeof A.handleEvent=="function")A=U(A.handleEvent,A);else throw Error("Invalid listener argument");return 2147483647<Number(B)?-1:T.setTimeout(A,B||0)}function Qn(A){A.g=rn(()=>{A.g=null,A.i&&(A.i=!1,Qn(A))},A.l);const B=A.h;A.h=null,A.m.apply(null,B)}class Ar extends xe{constructor(B,$){super(),this.m=B,this.l=$,this.h=null,this.i=!1,this.g=null}j(B){this.h=arguments,this.g?this.i=!0:Qn(this)}N(){super.N(),this.g&&(T.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $r(A){xe.call(this),this.h=A,this.g={}}z($r,xe);var br=[];function ji(A){be(A.g,function(B,$){this.g.hasOwnProperty($)&&Bn(B)},A),A.g={}}$r.prototype.N=function(){$r.aa.N.call(this),ji(this)},$r.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ts=T.JSON.stringify,ns=T.JSON.parse,Ra=class{stringify(A){return T.JSON.stringify(A,void 0)}parse(A){return T.JSON.parse(A,void 0)}};function Cs(){}Cs.prototype.h=null;function Ca(A){return A.h||(A.h=A.i())}function je(){}var sn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function cn(){Xe.call(this,"d")}z(cn,Xe);function Yn(){Xe.call(this,"c")}z(Yn,Xe);var Ke={},Yt=null;function un(){return Yt=Yt||new vt}Ke.La="serverreachability";function tn(A){Xe.call(this,Ke.La,A)}z(tn,Xe);function yn(A){const B=un();Bt(B,new tn(B))}Ke.STAT_EVENT="statevent";function ri(A,B){Xe.call(this,Ke.STAT_EVENT,A),this.stat=B}z(ri,Xe);function ln(A){const B=un();Bt(B,new ri(B,A))}Ke.Ma="timingevent";function or(A,B){Xe.call(this,Ke.Ma,A),this.size=B}z(or,Xe);function pr(A,B){if(typeof A!="function")throw Error("Fn must not be null and must be a function");return T.setTimeout(function(){A()},B)}function qr(){this.g=!0}qr.prototype.xa=function(){this.g=!1};function rs(A,B,$,ge,Ve,Je){A.info(function(){if(A.g)if(Je)for(var Nt="",Sr=Je.split("&"),Is=0;Is<Sr.length;Is++){var qn=Sr[Is].split("=");if(1<qn.length){var zs=qn[0];qn=qn[1];var Ns=zs.split("_");Nt=2<=Ns.length&&Ns[1]=="type"?Nt+(zs+"="+qn+"&"):Nt+(zs+"=redacted&")}}else Nt=null;else Nt=Je;return"XMLHTTP REQ ("+ge+") [attempt "+Ve+"]: "+B+`
`+$+`
`+Nt})}function mo(A,B,$,ge,Ve,Je,Nt){A.info(function(){return"XMLHTTP RESP ("+ge+") [ attempt "+Ve+"]: "+B+`
`+$+`
`+Je+" "+Nt})}function Hs(A,B,$,ge){A.info(function(){return"XMLHTTP TEXT ("+B+"): "+Ya(A,$)+(ge?" "+ge:"")})}function Wc(A,B){A.info(function(){return"TIMEOUT: "+B})}qr.prototype.info=function(){};function Ya(A,B){if(!A.g)return B;if(!B)return null;try{var $=JSON.parse(B);if($){for(A=0;A<$.length;A++)if(Array.isArray($[A])){var ge=$[A];if(!(2>ge.length)){var Ve=ge[1];if(Array.isArray(Ve)&&!(1>Ve.length)){var Je=Ve[0];if(Je!="noop"&&Je!="stop"&&Je!="close")for(var Nt=1;Nt<Ve.length;Nt++)Ve[Nt]=""}}}}return ts($)}catch{return B}}var Aa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Vo={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},go;function _o(){}z(_o,Cs),_o.prototype.g=function(){return new XMLHttpRequest},_o.prototype.i=function(){return{}},go=new _o;function As(A,B,$,ge){this.j=A,this.i=B,this.l=$,this.R=ge||1,this.U=new $r(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ui}function Ui(){this.i=null,this.g="",this.h=!1}var Yu={},qu={};function fa(A,B,$){A.L=1,A.v=Zu(yo(B)),A.m=$,A.P=!0,Ml(A,null)}function Ml(A,B){A.F=Date.now(),Ku(A),A.A=yo(A.v);var $=A.A,ge=A.R;Array.isArray(ge)||(ge=[String(ge)]),pm($.i,"t",ge),A.C=0,$=A.j.J,A.h=new Ui,A.g=vm(A.j,$?B:null,!A.m),0<A.O&&(A.M=new Ar(U(A.Y,A,A.g),A.O)),B=A.U,$=A.g,ge=A.ca;var Ve="readystatechange";Array.isArray(Ve)||(Ve&&(br[0]=Ve.toString()),Ve=br);for(var Je=0;Je<Ve.length;Je++){var Nt=wt($,Ve[Je],ge||B.handleEvent,!1,B.h||B);if(!Nt)break;B.g[Nt.key]=Nt}B=A.H?Q(A.H):{},A.m?(A.u||(A.u="POST"),B["Content-Type"]="application/x-www-form-urlencoded",A.g.ea(A.A,A.u,A.m,B)):(A.u="GET",A.g.ea(A.A,A.u,null,B)),yn(),rs(A.i,A.u,A.A,A.l,A.R,A.m)}As.prototype.ca=function(A){A=A.target;const B=this.M;B&&Ho(A)==3?B.j():this.Y(A)},As.prototype.Y=function(A){try{if(A==this.g)e:{const Ns=Ho(this.g);var B=this.g.Ba();const Wl=this.g.Z();if(!(3>Ns)&&(Ns!=3||this.g&&(this.h.h||this.g.oa()||Q_(this.g)))){this.J||Ns!=4||B==7||(B==8||0>=Wl?yn(3):yn(2)),hi(this);var $=this.g.Z();this.X=$;t:if(W_(this)){var ge=Q_(this.g);A="";var Ve=ge.length,Je=Ho(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){na(this),zc(this);var Nt="";break t}this.h.i=new T.TextDecoder}for(B=0;B<Ve;B++)this.h.h=!0,A+=this.h.i.decode(ge[B],{stream:!(Je&&B==Ve-1)});ge.length=0,this.h.g+=A,this.C=0,Nt=this.h.g}else Nt=this.g.oa();if(this.o=$==200,mo(this.i,this.u,this.A,this.l,this.R,Ns,$),this.o){if(this.T&&!this.K){t:{if(this.g){var Sr,Is=this.g;if((Sr=Is.g?Is.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!oe(Sr)){var qn=Sr;break t}}qn=null}if($=qn)Hs(this.i,this.l,$,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Xu(this,$);else{this.o=!1,this.s=3,ln(12),na(this),zc(this);break e}}if(this.P){$=!0;let Ys;for(;!this.J&&this.C<Nt.length;)if(Ys=Eo(this,Nt),Ys==qu){Ns==4&&(this.s=4,ln(14),$=!1),Hs(this.i,this.l,null,"[Incomplete Response]");break}else if(Ys==Yu){this.s=4,ln(15),Hs(this.i,this.l,Nt,"[Invalid Chunk]"),$=!1;break}else Hs(this.i,this.l,Ys,null),Xu(this,Ys);if(W_(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ns!=4||Nt.length!=0||this.h.h||(this.s=1,ln(16),$=!1),this.o=this.o&&$,!$)Hs(this.i,this.l,Nt,"[Invalid Chunked Response]"),na(this),zc(this);else if(0<Nt.length&&!this.W){this.W=!0;var zs=this.j;zs.g==this&&zs.ba&&!zs.M&&(zs.j.info("Great, no buffering proxy detected. Bytes received: "+Nt.length),sh(zs),zs.M=!0,ln(11))}}else Hs(this.i,this.l,Nt,null),Xu(this,Nt);Ns==4&&na(this),this.o&&!this.J&&(Ns==4?eE(this.j,this):(this.o=!1,Ku(this)))}else pS(this.g),$==400&&0<Nt.indexOf("Unknown SID")?(this.s=3,ln(12)):(this.s=0,ln(13)),na(this),zc(this)}}}catch{}finally{}};function W_(A){return A.g?A.u=="GET"&&A.L!=2&&A.j.Ca:!1}function Eo(A,B){var $=A.C,ge=B.indexOf(`
`,$);return ge==-1?qu:($=Number(B.substring($,ge)),isNaN($)?Yu:(ge+=1,ge+$>B.length?qu:(B=B.slice(ge,ge+$),A.C=ge+$,B)))}As.prototype.cancel=function(){this.J=!0,na(this)};function Ku(A){A.S=Date.now()+A.I,z_(A,A.I)}function z_(A,B){if(A.B!=null)throw Error("WatchDog timer not null");A.B=pr(U(A.ba,A),B)}function hi(A){A.B&&(T.clearTimeout(A.B),A.B=null)}As.prototype.ba=function(){this.B=null;const A=Date.now();0<=A-this.S?(Wc(this.i,this.A),this.L!=2&&(yn(),ln(17)),na(this),this.s=2,zc(this)):z_(this,this.S-A)};function zc(A){A.j.G==0||A.J||eE(A.j,A)}function na(A){hi(A);var B=A.M;B&&typeof B.ma=="function"&&B.ma(),A.M=null,ji(A.U),A.g&&(B=A.g,A.g=null,B.abort(),B.ma())}function Xu(A,B){try{var $=A.j;if($.G!=0&&($.g==A||dm($.h,A))){if(!A.K&&dm($.h,A)&&$.G==3){try{var ge=$.Da.g.parse(B)}catch{ge=null}if(Array.isArray(ge)&&ge.length==3){var Ve=ge;if(Ve[0]==0){e:if(!$.u){if($.g)if($.g.F+3e3<A.F)Cp($),kd($);else break e;Hl($),ln(18)}}else $.za=Ve[1],0<$.za-$.T&&37500>Ve[2]&&$.F&&$.v==0&&!$.C&&($.C=pr(U($.Za,$),6e3));if(1>=Qu($.h)&&$.ca){try{$.ca()}catch{}$.ca=void 0}}else Xa($,11)}else if((A.K||$.g==A)&&Cp($),!oe(B))for(Ve=$.Da.g.parse(B),B=0;B<Ve.length;B++){let qn=Ve[B];if($.T=qn[0],qn=qn[1],$.G==2)if(qn[0]=="c"){$.K=qn[1],$.ia=qn[2];const zs=qn[3];zs!=null&&($.la=zs,$.j.info("VER="+$.la));const Ns=qn[4];Ns!=null&&($.Aa=Ns,$.j.info("SVER="+$.Aa));const Wl=qn[5];Wl!=null&&typeof Wl=="number"&&0<Wl&&(ge=1.5*Wl,$.L=ge,$.j.info("backChannelRequestTimeoutMs_="+ge)),ge=$;const Ys=A.g;if(Ys){const Go=Ys.g?Ys.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Go){var Je=ge.h;Je.g||Go.indexOf("spdy")==-1&&Go.indexOf("quic")==-1&&Go.indexOf("h2")==-1||(Je.j=Je.l,Je.g=new Set,Je.h&&(vp(Je,Je.h),Je.h=null))}if(ge.D){const Sm=Ys.g?Ys.g.getResponseHeader("X-HTTP-Session-Id"):null;Sm&&(ge.ya=Sm,ii(ge.I,ge.D,Sm))}}$.G=3,$.l&&$.l.ua(),$.ba&&($.R=Date.now()-A.F,$.j.info("Handshake RTT: "+$.R+"ms")),ge=$;var Nt=A;if(ge.qa=Gl(ge,ge.J?ge.ia:null,ge.W),Nt.K){Ia(ge.h,Nt);var Sr=Nt,Is=ge.L;Is&&(Sr.I=Is),Sr.B&&(hi(Sr),Ku(Sr)),ge.g=Nt}else $c(ge);0<$.i.length&&Ld($)}else qn[0]!="stop"&&qn[0]!="close"||Xa($,7);else $.G==3&&(qn[0]=="stop"||qn[0]=="close"?qn[0]=="stop"?Xa($,7):_m($):qn[0]!="noop"&&$.l&&$.l.ta(qn),$.v=0)}}yn(4)}catch{}}var Y_=class{constructor(A,B){this.g=A,this.map=B}};function pc(A){this.l=A||10,T.PerformanceNavigationTiming?(A=T.performance.getEntriesByType("navigation"),A=0<A.length&&(A[0].nextHopProtocol=="hq"||A[0].nextHopProtocol=="h2")):A=!!(T.chrome&&T.chrome.loadTimes&&T.chrome.loadTimes()&&T.chrome.loadTimes().wasFetchedViaSpdy),this.j=A?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function yp(A){return A.h?!0:A.g?A.g.size>=A.j:!1}function Qu(A){return A.h?1:A.g?A.g.size:0}function dm(A,B){return A.h?A.h==B:A.g?A.g.has(B):!1}function vp(A,B){A.g?A.g.add(B):A.h=B}function Ia(A,B){A.h&&A.h==B?A.h=null:A.g&&A.g.has(B)&&A.g.delete(B)}pc.prototype.cancel=function(){if(this.i=Yc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const A of this.g.values())A.cancel();this.g.clear()}};function Yc(A){if(A.h!=null)return A.i.concat(A.h.D);if(A.g!=null&&A.g.size!==0){let B=A.i;for(const $ of A.g.values())B=B.concat($.D);return B}return J(A.i)}function um(A){if(A.V&&typeof A.V=="function")return A.V();if(typeof Map<"u"&&A instanceof Map||typeof Set<"u"&&A instanceof Set)return Array.from(A.values());if(typeof A=="string")return A.split("");if(w(A)){for(var B=[],$=A.length,ge=0;ge<$;ge++)B.push(A[ge]);return B}B=[],$=0;for(ge in A)B[$++]=A[ge];return B}function Sp(A){if(A.na&&typeof A.na=="function")return A.na();if(!A.V||typeof A.V!="function"){if(typeof Map<"u"&&A instanceof Map)return Array.from(A.keys());if(!(typeof Set<"u"&&A instanceof Set)){if(w(A)||typeof A=="string"){var B=[];A=A.length;for(var $=0;$<A;$++)B.push($);return B}B=[],$=0;for(const ge in A)B[$++]=ge;return B}}}function jr(A,B){if(A.forEach&&typeof A.forEach=="function")A.forEach(B,void 0);else if(w(A)||typeof A=="string")Array.prototype.forEach.call(A,B,void 0);else for(var $=Sp(A),ge=um(A),Ve=ge.length,Je=0;Je<Ve;Je++)B.call(void 0,ge[Je],$&&$[Je],A)}var $u=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function q_(A,B){if(A){A=A.split("&");for(var $=0;$<A.length;$++){var ge=A[$].indexOf("="),Ve=null;if(0<=ge){var Je=A[$].substring(0,ge);Ve=A[$].substring(ge+1)}else Je=A[$];B(Je,Ve?decodeURIComponent(Ve.replace(/\+/g," ")):"")}}}function is(A){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,A instanceof is){this.h=A.h,Ju(this,A.j),this.o=A.o,this.g=A.g,Od(this,A.s),this.l=A.l;var B=A.i,$=new Ul;$.i=B.i,B.g&&($.g=new Map(B.g),$.h=B.h),jl(this,$),this.m=A.m}else A&&(B=String(A).match($u))?(this.h=!1,Ju(this,B[1]||"",!0),this.o=qa(B[2]||""),this.g=qa(B[3]||"",!0),Od(this,B[4]),this.l=qa(B[5]||"",!0),jl(this,B[6]||"",!0),this.m=qa(B[7]||"")):(this.h=!1,this.i=new Ul(null,this.h))}is.prototype.toString=function(){var A=[],B=this.j;B&&A.push(Dd(B,hm,!0),":");var $=this.g;return($||B=="file")&&(A.push("//"),(B=this.o)&&A.push(Dd(B,hm,!0),"@"),A.push(encodeURIComponent(String($)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),$=this.s,$!=null&&A.push(":",String($))),($=this.l)&&(this.g&&$.charAt(0)!="/"&&A.push("/"),A.push(Dd($,$.charAt(0)=="/"?hS:eh,!0))),($=this.i.toString())&&A.push("?",$),($=this.m)&&A.push("#",Dd($,bp)),A.join("")};function yo(A){return new is(A)}function Ju(A,B,$){A.j=$?qa(B,!0):B,A.j&&(A.j=A.j.replace(/:$/,""))}function Od(A,B){if(B){if(B=Number(B),isNaN(B)||0>B)throw Error("Bad port number "+B);A.s=B}else A.s=null}function jl(A,B,$){B instanceof Ul?(A.i=B,X_(A.i,A.h)):($||(B=Dd(B,K_)),A.i=new Ul(B,A.h))}function ii(A,B,$){A.i.set(B,$)}function Zu(A){return ii(A,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),A}function qa(A,B){return A?B?decodeURI(A.replace(/%25/g,"%2525")):decodeURIComponent(A):""}function Dd(A,B,$){return typeof A=="string"?(A=encodeURI(A).replace(B,Tp),$&&(A=A.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A):null}function Tp(A){return A=A.charCodeAt(0),"%"+(A>>4&15).toString(16)+(A&15).toString(16)}var hm=/[#\/\?@]/g,eh=/[#\?:]/g,hS=/[#\?]/g,K_=/[#\?@]/g,bp=/#/g;function Ul(A,B){this.h=this.g=null,this.i=A||null,this.j=!!B}function Fo(A){A.g||(A.g=new Map,A.h=0,A.i&&q_(A.i,function(B,$){A.add(decodeURIComponent(B.replace(/\+/g," ")),$)}))}s=Ul.prototype,s.add=function(A,B){Fo(this),this.i=null,A=qc(this,A);var $=this.g.get(A);return $||this.g.set(A,$=[]),$.push(B),this.h+=1,this};function Vl(A,B){Fo(A),B=qc(A,B),A.g.has(B)&&(A.i=null,A.h-=A.g.get(B).length,A.g.delete(B))}function Fl(A,B){return Fo(A),B=qc(A,B),A.g.has(B)}s.forEach=function(A,B){Fo(this),this.g.forEach(function($,ge){$.forEach(function(Ve){A.call(B,Ve,ge,this)},this)},this)},s.na=function(){Fo(this);const A=Array.from(this.g.values()),B=Array.from(this.g.keys()),$=[];for(let ge=0;ge<B.length;ge++){const Ve=A[ge];for(let Je=0;Je<Ve.length;Je++)$.push(B[ge])}return $},s.V=function(A){Fo(this);let B=[];if(typeof A=="string")Fl(this,A)&&(B=B.concat(this.g.get(qc(this,A))));else{A=Array.from(this.g.values());for(let $=0;$<A.length;$++)B=B.concat(A[$])}return B},s.set=function(A,B){return Fo(this),this.i=null,A=qc(this,A),Fl(this,A)&&(this.h-=this.g.get(A).length),this.g.set(A,[B]),this.h+=1,this},s.get=function(A,B){return A?(A=this.V(A),0<A.length?String(A[0]):B):B};function pm(A,B,$){Vl(A,B),0<$.length&&(A.i=null,A.g.set(qc(A,B),J($)),A.h+=$.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const A=[],B=Array.from(this.g.keys());for(var $=0;$<B.length;$++){var ge=B[$];const Je=encodeURIComponent(String(ge)),Nt=this.V(ge);for(ge=0;ge<Nt.length;ge++){var Ve=Je;Nt[ge]!==""&&(Ve+="="+encodeURIComponent(String(Nt[ge]))),A.push(Ve)}}return this.i=A.join("&")};function qc(A,B){return B=String(B),A.j&&(B=B.toLowerCase()),B}function X_(A,B){B&&!A.j&&(Fo(A),A.i=null,A.g.forEach(function($,ge){var Ve=ge.toLowerCase();ge!=Ve&&(Vl(this,ge),pm(this,Ve,$))},A)),A.j=B}function xd(A,B){const $=new qr;if(T.Image){const ge=new Image;ge.onload=G(Bo,$,"TestLoadImage: loaded",!0,B,ge),ge.onerror=G(Bo,$,"TestLoadImage: error",!1,B,ge),ge.onabort=G(Bo,$,"TestLoadImage: abort",!1,B,ge),ge.ontimeout=G(Bo,$,"TestLoadImage: timeout",!1,B,ge),T.setTimeout(function(){ge.ontimeout&&ge.ontimeout()},1e4),ge.src=A}else B(!1)}function fc(A,B){const $=new qr,ge=new AbortController,Ve=setTimeout(()=>{ge.abort(),Bo($,"TestPingServer: timeout",!1,B)},1e4);fetch(A,{signal:ge.signal}).then(Je=>{clearTimeout(Ve),Je.ok?Bo($,"TestPingServer: ok",!0,B):Bo($,"TestPingServer: server error",!1,B)}).catch(()=>{clearTimeout(Ve),Bo($,"TestPingServer: error",!1,B)})}function Bo(A,B,$,ge,Ve){try{Ve&&(Ve.onload=null,Ve.onerror=null,Ve.onabort=null,Ve.ontimeout=null),ge($)}catch{}}function th(){this.g=new Ra}function Ka(A,B,$){const ge=$||"";try{jr(A,function(Ve,Je){let Nt=Ve;C(Ve)&&(Nt=ts(Ve)),B.push(ge+Je+"="+encodeURIComponent(Nt))})}catch(Ve){throw B.push(ge+"type="+encodeURIComponent("_badmap")),Ve}}function Pd(A){this.l=A.Ub||null,this.j=A.eb||!1}z(Pd,Cs),Pd.prototype.g=function(){return new Bl(this.l,this.j)},Pd.prototype.i=function(A){return function(){return A}}({});function Bl(A,B){vt.call(this),this.D=A,this.o=B,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}z(Bl,vt),s=Bl.prototype,s.open=function(A,B){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=A,this.A=B,this.readyState=1,mc(this)},s.send=function(A){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const B={headers:this.u,method:this.B,credentials:this.m,cache:void 0};A&&(B.body=A),(this.D||T).fetch(new Request(this.A,B)).then(this.Sa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Kc(this)),this.readyState=0},s.Sa=function(A){if(this.g&&(this.l=A,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=A.headers,this.readyState=2,mc(this)),this.g&&(this.readyState=3,mc(this),this.g)))if(this.responseType==="arraybuffer")A.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof T.ReadableStream<"u"&&"body"in A){if(this.j=A.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;fm(this)}else A.text().then(this.Ra.bind(this),this.ga.bind(this))};function fm(A){A.j.read().then(A.Pa.bind(A)).catch(A.ga.bind(A))}s.Pa=function(A){if(this.g){if(this.o&&A.value)this.response.push(A.value);else if(!this.o){var B=A.value?A.value:new Uint8Array(0);(B=this.v.decode(B,{stream:!A.done}))&&(this.response=this.responseText+=B)}A.done?Kc(this):mc(this),this.readyState==3&&fm(this)}},s.Ra=function(A){this.g&&(this.response=this.responseText=A,Kc(this))},s.Qa=function(A){this.g&&(this.response=A,Kc(this))},s.ga=function(){this.g&&Kc(this)};function Kc(A){A.readyState=4,A.l=null,A.j=null,A.v=null,mc(A)}s.setRequestHeader=function(A,B){this.u.append(A,B)},s.getResponseHeader=function(A){return this.h&&this.h.get(A.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const A=[],B=this.h.entries();for(var $=B.next();!$.done;)$=$.value,A.push($[0]+": "+$[1]),$=B.next();return A.join(`\r
`)};function mc(A){A.onreadystatechange&&A.onreadystatechange.call(A)}Object.defineProperty(Bl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(A){this.m=A?"include":"same-origin"}});function mm(A){let B="";return be(A,function($,ge){B+=ge,B+=":",B+=$,B+=`\r
`}),B}function Gs(A,B,$){e:{for(ge in $){var ge=!1;break e}ge=!0}ge||($=mm($),typeof A=="string"?$!=null&&encodeURIComponent(String($)):ii(A,B,$))}function Kr(A){vt.call(this),this.headers=new Map,this.o=A||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}z(Kr,vt);var vo=/^https?$/i,Ws=["POST","PUT"];s=Kr.prototype,s.Ha=function(A){this.J=A},s.ea=function(A,B,$,ge){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+A);B=B?B.toUpperCase():"GET",this.D=A,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():go.g(),this.v=this.o?Ca(this.o):Ca(go),this.g.onreadystatechange=U(this.Ea,this);try{this.B=!0,this.g.open(B,String(A),!0),this.B=!1}catch(Je){gm(this,Je);return}if(A=$||"",$=new Map(this.headers),ge)if(Object.getPrototypeOf(ge)===Object.prototype)for(var Ve in ge)$.set(Ve,ge[Ve]);else if(typeof ge.keys=="function"&&typeof ge.get=="function")for(const Je of ge.keys())$.set(Je,ge.get(Je));else throw Error("Unknown input type for opt_headers: "+String(ge));ge=Array.from($.keys()).find(Je=>Je.toLowerCase()=="content-type"),Ve=T.FormData&&A instanceof T.FormData,!(0<=Array.prototype.indexOf.call(Ws,B,void 0))||ge||Ve||$.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Je,Nt]of $)this.g.setRequestHeader(Je,Nt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ss(this),this.u=!0,this.g.send(A),this.u=!1}catch(Je){gm(this,Je)}};function gm(A,B){A.h=!1,A.g&&(A.j=!0,A.g.abort(),A.j=!1),A.l=B,A.m=5,wp(A),Xc(A)}function wp(A){A.A||(A.A=!0,Bt(A,"complete"),Bt(A,"error"))}s.abort=function(A){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=A||7,Bt(this,"complete"),Bt(this,"abort"),Xc(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Xc(this,!0)),Kr.aa.N.call(this)},s.Ea=function(){this.s||(this.B||this.u||this.j?Rp(this):this.bb())},s.bb=function(){Rp(this)};function Rp(A){if(A.h&&typeof _<"u"&&(!A.v[1]||Ho(A)!=4||A.Z()!=2)){if(A.u&&Ho(A)==4)rn(A.Ea,0,A);else if(Bt(A,"readystatechange"),Ho(A)==4){A.h=!1;try{const Nt=A.Z();e:switch(Nt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var B=!0;break e;default:B=!1}var $;if(!($=B)){var ge;if(ge=Nt===0){var Ve=String(A.D).match($u)[1]||null;!Ve&&T.self&&T.self.location&&(Ve=T.self.location.protocol.slice(0,-1)),ge=!vo.test(Ve?Ve.toLowerCase():"")}$=ge}if($)Bt(A,"complete"),Bt(A,"success");else{A.m=6;try{var Je=2<Ho(A)?A.g.statusText:""}catch{Je=""}A.l=Je+" ["+A.Z()+"]",wp(A)}}finally{Xc(A)}}}}function Xc(A,B){if(A.g){ss(A);const $=A.g,ge=A.v[0]?()=>{}:null;A.g=null,A.v=null,B||Bt(A,"ready");try{$.onreadystatechange=ge}catch{}}}function ss(A){A.I&&(T.clearTimeout(A.I),A.I=null)}s.isActive=function(){return!!this.g};function Ho(A){return A.g?A.g.readyState:0}s.Z=function(){try{return 2<Ho(this)?this.g.status:-1}catch{return-1}},s.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.Oa=function(A){if(this.g){var B=this.g.responseText;return A&&B.indexOf(A)==0&&(B=B.substring(A.length)),ns(B)}};function Q_(A){try{if(!A.g)return null;if("response"in A.g)return A.g.response;switch(A.H){case"":case"text":return A.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in A.g)return A.g.mozResponseArrayBuffer}return null}catch{return null}}function pS(A){const B={};A=(A.g&&2<=Ho(A)&&A.g.getAllResponseHeaders()||"").split(`\r
`);for(let ge=0;ge<A.length;ge++){if(oe(A[ge]))continue;var $=re(A[ge]);const Ve=$[0];if($=$[1],typeof $!="string")continue;$=$.trim();const Je=B[Ve]||[];B[Ve]=Je,Je.push($)}ee(B,function(ge){return ge.join(", ")})}s.Ba=function(){return this.m},s.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Qc(A,B,$){return $&&$.internalChannelParams&&$.internalChannelParams[A]||B}function nh(A){this.Aa=0,this.i=[],this.j=new qr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qc("failFast",!1,A),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qc("baseRetryDelayMs",5e3,A),this.cb=Qc("retryDelaySeedMs",1e4,A),this.Wa=Qc("forwardChannelMaxRetries",2,A),this.wa=Qc("forwardChannelRequestTimeoutMs",2e4,A),this.pa=A&&A.xmlHttpFactory||void 0,this.Xa=A&&A.Tb||void 0,this.Ca=A&&A.useFetchStreams||!1,this.L=void 0,this.J=A&&A.supportsCrossDomainXhr||!1,this.K="",this.h=new pc(A&&A.concurrentRequestLimit),this.Da=new th,this.P=A&&A.fastHandshake||!1,this.O=A&&A.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=A&&A.Rb||!1,A&&A.xa&&this.j.xa(),A&&A.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&A&&A.detectBufferingProxy||!1,this.ja=void 0,A&&A.longPollingTimeout&&0<A.longPollingTimeout&&(this.ja=A.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}s=nh.prototype,s.la=8,s.G=1,s.connect=function(A,B,$,ge){ln(0),this.W=A,this.H=B||{},$&&ge!==void 0&&(this.H.OSID=$,this.H.OAID=ge),this.F=this.X,this.I=Gl(this,null,this.W),Ld(this)};function _m(A){if($_(A),A.G==3){var B=A.U++,$=yo(A.I);if(ii($,"SID",A.K),ii($,"RID",B),ii($,"TYPE","terminate"),ih(A,$),B=new As(A,A.j,B),B.L=2,B.v=Zu(yo($)),$=!1,T.navigator&&T.navigator.sendBeacon)try{$=T.navigator.sendBeacon(B.v.toString(),"")}catch{}!$&&T.Image&&(new Image().src=B.v,$=!0),$||(B.g=vm(B.j,null),B.g.ea(B.v)),B.F=Date.now(),Ku(B)}tE(A)}function kd(A){A.g&&(sh(A),A.g.cancel(),A.g=null)}function $_(A){kd(A),A.u&&(T.clearTimeout(A.u),A.u=null),Cp(A),A.h.cancel(),A.s&&(typeof A.s=="number"&&T.clearTimeout(A.s),A.s=null)}function Ld(A){if(!yp(A.h)&&!A.s){A.s=!0;var B=A.Ga;Ne||de(),Ce||(Ne(),Ce=!0),Ue.add(B,A),A.B=0}}function Em(A,B){return Qu(A.h)>=A.h.j-(A.s?1:0)?!1:A.s?(A.i=B.D.concat(A.i),!0):A.G==1||A.G==2||A.B>=(A.Va?0:A.Wa)?!1:(A.s=pr(U(A.Ga,A,B),ym(A,A.B)),A.B++,!0)}s.Ga=function(A){if(this.s)if(this.s=null,this.G==1){if(!A){this.U=Math.floor(1e5*Math.random()),A=this.U++;const Ve=new As(this,this.j,A);let Je=this.o;if(this.S&&(Je?(Je=Q(Je),ae(Je,this.S)):Je=this.S),this.m!==null||this.O||(Ve.H=Je,Je=null),this.P)e:{for(var B=0,$=0;$<this.i.length;$++){t:{var ge=this.i[$];if("__data__"in ge.map&&(ge=ge.map.__data__,typeof ge=="string")){ge=ge.length;break t}ge=void 0}if(ge===void 0)break;if(B+=ge,4096<B){B=$;break e}if(B===4096||$===this.i.length-1){B=$+1;break e}}B=1e3}else B=1e3;B=J_(this,Ve,B),$=yo(this.I),ii($,"RID",A),ii($,"CVER",22),this.D&&ii($,"X-HTTP-Session-Id",this.D),ih(this,$),Je&&(this.O?B="headers="+encodeURIComponent(String(mm(Je)))+"&"+B:this.m&&Gs($,this.m,Je)),vp(this.h,Ve),this.Ua&&ii($,"TYPE","init"),this.P?(ii($,"$req",B),ii($,"SID","null"),Ve.T=!0,fa(Ve,$,null)):fa(Ve,$,B),this.G=2}}else this.G==3&&(A?rh(this,A):this.i.length==0||yp(this.h)||rh(this))};function rh(A,B){var $;B?$=B.l:$=A.U++;const ge=yo(A.I);ii(ge,"SID",A.K),ii(ge,"RID",$),ii(ge,"AID",A.T),ih(A,ge),A.m&&A.o&&Gs(ge,A.m,A.o),$=new As(A,A.j,$,A.B+1),A.m===null&&($.H=A.o),B&&(A.i=B.D.concat(A.i)),B=J_(A,$,1e3),$.I=Math.round(.5*A.wa)+Math.round(.5*A.wa*Math.random()),vp(A.h,$),fa($,ge,B)}function ih(A,B){A.H&&be(A.H,function($,ge){ii(B,ge,$)}),A.l&&jr({},function($,ge){ii(B,ge,$)})}function J_(A,B,$){$=Math.min(A.i.length,$);var ge=A.l?U(A.l.Na,A.l,A):null;e:{var Ve=A.i;let Je=-1;for(;;){const Nt=["count="+$];Je==-1?0<$?(Je=Ve[0].g,Nt.push("ofs="+Je)):Je=0:Nt.push("ofs="+Je);let Sr=!0;for(let Is=0;Is<$;Is++){let qn=Ve[Is].g;const zs=Ve[Is].map;if(qn-=Je,0>qn)Je=Math.max(0,Ve[Is].g-100),Sr=!1;else try{Ka(zs,Nt,"req"+qn+"_")}catch{ge&&ge(zs)}}if(Sr){ge=Nt.join("&");break e}}}return A=A.i.splice(0,$),B.D=A,ge}function $c(A){if(!A.g&&!A.u){A.Y=1;var B=A.Fa;Ne||de(),Ce||(Ne(),Ce=!0),Ue.add(B,A),A.v=0}}function Hl(A){return A.g||A.u||3<=A.v?!1:(A.Y++,A.u=pr(U(A.Fa,A),ym(A,A.v)),A.v++,!0)}s.Fa=function(){if(this.u=null,Z_(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var A=2*this.R;this.j.info("BP detection timer enabled: "+A),this.A=pr(U(this.ab,this),A)}},s.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ln(10),kd(this),Z_(this))};function sh(A){A.A!=null&&(T.clearTimeout(A.A),A.A=null)}function Z_(A){A.g=new As(A,A.j,"rpc",A.Y),A.m===null&&(A.g.H=A.o),A.g.O=0;var B=yo(A.qa);ii(B,"RID","rpc"),ii(B,"SID",A.K),ii(B,"AID",A.T),ii(B,"CI",A.F?"0":"1"),!A.F&&A.ja&&ii(B,"TO",A.ja),ii(B,"TYPE","xmlhttp"),ih(A,B),A.m&&A.o&&Gs(B,A.m,A.o),A.L&&(A.g.I=A.L);var $=A.g;A=A.ia,$.L=1,$.v=Zu(yo(B)),$.m=null,$.P=!0,Ml($,A)}s.Za=function(){this.C!=null&&(this.C=null,kd(this),Hl(this),ln(19))};function Cp(A){A.C!=null&&(T.clearTimeout(A.C),A.C=null)}function eE(A,B){var $=null;if(A.g==B){Cp(A),sh(A),A.g=null;var ge=2}else if(dm(A.h,B))$=B.D,Ia(A.h,B),ge=1;else return;if(A.G!=0){if(B.o)if(ge==1){$=B.m?B.m.length:0,B=Date.now()-B.F;var Ve=A.B;ge=un(),Bt(ge,new or(ge,$)),Ld(A)}else $c(A);else if(Ve=B.s,Ve==3||Ve==0&&0<B.X||!(ge==1&&Em(A,B)||ge==2&&Hl(A)))switch($&&0<$.length&&(B=A.h,B.i=B.i.concat($)),Ve){case 1:Xa(A,5);break;case 4:Xa(A,10);break;case 3:Xa(A,6);break;default:Xa(A,2)}}}function ym(A,B){let $=A.Ta+Math.floor(Math.random()*A.cb);return A.isActive()||($*=2),$*B}function Xa(A,B){if(A.j.info("Error code "+B),B==2){var $=U(A.fb,A),ge=A.Xa;const Ve=!ge;ge=new is(ge||"//www.google.com/images/cleardot.gif"),T.location&&T.location.protocol=="http"||Ju(ge,"https"),Zu(ge),Ve?xd(ge.toString(),$):fc(ge.toString(),$)}else ln(2);A.G=0,A.l&&A.l.sa(B),tE(A),$_(A)}s.fb=function(A){A?(this.j.info("Successfully pinged google.com"),ln(2)):(this.j.info("Failed to ping google.com"),ln(1))};function tE(A){if(A.G=0,A.ka=[],A.l){const B=Yc(A.h);(B.length!=0||A.i.length!=0)&&(X(A.ka,B),X(A.ka,A.i),A.h.i.length=0,J(A.i),A.i.length=0),A.l.ra()}}function Gl(A,B,$){var ge=$ instanceof is?yo($):new is($);if(ge.g!="")B&&(ge.g=B+"."+ge.g),Od(ge,ge.s);else{var Ve=T.location;ge=Ve.protocol,B=B?B+"."+Ve.hostname:Ve.hostname,Ve=+Ve.port;var Je=new is(null);ge&&Ju(Je,ge),B&&(Je.g=B),Ve&&Od(Je,Ve),$&&(Je.l=$),ge=Je}return $=A.D,B=A.ya,$&&B&&ii(ge,$,B),ii(ge,"VER",A.la),ih(A,ge),ge}function vm(A,B,$){if(B&&!A.J)throw Error("Can't create secondary domain capable XhrIo object.");return B=A.Ca&&!A.pa?new Kr(new Pd({eb:$})):new Kr(A.pa),B.Ha(A.J),B}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function nE(){}s=nE.prototype,s.ua=function(){},s.ta=function(){},s.sa=function(){},s.ra=function(){},s.isActive=function(){return!0},s.Na=function(){};function Pn(){}Pn.prototype.g=function(A,B){return new Na(A,B)};function Na(A,B){vt.call(this),this.g=new nh(B),this.l=A,this.h=B&&B.messageUrlParams||null,A=B&&B.messageHeaders||null,B&&B.clientProtocolHeaderRequired&&(A?A["X-Client-Protocol"]="webchannel":A={"X-Client-Protocol":"webchannel"}),this.g.o=A,A=B&&B.initMessageHeaders||null,B&&B.messageContentType&&(A?A["X-WebChannel-Content-Type"]=B.messageContentType:A={"X-WebChannel-Content-Type":B.messageContentType}),B&&B.va&&(A?A["X-WebChannel-Client-Profile"]=B.va:A={"X-WebChannel-Client-Profile":B.va}),this.g.S=A,(A=B&&B.Sb)&&!oe(A)&&(this.g.m=A),this.v=B&&B.supportsCrossDomainXhr||!1,this.u=B&&B.sendRawJson||!1,(B=B&&B.httpSessionIdParam)&&!oe(B)&&(this.g.D=B,A=this.h,A!==null&&B in A&&(A=this.h,B in A&&delete A[B])),this.j=new Jc(this)}z(Na,vt),Na.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Na.prototype.close=function(){_m(this.g)},Na.prototype.o=function(A){var B=this.g;if(typeof A=="string"){var $={};$.__data__=A,A=$}else this.u&&($={},$.__data__=ts(A),A=$);B.i.push(new Y_(B.Ya++,A)),B.G==3&&Ld(B)},Na.prototype.N=function(){this.g.l=null,delete this.j,_m(this.g),delete this.g,Na.aa.N.call(this)};function rE(A){cn.call(this),A.__headers__&&(this.headers=A.__headers__,this.statusCode=A.__status__,delete A.__headers__,delete A.__status__);var B=A.__sm__;if(B){e:{for(const $ in B){A=$;break e}A=void 0}(this.i=A)&&(A=this.i,B=B!==null&&A in B?B[A]:void 0),this.data=B}else this.data=A}z(rE,cn);function iE(){Yn.call(this),this.status=1}z(iE,Yn);function Jc(A){this.g=A}z(Jc,nE),Jc.prototype.ua=function(){Bt(this.g,"a")},Jc.prototype.ta=function(A){Bt(this.g,new rE(A))},Jc.prototype.sa=function(A){Bt(this.g,new iE)},Jc.prototype.ra=function(){Bt(this.g,"b")},Pn.prototype.createWebChannel=Pn.prototype.g,Na.prototype.send=Na.prototype.o,Na.prototype.open=Na.prototype.m,Na.prototype.close=Na.prototype.close,HK=function(){return new Pn},BK=function(){return un()},FK=Ke,o2={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Aa.NO_ERROR=0,Aa.TIMEOUT=8,Aa.HTTP_ERROR=6,$N=Aa,Vo.COMPLETE="complete",VK=Vo,je.EventType=sn,sn.OPEN="a",sn.CLOSE="b",sn.ERROR="c",sn.MESSAGE="d",vt.prototype.listen=vt.prototype.K,xw=je,Kr.prototype.listenOnce=Kr.prototype.L,Kr.prototype.getLastError=Kr.prototype.Ka,Kr.prototype.getLastErrorCode=Kr.prototype.Ba,Kr.prototype.getStatus=Kr.prototype.Z,Kr.prototype.getResponseJson=Kr.prototype.Oa,Kr.prototype.getResponseText=Kr.prototype.oa,Kr.prototype.send=Kr.prototype.ea,Kr.prototype.setWithCredentials=Kr.prototype.Ha,UK=Kr}).apply(typeof nN<"u"?nN:typeof self<"u"?self:typeof window<"u"?window:{});const U8="@firebase/firestore",V8="4.7.11";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(n){this.uid=n}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(n){return n.uid===this.uid}}lo.UNAUTHENTICATED=new lo(null),lo.GOOGLE_CREDENTIALS=new lo("google-credentials-uid"),lo.FIRST_PARTY=new lo("first-party-uid"),lo.MOCK_USER=new lo("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let aS="11.6.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x_=new AK("@firebase/firestore");function wv(){return x_.logLevel}function Qt(s,...n){if(x_.logLevel<=Mr.DEBUG){const i=n.map(oj);x_.debug(`Firestore (${aS}): ${s}`,...i)}}function fp(s,...n){if(x_.logLevel<=Mr.ERROR){const i=n.map(oj);x_.error(`Firestore (${aS}): ${s}`,...i)}}function Fv(s,...n){if(x_.logLevel<=Mr.WARN){const i=n.map(oj);x_.warn(`Firestore (${aS}): ${s}`,...i)}}function oj(s){if(typeof s=="string")return s;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(s)}catch{return s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ln(s,n,i){let a="Unexpected state";typeof n=="string"?a=n:i=n,GK(s,a,i)}function GK(s,n,i){let a=`FIRESTORE (${aS}) INTERNAL ASSERTION FAILED: ${n} (ID: ${s.toString(16)})`;if(i!==void 0)try{a+=" CONTEXT: "+JSON.stringify(i)}catch{a+=" CONTEXT: "+i}throw fp(a),new Error(a)}function ui(s,n,i,a){let l="Unexpected state";typeof i=="string"?l=i:a=i,s||GK(n,l,a)}function zn(s,n){return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _t={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Jt extends V_{constructor(n,i){super(n,i),this.code=n,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b_{constructor(){this.promise=new Promise((n,i)=>{this.resolve=n,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WK{constructor(n,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${n}`)}}class Wme{getToken(){return Promise.resolve(null)}invalidateToken(){}start(n,i){n.enqueueRetryable(()=>i(lo.UNAUTHENTICATED))}shutdown(){}}class zme{constructor(n){this.token=n,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(n,i){this.changeListener=i,n.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class Yme{constructor(n){this.t=n,this.currentUser=lo.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(n,i){ui(this.o===void 0,42304);let a=this.i;const l=w=>this.i!==a?(a=this.i,i(w)):Promise.resolve();let p=new b_;this.o=()=>{this.i++,this.currentUser=this.u(),p.resolve(),p=new b_,n.enqueueRetryable(()=>l(this.currentUser))};const _=()=>{const w=p;n.enqueueRetryable(async()=>{await w.promise,await l(this.currentUser)})},T=w=>{Qt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=w,this.o&&(this.auth.addAuthTokenListener(this.o),_())};this.t.onInit(w=>T(w)),setTimeout(()=>{if(!this.auth){const w=this.t.getImmediate({optional:!0});w?T(w):(Qt("FirebaseAuthCredentialsProvider","Auth not yet detected"),p.resolve(),p=new b_)}},0),_()}getToken(){const n=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(a=>this.i!==n?(Qt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(ui(typeof a.accessToken=="string",31837,{l:a}),new WK(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const n=this.auth&&this.auth.getUid();return ui(n===null||typeof n=="string",2055,{h:n}),new lo(n)}}class qme{constructor(n,i,a){this.P=n,this.T=i,this.I=a,this.type="FirstParty",this.user=lo.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const n=this.R();return n&&this.A.set("Authorization",n),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Kme{constructor(n,i,a){this.P=n,this.T=i,this.I=a}getToken(){return Promise.resolve(new qme(this.P,this.T,this.I))}start(n,i){n.enqueueRetryable(()=>i(lo.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class F8{constructor(n){this.value=n,this.type="AppCheck",this.headers=new Map,n&&n.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Xme{constructor(n,i){this.V=i,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,DK(n)&&n.settings.appCheckToken&&(this.p=n.settings.appCheckToken)}start(n,i){ui(this.o===void 0,3512);const a=p=>{p.error!=null&&Qt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${p.error.message}`);const _=p.token!==this.m;return this.m=p.token,Qt("FirebaseAppCheckTokenProvider",`Received ${_?"new":"existing"} token.`),_?i(p.token):Promise.resolve()};this.o=p=>{n.enqueueRetryable(()=>a(p))};const l=p=>{Qt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=p,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(p=>l(p)),setTimeout(()=>{if(!this.appCheck){const p=this.V.getImmediate({optional:!0});p?l(p):Qt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new F8(this.p));const n=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(n).then(i=>i?(ui(typeof i.token=="string",44558,{tokenResult:i}),this.m=i.token,new F8(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qme(s){const n=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(s);if(n&&typeof n.getRandomValues=="function")n.getRandomValues(i);else for(let a=0;a<s;a++)i[a]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zK(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YK{static newId(){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=Qme(40);for(let p=0;p<l.length;++p)a.length<20&&l[p]<i&&(a+=n.charAt(l[p]%62))}return a}}function gr(s,n){return s<n?-1:s>n?1:0}function c2(s,n){let i=0;for(;i<s.length&&i<n.length;){const a=s.codePointAt(i),l=n.codePointAt(i);if(a!==l){if(a<128&&l<128)return gr(a,l);{const p=zK(),_=$me(p.encode(B8(s,i)),p.encode(B8(n,i)));return _!==0?_:gr(a,l)}}i+=a>65535?2:1}return gr(s.length,n.length)}function B8(s,n){return s.codePointAt(n)>65535?s.substring(n,n+2):s.substring(n,n+1)}function $me(s,n){for(let i=0;i<s.length&&i<n.length;++i)if(s[i]!==n[i])return gr(s[i],n[i]);return gr(s.length,n.length)}function Bv(s,n,i){return s.length===n.length&&s.every((a,l)=>i(a,n[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H8=-62135596800,G8=1e6;class ha{static now(){return ha.fromMillis(Date.now())}static fromDate(n){return ha.fromMillis(n.getTime())}static fromMillis(n){const i=Math.floor(n/1e3),a=Math.floor((n-1e3*i)*G8);return new ha(i,a)}constructor(n,i){if(this.seconds=n,this.nanoseconds=i,i<0)throw new Jt(_t.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Jt(_t.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(n<H8)throw new Jt(_t.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n);if(n>=253402300800)throw new Jt(_t.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/G8}_compareTo(n){return this.seconds===n.seconds?gr(this.nanoseconds,n.nanoseconds):gr(this.seconds,n.seconds)}isEqual(n){return n.seconds===this.seconds&&n.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const n=this.seconds-H8;return String(n).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{static fromTimestamp(n){return new Gn(n)}static min(){return new Gn(new ha(0,0))}static max(){return new Gn(new ha(253402300799,999999999))}constructor(n){this.timestamp=n}compareTo(n){return this.timestamp._compareTo(n.timestamp)}isEqual(n){return this.timestamp.isEqual(n.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W8="__name__";class xu{constructor(n,i,a){i===void 0?i=0:i>n.length&&Ln(637,{offset:i,range:n.length}),a===void 0?a=n.length-i:a>n.length-i&&Ln(1746,{length:a,range:n.length-i}),this.segments=n,this.offset=i,this.len=a}get length(){return this.len}isEqual(n){return xu.comparator(this,n)===0}child(n){const i=this.segments.slice(this.offset,this.limit());return n instanceof xu?n.forEach(a=>{i.push(a)}):i.push(n),this.construct(i)}limit(){return this.offset+this.length}popFirst(n){return n=n===void 0?1:n,this.construct(this.segments,this.offset+n,this.length-n)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(n){return this.segments[this.offset+n]}isEmpty(){return this.length===0}isPrefixOf(n){if(n.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==n.get(i))return!1;return!0}isImmediateParentOf(n){if(this.length+1!==n.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==n.get(i))return!1;return!0}forEach(n){for(let i=this.offset,a=this.limit();i<a;i++)n(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(n,i){const a=Math.min(n.length,i.length);for(let l=0;l<a;l++){const p=xu.compareSegments(n.get(l),i.get(l));if(p!==0)return p}return gr(n.length,i.length)}static compareSegments(n,i){const a=xu.isNumericId(n),l=xu.isNumericId(i);return a&&!l?-1:!a&&l?1:a&&l?xu.extractNumericId(n).compare(xu.extractNumericId(i)):c2(n,i)}static isNumericId(n){return n.startsWith("__id")&&n.endsWith("__")}static extractNumericId(n){return Kf.fromString(n.substring(4,n.length-2))}}class Gi extends xu{construct(n,i,a){return new Gi(n,i,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...n){const i=[];for(const a of n){if(a.indexOf("//")>=0)throw new Jt(_t.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);i.push(...a.split("/").filter(l=>l.length>0))}return new Gi(i)}static emptyPath(){return new Gi([])}}const Jme=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ga extends xu{construct(n,i,a){return new Ga(n,i,a)}static isValidIdentifier(n){return Jme.test(n)}canonicalString(){return this.toArray().map(n=>(n=n.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ga.isValidIdentifier(n)||(n="`"+n+"`"),n)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===W8}static keyField(){return new Ga([W8])}static fromServerFormat(n){const i=[];let a="",l=0;const p=()=>{if(a.length===0)throw new Jt(_t.INVALID_ARGUMENT,`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(a),a=""};let _=!1;for(;l<n.length;){const T=n[l];if(T==="\\"){if(l+1===n.length)throw new Jt(_t.INVALID_ARGUMENT,"Path has trailing escape character: "+n);const w=n[l+1];if(w!=="\\"&&w!=="."&&w!=="`")throw new Jt(_t.INVALID_ARGUMENT,"Path has invalid escape sequence: "+n);a+=w,l+=2}else T==="`"?(_=!_,l++):T!=="."||_?(a+=T,l++):(p(),l++)}if(p(),_)throw new Jt(_t.INVALID_ARGUMENT,"Unterminated ` in path: "+n);return new Ga(i)}static emptyPath(){return new Ga([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{constructor(n){this.path=n}static fromPath(n){return new Tn(Gi.fromString(n))}static fromName(n){return new Tn(Gi.fromString(n).popFirst(5))}static empty(){return new Tn(Gi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(n){return this.path.length>=2&&this.path.get(this.path.length-2)===n}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(n){return n!==null&&Gi.comparator(this.path,n.path)===0}toString(){return this.path.toString()}static comparator(n,i){return Gi.comparator(n.path,i.path)}static isDocumentKey(n){return n.length%2==0}static fromSegments(n){return new Tn(new Gi(n.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o0=-1;function Zme(s,n){const i=s.toTimestamp().seconds,a=s.toTimestamp().nanoseconds+1,l=Gn.fromTimestamp(a===1e9?new ha(i+1,0):new ha(i,a));return new Zf(l,Tn.empty(),n)}function ege(s){return new Zf(s.readTime,s.key,o0)}class Zf{constructor(n,i,a){this.readTime=n,this.documentKey=i,this.largestBatchId=a}static min(){return new Zf(Gn.min(),Tn.empty(),o0)}static max(){return new Zf(Gn.max(),Tn.empty(),o0)}}function tge(s,n){let i=s.readTime.compareTo(n.readTime);return i!==0?i:(i=Tn.comparator(s.documentKey,n.documentKey),i!==0?i:gr(s.largestBatchId,n.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nge="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rge{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(n){this.onCommittedListeners.push(n)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(n=>n())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oS(s){if(s.code!==_t.FAILED_PRECONDITION||s.message!==nge)throw s;Qt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Et{constructor(n){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,n(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(n){return this.next(void 0,n)}next(n,i){return this.callbackAttached&&Ln(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(n,this.result):new Et((a,l)=>{this.nextCallback=p=>{this.wrapSuccess(n,p).next(a,l)},this.catchCallback=p=>{this.wrapFailure(i,p).next(a,l)}})}toPromise(){return new Promise((n,i)=>{this.next(n,i)})}wrapUserFunction(n){try{const i=n();return i instanceof Et?i:Et.resolve(i)}catch(i){return Et.reject(i)}}wrapSuccess(n,i){return n?this.wrapUserFunction(()=>n(i)):Et.resolve(i)}wrapFailure(n,i){return n?this.wrapUserFunction(()=>n(i)):Et.reject(i)}static resolve(n){return new Et((i,a)=>{i(n)})}static reject(n){return new Et((i,a)=>{a(n)})}static waitFor(n){return new Et((i,a)=>{let l=0,p=0,_=!1;n.forEach(T=>{++l,T.next(()=>{++p,_&&p===l&&i()},w=>a(w))}),_=!0,p===l&&i()})}static or(n){let i=Et.resolve(!1);for(const a of n)i=i.next(l=>l?Et.resolve(l):a());return i}static forEach(n,i){const a=[];return n.forEach((l,p)=>{a.push(i.call(this,l,p))}),this.waitFor(a)}static mapArray(n,i){return new Et((a,l)=>{const p=n.length,_=new Array(p);let T=0;for(let w=0;w<p;w++){const C=w;i(n[C]).next(O=>{_[C]=O,++T,T===p&&a(_)},O=>l(O))}})}static doWhile(n,i){return new Et((a,l)=>{const p=()=>{n()===!0?i().next(()=>{p()},l):a()};p()})}}function ige(s){const n=s.match(/Android ([\d.]+)/i),i=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function cS(s){return s.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gD{constructor(n,i){this.previousValue=n,i&&(i.sequenceNumberHandler=a=>this.ue(a),this.ce=a=>i.writeSequenceNumber(a))}ue(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){const n=++this.previousValue;return this.ce&&this.ce(n),n}}gD.le=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cj=-1;function _D(s){return s==null}function CO(s){return s===0&&1/s==-1/0}function sge(s){return typeof s=="number"&&Number.isInteger(s)&&!CO(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qK="";function age(s){let n="";for(let i=0;i<s.length;i++)n.length>0&&(n=z8(n)),n=oge(s.get(i),n);return z8(n)}function oge(s,n){let i=n;const a=s.length;for(let l=0;l<a;l++){const p=s.charAt(l);switch(p){case"\0":i+="";break;case qK:i+="";break;default:i+=p}}return i}function z8(s){return s+qK+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y8(s){let n=0;for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&n++;return n}function cm(s,n){for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&n(i,s[i])}function KK(s){for(const n in s)if(Object.prototype.hasOwnProperty.call(s,n))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{constructor(n,i){this.comparator=n,this.root=i||Ha.EMPTY}insert(n,i){return new ps(this.comparator,this.root.insert(n,i,this.comparator).copy(null,null,Ha.BLACK,null,null))}remove(n){return new ps(this.comparator,this.root.remove(n,this.comparator).copy(null,null,Ha.BLACK,null,null))}get(n){let i=this.root;for(;!i.isEmpty();){const a=this.comparator(n,i.key);if(a===0)return i.value;a<0?i=i.left:a>0&&(i=i.right)}return null}indexOf(n){let i=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(n,a.key);if(l===0)return i+a.left.size;l<0?a=a.left:(i+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(n){return this.root.inorderTraversal(n)}forEach(n){this.inorderTraversal((i,a)=>(n(i,a),!1))}toString(){const n=[];return this.inorderTraversal((i,a)=>(n.push(`${i}:${a}`),!1)),`{${n.join(", ")}}`}reverseTraversal(n){return this.root.reverseTraversal(n)}getIterator(){return new rN(this.root,null,this.comparator,!1)}getIteratorFrom(n){return new rN(this.root,n,this.comparator,!1)}getReverseIterator(){return new rN(this.root,null,this.comparator,!0)}getReverseIteratorFrom(n){return new rN(this.root,n,this.comparator,!0)}}class rN{constructor(n,i,a,l){this.isReverse=l,this.nodeStack=[];let p=1;for(;!n.isEmpty();)if(p=i?a(n.key,i):1,i&&l&&(p*=-1),p<0)n=this.isReverse?n.left:n.right;else{if(p===0){this.nodeStack.push(n);break}this.nodeStack.push(n),n=this.isReverse?n.right:n.left}}getNext(){let n=this.nodeStack.pop();const i={key:n.key,value:n.value};if(this.isReverse)for(n=n.left;!n.isEmpty();)this.nodeStack.push(n),n=n.right;else for(n=n.right;!n.isEmpty();)this.nodeStack.push(n),n=n.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const n=this.nodeStack[this.nodeStack.length-1];return{key:n.key,value:n.value}}}class Ha{constructor(n,i,a,l,p){this.key=n,this.value=i,this.color=a??Ha.RED,this.left=l??Ha.EMPTY,this.right=p??Ha.EMPTY,this.size=this.left.size+1+this.right.size}copy(n,i,a,l,p){return new Ha(n??this.key,i??this.value,a??this.color,l??this.left,p??this.right)}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,i,a){let l=this;const p=a(n,l.key);return l=p<0?l.copy(null,null,null,l.left.insert(n,i,a),null):p===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(n,i,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Ha.EMPTY;let n=this;return n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.removeMin(),null),n.fixUp()}remove(n,i){let a,l=this;if(i(n,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(n,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(n,l.key)===0){if(l.right.isEmpty())return Ha.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(n,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let n=this;return n.right.isRed()&&!n.left.isRed()&&(n=n.rotateLeft()),n.left.isRed()&&n.left.left.isRed()&&(n=n.rotateRight()),n.left.isRed()&&n.right.isRed()&&(n=n.colorFlip()),n}moveRedLeft(){let n=this.colorFlip();return n.right.left.isRed()&&(n=n.copy(null,null,null,null,n.right.rotateRight()),n=n.rotateLeft(),n=n.colorFlip()),n}moveRedRight(){let n=this.colorFlip();return n.left.left.isRed()&&(n=n.rotateRight(),n=n.colorFlip()),n}rotateLeft(){const n=this.copy(null,null,Ha.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight(){const n=this.copy(null,null,Ha.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip(){const n=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,i)}checkMaxDepth(){const n=this.check();return Math.pow(2,n)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ln(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ln(14113,{key:this.key,value:this.value});const n=this.left.check();if(n!==this.right.check())throw Ln(27949);return n+(this.isRed()?0:1)}}Ha.EMPTY=null,Ha.RED=!0,Ha.BLACK=!1;Ha.EMPTY=new class{constructor(){this.size=0}get key(){throw Ln(57766)}get value(){throw Ln(16141)}get color(){throw Ln(16727)}get left(){throw Ln(29726)}get right(){throw Ln(36894)}copy(n,i,a,l,p){return this}insert(n,i,a){return new Ha(n,i)}remove(n,i){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa{constructor(n){this.comparator=n,this.data=new ps(this.comparator)}has(n){return this.data.get(n)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(n){return this.data.indexOf(n)}forEach(n){this.data.inorderTraversal((i,a)=>(n(i),!1))}forEachInRange(n,i){const a=this.data.getIteratorFrom(n[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,n[1])>=0)return;i(l.key)}}forEachWhile(n,i){let a;for(a=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();a.hasNext();)if(!n(a.getNext().key))return}firstAfterOrEqual(n){const i=this.data.getIteratorFrom(n);return i.hasNext()?i.getNext().key:null}getIterator(){return new q8(this.data.getIterator())}getIteratorFrom(n){return new q8(this.data.getIteratorFrom(n))}add(n){return this.copy(this.data.remove(n).insert(n,!0))}delete(n){return this.has(n)?this.copy(this.data.remove(n)):this}isEmpty(){return this.data.isEmpty()}unionWith(n){let i=this;return i.size<n.size&&(i=n,n=this),n.forEach(a=>{i=i.add(a)}),i}isEqual(n){if(!(n instanceof pa)||this.size!==n.size)return!1;const i=this.data.getIterator(),a=n.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,p=a.getNext().key;if(this.comparator(l,p)!==0)return!1}return!0}toArray(){const n=[];return this.forEach(i=>{n.push(i)}),n}toString(){const n=[];return this.forEach(i=>n.push(i)),"SortedSet("+n.toString()+")"}copy(n){const i=new pa(this.comparator);return i.data=n,i}}class q8{constructor(n){this.iter=n}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{constructor(n){this.fields=n,n.sort(Ga.comparator)}static empty(){return new Uc([])}unionWith(n){let i=new pa(Ga.comparator);for(const a of this.fields)i=i.add(a);for(const a of n)i=i.add(a);return new Uc(i.toArray())}covers(n){for(const i of this.fields)if(i.isPrefixOf(n))return!0;return!1}isEqual(n){return Bv(this.fields,n.fields,(i,a)=>i.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XK extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa{constructor(n){this.binaryString=n}static fromBase64String(n){const i=function(l){try{return atob(l)}catch(p){throw typeof DOMException<"u"&&p instanceof DOMException?new XK("Invalid base64 string: "+p):p}}(n);return new Wa(i)}static fromUint8Array(n){const i=function(l){let p="";for(let _=0;_<l.length;++_)p+=String.fromCharCode(l[_]);return p}(n);return new Wa(i)}[Symbol.iterator](){let n=0;return{next:()=>n<this.binaryString.length?{value:this.binaryString.charCodeAt(n++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(n){return gr(this.binaryString,n.binaryString)}isEqual(n){return this.binaryString===n.binaryString}}Wa.EMPTY_BYTE_STRING=new Wa("");const cge=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function em(s){if(ui(!!s,39018),typeof s=="string"){let n=0;const i=cge.exec(s);if(ui(!!i,46558,{timestamp:s}),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),n=Number(l)}const a=new Date(s);return{seconds:Math.floor(a.getTime()/1e3),nanos:n}}return{seconds:Vs(s.seconds),nanos:Vs(s.nanos)}}function Vs(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function tm(s){return typeof s=="string"?Wa.fromBase64String(s):Wa.fromUint8Array(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QK="server_timestamp",$K="__type__",JK="__previous_value__",ZK="__local_write_time__";function lj(s){var n,i;return((i=(((n=s==null?void 0:s.mapValue)===null||n===void 0?void 0:n.fields)||{})[$K])===null||i===void 0?void 0:i.stringValue)===QK}function ED(s){const n=s.mapValue.fields[JK];return lj(n)?ED(n):n}function c0(s){const n=em(s.mapValue.fields[ZK].timestampValue);return new ha(n.seconds,n.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lge{constructor(n,i,a,l,p,_,T,w,C){this.databaseId=n,this.appId=i,this.persistenceKey=a,this.host=l,this.ssl=p,this.forceLongPolling=_,this.autoDetectLongPolling=T,this.longPollingOptions=w,this.useFetchStreams=C}}const AO="(default)";class l0{constructor(n,i){this.projectId=n,this.database=i||AO}static empty(){return new l0("","")}get isDefaultDatabase(){return this.database===AO}isEqual(n){return n instanceof l0&&n.projectId===this.projectId&&n.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e7="__type__",dge="__max__",iN={mapValue:{}},t7="__vector__",IO="value";function nm(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?lj(s)?4:hge(s)?9007199254740991:uge(s)?10:11:Ln(28295,{value:s})}function Gu(s,n){if(s===n)return!0;const i=nm(s);if(i!==nm(n))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===n.booleanValue;case 4:return c0(s).isEqual(c0(n));case 3:return function(l,p){if(typeof l.timestampValue=="string"&&typeof p.timestampValue=="string"&&l.timestampValue.length===p.timestampValue.length)return l.timestampValue===p.timestampValue;const _=em(l.timestampValue),T=em(p.timestampValue);return _.seconds===T.seconds&&_.nanos===T.nanos}(s,n);case 5:return s.stringValue===n.stringValue;case 6:return function(l,p){return tm(l.bytesValue).isEqual(tm(p.bytesValue))}(s,n);case 7:return s.referenceValue===n.referenceValue;case 8:return function(l,p){return Vs(l.geoPointValue.latitude)===Vs(p.geoPointValue.latitude)&&Vs(l.geoPointValue.longitude)===Vs(p.geoPointValue.longitude)}(s,n);case 2:return function(l,p){if("integerValue"in l&&"integerValue"in p)return Vs(l.integerValue)===Vs(p.integerValue);if("doubleValue"in l&&"doubleValue"in p){const _=Vs(l.doubleValue),T=Vs(p.doubleValue);return _===T?CO(_)===CO(T):isNaN(_)&&isNaN(T)}return!1}(s,n);case 9:return Bv(s.arrayValue.values||[],n.arrayValue.values||[],Gu);case 10:case 11:return function(l,p){const _=l.mapValue.fields||{},T=p.mapValue.fields||{};if(Y8(_)!==Y8(T))return!1;for(const w in _)if(_.hasOwnProperty(w)&&(T[w]===void 0||!Gu(_[w],T[w])))return!1;return!0}(s,n);default:return Ln(52216,{left:s})}}function d0(s,n){return(s.values||[]).find(i=>Gu(i,n))!==void 0}function Hv(s,n){if(s===n)return 0;const i=nm(s),a=nm(n);if(i!==a)return gr(i,a);switch(i){case 0:case 9007199254740991:return 0;case 1:return gr(s.booleanValue,n.booleanValue);case 2:return function(p,_){const T=Vs(p.integerValue||p.doubleValue),w=Vs(_.integerValue||_.doubleValue);return T<w?-1:T>w?1:T===w?0:isNaN(T)?isNaN(w)?0:-1:1}(s,n);case 3:return K8(s.timestampValue,n.timestampValue);case 4:return K8(c0(s),c0(n));case 5:return c2(s.stringValue,n.stringValue);case 6:return function(p,_){const T=tm(p),w=tm(_);return T.compareTo(w)}(s.bytesValue,n.bytesValue);case 7:return function(p,_){const T=p.split("/"),w=_.split("/");for(let C=0;C<T.length&&C<w.length;C++){const O=gr(T[C],w[C]);if(O!==0)return O}return gr(T.length,w.length)}(s.referenceValue,n.referenceValue);case 8:return function(p,_){const T=gr(Vs(p.latitude),Vs(_.latitude));return T!==0?T:gr(Vs(p.longitude),Vs(_.longitude))}(s.geoPointValue,n.geoPointValue);case 9:return X8(s.arrayValue,n.arrayValue);case 10:return function(p,_){var T,w,C,O;const k=p.fields||{},U=_.fields||{},G=(T=k[IO])===null||T===void 0?void 0:T.arrayValue,z=(w=U[IO])===null||w===void 0?void 0:w.arrayValue,J=gr(((C=G==null?void 0:G.values)===null||C===void 0?void 0:C.length)||0,((O=z==null?void 0:z.values)===null||O===void 0?void 0:O.length)||0);return J!==0?J:X8(G,z)}(s.mapValue,n.mapValue);case 11:return function(p,_){if(p===iN.mapValue&&_===iN.mapValue)return 0;if(p===iN.mapValue)return 1;if(_===iN.mapValue)return-1;const T=p.fields||{},w=Object.keys(T),C=_.fields||{},O=Object.keys(C);w.sort(),O.sort();for(let k=0;k<w.length&&k<O.length;++k){const U=c2(w[k],O[k]);if(U!==0)return U;const G=Hv(T[w[k]],C[O[k]]);if(G!==0)return G}return gr(w.length,O.length)}(s.mapValue,n.mapValue);default:throw Ln(23264,{Pe:i})}}function K8(s,n){if(typeof s=="string"&&typeof n=="string"&&s.length===n.length)return gr(s,n);const i=em(s),a=em(n),l=gr(i.seconds,a.seconds);return l!==0?l:gr(i.nanos,a.nanos)}function X8(s,n){const i=s.values||[],a=n.values||[];for(let l=0;l<i.length&&l<a.length;++l){const p=Hv(i[l],a[l]);if(p)return p}return gr(i.length,a.length)}function Gv(s){return l2(s)}function l2(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?function(i){const a=em(i);return`time(${a.seconds},${a.nanos})`}(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?function(i){return tm(i).toBase64()}(s.bytesValue):"referenceValue"in s?function(i){return Tn.fromName(i).toString()}(s.referenceValue):"geoPointValue"in s?function(i){return`geo(${i.latitude},${i.longitude})`}(s.geoPointValue):"arrayValue"in s?function(i){let a="[",l=!0;for(const p of i.values||[])l?l=!1:a+=",",a+=l2(p);return a+"]"}(s.arrayValue):"mapValue"in s?function(i){const a=Object.keys(i.fields||{}).sort();let l="{",p=!0;for(const _ of a)p?p=!1:l+=",",l+=`${_}:${l2(i.fields[_])}`;return l+"}"}(s.mapValue):Ln(61005,{value:s})}function JN(s){switch(nm(s)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const n=ED(s);return n?16+JN(n):16;case 5:return 2*s.stringValue.length;case 6:return tm(s.bytesValue).approximateByteSize();case 7:return s.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,p)=>l+JN(p),0)}(s.arrayValue);case 10:case 11:return function(a){let l=0;return cm(a.fields,(p,_)=>{l+=p.length+JN(_)}),l}(s.mapValue);default:throw Ln(13486,{value:s})}}function Q8(s,n){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`}}function d2(s){return!!s&&"integerValue"in s}function dj(s){return!!s&&"arrayValue"in s}function $8(s){return!!s&&"nullValue"in s}function J8(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function ZN(s){return!!s&&"mapValue"in s}function uge(s){var n,i;return((i=(((n=s==null?void 0:s.mapValue)===null||n===void 0?void 0:n.fields)||{})[e7])===null||i===void 0?void 0:i.stringValue)===t7}function Xw(s){if(s.geoPointValue)return{geoPointValue:Object.assign({},s.geoPointValue)};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:Object.assign({},s.timestampValue)};if(s.mapValue){const n={mapValue:{fields:{}}};return cm(s.mapValue.fields,(i,a)=>n.mapValue.fields[i]=Xw(a)),n}if(s.arrayValue){const n={arrayValue:{values:[]}};for(let i=0;i<(s.arrayValue.values||[]).length;++i)n.arrayValue.values[i]=Xw(s.arrayValue.values[i]);return n}return Object.assign({},s)}function hge(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue===dge}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dc{constructor(n){this.value=n}static empty(){return new dc({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let i=this.value;for(let a=0;a<n.length-1;++a)if(i=(i.mapValue.fields||{})[n.get(a)],!ZN(i))return null;return i=(i.mapValue.fields||{})[n.lastSegment()],i||null}}set(n,i){this.getFieldsMap(n.popLast())[n.lastSegment()]=Xw(i)}setAll(n){let i=Ga.emptyPath(),a={},l=[];n.forEach((_,T)=>{if(!i.isImmediateParentOf(T)){const w=this.getFieldsMap(i);this.applyChanges(w,a,l),a={},l=[],i=T.popLast()}_?a[T.lastSegment()]=Xw(_):l.push(T.lastSegment())});const p=this.getFieldsMap(i);this.applyChanges(p,a,l)}delete(n){const i=this.field(n.popLast());ZN(i)&&i.mapValue.fields&&delete i.mapValue.fields[n.lastSegment()]}isEqual(n){return Gu(this.value,n.value)}getFieldsMap(n){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let a=0;a<n.length;++a){let l=i.mapValue.fields[n.get(a)];ZN(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[n.get(a)]=l),i=l}return i.mapValue.fields}applyChanges(n,i,a){cm(i,(l,p)=>n[l]=p);for(const l of a)delete n[l]}clone(){return new dc(Xw(this.value))}}function n7(s){const n=[];return cm(s.fields,(i,a)=>{const l=new Ga([i]);if(ZN(a)){const p=n7(a.mapValue).fields;if(p.length===0)n.push(l);else for(const _ of p)n.push(l.child(_))}else n.push(l)}),new Uc(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo{constructor(n,i,a,l,p,_,T){this.key=n,this.documentType=i,this.version=a,this.readTime=l,this.createTime=p,this.data=_,this.documentState=T}static newInvalidDocument(n){return new uo(n,0,Gn.min(),Gn.min(),Gn.min(),dc.empty(),0)}static newFoundDocument(n,i,a,l){return new uo(n,1,i,Gn.min(),a,l,0)}static newNoDocument(n,i){return new uo(n,2,i,Gn.min(),Gn.min(),dc.empty(),0)}static newUnknownDocument(n,i){return new uo(n,3,i,Gn.min(),Gn.min(),dc.empty(),2)}convertToFoundDocument(n,i){return!this.createTime.isEqual(Gn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=n),this.version=n,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(n){return this.version=n,this.documentType=2,this.data=dc.empty(),this.documentState=0,this}convertToUnknownDocument(n){return this.version=n,this.documentType=3,this.data=dc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Gn.min(),this}setReadTime(n){return this.readTime=n,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(n){return n instanceof uo&&this.key.isEqual(n.key)&&this.version.isEqual(n.version)&&this.documentType===n.documentType&&this.documentState===n.documentState&&this.data.isEqual(n.data)}mutableCopy(){return new uo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NO{constructor(n,i){this.position=n,this.inclusive=i}}function Z8(s,n,i){let a=0;for(let l=0;l<s.position.length;l++){const p=n[l],_=s.position[l];if(p.field.isKeyField()?a=Tn.comparator(Tn.fromName(_.referenceValue),i.key):a=Hv(_,i.data.field(p.field)),p.dir==="desc"&&(a*=-1),a!==0)break}return a}function ez(s,n){if(s===null)return n===null;if(n===null||s.inclusive!==n.inclusive||s.position.length!==n.position.length)return!1;for(let i=0;i<s.position.length;i++)if(!Gu(s.position[i],n.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0{constructor(n,i="asc"){this.field=n,this.dir=i}}function pge(s,n){return s.dir===n.dir&&s.field.isEqual(n.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r7{}class ta extends r7{constructor(n,i,a){super(),this.field=n,this.op=i,this.value=a}static create(n,i,a){return n.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(n,i,a):new mge(n,i,a):i==="array-contains"?new Ege(n,a):i==="in"?new yge(n,a):i==="not-in"?new vge(n,a):i==="array-contains-any"?new Sge(n,a):new ta(n,i,a)}static createKeyFieldInFilter(n,i,a){return i==="in"?new gge(n,a):new _ge(n,a)}matches(n){const i=n.data.field(this.field);return this.op==="!="?i!==null&&i.nullValue===void 0&&this.matchesComparison(Hv(i,this.value)):i!==null&&nm(this.value)===nm(i)&&this.matchesComparison(Hv(i,this.value))}matchesComparison(n){switch(this.op){case"<":return n<0;case"<=":return n<=0;case"==":return n===0;case"!=":return n!==0;case">":return n>0;case">=":return n>=0;default:return Ln(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Rd extends r7{constructor(n,i){super(),this.filters=n,this.op=i,this.Te=null}static create(n,i){return new Rd(n,i)}matches(n){return i7(this)?this.filters.find(i=>!i.matches(n))===void 0:this.filters.find(i=>i.matches(n))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((n,i)=>n.concat(i.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function i7(s){return s.op==="and"}function s7(s){return fge(s)&&i7(s)}function fge(s){for(const n of s.filters)if(n instanceof Rd)return!1;return!0}function u2(s){if(s instanceof ta)return s.field.canonicalString()+s.op.toString()+Gv(s.value);if(s7(s))return s.filters.map(n=>u2(n)).join(",");{const n=s.filters.map(i=>u2(i)).join(",");return`${s.op}(${n})`}}function a7(s,n){return s instanceof ta?function(a,l){return l instanceof ta&&a.op===l.op&&a.field.isEqual(l.field)&&Gu(a.value,l.value)}(s,n):s instanceof Rd?function(a,l){return l instanceof Rd&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((p,_,T)=>p&&a7(_,l.filters[T]),!0):!1}(s,n):void Ln(19439)}function o7(s){return s instanceof ta?function(i){return`${i.field.canonicalString()} ${i.op} ${Gv(i.value)}`}(s):s instanceof Rd?function(i){return i.op.toString()+" {"+i.getFilters().map(o7).join(" ,")+"}"}(s):"Filter"}class mge extends ta{constructor(n,i,a){super(n,i,a),this.key=Tn.fromName(a.referenceValue)}matches(n){const i=Tn.comparator(n.key,this.key);return this.matchesComparison(i)}}class gge extends ta{constructor(n,i){super(n,"in",i),this.keys=c7("in",i)}matches(n){return this.keys.some(i=>i.isEqual(n.key))}}class _ge extends ta{constructor(n,i){super(n,"not-in",i),this.keys=c7("not-in",i)}matches(n){return!this.keys.some(i=>i.isEqual(n.key))}}function c7(s,n){var i;return(((i=n.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(a=>Tn.fromName(a.referenceValue))}class Ege extends ta{constructor(n,i){super(n,"array-contains",i)}matches(n){const i=n.data.field(this.field);return dj(i)&&d0(i.arrayValue,this.value)}}class yge extends ta{constructor(n,i){super(n,"in",i)}matches(n){const i=n.data.field(this.field);return i!==null&&d0(this.value.arrayValue,i)}}class vge extends ta{constructor(n,i){super(n,"not-in",i)}matches(n){if(d0(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=n.data.field(this.field);return i!==null&&i.nullValue===void 0&&!d0(this.value.arrayValue,i)}}class Sge extends ta{constructor(n,i){super(n,"array-contains-any",i)}matches(n){const i=n.data.field(this.field);return!(!dj(i)||!i.arrayValue.values)&&i.arrayValue.values.some(a=>d0(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tge{constructor(n,i=null,a=[],l=[],p=null,_=null,T=null){this.path=n,this.collectionGroup=i,this.orderBy=a,this.filters=l,this.limit=p,this.startAt=_,this.endAt=T,this.Ie=null}}function tz(s,n=null,i=[],a=[],l=null,p=null,_=null){return new Tge(s,n,i,a,l,p,_)}function uj(s){const n=zn(s);if(n.Ie===null){let i=n.path.canonicalString();n.collectionGroup!==null&&(i+="|cg:"+n.collectionGroup),i+="|f:",i+=n.filters.map(a=>u2(a)).join(","),i+="|ob:",i+=n.orderBy.map(a=>function(p){return p.field.canonicalString()+p.dir}(a)).join(","),_D(n.limit)||(i+="|l:",i+=n.limit),n.startAt&&(i+="|lb:",i+=n.startAt.inclusive?"b:":"a:",i+=n.startAt.position.map(a=>Gv(a)).join(",")),n.endAt&&(i+="|ub:",i+=n.endAt.inclusive?"a:":"b:",i+=n.endAt.position.map(a=>Gv(a)).join(",")),n.Ie=i}return n.Ie}function hj(s,n){if(s.limit!==n.limit||s.orderBy.length!==n.orderBy.length)return!1;for(let i=0;i<s.orderBy.length;i++)if(!pge(s.orderBy[i],n.orderBy[i]))return!1;if(s.filters.length!==n.filters.length)return!1;for(let i=0;i<s.filters.length;i++)if(!a7(s.filters[i],n.filters[i]))return!1;return s.collectionGroup===n.collectionGroup&&!!s.path.isEqual(n.path)&&!!ez(s.startAt,n.startAt)&&ez(s.endAt,n.endAt)}function h2(s){return Tn.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lS{constructor(n,i=null,a=[],l=[],p=null,_="F",T=null,w=null){this.path=n,this.collectionGroup=i,this.explicitOrderBy=a,this.filters=l,this.limit=p,this.limitType=_,this.startAt=T,this.endAt=w,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function bge(s,n,i,a,l,p,_,T){return new lS(s,n,i,a,l,p,_,T)}function pj(s){return new lS(s)}function nz(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function l7(s){return s.collectionGroup!==null}function Qw(s){const n=zn(s);if(n.Ee===null){n.Ee=[];const i=new Set;for(const p of n.explicitOrderBy)n.Ee.push(p),i.add(p.field.canonicalString());const a=n.explicitOrderBy.length>0?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";(function(_){let T=new pa(Ga.comparator);return _.filters.forEach(w=>{w.getFlattenedFilters().forEach(C=>{C.isInequality()&&(T=T.add(C.field))})}),T})(n).forEach(p=>{i.has(p.canonicalString())||p.isKeyField()||n.Ee.push(new u0(p,a))}),i.has(Ga.keyField().canonicalString())||n.Ee.push(new u0(Ga.keyField(),a))}return n.Ee}function Fu(s){const n=zn(s);return n.de||(n.de=wge(n,Qw(s))),n.de}function wge(s,n){if(s.limitType==="F")return tz(s.path,s.collectionGroup,n,s.filters,s.limit,s.startAt,s.endAt);{n=n.map(l=>{const p=l.dir==="desc"?"asc":"desc";return new u0(l.field,p)});const i=s.endAt?new NO(s.endAt.position,s.endAt.inclusive):null,a=s.startAt?new NO(s.startAt.position,s.startAt.inclusive):null;return tz(s.path,s.collectionGroup,n,s.filters,s.limit,i,a)}}function p2(s,n){const i=s.filters.concat([n]);return new lS(s.path,s.collectionGroup,s.explicitOrderBy.slice(),i,s.limit,s.limitType,s.startAt,s.endAt)}function f2(s,n,i){return new lS(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),n,i,s.startAt,s.endAt)}function yD(s,n){return hj(Fu(s),Fu(n))&&s.limitType===n.limitType}function d7(s){return`${uj(Fu(s))}|lt:${s.limitType}`}function Rv(s){return`Query(target=${function(i){let a=i.path.canonicalString();return i.collectionGroup!==null&&(a+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(a+=`, filters: [${i.filters.map(l=>o7(l)).join(", ")}]`),_D(i.limit)||(a+=", limit: "+i.limit),i.orderBy.length>0&&(a+=`, orderBy: [${i.orderBy.map(l=>function(_){return`${_.field.canonicalString()} (${_.dir})`}(l)).join(", ")}]`),i.startAt&&(a+=", startAt: ",a+=i.startAt.inclusive?"b:":"a:",a+=i.startAt.position.map(l=>Gv(l)).join(",")),i.endAt&&(a+=", endAt: ",a+=i.endAt.inclusive?"a:":"b:",a+=i.endAt.position.map(l=>Gv(l)).join(",")),`Target(${a})`}(Fu(s))}; limitType=${s.limitType})`}function vD(s,n){return n.isFoundDocument()&&function(a,l){const p=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(p):Tn.isDocumentKey(a.path)?a.path.isEqual(p):a.path.isImmediateParentOf(p)}(s,n)&&function(a,l){for(const p of Qw(a))if(!p.field.isKeyField()&&l.data.field(p.field)===null)return!1;return!0}(s,n)&&function(a,l){for(const p of a.filters)if(!p.matches(l))return!1;return!0}(s,n)&&function(a,l){return!(a.startAt&&!function(_,T,w){const C=Z8(_,T,w);return _.inclusive?C<=0:C<0}(a.startAt,Qw(a),l)||a.endAt&&!function(_,T,w){const C=Z8(_,T,w);return _.inclusive?C>=0:C>0}(a.endAt,Qw(a),l))}(s,n)}function Rge(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function u7(s){return(n,i)=>{let a=!1;for(const l of Qw(s)){const p=Cge(l,n,i);if(p!==0)return p;a=a||l.field.isKeyField()}return 0}}function Cge(s,n,i){const a=s.field.isKeyField()?Tn.comparator(n.key,i.key):function(p,_,T){const w=_.data.field(p),C=T.data.field(p);return w!==null&&C!==null?Hv(w,C):Ln(42886)}(s.field,n,i);switch(s.dir){case"asc":return a;case"desc":return-1*a;default:return Ln(19790,{direction:s.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F_{constructor(n,i){this.mapKeyFn=n,this.equalsFn=i,this.inner={},this.innerSize=0}get(n){const i=this.mapKeyFn(n),a=this.inner[i];if(a!==void 0){for(const[l,p]of a)if(this.equalsFn(l,n))return p}}has(n){return this.get(n)!==void 0}set(n,i){const a=this.mapKeyFn(n),l=this.inner[a];if(l===void 0)return this.inner[a]=[[n,i]],void this.innerSize++;for(let p=0;p<l.length;p++)if(this.equalsFn(l[p][0],n))return void(l[p]=[n,i]);l.push([n,i]),this.innerSize++}delete(n){const i=this.mapKeyFn(n),a=this.inner[i];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],n))return a.length===1?delete this.inner[i]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(n){cm(this.inner,(i,a)=>{for(const[l,p]of a)n(l,p)})}isEmpty(){return KK(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Age=new ps(Tn.comparator);function mp(){return Age}const h7=new ps(Tn.comparator);function Pw(...s){let n=h7;for(const i of s)n=n.insert(i.key,i);return n}function p7(s){let n=h7;return s.forEach((i,a)=>n=n.insert(i,a.overlayedDocument)),n}function __(){return $w()}function f7(){return $w()}function $w(){return new F_(s=>s.toString(),(s,n)=>s.isEqual(n))}const Ige=new ps(Tn.comparator),Nge=new pa(Tn.comparator);function Rr(...s){let n=Nge;for(const i of s)n=n.add(i);return n}const Oge=new pa(gr);function Dge(){return Oge}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fj(s,n){if(s.useProto3Json){if(isNaN(n))return{doubleValue:"NaN"};if(n===1/0)return{doubleValue:"Infinity"};if(n===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:CO(n)?"-0":n}}function m7(s){return{integerValue:""+s}}function xge(s,n){return sge(n)?m7(n):fj(s,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SD{constructor(){this._=void 0}}function Pge(s,n,i){return s instanceof OO?function(l,p){const _={fields:{[$K]:{stringValue:QK},[ZK]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return p&&lj(p)&&(p=ED(p)),p&&(_.fields[JK]=p),{mapValue:_}}(i,n):s instanceof h0?_7(s,n):s instanceof p0?E7(s,n):function(l,p){const _=g7(l,p),T=rz(_)+rz(l.Re);return d2(_)&&d2(l.Re)?m7(T):fj(l.serializer,T)}(s,n)}function kge(s,n,i){return s instanceof h0?_7(s,n):s instanceof p0?E7(s,n):i}function g7(s,n){return s instanceof DO?function(a){return d2(a)||function(p){return!!p&&"doubleValue"in p}(a)}(n)?n:{integerValue:0}:null}class OO extends SD{}class h0 extends SD{constructor(n){super(),this.elements=n}}function _7(s,n){const i=y7(n);for(const a of s.elements)i.some(l=>Gu(l,a))||i.push(a);return{arrayValue:{values:i}}}class p0 extends SD{constructor(n){super(),this.elements=n}}function E7(s,n){let i=y7(n);for(const a of s.elements)i=i.filter(l=>!Gu(l,a));return{arrayValue:{values:i}}}class DO extends SD{constructor(n,i){super(),this.serializer=n,this.Re=i}}function rz(s){return Vs(s.integerValue||s.doubleValue)}function y7(s){return dj(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}function Lge(s,n){return s.field.isEqual(n.field)&&function(a,l){return a instanceof h0&&l instanceof h0||a instanceof p0&&l instanceof p0?Bv(a.elements,l.elements,Gu):a instanceof DO&&l instanceof DO?Gu(a.Re,l.Re):a instanceof OO&&l instanceof OO}(s.transform,n.transform)}class Mge{constructor(n,i){this.version=n,this.transformResults=i}}class kl{constructor(n,i){this.updateTime=n,this.exists=i}static none(){return new kl}static exists(n){return new kl(void 0,n)}static updateTime(n){return new kl(n)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(n){return this.exists===n.exists&&(this.updateTime?!!n.updateTime&&this.updateTime.isEqual(n.updateTime):!n.updateTime)}}function eO(s,n){return s.updateTime!==void 0?n.isFoundDocument()&&n.version.isEqual(s.updateTime):s.exists===void 0||s.exists===n.isFoundDocument()}class TD{}function v7(s,n){if(!s.hasLocalMutations||n&&n.fields.length===0)return null;if(n===null)return s.isNoDocument()?new mj(s.key,kl.none()):new R0(s.key,s.data,kl.none());{const i=s.data,a=dc.empty();let l=new pa(Ga.comparator);for(let p of n.fields)if(!l.has(p)){let _=i.field(p);_===null&&p.length>1&&(p=p.popLast(),_=i.field(p)),_===null?a.delete(p):a.set(p,_),l=l.add(p)}return new lm(s.key,a,new Uc(l.toArray()),kl.none())}}function jge(s,n,i){s instanceof R0?function(l,p,_){const T=l.value.clone(),w=sz(l.fieldTransforms,p,_.transformResults);T.setAll(w),p.convertToFoundDocument(_.version,T).setHasCommittedMutations()}(s,n,i):s instanceof lm?function(l,p,_){if(!eO(l.precondition,p))return void p.convertToUnknownDocument(_.version);const T=sz(l.fieldTransforms,p,_.transformResults),w=p.data;w.setAll(S7(l)),w.setAll(T),p.convertToFoundDocument(_.version,w).setHasCommittedMutations()}(s,n,i):function(l,p,_){p.convertToNoDocument(_.version).setHasCommittedMutations()}(0,n,i)}function Jw(s,n,i,a){return s instanceof R0?function(p,_,T,w){if(!eO(p.precondition,_))return T;const C=p.value.clone(),O=az(p.fieldTransforms,w,_);return C.setAll(O),_.convertToFoundDocument(_.version,C).setHasLocalMutations(),null}(s,n,i,a):s instanceof lm?function(p,_,T,w){if(!eO(p.precondition,_))return T;const C=az(p.fieldTransforms,w,_),O=_.data;return O.setAll(S7(p)),O.setAll(C),_.convertToFoundDocument(_.version,O).setHasLocalMutations(),T===null?null:T.unionWith(p.fieldMask.fields).unionWith(p.fieldTransforms.map(k=>k.field))}(s,n,i,a):function(p,_,T){return eO(p.precondition,_)?(_.convertToNoDocument(_.version).setHasLocalMutations(),null):T}(s,n,i)}function Uge(s,n){let i=null;for(const a of s.fieldTransforms){const l=n.data.field(a.field),p=g7(a.transform,l||null);p!=null&&(i===null&&(i=dc.empty()),i.set(a.field,p))}return i||null}function iz(s,n){return s.type===n.type&&!!s.key.isEqual(n.key)&&!!s.precondition.isEqual(n.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&Bv(a,l,(p,_)=>Lge(p,_))}(s.fieldTransforms,n.fieldTransforms)&&(s.type===0?s.value.isEqual(n.value):s.type!==1||s.data.isEqual(n.data)&&s.fieldMask.isEqual(n.fieldMask))}class R0 extends TD{constructor(n,i,a,l=[]){super(),this.key=n,this.value=i,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class lm extends TD{constructor(n,i,a,l,p=[]){super(),this.key=n,this.data=i,this.fieldMask=a,this.precondition=l,this.fieldTransforms=p,this.type=1}getFieldMask(){return this.fieldMask}}function S7(s){const n=new Map;return s.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const a=s.data.field(i);n.set(i,a)}}),n}function sz(s,n,i){const a=new Map;ui(s.length===i.length,32656,{Ve:i.length,me:s.length});for(let l=0;l<i.length;l++){const p=s[l],_=p.transform,T=n.data.field(p.field);a.set(p.field,kge(_,T,i[l]))}return a}function az(s,n,i){const a=new Map;for(const l of s){const p=l.transform,_=i.data.field(l.field);a.set(l.field,Pge(p,_,n))}return a}class mj extends TD{constructor(n,i){super(),this.key=n,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Vge extends TD{constructor(n,i){super(),this.key=n,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fge{constructor(n,i,a,l){this.batchId=n,this.localWriteTime=i,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(n,i){const a=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const p=this.mutations[l];p.key.isEqual(n.key)&&jge(p,n,a[l])}}applyToLocalView(n,i){for(const a of this.baseMutations)a.key.isEqual(n.key)&&(i=Jw(a,n,i,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(n.key)&&(i=Jw(a,n,i,this.localWriteTime));return i}applyToLocalDocumentSet(n,i){const a=f7();return this.mutations.forEach(l=>{const p=n.get(l.key),_=p.overlayedDocument;let T=this.applyToLocalView(_,p.mutatedFields);T=i.has(l.key)?null:T;const w=v7(_,T);w!==null&&a.set(l.key,w),_.isValidDocument()||_.convertToNoDocument(Gn.min())}),a}keys(){return this.mutations.reduce((n,i)=>n.add(i.key),Rr())}isEqual(n){return this.batchId===n.batchId&&Bv(this.mutations,n.mutations,(i,a)=>iz(i,a))&&Bv(this.baseMutations,n.baseMutations,(i,a)=>iz(i,a))}}class gj{constructor(n,i,a,l){this.batch=n,this.commitVersion=i,this.mutationResults=a,this.docVersions=l}static from(n,i,a){ui(n.mutations.length===a.length,58842,{fe:n.mutations.length,ge:a.length});let l=function(){return Ige}();const p=n.mutations;for(let _=0;_<p.length;_++)l=l.insert(p[_].key,a[_].version);return new gj(n,i,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bge{constructor(n,i){this.largestBatchId=n,this.mutation=i}getKey(){return this.mutation.key}isEqual(n){return n!==null&&this.mutation===n.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hge{constructor(n,i){this.count=n,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Zs,Lr;function Gge(s){switch(s){case _t.OK:return Ln(64938);case _t.CANCELLED:case _t.UNKNOWN:case _t.DEADLINE_EXCEEDED:case _t.RESOURCE_EXHAUSTED:case _t.INTERNAL:case _t.UNAVAILABLE:case _t.UNAUTHENTICATED:return!1;case _t.INVALID_ARGUMENT:case _t.NOT_FOUND:case _t.ALREADY_EXISTS:case _t.PERMISSION_DENIED:case _t.FAILED_PRECONDITION:case _t.ABORTED:case _t.OUT_OF_RANGE:case _t.UNIMPLEMENTED:case _t.DATA_LOSS:return!0;default:return Ln(15467,{code:s})}}function T7(s){if(s===void 0)return fp("GRPC error has no .code"),_t.UNKNOWN;switch(s){case Zs.OK:return _t.OK;case Zs.CANCELLED:return _t.CANCELLED;case Zs.UNKNOWN:return _t.UNKNOWN;case Zs.DEADLINE_EXCEEDED:return _t.DEADLINE_EXCEEDED;case Zs.RESOURCE_EXHAUSTED:return _t.RESOURCE_EXHAUSTED;case Zs.INTERNAL:return _t.INTERNAL;case Zs.UNAVAILABLE:return _t.UNAVAILABLE;case Zs.UNAUTHENTICATED:return _t.UNAUTHENTICATED;case Zs.INVALID_ARGUMENT:return _t.INVALID_ARGUMENT;case Zs.NOT_FOUND:return _t.NOT_FOUND;case Zs.ALREADY_EXISTS:return _t.ALREADY_EXISTS;case Zs.PERMISSION_DENIED:return _t.PERMISSION_DENIED;case Zs.FAILED_PRECONDITION:return _t.FAILED_PRECONDITION;case Zs.ABORTED:return _t.ABORTED;case Zs.OUT_OF_RANGE:return _t.OUT_OF_RANGE;case Zs.UNIMPLEMENTED:return _t.UNIMPLEMENTED;case Zs.DATA_LOSS:return _t.DATA_LOSS;default:return Ln(39323,{code:s})}}(Lr=Zs||(Zs={}))[Lr.OK=0]="OK",Lr[Lr.CANCELLED=1]="CANCELLED",Lr[Lr.UNKNOWN=2]="UNKNOWN",Lr[Lr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Lr[Lr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Lr[Lr.NOT_FOUND=5]="NOT_FOUND",Lr[Lr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Lr[Lr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Lr[Lr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Lr[Lr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Lr[Lr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Lr[Lr.ABORTED=10]="ABORTED",Lr[Lr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Lr[Lr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Lr[Lr.INTERNAL=13]="INTERNAL",Lr[Lr.UNAVAILABLE=14]="UNAVAILABLE",Lr[Lr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wge=new Kf([4294967295,4294967295],0);function oz(s){const n=zK().encode(s),i=new jK;return i.update(n),new Uint8Array(i.digest())}function cz(s){const n=new DataView(s.buffer),i=n.getUint32(0,!0),a=n.getUint32(4,!0),l=n.getUint32(8,!0),p=n.getUint32(12,!0);return[new Kf([i,a],0),new Kf([l,p],0)]}class _j{constructor(n,i,a){if(this.bitmap=n,this.padding=i,this.hashCount=a,i<0||i>=8)throw new kw(`Invalid padding: ${i}`);if(a<0)throw new kw(`Invalid hash count: ${a}`);if(n.length>0&&this.hashCount===0)throw new kw(`Invalid hash count: ${a}`);if(n.length===0&&i!==0)throw new kw(`Invalid padding when bitmap length is 0: ${i}`);this.pe=8*n.length-i,this.ye=Kf.fromNumber(this.pe)}we(n,i,a){let l=n.add(i.multiply(Kf.fromNumber(a)));return l.compare(Wge)===1&&(l=new Kf([l.getBits(0),l.getBits(1)],0)),l.modulo(this.ye).toNumber()}be(n){return!!(this.bitmap[Math.floor(n/8)]&1<<n%8)}mightContain(n){if(this.pe===0)return!1;const i=oz(n),[a,l]=cz(i);for(let p=0;p<this.hashCount;p++){const _=this.we(a,l,p);if(!this.be(_))return!1}return!0}static create(n,i,a){const l=n%8==0?0:8-n%8,p=new Uint8Array(Math.ceil(n/8)),_=new _j(p,l,i);return a.forEach(T=>_.insert(T)),_}insert(n){if(this.pe===0)return;const i=oz(n),[a,l]=cz(i);for(let p=0;p<this.hashCount;p++){const _=this.we(a,l,p);this.Se(_)}}Se(n){const i=Math.floor(n/8),a=n%8;this.bitmap[i]|=1<<a}}class kw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bD{constructor(n,i,a,l,p){this.snapshotVersion=n,this.targetChanges=i,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=p}static createSynthesizedRemoteEventForCurrentChange(n,i,a){const l=new Map;return l.set(n,C0.createSynthesizedTargetChangeForCurrentChange(n,i,a)),new bD(Gn.min(),l,new ps(gr),mp(),Rr())}}class C0{constructor(n,i,a,l,p){this.resumeToken=n,this.current=i,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=p}static createSynthesizedTargetChangeForCurrentChange(n,i,a){return new C0(a,i,Rr(),Rr(),Rr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tO{constructor(n,i,a,l){this.De=n,this.removedTargetIds=i,this.key=a,this.ve=l}}class b7{constructor(n,i){this.targetId=n,this.Ce=i}}class w7{constructor(n,i,a=Wa.EMPTY_BYTE_STRING,l=null){this.state=n,this.targetIds=i,this.resumeToken=a,this.cause=l}}class lz{constructor(){this.Fe=0,this.Me=dz(),this.xe=Wa.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(n){n.approximateByteSize()>0&&(this.Ne=!0,this.xe=n)}qe(){let n=Rr(),i=Rr(),a=Rr();return this.Me.forEach((l,p)=>{switch(p){case 0:n=n.add(l);break;case 2:i=i.add(l);break;case 1:a=a.add(l);break;default:Ln(38017,{changeType:p})}}),new C0(this.xe,this.Oe,n,i,a)}Qe(){this.Ne=!1,this.Me=dz()}$e(n,i){this.Ne=!0,this.Me=this.Me.insert(n,i)}Ue(n){this.Ne=!0,this.Me=this.Me.remove(n)}Ke(){this.Fe+=1}We(){this.Fe-=1,ui(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class zge{constructor(n){this.ze=n,this.je=new Map,this.He=mp(),this.Je=sN(),this.Ye=sN(),this.Ze=new ps(gr)}Xe(n){for(const i of n.De)n.ve&&n.ve.isFoundDocument()?this.et(i,n.ve):this.tt(i,n.key,n.ve);for(const i of n.removedTargetIds)this.tt(i,n.key,n.ve)}nt(n){this.forEachTarget(n,i=>{const a=this.rt(i);switch(n.state){case 0:this.it(i)&&a.ke(n.resumeToken);break;case 1:a.We(),a.Be||a.Qe(),a.ke(n.resumeToken);break;case 2:a.We(),a.Be||this.removeTarget(i);break;case 3:this.it(i)&&(a.Ge(),a.ke(n.resumeToken));break;case 4:this.it(i)&&(this.st(i),a.ke(n.resumeToken));break;default:Ln(56790,{state:n.state})}})}forEachTarget(n,i){n.targetIds.length>0?n.targetIds.forEach(i):this.je.forEach((a,l)=>{this.it(l)&&i(l)})}ot(n){const i=n.targetId,a=n.Ce.count,l=this._t(i);if(l){const p=l.target;if(h2(p))if(a===0){const _=new Tn(p.path);this.tt(i,_,uo.newNoDocument(_,Gn.min()))}else ui(a===1,20013,{expectedCount:a});else{const _=this.ut(i);if(_!==a){const T=this.ct(n),w=T?this.lt(T,n,_):1;if(w!==0){this.st(i);const C=w===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(i,C)}}}}}ct(n){const i=n.Ce.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:p=0}=i;let _,T;try{_=tm(a).toUint8Array()}catch(w){if(w instanceof XK)return Fv("Decoding the base64 bloom filter in existence filter failed ("+w.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw w}try{T=new _j(_,l,p)}catch(w){return Fv(w instanceof kw?"BloomFilter error: ":"Applying bloom filter failed: ",w),null}return T.pe===0?null:T}lt(n,i,a){return i.Ce.count===a-this.Tt(n,i.targetId)?0:2}Tt(n,i){const a=this.ze.getRemoteKeysForTarget(i);let l=0;return a.forEach(p=>{const _=this.ze.Pt(),T=`projects/${_.projectId}/databases/${_.database}/documents/${p.path.canonicalString()}`;n.mightContain(T)||(this.tt(i,p,null),l++)}),l}It(n){const i=new Map;this.je.forEach((p,_)=>{const T=this._t(_);if(T){if(p.current&&h2(T.target)){const w=new Tn(T.target.path);this.Et(w).has(_)||this.dt(_,w)||this.tt(_,w,uo.newNoDocument(w,n))}p.Le&&(i.set(_,p.qe()),p.Qe())}});let a=Rr();this.Ye.forEach((p,_)=>{let T=!0;_.forEachWhile(w=>{const C=this._t(w);return!C||C.purpose==="TargetPurposeLimboResolution"||(T=!1,!1)}),T&&(a=a.add(p))}),this.He.forEach((p,_)=>_.setReadTime(n));const l=new bD(n,i,this.Ze,this.He,a);return this.He=mp(),this.Je=sN(),this.Ye=sN(),this.Ze=new ps(gr),l}et(n,i){if(!this.it(n))return;const a=this.dt(n,i.key)?2:0;this.rt(n).$e(i.key,a),this.He=this.He.insert(i.key,i),this.Je=this.Je.insert(i.key,this.Et(i.key).add(n)),this.Ye=this.Ye.insert(i.key,this.At(i.key).add(n))}tt(n,i,a){if(!this.it(n))return;const l=this.rt(n);this.dt(n,i)?l.$e(i,1):l.Ue(i),this.Ye=this.Ye.insert(i,this.At(i).delete(n)),this.Ye=this.Ye.insert(i,this.At(i).add(n)),a&&(this.He=this.He.insert(i,a))}removeTarget(n){this.je.delete(n)}ut(n){const i=this.rt(n).qe();return this.ze.getRemoteKeysForTarget(n).size+i.addedDocuments.size-i.removedDocuments.size}Ke(n){this.rt(n).Ke()}rt(n){let i=this.je.get(n);return i||(i=new lz,this.je.set(n,i)),i}At(n){let i=this.Ye.get(n);return i||(i=new pa(gr),this.Ye=this.Ye.insert(n,i)),i}Et(n){let i=this.Je.get(n);return i||(i=new pa(gr),this.Je=this.Je.insert(n,i)),i}it(n){const i=this._t(n)!==null;return i||Qt("WatchChangeAggregator","Detected inactive target",n),i}_t(n){const i=this.je.get(n);return i&&i.Be?null:this.ze.Rt(n)}st(n){this.je.set(n,new lz),this.ze.getRemoteKeysForTarget(n).forEach(i=>{this.tt(n,i,null)})}dt(n,i){return this.ze.getRemoteKeysForTarget(n).has(i)}}function sN(){return new ps(Tn.comparator)}function dz(){return new ps(Tn.comparator)}const Yge={asc:"ASCENDING",desc:"DESCENDING"},qge={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Kge={and:"AND",or:"OR"};class Xge{constructor(n,i){this.databaseId=n,this.useProto3Json=i}}function m2(s,n){return s.useProto3Json||_D(n)?n:{value:n}}function xO(s,n){return s.useProto3Json?`${new Date(1e3*n.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+n.nanoseconds).slice(-9)}Z`:{seconds:""+n.seconds,nanos:n.nanoseconds}}function R7(s,n){return s.useProto3Json?n.toBase64():n.toUint8Array()}function Qge(s,n){return xO(s,n.toTimestamp())}function Bu(s){return ui(!!s,49232),Gn.fromTimestamp(function(i){const a=em(i);return new ha(a.seconds,a.nanos)}(s))}function Ej(s,n){return g2(s,n).canonicalString()}function g2(s,n){const i=function(l){return new Gi(["projects",l.projectId,"databases",l.database])}(s).child("documents");return n===void 0?i:i.child(n)}function C7(s){const n=Gi.fromString(s);return ui(D7(n),10190,{key:n.toString()}),n}function _2(s,n){return Ej(s.databaseId,n.path)}function sM(s,n){const i=C7(n);if(i.get(1)!==s.databaseId.projectId)throw new Jt(_t.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+s.databaseId.projectId);if(i.get(3)!==s.databaseId.database)throw new Jt(_t.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+s.databaseId.database);return new Tn(I7(i))}function A7(s,n){return Ej(s.databaseId,n)}function $ge(s){const n=C7(s);return n.length===4?Gi.emptyPath():I7(n)}function E2(s){return new Gi(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function I7(s){return ui(s.length>4&&s.get(4)==="documents",29091,{key:s.toString()}),s.popFirst(5)}function uz(s,n,i){return{name:_2(s,n),fields:i.value.mapValue.fields}}function Jge(s,n){let i;if("targetChange"in n){n.targetChange;const a=function(C){return C==="NO_CHANGE"?0:C==="ADD"?1:C==="REMOVE"?2:C==="CURRENT"?3:C==="RESET"?4:Ln(39313,{state:C})}(n.targetChange.targetChangeType||"NO_CHANGE"),l=n.targetChange.targetIds||[],p=function(C,O){return C.useProto3Json?(ui(O===void 0||typeof O=="string",58123),Wa.fromBase64String(O||"")):(ui(O===void 0||O instanceof Buffer||O instanceof Uint8Array,16193),Wa.fromUint8Array(O||new Uint8Array))}(s,n.targetChange.resumeToken),_=n.targetChange.cause,T=_&&function(C){const O=C.code===void 0?_t.UNKNOWN:T7(C.code);return new Jt(O,C.message||"")}(_);i=new w7(a,l,p,T||null)}else if("documentChange"in n){n.documentChange;const a=n.documentChange;a.document,a.document.name,a.document.updateTime;const l=sM(s,a.document.name),p=Bu(a.document.updateTime),_=a.document.createTime?Bu(a.document.createTime):Gn.min(),T=new dc({mapValue:{fields:a.document.fields}}),w=uo.newFoundDocument(l,p,_,T),C=a.targetIds||[],O=a.removedTargetIds||[];i=new tO(C,O,w.key,w)}else if("documentDelete"in n){n.documentDelete;const a=n.documentDelete;a.document;const l=sM(s,a.document),p=a.readTime?Bu(a.readTime):Gn.min(),_=uo.newNoDocument(l,p),T=a.removedTargetIds||[];i=new tO([],T,_.key,_)}else if("documentRemove"in n){n.documentRemove;const a=n.documentRemove;a.document;const l=sM(s,a.document),p=a.removedTargetIds||[];i=new tO([],p,l,null)}else{if(!("filter"in n))return Ln(11601,{Vt:n});{n.filter;const a=n.filter;a.targetId;const{count:l=0,unchangedNames:p}=a,_=new Hge(l,p),T=a.targetId;i=new b7(T,_)}}return i}function Zge(s,n){let i;if(n instanceof R0)i={update:uz(s,n.key,n.value)};else if(n instanceof mj)i={delete:_2(s,n.key)};else if(n instanceof lm)i={update:uz(s,n.key,n.data),updateMask:c_e(n.fieldMask)};else{if(!(n instanceof Vge))return Ln(16599,{ft:n.type});i={verify:_2(s,n.key)}}return n.fieldTransforms.length>0&&(i.updateTransforms=n.fieldTransforms.map(a=>function(p,_){const T=_.transform;if(T instanceof OO)return{fieldPath:_.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(T instanceof h0)return{fieldPath:_.field.canonicalString(),appendMissingElements:{values:T.elements}};if(T instanceof p0)return{fieldPath:_.field.canonicalString(),removeAllFromArray:{values:T.elements}};if(T instanceof DO)return{fieldPath:_.field.canonicalString(),increment:T.Re};throw Ln(20930,{transform:_.transform})}(0,a))),n.precondition.isNone||(i.currentDocument=function(l,p){return p.updateTime!==void 0?{updateTime:Qge(l,p.updateTime)}:p.exists!==void 0?{exists:p.exists}:Ln(27497)}(s,n.precondition)),i}function e_e(s,n){return s&&s.length>0?(ui(n!==void 0,14353),s.map(i=>function(l,p){let _=l.updateTime?Bu(l.updateTime):Bu(p);return _.isEqual(Gn.min())&&(_=Bu(p)),new Mge(_,l.transformResults||[])}(i,n))):[]}function t_e(s,n){return{documents:[A7(s,n.path)]}}function n_e(s,n){const i={structuredQuery:{}},a=n.path;let l;n.collectionGroup!==null?(l=a,i.structuredQuery.from=[{collectionId:n.collectionGroup,allDescendants:!0}]):(l=a.popLast(),i.structuredQuery.from=[{collectionId:a.lastSegment()}]),i.parent=A7(s,l);const p=function(C){if(C.length!==0)return O7(Rd.create(C,"and"))}(n.filters);p&&(i.structuredQuery.where=p);const _=function(C){if(C.length!==0)return C.map(O=>function(U){return{field:Cv(U.field),direction:s_e(U.dir)}}(O))}(n.orderBy);_&&(i.structuredQuery.orderBy=_);const T=m2(s,n.limit);return T!==null&&(i.structuredQuery.limit=T),n.startAt&&(i.structuredQuery.startAt=function(C){return{before:C.inclusive,values:C.position}}(n.startAt)),n.endAt&&(i.structuredQuery.endAt=function(C){return{before:!C.inclusive,values:C.position}}(n.endAt)),{gt:i,parent:l}}function r_e(s){let n=$ge(s.parent);const i=s.structuredQuery,a=i.from?i.from.length:0;let l=null;if(a>0){ui(a===1,65062);const O=i.from[0];O.allDescendants?l=O.collectionId:n=n.child(O.collectionId)}let p=[];i.where&&(p=function(k){const U=N7(k);return U instanceof Rd&&s7(U)?U.getFilters():[U]}(i.where));let _=[];i.orderBy&&(_=function(k){return k.map(U=>function(z){return new u0(Av(z.field),function(X){switch(X){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(z.direction))}(U))}(i.orderBy));let T=null;i.limit&&(T=function(k){let U;return U=typeof k=="object"?k.value:k,_D(U)?null:U}(i.limit));let w=null;i.startAt&&(w=function(k){const U=!!k.before,G=k.values||[];return new NO(G,U)}(i.startAt));let C=null;return i.endAt&&(C=function(k){const U=!k.before,G=k.values||[];return new NO(G,U)}(i.endAt)),bge(n,l,_,p,T,"F",w,C)}function i_e(s,n){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ln(28987,{purpose:l})}}(n.purpose);return i==null?null:{"goog-listen-tags":i}}function N7(s){return s.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const a=Av(i.unaryFilter.field);return ta.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=Av(i.unaryFilter.field);return ta.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const p=Av(i.unaryFilter.field);return ta.create(p,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const _=Av(i.unaryFilter.field);return ta.create(_,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ln(61313);default:return Ln(60726)}}(s):s.fieldFilter!==void 0?function(i){return ta.create(Av(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ln(58110);default:return Ln(50506)}}(i.fieldFilter.op),i.fieldFilter.value)}(s):s.compositeFilter!==void 0?function(i){return Rd.create(i.compositeFilter.filters.map(a=>N7(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Ln(1026)}}(i.compositeFilter.op))}(s):Ln(30097,{filter:s})}function s_e(s){return Yge[s]}function a_e(s){return qge[s]}function o_e(s){return Kge[s]}function Cv(s){return{fieldPath:s.canonicalString()}}function Av(s){return Ga.fromServerFormat(s.fieldPath)}function O7(s){return s instanceof ta?function(i){if(i.op==="=="){if(J8(i.value))return{unaryFilter:{field:Cv(i.field),op:"IS_NAN"}};if($8(i.value))return{unaryFilter:{field:Cv(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(J8(i.value))return{unaryFilter:{field:Cv(i.field),op:"IS_NOT_NAN"}};if($8(i.value))return{unaryFilter:{field:Cv(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Cv(i.field),op:a_e(i.op),value:i.value}}}(s):s instanceof Rd?function(i){const a=i.getFilters().map(l=>O7(l));return a.length===1?a[0]:{compositeFilter:{op:o_e(i.op),filters:a}}}(s):Ln(54877,{filter:s})}function c_e(s){const n=[];return s.fields.forEach(i=>n.push(i.canonicalString())),{fieldPaths:n}}function D7(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(n,i,a,l,p=Gn.min(),_=Gn.min(),T=Wa.EMPTY_BYTE_STRING,w=null){this.target=n,this.targetId=i,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=p,this.lastLimboFreeSnapshotVersion=_,this.resumeToken=T,this.expectedCount=w}withSequenceNumber(n){return new Gf(this.target,this.targetId,this.purpose,n,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(n,i){return new Gf(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,n,null)}withExpectedCount(n){return new Gf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,n)}withLastLimboFreeSnapshotVersion(n){return new Gf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,n,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l_e{constructor(n){this.wt=n}}function d_e(s){const n=r_e({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?f2(n,n.limit,"L"):n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u_e{constructor(){this.yn=new h_e}addToCollectionParentIndex(n,i){return this.yn.add(i),Et.resolve()}getCollectionParents(n,i){return Et.resolve(this.yn.getEntries(i))}addFieldIndex(n,i){return Et.resolve()}deleteFieldIndex(n,i){return Et.resolve()}deleteAllFieldIndexes(n){return Et.resolve()}createTargetIndexes(n,i){return Et.resolve()}getDocumentsMatchingTarget(n,i){return Et.resolve(null)}getIndexType(n,i){return Et.resolve(0)}getFieldIndexes(n,i){return Et.resolve([])}getNextCollectionGroupToUpdate(n){return Et.resolve(null)}getMinOffset(n,i){return Et.resolve(Zf.min())}getMinOffsetFromCollectionGroup(n,i){return Et.resolve(Zf.min())}updateCollectionGroup(n,i,a){return Et.resolve()}updateIndexEntries(n,i){return Et.resolve()}}class h_e{constructor(){this.index={}}add(n){const i=n.lastSegment(),a=n.popLast(),l=this.index[i]||new pa(Gi.comparator),p=!l.has(a);return this.index[i]=l.add(a),p}has(n){const i=n.lastSegment(),a=n.popLast(),l=this.index[i];return l&&l.has(a)}getEntries(n){return(this.index[n]||new pa(Gi.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hz={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},x7=41943040;class lc{static withCacheSize(n){return new lc(n,lc.DEFAULT_COLLECTION_PERCENTILE,lc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(n,i,a){this.cacheSizeCollectionThreshold=n,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */lc.DEFAULT_COLLECTION_PERCENTILE=10,lc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lc.DEFAULT=new lc(x7,lc.DEFAULT_COLLECTION_PERCENTILE,lc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lc.DISABLED=new lc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wv{constructor(n){this.nr=n}next(){return this.nr+=2,this.nr}static rr(){return new Wv(0)}static ir(){return new Wv(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pz="LruGarbageCollector",p_e=1048576;function fz([s,n],[i,a]){const l=gr(s,i);return l===0?gr(n,a):l}class f_e{constructor(n){this.cr=n,this.buffer=new pa(fz),this.lr=0}hr(){return++this.lr}Pr(n){const i=[n,this.hr()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(i);else{const a=this.buffer.last();fz(i,a)<0&&(this.buffer=this.buffer.delete(a).add(i))}}get maxValue(){return this.buffer.last()[0]}}class m_e{constructor(n,i,a){this.garbageCollector=n,this.asyncQueue=i,this.localStore=a,this.Tr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ir(6e4)}stop(){this.Tr&&(this.Tr.cancel(),this.Tr=null)}get started(){return this.Tr!==null}Ir(n){Qt(pz,`Garbage collection scheduled in ${n}ms`),this.Tr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,async()=>{this.Tr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){cS(i)?Qt(pz,"Ignoring IndexedDB error during garbage collection: ",i):await oS(i)}await this.Ir(3e5)})}}class g_e{constructor(n,i){this.Er=n,this.params=i}calculateTargetCount(n,i){return this.Er.dr(n).next(a=>Math.floor(i/100*a))}nthSequenceNumber(n,i){if(i===0)return Et.resolve(gD.le);const a=new f_e(i);return this.Er.forEachTarget(n,l=>a.Pr(l.sequenceNumber)).next(()=>this.Er.Ar(n,l=>a.Pr(l))).next(()=>a.maxValue)}removeTargets(n,i,a){return this.Er.removeTargets(n,i,a)}removeOrphanedDocuments(n,i){return this.Er.removeOrphanedDocuments(n,i)}collect(n,i){return this.params.cacheSizeCollectionThreshold===-1?(Qt("LruGarbageCollector","Garbage collection skipped; disabled"),Et.resolve(hz)):this.getCacheSize(n).next(a=>a<this.params.cacheSizeCollectionThreshold?(Qt("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),hz):this.Rr(n,i))}getCacheSize(n){return this.Er.getCacheSize(n)}Rr(n,i){let a,l,p,_,T,w,C;const O=Date.now();return this.calculateTargetCount(n,this.params.percentileToCollect).next(k=>(k>this.params.maximumSequenceNumbersToCollect?(Qt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${k}`),l=this.params.maximumSequenceNumbersToCollect):l=k,_=Date.now(),this.nthSequenceNumber(n,l))).next(k=>(a=k,T=Date.now(),this.removeTargets(n,a,i))).next(k=>(p=k,w=Date.now(),this.removeOrphanedDocuments(n,a))).next(k=>(C=Date.now(),wv()<=Mr.DEBUG&&Qt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${_-O}ms
	Determined least recently used ${l} in `+(T-_)+`ms
	Removed ${p} targets in `+(w-T)+`ms
	Removed ${k} documents in `+(C-w)+`ms
Total Duration: ${C-O}ms`),Et.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:p,documentsRemoved:k})))}}function __e(s,n){return new g_e(s,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E_e{constructor(){this.changes=new F_(n=>n.toString(),(n,i)=>n.isEqual(i)),this.changesApplied=!1}addEntry(n){this.assertNotApplied(),this.changes.set(n.key,n)}removeEntry(n,i){this.assertNotApplied(),this.changes.set(n,uo.newInvalidDocument(n).setReadTime(i))}getEntry(n,i){this.assertNotApplied();const a=this.changes.get(i);return a!==void 0?Et.resolve(a):this.getFromCache(n,i)}getEntries(n,i){return this.getAllFromCache(n,i)}apply(n){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(n)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y_e{constructor(n,i){this.overlayedDocument=n,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v_e{constructor(n,i,a,l){this.remoteDocumentCache=n,this.mutationQueue=i,this.documentOverlayCache=a,this.indexManager=l}getDocument(n,i){let a=null;return this.documentOverlayCache.getOverlay(n,i).next(l=>(a=l,this.remoteDocumentCache.getEntry(n,i))).next(l=>(a!==null&&Jw(a.mutation,l,Uc.empty(),ha.now()),l))}getDocuments(n,i){return this.remoteDocumentCache.getEntries(n,i).next(a=>this.getLocalViewOfDocuments(n,a,Rr()).next(()=>a))}getLocalViewOfDocuments(n,i,a=Rr()){const l=__();return this.populateOverlays(n,l,i).next(()=>this.computeViews(n,i,l,a).next(p=>{let _=Pw();return p.forEach((T,w)=>{_=_.insert(T,w.overlayedDocument)}),_}))}getOverlayedDocuments(n,i){const a=__();return this.populateOverlays(n,a,i).next(()=>this.computeViews(n,i,a,Rr()))}populateOverlays(n,i,a){const l=[];return a.forEach(p=>{i.has(p)||l.push(p)}),this.documentOverlayCache.getOverlays(n,l).next(p=>{p.forEach((_,T)=>{i.set(_,T)})})}computeViews(n,i,a,l){let p=mp();const _=$w(),T=function(){return $w()}();return i.forEach((w,C)=>{const O=a.get(C.key);l.has(C.key)&&(O===void 0||O.mutation instanceof lm)?p=p.insert(C.key,C):O!==void 0?(_.set(C.key,O.mutation.getFieldMask()),Jw(O.mutation,C,O.mutation.getFieldMask(),ha.now())):_.set(C.key,Uc.empty())}),this.recalculateAndSaveOverlays(n,p).next(w=>(w.forEach((C,O)=>_.set(C,O)),i.forEach((C,O)=>{var k;return T.set(C,new y_e(O,(k=_.get(C))!==null&&k!==void 0?k:null))}),T))}recalculateAndSaveOverlays(n,i){const a=$w();let l=new ps((_,T)=>_-T),p=Rr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(n,i).next(_=>{for(const T of _)T.keys().forEach(w=>{const C=i.get(w);if(C===null)return;let O=a.get(w)||Uc.empty();O=T.applyToLocalView(C,O),a.set(w,O);const k=(l.get(T.batchId)||Rr()).add(w);l=l.insert(T.batchId,k)})}).next(()=>{const _=[],T=l.getReverseIterator();for(;T.hasNext();){const w=T.getNext(),C=w.key,O=w.value,k=f7();O.forEach(U=>{if(!p.has(U)){const G=v7(i.get(U),a.get(U));G!==null&&k.set(U,G),p=p.add(U)}}),_.push(this.documentOverlayCache.saveOverlays(n,C,k))}return Et.waitFor(_)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(n,i){return this.remoteDocumentCache.getEntries(n,i).next(a=>this.recalculateAndSaveOverlays(n,a))}getDocumentsMatchingQuery(n,i,a,l){return function(_){return Tn.isDocumentKey(_.path)&&_.collectionGroup===null&&_.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(n,i.path):l7(i)?this.getDocumentsMatchingCollectionGroupQuery(n,i,a,l):this.getDocumentsMatchingCollectionQuery(n,i,a,l)}getNextDocuments(n,i,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(n,i,a,l).next(p=>{const _=l-p.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(n,i,a.largestBatchId,l-p.size):Et.resolve(__());let T=o0,w=p;return _.next(C=>Et.forEach(C,(O,k)=>(T<k.largestBatchId&&(T=k.largestBatchId),p.get(O)?Et.resolve():this.remoteDocumentCache.getEntry(n,O).next(U=>{w=w.insert(O,U)}))).next(()=>this.populateOverlays(n,C,p)).next(()=>this.computeViews(n,w,C,Rr())).next(O=>({batchId:T,changes:p7(O)})))})}getDocumentsMatchingDocumentQuery(n,i){return this.getDocument(n,new Tn(i)).next(a=>{let l=Pw();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(n,i,a,l){const p=i.collectionGroup;let _=Pw();return this.indexManager.getCollectionParents(n,p).next(T=>Et.forEach(T,w=>{const C=function(k,U){return new lS(U,null,k.explicitOrderBy.slice(),k.filters.slice(),k.limit,k.limitType,k.startAt,k.endAt)}(i,w.child(p));return this.getDocumentsMatchingCollectionQuery(n,C,a,l).next(O=>{O.forEach((k,U)=>{_=_.insert(k,U)})})}).next(()=>_))}getDocumentsMatchingCollectionQuery(n,i,a,l){let p;return this.documentOverlayCache.getOverlaysForCollection(n,i.path,a.largestBatchId).next(_=>(p=_,this.remoteDocumentCache.getDocumentsMatchingQuery(n,i,a,p,l))).next(_=>{p.forEach((w,C)=>{const O=C.getKey();_.get(O)===null&&(_=_.insert(O,uo.newInvalidDocument(O)))});let T=Pw();return _.forEach((w,C)=>{const O=p.get(w);O!==void 0&&Jw(O.mutation,C,Uc.empty(),ha.now()),vD(i,C)&&(T=T.insert(w,C))}),T})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S_e{constructor(n){this.serializer=n,this.Fr=new Map,this.Mr=new Map}getBundleMetadata(n,i){return Et.resolve(this.Fr.get(i))}saveBundleMetadata(n,i){return this.Fr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:Bu(l.createTime)}}(i)),Et.resolve()}getNamedQuery(n,i){return Et.resolve(this.Mr.get(i))}saveNamedQuery(n,i){return this.Mr.set(i.name,function(l){return{name:l.name,query:d_e(l.bundledQuery),readTime:Bu(l.readTime)}}(i)),Et.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T_e{constructor(){this.overlays=new ps(Tn.comparator),this.Or=new Map}getOverlay(n,i){return Et.resolve(this.overlays.get(i))}getOverlays(n,i){const a=__();return Et.forEach(i,l=>this.getOverlay(n,l).next(p=>{p!==null&&a.set(l,p)})).next(()=>a)}saveOverlays(n,i,a){return a.forEach((l,p)=>{this.St(n,i,p)}),Et.resolve()}removeOverlaysForBatchId(n,i,a){const l=this.Or.get(a);return l!==void 0&&(l.forEach(p=>this.overlays=this.overlays.remove(p)),this.Or.delete(a)),Et.resolve()}getOverlaysForCollection(n,i,a){const l=__(),p=i.length+1,_=new Tn(i.child("")),T=this.overlays.getIteratorFrom(_);for(;T.hasNext();){const w=T.getNext().value,C=w.getKey();if(!i.isPrefixOf(C.path))break;C.path.length===p&&w.largestBatchId>a&&l.set(w.getKey(),w)}return Et.resolve(l)}getOverlaysForCollectionGroup(n,i,a,l){let p=new ps((C,O)=>C-O);const _=this.overlays.getIterator();for(;_.hasNext();){const C=_.getNext().value;if(C.getKey().getCollectionGroup()===i&&C.largestBatchId>a){let O=p.get(C.largestBatchId);O===null&&(O=__(),p=p.insert(C.largestBatchId,O)),O.set(C.getKey(),C)}}const T=__(),w=p.getIterator();for(;w.hasNext()&&(w.getNext().value.forEach((C,O)=>T.set(C,O)),!(T.size()>=l)););return Et.resolve(T)}St(n,i,a){const l=this.overlays.get(a.key);if(l!==null){const _=this.Or.get(l.largestBatchId).delete(a.key);this.Or.set(l.largestBatchId,_)}this.overlays=this.overlays.insert(a.key,new Bge(i,a));let p=this.Or.get(i);p===void 0&&(p=Rr(),this.Or.set(i,p)),this.Or.set(i,p.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b_e{constructor(){this.sessionToken=Wa.EMPTY_BYTE_STRING}getSessionToken(n){return Et.resolve(this.sessionToken)}setSessionToken(n,i){return this.sessionToken=i,Et.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yj{constructor(){this.Nr=new pa(ba.Br),this.Lr=new pa(ba.kr)}isEmpty(){return this.Nr.isEmpty()}addReference(n,i){const a=new ba(n,i);this.Nr=this.Nr.add(a),this.Lr=this.Lr.add(a)}qr(n,i){n.forEach(a=>this.addReference(a,i))}removeReference(n,i){this.Qr(new ba(n,i))}$r(n,i){n.forEach(a=>this.removeReference(a,i))}Ur(n){const i=new Tn(new Gi([])),a=new ba(i,n),l=new ba(i,n+1),p=[];return this.Lr.forEachInRange([a,l],_=>{this.Qr(_),p.push(_.key)}),p}Kr(){this.Nr.forEach(n=>this.Qr(n))}Qr(n){this.Nr=this.Nr.delete(n),this.Lr=this.Lr.delete(n)}Wr(n){const i=new Tn(new Gi([])),a=new ba(i,n),l=new ba(i,n+1);let p=Rr();return this.Lr.forEachInRange([a,l],_=>{p=p.add(_.key)}),p}containsKey(n){const i=new ba(n,0),a=this.Nr.firstAfterOrEqual(i);return a!==null&&n.isEqual(a.key)}}class ba{constructor(n,i){this.key=n,this.Gr=i}static Br(n,i){return Tn.comparator(n.key,i.key)||gr(n.Gr,i.Gr)}static kr(n,i){return gr(n.Gr,i.Gr)||Tn.comparator(n.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w_e{constructor(n,i){this.indexManager=n,this.referenceDelegate=i,this.mutationQueue=[],this.Jn=1,this.zr=new pa(ba.Br)}checkEmpty(n){return Et.resolve(this.mutationQueue.length===0)}addMutationBatch(n,i,a,l){const p=this.Jn;this.Jn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const _=new Fge(p,i,a,l);this.mutationQueue.push(_);for(const T of l)this.zr=this.zr.add(new ba(T.key,p)),this.indexManager.addToCollectionParentIndex(n,T.key.path.popLast());return Et.resolve(_)}lookupMutationBatch(n,i){return Et.resolve(this.jr(i))}getNextMutationBatchAfterBatchId(n,i){const a=i+1,l=this.Hr(a),p=l<0?0:l;return Et.resolve(this.mutationQueue.length>p?this.mutationQueue[p]:null)}getHighestUnacknowledgedBatchId(){return Et.resolve(this.mutationQueue.length===0?cj:this.Jn-1)}getAllMutationBatches(n){return Et.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(n,i){const a=new ba(i,0),l=new ba(i,Number.POSITIVE_INFINITY),p=[];return this.zr.forEachInRange([a,l],_=>{const T=this.jr(_.Gr);p.push(T)}),Et.resolve(p)}getAllMutationBatchesAffectingDocumentKeys(n,i){let a=new pa(gr);return i.forEach(l=>{const p=new ba(l,0),_=new ba(l,Number.POSITIVE_INFINITY);this.zr.forEachInRange([p,_],T=>{a=a.add(T.Gr)})}),Et.resolve(this.Jr(a))}getAllMutationBatchesAffectingQuery(n,i){const a=i.path,l=a.length+1;let p=a;Tn.isDocumentKey(p)||(p=p.child(""));const _=new ba(new Tn(p),0);let T=new pa(gr);return this.zr.forEachWhile(w=>{const C=w.key.path;return!!a.isPrefixOf(C)&&(C.length===l&&(T=T.add(w.Gr)),!0)},_),Et.resolve(this.Jr(T))}Jr(n){const i=[];return n.forEach(a=>{const l=this.jr(a);l!==null&&i.push(l)}),i}removeMutationBatch(n,i){ui(this.Yr(i.batchId,"removed")===0,55003),this.mutationQueue.shift();let a=this.zr;return Et.forEach(i.mutations,l=>{const p=new ba(l.key,i.batchId);return a=a.delete(p),this.referenceDelegate.markPotentiallyOrphaned(n,l.key)}).next(()=>{this.zr=a})}Xn(n){}containsKey(n,i){const a=new ba(i,0),l=this.zr.firstAfterOrEqual(a);return Et.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(n){return this.mutationQueue.length,Et.resolve()}Yr(n,i){return this.Hr(n)}Hr(n){return this.mutationQueue.length===0?0:n-this.mutationQueue[0].batchId}jr(n){const i=this.Hr(n);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R_e{constructor(n){this.Zr=n,this.docs=function(){return new ps(Tn.comparator)}(),this.size=0}setIndexManager(n){this.indexManager=n}addEntry(n,i){const a=i.key,l=this.docs.get(a),p=l?l.size:0,_=this.Zr(i);return this.docs=this.docs.insert(a,{document:i.mutableCopy(),size:_}),this.size+=_-p,this.indexManager.addToCollectionParentIndex(n,a.path.popLast())}removeEntry(n){const i=this.docs.get(n);i&&(this.docs=this.docs.remove(n),this.size-=i.size)}getEntry(n,i){const a=this.docs.get(i);return Et.resolve(a?a.document.mutableCopy():uo.newInvalidDocument(i))}getEntries(n,i){let a=mp();return i.forEach(l=>{const p=this.docs.get(l);a=a.insert(l,p?p.document.mutableCopy():uo.newInvalidDocument(l))}),Et.resolve(a)}getDocumentsMatchingQuery(n,i,a,l){let p=mp();const _=i.path,T=new Tn(_.child("__id-9223372036854775808__")),w=this.docs.getIteratorFrom(T);for(;w.hasNext();){const{key:C,value:{document:O}}=w.getNext();if(!_.isPrefixOf(C.path))break;C.path.length>_.length+1||tge(ege(O),a)<=0||(l.has(O.key)||vD(i,O))&&(p=p.insert(O.key,O.mutableCopy()))}return Et.resolve(p)}getAllFromCollectionGroup(n,i,a,l){Ln(9500)}Xr(n,i){return Et.forEach(this.docs,a=>i(a))}newChangeBuffer(n){return new C_e(this)}getSize(n){return Et.resolve(this.size)}}class C_e extends E_e{constructor(n){super(),this.vr=n}applyChanges(n){const i=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?i.push(this.vr.addEntry(n,l)):this.vr.removeEntry(a)}),Et.waitFor(i)}getFromCache(n,i){return this.vr.getEntry(n,i)}getAllFromCache(n,i){return this.vr.getEntries(n,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A_e{constructor(n){this.persistence=n,this.ei=new F_(i=>uj(i),hj),this.lastRemoteSnapshotVersion=Gn.min(),this.highestTargetId=0,this.ti=0,this.ni=new yj,this.targetCount=0,this.ri=Wv.rr()}forEachTarget(n,i){return this.ei.forEach((a,l)=>i(l)),Et.resolve()}getLastRemoteSnapshotVersion(n){return Et.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(n){return Et.resolve(this.ti)}allocateTargetId(n){return this.highestTargetId=this.ri.next(),Et.resolve(this.highestTargetId)}setTargetsMetadata(n,i,a){return a&&(this.lastRemoteSnapshotVersion=a),i>this.ti&&(this.ti=i),Et.resolve()}ar(n){this.ei.set(n.target,n);const i=n.targetId;i>this.highestTargetId&&(this.ri=new Wv(i),this.highestTargetId=i),n.sequenceNumber>this.ti&&(this.ti=n.sequenceNumber)}addTargetData(n,i){return this.ar(i),this.targetCount+=1,Et.resolve()}updateTargetData(n,i){return this.ar(i),Et.resolve()}removeTargetData(n,i){return this.ei.delete(i.target),this.ni.Ur(i.targetId),this.targetCount-=1,Et.resolve()}removeTargets(n,i,a){let l=0;const p=[];return this.ei.forEach((_,T)=>{T.sequenceNumber<=i&&a.get(T.targetId)===null&&(this.ei.delete(_),p.push(this.removeMatchingKeysForTargetId(n,T.targetId)),l++)}),Et.waitFor(p).next(()=>l)}getTargetCount(n){return Et.resolve(this.targetCount)}getTargetData(n,i){const a=this.ei.get(i)||null;return Et.resolve(a)}addMatchingKeys(n,i,a){return this.ni.qr(i,a),Et.resolve()}removeMatchingKeys(n,i,a){this.ni.$r(i,a);const l=this.persistence.referenceDelegate,p=[];return l&&i.forEach(_=>{p.push(l.markPotentiallyOrphaned(n,_))}),Et.waitFor(p)}removeMatchingKeysForTargetId(n,i){return this.ni.Ur(i),Et.resolve()}getMatchingKeysForTargetId(n,i){const a=this.ni.Wr(i);return Et.resolve(a)}containsKey(n,i){return Et.resolve(this.ni.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P7{constructor(n,i){this.ii={},this.overlays={},this.si=new gD(0),this.oi=!1,this.oi=!0,this._i=new b_e,this.referenceDelegate=n(this),this.ai=new A_e(this),this.indexManager=new u_e,this.remoteDocumentCache=function(l){return new R_e(l)}(a=>this.referenceDelegate.ui(a)),this.serializer=new l_e(i),this.ci=new S_e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.oi=!1,Promise.resolve()}get started(){return this.oi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(n){return this.indexManager}getDocumentOverlayCache(n){let i=this.overlays[n.toKey()];return i||(i=new T_e,this.overlays[n.toKey()]=i),i}getMutationQueue(n,i){let a=this.ii[n.toKey()];return a||(a=new w_e(i,this.referenceDelegate),this.ii[n.toKey()]=a),a}getGlobalsCache(){return this._i}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.ci}runTransaction(n,i,a){Qt("MemoryPersistence","Starting transaction:",n);const l=new I_e(this.si.next());return this.referenceDelegate.li(),a(l).next(p=>this.referenceDelegate.hi(l).next(()=>p)).toPromise().then(p=>(l.raiseOnCommittedEvent(),p))}Pi(n,i){return Et.or(Object.values(this.ii).map(a=>()=>a.containsKey(n,i)))}}class I_e extends rge{constructor(n){super(),this.currentSequenceNumber=n}}class vj{constructor(n){this.persistence=n,this.Ti=new yj,this.Ii=null}static Ei(n){return new vj(n)}get di(){if(this.Ii)return this.Ii;throw Ln(60996)}addReference(n,i,a){return this.Ti.addReference(a,i),this.di.delete(a.toString()),Et.resolve()}removeReference(n,i,a){return this.Ti.removeReference(a,i),this.di.add(a.toString()),Et.resolve()}markPotentiallyOrphaned(n,i){return this.di.add(i.toString()),Et.resolve()}removeTarget(n,i){this.Ti.Ur(i.targetId).forEach(l=>this.di.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(n,i.targetId).next(l=>{l.forEach(p=>this.di.add(p.toString()))}).next(()=>a.removeTargetData(n,i))}li(){this.Ii=new Set}hi(n){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Et.forEach(this.di,a=>{const l=Tn.fromPath(a);return this.Ai(n,l).next(p=>{p||i.removeEntry(l,Gn.min())})}).next(()=>(this.Ii=null,i.apply(n)))}updateLimboDocument(n,i){return this.Ai(n,i).next(a=>{a?this.di.delete(i.toString()):this.di.add(i.toString())})}ui(n){return 0}Ai(n,i){return Et.or([()=>Et.resolve(this.Ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(n,i),()=>this.persistence.Pi(n,i)])}}class PO{constructor(n,i){this.persistence=n,this.Ri=new F_(a=>age(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=__e(this,i)}static Ei(n,i){return new PO(n,i)}li(){}hi(n){return Et.resolve()}forEachTarget(n,i){return this.persistence.getTargetCache().forEachTarget(n,i)}dr(n){const i=this.Vr(n);return this.persistence.getTargetCache().getTargetCount(n).next(a=>i.next(l=>a+l))}Vr(n){let i=0;return this.Ar(n,a=>{i++}).next(()=>i)}Ar(n,i){return Et.forEach(this.Ri,(a,l)=>this.gr(n,a,l).next(p=>p?Et.resolve():i(l)))}removeTargets(n,i,a){return this.persistence.getTargetCache().removeTargets(n,i,a)}removeOrphanedDocuments(n,i){let a=0;const l=this.persistence.getRemoteDocumentCache(),p=l.newChangeBuffer();return l.Xr(n,_=>this.gr(n,_,i).next(T=>{T||(a++,p.removeEntry(_,Gn.min()))})).next(()=>p.apply(n)).next(()=>a)}markPotentiallyOrphaned(n,i){return this.Ri.set(i,n.currentSequenceNumber),Et.resolve()}removeTarget(n,i){const a=i.withSequenceNumber(n.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(n,a)}addReference(n,i,a){return this.Ri.set(a,n.currentSequenceNumber),Et.resolve()}removeReference(n,i,a){return this.Ri.set(a,n.currentSequenceNumber),Et.resolve()}updateLimboDocument(n,i){return this.Ri.set(i,n.currentSequenceNumber),Et.resolve()}ui(n){let i=n.key.toString().length;return n.isFoundDocument()&&(i+=JN(n.data.value)),i}gr(n,i,a){return Et.or([()=>this.persistence.Pi(n,i),()=>this.persistence.getTargetCache().containsKey(n,i),()=>{const l=this.Ri.get(i);return Et.resolve(l!==void 0&&l>a)}])}getCacheSize(n){return this.persistence.getRemoteDocumentCache().getSize(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sj{constructor(n,i,a,l){this.targetId=n,this.fromCache=i,this.ls=a,this.hs=l}static Ps(n,i){let a=Rr(),l=Rr();for(const p of i.docChanges)switch(p.type){case 0:a=a.add(p.doc.key);break;case 1:l=l.add(p.doc.key)}return new Sj(n,i.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N_e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(n){this._documentReadCount+=n}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O_e{constructor(){this.Ts=!1,this.Is=!1,this.Es=100,this.ds=function(){return Ofe()?8:ige(Ife())>0?6:4}()}initialize(n,i){this.As=n,this.indexManager=i,this.Ts=!0}getDocumentsMatchingQuery(n,i,a,l){const p={result:null};return this.Rs(n,i).next(_=>{p.result=_}).next(()=>{if(!p.result)return this.Vs(n,i,l,a).next(_=>{p.result=_})}).next(()=>{if(p.result)return;const _=new N_e;return this.fs(n,i,_).next(T=>{if(p.result=T,this.Is)return this.gs(n,i,_,T.size)})}).next(()=>p.result)}gs(n,i,a,l){return a.documentReadCount<this.Es?(wv()<=Mr.DEBUG&&Qt("QueryEngine","SDK will not create cache indexes for query:",Rv(i),"since it only creates cache indexes for collection contains","more than or equal to",this.Es,"documents"),Et.resolve()):(wv()<=Mr.DEBUG&&Qt("QueryEngine","Query:",Rv(i),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ds*l?(wv()<=Mr.DEBUG&&Qt("QueryEngine","The SDK decides to create cache indexes for query:",Rv(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(n,Fu(i))):Et.resolve())}Rs(n,i){if(nz(i))return Et.resolve(null);let a=Fu(i);return this.indexManager.getIndexType(n,a).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=f2(i,null,"F"),a=Fu(i)),this.indexManager.getDocumentsMatchingTarget(n,a).next(p=>{const _=Rr(...p);return this.As.getDocuments(n,_).next(T=>this.indexManager.getMinOffset(n,a).next(w=>{const C=this.ps(i,T);return this.ys(i,C,_,w.readTime)?this.Rs(n,f2(i,null,"F")):this.ws(n,C,i,w)}))})))}Vs(n,i,a,l){return nz(i)||l.isEqual(Gn.min())?Et.resolve(null):this.As.getDocuments(n,a).next(p=>{const _=this.ps(i,p);return this.ys(i,_,a,l)?Et.resolve(null):(wv()<=Mr.DEBUG&&Qt("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),Rv(i)),this.ws(n,_,i,Zme(l,o0)).next(T=>T))})}ps(n,i){let a=new pa(u7(n));return i.forEach((l,p)=>{vD(n,p)&&(a=a.add(p))}),a}ys(n,i,a,l){if(n.limit===null)return!1;if(a.size!==i.size)return!0;const p=n.limitType==="F"?i.last():i.first();return!!p&&(p.hasPendingWrites||p.version.compareTo(l)>0)}fs(n,i,a){return wv()<=Mr.DEBUG&&Qt("QueryEngine","Using full collection scan to execute query:",Rv(i)),this.As.getDocumentsMatchingQuery(n,i,Zf.min(),a)}ws(n,i,a,l){return this.As.getDocumentsMatchingQuery(n,a,l).next(p=>(i.forEach(_=>{p=p.insert(_.key,_)}),p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tj="LocalStore",D_e=3e8;class x_e{constructor(n,i,a,l){this.persistence=n,this.bs=i,this.serializer=l,this.Ss=new ps(gr),this.Ds=new F_(p=>uj(p),hj),this.vs=new Map,this.Cs=n.getRemoteDocumentCache(),this.ai=n.getTargetCache(),this.ci=n.getBundleCache(),this.Fs(a)}Fs(n){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(n),this.indexManager=this.persistence.getIndexManager(n),this.mutationQueue=this.persistence.getMutationQueue(n,this.indexManager),this.localDocuments=new v_e(this.Cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Cs.setIndexManager(this.indexManager),this.bs.initialize(this.localDocuments,this.indexManager)}collectGarbage(n){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>n.collect(i,this.Ss))}}function P_e(s,n,i,a){return new x_e(s,n,i,a)}async function k7(s,n){const i=zn(s);return await i.persistence.runTransaction("Handle user change","readonly",a=>{let l;return i.mutationQueue.getAllMutationBatches(a).next(p=>(l=p,i.Fs(n),i.mutationQueue.getAllMutationBatches(a))).next(p=>{const _=[],T=[];let w=Rr();for(const C of l){_.push(C.batchId);for(const O of C.mutations)w=w.add(O.key)}for(const C of p){T.push(C.batchId);for(const O of C.mutations)w=w.add(O.key)}return i.localDocuments.getDocuments(a,w).next(C=>({Ms:C,removedBatchIds:_,addedBatchIds:T}))})})}function k_e(s,n){const i=zn(s);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=n.batch.keys(),p=i.Cs.newChangeBuffer({trackRemovals:!0});return function(T,w,C,O){const k=C.batch,U=k.keys();let G=Et.resolve();return U.forEach(z=>{G=G.next(()=>O.getEntry(w,z)).next(J=>{const X=C.docVersions.get(z);ui(X!==null,48541),J.version.compareTo(X)<0&&(k.applyToRemoteDocument(J,C),J.isValidDocument()&&(J.setReadTime(C.commitVersion),O.addEntry(J)))})}),G.next(()=>T.mutationQueue.removeMutationBatch(w,k))}(i,a,n,p).next(()=>p.apply(a)).next(()=>i.mutationQueue.performConsistencyCheck(a)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(a,l,n.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(T){let w=Rr();for(let C=0;C<T.mutationResults.length;++C)T.mutationResults[C].transformResults.length>0&&(w=w.add(T.batch.mutations[C].key));return w}(n))).next(()=>i.localDocuments.getDocuments(a,l))})}function L7(s){const n=zn(s);return n.persistence.runTransaction("Get last remote snapshot version","readonly",i=>n.ai.getLastRemoteSnapshotVersion(i))}function L_e(s,n){const i=zn(s),a=n.snapshotVersion;let l=i.Ss;return i.persistence.runTransaction("Apply remote event","readwrite-primary",p=>{const _=i.Cs.newChangeBuffer({trackRemovals:!0});l=i.Ss;const T=[];n.targetChanges.forEach((O,k)=>{const U=l.get(k);if(!U)return;T.push(i.ai.removeMatchingKeys(p,O.removedDocuments,k).next(()=>i.ai.addMatchingKeys(p,O.addedDocuments,k)));let G=U.withSequenceNumber(p.currentSequenceNumber);n.targetMismatches.get(k)!==null?G=G.withResumeToken(Wa.EMPTY_BYTE_STRING,Gn.min()).withLastLimboFreeSnapshotVersion(Gn.min()):O.resumeToken.approximateByteSize()>0&&(G=G.withResumeToken(O.resumeToken,a)),l=l.insert(k,G),function(J,X,ie){return J.resumeToken.approximateByteSize()===0||X.snapshotVersion.toMicroseconds()-J.snapshotVersion.toMicroseconds()>=D_e?!0:ie.addedDocuments.size+ie.modifiedDocuments.size+ie.removedDocuments.size>0}(U,G,O)&&T.push(i.ai.updateTargetData(p,G))});let w=mp(),C=Rr();if(n.documentUpdates.forEach(O=>{n.resolvedLimboDocuments.has(O)&&T.push(i.persistence.referenceDelegate.updateLimboDocument(p,O))}),T.push(M_e(p,_,n.documentUpdates).next(O=>{w=O.xs,C=O.Os})),!a.isEqual(Gn.min())){const O=i.ai.getLastRemoteSnapshotVersion(p).next(k=>i.ai.setTargetsMetadata(p,p.currentSequenceNumber,a));T.push(O)}return Et.waitFor(T).next(()=>_.apply(p)).next(()=>i.localDocuments.getLocalViewOfDocuments(p,w,C)).next(()=>w)}).then(p=>(i.Ss=l,p))}function M_e(s,n,i){let a=Rr(),l=Rr();return i.forEach(p=>a=a.add(p)),n.getEntries(s,a).next(p=>{let _=mp();return i.forEach((T,w)=>{const C=p.get(T);w.isFoundDocument()!==C.isFoundDocument()&&(l=l.add(T)),w.isNoDocument()&&w.version.isEqual(Gn.min())?(n.removeEntry(T,w.readTime),_=_.insert(T,w)):!C.isValidDocument()||w.version.compareTo(C.version)>0||w.version.compareTo(C.version)===0&&C.hasPendingWrites?(n.addEntry(w),_=_.insert(T,w)):Qt(Tj,"Ignoring outdated watch update for ",T,". Current version:",C.version," Watch version:",w.version)}),{xs:_,Os:l}})}function j_e(s,n){const i=zn(s);return i.persistence.runTransaction("Get next mutation batch","readonly",a=>(n===void 0&&(n=cj),i.mutationQueue.getNextMutationBatchAfterBatchId(a,n)))}function U_e(s,n){const i=zn(s);return i.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return i.ai.getTargetData(a,n).next(p=>p?(l=p,Et.resolve(l)):i.ai.allocateTargetId(a).next(_=>(l=new Gf(n,_,"TargetPurposeListen",a.currentSequenceNumber),i.ai.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=i.Ss.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ss=i.Ss.insert(a.targetId,a),i.Ds.set(n,a.targetId)),a})}async function y2(s,n,i){const a=zn(s),l=a.Ss.get(n),p=i?"readwrite":"readwrite-primary";try{i||await a.persistence.runTransaction("Release target",p,_=>a.persistence.referenceDelegate.removeTarget(_,l))}catch(_){if(!cS(_))throw _;Qt(Tj,`Failed to update sequence numbers for target ${n}: ${_}`)}a.Ss=a.Ss.remove(n),a.Ds.delete(l.target)}function mz(s,n,i){const a=zn(s);let l=Gn.min(),p=Rr();return a.persistence.runTransaction("Execute query","readwrite",_=>function(w,C,O){const k=zn(w),U=k.Ds.get(O);return U!==void 0?Et.resolve(k.Ss.get(U)):k.ai.getTargetData(C,O)}(a,_,Fu(n)).next(T=>{if(T)return l=T.lastLimboFreeSnapshotVersion,a.ai.getMatchingKeysForTargetId(_,T.targetId).next(w=>{p=w})}).next(()=>a.bs.getDocumentsMatchingQuery(_,n,i?l:Gn.min(),i?p:Rr())).next(T=>(V_e(a,Rge(n),T),{documents:T,Ns:p})))}function V_e(s,n,i){let a=s.vs.get(n)||Gn.min();i.forEach((l,p)=>{p.readTime.compareTo(a)>0&&(a=p.readTime)}),s.vs.set(n,a)}class gz{constructor(){this.activeTargetIds=Dge()}$s(n){this.activeTargetIds=this.activeTargetIds.add(n)}Us(n){this.activeTargetIds=this.activeTargetIds.delete(n)}Qs(){const n={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(n)}}class F_e{constructor(){this.So=new gz,this.Do={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(n){}updateMutationState(n,i,a){}addLocalQueryTarget(n,i=!0){return i&&this.So.$s(n),this.Do[n]||"not-current"}updateQueryState(n,i,a){this.Do[n]=i}removeLocalQueryTarget(n){this.So.Us(n)}isLocalQueryTarget(n){return this.So.activeTargetIds.has(n)}clearQueryState(n){delete this.Do[n]}getAllActiveQueryTargets(){return this.So.activeTargetIds}isActiveQueryTarget(n){return this.So.activeTargetIds.has(n)}start(){return this.So=new gz,Promise.resolve()}handleUserChange(n,i,a){}setOnlineState(n){}shutdown(){}writeSequenceNumber(n){}notifyBundleLoaded(n){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B_e{vo(n){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _z="ConnectivityMonitor";class Ez{constructor(){this.Co=()=>this.Fo(),this.Mo=()=>this.xo(),this.Oo=[],this.No()}vo(n){this.Oo.push(n)}shutdown(){window.removeEventListener("online",this.Co),window.removeEventListener("offline",this.Mo)}No(){window.addEventListener("online",this.Co),window.addEventListener("offline",this.Mo)}Fo(){Qt(_z,"Network connectivity changed: AVAILABLE");for(const n of this.Oo)n(0)}xo(){Qt(_z,"Network connectivity changed: UNAVAILABLE");for(const n of this.Oo)n(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let aN=null;function v2(){return aN===null?aN=function(){return 268435456+Math.round(2147483648*Math.random())}():aN++,"0x"+aN.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aM="RestConnection",H_e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class G_e{get Bo(){return!1}constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const i=n.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.Lo=i+"://"+n.host,this.ko=`projects/${a}/databases/${l}`,this.qo=this.databaseId.database===AO?`project_id=${a}`:`project_id=${a}&database_id=${l}`}Qo(n,i,a,l,p){const _=v2(),T=this.$o(n,i.toUriEncodedString());Qt(aM,`Sending RPC '${n}' ${_}:`,T,a);const w={"google-cloud-resource-prefix":this.ko,"x-goog-request-params":this.qo};return this.Uo(w,l,p),this.Ko(n,T,w,a).then(C=>(Qt(aM,`Received RPC '${n}' ${_}: `,C),C),C=>{throw Fv(aM,`RPC '${n}' ${_} failed with error: `,C,"url: ",T,"request:",a),C})}Wo(n,i,a,l,p,_){return this.Qo(n,i,a,l,p)}Uo(n,i,a){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+aS}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,p)=>n[p]=l),a&&a.headers.forEach((l,p)=>n[p]=l)}$o(n,i){const a=H_e[n];return`${this.Lo}/v1/${i}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W_e{constructor(n){this.Go=n.Go,this.zo=n.zo}jo(n){this.Ho=n}Jo(n){this.Yo=n}Zo(n){this.Xo=n}onMessage(n){this.e_=n}close(){this.zo()}send(n){this.Go(n)}t_(){this.Ho()}n_(){this.Yo()}r_(n){this.Xo(n)}i_(n){this.e_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const co="WebChannelConnection";class z_e extends G_e{constructor(n){super(n),this.forceLongPolling=n.forceLongPolling,this.autoDetectLongPolling=n.autoDetectLongPolling,this.useFetchStreams=n.useFetchStreams,this.longPollingOptions=n.longPollingOptions}Ko(n,i,a,l){const p=v2();return new Promise((_,T)=>{const w=new UK;w.setWithCredentials(!0),w.listenOnce(VK.COMPLETE,()=>{try{switch(w.getLastErrorCode()){case $N.NO_ERROR:const O=w.getResponseJson();Qt(co,`XHR for RPC '${n}' ${p} received:`,JSON.stringify(O)),_(O);break;case $N.TIMEOUT:Qt(co,`RPC '${n}' ${p} timed out`),T(new Jt(_t.DEADLINE_EXCEEDED,"Request time out"));break;case $N.HTTP_ERROR:const k=w.getStatus();if(Qt(co,`RPC '${n}' ${p} failed with status:`,k,"response text:",w.getResponseText()),k>0){let U=w.getResponseJson();Array.isArray(U)&&(U=U[0]);const G=U==null?void 0:U.error;if(G&&G.status&&G.message){const z=function(X){const ie=X.toLowerCase().replace(/_/g,"-");return Object.values(_t).indexOf(ie)>=0?ie:_t.UNKNOWN}(G.status);T(new Jt(z,G.message))}else T(new Jt(_t.UNKNOWN,"Server responded with status "+w.getStatus()))}else T(new Jt(_t.UNAVAILABLE,"Connection failed."));break;default:Ln(9055,{s_:n,streamId:p,o_:w.getLastErrorCode(),__:w.getLastError()})}}finally{Qt(co,`RPC '${n}' ${p} completed.`)}});const C=JSON.stringify(l);Qt(co,`RPC '${n}' ${p} sending request:`,l),w.send(i,"POST",C,a,15)})}a_(n,i,a){const l=v2(),p=[this.Lo,"/","google.firestore.v1.Firestore","/",n,"/channel"],_=HK(),T=BK(),w={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},C=this.longPollingOptions.timeoutSeconds;C!==void 0&&(w.longPollingTimeout=Math.round(1e3*C)),this.useFetchStreams&&(w.useFetchStreams=!0),this.Uo(w.initMessageHeaders,i,a),w.encodeInitMessageHeaders=!0;const O=p.join("");Qt(co,`Creating RPC '${n}' stream ${l}: ${O}`,w);const k=_.createWebChannel(O,w);let U=!1,G=!1;const z=new W_e({Go:X=>{G?Qt(co,`Not sending because RPC '${n}' stream ${l} is closed:`,X):(U||(Qt(co,`Opening RPC '${n}' stream ${l} transport.`),k.open(),U=!0),Qt(co,`RPC '${n}' stream ${l} sending:`,X),k.send(X))},zo:()=>k.close()}),J=(X,ie,oe)=>{X.listen(ie,ce=>{try{oe(ce)}catch(_e){setTimeout(()=>{throw _e},0)}})};return J(k,xw.EventType.OPEN,()=>{G||(Qt(co,`RPC '${n}' stream ${l} transport opened.`),z.t_())}),J(k,xw.EventType.CLOSE,()=>{G||(G=!0,Qt(co,`RPC '${n}' stream ${l} transport closed`),z.r_())}),J(k,xw.EventType.ERROR,X=>{G||(G=!0,Fv(co,`RPC '${n}' stream ${l} transport errored. Name:`,X.name,"Message:",X.message),z.r_(new Jt(_t.UNAVAILABLE,"The operation could not be completed")))}),J(k,xw.EventType.MESSAGE,X=>{var ie;if(!G){const oe=X.data[0];ui(!!oe,16349);const ce=oe,_e=(ce==null?void 0:ce.error)||((ie=ce[0])===null||ie===void 0?void 0:ie.error);if(_e){Qt(co,`RPC '${n}' stream ${l} received error:`,_e);const se=_e.status;let be=function(q){const ae=Zs[q];if(ae!==void 0)return T7(ae)}(se),ee=_e.message;be===void 0&&(be=_t.INTERNAL,ee="Unknown error status: "+se+" with message "+_e.message),G=!0,z.r_(new Jt(be,ee)),k.close()}else Qt(co,`RPC '${n}' stream ${l} received:`,oe),z.i_(oe)}}),J(T,FK.STAT_EVENT,X=>{X.stat===o2.PROXY?Qt(co,`RPC '${n}' stream ${l} detected buffering proxy`):X.stat===o2.NOPROXY&&Qt(co,`RPC '${n}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{z.n_()},0),z}}function oM(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wD(s){return new Xge(s,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M7{constructor(n,i,a=1e3,l=1.5,p=6e4){this.bi=n,this.timerId=i,this.u_=a,this.c_=l,this.l_=p,this.h_=0,this.P_=null,this.T_=Date.now(),this.reset()}reset(){this.h_=0}I_(){this.h_=this.l_}E_(n){this.cancel();const i=Math.floor(this.h_+this.d_()),a=Math.max(0,Date.now()-this.T_),l=Math.max(0,i-a);l>0&&Qt("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.h_} ms, delay with jitter: ${i} ms, last attempt: ${a} ms ago)`),this.P_=this.bi.enqueueAfterDelay(this.timerId,l,()=>(this.T_=Date.now(),n())),this.h_*=this.c_,this.h_<this.u_&&(this.h_=this.u_),this.h_>this.l_&&(this.h_=this.l_)}A_(){this.P_!==null&&(this.P_.skipDelay(),this.P_=null)}cancel(){this.P_!==null&&(this.P_.cancel(),this.P_=null)}d_(){return(Math.random()-.5)*this.h_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yz="PersistentStream";class j7{constructor(n,i,a,l,p,_,T,w){this.bi=n,this.R_=a,this.V_=l,this.connection=p,this.authCredentialsProvider=_,this.appCheckCredentialsProvider=T,this.listener=w,this.state=0,this.m_=0,this.f_=null,this.g_=null,this.stream=null,this.p_=0,this.y_=new M7(n,i)}w_(){return this.state===1||this.state===5||this.b_()}b_(){return this.state===2||this.state===3}start(){this.p_=0,this.state!==4?this.auth():this.S_()}async stop(){this.w_()&&await this.close(0)}D_(){this.state=0,this.y_.reset()}v_(){this.b_()&&this.f_===null&&(this.f_=this.bi.enqueueAfterDelay(this.R_,6e4,()=>this.C_()))}F_(n){this.M_(),this.stream.send(n)}async C_(){if(this.b_())return this.close(0)}M_(){this.f_&&(this.f_.cancel(),this.f_=null)}x_(){this.g_&&(this.g_.cancel(),this.g_=null)}async close(n,i){this.M_(),this.x_(),this.y_.cancel(),this.m_++,n!==4?this.y_.reset():i&&i.code===_t.RESOURCE_EXHAUSTED?(fp(i.toString()),fp("Using maximum backoff delay to prevent overloading the backend."),this.y_.I_()):i&&i.code===_t.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.O_(),this.stream.close(),this.stream=null),this.state=n,await this.listener.Zo(i)}O_(){}auth(){this.state=1;const n=this.N_(this.m_),i=this.m_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.m_===i&&this.B_(a,l)},a=>{n(()=>{const l=new Jt(_t.UNKNOWN,"Fetching auth token failed: "+a.message);return this.L_(l)})})}B_(n,i){const a=this.N_(this.m_);this.stream=this.k_(n,i),this.stream.jo(()=>{a(()=>this.listener.jo())}),this.stream.Jo(()=>{a(()=>(this.state=2,this.g_=this.bi.enqueueAfterDelay(this.V_,1e4,()=>(this.b_()&&(this.state=3),Promise.resolve())),this.listener.Jo()))}),this.stream.Zo(l=>{a(()=>this.L_(l))}),this.stream.onMessage(l=>{a(()=>++this.p_==1?this.q_(l):this.onNext(l))})}S_(){this.state=5,this.y_.E_(async()=>{this.state=0,this.start()})}L_(n){return Qt(yz,`close with error: ${n}`),this.stream=null,this.close(4,n)}N_(n){return i=>{this.bi.enqueueAndForget(()=>this.m_===n?i():(Qt(yz,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Y_e extends j7{constructor(n,i,a,l,p,_){super(n,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,a,l,_),this.serializer=p}k_(n,i){return this.connection.a_("Listen",n,i)}q_(n){return this.onNext(n)}onNext(n){this.y_.reset();const i=Jge(this.serializer,n),a=function(p){if(!("targetChange"in p))return Gn.min();const _=p.targetChange;return _.targetIds&&_.targetIds.length?Gn.min():_.readTime?Bu(_.readTime):Gn.min()}(n);return this.listener.Q_(i,a)}U_(n){const i={};i.database=E2(this.serializer),i.addTarget=function(p,_){let T;const w=_.target;if(T=h2(w)?{documents:t_e(p,w)}:{query:n_e(p,w).gt},T.targetId=_.targetId,_.resumeToken.approximateByteSize()>0){T.resumeToken=R7(p,_.resumeToken);const C=m2(p,_.expectedCount);C!==null&&(T.expectedCount=C)}else if(_.snapshotVersion.compareTo(Gn.min())>0){T.readTime=xO(p,_.snapshotVersion.toTimestamp());const C=m2(p,_.expectedCount);C!==null&&(T.expectedCount=C)}return T}(this.serializer,n);const a=i_e(this.serializer,n);a&&(i.labels=a),this.F_(i)}K_(n){const i={};i.database=E2(this.serializer),i.removeTarget=n,this.F_(i)}}class q_e extends j7{constructor(n,i,a,l,p,_){super(n,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,a,l,_),this.serializer=p}get W_(){return this.p_>0}start(){this.lastStreamToken=void 0,super.start()}O_(){this.W_&&this.G_([])}k_(n,i){return this.connection.a_("Write",n,i)}q_(n){return ui(!!n.streamToken,31322),this.lastStreamToken=n.streamToken,ui(!n.writeResults||n.writeResults.length===0,55816),this.listener.z_()}onNext(n){ui(!!n.streamToken,12678),this.lastStreamToken=n.streamToken,this.y_.reset();const i=e_e(n.writeResults,n.commitTime),a=Bu(n.commitTime);return this.listener.j_(a,i)}H_(){const n={};n.database=E2(this.serializer),this.F_(n)}G_(n){const i={streamToken:this.lastStreamToken,writes:n.map(a=>Zge(this.serializer,a))};this.F_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K_e{}class X_e extends K_e{constructor(n,i,a,l){super(),this.authCredentials=n,this.appCheckCredentials=i,this.connection=a,this.serializer=l,this.J_=!1}Y_(){if(this.J_)throw new Jt(_t.FAILED_PRECONDITION,"The client has already been terminated.")}Qo(n,i,a,l){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,_])=>this.connection.Qo(n,g2(i,a),l,p,_)).catch(p=>{throw p.name==="FirebaseError"?(p.code===_t.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new Jt(_t.UNKNOWN,p.toString())})}Wo(n,i,a,l,p){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([_,T])=>this.connection.Wo(n,g2(i,a),l,_,T,p)).catch(_=>{throw _.name==="FirebaseError"?(_.code===_t.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),_):new Jt(_t.UNKNOWN,_.toString())})}terminate(){this.J_=!0,this.connection.terminate()}}class Q_e{constructor(n,i){this.asyncQueue=n,this.onlineStateHandler=i,this.state="Unknown",this.Z_=0,this.X_=null,this.ea=!0}ta(){this.Z_===0&&(this.na("Unknown"),this.X_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.X_=null,this.ra("Backend didn't respond within 10 seconds."),this.na("Offline"),Promise.resolve())))}ia(n){this.state==="Online"?this.na("Unknown"):(this.Z_++,this.Z_>=1&&(this.sa(),this.ra(`Connection failed 1 times. Most recent error: ${n.toString()}`),this.na("Offline")))}set(n){this.sa(),this.Z_=0,n==="Online"&&(this.ea=!1),this.na(n)}na(n){n!==this.state&&(this.state=n,this.onlineStateHandler(n))}ra(n){const i=`Could not reach Cloud Firestore backend. ${n}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ea?(fp(i),this.ea=!1):Qt("OnlineStateTracker",i)}sa(){this.X_!==null&&(this.X_.cancel(),this.X_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P_="RemoteStore";class $_e{constructor(n,i,a,l,p){this.localStore=n,this.datastore=i,this.asyncQueue=a,this.remoteSyncer={},this.oa=[],this._a=new Map,this.aa=new Set,this.ua=[],this.ca=p,this.ca.vo(_=>{a.enqueueAndForget(async()=>{B_(this)&&(Qt(P_,"Restarting streams for network reachability change."),await async function(w){const C=zn(w);C.aa.add(4),await A0(C),C.la.set("Unknown"),C.aa.delete(4),await RD(C)}(this))})}),this.la=new Q_e(a,l)}}async function RD(s){if(B_(s))for(const n of s.ua)await n(!0)}async function A0(s){for(const n of s.ua)await n(!1)}function U7(s,n){const i=zn(s);i._a.has(n.targetId)||(i._a.set(n.targetId,n),Cj(i)?Rj(i):dS(i).b_()&&wj(i,n))}function bj(s,n){const i=zn(s),a=dS(i);i._a.delete(n),a.b_()&&V7(i,n),i._a.size===0&&(a.b_()?a.v_():B_(i)&&i.la.set("Unknown"))}function wj(s,n){if(s.ha.Ke(n.targetId),n.resumeToken.approximateByteSize()>0||n.snapshotVersion.compareTo(Gn.min())>0){const i=s.remoteSyncer.getRemoteKeysForTarget(n.targetId).size;n=n.withExpectedCount(i)}dS(s).U_(n)}function V7(s,n){s.ha.Ke(n),dS(s).K_(n)}function Rj(s){s.ha=new zge({getRemoteKeysForTarget:n=>s.remoteSyncer.getRemoteKeysForTarget(n),Rt:n=>s._a.get(n)||null,Pt:()=>s.datastore.serializer.databaseId}),dS(s).start(),s.la.ta()}function Cj(s){return B_(s)&&!dS(s).w_()&&s._a.size>0}function B_(s){return zn(s).aa.size===0}function F7(s){s.ha=void 0}async function J_e(s){s.la.set("Online")}async function Z_e(s){s._a.forEach((n,i)=>{wj(s,n)})}async function eEe(s,n){F7(s),Cj(s)?(s.la.ia(n),Rj(s)):s.la.set("Unknown")}async function tEe(s,n,i){if(s.la.set("Online"),n instanceof w7&&n.state===2&&n.cause)try{await async function(l,p){const _=p.cause;for(const T of p.targetIds)l._a.has(T)&&(await l.remoteSyncer.rejectListen(T,_),l._a.delete(T),l.ha.removeTarget(T))}(s,n)}catch(a){Qt(P_,"Failed to remove targets %s: %s ",n.targetIds.join(","),a),await kO(s,a)}else if(n instanceof tO?s.ha.Xe(n):n instanceof b7?s.ha.ot(n):s.ha.nt(n),!i.isEqual(Gn.min()))try{const a=await L7(s.localStore);i.compareTo(a)>=0&&await function(p,_){const T=p.ha.It(_);return T.targetChanges.forEach((w,C)=>{if(w.resumeToken.approximateByteSize()>0){const O=p._a.get(C);O&&p._a.set(C,O.withResumeToken(w.resumeToken,_))}}),T.targetMismatches.forEach((w,C)=>{const O=p._a.get(w);if(!O)return;p._a.set(w,O.withResumeToken(Wa.EMPTY_BYTE_STRING,O.snapshotVersion)),V7(p,w);const k=new Gf(O.target,w,C,O.sequenceNumber);wj(p,k)}),p.remoteSyncer.applyRemoteEvent(T)}(s,i)}catch(a){Qt(P_,"Failed to raise snapshot:",a),await kO(s,a)}}async function kO(s,n,i){if(!cS(n))throw n;s.aa.add(1),await A0(s),s.la.set("Offline"),i||(i=()=>L7(s.localStore)),s.asyncQueue.enqueueRetryable(async()=>{Qt(P_,"Retrying IndexedDB access"),await i(),s.aa.delete(1),await RD(s)})}function B7(s,n){return n().catch(i=>kO(s,i,n))}async function CD(s){const n=zn(s),i=rm(n);let a=n.oa.length>0?n.oa[n.oa.length-1].batchId:cj;for(;nEe(n);)try{const l=await j_e(n.localStore,a);if(l===null){n.oa.length===0&&i.v_();break}a=l.batchId,rEe(n,l)}catch(l){await kO(n,l)}H7(n)&&G7(n)}function nEe(s){return B_(s)&&s.oa.length<10}function rEe(s,n){s.oa.push(n);const i=rm(s);i.b_()&&i.W_&&i.G_(n.mutations)}function H7(s){return B_(s)&&!rm(s).w_()&&s.oa.length>0}function G7(s){rm(s).start()}async function iEe(s){rm(s).H_()}async function sEe(s){const n=rm(s);for(const i of s.oa)n.G_(i.mutations)}async function aEe(s,n,i){const a=s.oa.shift(),l=gj.from(a,n,i);await B7(s,()=>s.remoteSyncer.applySuccessfulWrite(l)),await CD(s)}async function oEe(s,n){n&&rm(s).W_&&await async function(a,l){if(function(_){return Gge(_)&&_!==_t.ABORTED}(l.code)){const p=a.oa.shift();rm(a).D_(),await B7(a,()=>a.remoteSyncer.rejectFailedWrite(p.batchId,l)),await CD(a)}}(s,n),H7(s)&&G7(s)}async function vz(s,n){const i=zn(s);i.asyncQueue.verifyOperationInProgress(),Qt(P_,"RemoteStore received new credentials");const a=B_(i);i.aa.add(3),await A0(i),a&&i.la.set("Unknown"),await i.remoteSyncer.handleCredentialChange(n),i.aa.delete(3),await RD(i)}async function cEe(s,n){const i=zn(s);n?(i.aa.delete(2),await RD(i)):n||(i.aa.add(2),await A0(i),i.la.set("Unknown"))}function dS(s){return s.Pa||(s.Pa=function(i,a,l){const p=zn(i);return p.Y_(),new Y_e(a,p.connection,p.authCredentials,p.appCheckCredentials,p.serializer,l)}(s.datastore,s.asyncQueue,{jo:J_e.bind(null,s),Jo:Z_e.bind(null,s),Zo:eEe.bind(null,s),Q_:tEe.bind(null,s)}),s.ua.push(async n=>{n?(s.Pa.D_(),Cj(s)?Rj(s):s.la.set("Unknown")):(await s.Pa.stop(),F7(s))})),s.Pa}function rm(s){return s.Ta||(s.Ta=function(i,a,l){const p=zn(i);return p.Y_(),new q_e(a,p.connection,p.authCredentials,p.appCheckCredentials,p.serializer,l)}(s.datastore,s.asyncQueue,{jo:()=>Promise.resolve(),Jo:iEe.bind(null,s),Zo:oEe.bind(null,s),z_:sEe.bind(null,s),j_:aEe.bind(null,s)}),s.ua.push(async n=>{n?(s.Ta.D_(),await CD(s)):(await s.Ta.stop(),s.oa.length>0&&(Qt(P_,`Stopping write stream with ${s.oa.length} pending writes`),s.oa=[]))})),s.Ta}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aj{constructor(n,i,a,l,p){this.asyncQueue=n,this.timerId=i,this.targetTimeMs=a,this.op=l,this.removalCallback=p,this.deferred=new b_,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(_=>{})}get promise(){return this.deferred.promise}static createAndSchedule(n,i,a,l,p){const _=Date.now()+a,T=new Aj(n,i,_,l,p);return T.start(a),T}start(n){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),n)}skipDelay(){return this.handleDelayElapsed()}cancel(n){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Jt(_t.CANCELLED,"Operation cancelled"+(n?": "+n:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(n=>this.deferred.resolve(n))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ij(s,n){if(fp("AsyncQueue",`${n}: ${s}`),cS(s))return new Jt(_t.UNAVAILABLE,`${n}: ${s}`);throw s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kv{static emptySet(n){return new kv(n.comparator)}constructor(n){this.comparator=n?(i,a)=>n(i,a)||Tn.comparator(i.key,a.key):(i,a)=>Tn.comparator(i.key,a.key),this.keyedMap=Pw(),this.sortedSet=new ps(this.comparator)}has(n){return this.keyedMap.get(n)!=null}get(n){return this.keyedMap.get(n)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(n){const i=this.keyedMap.get(n);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((i,a)=>(n(i),!1))}add(n){const i=this.delete(n.key);return i.copy(i.keyedMap.insert(n.key,n),i.sortedSet.insert(n,null))}delete(n){const i=this.get(n);return i?this.copy(this.keyedMap.remove(n),this.sortedSet.remove(i)):this}isEqual(n){if(!(n instanceof kv)||this.size!==n.size)return!1;const i=this.sortedSet.getIterator(),a=n.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,p=a.getNext().key;if(!l.isEqual(p))return!1}return!0}toString(){const n=[];return this.forEach(i=>{n.push(i.toString())}),n.length===0?"DocumentSet ()":`DocumentSet (
  `+n.join(`  
`)+`
)`}copy(n,i){const a=new kv;return a.comparator=this.comparator,a.keyedMap=n,a.sortedSet=i,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sz{constructor(){this.Ia=new ps(Tn.comparator)}track(n){const i=n.doc.key,a=this.Ia.get(i);a?n.type!==0&&a.type===3?this.Ia=this.Ia.insert(i,n):n.type===3&&a.type!==1?this.Ia=this.Ia.insert(i,{type:a.type,doc:n.doc}):n.type===2&&a.type===2?this.Ia=this.Ia.insert(i,{type:2,doc:n.doc}):n.type===2&&a.type===0?this.Ia=this.Ia.insert(i,{type:0,doc:n.doc}):n.type===1&&a.type===0?this.Ia=this.Ia.remove(i):n.type===1&&a.type===2?this.Ia=this.Ia.insert(i,{type:1,doc:a.doc}):n.type===0&&a.type===1?this.Ia=this.Ia.insert(i,{type:2,doc:n.doc}):Ln(63341,{Vt:n,Ea:a}):this.Ia=this.Ia.insert(i,n)}da(){const n=[];return this.Ia.inorderTraversal((i,a)=>{n.push(a)}),n}}class zv{constructor(n,i,a,l,p,_,T,w,C){this.query=n,this.docs=i,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=p,this.fromCache=_,this.syncStateChanged=T,this.excludesMetadataChanges=w,this.hasCachedResults=C}static fromInitialDocuments(n,i,a,l,p){const _=[];return i.forEach(T=>{_.push({type:0,doc:T})}),new zv(n,i,kv.emptySet(i),_,a,l,!0,!1,p)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(n){if(!(this.fromCache===n.fromCache&&this.hasCachedResults===n.hasCachedResults&&this.syncStateChanged===n.syncStateChanged&&this.mutatedKeys.isEqual(n.mutatedKeys)&&yD(this.query,n.query)&&this.docs.isEqual(n.docs)&&this.oldDocs.isEqual(n.oldDocs)))return!1;const i=this.docChanges,a=n.docChanges;if(i.length!==a.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==a[l].type||!i[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lEe{constructor(){this.Aa=void 0,this.Ra=[]}Va(){return this.Ra.some(n=>n.ma())}}class dEe{constructor(){this.queries=Tz(),this.onlineState="Unknown",this.fa=new Set}terminate(){(function(i,a){const l=zn(i),p=l.queries;l.queries=Tz(),p.forEach((_,T)=>{for(const w of T.Ra)w.onError(a)})})(this,new Jt(_t.ABORTED,"Firestore shutting down"))}}function Tz(){return new F_(s=>d7(s),yD)}async function uEe(s,n){const i=zn(s);let a=3;const l=n.query;let p=i.queries.get(l);p?!p.Va()&&n.ma()&&(a=2):(p=new lEe,a=n.ma()?0:1);try{switch(a){case 0:p.Aa=await i.onListen(l,!0);break;case 1:p.Aa=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(_){const T=Ij(_,`Initialization of query '${Rv(n.query)}' failed`);return void n.onError(T)}i.queries.set(l,p),p.Ra.push(n),n.ga(i.onlineState),p.Aa&&n.pa(p.Aa)&&Nj(i)}async function hEe(s,n){const i=zn(s),a=n.query;let l=3;const p=i.queries.get(a);if(p){const _=p.Ra.indexOf(n);_>=0&&(p.Ra.splice(_,1),p.Ra.length===0?l=n.ma()?0:1:!p.Va()&&n.ma()&&(l=2))}switch(l){case 0:return i.queries.delete(a),i.onUnlisten(a,!0);case 1:return i.queries.delete(a),i.onUnlisten(a,!1);case 2:return i.onLastRemoteStoreUnlisten(a);default:return}}function pEe(s,n){const i=zn(s);let a=!1;for(const l of n){const p=l.query,_=i.queries.get(p);if(_){for(const T of _.Ra)T.pa(l)&&(a=!0);_.Aa=l}}a&&Nj(i)}function fEe(s,n,i){const a=zn(s),l=a.queries.get(n);if(l)for(const p of l.Ra)p.onError(i);a.queries.delete(n)}function Nj(s){s.fa.forEach(n=>{n.next()})}var S2,bz;(bz=S2||(S2={})).ya="default",bz.Cache="cache";class mEe{constructor(n,i,a){this.query=n,this.wa=i,this.ba=!1,this.Sa=null,this.onlineState="Unknown",this.options=a||{}}pa(n){if(!this.options.includeMetadataChanges){const a=[];for(const l of n.docChanges)l.type!==3&&a.push(l);n=new zv(n.query,n.docs,n.oldDocs,a,n.mutatedKeys,n.fromCache,n.syncStateChanged,!0,n.hasCachedResults)}let i=!1;return this.ba?this.Da(n)&&(this.wa.next(n),i=!0):this.va(n,this.onlineState)&&(this.Ca(n),i=!0),this.Sa=n,i}onError(n){this.wa.error(n)}ga(n){this.onlineState=n;let i=!1;return this.Sa&&!this.ba&&this.va(this.Sa,n)&&(this.Ca(this.Sa),i=!0),i}va(n,i){if(!n.fromCache||!this.ma())return!0;const a=i!=="Offline";return(!this.options.Fa||!a)&&(!n.docs.isEmpty()||n.hasCachedResults||i==="Offline")}Da(n){if(n.docChanges.length>0)return!0;const i=this.Sa&&this.Sa.hasPendingWrites!==n.hasPendingWrites;return!(!n.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Ca(n){n=zv.fromInitialDocuments(n.query,n.docs,n.mutatedKeys,n.fromCache,n.hasCachedResults),this.ba=!0,this.wa.next(n)}ma(){return this.options.source!==S2.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W7{constructor(n){this.key=n}}class z7{constructor(n){this.key=n}}class gEe{constructor(n,i){this.query=n,this.qa=i,this.Qa=null,this.hasCachedResults=!1,this.current=!1,this.$a=Rr(),this.mutatedKeys=Rr(),this.Ua=u7(n),this.Ka=new kv(this.Ua)}get Wa(){return this.qa}Ga(n,i){const a=i?i.za:new Sz,l=i?i.Ka:this.Ka;let p=i?i.mutatedKeys:this.mutatedKeys,_=l,T=!1;const w=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,C=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(n.inorderTraversal((O,k)=>{const U=l.get(O),G=vD(this.query,k)?k:null,z=!!U&&this.mutatedKeys.has(U.key),J=!!G&&(G.hasLocalMutations||this.mutatedKeys.has(G.key)&&G.hasCommittedMutations);let X=!1;U&&G?U.data.isEqual(G.data)?z!==J&&(a.track({type:3,doc:G}),X=!0):this.ja(U,G)||(a.track({type:2,doc:G}),X=!0,(w&&this.Ua(G,w)>0||C&&this.Ua(G,C)<0)&&(T=!0)):!U&&G?(a.track({type:0,doc:G}),X=!0):U&&!G&&(a.track({type:1,doc:U}),X=!0,(w||C)&&(T=!0)),X&&(G?(_=_.add(G),p=J?p.add(O):p.delete(O)):(_=_.delete(O),p=p.delete(O)))}),this.query.limit!==null)for(;_.size>this.query.limit;){const O=this.query.limitType==="F"?_.last():_.first();_=_.delete(O.key),p=p.delete(O.key),a.track({type:1,doc:O})}return{Ka:_,za:a,ys:T,mutatedKeys:p}}ja(n,i){return n.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(n,i,a,l){const p=this.Ka;this.Ka=n.Ka,this.mutatedKeys=n.mutatedKeys;const _=n.za.da();_.sort((O,k)=>function(G,z){const J=X=>{switch(X){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ln(20277,{Vt:X})}};return J(G)-J(z)}(O.type,k.type)||this.Ua(O.doc,k.doc)),this.Ha(a),l=l!=null&&l;const T=i&&!l?this.Ja():[],w=this.$a.size===0&&this.current&&!l?1:0,C=w!==this.Qa;return this.Qa=w,_.length!==0||C?{snapshot:new zv(this.query,n.Ka,p,_,n.mutatedKeys,w===0,C,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ya:T}:{Ya:T}}ga(n){return this.current&&n==="Offline"?(this.current=!1,this.applyChanges({Ka:this.Ka,za:new Sz,mutatedKeys:this.mutatedKeys,ys:!1},!1)):{Ya:[]}}Za(n){return!this.qa.has(n)&&!!this.Ka.has(n)&&!this.Ka.get(n).hasLocalMutations}Ha(n){n&&(n.addedDocuments.forEach(i=>this.qa=this.qa.add(i)),n.modifiedDocuments.forEach(i=>{}),n.removedDocuments.forEach(i=>this.qa=this.qa.delete(i)),this.current=n.current)}Ja(){if(!this.current)return[];const n=this.$a;this.$a=Rr(),this.Ka.forEach(a=>{this.Za(a.key)&&(this.$a=this.$a.add(a.key))});const i=[];return n.forEach(a=>{this.$a.has(a)||i.push(new z7(a))}),this.$a.forEach(a=>{n.has(a)||i.push(new W7(a))}),i}Xa(n){this.qa=n.Ns,this.$a=Rr();const i=this.Ga(n.documents);return this.applyChanges(i,!0)}eu(){return zv.fromInitialDocuments(this.query,this.Ka,this.mutatedKeys,this.Qa===0,this.hasCachedResults)}}const Oj="SyncEngine";class _Ee{constructor(n,i,a){this.query=n,this.targetId=i,this.view=a}}class EEe{constructor(n){this.key=n,this.tu=!1}}class yEe{constructor(n,i,a,l,p,_){this.localStore=n,this.remoteStore=i,this.eventManager=a,this.sharedClientState=l,this.currentUser=p,this.maxConcurrentLimboResolutions=_,this.nu={},this.ru=new F_(T=>d7(T),yD),this.iu=new Map,this.su=new Set,this.ou=new ps(Tn.comparator),this._u=new Map,this.au=new yj,this.uu={},this.cu=new Map,this.lu=Wv.ir(),this.onlineState="Unknown",this.hu=void 0}get isPrimaryClient(){return this.hu===!0}}async function vEe(s,n,i=!0){const a=$7(s);let l;const p=a.ru.get(n);return p?(a.sharedClientState.addLocalQueryTarget(p.targetId),l=p.view.eu()):l=await Y7(a,n,i,!0),l}async function SEe(s,n){const i=$7(s);await Y7(i,n,!0,!1)}async function Y7(s,n,i,a){const l=await U_e(s.localStore,Fu(n)),p=l.targetId,_=s.sharedClientState.addLocalQueryTarget(p,i);let T;return a&&(T=await TEe(s,n,p,_==="current",l.resumeToken)),s.isPrimaryClient&&i&&U7(s.remoteStore,l),T}async function TEe(s,n,i,a,l){s.Pu=(k,U,G)=>async function(J,X,ie,oe){let ce=X.view.Ga(ie);ce.ys&&(ce=await mz(J.localStore,X.query,!1).then(({documents:ee})=>X.view.Ga(ee,ce)));const _e=oe&&oe.targetChanges.get(X.targetId),se=oe&&oe.targetMismatches.get(X.targetId)!=null,be=X.view.applyChanges(ce,J.isPrimaryClient,_e,se);return Rz(J,X.targetId,be.Ya),be.snapshot}(s,k,U,G);const p=await mz(s.localStore,n,!0),_=new gEe(n,p.Ns),T=_.Ga(p.documents),w=C0.createSynthesizedTargetChangeForCurrentChange(i,a&&s.onlineState!=="Offline",l),C=_.applyChanges(T,s.isPrimaryClient,w);Rz(s,i,C.Ya);const O=new _Ee(n,i,_);return s.ru.set(n,O),s.iu.has(i)?s.iu.get(i).push(n):s.iu.set(i,[n]),C.snapshot}async function bEe(s,n,i){const a=zn(s),l=a.ru.get(n),p=a.iu.get(l.targetId);if(p.length>1)return a.iu.set(l.targetId,p.filter(_=>!yD(_,n))),void a.ru.delete(n);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await y2(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),i&&bj(a.remoteStore,l.targetId),T2(a,l.targetId)}).catch(oS)):(T2(a,l.targetId),await y2(a.localStore,l.targetId,!0))}async function wEe(s,n){const i=zn(s),a=i.ru.get(n),l=i.iu.get(a.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(a.targetId),bj(i.remoteStore,a.targetId))}async function REe(s,n,i){const a=xEe(s);try{const l=await function(_,T){const w=zn(_),C=ha.now(),O=T.reduce((G,z)=>G.add(z.key),Rr());let k,U;return w.persistence.runTransaction("Locally write mutations","readwrite",G=>{let z=mp(),J=Rr();return w.Cs.getEntries(G,O).next(X=>{z=X,z.forEach((ie,oe)=>{oe.isValidDocument()||(J=J.add(ie))})}).next(()=>w.localDocuments.getOverlayedDocuments(G,z)).next(X=>{k=X;const ie=[];for(const oe of T){const ce=Uge(oe,k.get(oe.key).overlayedDocument);ce!=null&&ie.push(new lm(oe.key,ce,n7(ce.value.mapValue),kl.exists(!0)))}return w.mutationQueue.addMutationBatch(G,C,ie,T)}).next(X=>{U=X;const ie=X.applyToLocalDocumentSet(k,J);return w.documentOverlayCache.saveOverlays(G,X.batchId,ie)})}).then(()=>({batchId:U.batchId,changes:p7(k)}))}(a.localStore,n);a.sharedClientState.addPendingMutation(l.batchId),function(_,T,w){let C=_.uu[_.currentUser.toKey()];C||(C=new ps(gr)),C=C.insert(T,w),_.uu[_.currentUser.toKey()]=C}(a,l.batchId,i),await I0(a,l.changes),await CD(a.remoteStore)}catch(l){const p=Ij(l,"Failed to persist write");i.reject(p)}}async function q7(s,n){const i=zn(s);try{const a=await L_e(i.localStore,n);n.targetChanges.forEach((l,p)=>{const _=i._u.get(p);_&&(ui(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1,22616),l.addedDocuments.size>0?_.tu=!0:l.modifiedDocuments.size>0?ui(_.tu,14607):l.removedDocuments.size>0&&(ui(_.tu,42227),_.tu=!1))}),await I0(i,a,n)}catch(a){await oS(a)}}function wz(s,n,i){const a=zn(s);if(a.isPrimaryClient&&i===0||!a.isPrimaryClient&&i===1){const l=[];a.ru.forEach((p,_)=>{const T=_.view.ga(n);T.snapshot&&l.push(T.snapshot)}),function(_,T){const w=zn(_);w.onlineState=T;let C=!1;w.queries.forEach((O,k)=>{for(const U of k.Ra)U.ga(T)&&(C=!0)}),C&&Nj(w)}(a.eventManager,n),l.length&&a.nu.Q_(l),a.onlineState=n,a.isPrimaryClient&&a.sharedClientState.setOnlineState(n)}}async function CEe(s,n,i){const a=zn(s);a.sharedClientState.updateQueryState(n,"rejected",i);const l=a._u.get(n),p=l&&l.key;if(p){let _=new ps(Tn.comparator);_=_.insert(p,uo.newNoDocument(p,Gn.min()));const T=Rr().add(p),w=new bD(Gn.min(),new Map,new ps(gr),_,T);await q7(a,w),a.ou=a.ou.remove(p),a._u.delete(n),Dj(a)}else await y2(a.localStore,n,!1).then(()=>T2(a,n,i)).catch(oS)}async function AEe(s,n){const i=zn(s),a=n.batch.batchId;try{const l=await k_e(i.localStore,n);X7(i,a,null),K7(i,a),i.sharedClientState.updateMutationState(a,"acknowledged"),await I0(i,l)}catch(l){await oS(l)}}async function IEe(s,n,i){const a=zn(s);try{const l=await function(_,T){const w=zn(_);return w.persistence.runTransaction("Reject batch","readwrite-primary",C=>{let O;return w.mutationQueue.lookupMutationBatch(C,T).next(k=>(ui(k!==null,37113),O=k.keys(),w.mutationQueue.removeMutationBatch(C,k))).next(()=>w.mutationQueue.performConsistencyCheck(C)).next(()=>w.documentOverlayCache.removeOverlaysForBatchId(C,O,T)).next(()=>w.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(C,O)).next(()=>w.localDocuments.getDocuments(C,O))})}(a.localStore,n);X7(a,n,i),K7(a,n),a.sharedClientState.updateMutationState(n,"rejected",i),await I0(a,l)}catch(l){await oS(l)}}function K7(s,n){(s.cu.get(n)||[]).forEach(i=>{i.resolve()}),s.cu.delete(n)}function X7(s,n,i){const a=zn(s);let l=a.uu[a.currentUser.toKey()];if(l){const p=l.get(n);p&&(i?p.reject(i):p.resolve(),l=l.remove(n)),a.uu[a.currentUser.toKey()]=l}}function T2(s,n,i=null){s.sharedClientState.removeLocalQueryTarget(n);for(const a of s.iu.get(n))s.ru.delete(a),i&&s.nu.Tu(a,i);s.iu.delete(n),s.isPrimaryClient&&s.au.Ur(n).forEach(a=>{s.au.containsKey(a)||Q7(s,a)})}function Q7(s,n){s.su.delete(n.path.canonicalString());const i=s.ou.get(n);i!==null&&(bj(s.remoteStore,i),s.ou=s.ou.remove(n),s._u.delete(i),Dj(s))}function Rz(s,n,i){for(const a of i)a instanceof W7?(s.au.addReference(a.key,n),NEe(s,a)):a instanceof z7?(Qt(Oj,"Document no longer in limbo: "+a.key),s.au.removeReference(a.key,n),s.au.containsKey(a.key)||Q7(s,a.key)):Ln(19791,{Iu:a})}function NEe(s,n){const i=n.key,a=i.path.canonicalString();s.ou.get(i)||s.su.has(a)||(Qt(Oj,"New document in limbo: "+i),s.su.add(a),Dj(s))}function Dj(s){for(;s.su.size>0&&s.ou.size<s.maxConcurrentLimboResolutions;){const n=s.su.values().next().value;s.su.delete(n);const i=new Tn(Gi.fromString(n)),a=s.lu.next();s._u.set(a,new EEe(i)),s.ou=s.ou.insert(i,a),U7(s.remoteStore,new Gf(Fu(pj(i.path)),a,"TargetPurposeLimboResolution",gD.le))}}async function I0(s,n,i){const a=zn(s),l=[],p=[],_=[];a.ru.isEmpty()||(a.ru.forEach((T,w)=>{_.push(a.Pu(w,n,i).then(C=>{var O;if((C||i)&&a.isPrimaryClient){const k=C?!C.fromCache:(O=i==null?void 0:i.targetChanges.get(w.targetId))===null||O===void 0?void 0:O.current;a.sharedClientState.updateQueryState(w.targetId,k?"current":"not-current")}if(C){l.push(C);const k=Sj.Ps(w.targetId,C);p.push(k)}}))}),await Promise.all(_),a.nu.Q_(l),await async function(w,C){const O=zn(w);try{await O.persistence.runTransaction("notifyLocalViewChanges","readwrite",k=>Et.forEach(C,U=>Et.forEach(U.ls,G=>O.persistence.referenceDelegate.addReference(k,U.targetId,G)).next(()=>Et.forEach(U.hs,G=>O.persistence.referenceDelegate.removeReference(k,U.targetId,G)))))}catch(k){if(!cS(k))throw k;Qt(Tj,"Failed to update sequence numbers: "+k)}for(const k of C){const U=k.targetId;if(!k.fromCache){const G=O.Ss.get(U),z=G.snapshotVersion,J=G.withLastLimboFreeSnapshotVersion(z);O.Ss=O.Ss.insert(U,J)}}}(a.localStore,p))}async function OEe(s,n){const i=zn(s);if(!i.currentUser.isEqual(n)){Qt(Oj,"User change. New user:",n.toKey());const a=await k7(i.localStore,n);i.currentUser=n,function(p,_){p.cu.forEach(T=>{T.forEach(w=>{w.reject(new Jt(_t.CANCELLED,_))})}),p.cu.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(n,a.removedBatchIds,a.addedBatchIds),await I0(i,a.Ms)}}function DEe(s,n){const i=zn(s),a=i._u.get(n);if(a&&a.tu)return Rr().add(a.key);{let l=Rr();const p=i.iu.get(n);if(!p)return l;for(const _ of p){const T=i.ru.get(_);l=l.unionWith(T.view.Wa)}return l}}function $7(s){const n=zn(s);return n.remoteStore.remoteSyncer.applyRemoteEvent=q7.bind(null,n),n.remoteStore.remoteSyncer.getRemoteKeysForTarget=DEe.bind(null,n),n.remoteStore.remoteSyncer.rejectListen=CEe.bind(null,n),n.nu.Q_=pEe.bind(null,n.eventManager),n.nu.Tu=fEe.bind(null,n.eventManager),n}function xEe(s){const n=zn(s);return n.remoteStore.remoteSyncer.applySuccessfulWrite=AEe.bind(null,n),n.remoteStore.remoteSyncer.rejectFailedWrite=IEe.bind(null,n),n}class LO{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(n){this.serializer=wD(n.databaseInfo.databaseId),this.sharedClientState=this.Au(n),this.persistence=this.Ru(n),await this.persistence.start(),this.localStore=this.Vu(n),this.gcScheduler=this.mu(n,this.localStore),this.indexBackfillerScheduler=this.fu(n,this.localStore)}mu(n,i){return null}fu(n,i){return null}Vu(n){return P_e(this.persistence,new O_e,n.initialUser,this.serializer)}Ru(n){return new P7(vj.Ei,this.serializer)}Au(n){return new F_e}async terminate(){var n,i;(n=this.gcScheduler)===null||n===void 0||n.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}LO.provider={build:()=>new LO};class PEe extends LO{constructor(n){super(),this.cacheSizeBytes=n}mu(n,i){ui(this.persistence.referenceDelegate instanceof PO,46915);const a=this.persistence.referenceDelegate.garbageCollector;return new m_e(a,n.asyncQueue,i)}Ru(n){const i=this.cacheSizeBytes!==void 0?lc.withCacheSize(this.cacheSizeBytes):lc.DEFAULT;return new P7(a=>PO.Ei(a,i),this.serializer)}}class b2{async initialize(n,i){this.localStore||(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>wz(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=OEe.bind(null,this.syncEngine),await cEe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(n){return function(){return new dEe}()}createDatastore(n){const i=wD(n.databaseInfo.databaseId),a=function(p){return new z_e(p)}(n.databaseInfo);return function(p,_,T,w){return new X_e(p,_,T,w)}(n.authCredentials,n.appCheckCredentials,a,i)}createRemoteStore(n){return function(a,l,p,_,T){return new $_e(a,l,p,_,T)}(this.localStore,this.datastore,n.asyncQueue,i=>wz(this.syncEngine,i,0),function(){return Ez.C()?new Ez:new B_e}())}createSyncEngine(n,i){return function(l,p,_,T,w,C,O){const k=new yEe(l,p,_,T,w,C);return O&&(k.hu=!0),k}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,n.initialUser,n.maxConcurrentLimboResolutions,i)}async terminate(){var n,i;await async function(l){const p=zn(l);Qt(P_,"RemoteStore shutting down."),p.aa.add(5),await A0(p),p.ca.shutdown(),p.la.set("Unknown")}(this.remoteStore),(n=this.datastore)===null||n===void 0||n.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}b2.provider={build:()=>new b2};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kEe{constructor(n){this.observer=n,this.muted=!1}next(n){this.muted||this.observer.next&&this.pu(this.observer.next,n)}error(n){this.muted||(this.observer.error?this.pu(this.observer.error,n):fp("Uncaught Error in snapshot listener:",n.toString()))}yu(){this.muted=!0}pu(n,i){setTimeout(()=>{this.muted||n(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const im="FirestoreClient";class LEe{constructor(n,i,a,l,p){this.authCredentials=n,this.appCheckCredentials=i,this.asyncQueue=a,this.databaseInfo=l,this.user=lo.UNAUTHENTICATED,this.clientId=YK.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=p,this.authCredentials.start(a,async _=>{Qt(im,"Received user=",_.uid),await this.authCredentialListener(_),this.user=_}),this.appCheckCredentials.start(a,_=>(Qt(im,"Received new app check token=",_),this.appCheckCredentialListener(_,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(n){this.authCredentialListener=n}setAppCheckTokenChangeListener(n){this.appCheckCredentialListener=n}terminate(){this.asyncQueue.enterRestrictedMode();const n=new b_;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(i){const a=Ij(i,"Failed to shutdown persistence");n.reject(a)}}),n.promise}}async function cM(s,n){s.asyncQueue.verifyOperationInProgress(),Qt(im,"Initializing OfflineComponentProvider");const i=s.configuration;await n.initialize(i);let a=i.initialUser;s.setCredentialChangeListener(async l=>{a.isEqual(l)||(await k7(n.localStore,l),a=l)}),n.persistence.setDatabaseDeletedListener(()=>s.terminate()),s._offlineComponents=n}async function Cz(s,n){s.asyncQueue.verifyOperationInProgress();const i=await MEe(s);Qt(im,"Initializing OnlineComponentProvider"),await n.initialize(i,s.configuration),s.setCredentialChangeListener(a=>vz(n.remoteStore,a)),s.setAppCheckTokenChangeListener((a,l)=>vz(n.remoteStore,l)),s._onlineComponents=n}async function MEe(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){Qt(im,"Using user provided OfflineComponentProvider");try{await cM(s,s._uninitializedComponentsProvider._offline)}catch(n){const i=n;if(!function(l){return l.name==="FirebaseError"?l.code===_t.FAILED_PRECONDITION||l.code===_t.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;Fv("Error using user provided cache. Falling back to memory cache: "+i),await cM(s,new LO)}}else Qt(im,"Using default OfflineComponentProvider"),await cM(s,new PEe(void 0));return s._offlineComponents}async function J7(s){return s._onlineComponents||(s._uninitializedComponentsProvider?(Qt(im,"Using user provided OnlineComponentProvider"),await Cz(s,s._uninitializedComponentsProvider._online)):(Qt(im,"Using default OnlineComponentProvider"),await Cz(s,new b2))),s._onlineComponents}function jEe(s){return J7(s).then(n=>n.syncEngine)}async function Az(s){const n=await J7(s),i=n.eventManager;return i.onListen=vEe.bind(null,n.syncEngine),i.onUnlisten=bEe.bind(null,n.syncEngine),i.onFirstRemoteStoreListen=SEe.bind(null,n.syncEngine),i.onLastRemoteStoreUnlisten=wEe.bind(null,n.syncEngine),i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z7(s){const n={};return s.timeoutSeconds!==void 0&&(n.timeoutSeconds=s.timeoutSeconds),n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iz=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eX(s,n,i){if(!i)throw new Jt(_t.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${n}.`)}function UEe(s,n,i,a){if(n===!0&&a===!0)throw new Jt(_t.INVALID_ARGUMENT,`${s} and ${i} cannot be used together.`)}function Nz(s){if(!Tn.isDocumentKey(s))throw new Jt(_t.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function Oz(s){if(Tn.isDocumentKey(s))throw new Jt(_t.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function AD(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const n=function(a){return a.constructor?a.constructor.name:null}(s);return n?`a custom ${n} object`:"an object"}}return typeof s=="function"?"a function":Ln(12329,{type:typeof s})}function Lv(s,n){if("_delegate"in s&&(s=s._delegate),!(s instanceof n)){if(n.name===s.constructor.name)throw new Jt(_t.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=AD(s);throw new Jt(_t.INVALID_ARGUMENT,`Expected type '${n.name}', but it was: ${i}`)}}return s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tX="firestore.googleapis.com",Dz=!0;class xz{constructor(n){var i,a;if(n.host===void 0){if(n.ssl!==void 0)throw new Jt(_t.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=tX,this.ssl=Dz}else this.host=n.host,this.ssl=(i=n.ssl)!==null&&i!==void 0?i:Dz;if(this.credentials=n.credentials,this.ignoreUndefinedProperties=!!n.ignoreUndefinedProperties,this.localCache=n.localCache,n.cacheSizeBytes===void 0)this.cacheSizeBytes=x7;else{if(n.cacheSizeBytes!==-1&&n.cacheSizeBytes<p_e)throw new Jt(_t.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=n.cacheSizeBytes}UEe("experimentalForceLongPolling",n.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",n.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!n.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:n.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!n.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Z7((a=n.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(p){if(p.timeoutSeconds!==void 0){if(isNaN(p.timeoutSeconds))throw new Jt(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (must not be NaN)`);if(p.timeoutSeconds<5)throw new Jt(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (minimum allowed value is 5)`);if(p.timeoutSeconds>30)throw new Jt(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!n.useFetchStreams}isEqual(n){return this.host===n.host&&this.ssl===n.ssl&&this.credentials===n.credentials&&this.cacheSizeBytes===n.cacheSizeBytes&&this.experimentalForceLongPolling===n.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===n.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,n.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===n.ignoreUndefinedProperties&&this.useFetchStreams===n.useFetchStreams}}class ID{constructor(n,i,a,l){this._authCredentials=n,this._appCheckCredentials=i,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xz({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Jt(_t.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(n){if(this._settingsFrozen)throw new Jt(_t.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xz(n),this._emulatorOptions=n.emulatorOptions||{},n.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new Wme;switch(a.type){case"firstParty":return new Kme(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new Jt(_t.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(n.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const a=Iz.get(i);a&&(Qt("ComponentProvider","Removing Datastore"),Iz.delete(i),a.terminate())}(this),Promise.resolve()}}function VEe(s,n,i,a={}){var l;const p=(s=Lv(s,ID))._getSettings(),_=Object.assign(Object.assign({},p),{emulatorOptions:s._getEmulatorOptions()}),T=`${n}:${i}`;p.host!==tX&&p.host!==T&&Fv("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const w=Object.assign(Object.assign({},p),{host:T,ssl:!1,emulatorOptions:a});if(!wO(w,_)&&(s._setSettings(w),a.mockUserToken)){let C,O;if(typeof a.mockUserToken=="string")C=a.mockUserToken,O=lo.MOCK_USER;else{C=RK(a.mockUserToken,(l=s._app)===null||l===void 0?void 0:l.options.projectId);const k=a.mockUserToken.sub||a.mockUserToken.user_id;if(!k)throw new Jt(_t.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");O=new lo(k)}s._authCredentials=new zme(new WK(C,O))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H_{constructor(n,i,a){this.converter=i,this._query=a,this.type="query",this.firestore=n}withConverter(n){return new H_(this.firestore,n,this._query)}}class Fc{constructor(n,i,a){this.converter=i,this._key=a,this.type="document",this.firestore=n}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xf(this.firestore,this.converter,this._key.path.popLast())}withConverter(n){return new Fc(this.firestore,n,this._key)}}class Xf extends H_{constructor(n,i,a){super(n,i,pj(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const n=this._path.popLast();return n.isEmpty()?null:new Fc(this.firestore,null,new Tn(n))}withConverter(n){return new Xf(this.firestore,n,this._path)}}function lM(s,n,...i){if(s=Uo(s),eX("collection","path",n),s instanceof ID){const a=Gi.fromString(n,...i);return Oz(a),new Xf(s,null,a)}{if(!(s instanceof Fc||s instanceof Xf))throw new Jt(_t.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=s._path.child(Gi.fromString(n,...i));return Oz(a),new Xf(s.firestore,null,a)}}function nX(s,n,...i){if(s=Uo(s),arguments.length===1&&(n=YK.newId()),eX("doc","path",n),s instanceof ID){const a=Gi.fromString(n,...i);return Nz(a),new Fc(s,null,new Tn(a))}{if(!(s instanceof Fc||s instanceof Xf))throw new Jt(_t.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=s._path.child(Gi.fromString(n,...i));return Nz(a),new Fc(s.firestore,s instanceof Xf?s.converter:null,new Tn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pz="AsyncQueue";class kz{constructor(n=Promise.resolve()){this.Qu=[],this.$u=!1,this.Uu=[],this.Ku=null,this.Wu=!1,this.Gu=!1,this.zu=[],this.y_=new M7(this,"async_queue_retry"),this.ju=()=>{const a=oM();a&&Qt(Pz,"Visibility state changed to "+a.visibilityState),this.y_.A_()},this.Hu=n;const i=oM();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.ju)}get isShuttingDown(){return this.$u}enqueueAndForget(n){this.enqueue(n)}enqueueAndForgetEvenWhileRestricted(n){this.Ju(),this.Yu(n)}enterRestrictedMode(n){if(!this.$u){this.$u=!0,this.Gu=n||!1;const i=oM();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.ju)}}enqueue(n){if(this.Ju(),this.$u)return new Promise(()=>{});const i=new b_;return this.Yu(()=>this.$u&&this.Gu?Promise.resolve():(n().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(n){this.enqueueAndForget(()=>(this.Qu.push(n),this.Zu()))}async Zu(){if(this.Qu.length!==0){try{await this.Qu[0](),this.Qu.shift(),this.y_.reset()}catch(n){if(!cS(n))throw n;Qt(Pz,"Operation failed with retryable error: "+n)}this.Qu.length>0&&this.y_.E_(()=>this.Zu())}}Yu(n){const i=this.Hu.then(()=>(this.Wu=!0,n().catch(a=>{throw this.Ku=a,this.Wu=!1,fp("INTERNAL UNHANDLED ERROR: ",Lz(a)),a}).then(a=>(this.Wu=!1,a))));return this.Hu=i,i}enqueueAfterDelay(n,i,a){this.Ju(),this.zu.indexOf(n)>-1&&(i=0);const l=Aj.createAndSchedule(this,n,i,a,p=>this.Xu(p));return this.Uu.push(l),l}Ju(){this.Ku&&Ln(47125,{ec:Lz(this.Ku)})}verifyOperationInProgress(){}async tc(){let n;do n=this.Hu,await n;while(n!==this.Hu)}nc(n){for(const i of this.Uu)if(i.timerId===n)return!0;return!1}rc(n){return this.tc().then(()=>{this.Uu.sort((i,a)=>i.targetTimeMs-a.targetTimeMs);for(const i of this.Uu)if(i.skipDelay(),n!=="all"&&i.timerId===n)break;return this.tc()})}sc(n){this.zu.push(n)}Xu(n){const i=this.Uu.indexOf(n);this.Uu.splice(i,1)}}function Lz(s){let n=s.message||"";return s.stack&&(n=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mz(s){return function(i,a){if(typeof i!="object"||i===null)return!1;const l=i;for(const p of a)if(p in l&&typeof l[p]=="function")return!0;return!1}(s,["next","error","complete"])}class f0 extends ID{constructor(n,i,a,l){super(n,i,a,l),this.type="firestore",this._queue=new kz,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const n=this._firestoreClient.terminate();this._queue=new kz(n),this._firestoreClient=void 0,await n}}}function FEe(s,n){const i=typeof s=="object"?s:kK(),a=typeof s=="string"?s:AO,l=OK(i,"firestore").getImmediate({identifier:a});if(!l._initialized){const p=bK("firestore");p&&VEe(l,...p)}return l}function xj(s){if(s._terminated)throw new Jt(_t.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||BEe(s),s._firestoreClient}function BEe(s){var n,i,a;const l=s._freezeSettings(),p=function(T,w,C,O){return new lge(T,w,C,O.host,O.ssl,O.experimentalForceLongPolling,O.experimentalAutoDetectLongPolling,Z7(O.experimentalLongPollingOptions),O.useFetchStreams)}(s._databaseId,((n=s._app)===null||n===void 0?void 0:n.options.appId)||"",s._persistenceKey,l);s._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(s._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),s._firestoreClient=new LEe(s._authCredentials,s._appCheckCredentials,s._queue,p,s._componentsProvider&&function(T){const w=T==null?void 0:T._online.build();return{_offline:T==null?void 0:T._offline.build(w),_online:w}}(s._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yv{constructor(n){this._byteString=n}static fromBase64String(n){try{return new Yv(Wa.fromBase64String(n))}catch(i){throw new Jt(_t.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(n){return new Yv(Wa.fromUint8Array(n))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(n){return this._byteString.isEqual(n._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ND{constructor(...n){for(let i=0;i<n.length;++i)if(n[i].length===0)throw new Jt(_t.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ga(n)}isEqual(n){return this._internalPath.isEqual(n._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pj{constructor(n){this._methodName=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kj{constructor(n,i){if(!isFinite(n)||n<-90||n>90)throw new Jt(_t.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+n);if(!isFinite(i)||i<-180||i>180)throw new Jt(_t.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=n,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(n){return this._lat===n._lat&&this._long===n._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(n){return gr(this._lat,n._lat)||gr(this._long,n._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lj{constructor(n){this._values=(n||[]).map(i=>i)}toArray(){return this._values.map(n=>n)}isEqual(n){return function(a,l){if(a.length!==l.length)return!1;for(let p=0;p<a.length;++p)if(a[p]!==l[p])return!1;return!0}(this._values,n._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HEe=/^__.*__$/;class GEe{constructor(n,i,a){this.data=n,this.fieldMask=i,this.fieldTransforms=a}toMutation(n,i){return this.fieldMask!==null?new lm(n,this.data,this.fieldMask,i,this.fieldTransforms):new R0(n,this.data,i,this.fieldTransforms)}}class rX{constructor(n,i,a){this.data=n,this.fieldMask=i,this.fieldTransforms=a}toMutation(n,i){return new lm(n,this.data,this.fieldMask,i,this.fieldTransforms)}}function iX(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ln(40011,{oc:s})}}class Mj{constructor(n,i,a,l,p,_){this.settings=n,this.databaseId=i,this.serializer=a,this.ignoreUndefinedProperties=l,p===void 0&&this._c(),this.fieldTransforms=p||[],this.fieldMask=_||[]}get path(){return this.settings.path}get oc(){return this.settings.oc}ac(n){return new Mj(Object.assign(Object.assign({},this.settings),n),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}uc(n){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(n),l=this.ac({path:a,cc:!1});return l.lc(n),l}hc(n){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(n),l=this.ac({path:a,cc:!1});return l._c(),l}Pc(n){return this.ac({path:void 0,cc:!0})}Tc(n){return MO(n,this.settings.methodName,this.settings.Ic||!1,this.path,this.settings.Ec)}contains(n){return this.fieldMask.find(i=>n.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>n.isPrefixOf(i.field))!==void 0}_c(){if(this.path)for(let n=0;n<this.path.length;n++)this.lc(this.path.get(n))}lc(n){if(n.length===0)throw this.Tc("Document fields must not be empty");if(iX(this.oc)&&HEe.test(n))throw this.Tc('Document fields cannot begin and end with "__"')}}class WEe{constructor(n,i,a){this.databaseId=n,this.ignoreUndefinedProperties=i,this.serializer=a||wD(n)}dc(n,i,a,l=!1){return new Mj({oc:n,methodName:i,Ec:a,path:Ga.emptyPath(),cc:!1,Ic:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function jj(s){const n=s._freezeSettings(),i=wD(s._databaseId);return new WEe(s._databaseId,!!n.ignoreUndefinedProperties,i)}function sX(s,n,i,a,l,p={}){const _=s.dc(p.merge||p.mergeFields?2:0,n,i,l);Uj("Data must be an object, but it was:",_,a);const T=aX(a,_);let w,C;if(p.merge)w=new Uc(_.fieldMask),C=_.fieldTransforms;else if(p.mergeFields){const O=[];for(const k of p.mergeFields){const U=w2(n,k,i);if(!_.contains(U))throw new Jt(_t.INVALID_ARGUMENT,`Field '${U}' is specified in your field mask but missing from your input data.`);cX(O,U)||O.push(U)}w=new Uc(O),C=_.fieldTransforms.filter(k=>w.covers(k.field))}else w=null,C=_.fieldTransforms;return new GEe(new dc(T),w,C)}class OD extends Pj{_toFieldTransform(n){if(n.oc!==2)throw n.oc===1?n.Tc(`${this._methodName}() can only appear at the top level of your update data`):n.Tc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return n.fieldMask.push(n.path),null}isEqual(n){return n instanceof OD}}function zEe(s,n,i,a){const l=s.dc(1,n,i);Uj("Data must be an object, but it was:",l,a);const p=[],_=dc.empty();cm(a,(w,C)=>{const O=Vj(n,w,i);C=Uo(C);const k=l.hc(O);if(C instanceof OD)p.push(O);else{const U=N0(C,k);U!=null&&(p.push(O),_.set(O,U))}});const T=new Uc(p);return new rX(_,T,l.fieldTransforms)}function YEe(s,n,i,a,l,p){const _=s.dc(1,n,i),T=[w2(n,a,i)],w=[l];if(p.length%2!=0)throw new Jt(_t.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let U=0;U<p.length;U+=2)T.push(w2(n,p[U])),w.push(p[U+1]);const C=[],O=dc.empty();for(let U=T.length-1;U>=0;--U)if(!cX(C,T[U])){const G=T[U];let z=w[U];z=Uo(z);const J=_.hc(G);if(z instanceof OD)C.push(G);else{const X=N0(z,J);X!=null&&(C.push(G),O.set(G,X))}}const k=new Uc(C);return new rX(O,k,_.fieldTransforms)}function qEe(s,n,i,a=!1){return N0(i,s.dc(a?4:3,n))}function N0(s,n){if(oX(s=Uo(s)))return Uj("Unsupported field value:",n,s),aX(s,n);if(s instanceof Pj)return function(a,l){if(!iX(l.oc))throw l.Tc(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Tc(`${a._methodName}() is not currently supported inside arrays`);const p=a._toFieldTransform(l);p&&l.fieldTransforms.push(p)}(s,n),null;if(s===void 0&&n.ignoreUndefinedProperties)return null;if(n.path&&n.fieldMask.push(n.path),s instanceof Array){if(n.settings.cc&&n.oc!==4)throw n.Tc("Nested arrays are not supported");return function(a,l){const p=[];let _=0;for(const T of a){let w=N0(T,l.Pc(_));w==null&&(w={nullValue:"NULL_VALUE"}),p.push(w),_++}return{arrayValue:{values:p}}}(s,n)}return function(a,l){if((a=Uo(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return xge(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const p=ha.fromDate(a);return{timestampValue:xO(l.serializer,p)}}if(a instanceof ha){const p=new ha(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:xO(l.serializer,p)}}if(a instanceof kj)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof Yv)return{bytesValue:R7(l.serializer,a._byteString)};if(a instanceof Fc){const p=l.databaseId,_=a.firestore._databaseId;if(!_.isEqual(p))throw l.Tc(`Document reference is for database ${_.projectId}/${_.database} but should be for database ${p.projectId}/${p.database}`);return{referenceValue:Ej(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof Lj)return function(_,T){return{mapValue:{fields:{[e7]:{stringValue:t7},[IO]:{arrayValue:{values:_.toArray().map(C=>{if(typeof C!="number")throw T.Tc("VectorValues must only contain numeric values.");return fj(T.serializer,C)})}}}}}}(a,l);throw l.Tc(`Unsupported field value: ${AD(a)}`)}(s,n)}function aX(s,n){const i={};return KK(s)?n.path&&n.path.length>0&&n.fieldMask.push(n.path):cm(s,(a,l)=>{const p=N0(l,n.uc(a));p!=null&&(i[a]=p)}),{mapValue:{fields:i}}}function oX(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof ha||s instanceof kj||s instanceof Yv||s instanceof Fc||s instanceof Pj||s instanceof Lj)}function Uj(s,n,i){if(!oX(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const a=AD(i);throw a==="an object"?n.Tc(s+" a custom object"):n.Tc(s+" "+a)}}function w2(s,n,i){if((n=Uo(n))instanceof ND)return n._internalPath;if(typeof n=="string")return Vj(s,n);throw MO("Field path arguments must be of type string or ",s,!1,void 0,i)}const KEe=new RegExp("[~\\*/\\[\\]]");function Vj(s,n,i){if(n.search(KEe)>=0)throw MO(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,i);try{return new ND(...n.split("."))._internalPath}catch{throw MO(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,i)}}function MO(s,n,i,a,l){const p=a&&!a.isEmpty(),_=l!==void 0;let T=`Function ${n}() called with invalid data`;i&&(T+=" (via `toFirestore()`)"),T+=". ";let w="";return(p||_)&&(w+=" (found",p&&(w+=` in field ${a}`),_&&(w+=` in document ${l}`),w+=")"),new Jt(_t.INVALID_ARGUMENT,T+s+w)}function cX(s,n){return s.some(i=>i.isEqual(n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lX{constructor(n,i,a,l,p){this._firestore=n,this._userDataWriter=i,this._key=a,this._document=l,this._converter=p}get id(){return this._key.path.lastSegment()}get ref(){return new Fc(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const n=new XEe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(n)}return this._userDataWriter.convertValue(this._document.data.value)}}get(n){if(this._document){const i=this._document.data.field(DD("DocumentSnapshot.get",n));if(i!==null)return this._userDataWriter.convertValue(i)}}}class XEe extends lX{data(){return super.data()}}function DD(s,n){return typeof n=="string"?Vj(s,n):n instanceof ND?n._internalPath:n._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QEe(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new Jt(_t.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Fj{}class dX extends Fj{}function jz(s,n,...i){let a=[];n instanceof Fj&&a.push(n),a=a.concat(i),function(p){const _=p.filter(w=>w instanceof Bj).length,T=p.filter(w=>w instanceof xD).length;if(_>1||_>0&&T>0)throw new Jt(_t.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)s=l._apply(s);return s}class xD extends dX{constructor(n,i,a){super(),this._field=n,this._op=i,this._value=a,this.type="where"}static _create(n,i,a){return new xD(n,i,a)}_apply(n){const i=this._parse(n);return uX(n._query,i),new H_(n.firestore,n.converter,p2(n._query,i))}_parse(n){const i=jj(n.firestore);return function(p,_,T,w,C,O,k){let U;if(C.isKeyField()){if(O==="array-contains"||O==="array-contains-any")throw new Jt(_t.INVALID_ARGUMENT,`Invalid Query. You can't perform '${O}' queries on documentId().`);if(O==="in"||O==="not-in"){Fz(k,O);const z=[];for(const J of k)z.push(Vz(w,p,J));U={arrayValue:{values:z}}}else U=Vz(w,p,k)}else O!=="in"&&O!=="not-in"&&O!=="array-contains-any"||Fz(k,O),U=qEe(T,_,k,O==="in"||O==="not-in");return ta.create(C,O,U)}(n._query,"where",i,n.firestore._databaseId,this._field,this._op,this._value)}}function Uz(s,n,i){const a=n,l=DD("where",s);return xD._create(l,a,i)}class Bj extends Fj{constructor(n,i){super(),this.type=n,this._queryConstraints=i}static _create(n,i){return new Bj(n,i)}_parse(n){const i=this._queryConstraints.map(a=>a._parse(n)).filter(a=>a.getFilters().length>0);return i.length===1?i[0]:Rd.create(i,this._getOperator())}_apply(n){const i=this._parse(n);return i.getFilters().length===0?n:(function(l,p){let _=l;const T=p.getFlattenedFilters();for(const w of T)uX(_,w),_=p2(_,w)}(n._query,i),new H_(n.firestore,n.converter,p2(n._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Hj extends dX{constructor(n,i){super(),this._field=n,this._direction=i,this.type="orderBy"}static _create(n,i){return new Hj(n,i)}_apply(n){const i=function(l,p,_){if(l.startAt!==null)throw new Jt(_t.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new Jt(_t.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new u0(p,_)}(n._query,this._field,this._direction);return new H_(n.firestore,n.converter,function(l,p){const _=l.explicitOrderBy.concat([p]);return new lS(l.path,l.collectionGroup,_,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(n._query,i))}}function $Ee(s,n="asc"){const i=n,a=DD("orderBy",s);return Hj._create(a,i)}function Vz(s,n,i){if(typeof(i=Uo(i))=="string"){if(i==="")throw new Jt(_t.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!l7(n)&&i.indexOf("/")!==-1)throw new Jt(_t.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const a=n.path.child(Gi.fromString(i));if(!Tn.isDocumentKey(a))throw new Jt(_t.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return Q8(s,new Tn(a))}if(i instanceof Fc)return Q8(s,i._key);throw new Jt(_t.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${AD(i)}.`)}function Fz(s,n){if(!Array.isArray(s)||s.length===0)throw new Jt(_t.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${n.toString()}' filters.`)}function uX(s,n){const i=function(l,p){for(const _ of l)for(const T of _.getFlattenedFilters())if(p.indexOf(T.op)>=0)return T.op;return null}(s.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(n.op));if(i!==null)throw i===n.op?new Jt(_t.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${n.op.toString()}' filter.`):new Jt(_t.INVALID_ARGUMENT,`Invalid query. You cannot use '${n.op.toString()}' filters with '${i.toString()}' filters.`)}class JEe{convertValue(n,i="none"){switch(nm(n)){case 0:return null;case 1:return n.booleanValue;case 2:return Vs(n.integerValue||n.doubleValue);case 3:return this.convertTimestamp(n.timestampValue);case 4:return this.convertServerTimestamp(n,i);case 5:return n.stringValue;case 6:return this.convertBytes(tm(n.bytesValue));case 7:return this.convertReference(n.referenceValue);case 8:return this.convertGeoPoint(n.geoPointValue);case 9:return this.convertArray(n.arrayValue,i);case 11:return this.convertObject(n.mapValue,i);case 10:return this.convertVectorValue(n.mapValue);default:throw Ln(62114,{value:n})}}convertObject(n,i){return this.convertObjectMap(n.fields,i)}convertObjectMap(n,i="none"){const a={};return cm(n,(l,p)=>{a[l]=this.convertValue(p,i)}),a}convertVectorValue(n){var i,a,l;const p=(l=(a=(i=n.fields)===null||i===void 0?void 0:i[IO].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(_=>Vs(_.doubleValue));return new Lj(p)}convertGeoPoint(n){return new kj(Vs(n.latitude),Vs(n.longitude))}convertArray(n,i){return(n.values||[]).map(a=>this.convertValue(a,i))}convertServerTimestamp(n,i){switch(i){case"previous":const a=ED(n);return a==null?null:this.convertValue(a,i);case"estimate":return this.convertTimestamp(c0(n));default:return null}}convertTimestamp(n){const i=em(n);return new ha(i.seconds,i.nanos)}convertDocumentKey(n,i){const a=Gi.fromString(n);ui(D7(a),9688,{name:n});const l=new l0(a.get(1),a.get(3)),p=new Tn(a.popFirst(5));return l.isEqual(i)||fp(`Document ${p} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hX(s,n,i){let a;return a=s?i&&(i.merge||i.mergeFields)?s.toFirestore(n,i):s.toFirestore(n):n,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lw{constructor(n,i){this.hasPendingWrites=n,this.fromCache=i}isEqual(n){return this.hasPendingWrites===n.hasPendingWrites&&this.fromCache===n.fromCache}}class pX extends lX{constructor(n,i,a,l,p,_){super(n,i,a,l,_),this._firestore=n,this._firestoreImpl=n,this.metadata=p}exists(){return super.exists()}data(n={}){if(this._document){if(this._converter){const i=new nO(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,n)}return this._userDataWriter.convertValue(this._document.data.value,n.serverTimestamps)}}get(n,i={}){if(this._document){const a=this._document.data.field(DD("DocumentSnapshot.get",n));if(a!==null)return this._userDataWriter.convertValue(a,i.serverTimestamps)}}}class nO extends pX{data(n={}){return super.data(n)}}class ZEe{constructor(n,i,a,l){this._firestore=n,this._userDataWriter=i,this._snapshot=l,this.metadata=new Lw(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const n=[];return this.forEach(i=>n.push(i)),n}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(n,i){this._snapshot.docs.forEach(a=>{n.call(i,new nO(this._firestore,this._userDataWriter,a.key,a,new Lw(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(n={}){const i=!!n.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new Jt(_t.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,p){if(l._snapshot.oldDocs.isEmpty()){let _=0;return l._snapshot.docChanges.map(T=>{const w=new nO(l._firestore,l._userDataWriter,T.doc.key,T.doc,new Lw(l._snapshot.mutatedKeys.has(T.doc.key),l._snapshot.fromCache),l.query.converter);return T.doc,{type:"added",doc:w,oldIndex:-1,newIndex:_++}})}{let _=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(T=>p||T.type!==3).map(T=>{const w=new nO(l._firestore,l._userDataWriter,T.doc.key,T.doc,new Lw(l._snapshot.mutatedKeys.has(T.doc.key),l._snapshot.fromCache),l.query.converter);let C=-1,O=-1;return T.type!==0&&(C=_.indexOf(T.doc.key),_=_.delete(T.doc.key)),T.type!==1&&(_=_.add(T.doc),O=_.indexOf(T.doc.key)),{type:eye(T.type),doc:w,oldIndex:C,newIndex:O}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function eye(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ln(61501,{type:s})}}class fX extends JEe{constructor(n){super(),this.firestore=n}convertBytes(n){return new Yv(n)}convertReference(n){const i=this.convertDocumentKey(n,this.firestore._databaseId);return new Fc(this.firestore,null,i)}}function tye(s,n){const i=Lv(s.firestore,f0),a=nX(s),l=hX(s.converter,n);return mX(i,[sX(jj(s.firestore),"addDoc",a._key,l,s.converter!==null,{}).toMutation(a._key,kl.exists(!1))]).then(()=>a)}function Bz(s,...n){var i,a,l;s=Uo(s);let p={includeMetadataChanges:!1,source:"default"},_=0;typeof n[_]!="object"||Mz(n[_])||(p=n[_],_++);const T={includeMetadataChanges:p.includeMetadataChanges,source:p.source};if(Mz(n[_])){const k=n[_];n[_]=(i=k.next)===null||i===void 0?void 0:i.bind(k),n[_+1]=(a=k.error)===null||a===void 0?void 0:a.bind(k),n[_+2]=(l=k.complete)===null||l===void 0?void 0:l.bind(k)}let w,C,O;if(s instanceof Fc)C=Lv(s.firestore,f0),O=pj(s._key.path),w={next:k=>{n[_]&&n[_](nye(C,s,k))},error:n[_+1],complete:n[_+2]};else{const k=Lv(s,H_);C=Lv(k.firestore,f0),O=k._query;const U=new fX(C);w={next:G=>{n[_]&&n[_](new ZEe(C,U,k,G))},error:n[_+1],complete:n[_+2]},QEe(s._query)}return function(U,G,z,J){const X=new kEe(J),ie=new mEe(G,X,z);return U.asyncQueue.enqueueAndForget(async()=>uEe(await Az(U),ie)),()=>{X.yu(),U.asyncQueue.enqueueAndForget(async()=>hEe(await Az(U),ie))}}(xj(C),O,T,w)}function mX(s,n){return function(a,l){const p=new b_;return a.asyncQueue.enqueueAndForget(async()=>REe(await jEe(a),l,p)),p.promise}(xj(s),n)}function nye(s,n,i){const a=i.docs.get(n._key),l=new fX(s);return new pX(s,l,n._key,a,new Lw(i.hasPendingWrites,i.fromCache),n.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rye{constructor(n,i){this._firestore=n,this._commitHandler=i,this._mutations=[],this._committed=!1,this._dataReader=jj(n)}set(n,i,a){this._verifyNotCommitted();const l=dM(n,this._firestore),p=hX(l.converter,i,a),_=sX(this._dataReader,"WriteBatch.set",l._key,p,l.converter!==null,a);return this._mutations.push(_.toMutation(l._key,kl.none())),this}update(n,i,a,...l){this._verifyNotCommitted();const p=dM(n,this._firestore);let _;return _=typeof(i=Uo(i))=="string"||i instanceof ND?YEe(this._dataReader,"WriteBatch.update",p._key,i,a,l):zEe(this._dataReader,"WriteBatch.update",p._key,i),this._mutations.push(_.toMutation(p._key,kl.exists(!0))),this}delete(n){this._verifyNotCommitted();const i=dM(n,this._firestore);return this._mutations=this._mutations.concat(new mj(i._key,kl.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Jt(_t.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function dM(s,n){if((s=Uo(s)).firestore!==n)throw new Jt(_t.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iye(s){return xj(s=Lv(s,f0)),new rye(s,n=>mX(s,n))}(function(n,i=!0){(function(l){aS=l})(xK),s0(new Vv("firestore",(a,{instanceIdentifier:l,options:p})=>{const _=a.getProvider("app").getImmediate(),T=new f0(new Yme(a.getProvider("auth-internal")),new Xme(_,a.getProvider("app-check-internal")),function(C,O){if(!Object.prototype.hasOwnProperty.apply(C.options,["projectId"]))throw new Jt(_t.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new l0(C.options.projectId,O)}(_,l),_);return p=Object.assign({useFetchStreams:i},p),T._setSettings(p),T},"PUBLIC").setMultipleInstances(!0)),qf(U8,V8,n),qf(U8,V8,"esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gX="firebasestorage.googleapis.com",_X="storageBucket",sye=2*60*1e3,aye=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rs extends V_{constructor(n,i,a=0){super(uM(n),`Firebase Storage: ${i} (${uM(n)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Rs.prototype)}get status(){return this.status_}set status(n){this.status_=n}_codeEquals(n){return uM(n)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(n){this.customData.serverResponse=n,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var bs;(function(s){s.UNKNOWN="unknown",s.OBJECT_NOT_FOUND="object-not-found",s.BUCKET_NOT_FOUND="bucket-not-found",s.PROJECT_NOT_FOUND="project-not-found",s.QUOTA_EXCEEDED="quota-exceeded",s.UNAUTHENTICATED="unauthenticated",s.UNAUTHORIZED="unauthorized",s.UNAUTHORIZED_APP="unauthorized-app",s.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",s.INVALID_CHECKSUM="invalid-checksum",s.CANCELED="canceled",s.INVALID_EVENT_NAME="invalid-event-name",s.INVALID_URL="invalid-url",s.INVALID_DEFAULT_BUCKET="invalid-default-bucket",s.NO_DEFAULT_BUCKET="no-default-bucket",s.CANNOT_SLICE_BLOB="cannot-slice-blob",s.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",s.NO_DOWNLOAD_URL="no-download-url",s.INVALID_ARGUMENT="invalid-argument",s.INVALID_ARGUMENT_COUNT="invalid-argument-count",s.APP_DELETED="app-deleted",s.INVALID_ROOT_OPERATION="invalid-root-operation",s.INVALID_FORMAT="invalid-format",s.INTERNAL_ERROR="internal-error",s.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(bs||(bs={}));function uM(s){return"storage/"+s}function Gj(){const s="An unknown error occurred, please check the error payload for server response.";return new Rs(bs.UNKNOWN,s)}function oye(s){return new Rs(bs.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")}function cye(s){return new Rs(bs.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function lye(){const s="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Rs(bs.UNAUTHENTICATED,s)}function dye(){return new Rs(bs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function uye(s){return new Rs(bs.UNAUTHORIZED,"User does not have permission to access '"+s+"'.")}function hye(){return new Rs(bs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function pye(){return new Rs(bs.CANCELED,"User canceled the upload/download.")}function fye(s){return new Rs(bs.INVALID_URL,"Invalid URL '"+s+"'.")}function mye(s){return new Rs(bs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+s+"'.")}function gye(){return new Rs(bs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+_X+"' property when initializing the app?")}function _ye(){return new Rs(bs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Eye(){return new Rs(bs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function yye(s){return new Rs(bs.UNSUPPORTED_ENVIRONMENT,`${s} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function R2(s){return new Rs(bs.INVALID_ARGUMENT,s)}function EX(){return new Rs(bs.APP_DELETED,"The Firebase app was deleted.")}function vye(s){return new Rs(bs.INVALID_ROOT_OPERATION,"The operation '"+s+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Zw(s,n){return new Rs(bs.INVALID_FORMAT,"String does not match format '"+s+"': "+n)}function ww(s){throw new Rs(bs.INTERNAL_ERROR,"Internal error: "+s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vc{constructor(n,i){this.bucket=n,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const n=encodeURIComponent;return"/b/"+n(this.bucket)+"/o/"+n(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(n,i){let a;try{a=Vc.makeFromUrl(n,i)}catch{return new Vc(n,"")}if(a.path==="")return a;throw mye(n)}static makeFromUrl(n,i){let a=null;const l="([A-Za-z0-9.\\-_]+)";function p(_e){_e.path.charAt(_e.path.length-1)==="/"&&(_e.path_=_e.path_.slice(0,-1))}const _="(/(.*))?$",T=new RegExp("^gs://"+l+_,"i"),w={bucket:1,path:3};function C(_e){_e.path_=decodeURIComponent(_e.path)}const O="v[A-Za-z0-9_]+",k=i.replace(/[.]/g,"\\."),U="(/([^?#]*).*)?$",G=new RegExp(`^https?://${k}/${O}/b/${l}/o${U}`,"i"),z={bucket:1,path:3},J=i===gX?"(?:storage.googleapis.com|storage.cloud.google.com)":i,X="([^?#]*)",ie=new RegExp(`^https?://${J}/${l}/${X}`,"i"),ce=[{regex:T,indices:w,postModify:p},{regex:G,indices:z,postModify:C},{regex:ie,indices:{bucket:1,path:2},postModify:C}];for(let _e=0;_e<ce.length;_e++){const se=ce[_e],be=se.regex.exec(n);if(be){const ee=be[se.indices.bucket];let Q=be[se.indices.path];Q||(Q=""),a=new Vc(ee,Q),se.postModify(a);break}}if(a==null)throw fye(n);return a}}class Sye{constructor(n){this.promise_=Promise.reject(n)}getPromise(){return this.promise_}cancel(n=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tye(s,n,i){let a=1,l=null,p=null,_=!1,T=0;function w(){return T===2}let C=!1;function O(...X){C||(C=!0,n.apply(null,X))}function k(X){l=setTimeout(()=>{l=null,s(G,w())},X)}function U(){p&&clearTimeout(p)}function G(X,...ie){if(C){U();return}if(X){U(),O.call(null,X,...ie);return}if(w()||_){U(),O.call(null,X,...ie);return}a<64&&(a*=2);let ce;T===1?(T=2,ce=0):ce=(a+Math.random())*1e3,k(ce)}let z=!1;function J(X){z||(z=!0,U(),!C&&(l!==null?(X||(T=2),clearTimeout(l),k(0)):X||(T=1)))}return k(0),p=setTimeout(()=>{_=!0,J(!0)},i),J}function bye(s){s(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wye(s){return s!==void 0}function Rye(s){return typeof s=="object"&&!Array.isArray(s)}function Wj(s){return typeof s=="string"||s instanceof String}function Hz(s){return zj()&&s instanceof Blob}function zj(){return typeof Blob<"u"}function Gz(s,n,i,a){if(a<n)throw R2(`Invalid value for '${s}'. Expected ${n} or greater.`);if(a>i)throw R2(`Invalid value for '${s}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yj(s,n,i){let a=n;return i==null&&(a=`https://${n}`),`${i}://${a}/v0${s}`}function yX(s){const n=encodeURIComponent;let i="?";for(const a in s)if(s.hasOwnProperty(a)){const l=n(a)+"="+n(s[a]);i=i+l+"&"}return i=i.slice(0,-1),i}var w_;(function(s){s[s.NO_ERROR=0]="NO_ERROR",s[s.NETWORK_ERROR=1]="NETWORK_ERROR",s[s.ABORT=2]="ABORT"})(w_||(w_={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cye(s,n){const i=s>=500&&s<600,l=[408,429].indexOf(s)!==-1,p=n.indexOf(s)!==-1;return i||l||p}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aye{constructor(n,i,a,l,p,_,T,w,C,O,k,U=!0){this.url_=n,this.method_=i,this.headers_=a,this.body_=l,this.successCodes_=p,this.additionalRetryCodes_=_,this.callback_=T,this.errorCallback_=w,this.timeout_=C,this.progressCallback_=O,this.connectionFactory_=k,this.retry=U,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((G,z)=>{this.resolve_=G,this.reject_=z,this.start_()})}start_(){const n=(a,l)=>{if(l){a(!1,new oN(!1,null,!0));return}const p=this.connectionFactory_();this.pendingConnection_=p;const _=T=>{const w=T.loaded,C=T.lengthComputable?T.total:-1;this.progressCallback_!==null&&this.progressCallback_(w,C)};this.progressCallback_!==null&&p.addUploadProgressListener(_),p.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&p.removeUploadProgressListener(_),this.pendingConnection_=null;const T=p.getErrorCode()===w_.NO_ERROR,w=p.getStatus();if(!T||Cye(w,this.additionalRetryCodes_)&&this.retry){const O=p.getErrorCode()===w_.ABORT;a(!1,new oN(!1,null,O));return}const C=this.successCodes_.indexOf(w)!==-1;a(!0,new oN(C,p))})},i=(a,l)=>{const p=this.resolve_,_=this.reject_,T=l.connection;if(l.wasSuccessCode)try{const w=this.callback_(T,T.getResponse());wye(w)?p(w):p()}catch(w){_(w)}else if(T!==null){const w=Gj();w.serverResponse=T.getErrorText(),this.errorCallback_?_(this.errorCallback_(T,w)):_(w)}else if(l.canceled){const w=this.appDelete_?EX():pye();_(w)}else{const w=hye();_(w)}};this.canceled_?i(!1,new oN(!1,null,!0)):this.backoffId_=Tye(n,i,this.timeout_)}getPromise(){return this.promise_}cancel(n){this.canceled_=!0,this.appDelete_=n||!1,this.backoffId_!==null&&bye(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class oN{constructor(n,i,a){this.wasSuccessCode=n,this.connection=i,this.canceled=!!a}}function Iye(s,n){n!==null&&n.length>0&&(s.Authorization="Firebase "+n)}function Nye(s,n){s["X-Firebase-Storage-Version"]="webjs/"+(n??"AppManager")}function Oye(s,n){n&&(s["X-Firebase-GMPID"]=n)}function Dye(s,n){n!==null&&(s["X-Firebase-AppCheck"]=n)}function xye(s,n,i,a,l,p,_=!0){const T=yX(s.urlParams),w=s.url+T,C=Object.assign({},s.headers);return Oye(C,n),Iye(C,i),Nye(C,p),Dye(C,a),new Aye(w,s.method,C,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,l,_)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pye(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function kye(...s){const n=Pye();if(n!==void 0){const i=new n;for(let a=0;a<s.length;a++)i.append(s[a]);return i.getBlob()}else{if(zj())return new Blob(s);throw new Rs(bs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function Lye(s,n,i){return s.webkitSlice?s.webkitSlice(n,i):s.mozSlice?s.mozSlice(n,i):s.slice?s.slice(n,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mye(s){if(typeof atob>"u")throw yye("base-64");return atob(s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uu={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class hM{constructor(n,i){this.data=n,this.contentType=i||null}}function jye(s,n){switch(s){case Uu.RAW:return new hM(vX(n));case Uu.BASE64:case Uu.BASE64URL:return new hM(SX(s,n));case Uu.DATA_URL:return new hM(Vye(n),Fye(n))}throw Gj()}function vX(s){const n=[];for(let i=0;i<s.length;i++){let a=s.charCodeAt(i);if(a<=127)n.push(a);else if(a<=2047)n.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(i<s.length-1&&(s.charCodeAt(i+1)&64512)===56320))n.push(239,191,189);else{const p=a,_=s.charCodeAt(++i);a=65536|(p&1023)<<10|_&1023,n.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?n.push(239,191,189):n.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(n)}function Uye(s){let n;try{n=decodeURIComponent(s)}catch{throw Zw(Uu.DATA_URL,"Malformed data URL.")}return vX(n)}function SX(s,n){switch(s){case Uu.BASE64:{const l=n.indexOf("-")!==-1,p=n.indexOf("_")!==-1;if(l||p)throw Zw(s,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Uu.BASE64URL:{const l=n.indexOf("+")!==-1,p=n.indexOf("/")!==-1;if(l||p)throw Zw(s,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");n=n.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=Mye(n)}catch(l){throw l.message.includes("polyfill")?l:Zw(s,"Invalid character found")}const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}class TX{constructor(n){this.base64=!1,this.contentType=null;const i=n.match(/^data:([^,]+)?,/);if(i===null)throw Zw(Uu.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=i[1]||null;a!=null&&(this.base64=Bye(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=n.substring(n.indexOf(",")+1)}}function Vye(s){const n=new TX(s);return n.base64?SX(Uu.BASE64,n.rest):Uye(n.rest)}function Fye(s){return new TX(s).contentType}function Bye(s,n){return s.length>=n.length?s.substring(s.length-n.length)===n:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(n,i){let a=0,l="";Hz(n)?(this.data_=n,a=n.size,l=n.type):n instanceof ArrayBuffer?(i?this.data_=new Uint8Array(n):(this.data_=new Uint8Array(n.byteLength),this.data_.set(new Uint8Array(n))),a=this.data_.length):n instanceof Uint8Array&&(i?this.data_=n:(this.data_=new Uint8Array(n.length),this.data_.set(n)),a=n.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(n,i){if(Hz(this.data_)){const a=this.data_,l=Lye(a,n,i);return l===null?null:new Hf(l)}else{const a=new Uint8Array(this.data_.buffer,n,i-n);return new Hf(a,!0)}}static getBlob(...n){if(zj()){const i=n.map(a=>a instanceof Hf?a.data_:a);return new Hf(kye.apply(null,i))}else{const i=n.map(_=>Wj(_)?jye(Uu.RAW,_).data:_.data_);let a=0;i.forEach(_=>{a+=_.byteLength});const l=new Uint8Array(a);let p=0;return i.forEach(_=>{for(let T=0;T<_.length;T++)l[p++]=_[T]}),new Hf(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bX(s){let n;try{n=JSON.parse(s)}catch{return null}return Rye(n)?n:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hye(s){if(s.length===0)return null;const n=s.lastIndexOf("/");return n===-1?"":s.slice(0,n)}function Gye(s,n){const i=n.split("/").filter(a=>a.length>0).join("/");return s.length===0?i:s+"/"+i}function wX(s){const n=s.lastIndexOf("/",s.length-2);return n===-1?s:s.slice(n+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wye(s,n){return n}class ko{constructor(n,i,a,l){this.server=n,this.local=i||n,this.writable=!!a,this.xform=l||Wye}}let cN=null;function zye(s){return!Wj(s)||s.length<2?s:wX(s)}function RX(){if(cN)return cN;const s=[];s.push(new ko("bucket")),s.push(new ko("generation")),s.push(new ko("metageneration")),s.push(new ko("name","fullPath",!0));function n(p,_){return zye(_)}const i=new ko("name");i.xform=n,s.push(i);function a(p,_){return _!==void 0?Number(_):_}const l=new ko("size");return l.xform=a,s.push(l),s.push(new ko("timeCreated")),s.push(new ko("updated")),s.push(new ko("md5Hash",null,!0)),s.push(new ko("cacheControl",null,!0)),s.push(new ko("contentDisposition",null,!0)),s.push(new ko("contentEncoding",null,!0)),s.push(new ko("contentLanguage",null,!0)),s.push(new ko("contentType",null,!0)),s.push(new ko("metadata","customMetadata",!0)),cN=s,cN}function Yye(s,n){function i(){const a=s.bucket,l=s.fullPath,p=new Vc(a,l);return n._makeStorageReference(p)}Object.defineProperty(s,"ref",{get:i})}function qye(s,n,i){const a={};a.type="file";const l=i.length;for(let p=0;p<l;p++){const _=i[p];a[_.local]=_.xform(a,n[_.server])}return Yye(a,s),a}function CX(s,n,i){const a=bX(n);return a===null?null:qye(s,a,i)}function Kye(s,n,i,a){const l=bX(n);if(l===null||!Wj(l.downloadTokens))return null;const p=l.downloadTokens;if(p.length===0)return null;const _=encodeURIComponent;return p.split(",").map(C=>{const O=s.bucket,k=s.fullPath,U="/b/"+_(O)+"/o/"+_(k),G=Yj(U,i,a),z=yX({alt:"media",token:C});return G+z})[0]}function Xye(s,n){const i={},a=n.length;for(let l=0;l<a;l++){const p=n[l];p.writable&&(i[p.server]=s[p.local])}return JSON.stringify(i)}class AX{constructor(n,i,a,l){this.url=n,this.method=i,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IX(s){if(!s)throw Gj()}function Qye(s,n){function i(a,l){const p=CX(s,l,n);return IX(p!==null),p}return i}function $ye(s,n){function i(a,l){const p=CX(s,l,n);return IX(p!==null),Kye(p,l,s.host,s._protocol)}return i}function NX(s){function n(i,a){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=dye():l=lye():i.getStatus()===402?l=cye(s.bucket):i.getStatus()===403?l=uye(s.path):l=a,l.status=i.getStatus(),l.serverResponse=a.serverResponse,l}return n}function Jye(s){const n=NX(s);function i(a,l){let p=n(a,l);return a.getStatus()===404&&(p=oye(s.path)),p.serverResponse=l.serverResponse,p}return i}function Zye(s,n,i){const a=n.fullServerUrl(),l=Yj(a,s.host,s._protocol),p="GET",_=s.maxOperationRetryTime,T=new AX(l,p,$ye(s,i),_);return T.errorHandler=Jye(n),T}function eve(s,n){return s&&s.contentType||n&&n.type()||"application/octet-stream"}function tve(s,n,i){const a=Object.assign({},i);return a.fullPath=s.path,a.size=n.size(),a.contentType||(a.contentType=eve(null,n)),a}function nve(s,n,i,a,l){const p=n.bucketOnlyServerUrl(),_={"X-Goog-Upload-Protocol":"multipart"};function T(){let ce="";for(let _e=0;_e<2;_e++)ce=ce+Math.random().toString().slice(2);return ce}const w=T();_["Content-Type"]="multipart/related; boundary="+w;const C=tve(n,a,l),O=Xye(C,i),k="--"+w+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+O+`\r
--`+w+`\r
Content-Type: `+C.contentType+`\r
\r
`,U=`\r
--`+w+"--",G=Hf.getBlob(k,a,U);if(G===null)throw _ye();const z={name:C.fullPath},J=Yj(p,s.host,s._protocol),X="POST",ie=s.maxUploadRetryTime,oe=new AX(J,X,Qye(s,i),ie);return oe.urlParams=z,oe.headers=_,oe.body=G.uploadData(),oe.errorHandler=NX(n),oe}class rve{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=w_.NO_ERROR,this.sendPromise_=new Promise(n=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=w_.ABORT,n()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=w_.NETWORK_ERROR,n()}),this.xhr_.addEventListener("load",()=>{n()})})}send(n,i,a,l){if(this.sent_)throw ww("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,n,!0),l!==void 0)for(const p in l)l.hasOwnProperty(p)&&this.xhr_.setRequestHeader(p,l[p].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw ww("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw ww("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw ww("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw ww("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(n){return this.xhr_.getResponseHeader(n)}addUploadProgressListener(n){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",n)}removeUploadProgressListener(n){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",n)}}class ive extends rve{initXhr(){this.xhr_.responseType="text"}}function OX(){return new ive}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k_{constructor(n,i){this._service=n,i instanceof Vc?this._location=i:this._location=Vc.makeFromUrl(i,n.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(n,i){return new k_(n,i)}get root(){const n=new Vc(this._location.bucket,"");return this._newRef(this._service,n)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return wX(this._location.path)}get storage(){return this._service}get parent(){const n=Hye(this._location.path);if(n===null)return null;const i=new Vc(this._location.bucket,n);return new k_(this._service,i)}_throwIfRoot(n){if(this._location.path==="")throw vye(n)}}function sve(s,n,i){s._throwIfRoot("uploadBytes");const a=nve(s.storage,s._location,RX(),new Hf(n,!0),i);return s.storage.makeRequestWithTokens(a,OX).then(l=>({metadata:l,ref:s}))}function ave(s){s._throwIfRoot("getDownloadURL");const n=Zye(s.storage,s._location,RX());return s.storage.makeRequestWithTokens(n,OX).then(i=>{if(i===null)throw Eye();return i})}function ove(s,n){const i=Gye(s._location.path,n),a=new Vc(s._location.bucket,i);return new k_(s.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cve(s){return/^[A-Za-z]+:\/\//.test(s)}function lve(s,n){return new k_(s,n)}function DX(s,n){if(s instanceof qj){const i=s;if(i._bucket==null)throw gye();const a=new k_(i,i._bucket);return n!=null?DX(a,n):a}else return n!==void 0?ove(s,n):s}function dve(s,n){if(n&&cve(n)){if(s instanceof qj)return lve(s,n);throw R2("To use ref(service, url), the first argument must be a Storage instance.")}else return DX(s,n)}function Wz(s,n){const i=n==null?void 0:n[_X];return i==null?null:Vc.makeFromBucketSpec(i,s)}function uve(s,n,i,a={}){s.host=`${n}:${i}`,s._protocol="http";const{mockUserToken:l}=a;l&&(s._overrideAuthToken=typeof l=="string"?l:RK(l,s.app.options.projectId))}class qj{constructor(n,i,a,l,p){this.app=n,this._authProvider=i,this._appCheckProvider=a,this._url=l,this._firebaseVersion=p,this._bucket=null,this._host=gX,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=sye,this._maxUploadRetryTime=aye,this._requests=new Set,l!=null?this._bucket=Vc.makeFromBucketSpec(l,this._host):this._bucket=Wz(this._host,this.app.options)}get host(){return this._host}set host(n){this._host=n,this._url!=null?this._bucket=Vc.makeFromBucketSpec(this._url,n):this._bucket=Wz(n,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(n){Gz("time",0,Number.POSITIVE_INFINITY,n),this._maxUploadRetryTime=n}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(n){Gz("time",0,Number.POSITIVE_INFINITY,n),this._maxOperationRetryTime=n}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const n=this._authProvider.getImmediate({optional:!0});if(n){const i=await n.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(DK(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=this._appCheckProvider.getImmediate({optional:!0});return n?(await n.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(n=>n.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(n){return new k_(this,n)}_makeRequest(n,i,a,l,p=!0){if(this._deleted)return new Sye(EX());{const _=xye(n,this._appId,a,l,i,this._firebaseVersion,p);return this._requests.add(_),_.getPromise().then(()=>this._requests.delete(_),()=>this._requests.delete(_)),_}}async makeRequestWithTokens(n,i){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(n,i,a,l).getPromise()}}const zz="@firebase/storage",Yz="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xX="storage";function hve(s,n,i){return s=Uo(s),sve(s,n,i)}function pve(s){return s=Uo(s),ave(s)}function fve(s,n){return s=Uo(s),dve(s,n)}function mve(s=kK(),n){s=Uo(s);const a=OK(s,xX).getImmediate({identifier:n}),l=bK("storage");return l&&gve(a,...l),a}function gve(s,n,i,a={}){uve(s,n,i,a)}function _ve(s,{instanceIdentifier:n}){const i=s.getProvider("app").getImmediate(),a=s.getProvider("auth-internal"),l=s.getProvider("app-check-internal");return new qj(i,a,l,n,xK)}function Eve(){s0(new Vv(xX,_ve,"PUBLIC").setMultipleInstances(!0)),qf(zz,Yz,""),qf(zz,Yz,"esm2017")}Eve();const Fa=[];for(let s=0;s<256;++s)Fa.push((s+256).toString(16).slice(1));function yve(s,n=0){return(Fa[s[n+0]]+Fa[s[n+1]]+Fa[s[n+2]]+Fa[s[n+3]]+"-"+Fa[s[n+4]]+Fa[s[n+5]]+"-"+Fa[s[n+6]]+Fa[s[n+7]]+"-"+Fa[s[n+8]]+Fa[s[n+9]]+"-"+Fa[s[n+10]]+Fa[s[n+11]]+Fa[s[n+12]]+Fa[s[n+13]]+Fa[s[n+14]]+Fa[s[n+15]]).toLowerCase()}let pM;const vve=new Uint8Array(16);function Sve(){if(!pM){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");pM=crypto.getRandomValues.bind(crypto)}return pM(vve)}const Tve=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),qz={randomUUID:Tve};function bve(s,n,i){var l;if(qz.randomUUID&&!s)return qz.randomUUID();s=s||{};const a=s.random??((l=s.rng)==null?void 0:l.call(s))??Sve();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=a[6]&15|64,a[8]=a[8]&63|128,yve(a)}var wve="firebase",Rve="11.6.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */qf(wve,Rve,"app");const Cve={apiKey:"AIzaSyCiNsVroKUMWkDhkJHsAZOzWk1LRJ7xhwc",authDomain:"awpl-connect.firebaseapp.com",projectId:"awpl-connect",storageBucket:"awpl-connect.firebasestorage.app",messagingSenderId:"112089804788",appId:"1:112089804788:web:46a038ed92ca81d91413a1",measurementId:"G-NYP0G4B40L"},PX=PK(Cve),Rw=FEe(PX),Ave=mve(PX),Ive=s=>{if(typeof s!="string")return!1;const n=/\.(jpg|jpeg|png|gif|webp|bmp|tiff|svg)(\?.*)?(#.*)?$/i;return(s.startsWith("http://")||s.startsWith("https://"))&&n.test(s)};function Nve({chat_id:s,senderImg:n,receiverImg:i}){const[a,l]=F.useState([]),[p,_]=F.useState(""),[T,w]=F.useState(null),[C,O]=F.useState(!1),k=F.useRef(null),U=s,G=s.split("_"),z=G[1],J=G[2],X=se=>se?new Date(se).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}):"",ie=(se,be)=>{if(!se||!be)return!1;const ee=new Date(se),Q=new Date(be);return ee.getFullYear()===Q.getFullYear()&&ee.getMonth()===Q.getMonth()&&ee.getDate()===Q.getDate()};F.useEffect(()=>{if(!U){console.warn("chatId is missing, skipping message fetch.");return}const se=jz(lM(Rw,"chats",U,"messages"),$Ee("timestamp","asc")),be=Bz(se,ee=>{const Q=ee.docs.map(q=>({id:q.id,...q.data()}));l(Q)});return()=>be()},[U]),F.useEffect(()=>{k.current&&(k.current.scrollTop=k.current.scrollHeight)},[a]),F.useEffect(()=>{if(!U||!z||!J)return;const se=jz(lM(Rw,"chats",U,"messages"),Uz("senderId","==",J),Uz("seen","==",!1)),be=Bz(se,ee=>{if(!ee.empty){const Q=iye(Rw);ee.docs.forEach(q=>{const ae=nX(Rw,"chats",U,"messages",q.id);Q.update(ae,{seen:!0})}),Q.commit().then(()=>{}).catch(q=>{console.error("Error marking messages as seen:",q)})}});return()=>be()},[U,z,J]);const oe=se=>{se.target.files[0]&&w(se.target.files[0])},ce=()=>{w(null);const se=document.getElementById("fileInput");se&&(se.value="")},_e=async se=>{if(se.preventDefault(),!p.trim()&&!T)return;O(!0);const be=Date.now();let ee={senderId:z,receiverId:J,timestamp:be,seen:!1,type:"text"};try{if(T){const Q=`chat_images/${U}/${bve()}-${T.name}`,q=fve(Ave,Q),ae=await hve(q,T),re=await pve(ae.ref);ee={...ee,type:"image",message:re}}else ee={...ee,type:"text",message:p};await tye(lM(Rw,"chats",U,"messages"),ee),_(""),w(null),ce()}catch(Q){console.error("Error sending message:",Q)}finally{O(!1)}};return m.jsx("div",{className:"completed-appoint-scrn-right col-lg-6",children:m.jsx("div",{className:"completed-appoint-chat-scrn",children:m.jsxs("div",{className:"chat-container",style:{padding:"20px",maxHeight:"600px"},children:[m.jsx("div",{className:"chat-messages",ref:k,style:{height:"400px",overflowY:"scroll",marginBottom:"10px",WebkitOverflowScrolling:"touch",overflowX:"hidden"},children:a.map((se,be)=>{var pe,Re,Ge,ve;const ee=se.senderId===z,Q="#DAEFF9",q=ee?"flex-end":"flex-start",ae={borderTopLeftRadius:"12px",borderTopRightRadius:"4px",borderBottomLeftRadius:"12px",borderBottomRightRadius:"12px"},re={borderTopLeftRadius:"4px",borderTopRightRadius:"12px",borderBottomLeftRadius:"12px",borderBottomRightRadius:"12px"};let fe=!1;if(se.timestamp)if(be===0)fe=!0;else{const Ne=a[be-1],Ce=(pe=Ne.timestamp)!=null&&pe.toDate?Ne.timestamp.toDate().getTime():Ne.timestamp,Ue=(Re=se.timestamp)!=null&&Re.toDate?se.timestamp.toDate().getTime():se.timestamp;Ne&&Ce?fe=!ie(Ue,Ce):fe=!0}return m.jsxs(We.Fragment,{children:[fe&&m.jsxs("div",{style:{textAlign:"center",margin:"20px 0 10px",position:"relative",fontSize:"13px",color:"#666"},children:[m.jsx("span",{style:{backgroundColor:"#f0f2f5",padding:"5px 12px",borderRadius:"15px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:X((Ge=se.timestamp)!=null&&Ge.toDate?se.timestamp.toDate().getTime():se.timestamp)}),m.jsx("div",{style:{position:"absolute",top:"50%",left:"0",right:"0",height:"1px",backgroundColor:"#e0e0e0",zIndex:-1}})]}),m.jsxs("div",{style:{display:"flex",justifyContent:q,margin:"8px 0",alignItems:"flex-end"},children:[!ee&&m.jsx("div",{style:{marginRight:"8px"},children:m.jsx("img",{src:i,alt:"Receiver Avatar",style:{width:"40px",height:"40px",borderRadius:"50%",objectFit:"cover"}})}),m.jsxs("div",{style:{padding:"10px 14px",backgroundColor:Q,maxWidth:"70%",fontSize:"14px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",wordBreak:"break-word",...ee?ae:re},children:[Ive(se.message)?m.jsx("img",{src:se.message,alt:"Message attachment",style:{maxWidth:"100%",width:"200px",height:"250px",objectFit:"cover",borderRadius:"8px",display:"block"},onError:Ne=>{console.error("Error loading image from URL:",Ne.target.src),Ne.target.style.display="none"}}):se.message&&m.jsx("div",{children:se.message}),m.jsxs("div",{style:{fontSize:"10px",color:"#666",marginTop:"6px",textAlign:ee?"right":"left",display:"flex",alignItems:"center",justifyContent:ee?"flex-end":"flex-start",gap:"4px",alignSelf:"flex-end"},children:[se.timestamp?new Date((ve=se.timestamp)!=null&&ve.toDate?se.timestamp.toDate().getTime():se.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",ee&&(se.seen?m.jsx("span",{style:{color:"#007bff",marginLeft:"4px"},children:""}):m.jsx("span",{style:{color:"#888",marginLeft:"4px"},children:""}))]})]}),ee&&m.jsx("div",{style:{marginLeft:"8px"},children:m.jsx("img",{src:n,alt:"Sender Avatar",style:{width:"40px",height:"40px",borderRadius:"50%",objectFit:"cover"}})})]})]},se.id)})}),T&&m.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px",backgroundColor:"#f9f9f9",borderRadius:"8px",marginBottom:"10px",border:"1px solid #eee"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[m.jsx("img",{src:URL.createObjectURL(T),alt:"Selected preview",style:{width:"50px",height:"50px",objectFit:"cover",borderRadius:"4px",marginRight:"10px"}}),m.jsx("span",{style:{fontSize:"13px",color:"#555"},children:T.name})]}),m.jsx("button",{type:"button",onClick:ce,style:{background:"none",border:"none",color:"#ff4d4d",fontSize:"20px",cursor:"pointer",padding:"5px",lineHeight:"1"},disabled:C,children:""})]}),m.jsxs("form",{onSubmit:_e,className:"chat-footer",style:{display:"flex",alignItems:"center",gap:"10px"},children:[m.jsxs("div",{className:"chat-input",style:{flex:1,position:"relative"},children:[m.jsx("input",{type:"text",value:p,onChange:se=>_(se.target.value),placeholder:C?"Uploading image...":"Type a message",style:{width:"100%",padding:"10px 45px 10px 15px",borderRadius:"30px",border:"1px solid #ccc"},disabled:C}),m.jsxs("div",{className:"chat-file-upld",style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)"},children:[m.jsx("input",{type:"file",style:{display:"none"},id:"fileInput",accept:"image/*",onChange:oe,disabled:C}),m.jsx("label",{htmlFor:"fileInput",className:"attach-btn",style:{cursor:"pointer"},children:m.jsx("img",{src:"./images/attach-icon.svg",alt:"Attach"})})]})]}),m.jsx("button",{type:"submit",className:"send-btn",disabled:C||!p.trim()&&!T,children:m.jsx("img",{src:"./images/send-icon.svg",alt:"Icon"})})]})]})})})}const Ove=()=>{var J,X,ie,oe,ce,_e,se,be,ee,Q,q;const s=Wi();es();const{id:n,patientId:i,appointmentId:a,chat_id:l,ds_code:p,referred:_,prescription_id:T}=s.state||{},{user:w}=hr(({user:ae})=>ae),C=Pi(),{completeAppointmentPatientDetail:O,prescription_Download:k,loading:U,error:G}=hr(ae=>ae.prescriptions);F.useEffect(()=>{n&&C(XN({appointmentId:n}))},[C,n]),F.useEffect(()=>{C(np())},[]);const z=()=>{C(Kw({prescriptionId:T})).then(ae=>{if(Kw.fulfilled.match(ae)){const re=new Blob([ae.payload],{type:"application/pdf"}),fe=window.URL.createObjectURL(re),pe=document.createElement("a");pe.href=fe,pe.setAttribute("download",`prescription-${n}.pdf`),document.body.appendChild(pe),pe.click(),document.body.removeChild(pe),window.URL.revokeObjectURL(fe)}})};return m.jsx(m.Fragment,{children:m.jsx("main",{className:"doctor-panel",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(za,{})}),U?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsx("div",{className:"doc-panel-body appoint-details-pg",children:m.jsxs("div",{className:"completed-appoint-scrn",children:[m.jsxs("div",{className:"docpnl-sec-head",children:[m.jsx("h1",{className:"h2-title",children:"Prescription Details"}),m.jsx("div",{className:"back-btn",children:m.jsx(mn,{to:"#",onClick:ae=>{ae.preventDefault(),window.history.back()},children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),console.log(T,"****************"),m.jsxs("div",{className:"row",children:[m.jsx("div",{className:"col-lg-6"}),m.jsx("div",{className:"col-lg-6",children:m.jsx("div",{className:"chat-header",children:m.jsx(Qr,{style:{backgroundColor:"#f47820",border:"none"},disabled:!T,className:"orange-btn",onClick:()=>z(),children:"Download Prescription"})})})]}),m.jsxs("div",{className:"completed-appoint-scrn-inr row",children:[m.jsxs("div",{className:"completed-appoint-scrn-left col-lg-6",style:{marginTop:"-100px"},children:[m.jsxs("div",{className:"apointment-detail-card cmn-mb2 mb-4",children:[m.jsx("div",{className:"apoint-dtl-img",children:m.jsx("img",{src:`${li}/${(J=O==null?void 0:O.patientData)==null?void 0:J.patient_image}`,alt:"Client",style:{height:120}})}),m.jsxs("div",{className:"appoint-dtl-content",children:[m.jsxs("div",{className:"appoint-dtl-left",children:[m.jsxs("div",{className:"appoint-dtl-head",children:[m.jsx("h2",{className:"h4-title",children:(X=O==null?void 0:O.patientData)==null?void 0:X.patient_name}),_==!0?m.jsxs("p",{children:["(Referred by DS Code:"," ",m.jsx("span",{style:{color:"#199FD9"},children:p}),")"]}):m.jsxs("p",{style:{fontWeight:"bold"},children:["(DS Code:"," ",m.jsx("span",{style:{color:"#199FD9"},children:p}),")"]})]}),m.jsx("div",{className:"date h3-title",children:(ie=O==null?void 0:O.patientData)==null?void 0:ie.dayDate}),m.jsx("div",{className:"time",children:(oe=O==null?void 0:O.patientData)==null?void 0:oe.time})]}),m.jsx(mn,{to:"/patient-profile",state:{patientId:i,source:"completed",hideSchedule:!1},className:"cmn-btn",children:"View profile"})]})]}),m.jsx("div",{className:"patient-details-wrp",children:m.jsx("form",{children:m.jsx("div",{className:"patient-dtl-form",children:m.jsxs("div",{className:"patient-basic-info",children:[m.jsx("h2",{children:"Basic Information"}),m.jsxs("div",{className:"row",children:[m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Full Name"}),m.jsx("input",{type:"text",value:((ce=O==null?void 0:O.basicInformation)==null?void 0:ce.patient_fullname)||"",readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Height"}),m.jsx("input",{type:"text",value:((_e=O==null?void 0:O.basicInformation)==null?void 0:_e.Patient_height)||"",readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Weight"}),m.jsx("input",{type:"text",value:((se=O==null?void 0:O.basicInformation)==null?void 0:se.Patient_weight)||"",readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Gender"}),m.jsx("input",{type:"text",value:((be=O==null?void 0:O.basicInformation)==null?void 0:be.Patient_gender.charAt(0).toUpperCase())+((ee=O==null?void 0:O.basicInformation)==null?void 0:ee.Patient_gender.slice(1))||"",readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Age"}),m.jsx("input",{type:"text",value:((Q=O==null?void 0:O.basicInformation)==null?void 0:Q.patient_age)||"",readOnly:!0})]})})]})]})})})})]}),m.jsx(Nve,{chat_id:l,senderImg:jc.BaseUrl+(w==null?void 0:w.profile_path),receiverImg:`${li}/${(q=O==null?void 0:O.patientData)==null?void 0:q.patient_image}`})]})]})}),m.jsx(fo,{})]})})})};var rO={exports:{}},Dve=rO.exports,Kz;function xve(){return Kz||(Kz=1,function(s,n){(function(i,a){s.exports=a()})(Dve,function(){function i(e,t){return t.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(r,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return r[o]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof gL<"u"?gL:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var p=function(e){try{return!!e()}catch{return!0}},_=!p(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),T=_,w=Function.prototype,C=w.call,O=T&&w.bind.bind(C,C),k=T?O:function(e){return function(){return C.apply(e,arguments)}},U=k({}.isPrototypeOf),G=function(e){return e&&e.Math===Math&&e},z=G(typeof globalThis=="object"&&globalThis)||G(typeof window=="object"&&window)||G(typeof self=="object"&&self)||G(typeof a=="object"&&a)||G(typeof a=="object"&&a)||function(){return this}()||Function("return this")(),J=_,X=Function.prototype,ie=X.apply,oe=X.call,ce=typeof Reflect=="object"&&Reflect.apply||(J?oe.bind(ie):function(){return oe.apply(ie,arguments)}),_e=k,se=_e({}.toString),be=_e("".slice),ee=function(e){return be(se(e),8,-1)},Q=ee,q=k,ae=function(e){if(Q(e)==="Function")return q(e)},re=typeof document=="object"&&document.all,fe=re===void 0&&re!==void 0?function(e){return typeof e=="function"||e===re}:function(e){return typeof e=="function"},pe={},Re=!p(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Ge=_,ve=Function.prototype.call,Ne=Ge?ve.bind(ve):function(){return ve.apply(ve,arguments)},Ce={},Ue={}.propertyIsEnumerable,de=Object.getOwnPropertyDescriptor,De=de&&!Ue.call({1:2},1);Ce.f=De?function(e){var t=de(this,e);return!!t&&t.enumerable}:Ue;var xe,Xe,ut=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Pt=p,It=ee,zt=Object,$t=k("".split),Tt=Pt(function(){return!zt("z").propertyIsEnumerable(0)})?function(e){return It(e)==="String"?$t(e,""):zt(e)}:zt,on=function(e){return e==null},fn=on,Ut=TypeError,yt=function(e){if(fn(e))throw new Ut("Can't call method on "+e);return e},an=Tt,Dt=yt,wt=function(e){return an(Dt(e))},rt=fe,xt=function(e){return typeof e=="object"?e!==null:rt(e)},Mt={},Bn=Mt,ki=z,zi=fe,Cr=function(e){return zi(e)?e:void 0},Un=function(e,t){return arguments.length<2?Cr(Bn[e])||Cr(ki[e]):Bn[e]&&Bn[e][t]||ki[e]&&ki[e][t]},Li=z.navigator,vt=Li&&Li.userAgent,Bt=vt?String(vt):"",bt=z,rn=Bt,Qn=bt.process,Ar=bt.Deno,$r=Qn&&Qn.versions||Ar&&Ar.version,br=$r&&$r.v8;br&&(Xe=(xe=br.split("."))[0]>0&&xe[0]<4?1:+(xe[0]+xe[1])),!Xe&&rn&&(!(xe=rn.match(/Edge\/(\d+)/))||xe[1]>=74)&&(xe=rn.match(/Chrome\/(\d+)/))&&(Xe=+xe[1]);var ji=Xe,ts=ji,ns=p,Ra=z.String,Cs=!!Object.getOwnPropertySymbols&&!ns(function(){var e=Symbol("symbol detection");return!Ra(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ts&&ts<41}),Ca=Cs&&!Symbol.sham&&typeof Symbol.iterator=="symbol",je=Un,sn=fe,cn=U,Yn=Object,Ke=Ca?function(e){return typeof e=="symbol"}:function(e){var t=je("Symbol");return sn(t)&&cn(t.prototype,Yn(e))},Yt=String,un=function(e){try{return Yt(e)}catch{return"Object"}},tn=fe,yn=un,ri=TypeError,ln=function(e){if(tn(e))return e;throw new ri(yn(e)+" is not a function")},or=ln,pr=on,qr=function(e,t){var r=e[t];return pr(r)?void 0:or(r)},rs=Ne,mo=fe,Hs=xt,Wc=TypeError,Ya={exports:{}},Aa=z,Vo=Object.defineProperty,go=z,_o=function(e,t){try{Vo(Aa,e,{value:t,configurable:!0,writable:!0})}catch{Aa[e]=t}return t},As="__core-js_shared__",Ui=Ya.exports=go[As]||_o(As,{});(Ui.versions||(Ui.versions=[])).push({version:"3.41.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.41.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Yu=Ya.exports,qu=Yu,fa=function(e,t){return qu[e]||(qu[e]=t||{})},Ml=yt,W_=Object,Eo=function(e){return W_(Ml(e))},Ku=Eo,z_=k({}.hasOwnProperty),hi=Object.hasOwn||function(e,t){return z_(Ku(e),t)},zc=k,na=0,Xu=Math.random(),Y_=zc(1 .toString),pc=function(e){return"Symbol("+(e===void 0?"":e)+")_"+Y_(++na+Xu,36)},yp=fa,Qu=hi,dm=pc,vp=Cs,Ia=Ca,Yc=z.Symbol,um=yp("wks"),Sp=Ia?Yc.for||Yc:Yc&&Yc.withoutSetter||dm,jr=function(e){return Qu(um,e)||(um[e]=vp&&Qu(Yc,e)?Yc[e]:Sp("Symbol."+e)),um[e]},$u=Ne,q_=xt,is=Ke,yo=qr,Ju=function(e,t){var r,o;if(mo(r=e.toString)&&!Hs(o=rs(r,e))||mo(r=e.valueOf)&&!Hs(o=rs(r,e)))return o;throw new Wc("Can't convert object to primitive value")},Od=TypeError,jl=jr("toPrimitive"),ii=function(e,t){if(!q_(e)||is(e))return e;var r,o=yo(e,jl);if(o){if(r=$u(o,e,t),!q_(r)||is(r))return r;throw new Od("Can't convert object to primitive value")}return Ju(e)},Zu=Ke,qa=function(e){var t=ii(e,"string");return Zu(t)?t:t+""},Dd=xt,Tp=z.document,hm=Dd(Tp)&&Dd(Tp.createElement),eh=function(e){return hm?Tp.createElement(e):{}},hS=eh,K_=!Re&&!p(function(){return Object.defineProperty(hS("div"),"a",{get:function(){return 7}}).a!==7}),bp=Re,Ul=Ne,Fo=Ce,Vl=ut,Fl=wt,pm=qa,qc=hi,X_=K_,xd=Object.getOwnPropertyDescriptor;pe.f=bp?xd:function(e,t){if(e=Fl(e),t=pm(t),X_)try{return xd(e,t)}catch{}if(qc(e,t))return Vl(!Ul(Fo.f,e,t),e[t])};var fc=p,Bo=fe,th=/#|\.prototype\./,Ka=function(e,t){var r=Bl[Pd(e)];return r===Kc||r!==fm&&(Bo(t)?fc(t):!!t)},Pd=Ka.normalize=function(e){return String(e).replace(th,".").toLowerCase()},Bl=Ka.data={},fm=Ka.NATIVE="N",Kc=Ka.POLYFILL="P",mc=Ka,mm=ln,Gs=_,Kr=ae(ae.bind),vo=function(e,t){return mm(e),t===void 0?e:Gs?Kr(e,t):function(){return e.apply(t,arguments)}},Ws={},gm=Re&&p(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),wp=xt,Rp=String,Xc=TypeError,ss=function(e){if(wp(e))return e;throw new Xc(Rp(e)+" is not an object")},Ho=Re,Q_=K_,pS=gm,Qc=ss,nh=qa,_m=TypeError,kd=Object.defineProperty,$_=Object.getOwnPropertyDescriptor,Ld="enumerable",Em="configurable",rh="writable";Ws.f=Ho?pS?function(e,t,r){if(Qc(e),t=nh(t),Qc(r),typeof e=="function"&&t==="prototype"&&"value"in r&&rh in r&&!r[rh]){var o=$_(e,t);o&&o[rh]&&(e[t]=r.value,r={configurable:Em in r?r[Em]:o[Em],enumerable:Ld in r?r[Ld]:o[Ld],writable:!1})}return kd(e,t,r)}:kd:function(e,t,r){if(Qc(e),t=nh(t),Qc(r),Q_)try{return kd(e,t,r)}catch{}if("get"in r||"set"in r)throw new _m("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var ih=Ws,J_=ut,$c=Re?function(e,t,r){return ih.f(e,t,J_(1,r))}:function(e,t,r){return e[t]=r,e},Hl=z,sh=ce,Z_=ae,Cp=fe,eE=pe.f,ym=mc,Xa=Mt,tE=vo,Gl=$c,vm=hi,nE=function(e){var t=function(r,o,c){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,o)}return new e(r,o,c)}return sh(e,this,arguments)};return t.prototype=e.prototype,t},Pn=function(e,t){var r,o,c,u,f,g,E,v,S,R=e.target,I=e.global,D=e.stat,V=e.proto,M=I?Hl:D?Hl[R]:Hl[R]&&Hl[R].prototype,j=I?Xa:Xa[R]||Gl(Xa,R,{})[R],W=j.prototype;for(u in t)o=!(r=ym(I?u:R+(D?".":"#")+u,e.forced))&&M&&vm(M,u),g=j[u],o&&(E=e.dontCallGetSet?(S=eE(M,u))&&S.value:M[u]),f=o&&E?E:t[u],(r||V||typeof g!=typeof f)&&(v=e.bind&&o?tE(f,Hl):e.wrap&&o?nE(f):V&&Cp(f)?Z_(f):f,(e.sham||f&&f.sham||g&&g.sham)&&Gl(v,"sham",!0),Gl(j,u,v),V&&(vm(Xa,c=R+"Prototype")||Gl(Xa,c,{}),Gl(Xa[c],u,f),e.real&&W&&(r||!W[u])&&Gl(W,u,f)))},Na=Math.ceil,rE=Math.floor,iE=Math.trunc||function(e){var t=+e;return(t>0?rE:Na)(t)},Jc=iE,A=function(e){var t=+e;return t!=t||t===0?0:Jc(t)},B=A,$=Math.max,ge=Math.min,Ve=function(e,t){var r=B(e);return r<0?$(r+t,0):ge(r,t)},Je=A,Nt=Math.min,Sr=function(e){var t=Je(e);return t>0?Nt(t,9007199254740991):0},Is=Sr,qn=function(e){return Is(e.length)},zs=wt,Ns=Ve,Wl=qn,Ys=function(e){return function(t,r,o){var c=zs(t),u=Wl(c);if(u===0)return!e&&-1;var f,g=Ns(o,u);if(e&&r!=r){for(;u>g;)if((f=c[g++])!=f)return!0}else for(;u>g;g++)if((e||g in c)&&c[g]===r)return e||g||0;return!e&&-1}},Go={includes:Ys(!0),indexOf:Ys(!1)},Sm=Go.includes;Pn({target:"Array",proto:!0,forced:p(function(){return!Array(1).includes()})},{includes:function(e){return Sm(this,e,arguments.length>1?arguments[1]:void 0)}});var sE=z,k0=Mt,So=function(e,t){var r=k0[e+"Prototype"],o=r&&r[t];if(o)return o;var c=sE[e],u=c&&c.prototype;return u&&u[t]},fS=So("Array","includes"),mS=xt,L0=ee,M0=jr("match"),gS=function(e){var t;return mS(e)&&((t=e[M0])!==void 0?!!t:L0(e)==="RegExp")},HD=gS,GD=TypeError,j0={};j0[jr("toStringTag")]="z";var _S=String(j0)==="[object z]",WD=_S,To=fe,Md=ee,U0=jr("toStringTag"),V0=Object,F0=Md(function(){return arguments}())==="Arguments",zl=WD?Md:function(e){var t,r,o;return e===void 0?"Undefined":e===null?"Null":typeof(r=function(c,u){try{return c[u]}catch{}}(t=V0(e),U0))=="string"?r:F0?Md(t):(o=Md(t))==="Object"&&To(t.callee)?"Arguments":o},ES=zl,zD=String,Os=function(e){if(ES(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return zD(e)},yS=jr("match"),Tm=Pn,vS=function(e){if(HD(e))throw new GD("The method doesn't accept regular expressions");return e},B0=yt,jd=Os,Ap=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[yS]=!1,"/./"[e](t)}catch{}}return!1},SS=k("".indexOf);Tm({target:"String",proto:!0,forced:!Ap("includes")},{includes:function(e){return!!~SS(jd(B0(this)),jd(vS(e)),arguments.length>1?arguments[1]:void 0)}});var H0=So("String","includes"),Ud=U,G0=fS,W0=H0,aE=Array.prototype,TS=String.prototype,YD=function(e){var t=e.includes;return e===aE||Ud(aE,e)&&t===aE.includes?G0:typeof e=="string"||e===TS||Ud(TS,e)&&t===TS.includes?W0:t},Ze=l(YD),z0=ln,Y0=Eo,bS=Tt,gc=qn,wS=TypeError,bo="Reduce of empty array with no initial value",Wo=function(e){return function(t,r,o,c){var u=Y0(t),f=bS(u),g=gc(u);if(z0(r),g===0&&o<2)throw new wS(bo);var E=e?g-1:0,v=e?-1:1;if(o<2)for(;;){if(E in f){c=f[E],E+=v;break}if(E+=v,e?E<0:g<=E)throw new wS(bo)}for(;e?E>=0:g>E;E+=v)E in f&&(c=r(c,f[E],E,u));return c}},Ip={left:Wo(!1)},RS=p,ah=function(e,t){var r=[][e];return!!r&&RS(function(){r.call(null,t||function(){return 1},1)})},Vd=z,CS=Bt,Np=ee,bm=function(e){return CS.slice(0,e.length)===e},Op=bm("Bun/")?"BUN":bm("Cloudflare-Workers")?"CLOUDFLARE":bm("Deno/")?"DENO":bm("Node.js/")?"NODE":Vd.Bun&&typeof Bun.version=="string"?"BUN":Vd.Deno&&typeof Deno.version=="object"?"DENO":Np(Vd.process)==="process"?"NODE":Vd.window&&Vd.document?"BROWSER":"REST",Yl=Op==="NODE",qD=Ip.left;Pn({target:"Array",proto:!0,forced:!Yl&&ji>79&&ji<83||!ah("reduce")},{reduce:function(e){var t=arguments.length;return qD(this,e,t,t>1?arguments[1]:void 0)}});var wo=So("Array","reduce"),AS=U,ql=wo,oE=Array.prototype,cE=function(e){var t=e.reduce;return e===oE||AS(oE,e)&&t===oE.reduce?ql:t},Fd=cE,Qa=l(Fd),IS=ee,Zc=Array.isArray||function(e){return IS(e)==="Array"},Dp=Pn,lE=Zc,dE=k([].reverse),Ro=[1,2];Dp({target:"Array",proto:!0,forced:String(Ro)===String(Ro.reverse())},{reverse:function(){return lE(this)&&(this.length=this.length),dE(this)}});var zo=So("Array","reverse"),oh=U,Kl=zo,_c=Array.prototype,ch=function(e){var t=e.reverse;return e===_c||oh(_c,e)&&t===_c.reverse?Kl:t},NS=ch,uE=l(NS),OS=pc,ma=fa("keys"),Ii=function(e){return ma[e]||(ma[e]=OS(e))},Ur=!p(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),lh=hi,el=fe,DS=Eo,dh=Ur,xS=Ii("IE_PROTO"),hE=Object,wm=hE.prototype,uh=dh?hE.getPrototypeOf:function(e){var t=DS(e);if(lh(t,xS))return t[xS];var r=t.constructor;return el(r)&&t instanceof r?r.prototype:t instanceof hE?wm:null},q0=k,Rm=ln,PS=xt,hh=function(e){return PS(e)||e===null},Xl=String,Bd=TypeError,Ql=function(e,t,r){try{return q0(Rm(Object.getOwnPropertyDescriptor(e,t)[r]))}catch{}},kS=xt,LS=yt,Cm=function(e){if(hh(e))return e;throw new Bd("Can't set "+Xl(e)+" as a prototype")},pE=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Ql(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch{}return function(o,c){return LS(o),Cm(c),kS(o)&&(t?e(o,c):o.__proto__=c),o}}():void 0),tl={},Ds={},xp=hi,K0=wt,KD=Go.indexOf,XD=Ds,X0=k([].push),fs=function(e,t){var r,o=K0(e),c=0,u=[];for(r in o)!xp(XD,r)&&xp(o,r)&&X0(u,r);for(;t.length>c;)xp(o,r=t[c++])&&(~KD(u,r)||X0(u,r));return u},Am=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Im=fs,Nm=Am.concat("length","prototype");tl.f=Object.getOwnPropertyNames||function(e){return Im(e,Nm)};var ph={};ph.f=Object.getOwnPropertySymbols;var Pp=Un,kp=tl,QD=ph,Q0=ss,$D=k([].concat),$0=Pp("Reflect","ownKeys")||function(e){var t=kp.f(Q0(e)),r=QD.f;return r?$D(t,r(e)):t},Hd=hi,MS=$0,fE=pe,J0=Ws,fh={},Z0=fs,mE=Am,Lp=Object.keys||function(e){return Z0(e,mE)},eR=Re,gE=gm,tR=Ws,Om=ss,nR=wt,rR=Lp;fh.f=eR&&!gE?Object.defineProperties:function(e,t){Om(e);for(var r,o=nR(t),c=rR(t),u=c.length,f=0;u>f;)tR.f(e,r=c[f++],o[r]);return e};var Ec,_E=Un("document","documentElement"),jS=ss,Gd=fh,$l=Am,Dm=Ds,US=_E,VS=eh,mh="prototype",gh="script",FS=Ii("IE_PROTO"),EE=function(){},_h=function(e){return"<"+gh+">"+e+"</"+gh+">"},xm=function(e){e.write(_h("")),e.close();var t=e.parentWindow.Object;return e=null,t},Pm=function(){try{Ec=new ActiveXObject("htmlfile")}catch{}var e,t,r;Pm=typeof document<"u"?document.domain&&Ec?xm(Ec):(t=VS("iframe"),r="java"+gh+":",t.style.display="none",US.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(_h("document.F=Object")),e.close(),e.F):xm(Ec);for(var o=$l.length;o--;)delete Pm[mh][$l[o]];return Pm()};Dm[FS]=!0;var Eh=Object.create||function(e,t){var r;return e!==null?(EE[mh]=jS(e),r=new EE,EE[mh]=null,r[FS]=e):r=Pm(),t===void 0?r:Gd.f(r,t)},BS=xt,Wd=$c,$n=Error,si=k("".replace),ms=String(new $n("zxcasd").stack),km=/\n\s*at [^:]*:[^\n]*/,Mp=km.test(ms),yh=ut,yE=!p(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",yh(1,7)),e.stack!==7)}),Lm=$c,jp=function(e,t){if(Mp&&typeof e=="string"&&!$n.prepareStackTrace)for(;t--;)e=si(e,km,"");return e},JD=yE,Yi=Error.captureStackTrace,zd={},HS=zd,iR=jr("iterator"),sR=Array.prototype,aR=function(e){return e!==void 0&&(HS.Array===e||sR[iR]===e)},GS=zl,vE=qr,WS=on,$a=zd,gs=jr("iterator"),Up=function(e){if(!WS(e))return vE(e,gs)||vE(e,"@@iterator")||$a[GS(e)]},Mm=Ne,SE=ln,zS=ss,Jl=un,TE=Up,YS=TypeError,jm=function(e,t){var r=arguments.length<2?TE(e):t;if(SE(r))return zS(Mm(r,e));throw new YS(Jl(e)+" is not iterable")},oR=Ne,qS=ss,cR=qr,KS=function(e,t,r){var o,c;qS(e);try{if(!(o=cR(e,"return"))){if(t==="throw")throw r;return r}o=oR(o,e)}catch(u){c=!0,o=u}if(t==="throw")throw r;if(c)throw o;return qS(o),r},lR=vo,dR=Ne,XS=ss,uR=un,ZD=aR,hR=qn,QS=U,pR=jm,$S=Up,JS=KS,fR=TypeError,Um=function(e,t){this.stopped=e,this.result=t},ZS=Um.prototype,Vp=function(e,t,r){var o,c,u,f,g,E,v,S=r&&r.that,R=!(!r||!r.AS_ENTRIES),I=!(!r||!r.IS_RECORD),D=!(!r||!r.IS_ITERATOR),V=!(!r||!r.INTERRUPTED),M=lR(t,S),j=function(Y){return o&&JS(o,"normal",Y),new Um(!0,Y)},W=function(Y){return R?(XS(Y),V?M(Y[0],Y[1],j):M(Y[0],Y[1])):V?M(Y,j):M(Y)};if(I)o=e.iterator;else if(D)o=e;else{if(!(c=$S(e)))throw new fR(uR(e)+" is not iterable");if(ZD(c)){for(u=0,f=hR(e);f>u;u++)if((g=W(e[u]))&&QS(ZS,g))return g;return new Um(!1)}o=pR(e,c)}for(E=I?e.next:o.next;!(v=dR(E,o)).done;){try{g=W(v.value)}catch(Y){JS(o,"throw",Y)}if(typeof g=="object"&&g&&QS(ZS,g))return g}return new Um(!1)},ex=Os,mR=Pn,Fp=U,bE=uh,Vm=pE,wE=function(e,t,r){for(var o=MS(t),c=J0.f,u=fE.f,f=0;f<o.length;f++){var g=o[f];Hd(e,g)||r&&Hd(r,g)||c(e,g,u(t,g))}},Bp=Eh,RE=$c,CE=ut,gR=function(e,t){BS(t)&&"cause"in t&&Wd(e,"cause",t.cause)},_R=function(e,t,r,o){JD&&(Yi?Yi(e,t):Lm(e,"stack",jp(r,o)))},ER=Vp,yR=function(e,t){return e===void 0?arguments.length<2?"":t:ex(e)},eT=jr("toStringTag"),Fm=Error,vR=[].push,Yd=function(e,t){var r,o=Fp(AE,this);Vm?r=Vm(new Fm,o?bE(this):AE):(r=o?this:Bp(AE),RE(r,eT,"Error")),t!==void 0&&RE(r,"message",yR(t)),_R(r,Yd,r.stack,1),arguments.length>2&&gR(r,arguments[2]);var c=[];return ER(e,vR,{that:c}),RE(r,"errors",c),r};Vm?Vm(Yd,Fm):wE(Yd,Fm,{name:!0});var AE=Yd.prototype=Bp(Fm.prototype,{constructor:CE(1,Yd),message:CE(1,""),name:CE(1,"AggregateError")});mR({global:!0},{AggregateError:Yd});var Bm,Hm,Hp,SR=fe,tT=z.WeakMap,nT=SR(tT)&&/native code/.test(String(tT)),rT=z,TR=xt,tx=$c,iT=hi,IE=Yu,Gm=Ii,sT=Ds,Wm="Object already initialized",NE=rT.TypeError,bR=rT.WeakMap;if(nT||IE.state){var Co=IE.state||(IE.state=new bR);Co.get=Co.get,Co.has=Co.has,Co.set=Co.set,Bm=function(e,t){if(Co.has(e))throw new NE(Wm);return t.facade=e,Co.set(e,t),t},Hm=function(e){return Co.get(e)||{}},Hp=function(e){return Co.has(e)}}else{var vh=Gm("state");sT[vh]=!0,Bm=function(e,t){if(iT(e,vh))throw new NE(Wm);return t.facade=e,tx(e,vh,t),t},Hm=function(e){return iT(e,vh)?e[vh]:{}},Hp=function(e){return iT(e,vh)}}var qd,wR,Sh,yc={set:Bm,get:Hm,has:Hp,enforce:function(e){return Hp(e)?Hm(e):Bm(e,{})},getterFor:function(e){return function(t){var r;if(!TR(t)||(r=Hm(t)).type!==e)throw new NE("Incompatible receiver, "+e+" required");return r}}},Gp=Re,zm=hi,Ym=Function.prototype,RR=Gp&&Object.getOwnPropertyDescriptor,aT=zm(Ym,"name"),Th={PROPER:aT&&(function(){}).name==="something",CONFIGURABLE:aT&&(!Gp||Gp&&RR(Ym,"name").configurable)},CR=$c,xs=function(e,t,r,o){return o&&o.enumerable?e[t]=r:CR(e,t,r),e},nl=p,Kd=fe,AR=xt,Xd=Eh,rl=uh,Ps=xs,Wp=jr("iterator"),OE=!1;[].keys&&("next"in(Sh=[].keys())?(wR=rl(rl(Sh)))!==Object.prototype&&(qd=wR):OE=!0);var oT=!AR(qd)||nl(function(){var e={};return qd[Wp].call(e)!==e});Kd((qd=oT?{}:Xd(qd))[Wp])||Ps(qd,Wp,function(){return this});var cT={IteratorPrototype:qd,BUGGY_SAFARI_ITERATORS:OE},IR=zl,bh=_S?{}.toString:function(){return"[object "+IR(this)+"]"},DE=_S,NR=Ws.f,OR=$c,DR=hi,xE=bh,lT=jr("toStringTag"),vc=function(e,t,r,o){var c=r?e:e&&e.prototype;c&&(DR(c,lT)||NR(c,lT,{configurable:!0,value:t}),o&&!DE&&OR(c,"toString",xE))},xR=cT.IteratorPrototype,PR=Eh,nx=ut,kR=vc,qs=zd,ra=function(){return this},PE=function(e,t,r,o){var c=t+" Iterator";return e.prototype=PR(xR,{next:nx(+!o,r)}),kR(e,c,!1,!0),qs[c]=ra,e},LR=Pn,MR=Ne,jR=Th,UR=PE,kE=uh,dT=vc,uT=xs,hT=zd,VR=cT,pT=jR.PROPER,zp=VR.BUGGY_SAFARI_ITERATORS,qm=jr("iterator"),fT="keys",Yp="values",Km="entries",mT=function(){return this},gT=function(e,t,r,o,c,u,f){UR(r,t,o);var g,E,v,S=function(W){if(W===c&&M)return M;if(!zp&&W&&W in D)return D[W];switch(W){case fT:case Yp:case Km:return function(){return new r(this,W)}}return function(){return new r(this)}},R=t+" Iterator",I=!1,D=e.prototype,V=D[qm]||D["@@iterator"]||c&&D[c],M=!zp&&V||S(c),j=t==="Array"&&D.entries||V;if(j&&(g=kE(j.call(new e)))!==Object.prototype&&g.next&&(dT(g,R,!0,!0),hT[R]=mT),pT&&c===Yp&&V&&V.name!==Yp&&(I=!0,M=function(){return MR(V,this)}),c)if(E={values:S(Yp),keys:u?M:S(fT),entries:S(Km)},f)for(v in E)(zp||I||!(v in D))&&uT(D,v,E[v]);else LR({target:t,proto:!0,forced:zp||I},E);return f&&D[qm]!==M&&uT(D,qm,M,{}),hT[t]=M,E},qp=function(e,t){return{value:e,done:t}},FR=wt,il=zd,LE=yc;Ws.f;var rx=gT,Xm=qp,sl="Array Iterator",BR=LE.set,ME=LE.getterFor(sl);rx(Array,"Array",function(e,t){BR(this,{type:sl,target:FR(e),index:0,kind:t})},function(){var e=ME(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,Xm(void 0,!0);switch(e.kind){case"keys":return Xm(r,!1);case"values":return Xm(t[r],!1)}return Xm([r,t[r]],!1)},"values"),il.Arguments=il.Array;var Qm=Ws,bi=function(e,t,r){return Qm.f(e,t,r)},ix=Un,sx=bi,HR=Re,Kp=jr("species"),Qd=U,GR=TypeError,jE=function(e,t){if(Qd(t,e))return e;throw new GR("Incorrect invocation")},$m=fe,Yo=Yu,WR=k(Function.toString);$m(Yo.inspectSource)||(Yo.inspectSource=function(e){return WR(e)});var UE=Yo.inspectSource,zR=k,_T=p,VE=fe,FE=zl,YR=UE,al=function(){},qi=Un("Reflect","construct"),Jm=/^\s*(?:class|function)\b/,qR=zR(Jm.exec),Ks=!Jm.test(al),Zm=function(e){if(!VE(e))return!1;try{return qi(al,[],e),!0}catch{return!1}},ET=function(e){if(!VE(e))return!1;switch(FE(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ks||!!qR(Jm,YR(e))}catch{return!0}};ET.sham=!0;var Xp,Jr,Oa,Sc,eg=!qi||_T(function(){var e;return Zm(Zm.call)||!Zm(Object)||!Zm(function(){e=!0})||e})?ET:Zm,KR=eg,ax=un,yT=TypeError,Ja=ss,Tc=function(e){if(KR(e))return e;throw new yT(ax(e)+" is not a constructor")},XR=on,Ao=jr("species"),BE=function(e,t){var r,o=Ja(e).constructor;return o===void 0||XR(r=Ja(o)[Ao])?t:Tc(r)},Da=k([].slice),wh=TypeError,Za=function(e,t){if(e<t)throw new wh("Not enough arguments");return e},HE=/(?:ipad|iphone|ipod).*applewebkit/i.test(Bt),xa=z,ol=ce,QR=vo,Rh=fe,tg=hi,Qp=p,Ch=_E,$R=Da,vT=eh,ng=Za,JR=HE,GE=Yl,WE=xa.setImmediate,ST=xa.clearImmediate,ox=xa.process,Vr=xa.Dispatch,wi=xa.Function,cr=xa.MessageChannel,wr=xa.String,Fr=0,ia={},Zl="onreadystatechange";Qp(function(){Xp=xa.location});var $d=function(e){if(tg(ia,e)){var t=ia[e];delete ia[e],t()}},rg=function(e){return function(){$d(e)}},cl=function(e){$d(e.data)},Vi=function(e){xa.postMessage(wr(e),Xp.protocol+"//"+Xp.host)};WE&&ST||(WE=function(e){ng(arguments.length,1);var t=Rh(e)?e:wi(e),r=$R(arguments,1);return ia[++Fr]=function(){ol(t,void 0,r)},Jr(Fr),Fr},ST=function(e){delete ia[e]},GE?Jr=function(e){ox.nextTick(rg(e))}:Vr&&Vr.now?Jr=function(e){Vr.now(rg(e))}:cr&&!JR?(Sc=(Oa=new cr).port2,Oa.port1.onmessage=cl,Jr=QR(Sc.postMessage,Sc)):xa.addEventListener&&Rh(xa.postMessage)&&!xa.importScripts&&Xp&&Xp.protocol!=="file:"&&!Qp(Vi)?(Jr=Vi,xa.addEventListener("message",cl,!1)):Jr=Zl in vT("script")?function(e){Ch.appendChild(vT("script"))[Zl]=function(){Ch.removeChild(this),$d(e)}}:function(e){setTimeout(rg(e),0)});var bc={set:WE,clear:ST},Jd=z,TT=Re,qo=Object.getOwnPropertyDescriptor,Ah=function(e){if(!TT)return Jd[e];var t=qo(Jd,e);return t&&t.value},$p=function(){this.head=null,this.tail=null};$p.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var ks,ig,sg,Jp,ag,ed=$p,sa=/ipad|iphone|ipod/i.test(Bt)&&typeof Pebble<"u",Zd=/web0s(?!.*chrome)/i.test(Bt),wc=z,Zp=Ah,zE=vo,og=bc.set,ZR=ed,cg=HE,bT=sa,Io=Zd,YE=Yl,eo=wc.MutationObserver||wc.WebKitMutationObserver,wT=wc.document,RT=wc.process,qE=wc.Promise,ll=Zp("queueMicrotask");if(!ll){var Ih=new ZR,ef=function(){var e,t;for(YE&&(e=RT.domain)&&e.exit();t=Ih.get();)try{t()}catch(r){throw Ih.head&&ks(),r}e&&e.enter()};cg||YE||Io||!eo||!wT?!bT&&qE&&qE.resolve?((Jp=qE.resolve(void 0)).constructor=qE,ag=zE(Jp.then,Jp),ks=function(){ag(ef)}):YE?ks=function(){RT.nextTick(ef)}:(og=zE(og,wc),ks=function(){og(ef)}):(ig=!0,sg=wT.createTextNode(""),new eo(ef).observe(sg,{characterData:!0}),ks=function(){sg.data=ig=!ig}),ll=function(e){Ih.head||ks(),Ih.add(e)}}var Nh=ll,Oh=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},eu=z.Promise,eC=z,Dh=eu,CT=fe,cx=mc,lx=UE,dx=jr,AT=Op,KE=ji,xh=Dh&&Dh.prototype,XE=dx("species"),IT=CT(eC.PromiseRejectionEvent),tC=cx("Promise",function(){var e=lx(Dh),t=e!==String(Dh);if(!t&&KE===66||!xh.catch||!xh.finally)return!0;if(!KE||KE<51||!/native code/.test(e)){var r=new Dh(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((r.constructor={})[XE]=o,!(r.then(function(){})instanceof o))return!0}return!(t||AT!=="BROWSER"&&AT!=="DENO"||IT)}),tf={CONSTRUCTOR:tC,REJECTION_EVENT:IT},Rc={},NT=ln,nC=TypeError,QE=function(e){var t,r;this.promise=new e(function(o,c){if(t!==void 0||r!==void 0)throw new nC("Bad Promise constructor");t=o,r=c}),this.resolve=NT(t),this.reject=NT(r)};Rc.f=function(e){return new QE(e)};var $E,OT,pi=Pn,nf=Yl,tu=z,rf=Ne,ux=xs,hx=vc,px=function(e){var t=ix(e);HR&&t&&!t[Kp]&&sx(t,Kp,{configurable:!0,get:function(){return this}})},JE=ln,nu=fe,DT=xt,ZE=jE,xT=BE,ru=bc.set,Ko=Nh,lg=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},fx=Oh,rC=ed,PT=yc,ey=eu,kT=tf,iC=Rc,sf="Promise",LT=kT.CONSTRUCTOR,sC=kT.REJECTION_EVENT,MT=PT.getterFor(sf),jT=PT.set,UT=ey&&ey.prototype,dg=ey,VT=UT,af=tu.TypeError,FT=tu.document,ty=tu.process,rr=iC.f,BT=rr,ny=!!(FT&&FT.createEvent&&tu.dispatchEvent),ry="unhandledrejection",HT=function(e){var t;return!(!DT(e)||!nu(t=e.then))&&t},iy=function(e,t){var r,o,c,u=t.value,f=t.state===1,g=f?e.ok:e.fail,E=e.resolve,v=e.reject,S=e.domain;try{g?(f||(t.rejection===2&&mx(t),t.rejection=1),g===!0?r=u:(S&&S.enter(),r=g(u),S&&(S.exit(),c=!0)),r===e.promise?v(new af("Promise-chain cycle")):(o=HT(r))?rf(o,r,E,v):E(r)):v(u)}catch(R){S&&!c&&S.exit(),v(R)}},of=function(e,t){e.notified||(e.notified=!0,Ko(function(){for(var r,o=e.reactions;r=o.get();)iy(r,e);e.notified=!1,t&&!e.rejection&&cf(e)}))},ug=function(e,t,r){var o,c;ny?((o=FT.createEvent("Event")).promise=t,o.reason=r,o.initEvent(e,!1,!0),tu.dispatchEvent(o)):o={promise:t,reason:r},!sC&&(c=tu["on"+e])?c(o):e===ry&&lg("Unhandled promise rejection",r)},cf=function(e){rf(ru,tu,function(){var t,r=e.facade,o=e.value;if(GT(e)&&(t=fx(function(){nf?ty.emit("unhandledRejection",o,r):ug(ry,r,o)}),e.rejection=nf||GT(e)?2:1,t.error))throw t.value})},GT=function(e){return e.rejection!==1&&!e.parent},mx=function(e){rf(ru,tu,function(){var t=e.facade;nf?ty.emit("rejectionHandled",t):ug("rejectionhandled",t,e.value)})},lf=function(e,t,r){return function(o){e(t,o,r)}},Ph=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,of(e,!0))},sy=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw new af("Promise can't be resolved itself");var o=HT(t);o?Ko(function(){var c={done:!1};try{rf(o,t,lf(sy,c,e),lf(Ph,c,e))}catch(u){Ph(c,u,e)}}):(e.value=t,e.state=1,of(e,!1))}catch(c){Ph({done:!1},c,e)}}};LT&&(VT=(dg=function(e){ZE(this,VT),JE(e),rf($E,this);var t=MT(this);try{e(lf(sy,t),lf(Ph,t))}catch(r){Ph(t,r)}}).prototype,($E=function(e){jT(this,{type:sf,done:!1,notified:!1,parent:!1,reactions:new rC,rejection:!1,state:0,value:null})}).prototype=ux(VT,"then",function(e,t){var r=MT(this),o=rr(xT(this,dg));return r.parent=!0,o.ok=!nu(e)||e,o.fail=nu(t)&&t,o.domain=nf?ty.domain:void 0,r.state===0?r.reactions.add(o):Ko(function(){iy(o,r)}),o.promise}),OT=function(){var e=new $E,t=MT(e);this.promise=e,this.resolve=lf(sy,t),this.reject=lf(Ph,t)},iC.f=rr=function(e){return e===dg||e===void 0?new OT(e):BT(e)}),pi({global:!0,wrap:!0,forced:LT},{Promise:dg}),hx(dg,sf,!1,!0),px(sf);var hg=jr("iterator"),Zr=!1;try{var WT=0,Xs={next:function(){return{done:!!WT++}},return:function(){Zr=!0}};Xs[hg]=function(){return this},Array.from(Xs,function(){throw 2})}catch{}var gx=eu,zT=function(e,t){try{if(!t&&!Zr)return!1}catch{return!1}var r=!1;try{var o={};o[hg]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch{}return r},df=tf.CONSTRUCTOR||!zT(function(e){gx.all(e).then(void 0,function(){})}),ay=Ne,aC=ln,oC=Rc,YT=Oh,qT=Vp;Pn({target:"Promise",stat:!0,forced:df},{all:function(e){var t=this,r=oC.f(t),o=r.resolve,c=r.reject,u=YT(function(){var f=aC(t.resolve),g=[],E=0,v=1;qT(e,function(S){var R=E++,I=!1;v++,ay(f,t,S).then(function(D){I||(I=!0,g[R]=D,--v||o(g))},c)}),--v||o(g)});return u.error&&c(u.value),r.promise}});var _x=Pn,cC=tf.CONSTRUCTOR;eu&&eu.prototype,_x({target:"Promise",proto:!0,forced:cC,real:!0},{catch:function(e){return this.then(void 0,e)}});var Ex=Ne,lC=ln,yx=Rc,vx=Oh,iu=Vp;Pn({target:"Promise",stat:!0,forced:df},{race:function(e){var t=this,r=yx.f(t),o=r.reject,c=vx(function(){var u=lC(t.resolve);iu(e,function(f){Ex(u,t,f).then(r.resolve,o)})});return c.error&&o(c.value),r.promise}});var dC=Rc;Pn({target:"Promise",stat:!0,forced:tf.CONSTRUCTOR},{reject:function(e){var t=dC.f(this);return(0,t.reject)(e),t.promise}});var KT=ss,Sx=xt,Tx=Rc,oy=function(e,t){if(KT(e),Sx(t)&&t.constructor===e)return t;var r=Tx.f(e);return(0,r.resolve)(t),r.promise},bx=Pn,Cc=eu,XT=tf.CONSTRUCTOR,uC=oy,hC=Un("Promise"),pg=!XT;bx({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return uC(pg&&this===hC?Cc:this,e)}});var Xo=Ne,pC=ln,cy=Rc,td=Oh,wx=Vp;Pn({target:"Promise",stat:!0,forced:df},{allSettled:function(e){var t=this,r=cy.f(t),o=r.resolve,c=r.reject,u=td(function(){var f=pC(t.resolve),g=[],E=0,v=1;wx(e,function(S){var R=E++,I=!1;v++,Xo(f,t,S).then(function(D){I||(I=!0,g[R]={status:"fulfilled",value:D},--v||o(g))},function(D){I||(I=!0,g[R]={status:"rejected",reason:D},--v||o(g))})}),--v||o(g)});return u.error&&c(u.value),r.promise}});var Rx=Ne,uf=ln,fC=Un,Cx=Rc,Ax=Oh,Ix=Vp,mC="No one promise resolved";Pn({target:"Promise",stat:!0,forced:df},{any:function(e){var t=this,r=fC("AggregateError"),o=Cx.f(t),c=o.resolve,u=o.reject,f=Ax(function(){var g=uf(t.resolve),E=[],v=0,S=1,R=!1;Ix(e,function(I){var D=v++,V=!1;S++,Rx(g,t,I).then(function(M){V||R||(R=!0,c(M))},function(M){V||R||(V=!0,E[D]=M,--S||u(new r(E,mC)))})}),--S||u(new r(E,mC))});return f.error&&u(f.value),o.promise}});var Nx=Pn,Ox=ce,Dx=Da,gC=Rc,hf=ln,pf=Oh,ly=z.Promise,_C=!1;Nx({target:"Promise",stat:!0,forced:!ly||!ly.try||pf(function(){ly.try(function(e){_C=e===8},8)}).error||!_C},{try:function(e){var t=arguments.length>1?Dx(arguments,1):[],r=gC.f(this),o=pf(function(){return Ox(hf(e),void 0,t)});return(o.error?r.reject:r.resolve)(o.value),r.promise}});var ff=Rc;Pn({target:"Promise",stat:!0},{withResolvers:function(){var e=ff.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var fg=Pn,dy=eu,uy=p,QT=Un,$T=fe,hy=BE,JT=oy,EC=dy&&dy.prototype;fg({target:"Promise",proto:!0,real:!0,forced:!!dy&&uy(function(){EC.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=hy(this,QT("Promise")),r=$T(e);return this.then(r?function(o){return JT(t,e()).then(function(){return o})}:e,r?function(o){return JT(t,e()).then(function(){throw o})}:e)}});var ZT=k,yC=A,mg=Os,xx=yt,Px=ZT("".charAt),vC=ZT("".charCodeAt),py=ZT("".slice),gg=function(e){return function(t,r){var o,c,u=mg(xx(t)),f=yC(r),g=u.length;return f<0||f>=g?e?"":void 0:(o=vC(u,f))<55296||o>56319||f+1===g||(c=vC(u,f+1))<56320||c>57343?e?Px(u,f):o:e?py(u,f,f+2):c-56320+(o-55296<<10)+65536}},_g={codeAt:gg(!1),charAt:gg(!0)},kx=_g.charAt,Eg=Os,SC=yc,TC=gT,eb=qp,tb="String Iterator",bC=SC.set,nb=SC.getterFor(tb);TC(String,"String",function(e){bC(this,{type:tb,string:Eg(e),index:0})},function(){var e,t=nb(this),r=t.string,o=t.index;return o>=r.length?eb(void 0,!0):(e=kx(r,o),t.index+=e.length,eb(e,!1))});var wC=Mt.Promise,fy={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Lx=z,Mx=vc,my=zd;for(var yg in fy)Mx(Lx[yg],yg),my[yg]=my.Array;var vg=wC,tt=l(vg),RC=So("Array","values"),rb=zl,su=hi,au=U,ou=RC,kh=Array.prototype,Sg={DOMTokenList:!0,NodeList:!0},cu=function(e){var t=e.values;return e===kh||au(kh,e)&&t===kh.values||su(Sg,rb(e))?ou:t},Pa=l(cu),ib=un,Tg=TypeError,CC=Da,AC=Math.floor,mf=function(e,t){var r=e.length;if(r<8)for(var o,c,u=1;u<r;){for(c=u,o=e[u];c&&t(e[c-1],o)>0;)e[c]=e[--c];c!==u++&&(e[c]=o)}else for(var f=AC(r/2),g=mf(CC(e,0,f),t),E=mf(CC(e,f),t),v=g.length,S=E.length,R=0,I=0;R<v||I<S;)e[R+I]=R<v&&I<S?t(g[R],E[I])<=0?g[R++]:E[I++]:R<v?g[R++]:E[I++];return e},sb=mf,IC=Bt.match(/firefox\/(\d+)/i),gy=!!IC&&+IC[1],_y=/MSIE|Trident/.test(Bt),ab=Bt.match(/AppleWebKit\/(\d+)\./),bg=!!ab&&+ab[1],ob=Pn,wg=k,NC=ln,jx=Eo,Rg=qn,d=function(e,t){if(!delete e[t])throw new Tg("Cannot delete property "+ib(t)+" of "+ib(e))},h=Os,y=p,b=sb,N=ah,P=gy,Z=_y,ue=ji,we=bg,Be=[],it=wg(Be.sort),mt=wg(Be.push),qe=y(function(){Be.sort(void 0)}),Qe=y(function(){Be.sort(null)}),kn=N("sort"),vn=!y(function(){if(ue)return ue<70;if(!(P&&P>3)){if(Z)return!0;if(we)return we<603;var e,t,r,o,c="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(o=0;o<47;o++)Be.push({k:t+o,v:r})}for(Be.sort(function(u,f){return f.v-u.v}),o=0;o<Be.length;o++)t=Be[o].k.charAt(0),c.charAt(c.length-1)!==t&&(c+=t);return c!=="DGBEFHACIJK"}});ob({target:"Array",proto:!0,forced:qe||!Qe||!kn||!vn},{sort:function(e){e!==void 0&&NC(e);var t=jx(this);if(vn)return e===void 0?it(t):it(t,e);var r,o,c=[],u=Rg(t);for(o=0;o<u;o++)o in t&&mt(c,t[o]);for(b(c,function(f){return function(g,E){return E===void 0?-1:g===void 0?1:f!==void 0?+f(g,E)||0:h(g)>h(E)?1:-1}}(e)),r=Rg(c),o=0;o<r;)t[o]=c[o++];for(;o<u;)d(t,o++);return t}});var ai=So("Array","sort"),Me=U,Oe=ai,He=Array.prototype,ht=function(e){var t=e.sort;return e===He||Me(He,e)&&t===He.sort?Oe:t},Gt=l(ht),lr=Pn,hn=k,An=Ve,Qs=RangeError,Ir=String.fromCharCode,nd=String.fromCodePoint,Ux=hn([].join);lr({target:"String",stat:!0,forced:!!nd&&nd.length!==1},{fromCodePoint:function(e){for(var t,r=[],o=arguments.length,c=0;o>c;){if(t=+arguments[c++],An(t,1114111)!==t)throw new Qs(t+" is not a valid code point");r[c]=t<65536?Ir(t):Ir(55296+((t-=65536)>>10),t%1024+56320)}return Ux(r,"")}});var yQ=p,vQ=jr("iterator"),OC=!yQ(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),o="";return e.pathname="c%20d",t.forEach(function(c,u){t.delete("b"),o+=u+c}),r.delete("a",2),r.delete("b",void 0),!e.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[vQ]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("https://x",void 0).host!=="x"}),SQ=xs,Vx=Pn,cU=z,Fx=Ah,TQ=Un,DC=Ne,rd=k,cb=Re,lU=OC,dU=xs,bQ=bi,wQ=function(e,t,r){for(var o in t)r&&r.unsafe&&e[o]?e[o]=t[o]:SQ(e,o,t[o],r);return e},RQ=vc,CQ=PE,Bx=yc,uU=jE,Hx=fe,AQ=hi,IQ=vo,NQ=zl,OQ=ss,hU=xt,No=Os,DQ=Eh,pU=ut,fU=jm,xQ=Up,xC=qp,Ey=Za,PQ=sb,kQ=jr("iterator"),yy="URLSearchParams",mU=yy+"Iterator",gU=Bx.set,dl=Bx.getterFor(yy),LQ=Bx.getterFor(mU),_U=Fx("fetch"),PC=Fx("Request"),lb=Fx("Headers"),Gx=PC&&PC.prototype,EU=lb&&lb.prototype,MQ=cU.TypeError,jQ=cU.encodeURIComponent,UQ=String.fromCharCode,VQ=TQ("String","fromCodePoint"),FQ=parseInt,kC=rd("".charAt),yU=rd([].join),gf=rd([].push),vU=rd("".replace),BQ=rd([].shift),SU=rd([].splice),TU=rd("".split),bU=rd("".slice),HQ=rd(/./.exec),GQ=/\+/g,WQ=/^[0-9a-f]+$/i,wU=function(e,t){var r=bU(e,t,t+2);return HQ(WQ,r)?FQ(r,16):NaN},zQ=function(e){for(var t=0,r=128;r>0&&(e&r)!=0;r>>=1)t++;return t},YQ=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},RU=function(e){for(var t=(e=vU(e,GQ," ")).length,r="",o=0;o<t;){var c=kC(e,o);if(c==="%"){if(kC(e,o+1)==="%"||o+3>t){r+="%",o++;continue}var u=wU(e,o+1);if(u!=u){r+=c,o++;continue}o+=2;var f=zQ(u);if(f===0)c=UQ(u);else{if(f===1||f>4){r+="",o++;continue}for(var g=[u],E=1;E<f&&!(++o+3>t||kC(e,o)!=="%");){var v=wU(e,o+1);if(v!=v){o+=3;break}if(v>191||v<128)break;gf(g,v),o+=2,E++}if(g.length!==f){r+="";continue}var S=YQ(g);S===null?r+="":c=VQ(S)}}r+=c,o++}return r},qQ=/[!'()~]|%20/g,KQ={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},XQ=function(e){return KQ[e]},CU=function(e){return vU(jQ(e),qQ,XQ)},Wx=CQ(function(e,t){gU(this,{type:mU,target:dl(e).entries,index:0,kind:t})},yy,function(){var e=LQ(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,xC(void 0,!0);var o=t[r];switch(e.kind){case"keys":return xC(o.key,!1);case"values":return xC(o.value,!1)}return xC([o.key,o.value],!1)},!0),AU=function(e){this.entries=[],this.url=null,e!==void 0&&(hU(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?kC(e,0)==="?"?bU(e,1):e:No(e)))};AU.prototype={type:yy,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,o,c,u,f,g,E=this.entries,v=xQ(e);if(v)for(r=(t=fU(e,v)).next;!(o=DC(r,t)).done;){if(u=(c=fU(OQ(o.value))).next,(f=DC(u,c)).done||(g=DC(u,c)).done||!DC(u,c).done)throw new MQ("Expected sequence with length 2");gf(E,{key:No(f.value),value:No(g.value)})}else for(var S in e)AQ(e,S)&&gf(E,{key:S,value:No(e[S])})},parseQuery:function(e){if(e)for(var t,r,o=this.entries,c=TU(e,"&"),u=0;u<c.length;)(t=c[u++]).length&&(r=TU(t,"="),gf(o,{key:RU(BQ(r)),value:RU(yU(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],o=0;o<t.length;)e=t[o++],gf(r,CU(e.key)+"="+CU(e.value));return yU(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var LC=function(){uU(this,vy);var e=gU(this,new AU(arguments.length>0?arguments[0]:void 0));cb||(this.size=e.entries.length)},vy=LC.prototype;if(wQ(vy,{append:function(e,t){var r=dl(this);Ey(arguments.length,2),gf(r.entries,{key:No(e),value:No(t)}),cb||this.length++,r.updateURL()},delete:function(e){for(var t=dl(this),r=Ey(arguments.length,1),o=t.entries,c=No(e),u=r<2?void 0:arguments[1],f=u===void 0?u:No(u),g=0;g<o.length;){var E=o[g];if(E.key!==c||f!==void 0&&E.value!==f)g++;else if(SU(o,g,1),f!==void 0)break}cb||(this.size=o.length),t.updateURL()},get:function(e){var t=dl(this).entries;Ey(arguments.length,1);for(var r=No(e),o=0;o<t.length;o++)if(t[o].key===r)return t[o].value;return null},getAll:function(e){var t=dl(this).entries;Ey(arguments.length,1);for(var r=No(e),o=[],c=0;c<t.length;c++)t[c].key===r&&gf(o,t[c].value);return o},has:function(e){for(var t=dl(this).entries,r=Ey(arguments.length,1),o=No(e),c=r<2?void 0:arguments[1],u=c===void 0?c:No(c),f=0;f<t.length;){var g=t[f++];if(g.key===o&&(u===void 0||g.value===u))return!0}return!1},set:function(e,t){var r=dl(this);Ey(arguments.length,1);for(var o,c=r.entries,u=!1,f=No(e),g=No(t),E=0;E<c.length;E++)(o=c[E]).key===f&&(u?SU(c,E--,1):(u=!0,o.value=g));u||gf(c,{key:f,value:g}),cb||(this.size=c.length),r.updateURL()},sort:function(){var e=dl(this);PQ(e.entries,function(t,r){return t.key>r.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,r=dl(this).entries,o=IQ(e,arguments.length>1?arguments[1]:void 0),c=0;c<r.length;)o((t=r[c++]).value,t.key,this)},keys:function(){return new Wx(this,"keys")},values:function(){return new Wx(this,"values")},entries:function(){return new Wx(this,"entries")}},{enumerable:!0}),dU(vy,kQ,vy.entries,{}),dU(vy,"toString",function(){return dl(this).serialize()},{enumerable:!0}),cb&&bQ(vy,"size",{get:function(){return dl(this).entries.length},configurable:!0,enumerable:!0}),RQ(LC,yy),Vx({global:!0,forced:!lU},{URLSearchParams:LC}),!lU&&Hx(lb)){var QQ=rd(EU.has),$Q=rd(EU.set),IU=function(e){if(hU(e)){var t,r=e.body;if(NQ(r)===yy)return t=e.headers?new lb(e.headers):new lb,QQ(t,"content-type")||$Q(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),DQ(e,{body:pU(0,No(r)),headers:pU(0,t)})}return e};if(Hx(_U)&&Vx({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return _U(e,arguments.length>1?IU(arguments[1]):{})}}),Hx(PC)){var zx=function(e){return uU(this,Gx),new PC(e,arguments.length>1?IU(arguments[1]):{})};Gx.constructor=zx,zx.prototype=Gx,Vx({global:!0,dontCallGetSet:!0,forced:!0},{Request:zx})}}var ul,JQ={URLSearchParams:LC,getState:dl},ZQ=Mt.URLSearchParams,NU=Re,e$=k,t$=Ne,n$=p,Yx=Lp,r$=ph,i$=Ce,s$=Eo,a$=Tt,Sy=Object.assign,OU=Object.defineProperty,o$=e$([].concat),c$=!Sy||n$(function(){if(NU&&Sy({b:1},Sy(OU({},"a",{enumerable:!0,get:function(){OU(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol("assign detection"),o="abcdefghijklmnopqrst";return e[r]=7,o.split("").forEach(function(c){t[c]=c}),Sy({},e)[r]!==7||Yx(Sy({},t)).join("")!==o})?function(e,t){for(var r=s$(e),o=arguments.length,c=1,u=r$.f,f=i$.f;o>c;)for(var g,E=a$(arguments[c++]),v=u?o$(Yx(E),u(E)):Yx(E),S=v.length,R=0;S>R;)g=v[R++],NU&&!t$(f,E,g)||(r[g]=E[g]);return r}:Sy,l$=ss,d$=KS,u$=Re,h$=Ws,p$=ut,qx=function(e,t,r){u$?h$.f(e,t,p$(0,r)):e[t]=r},f$=vo,m$=Ne,g$=Eo,_$=function(e,t,r,o){try{return o?t(l$(r)[0],r[1]):t(r)}catch(c){d$(e,"throw",c)}},E$=aR,y$=eg,v$=qn,DU=qx,S$=jm,T$=Up,xU=Array,Cg=k,Kx=2147483647,b$=/[^\0-\u007E]/,PU=/[.\u3002\uFF0E\uFF61]/g,kU="Overflow: input needs wider integers to process",LU=RangeError,w$=Cg(PU.exec),Ty=Math.floor,Xx=String.fromCharCode,MU=Cg("".charCodeAt),jU=Cg([].join),_f=Cg([].push),R$=Cg("".replace),C$=Cg("".split),A$=Cg("".toLowerCase),UU=function(e){return e+22+75*(e<26)},I$=function(e,t,r){var o=0;for(e=r?Ty(e/700):e>>1,e+=Ty(e/t);e>455;)e=Ty(e/35),o+=36;return Ty(o+36*e/(e+38))},N$=function(e){var t=[];e=function(W){for(var Y=[],le=0,ye=W.length;le<ye;){var Ee=MU(W,le++);if(Ee>=55296&&Ee<=56319&&le<ye){var me=MU(W,le++);(64512&me)==56320?_f(Y,((1023&Ee)<<10)+(1023&me)+65536):(_f(Y,Ee),le--)}else _f(Y,Ee)}return Y}(e);var r,o,c=e.length,u=128,f=0,g=72;for(r=0;r<e.length;r++)(o=e[r])<128&&_f(t,Xx(o));var E=t.length,v=E;for(E&&_f(t,"-");v<c;){var S=Kx;for(r=0;r<e.length;r++)(o=e[r])>=u&&o<S&&(S=o);var R=v+1;if(S-u>Ty((Kx-f)/R))throw new LU(kU);for(f+=(S-u)*R,u=S,r=0;r<e.length;r++){if((o=e[r])<u&&++f>Kx)throw new LU(kU);if(o===u){for(var I=f,D=36;;){var V=D<=g?1:D>=g+26?26:D-g;if(I<V)break;var M=I-V,j=36-V;_f(t,Xx(UU(V+M%j))),I=Ty(M/j),D+=36}_f(t,Xx(UU(I))),g=I$(f,R,v===E),f=0,v++}}f++,u++}return jU(t,"")},O$=Pn,Qx=Re,D$=OC,$x=z,VU=vo,hl=k,MC=xs,pl=bi,x$=jE,Jx=hi,Zx=c$,by=function(e){var t=g$(e),r=y$(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=f$(c,o>2?arguments[2]:void 0));var f,g,E,v,S,R,I=T$(t),D=0;if(!I||this===xU&&E$(I))for(f=v$(t),g=r?new this(f):xU(f);f>D;D++)R=u?c(t[D],D):t[D],DU(g,D,R);else for(g=r?new this:[],S=(v=S$(t,I)).next;!(E=m$(S,v)).done;D++)R=u?_$(v,c,[E.value,D],!0):E.value,DU(g,D,R);return g.length=D,g},id=Da,P$=_g.codeAt,k$=function(e){var t,r,o=[],c=C$(R$(A$(e),PU,"."),".");for(t=0;t<c.length;t++)r=c[t],_f(o,w$(b$,r)?"xn--"+N$(r):r);return jU(o,".")},Lh=Os,L$=vc,M$=Za,FU=JQ,BU=yc,j$=BU.set,jC=BU.getterFor("URL"),U$=FU.URLSearchParams,V$=FU.getState,db=$x.URL,eP=$x.TypeError,UC=$x.parseInt,F$=Math.floor,HU=Math.pow,fl=hl("".charAt),sd=hl(/./.exec),ub=hl([].join),B$=hl(1 .toString),H$=hl([].pop),wy=hl([].push),tP=hl("".replace),G$=hl([].shift),W$=hl("".split),hb=hl("".slice),VC=hl("".toLowerCase),z$=hl([].unshift),nP="Invalid scheme",Ag="Invalid host",GU="Invalid port",WU=/[a-z]/i,Y$=/[\d+-.a-z]/i,rP=/\d/,q$=/^0x/i,K$=/^[0-7]+$/,X$=/^\d+$/,zU=/^[\da-f]+$/i,Q$=/[\0\t\n\r #%/:<>?@[\\\]^|]/,$$=/[\0\t\n\r #/:<>?@[\\\]^|]/,J$=/^[\u0000-\u0020]+/,Z$=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,eJ=/[\t\n\r]/g,pb=function(e){var t,r,o,c;if(typeof e=="number"){for(t=[],r=0;r<4;r++)z$(t,e%256),e=F$(e/256);return ub(t,".")}if(typeof e=="object"){for(t="",o=function(u){for(var f=null,g=1,E=null,v=0,S=0;S<8;S++)u[S]!==0?(v>g&&(f=E,g=v),E=null,v=0):(E===null&&(E=S),++v);return v>g?E:f}(e),r=0;r<8;r++)c&&e[r]===0||(c&&(c=!1),o===r?(t+=r?":":"::",c=!0):(t+=B$(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},FC={},YU=Zx({},FC,{" ":1,'"':1,"<":1,">":1,"`":1}),qU=Zx({},YU,{"#":1,"?":1,"{":1,"}":1}),iP=Zx({},qU,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Ef=function(e,t){var r=P$(e,0);return r>32&&r<127&&!Jx(t,e)?e:encodeURIComponent(e)},BC={ftp:21,file:null,http:80,https:443,ws:80,wss:443},fb=function(e,t){var r;return e.length===2&&sd(WU,fl(e,0))&&((r=fl(e,1))===":"||!t&&r==="|")},KU=function(e){var t;return e.length>1&&fb(hb(e,0,2))&&(e.length===2||(t=fl(e,2))==="/"||t==="\\"||t==="?"||t==="#")},tJ=function(e){return e==="."||VC(e)==="%2e"},sP={},XU={},aP={},QU={},$U={},oP={},JU={},ZU={},HC={},GC={},cP={},lP={},dP={},uP={},eV={},hP={},Ry={},lu={},tV={},Ig={},Mh={},pP=function(e,t,r){var o,c,u,f=Lh(e);if(t){if(c=this.parse(f))throw new eP(c);this.searchParams=null}else{if(r!==void 0&&(o=new pP(r,!0)),c=this.parse(f,null,o))throw new eP(c);(u=V$(new U$)).bindURL(this),this.searchParams=u}};pP.prototype={type:"URL",parse:function(e,t,r){var o,c,u,f,g,E=this,v=t||sP,S=0,R="",I=!1,D=!1,V=!1;for(e=Lh(e),t||(E.scheme="",E.username="",E.password="",E.host=null,E.port=null,E.path=[],E.query=null,E.fragment=null,E.cannotBeABaseURL=!1,e=tP(e,J$,""),e=tP(e,Z$,"$1")),e=tP(e,eJ,""),o=by(e);S<=o.length;){switch(c=o[S],v){case sP:if(!c||!sd(WU,c)){if(t)return nP;v=aP;continue}R+=VC(c),v=XU;break;case XU:if(c&&(sd(Y$,c)||c==="+"||c==="-"||c==="."))R+=VC(c);else{if(c!==":"){if(t)return nP;R="",v=aP,S=0;continue}if(t&&(E.isSpecial()!==Jx(BC,R)||R==="file"&&(E.includesCredentials()||E.port!==null)||E.scheme==="file"&&!E.host))return;if(E.scheme=R,t)return void(E.isSpecial()&&BC[E.scheme]===E.port&&(E.port=null));R="",E.scheme==="file"?v=uP:E.isSpecial()&&r&&r.scheme===E.scheme?v=QU:E.isSpecial()?v=ZU:o[S+1]==="/"?(v=$U,S++):(E.cannotBeABaseURL=!0,wy(E.path,""),v=tV)}break;case aP:if(!r||r.cannotBeABaseURL&&c!=="#")return nP;if(r.cannotBeABaseURL&&c==="#"){E.scheme=r.scheme,E.path=id(r.path),E.query=r.query,E.fragment="",E.cannotBeABaseURL=!0,v=Mh;break}v=r.scheme==="file"?uP:oP;continue;case QU:if(c!=="/"||o[S+1]!=="/"){v=oP;continue}v=HC,S++;break;case $U:if(c==="/"){v=GC;break}v=lu;continue;case oP:if(E.scheme=r.scheme,c===ul)E.username=r.username,E.password=r.password,E.host=r.host,E.port=r.port,E.path=id(r.path),E.query=r.query;else if(c==="/"||c==="\\"&&E.isSpecial())v=JU;else if(c==="?")E.username=r.username,E.password=r.password,E.host=r.host,E.port=r.port,E.path=id(r.path),E.query="",v=Ig;else{if(c!=="#"){E.username=r.username,E.password=r.password,E.host=r.host,E.port=r.port,E.path=id(r.path),E.path.length--,v=lu;continue}E.username=r.username,E.password=r.password,E.host=r.host,E.port=r.port,E.path=id(r.path),E.query=r.query,E.fragment="",v=Mh}break;case JU:if(!E.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){E.username=r.username,E.password=r.password,E.host=r.host,E.port=r.port,v=lu;continue}v=GC}else v=HC;break;case ZU:if(v=HC,c!=="/"||fl(R,S+1)!=="/")continue;S++;break;case HC:if(c!=="/"&&c!=="\\"){v=GC;continue}break;case GC:if(c==="@"){I&&(R="%40"+R),I=!0,u=by(R);for(var M=0;M<u.length;M++){var j=u[M];if(j!==":"||V){var W=Ef(j,iP);V?E.password+=W:E.username+=W}else V=!0}R=""}else if(c===ul||c==="/"||c==="?"||c==="#"||c==="\\"&&E.isSpecial()){if(I&&R==="")return"Invalid authority";S-=by(R).length+1,R="",v=cP}else R+=c;break;case cP:case lP:if(t&&E.scheme==="file"){v=hP;continue}if(c!==":"||D){if(c===ul||c==="/"||c==="?"||c==="#"||c==="\\"&&E.isSpecial()){if(E.isSpecial()&&R==="")return Ag;if(t&&R===""&&(E.includesCredentials()||E.port!==null))return;if(f=E.parseHost(R))return f;if(R="",v=Ry,t)return;continue}c==="["?D=!0:c==="]"&&(D=!1),R+=c}else{if(R==="")return Ag;if(f=E.parseHost(R))return f;if(R="",v=dP,t===lP)return}break;case dP:if(!sd(rP,c)){if(c===ul||c==="/"||c==="?"||c==="#"||c==="\\"&&E.isSpecial()||t){if(R!==""){var Y=UC(R,10);if(Y>65535)return GU;E.port=E.isSpecial()&&Y===BC[E.scheme]?null:Y,R=""}if(t)return;v=Ry;continue}return GU}R+=c;break;case uP:if(E.scheme="file",c==="/"||c==="\\")v=eV;else{if(!r||r.scheme!=="file"){v=lu;continue}switch(c){case ul:E.host=r.host,E.path=id(r.path),E.query=r.query;break;case"?":E.host=r.host,E.path=id(r.path),E.query="",v=Ig;break;case"#":E.host=r.host,E.path=id(r.path),E.query=r.query,E.fragment="",v=Mh;break;default:KU(ub(id(o,S),""))||(E.host=r.host,E.path=id(r.path),E.shortenPath()),v=lu;continue}}break;case eV:if(c==="/"||c==="\\"){v=hP;break}r&&r.scheme==="file"&&!KU(ub(id(o,S),""))&&(fb(r.path[0],!0)?wy(E.path,r.path[0]):E.host=r.host),v=lu;continue;case hP:if(c===ul||c==="/"||c==="\\"||c==="?"||c==="#"){if(!t&&fb(R))v=lu;else if(R===""){if(E.host="",t)return;v=Ry}else{if(f=E.parseHost(R))return f;if(E.host==="localhost"&&(E.host=""),t)return;R="",v=Ry}continue}R+=c;break;case Ry:if(E.isSpecial()){if(v=lu,c!=="/"&&c!=="\\")continue}else if(t||c!=="?")if(t||c!=="#"){if(c!==ul&&(v=lu,c!=="/"))continue}else E.fragment="",v=Mh;else E.query="",v=Ig;break;case lu:if(c===ul||c==="/"||c==="\\"&&E.isSpecial()||!t&&(c==="?"||c==="#")){if((g=VC(g=R))===".."||g==="%2e."||g===".%2e"||g==="%2e%2e"?(E.shortenPath(),c==="/"||c==="\\"&&E.isSpecial()||wy(E.path,"")):tJ(R)?c==="/"||c==="\\"&&E.isSpecial()||wy(E.path,""):(E.scheme==="file"&&!E.path.length&&fb(R)&&(E.host&&(E.host=""),R=fl(R,0)+":"),wy(E.path,R)),R="",E.scheme==="file"&&(c===ul||c==="?"||c==="#"))for(;E.path.length>1&&E.path[0]==="";)G$(E.path);c==="?"?(E.query="",v=Ig):c==="#"&&(E.fragment="",v=Mh)}else R+=Ef(c,qU);break;case tV:c==="?"?(E.query="",v=Ig):c==="#"?(E.fragment="",v=Mh):c!==ul&&(E.path[0]+=Ef(c,FC));break;case Ig:t||c!=="#"?c!==ul&&(c==="'"&&E.isSpecial()?E.query+="%27":E.query+=c==="#"?"%23":Ef(c,FC)):(E.fragment="",v=Mh);break;case Mh:c!==ul&&(E.fragment+=Ef(c,YU))}S++}},parseHost:function(e){var t,r,o;if(fl(e,0)==="["){if(fl(e,e.length-1)!=="]"||(t=function(c){var u,f,g,E,v,S,R,I=[0,0,0,0,0,0,0,0],D=0,V=null,M=0,j=function(){return fl(c,M)};if(j()===":"){if(fl(c,1)!==":")return;M+=2,V=++D}for(;j();){if(D===8)return;if(j()!==":"){for(u=f=0;f<4&&sd(zU,j());)u=16*u+UC(j(),16),M++,f++;if(j()==="."){if(f===0||(M-=f,D>6))return;for(g=0;j();){if(E=null,g>0){if(!(j()==="."&&g<4))return;M++}if(!sd(rP,j()))return;for(;sd(rP,j());){if(v=UC(j(),10),E===null)E=v;else{if(E===0)return;E=10*E+v}if(E>255)return;M++}I[D]=256*I[D]+E,++g!=2&&g!==4||D++}if(g!==4)return;break}if(j()===":"){if(M++,!j())return}else if(j())return;I[D++]=u}else{if(V!==null)return;M++,V=++D}}if(V!==null)for(S=D-V,D=7;D!==0&&S>0;)R=I[D],I[D--]=I[V+S-1],I[V+--S]=R;else if(D!==8)return;return I}(hb(e,1,-1)),!t))return Ag;this.host=t}else if(this.isSpecial()){if(e=k$(e),sd(Q$,e)||(t=function(c){var u,f,g,E,v,S,R,I=W$(c,".");if(I.length&&I[I.length-1]===""&&I.length--,(u=I.length)>4)return c;for(f=[],g=0;g<u;g++){if((E=I[g])==="")return c;if(v=10,E.length>1&&fl(E,0)==="0"&&(v=sd(q$,E)?16:8,E=hb(E,v===8?1:2)),E==="")S=0;else{if(!sd(v===10?X$:v===8?K$:zU,E))return c;S=UC(E,v)}wy(f,S)}for(g=0;g<u;g++)if(S=f[g],g===u-1){if(S>=HU(256,5-u))return null}else if(S>255)return null;for(R=H$(f),g=0;g<f.length;g++)R+=f[g]*HU(256,3-g);return R}(e),t===null))return Ag;this.host=t}else{if(sd($$,e))return Ag;for(t="",r=by(e),o=0;o<r.length;o++)t+=Ef(r[o],FC);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return Jx(BC,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&fb(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,o=e.password,c=e.host,u=e.port,f=e.path,g=e.query,E=e.fragment,v=t+":";return c!==null?(v+="//",e.includesCredentials()&&(v+=r+(o?":"+o:"")+"@"),v+=pb(c),u!==null&&(v+=":"+u)):t==="file"&&(v+="//"),v+=e.cannotBeABaseURL?f[0]:f.length?"/"+ub(f,"/"):"",g!==null&&(v+="?"+g),E!==null&&(v+="#"+E),v},setHref:function(e){var t=this.parse(e);if(t)throw new eP(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Cy(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+pb(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Lh(e)+":",sP)},getUsername:function(){return this.username},setUsername:function(e){var t=by(Lh(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=Ef(t[r],iP)}},getPassword:function(){return this.password},setPassword:function(e){var t=by(Lh(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=Ef(t[r],iP)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?pb(e):pb(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,cP)},getHostname:function(){var e=this.host;return e===null?"":pb(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,lP)},getPort:function(){var e=this.port;return e===null?"":Lh(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Lh(e))===""?this.port=null:this.parse(e,dP))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+ub(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Ry))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Lh(e))===""?this.query=null:(fl(e,0)==="?"&&(e=hb(e,1)),this.query="",this.parse(e,Ig)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Lh(e))!==""?(fl(e,0)==="#"&&(e=hb(e,1)),this.fragment="",this.parse(e,Mh)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Cy=function(e){var t=x$(this,Oo),r=M$(arguments.length,1)>1?arguments[1]:void 0,o=j$(t,new pP(e,!1,r));Qx||(t.href=o.serialize(),t.origin=o.getOrigin(),t.protocol=o.getProtocol(),t.username=o.getUsername(),t.password=o.getPassword(),t.host=o.getHost(),t.hostname=o.getHostname(),t.port=o.getPort(),t.pathname=o.getPathname(),t.search=o.getSearch(),t.searchParams=o.getSearchParams(),t.hash=o.getHash())},Oo=Cy.prototype,ml=function(e,t){return{get:function(){return jC(this)[e]()},set:t&&function(r){return jC(this)[t](r)},configurable:!0,enumerable:!0}};if(Qx&&(pl(Oo,"href",ml("serialize","setHref")),pl(Oo,"origin",ml("getOrigin")),pl(Oo,"protocol",ml("getProtocol","setProtocol")),pl(Oo,"username",ml("getUsername","setUsername")),pl(Oo,"password",ml("getPassword","setPassword")),pl(Oo,"host",ml("getHost","setHost")),pl(Oo,"hostname",ml("getHostname","setHostname")),pl(Oo,"port",ml("getPort","setPort")),pl(Oo,"pathname",ml("getPathname","setPathname")),pl(Oo,"search",ml("getSearch","setSearch")),pl(Oo,"searchParams",ml("getSearchParams")),pl(Oo,"hash",ml("getHash","setHash"))),MC(Oo,"toJSON",function(){return jC(this).serialize()},{enumerable:!0}),MC(Oo,"toString",function(){return jC(this).serialize()},{enumerable:!0}),db){var nV=db.createObjectURL,rV=db.revokeObjectURL;nV&&MC(Cy,"createObjectURL",VU(nV,db)),rV&&MC(Cy,"revokeObjectURL",VU(rV,db))}L$(Cy,"URL"),O$({global:!0,forced:!D$,sham:!Qx},{URL:Cy});var nJ=Pn,iV=p,rJ=Za,sV=Os,iJ=OC,fP=Un("URL"),sJ=iJ&&iV(function(){fP.canParse()}),aJ=iV(function(){return fP.canParse.length!==1});nJ({target:"URL",stat:!0,forced:!sJ||aJ},{canParse:function(e){var t=rJ(arguments.length,1),r=sV(e),o=t<2||arguments[1]===void 0?void 0:sV(arguments[1]);try{return!!new fP(r,o)}catch{return!1}}});var oJ=Pn,cJ=Za,aV=Os,lJ=OC,dJ=Un("URL");oJ({target:"URL",stat:!0,forced:!lJ},{parse:function(e){var t=cJ(arguments.length,1),r=aV(e),o=t<2||arguments[1]===void 0?void 0:aV(arguments[1]);try{return new dJ(r,o)}catch{return null}}});var WC=l(Mt.URL);let oV=!0,cV=!0;function zC(e,t,r){const o=e.match(t);return o&&o.length>=r&&parseInt(o[r],10)}function Ng(e,t,r){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(f,g){if(f!==t)return c.apply(this,arguments);const E=v=>{const S=r(v);S&&(g.handleEvent?g.handleEvent(S):g(S))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(g,E),c.apply(this,[f,E])};const u=o.removeEventListener;o.removeEventListener=function(f,g){if(f!==t||!this._eventMap||!this._eventMap[t])return u.apply(this,arguments);if(!this._eventMap[t].has(g))return u.apply(this,arguments);const E=this._eventMap[t].get(g);return this._eventMap[t].delete(g),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[f,E])},Object.defineProperty(o,"on"+t,{get(){return this["_on"+t]},set(f){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),f&&this.addEventListener(t,this["_on"+t]=f)},enumerable:!0,configurable:!0})}function uJ(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(oV=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function hJ(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(cV=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function lV(){if(typeof window=="object"){if(oV)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function mP(e,t){cV&&console.warn(e+" is deprecated, please use "+t+" instead.")}function dV(e){return Object.prototype.toString.call(e)==="[object Object]"}function uV(e){var t;return dV(e)?Qa(t=Object.keys(e)).call(t,function(r,o){const c=dV(e[o]),u=c?uV(e[o]):e[o],f=c&&!Object.keys(u).length;return u===void 0||f?r:Object.assign(r,{[o]:u})},{}):e}function gP(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(o=>{o.endsWith("Id")?gP(e,e.get(t[o]),r):o.endsWith("Ids")&&t[o].forEach(c=>{gP(e,e.get(c),r)})}))}function hV(e,t,r){const o=r?"outbound-rtp":"inbound-rtp",c=new Map;if(t===null)return c;const u=[];return e.forEach(f=>{f.type==="track"&&f.trackIdentifier===t.id&&u.push(f)}),u.forEach(f=>{e.forEach(g=>{g.type===o&&g.trackId===f.id&&gP(e,g,c)})}),c}const pV=lV;function fV(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const o=function(f){if(typeof f!="object"||f.mandatory||f.optional)return f;const g={};return Object.keys(f).forEach(E=>{if(E==="require"||E==="advanced"||E==="mediaSource")return;const v=typeof f[E]=="object"?f[E]:{ideal:f[E]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const S=function(R,I){return R?R+I.charAt(0).toUpperCase()+I.slice(1):I==="deviceId"?"sourceId":I};if(v.ideal!==void 0){g.optional=g.optional||[];let R={};typeof v.ideal=="number"?(R[S("min",E)]=v.ideal,g.optional.push(R),R={},R[S("max",E)]=v.ideal,g.optional.push(R)):(R[S("",E)]=v.ideal,g.optional.push(R))}v.exact!==void 0&&typeof v.exact!="number"?(g.mandatory=g.mandatory||{},g.mandatory[S("",E)]=v.exact):["min","max"].forEach(R=>{v[R]!==void 0&&(g.mandatory=g.mandatory||{},g.mandatory[S(R,E)]=v[R])})}),f.advanced&&(g.optional=(g.optional||[]).concat(f.advanced)),g},c=function(f,g){if(t.version>=61)return g(f);if((f=JSON.parse(JSON.stringify(f)))&&typeof f.audio=="object"){const E=function(v,S,R){S in v&&!(R in v)&&(v[R]=v[S],delete v[S])};E((f=JSON.parse(JSON.stringify(f))).audio,"autoGainControl","googAutoGainControl"),E(f.audio,"noiseSuppression","googNoiseSuppression"),f.audio=o(f.audio)}if(f&&typeof f.video=="object"){let E=f.video.facingMode;E=E&&(typeof E=="object"?E:{ideal:E});const v=t.version<66;if(E&&(E.exact==="user"||E.exact==="environment"||E.ideal==="user"||E.ideal==="environment")&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||v)){let S;if(delete f.video.facingMode,E.exact==="environment"||E.ideal==="environment"?S=["back","rear"]:E.exact!=="user"&&E.ideal!=="user"||(S=["front"]),S)return r.mediaDevices.enumerateDevices().then(R=>{let I=(R=R.filter(D=>D.kind==="videoinput")).find(D=>S.some(V=>{var M;return Ze(M=D.label.toLowerCase()).call(M,V)}));return!I&&R.length&&Ze(S).call(S,"back")&&(I=R[R.length-1]),I&&(f.video.deviceId=E.exact?{exact:I.deviceId}:{ideal:I.deviceId}),f.video=o(f.video),pV("chrome: "+JSON.stringify(f)),g(f)})}f.video=o(f.video)}return pV("chrome: "+JSON.stringify(f)),g(f)},u=function(f){return t.version>=64?f:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[f.name]||f.name,message:f.message,constraint:f.constraint||f.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(f,g,E){c(f,v=>{r.webkitGetUserMedia(v,g,S=>{E&&E(u(S))})})}).bind(r),r.mediaDevices.getUserMedia){const f=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(g){return c(g,E=>f(E).then(v=>{if(E.audio&&!v.getAudioTracks().length||E.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return v},v=>tt.reject(u(v))))}}}function mV(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function gV(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(f=>f.track&&f.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[r.stream],this.dispatchEvent(u)}),r.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(f=>f.track&&f.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[r.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ng(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function _V(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(f,g){let E=c.apply(this,arguments);return E||(E=t(this,f),this._senders.push(E)),E};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(f){u.apply(this,arguments);const g=this._senders.indexOf(f);g!==-1&&this._senders.splice(g,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],r.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(t(this,u))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const f=this._senders.find(g=>g.track===u);f&&this._senders.splice(this._senders.indexOf(f),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function EV(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,o,c]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const u=function(g){const E={};return g.result().forEach(v=>{const S={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(R=>{S[R]=v.stat(R)}),E[S.id]=S}),E},f=function(g){return new Map(Object.keys(g).map(E=>[E,g[E]]))};if(arguments.length>=2){const g=function(E){o(f(u(E)))};return t.apply(this,[g,r])}return new tt((g,E)=>{t.apply(this,[function(v){g(f(u(v)))},E])}).then(o,c)}}function yV(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=r.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>hV(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o}),Ng(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>hV(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let o,c,u;return this.getSenders().forEach(f=>{f.track===r&&(o?u=!0:o=f)}),this.getReceivers().forEach(f=>(f.track===r&&(c?u=!0:c=f),f.track===r)),u||o&&c?tt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():tt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function vV(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,f){if(!f)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const g=t.apply(this,arguments);return this._shimmedLocalStreams[f.id]?this._shimmedLocalStreams[f.id].indexOf(g)===-1&&this._shimmedLocalStreams[f.id].push(g):this._shimmedLocalStreams[f.id]=[f,g],g};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(E=>{if(this.getSenders().find(S=>S.track===E))throw new DOMException("Track already exists.","InvalidAccessError")});const f=this.getSenders();r.apply(this,arguments);const g=this.getSenders().filter(E=>f.indexOf(E)===-1);this._shimmedLocalStreams[u.id]=[u].concat(g)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(f=>{const g=this._shimmedLocalStreams[f].indexOf(u);g!==-1&&this._shimmedLocalStreams[f].splice(g,1),this._shimmedLocalStreams[f].length===1&&delete this._shimmedLocalStreams[f]}),c.apply(this,arguments)}}function SV(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return vV(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const E=r.apply(this);return this._reverseStreams=this._reverseStreams||{},E.map(v=>this._reverseStreams[v.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(E){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},E.getTracks().forEach(v=>{if(this.getSenders().find(R=>R.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[E.id]){const v=new e.MediaStream(E.getTracks());this._streams[E.id]=v,this._reverseStreams[v.id]=E,E=v}o.apply(this,[E])};const c=e.RTCPeerConnection.prototype.removeStream;function u(E,v){let S=v.sdp;return Object.keys(E._reverseStreams||[]).forEach(R=>{const I=E._reverseStreams[R],D=E._streams[I.id];S=S.replace(new RegExp(D.id,"g"),I.id)}),new RTCSessionDescription({type:v.type,sdp:S})}e.RTCPeerConnection.prototype.removeStream=function(E){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[E.id]||E]),delete this._reverseStreams[this._streams[E.id]?this._streams[E.id].id:E.id],delete this._streams[E.id]},e.RTCPeerConnection.prototype.addTrack=function(E,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(D=>D===E))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(D=>D.track===E))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const I=this._streams[v.id];if(I)I.addTrack(E),tt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const D=new e.MediaStream([E]);this._streams[v.id]=D,this._reverseStreams[D.id]=v,this.addStream(D)}return this.getSenders().find(D=>D.track===E)},["createOffer","createAnswer"].forEach(function(E){const v=e.RTCPeerConnection.prototype[E],S={[E](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[I=>{const D=u(this,I);R[0].apply(null,[D])},I=>{R[1]&&R[1].apply(null,I)},arguments[2]]):v.apply(this,arguments).then(I=>u(this,I))}};e.RTCPeerConnection.prototype[E]=S[E]});const f=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(E,v){let S=v.sdp;return Object.keys(E._reverseStreams||[]).forEach(R=>{const I=E._reverseStreams[R],D=E._streams[I.id];S=S.replace(new RegExp(I.id,"g"),D.id)}),new RTCSessionDescription({type:v.type,sdp:S})}(this,arguments[0]),f.apply(this,arguments)):f.apply(this,arguments)};const g=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const E=g.get.apply(this);return E.type===""?E:u(this,E)}}),e.RTCPeerConnection.prototype.removeTrack=function(E){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!E._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(E._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(R=>E.track===R)&&(v=this._streams[S])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(E.track),this.dispatchEvent(new Event("negotiationneeded")))}}function _P(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=e.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=c[r]})}function TV(e,t){Ng(e,"negotiationneeded",r=>{const o=r.target;if(!(t.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return r})}var bV=Object.freeze({__proto__:null,fixNegotiationNeeded:TV,shimAddTrackRemoveTrack:SV,shimAddTrackRemoveTrackWithNative:vV,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(o=>{const c=r.video&&r.video.width,u=r.video&&r.video.height,f=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:f||3}},c&&(r.video.mandatory.maxWidth=c),u&&(r.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:_V,shimGetStats:EV,shimGetUserMedia:fV,shimMediaStream:mV,shimOnTrack:gV,shimPeerConnection:_P,shimSenderReceiverGetStats:yV});function wV(e,t){const r=e&&e.navigator,o=e&&e.MediaStreamTrack;if(r.getUserMedia=function(c,u,f){mP("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(c).then(u,f)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const c=function(f,g,E){g in f&&!(E in f)&&(f[E]=f[g],delete f[g])},u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(f){return typeof f=="object"&&typeof f.audio=="object"&&(f=JSON.parse(JSON.stringify(f)),c(f.audio,"autoGainControl","mozAutoGainControl"),c(f.audio,"noiseSuppression","mozNoiseSuppression")),u(f)},o&&o.prototype.getSettings){const f=o.prototype.getSettings;o.prototype.getSettings=function(){const g=f.apply(this,arguments);return c(g,"mozAutoGainControl","autoGainControl"),c(g,"mozNoiseSuppression","noiseSuppression"),g}}if(o&&o.prototype.applyConstraints){const f=o.prototype.applyConstraints;o.prototype.applyConstraints=function(g){return this.kind==="audio"&&typeof g=="object"&&(g=JSON.parse(JSON.stringify(g)),c(g,"autoGainControl","mozAutoGainControl"),c(g,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[g])}}}}function RV(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function EP(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],f={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=f[c]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,f]=arguments;return o.apply(this,[c||null]).then(g=>{if(t.version<53&&!u)try{g.forEach(E=>{E.type=r[E.type]||E.type})}catch(E){if(E.name!=="TypeError")throw E;g.forEach((v,S)=>{g.set(S,Object.assign({},v,{type:r[v.type]||v.type}))})}return g}).then(u,f)}}function CV(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(c=>c._pc=this),o});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=r.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):tt.resolve(new Map)}}function AV(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r}),Ng(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function IV(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){mP("removeStream","removeTrack"),this.getSenders().forEach(r=>{var o;r.track&&Ze(o=t.getTracks()).call(o,r.track)&&this.removeTrack(r)})})}function NV(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function OV(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const o=r.length>0;o&&r.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=t.apply(this,arguments);if(o){const{sender:u}=c,f=u.getParameters();(!("encodings"in f)||f.encodings.length===1&&Object.keys(f.encodings[0]).length===0)&&(f.encodings=r,u.sendEncodings=r,this.setParametersPromises.push(u.setParameters(f).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function DV(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function xV(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?tt.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function PV(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?tt.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var kV=Object.freeze({__proto__:null,shimAddTransceiver:OV,shimCreateAnswer:PV,shimCreateOffer:xV,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,tt.reject(o)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:DV,shimGetUserMedia:wV,shimOnTrack:RV,shimPeerConnection:EP,shimRTCDataChannel:NV,shimReceiverGetStats:AV,shimRemoveStream:IV,shimSenderGetStats:CV});function LV(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){var o;this._localStreams||(this._localStreams=[]),Ze(o=this._localStreams).call(o,r)||this._localStreams.push(r),r.getAudioTracks().forEach(c=>t.call(this,c,r)),r.getVideoTracks().forEach(c=>t.call(this,c,r))},e.RTCPeerConnection.prototype.addTrack=function(r){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(f=>{var g;this._localStreams?Ze(g=this._localStreams).call(g,f)||this._localStreams.push(f):this._localStreams=[f]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const o=t.getTracks();this.getSenders().forEach(c=>{Ze(o).call(o,c.track)&&this.removeTrack(c)})})}}function MV(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),Ze(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const f=new Event("addstream");f.stream=c,this.dispatchEvent(f)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(c)>=0)return;r._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,r.dispatchEvent(u)})}),t.apply(r,arguments)}}}function jV(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,o=t.createAnswer,c=t.setLocalDescription,u=t.setRemoteDescription,f=t.addIceCandidate;t.createOffer=function(E,v){const S=arguments.length>=2?arguments[2]:arguments[0],R=r.apply(this,[S]);return v?(R.then(E,v),tt.resolve()):R},t.createAnswer=function(E,v){const S=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[S]);return v?(R.then(E,v),tt.resolve()):R};let g=function(E,v,S){const R=c.apply(this,[E]);return S?(R.then(v,S),tt.resolve()):R};t.setLocalDescription=g,g=function(E,v,S){const R=u.apply(this,[E]);return S?(R.then(v,S),tt.resolve()):R},t.setRemoteDescription=g,g=function(E,v,S){const R=f.apply(this,[E]);return S?(R.then(v,S),tt.resolve()):R},t.addIceCandidate=g}function UV(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const r=t.mediaDevices,o=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=c=>o(VV(c))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,o,c){t.mediaDevices.getUserMedia(r).then(o,c)}).bind(t))}function VV(e){return e&&e.video!==void 0?Object.assign({},e,{video:uV(e.video)}):e}function FV(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,o){if(r&&r.iceServers){const c=[];for(let u=0;u<r.iceServers.length;u++){let f=r.iceServers[u];!f.hasOwnProperty("urls")&&f.hasOwnProperty("url")?(mP("RTCIceServer.url","RTCIceServer.urls"),f=JSON.parse(JSON.stringify(f)),f.urls=f.url,delete f.url,c.push(f)):c.push(r.iceServers[u])}r.iceServers=c}return new t(r,o)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function BV(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function HV(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):r.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function GV(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var WV=Object.freeze({__proto__:null,shimAudioContext:GV,shimCallbacksAPI:jV,shimConstraints:VV,shimCreateOfferLegacy:HV,shimGetUserMedia:UV,shimLocalStreamsAPI:LV,shimRTCIceServerUrls:FV,shimRemoteStreamsAPI:MV,shimTrackEventTransceiver:BV}),zV=`	
\v\f\r \u2028\u2029\uFEFF`,pJ=yt,fJ=Os,yP=zV,YV=k("".replace),mJ=RegExp("^["+yP+"]+"),gJ=RegExp("(^|[^"+yP+"])["+yP+"]+$"),_J=function(e){return function(t){var r=fJ(pJ(t));return 1&e&&(r=YV(r,mJ,"")),2&e&&(r=YV(r,gJ,"$1")),r}},EJ={trim:_J(3)},yJ=Th.PROPER,vJ=p,qV=zV,SJ=EJ.trim;Pn({target:"String",proto:!0,forced:function(e){return vJ(function(){return!!qV[e]()||""[e]()!==""||yJ&&qV[e].name!==e})}("trim")},{trim:function(){return SJ(this)}});var TJ=So("String","trim"),bJ=U,wJ=TJ,vP=String.prototype,RJ=function(e){var t=e.trim;return typeof e=="string"||e===vP||bJ(vP,e)&&t===vP.trim?wJ:t},aa=l(RJ),KV={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(r){return r.trim().split(`
`).map(o=>o.trim())},t.splitSections=function(r){return r.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},t.getDescription=function(r){const o=t.splitSections(r);return o&&o[0]},t.getMediaSections=function(r){const o=t.splitSections(r);return o.shift(),o},t.matchPrefix=function(r,o){return t.splitLines(r).filter(c=>c.indexOf(o)===0)},t.parseCandidate=function(r){let o;o=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},t.writeCandidate=function(r){const o=[];o.push(r.foundation);const c=r.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(r.protocol.toUpperCase()),o.push(r.priority),o.push(r.address||r.ip),o.push(r.port);const u=r.type;return o.push("typ"),o.push(u),u!=="host"&&r.relatedAddress&&r.relatedPort&&(o.push("raddr"),o.push(r.relatedAddress),o.push("rport"),o.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(o.push("ufrag"),o.push(r.usernameFragment||r.ufrag)),"candidate:"+o.join(" ")},t.parseIceOptions=function(r){return r.substring(14).split(" ")},t.parseRtpMap=function(r){let o=r.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},t.writeRtpMap=function(r){let o=r.payloadType;r.preferredPayloadType!==void 0&&(o=r.preferredPayloadType);const c=r.channels||r.numChannels||1;return"a=rtpmap:"+o+" "+r.name+"/"+r.clockRate+(c!==1?"/"+c:"")+`\r
`},t.parseExtmap=function(r){const o=r.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},t.parseFmtp=function(r){const o={};let c;const u=r.substring(r.indexOf(" ")+1).split(";");for(let f=0;f<u.length;f++)c=u[f].trim().split("="),o[c[0].trim()]=c[1];return o},t.writeFmtp=function(r){let o="",c=r.payloadType;if(r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const u=[];Object.keys(r.parameters).forEach(f=>{r.parameters[f]!==void 0?u.push(f+"="+r.parameters[f]):u.push(f)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},t.parseRtcpFb=function(r){const o=r.substring(r.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},t.writeRtcpFb=function(r){let o="",c=r.payloadType;return r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},t.parseSsrcMedia=function(r){const o=r.indexOf(" "),c={ssrc:parseInt(r.substring(7,o),10)},u=r.indexOf(":",o);return u>-1?(c.attribute=r.substring(o+1,u),c.value=r.substring(u+1)):c.attribute=r.substring(o+1),c},t.parseSsrcGroup=function(r){const o=r.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},t.getMid=function(r){const o=t.matchPrefix(r,"a=mid:")[0];if(o)return o.substring(6)},t.parseFingerprint=function(r){const o=r.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},t.getDtlsParameters=function(r,o){return{role:"auto",fingerprints:t.matchPrefix(r+o,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(r,o){let c="a=setup:"+o+`\r
`;return r.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},t.parseCryptoLine=function(r){const o=r.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},t.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?t.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const o=r.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},t.getCryptoParameters=function(r,o){return t.matchPrefix(r+o,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(r,o){const c=t.matchPrefix(r+o,"a=ice-ufrag:")[0],u=t.matchPrefix(r+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},t.writeIceParameters=function(r){let o="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(o+=`a=ice-lite\r
`),o},t.parseRtpParameters=function(r){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=t.splitLines(r)[0].split(" ");o.profile=c[2];for(let f=3;f<c.length;f++){const g=c[f],E=t.matchPrefix(r,"a=rtpmap:"+g+" ")[0];if(E){const v=t.parseRtpMap(E),S=t.matchPrefix(r,"a=fmtp:"+g+" ");switch(v.parameters=S.length?t.parseFmtp(S[0]):{},v.rtcpFeedback=t.matchPrefix(r,"a=rtcp-fb:"+g+" ").map(t.parseRtcpFb),o.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(v.name.toUpperCase())}}}t.matchPrefix(r,"a=extmap:").forEach(f=>{o.headerExtensions.push(t.parseExtmap(f))});const u=t.matchPrefix(r,"a=rtcp-fb:* ").map(t.parseRtcpFb);return o.codecs.forEach(f=>{u.forEach(g=>{f.rtcpFeedback.find(E=>E.type===g.type&&E.parameter===g.parameter)||f.rtcpFeedback.push(g)})}),o},t.writeRtpDescription=function(r,o){let c="";c+="m="+r+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(f=>f.preferredPayloadType!==void 0?f.preferredPayloadType:f.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(f=>{c+=t.writeRtpMap(f),c+=t.writeFmtp(f),c+=t.writeRtcpFb(f)});let u=0;return o.codecs.forEach(f=>{f.maxptime>u&&(u=f.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(f=>{c+=t.writeExtmap(f)}),c},t.parseRtpEncodingParameters=function(r){const o=[],c=t.parseRtpParameters(r),u=c.fecMechanisms.indexOf("RED")!==-1,f=c.fecMechanisms.indexOf("ULPFEC")!==-1,g=t.matchPrefix(r,"a=ssrc:").map(I=>t.parseSsrcMedia(I)).filter(I=>I.attribute==="cname"),E=g.length>0&&g[0].ssrc;let v;const S=t.matchPrefix(r,"a=ssrc-group:FID").map(I=>I.substring(17).split(" ").map(D=>parseInt(D,10)));S.length>0&&S[0].length>1&&S[0][0]===E&&(v=S[0][1]),c.codecs.forEach(I=>{if(I.name.toUpperCase()==="RTX"&&I.parameters.apt){let D={ssrc:E,codecPayloadType:parseInt(I.parameters.apt,10)};E&&v&&(D.rtx={ssrc:v}),o.push(D),u&&(D=JSON.parse(JSON.stringify(D)),D.fec={ssrc:E,mechanism:f?"red+ulpfec":"red"},o.push(D))}}),o.length===0&&E&&o.push({ssrc:E});let R=t.matchPrefix(r,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,o.forEach(I=>{I.maxBitrate=R})),o},t.parseRtcpParameters=function(r){const o={},c=t.matchPrefix(r,"a=ssrc:").map(g=>t.parseSsrcMedia(g)).filter(g=>g.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=t.matchPrefix(r,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const f=t.matchPrefix(r,"a=rtcp-mux");return o.mux=f.length>0,o},t.writeRtcpParameters=function(r){let o="";return r.reducedSize&&(o+=`a=rtcp-rsize\r
`),r.mux&&(o+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(o+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),o},t.parseMsid=function(r){let o;const c=t.matchPrefix(r,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=t.matchPrefix(r,"a=ssrc:").map(f=>t.parseSsrcMedia(f)).filter(f=>f.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},t.parseSctpDescription=function(r){const o=t.parseMLine(r),c=t.matchPrefix(r,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const f=t.matchPrefix(r,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const g=t.matchPrefix(r,"a=sctpmap:");if(g.length>0){const E=g[0].substring(10).split(" ");return{port:parseInt(E[0],10),protocol:E[1],maxMessageSize:u}}},t.writeSctpDescription=function(r,o){let c=[];return c=r.protocol!=="DTLS/SCTP"?["m="+r.kind+" 9 "+r.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+r.kind+" 9 "+r.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(r,o,c){let u;const f=o!==void 0?o:2;return u=r||t.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+f+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(r,o){const c=t.splitLines(r);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?t.getDirection(o):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substring(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){const o=t.splitLines(r)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},t.parseOLine=function(r){const o=t.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const o=t.splitLines(r);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=t})(KV);var XV=KV.exports,Ay=l(XV),CJ=i({__proto__:null,default:Ay},[XV]);function YC(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const o=new t(r),c=Ay.parseCandidate(r.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,Ng(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function SP(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Ng(e,"icecandidate",t=>{if(t.candidate){const r=Ay.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t})}function qC(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const r=function(g){if(!g||!g.sdp)return!1;const E=Ay.splitSections(g.sdp);return E.shift(),E.some(v=>{const S=Ay.parseMLine(v);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(g){const E=g.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(E===null||E.length<2)return-1;const v=parseInt(E[1],10);return v!=v?-1:v},c=function(g){let E=65536;return t.browser==="firefox"&&(E=t.version<57?g===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),E},u=function(g,E){let v=65536;t.browser==="firefox"&&t.version===57&&(v=65535);const S=Ay.matchPrefix(g.sdp,"a=max-message-size:");return S.length>0?v=parseInt(S[0].substr(19),10):t.browser==="firefox"&&E!==-1&&(v=2147483637),v},f=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:g}=this.getConfiguration();g==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const g=o(arguments[0]),E=c(g),v=u(arguments[0],g);let S;S=E===0&&v===0?Number.POSITIVE_INFINITY:E===0||v===0?Math.max(E,v):Math.min(E,v);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>S}),this._sctp=R}return f.apply(this,arguments)}}function KC(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(o,c){const u=o.send;o.send=function(){const f=arguments[0],g=f.length||f.size||f.byteLength;if(o.readyState==="open"&&c.sctp&&g>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=r.apply(this,arguments);return t(o,this),o},Ng(e,"datachannel",o=>(t(o.channel,o.target),o))}function TP(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const o=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const f=new Event("connectionstatechange",c);u.dispatchEvent(f)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function bP(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>aa(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return r.apply(this,arguments)}}function XC(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&r.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?tt.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),tt.resolve())})}function QC(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&r.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return r.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?r.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>r.apply(this,[c]))})}var AJ=Object.freeze({__proto__:null,removeExtmapAllowMixed:bP,shimAddIceCandidateNullOrEmpty:XC,shimConnectionState:TP,shimMaxMessageSize:qC,shimParameterlessSetLocalDescription:QC,shimRTCIceCandidate:YC,shimRTCIceCandidateRelayProtocol:SP,shimSendThrowTypeError:KC});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const r=lV,o=function(u){const f={browser:null,version:null};if(u===void 0||!u.navigator)return f.browser="Not a browser.",f;const{navigator:g}=u;if(g.mozGetUserMedia)f.browser="firefox",f.version=zC(g.userAgent,/Firefox\/(\d+)\./,1);else if(g.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)f.browser="chrome",f.version=zC(g.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!g.userAgent.match(/AppleWebKit\/(\d+)\./))return f.browser="Not a supported browser.",f;f.browser="safari",f.version=zC(g.userAgent,/AppleWebKit\/(\d+)\./,1),f.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return f}(e),c={browserDetails:o,commonShim:AJ,extractVersion:zC,disableLog:uJ,disableWarnings:hJ,sdp:CJ};switch(o.browser){case"chrome":if(!bV||!_P||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),c;if(o.version===null)return r("Chrome shim can not determine version, not shimming."),c;r("adapter.js shimming chrome."),c.browserShim=bV,XC(e,o),QC(e),fV(e,o),mV(e),_P(e,o),gV(e),SV(e,o),_V(e),EV(e),yV(e),TV(e,o),YC(e),SP(e),TP(e),qC(e,o),KC(e),bP(e,o);break;case"firefox":if(!kV||!EP||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),c;r("adapter.js shimming firefox."),c.browserShim=kV,XC(e,o),QC(e),wV(e,o),EP(e,o),RV(e),IV(e),CV(e),AV(e),NV(e),OV(e),DV(e),xV(e),PV(e),YC(e),TP(e),qC(e,o),KC(e);break;case"safari":if(!WV||!t.shimSafari)return r("Safari shim is not included in this adapter release."),c;r("adapter.js shimming safari."),c.browserShim=WV,XC(e,o),QC(e),FV(e),HV(e),jV(e),LV(e),MV(e),BV(e),UV(e),GV(e),YC(e),SP(e),qC(e,o),KC(e),bP(e,o);break;default:r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var wP=z;Pn({global:!0,forced:wP.globalThis!==wP},{globalThis:wP});var QV=l(z),RP={exports:{}};(function(e,t){(function(r,o){var c="function",u="undefined",f="object",g="string",E="major",v="model",S="name",R="type",I="vendor",D="version",V="architecture",M="console",j="mobile",W="tablet",Y="smarttv",le="wearable",ye="embedded",Ee="Amazon",me="Apple",Ae="ASUS",Pe="BlackBerry",$e="Browser",at="Chrome",nn="Firefox",Xt="Google",Lt="Huawei",mr="LG",tr="Microsoft",Va="Motorola",ke="Opera",Ye="Samsung",pt="Sharp",Le="Sony",L="Xiaomi",ne="Zebra",he="Facebook",ze="Chromium OS",Wt="Mac OS",ur=" Browser",Di=function(Ai){for(var xi={},vr=0;vr<Ai.length;vr++)xi[Ai[vr].toUpperCase()]=Ai[vr];return xi},Lc=function(Ai,xi){return typeof Ai===g&&Ol(xi).indexOf(Ol(Ai))!==-1},Ol=function(Ai){return Ai.toLowerCase()},yw=function(Ai,xi){if(typeof Ai===g)return Ai=Ai.replace(/^\s\s*/,""),typeof xi===u?Ai:Ai.substring(0,500)},r_=function(Ai,xi){for(var vr,ao,yd,ci,Jh,Rn,vd=0;vd<xi.length&&!Jh;){var i_=xi[vd],Iu=xi[vd+1];for(vr=ao=0;vr<i_.length&&!Jh&&i_[vr];)if(Jh=i_[vr++].exec(Ai))for(yd=0;yd<Iu.length;yd++)Rn=Jh[++ao],typeof(ci=Iu[yd])===f&&ci.length>0?ci.length===2?typeof ci[1]==c?this[ci[0]]=ci[1].call(this,Rn):this[ci[0]]=ci[1]:ci.length===3?typeof ci[1]!==c||ci[1].exec&&ci[1].test?this[ci[0]]=Rn?Rn.replace(ci[1],ci[2]):o:this[ci[0]]=Rn?ci[1].call(this,Rn,ci[2]):o:ci.length===4&&(this[ci[0]]=Rn?ci[3].call(this,Rn.replace(ci[1],ci[2])):o):this[ci]=Rn||o;vd+=2}},yv=function(Ai,xi){for(var vr in xi)if(typeof xi[vr]===f&&xi[vr].length>0){for(var ao=0;ao<xi[vr].length;ao++)if(Lc(xi[vr][ao],Ai))return vr==="?"?o:vr}else if(Lc(xi[vr],Ai))return vr==="?"?o:vr;return xi.hasOwnProperty("*")?xi["*"]:Ai},YI={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},qI={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[D,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[D,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,D],[/opios[\/ ]+([\w\.]+)/i],[D,[S,ke+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[D,[S,ke+" GX"]],[/\bopr\/([\w\.]+)/i],[D,[S,ke]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[D,[S,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[D,[S,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[S,D],[/quark(?:pc)?\/([-\w\.]+)/i],[D,[S,"Quark"]],[/\bddg\/([\w\.]+)/i],[D,[S,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[D,[S,"UC"+$e]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[D,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[D,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[D,[S,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[D,[S,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[D,[S,"Smart Lenovo "+$e]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+$e],D],[/\bfocus\/([\w\.]+)/i],[D,[S,nn+" Focus"]],[/\bopt\/([\w\.]+)/i],[D,[S,ke+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[D,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[D,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[D,[S,ke+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[D,[S,"MIUI"+ur]],[/fxios\/([\w\.-]+)/i],[D,[S,nn]],[/\bqihoobrowser\/?([\w\.]*)/i],[D,[S,"360"]],[/\b(qq)\/([\w\.]+)/i],[[S,/(.+)/,"$1Browser"],D],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1"+ur],D],[/samsungbrowser\/([\w\.]+)/i],[D,[S,Ye+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[D,[S,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[S,"Sogou Mobile"],D],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[S,D],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[S],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[D,S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,he],D],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[S,D],[/\bgsa\/([\w\.]+) .*safari\//i],[D,[S,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[D,[S,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[D,[S,at+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,at+" WebView"],D],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[D,[S,"Android "+$e]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,D],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[D,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[D,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[D,yv,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,D],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],D],[/(wolvic|librewolf)\/([\w\.]+)/i],[S,D],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[D,[S,nn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[S,[D,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[S,[D,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[V,"amd64"]],[/(ia32(?=;))/i],[[V,Ol]],[/((?:i[346]|x)86)[;\)]/i],[[V,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[V,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[V,"armhf"]],[/windows (ce|mobile); ppc;/i],[[V,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[V,/ower/,"",Ol]],[/(sun4\w)[;\)]/i],[[V,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[V,Ol]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[I,Ye],[R,W]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[v,[I,Ye],[R,j]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[v,[I,me],[R,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[I,me],[R,W]],[/(macintosh);/i],[v,[I,me]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[I,pt],[R,j]],[/(?:honor)([-\w ]+)[;\)]/i],[v,[I,"Honor"],[R,j]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[I,Lt],[R,W]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[I,Lt],[R,j]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[v,/_/g," "],[I,L],[R,j]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[I,L],[R,W]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[I,"OPPO"],[R,j]],[/\b(opd2\d{3}a?) bui/i],[v,[I,"OPPO"],[R,W]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[I,"Vivo"],[R,j]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[v,[I,"Realme"],[R,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[I,Va],[R,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[I,Va],[R,W]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[I,mr],[R,W]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[I,mr],[R,j]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[I,"Lenovo"],[R,W]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[I,"Nokia"],[R,j]],[/(pixel c)\b/i],[v,[I,Xt],[R,W]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[I,Xt],[R,j]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[I,Le],[R,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[I,Le],[R,W]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[I,"OnePlus"],[R,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[I,Ee],[R,W]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[I,Ee],[R,j]],[/(playbook);[-\w\),; ]+(rim)/i],[v,I,[R,W]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[I,Pe],[R,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[I,Ae],[R,W]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[I,Ae],[R,j]],[/(nexus 9)/i],[v,[I,"HTC"],[R,W]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[I,[v,/_/g," "],[R,j]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[v,[I,"TCL"],[R,W]],[/(itel) ((\w+))/i],[[I,Ol],v,[R,yv,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[I,"Acer"],[R,W]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[I,"Meizu"],[R,j]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[v,[I,"Ulefone"],[R,j]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[v,[I,"Energizer"],[R,j]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[v,[I,"Cat"],[R,j]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[v,[I,"Smartfren"],[R,j]],[/droid.+; (a(?:015|06[35]|142p?))/i],[v,[I,"Nothing"],[R,j]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[I,v,[R,j]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[I,v,[R,W]],[/(surface duo)/i],[v,[I,tr],[R,W]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[I,"Fairphone"],[R,j]],[/(u304aa)/i],[v,[I,"AT&T"],[R,j]],[/\bsie-(\w*)/i],[v,[I,"Siemens"],[R,j]],[/\b(rct\w+) b/i],[v,[I,"RCA"],[R,W]],[/\b(venue[\d ]{2,7}) b/i],[v,[I,"Dell"],[R,W]],[/\b(q(?:mv|ta)\w+) b/i],[v,[I,"Verizon"],[R,W]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[I,"Barnes & Noble"],[R,W]],[/\b(tm\d{3}\w+) b/i],[v,[I,"NuVision"],[R,W]],[/\b(k88) b/i],[v,[I,"ZTE"],[R,W]],[/\b(nx\d{3}j) b/i],[v,[I,"ZTE"],[R,j]],[/\b(gen\d{3}) b.+49h/i],[v,[I,"Swiss"],[R,j]],[/\b(zur\d{3}) b/i],[v,[I,"Swiss"],[R,W]],[/\b((zeki)?tb.*\b) b/i],[v,[I,"Zeki"],[R,W]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[I,"Dragon Touch"],v,[R,W]],[/\b(ns-?\w{0,9}) b/i],[v,[I,"Insignia"],[R,W]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[I,"NextBook"],[R,W]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[I,"Voice"],v,[R,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[I,"LvTel"],v,[R,j]],[/\b(ph-1) /i],[v,[I,"Essential"],[R,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[I,"Envizen"],[R,W]],[/\b(trio[-\w\. ]+) b/i],[v,[I,"MachSpeed"],[R,W]],[/\btu_(1491) b/i],[v,[I,"Rotor"],[R,W]],[/(shield[\w ]+) b/i],[v,[I,"Nvidia"],[R,W]],[/(sprint) (\w+)/i],[I,v,[R,j]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[I,tr],[R,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[I,ne],[R,W]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[I,ne],[R,j]],[/smart-tv.+(samsung)/i],[I,[R,Y]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[I,Ye],[R,Y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[I,mr],[R,Y]],[/(apple) ?tv/i],[I,[v,me+" TV"],[R,Y]],[/crkey/i],[[v,at+"cast"],[I,Xt],[R,Y]],[/droid.+aft(\w+)( bui|\))/i],[v,[I,Ee],[R,Y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[I,pt],[R,Y]],[/(bravia[\w ]+)( bui|\))/i],[v,[I,Le],[R,Y]],[/(mitv-\w{5}) bui/i],[v,[I,L],[R,Y]],[/Hbbtv.*(technisat) (.*);/i],[I,v,[R,Y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[I,yw],[v,yw],[R,Y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,Y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[I,v,[R,M]],[/droid.+; (shield) bui/i],[v,[I,"Nvidia"],[R,M]],[/(playstation [345portablevi]+)/i],[v,[I,Le],[R,M]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[I,tr],[R,M]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[v,[I,Ye],[R,le]],[/((pebble))app/i],[I,v,[R,le]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[I,me],[R,le]],[/droid.+; (glass) \d/i],[v,[I,Xt],[R,le]],[/droid.+; (wt63?0{2,3})\)/i],[v,[I,ne],[R,le]],[/droid.+; (glass) \d/i],[v,[I,Xt],[R,le]],[/(pico) (4|neo3(?: link|pro)?)/i],[I,v,[R,le]],[/; (quest( \d| pro)?)/i],[v,[I,he],[R,le]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[I,[R,ye]],[/(aeobc)\b/i],[v,[I,Ee],[R,ye]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[v,[R,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[R,W]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,W]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,j]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[I,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[D,[S,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[S,D],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[D,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[S,D],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[D,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,D],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[S,[D,yv,YI]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[D,yv,YI],[S,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[D,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,Wt],[D,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[D,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,D],[/\(bb(10);/i],[D,[S,Pe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[D,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[D,[S,nn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[D,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[D,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[D,[S,at+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,ze],D],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,D],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],D],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[S,D]]},Mc=function(Ai,xi){if(typeof Ai===f&&(xi=Ai,Ai=o),!(this instanceof Mc))return new Mc(Ai,xi).getResult();var vr=typeof r!==u&&r.navigator?r.navigator:o,ao=Ai||(vr&&vr.userAgent?vr.userAgent:""),yd=vr&&vr.userAgentData?vr.userAgentData:o,ci=xi?function(Rn,vd){var i_={};for(var Iu in Rn)vd[Iu]&&vd[Iu].length%2==0?i_[Iu]=vd[Iu].concat(Rn[Iu]):i_[Iu]=Rn[Iu];return i_}(qI,xi):qI,Jh=vr&&vr.userAgent==ao;return this.getBrowser=function(){var Rn={};return Rn[S]=o,Rn[D]=o,r_.call(Rn,ao,ci.browser),Rn[E]=function(vd){return typeof vd===g?vd.replace(/[^\d\.]/g,"").split(".")[0]:o}(Rn[D]),Jh&&vr&&vr.brave&&typeof vr.brave.isBrave==c&&(Rn[S]="Brave"),Rn},this.getCPU=function(){var Rn={};return Rn[V]=o,r_.call(Rn,ao,ci.cpu),Rn},this.getDevice=function(){var Rn={};return Rn[I]=o,Rn[v]=o,Rn[R]=o,r_.call(Rn,ao,ci.device),Jh&&!Rn[R]&&yd&&yd.mobile&&(Rn[R]=j),Jh&&Rn[v]=="Macintosh"&&vr&&typeof vr.standalone!==u&&vr.maxTouchPoints&&vr.maxTouchPoints>2&&(Rn[v]="iPad",Rn[R]=W),Rn},this.getEngine=function(){var Rn={};return Rn[S]=o,Rn[D]=o,r_.call(Rn,ao,ci.engine),Rn},this.getOS=function(){var Rn={};return Rn[S]=o,Rn[D]=o,r_.call(Rn,ao,ci.os),Jh&&!Rn[S]&&yd&&yd.platform&&yd.platform!="Unknown"&&(Rn[S]=yd.platform.replace(/chrome os/i,ze).replace(/macos/i,Wt)),Rn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ao},this.setUA=function(Rn){return ao=typeof Rn===g&&Rn.length>500?yw(Rn,500):Rn,this},this.setUA(ao),this};Mc.VERSION="0.7.40",Mc.BROWSER=Di([S,D,E]),Mc.CPU=Di([V]),Mc.DEVICE=Di([v,I,R,M,j,Y,W,le,ye]),Mc.ENGINE=Mc.OS=Di([S,D]),e.exports&&(t=e.exports=Mc),t.UAParser=Mc;var $h=typeof r!==u&&(r.jQuery||r.Zepto);if($h&&!$h.ua){var KI=new Mc;$h.ua=KI.getResult(),$h.ua.get=function(){return KI.getUA()},$h.ua.set=function(Ai){KI.setUA(Ai);var xi=KI.getResult();for(var vr in xi)$h.ua[vr]=xi[vr]}}})(typeof window=="object"?window:a)})(RP,RP.exports);var IJ=l(RP.exports),$V=bc.clear;Pn({global:!0,bind:!0,forced:z.clearImmediate!==$V},{clearImmediate:$V});var JV=z,NJ=ce,OJ=fe,DJ=Op,xJ=Bt,PJ=Da,kJ=Za,LJ=JV.Function,MJ=/MSIE .\./.test(xJ)||DJ==="BUN"&&function(){var e=JV.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),jJ=Pn,ZV=z,eF=bc.set,UJ=function(e,t){var r=1;return MJ?function(o,c){var u=kJ(arguments.length,1)>r,f=OJ(o)?o:LJ(o),g=u?PJ(arguments,r):[],E=u?function(){NJ(f,this,g)}:f;return e(E)}:e},tF=ZV.setImmediate?UJ(eF):eF;jJ({global:!0,bind:!0,forced:ZV.setImmediate!==tF},{setImmediate:tF});var nF=l(Mt.setImmediate),VJ=z,FJ=Nh,BJ=ln,HJ=Za,GJ=Re;Pn({global:!0,dontCallGetSet:!0,forced:p(function(){return GJ&&Object.getOwnPropertyDescriptor(VJ,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){HJ(arguments.length,1),FJ(BJ(e))}});var rF=l(Mt.queueMicrotask);function iF(e,t){return function(){return e.apply(t,arguments)}}const{toString:WJ}=Object.prototype,{getPrototypeOf:CP}=Object,{iterator:$C,toStringTag:sF}=Symbol,JC=(AP=Object.create(null),e=>{const t=WJ.call(e);return AP[t]||(AP[t]=t.slice(8,-1).toLowerCase())});var AP;const ad=e=>(e=e.toLowerCase(),t=>JC(t)===e),ZC=e=>t=>typeof t===e,{isArray:Iy}=Array,mb=ZC("undefined"),aF=ad("ArrayBuffer"),zJ=ZC("string"),Qo=ZC("function"),oF=ZC("number"),eA=e=>e!==null&&typeof e=="object",tA=e=>{if(JC(e)!=="object")return!1;const t=CP(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||sF in e||$C in e)},YJ=ad("Date"),qJ=ad("File"),KJ=ad("Blob"),XJ=ad("FileList"),QJ=ad("URLSearchParams"),[$J,JJ,ZJ,eZ]=["ReadableStream","Request","Response","Headers"].map(ad);function gb(e,t){let r,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Iy(e))for(r=0,o=e.length;r<o;r++)t.call(null,e[r],r,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),f=u.length;let g;for(r=0;r<f;r++)g=u[r],t.call(null,e[g],g,e)}}function cF(e,t){t=t.toLowerCase();const r=Object.keys(e);let o,c=r.length;for(;c-- >0;)if(o=r[c],t===o.toLowerCase())return o;return null}const Og=QV!==void 0?QV:typeof self<"u"?self:typeof window<"u"?window:gL,lF=e=>!mb(e)&&e!==Og,tZ=(IP=typeof Uint8Array<"u"&&CP(Uint8Array),e=>IP&&e instanceof IP);var IP;const nZ=ad("HTMLFormElement"),dF=(e=>{let{hasOwnProperty:t}=e;return(r,o)=>t.call(r,o)})(Object.prototype),rZ=ad("RegExp"),uF=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),o={};gb(r,(c,u)=>{let f;(f=t(c,u,e))!==!1&&(o[u]=f||c)}),Object.defineProperties(e,o)},iZ=ad("AsyncFunction"),hF=(pF=typeof nF=="function",fF=Qo(Og.postMessage),pF?nF:fF?(NP="axios@".concat(Math.random()),nA=[],Og.addEventListener("message",e=>{let{source:t,data:r}=e;t===Og&&r===NP&&nA.length&&nA.shift()()},!1),e=>{nA.push(e),Og.postMessage(NP,"*")}):e=>setTimeout(e));var pF,fF,NP,nA;const sZ=rF!==void 0?rF.bind(Og):typeof process<"u"&&process.nextTick||hF;var et={isArray:Iy,isArrayBuffer:aF,isBuffer:function(e){return e!==null&&!mb(e)&&e.constructor!==null&&!mb(e.constructor)&&Qo(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Qo(e.append)&&((t=JC(e))==="formdata"||t==="object"&&Qo(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&aF(e.buffer),t},isString:zJ,isNumber:oF,isBoolean:e=>e===!0||e===!1,isObject:eA,isPlainObject:tA,isReadableStream:$J,isRequest:JJ,isResponse:ZJ,isHeaders:eZ,isUndefined:mb,isDate:YJ,isFile:qJ,isBlob:KJ,isRegExp:rZ,isFunction:Qo,isStream:e=>eA(e)&&Qo(e.pipe),isURLSearchParams:QJ,isTypedArray:tZ,isFileList:XJ,forEach:gb,merge:function e(){const{caseless:t}=lF(this)&&this||{},r={},o=(c,u)=>{const f=t&&cF(r,u)||u;tA(r[f])&&tA(c)?r[f]=e(r[f],c):tA(c)?r[f]=e({},c):Iy(c)?r[f]=c.slice():r[f]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&gb(arguments[c],o);return r},extend:function(e,t,r){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return gb(t,(c,u)=>{r&&Qo(c)?e[u]=iF(c,r):e[u]=c},{allOwnKeys:o}),e},trim:e=>aa(e)?aa(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,r,o)=>{e.prototype=Object.create(t.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,o)=>{let c,u,f;const g={};if(t=t||{},e==null)return t;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)f=c[u],o&&!o(f,e,t)||g[f]||(t[f]=e[f],g[f]=!0);e=r!==!1&&CP(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:JC,kindOfTest:ad,endsWith:(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const o=e.indexOf(t,r);return o!==-1&&o===r},toArray:e=>{if(!e)return null;if(Iy(e))return e;let t=e.length;if(!oF(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[$C]).call(e);let o;for(;(o=r.next())&&!o.done;){const c=o.value;t.call(e,c[0],c[1])}},matchAll:(e,t)=>{let r;const o=[];for(;(r=e.exec(t))!==null;)o.push(r);return o},isHTMLForm:nZ,hasOwnProperty:dF,hasOwnProp:dF,reduceDescriptors:uF,freezeMethods:e=>{uF(e,(t,r)=>{if(Qo(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const o=e[r];Qo(o)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{const r={},o=c=>{c.forEach(u=>{r[u]=!0})};return Iy(e)?o(e):o(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,o){return r.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:cF,global:Og,isContextDefined:lF,isSpecCompliantForm:function(e){return!!(e&&Qo(e.append)&&e[sF]==="FormData"&&e[$C])},toJSONObject:e=>{const t=new Array(10),r=(o,c)=>{if(eA(o)){if(t.indexOf(o)>=0)return;if(!("toJSON"in o)){t[c]=o;const u=Iy(o)?[]:{};return gb(o,(f,g)=>{const E=r(f,c+1);!mb(E)&&(u[g]=E)}),t[c]=void 0,u}}return o};return r(e,0)},isAsyncFn:iZ,isThenable:e=>e&&(eA(e)||Qo(e))&&Qo(e.then)&&Qo(e.catch),setImmediate:hF,asap:sZ,isIterable:e=>e!=null&&Qo(e[$C])};function Jn(e,t,r,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}et.inherits(Jn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:et.toJSONObject(this.config),code:this.code,status:this.status}}});const mF=Jn.prototype,gF={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{gF[e]={value:e}}),Object.defineProperties(Jn,gF),Object.defineProperty(mF,"isAxiosError",{value:!0}),Jn.from=(e,t,r,o,c,u)=>{const f=Object.create(mF);return et.toFlatObject(e,f,function(g){return g!==Error.prototype},g=>g!=="isAxiosError"),Jn.call(f,e.message,t,r,o,c),f.cause=e,f.name=e.name,u&&Object.assign(f,u),f};function OP(e){return et.isPlainObject(e)||et.isArray(e)}function _F(e){return et.endsWith(e,"[]")?e.slice(0,-2):e}function EF(e,t,r){return e?e.concat(t).map(function(o,c){return o=_F(o),!r&&c?"["+o+"]":o}).join(r?".":""):t}const aZ=et.toFlatObject(et,{},null,function(e){return/^is[A-Z]/.test(e)});function rA(e,t,r){if(!et.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const o=(r=et.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(I,D){return!et.isUndefined(D[I])})).metaTokens,c=r.visitor||v,u=r.dots,f=r.indexes,g=(r.Blob||typeof Blob<"u"&&Blob)&&et.isSpecCompliantForm(t);if(!et.isFunction(c))throw new TypeError("visitor must be a function");function E(I){if(I===null)return"";if(et.isDate(I))return I.toISOString();if(!g&&et.isBlob(I))throw new Jn("Blob is not supported. Use a Buffer instead.");return et.isArrayBuffer(I)||et.isTypedArray(I)?g&&typeof Blob=="function"?new Blob([I]):Buffer.from(I):I}function v(I,D,V){let M=I;if(I&&!V&&typeof I=="object"){if(et.endsWith(D,"{}"))D=o?D:D.slice(0,-2),I=JSON.stringify(I);else if(et.isArray(I)&&function(j){return et.isArray(j)&&!j.some(OP)}(I)||(et.isFileList(I)||et.endsWith(D,"[]"))&&(M=et.toArray(I)))return D=_F(D),M.forEach(function(j,W){!et.isUndefined(j)&&j!==null&&t.append(f===!0?EF([D],W,u):f===null?D:D+"[]",E(j))}),!1}return!!OP(I)||(t.append(EF(V,D,u),E(I)),!1)}const S=[],R=Object.assign(aZ,{defaultVisitor:v,convertValue:E,isVisitable:OP});if(!et.isObject(e))throw new TypeError("data must be an object");return function I(D,V){if(!et.isUndefined(D)){if(S.indexOf(D)!==-1)throw Error("Circular reference detected in "+V.join("."));S.push(D),et.forEach(D,function(M,j){(!(et.isUndefined(M)||M===null)&&c.call(t,M,et.isString(j)?aa(j).call(j):j,V,R))===!0&&I(M,V?V.concat(j):[j])}),S.pop()}}(e),t}function yF(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function DP(e,t){this._pairs=[],e&&rA(e,this,t)}const vF=DP.prototype;function oZ(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function SF(e,t,r){if(!t)return e;const o=r&&r.encode||oZ;et.isFunction(r)&&(r={serialize:r});const c=r&&r.serialize;let u;if(u=c?c(t,r):et.isURLSearchParams(t)?t.toString():new DP(t,r).toString(o),u){const f=e.indexOf("#");f!==-1&&(e=e.slice(0,f)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}vF.append=function(e,t){this._pairs.push([e,t])},vF.toString=function(e){const t=e?function(r){return e.call(this,r,yF)}:yF;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};var TF=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){et.forEach(this.handlers,function(t){t!==null&&e(t)})}},bF={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wF={exports:{}},cZ=Pn,lZ=Re,RF=Ws.f;cZ({target:"Object",stat:!0,forced:Object.defineProperty!==RF,sham:!lZ},{defineProperty:RF});var CF=Mt.Object,dZ=wF.exports=function(e,t,r){return CF.defineProperty(e,t,r)};CF.defineProperty.sham&&(dZ.sham=!0);var AF=l(wF.exports),uZ=TypeError,IF=Zc,hZ=eg,pZ=xt,fZ=jr("species"),NF=Array,mZ=function(e){var t;return IF(e)&&(t=e.constructor,(hZ(t)&&(t===NF||IF(t.prototype))||pZ(t)&&(t=t[fZ])===null)&&(t=void 0)),t===void 0?NF:t},OF=function(e,t){return new(mZ(e))(t===0?0:t)},gZ=p,_Z=ji,EZ=jr("species"),DF=function(e){return _Z>=51||!gZ(function(){var t=[];return(t.constructor={})[EZ]=function(){return{foo:1}},t[e](Boolean).foo!==1})},yZ=Pn,vZ=p,SZ=Zc,TZ=xt,bZ=Eo,wZ=qn,xF=function(e){if(e>9007199254740991)throw uZ("Maximum allowed index exceeded");return e},PF=qx,RZ=OF,CZ=DF,AZ=ji,kF=jr("isConcatSpreadable"),IZ=AZ>=51||!vZ(function(){var e=[];return e[kF]=!1,e.concat()[0]!==e}),NZ=function(e){if(!TZ(e))return!1;var t=e[kF];return t!==void 0?!!t:SZ(e)};yZ({target:"Array",proto:!0,forced:!IZ||!CZ("concat")},{concat:function(e){var t,r,o,c,u,f=bZ(this),g=RZ(f,0),E=0;for(t=-1,o=arguments.length;t<o;t++)if(NZ(u=t===-1?f:arguments[t]))for(c=wZ(u),xF(E+c),r=0;r<c;r++,E++)r in u&&PF(g,E,u[r]);else xF(E+1),PF(g,E++,u);return g.length=E,g}});var LF={},OZ=ee,DZ=wt,MF=tl.f,xZ=Da,jF=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];LF.f=function(e){return jF&&OZ(e)==="Window"?function(t){try{return MF(t)}catch{return xZ(jF)}}(e):MF(DZ(e))};var Ny={},PZ=jr;Ny.f=PZ;var UF=Mt,kZ=hi,LZ=Ny,MZ=Ws.f,as=function(e){var t=UF.Symbol||(UF.Symbol={});kZ(t,e)||MZ(t,e,{value:LZ.f(e)})},jZ=Ne,UZ=Un,VZ=jr,FZ=xs,VF=function(){var e=UZ("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,o=VZ("toPrimitive");t&&!t[o]&&FZ(t,o,function(c){return jZ(r,this)},{})},BZ=vo,HZ=Tt,GZ=Eo,WZ=qn,zZ=OF,FF=k([].push),YZ=function(e){var t=e===1,r=e===2,o=e===3,c=e===4,u=e===6,f=e===7,g=e===5||u;return function(E,v,S,R){for(var I,D,V=GZ(E),M=HZ(V),j=WZ(M),W=BZ(v,S),Y=0,le=R||zZ,ye=t?le(E,j):r||f?le(E,0):void 0;j>Y;Y++)if((g||Y in M)&&(D=W(I=M[Y],Y,V),e))if(t)ye[Y]=D;else if(D)switch(e){case 3:return!0;case 5:return I;case 6:return Y;case 2:FF(ye,I)}else switch(e){case 4:return!1;case 7:FF(ye,I)}return u?-1:o||c?c:ye}},BF={forEach:YZ(0)},iA=Pn,_b=z,xP=Ne,qZ=k,Oy=Re,Dy=Cs,KZ=p,ga=hi,XZ=U,PP=ss,sA=wt,kP=qa,QZ=Os,LP=ut,xy=Eh,HF=Lp,$Z=tl,GF=LF,JZ=ph,WF=pe,zF=Ws,ZZ=fh,YF=Ce,qF=xs,eee=bi,MP=fa,KF=Ds,XF=pc,tee=jr,nee=Ny,ree=as,iee=VF,see=vc,QF=yc,aA=BF.forEach,$o=Ii("hidden"),oA="Symbol",Eb="prototype",aee=QF.set,$F=QF.getterFor(oA),od=Object[Eb],Dg=_b.Symbol,cA=Dg&&Dg[Eb],oee=_b.RangeError,cee=_b.TypeError,jP=_b.QObject,JF=WF.f,xg=zF.f,ZF=GF.f,lee=YF.f,eB=qZ([].push),jh=MP("symbols"),yb=MP("op-symbols"),dee=MP("wks"),UP=!jP||!jP[Eb]||!jP[Eb].findChild,tB=function(e,t,r){var o=JF(od,t);o&&delete od[t],xg(e,t,r),o&&e!==od&&xg(od,t,o)},VP=Oy&&KZ(function(){return xy(xg({},"a",{get:function(){return xg(this,"a",{value:7}).a}})).a!==7})?tB:xg,FP=function(e,t){var r=jh[e]=xy(cA);return aee(r,{type:oA,tag:e,description:t}),Oy||(r.description=t),r},lA=function(e,t,r){e===od&&lA(yb,t,r),PP(e);var o=kP(t);return PP(r),ga(jh,o)?(r.enumerable?(ga(e,$o)&&e[$o][o]&&(e[$o][o]=!1),r=xy(r,{enumerable:LP(0,!1)})):(ga(e,$o)||xg(e,$o,LP(1,xy(null))),e[$o][o]=!0),VP(e,o,r)):xg(e,o,r)},BP=function(e,t){PP(e);var r=sA(t),o=HF(r).concat(sB(r));return aA(o,function(c){Oy&&!xP(nB,r,c)||lA(e,c,r[c])}),e},nB=function(e){var t=kP(e),r=xP(lee,this,t);return!(this===od&&ga(jh,t)&&!ga(yb,t))&&(!(r||!ga(this,t)||!ga(jh,t)||ga(this,$o)&&this[$o][t])||r)},rB=function(e,t){var r=sA(e),o=kP(t);if(r!==od||!ga(jh,o)||ga(yb,o)){var c=JF(r,o);return!c||!ga(jh,o)||ga(r,$o)&&r[$o][o]||(c.enumerable=!0),c}},iB=function(e){var t=ZF(sA(e)),r=[];return aA(t,function(o){ga(jh,o)||ga(KF,o)||eB(r,o)}),r},sB=function(e){var t=e===od,r=ZF(t?yb:sA(e)),o=[];return aA(r,function(c){!ga(jh,c)||t&&!ga(od,c)||eB(o,jh[c])}),o};Dy||(Dg=function(){if(XZ(cA,this))throw new cee("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?QZ(arguments[0]):void 0,t=XF(e),r=function(o){var c=this===void 0?_b:this;c===od&&xP(r,yb,o),ga(c,$o)&&ga(c[$o],t)&&(c[$o][t]=!1);var u=LP(1,o);try{VP(c,t,u)}catch(f){if(!(f instanceof oee))throw f;tB(c,t,u)}};return Oy&&UP&&VP(od,t,{configurable:!0,set:r}),FP(t,e)},qF(cA=Dg[Eb],"toString",function(){return $F(this).tag}),qF(Dg,"withoutSetter",function(e){return FP(XF(e),e)}),YF.f=nB,zF.f=lA,ZZ.f=BP,WF.f=rB,$Z.f=GF.f=iB,JZ.f=sB,nee.f=function(e){return FP(tee(e),e)},Oy&&eee(cA,"description",{configurable:!0,get:function(){return $F(this).description}})),iA({global:!0,wrap:!0,forced:!Dy,sham:!Dy},{Symbol:Dg}),aA(HF(dee),function(e){ree(e)}),iA({target:oA,stat:!0,forced:!Dy},{useSetter:function(){UP=!0},useSimple:function(){UP=!1}}),iA({target:"Object",stat:!0,forced:!Dy,sham:!Oy},{create:function(e,t){return t===void 0?xy(e):BP(xy(e),t)},defineProperty:lA,defineProperties:BP,getOwnPropertyDescriptor:rB}),iA({target:"Object",stat:!0,forced:!Dy},{getOwnPropertyNames:iB}),iee(),see(Dg,oA),KF[$o]=!0;var aB=Cs&&!!Symbol.for&&!!Symbol.keyFor,uee=Pn,hee=Un,pee=hi,fee=Os,oB=fa,mee=aB,HP=oB("string-to-symbol-registry"),gee=oB("symbol-to-string-registry");uee({target:"Symbol",stat:!0,forced:!mee},{for:function(e){var t=fee(e);if(pee(HP,t))return HP[t];var r=hee("Symbol")(t);return HP[t]=r,gee[r]=t,r}});var _ee=Pn,Eee=hi,yee=Ke,vee=un,See=aB,cB=fa("symbol-to-string-registry");_ee({target:"Symbol",stat:!0,forced:!See},{keyFor:function(e){if(!yee(e))throw new TypeError(vee(e)+" is not a symbol");if(Eee(cB,e))return cB[e]}});var lB=Zc,Tee=fe,dB=ee,bee=Os,uB=k([].push),wee=Pn,hB=Un,pB=ce,Ree=Ne,vb=k,fB=p,mB=fe,gB=Ke,_B=Da,Cee=function(e){if(Tee(e))return e;if(lB(e)){for(var t=e.length,r=[],o=0;o<t;o++){var c=e[o];typeof c=="string"?uB(r,c):typeof c!="number"&&dB(c)!=="Number"&&dB(c)!=="String"||uB(r,bee(c))}var u=r.length,f=!0;return function(g,E){if(f)return f=!1,E;if(lB(this))return E;for(var v=0;v<u;v++)if(r[v]===g)return E}}},Aee=Cs,Iee=String,yf=hB("JSON","stringify"),dA=vb(/./.exec),EB=vb("".charAt),Nee=vb("".charCodeAt),Oee=vb("".replace),Dee=vb(1 .toString),xee=/[\uD800-\uDFFF]/g,yB=/^[\uD800-\uDBFF]$/,vB=/^[\uDC00-\uDFFF]$/,SB=!Aee||fB(function(){var e=hB("Symbol")("stringify detection");return yf([e])!=="[null]"||yf({a:e})!=="{}"||yf(Object(e))!=="{}"}),TB=fB(function(){return yf("\uDF06\uD834")!=='"\\udf06\\ud834"'||yf("\uDEAD")!=='"\\udead"'}),Pee=function(e,t){var r=_B(arguments),o=Cee(t);if(mB(o)||e!==void 0&&!gB(e))return r[1]=function(c,u){if(mB(o)&&(u=Ree(o,this,Iee(c),u)),!gB(u))return u},pB(yf,null,r)},kee=function(e,t,r){var o=EB(r,t-1),c=EB(r,t+1);return dA(yB,e)&&!dA(vB,c)||dA(vB,e)&&!dA(yB,o)?"\\u"+Dee(Nee(e,0),16):e};yf&&wee({target:"JSON",stat:!0,forced:SB||TB},{stringify:function(e,t,r){var o=_B(arguments),c=pB(SB?Pee:yf,null,o);return TB&&typeof c=="string"?Oee(c,xee,kee):c}});var bB=ph,Lee=Eo;Pn({target:"Object",stat:!0,forced:!Cs||p(function(){bB.f(1)})},{getOwnPropertySymbols:function(e){var t=bB.f;return t?t(Lee(e)):[]}}),as("asyncIterator"),as("hasInstance"),as("isConcatSpreadable"),as("iterator"),as("match"),as("matchAll"),as("replace"),as("search"),as("species"),as("split");var Mee=VF;as("toPrimitive"),Mee();var jee=Un,Uee=vc;as("toStringTag"),Uee(jee("Symbol"),"Symbol"),as("unscopables"),vc(z.JSON,"JSON",!0);var Vee=Mt.Symbol,Fee=jr,Bee=Ws.f,wB=Fee("metadata"),RB=Function.prototype;RB[wB]===void 0&&Bee(RB,wB,{value:null}),as("asyncDispose"),as("dispose"),as("metadata");var Hee=Vee,Gee=k,GP=Un("Symbol"),Wee=GP.keyFor,zee=Gee(GP.prototype.valueOf),CB=GP.isRegisteredSymbol||function(e){try{return Wee(zee(e))!==void 0}catch{return!1}};Pn({target:"Symbol",stat:!0},{isRegisteredSymbol:CB});for(var Yee=fa,AB=Un,qee=k,Kee=Ke,Xee=jr,uA=AB("Symbol"),IB=uA.isWellKnownSymbol,NB=AB("Object","getOwnPropertyNames"),Qee=qee(uA.prototype.valueOf),OB=Yee("wks"),WP=0,DB=NB(uA),$ee=DB.length;WP<$ee;WP++)try{var xB=DB[WP];Kee(uA[xB])&&Xee(xB)}catch{}var PB=function(e){if(IB&&IB(e))return!0;try{for(var t=Qee(e),r=0,o=NB(OB),c=o.length;r<c;r++)if(OB[o[r]]==t)return!0}catch{}return!1};Pn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:PB}),as("customMatcher"),as("observable"),Pn({target:"Symbol",stat:!0},{isRegistered:CB}),Pn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:PB}),as("matcher"),as("metadataKey"),as("patternMatch"),as("replaceAll");var Py=l(Hee),kB=l(Ny.f("iterator"));function Sb(e){return Sb=typeof Py=="function"&&typeof kB=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Py=="function"&&t.constructor===Py&&t!==Py.prototype?"symbol":typeof t},Sb(e)}var Jee=l(Ny.f("toPrimitive"));function Zee(e){var t=function(r,o){if(Sb(r)!="object"||!r)return r;var c=r[Jee];if(c!==void 0){var u=c.call(r,o);if(Sb(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(r)}(e,"string");return Sb(t)=="symbol"?t:t+""}function H(e,t,r){return(t=Zee(t))in e?AF(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var LB=l(ZQ),ete={isBrowser:!0,classes:{URLSearchParams:LB!==void 0?LB:DP,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const zP=typeof window<"u"&&typeof document<"u",YP=typeof navigator=="object"&&navigator||void 0,tte=zP&&(!YP||["ReactNative","NativeScript","NS"].indexOf(YP.product)<0),nte=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",rte=zP&&window.location.href||"http://localhost";function MB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function jB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?MB(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):MB(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}var to=jB(jB({},Object.freeze({__proto__:null,hasBrowserEnv:zP,hasStandardBrowserEnv:tte,hasStandardBrowserWebWorkerEnv:nte,navigator:YP,origin:rte})),ete),ite=ss,ste=Ne,ate=hi,ote=U,cte=function(){var e=ite(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},UB=RegExp.prototype,VB=function(e){var t=e.flags;return t!==void 0||"flags"in UB||ate(e,"flags")||!ote(UB,e)?t:ste(cte,e)},lte=_g.charAt,FB=Ne,dte=ss,ute=fe,hte=ee,pte=/./.exec,fte=TypeError,mte=Pn,BB=Ne,HB=ae,gte=PE,hA=qp,GB=yt,WB=Sr,Tb=Os,_te=ss,Ete=on,yte=ee,vte=gS,zB=VB,Ste=qr,Tte=p,bte=BE,wte=function(e,t,r){return t+(r?lte(e,t).length:1)},Rte=function(e,t){var r=e.exec;if(ute(r)){var o=FB(r,e,t);return o!==null&&dte(o),o}if(hte(e)==="RegExp")return FB(pte,e,t);throw new fte("RegExp#exec called on incompatible receiver")},YB=yc,Cte=jr("matchAll"),qB="RegExp String",KB=qB+" Iterator",Ate=YB.set,Ite=YB.getterFor(KB),Nte=TypeError,qP=HB("".indexOf),pA=HB("".matchAll),KP=!!pA&&!Tte(function(){pA("a",/./)}),Ote=gte(function(e,t,r,o){Ate(this,{type:KB,regexp:e,string:t,global:r,unicode:o,done:!1})},qB,function(){var e=Ite(this);if(e.done)return hA(void 0,!0);var t=e.regexp,r=e.string,o=Rte(t,r);return o===null?(e.done=!0,hA(void 0,!0)):e.global?(Tb(o[0])===""&&(t.lastIndex=wte(r,WB(t.lastIndex),e.unicode)),hA(o,!1)):(e.done=!0,hA(o,!1))}),XB=function(e){var t,r,o,c=_te(this),u=Tb(e),f=bte(c,RegExp),g=Tb(zB(c));return t=new f(f===RegExp?c.source:c,g),r=!!~qP(g,"g"),o=!!~qP(g,"u"),t.lastIndex=WB(c.lastIndex),new Ote(t,u,r,o)};mte({target:"String",proto:!0,forced:KP},{matchAll:function(e){var t,r,o,c,u=GB(this);if(Ete(e)){if(KP)return pA(u,e)}else{if(vte(e)&&(t=Tb(GB(zB(e))),!~qP(t,"g")))throw new Nte("`.matchAll` does not allow non-global regexes");if(KP)return pA(u,e);if((o=Ste(e,Cte))===void 0&&yte(e)==="RegExp"&&(o=XB),o)return BB(o,e,u)}return r=Tb(u),c=new RegExp(e,"g"),BB(XB,c,r)}});var Dte=So("String","matchAll"),xte=U,Pte=Dte,XP=String.prototype,kte=function(e){var t=e.matchAll;return typeof e=="string"||e===XP||xte(XP,e)&&t===XP.matchAll?Pte:t},Lte=l(kte);function QB(e){function t(r,o,c,u){let f=r[u++];if(f==="__proto__")return!0;const g=Number.isFinite(+f),E=u>=r.length;return f=!f&&et.isArray(c)?c.length:f,E?(et.hasOwnProp(c,f)?c[f]=[c[f],o]:c[f]=o,!g):(c[f]&&et.isObject(c[f])||(c[f]=[]),t(r,o,c[f],u)&&et.isArray(c[f])&&(c[f]=function(v){const S={},R=Object.keys(v);let I;const D=R.length;let V;for(I=0;I<D;I++)V=R[I],S[V]=v[V];return S}(c[f])),!g)}if(et.isFormData(e)&&et.isFunction(e.entries)){const r={};return et.forEachEntry(e,(o,c)=>{t(function(u){return Lte(et).call(et,/\w+|\[(\w*)]/g,u).map(f=>f[0]==="[]"?"":f[1]||f[0])}(o),c,r,0)}),r}return null}const QP={transitional:bF,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",o=r.indexOf("application/json")>-1,c=et.isObject(e);if(c&&et.isHTMLForm(e)&&(e=new FormData(e)),et.isFormData(e))return o?JSON.stringify(QB(e)):e;if(et.isArrayBuffer(e)||et.isBuffer(e)||et.isStream(e)||et.isFile(e)||et.isBlob(e)||et.isReadableStream(e))return e;if(et.isArrayBufferView(e))return e.buffer;if(et.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(f,g){return rA(f,new to.classes.URLSearchParams,Object.assign({visitor:function(E,v,S,R){return to.isNode&&et.isBuffer(E)?(this.append(v,E.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},g))}(e,this.formSerializer).toString();if((u=et.isFileList(e))||r.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return rA(u?{"files[]":e}:e,f&&new f,this.formSerializer)}}return c||o?(t.setContentType("application/json",!1),function(f,g,E){if(et.isString(f))try{return(g||JSON.parse)(f),aa(et).call(et,f)}catch(v){if(v.name!=="SyntaxError")throw v}return(E||JSON.stringify)(f)}(e)):e}],transformResponse:[function(e){const t=this.transitional||QP.transitional,r=t&&t.forcedJSONParsing,o=this.responseType==="json";if(et.isResponse(e)||et.isReadableStream(e))return e;if(e&&et.isString(e)&&(r&&!this.responseType||o)){const c=!(t&&t.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?Jn.from(u,Jn.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:to.classes.FormData,Blob:to.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};et.forEach(["delete","get","head","post","put","patch"],e=>{QP.headers[e]={}});var $P=QP;const Mte=et.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),$B=Symbol("internals");function bb(e){var t;return e&&aa(t=String(e)).call(t).toLowerCase()}function fA(e){return e===!1||e==null?e:et.isArray(e)?e.map(fA):String(e)}function JP(e,t,r,o,c){return et.isFunction(o)?o.call(this,t,r):(c&&(t=r),et.isString(t)?et.isString(o)?t.indexOf(o)!==-1:et.isRegExp(o)?o.test(t):void 0:void 0)}class mA{constructor(t){t&&this.set(t)}set(t,r,o){const c=this;function u(E,v,S){const R=bb(v);if(!R)throw new Error("header name must be a non-empty string");const I=et.findKey(c,R);(!I||c[I]===void 0||S===!0||S===void 0&&c[I]!==!1)&&(c[I||v]=fA(E))}const f=(E,v)=>et.forEach(E,(S,R)=>u(S,R,v));if(et.isPlainObject(t)||t instanceof this.constructor)f(t,r);else if(et.isString(t)&&(t=aa(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(aa(g=t).call(g)))f((E=>{const v={};let S,R,I;return E&&E.split(`
`).forEach(function(D){var V,M;I=D.indexOf(":"),S=aa(V=D.substring(0,I)).call(V).toLowerCase(),R=aa(M=D.substring(I+1)).call(M),!S||v[S]&&Mte[S]||(S==="set-cookie"?v[S]?v[S].push(R):v[S]=[R]:v[S]=v[S]?v[S]+", "+R:R)}),v})(t),r);else if(et.isObject(t)&&et.isIterable(t)){let E,v,S={};for(const R of t){if(!et.isArray(R))throw TypeError("Object iterator must return a key-value pair");S[v=R[0]]=(E=S[v])?et.isArray(E)?[...E,R[1]]:[E,R[1]]:R[1]}f(S,r)}else t!=null&&u(r,t,o);var g;return this}get(t,r){if(t=bb(t)){const o=et.findKey(this,t);if(o){const c=this[o];if(!r)return c;if(r===!0)return function(u){const f=Object.create(null),g=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let E;for(;E=g.exec(u);)f[E[1]]=E[2];return f}(c);if(et.isFunction(r))return r.call(this,c,o);if(et.isRegExp(r))return r.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=bb(t)){const o=et.findKey(this,t);return!(!o||this[o]===void 0||r&&!JP(0,this[o],o,r))}return!1}delete(t,r){const o=this;let c=!1;function u(f){if(f=bb(f)){const g=et.findKey(o,f);!g||r&&!JP(0,o[g],g,r)||(delete o[g],c=!0)}}return et.isArray(t)?t.forEach(u):u(t),c}clear(t){const r=Object.keys(this);let o=r.length,c=!1;for(;o--;){const u=r[o];t&&!JP(0,this[u],u,t,!0)||(delete this[u],c=!0)}return c}normalize(t){const r=this,o={};return et.forEach(this,(c,u)=>{var f;const g=et.findKey(o,u);if(g)return r[g]=fA(c),void delete r[u];const E=t?function(v){return aa(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,R,I)=>R.toUpperCase()+I)}(u):aa(f=String(u)).call(f);E!==u&&delete r[u],r[E]=fA(c),o[E]=!0}),this}concat(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return this.constructor.concat(this,...r)}toJSON(t){const r=Object.create(null);return et.forEach(this,(o,c)=>{o!=null&&o!==!1&&(r[c]=t&&et.isArray(o)?o.join(", "):o)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[r,o]=t;return r+": "+o}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const r=new this(t);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(f=>r.set(f)),r}static accessor(t){const r=(this[$B]=this[$B]={accessors:{}}).accessors,o=this.prototype;function c(u){const f=bb(u);r[f]||(function(g,E){const v=et.toCamelCase(" "+E);["get","set","has"].forEach(S=>{Object.defineProperty(g,S+v,{value:function(R,I,D){return this[S].call(this,E,R,I,D)},configurable:!0})})}(o,u),r[f]=!0)}return et.isArray(t)?t.forEach(c):c(t),this}}mA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),et.reduceDescriptors(mA.prototype,(e,t)=>{let{value:r}=e,o=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(c){this[o]=c}}}),et.freezeMethods(mA);var cd=mA;function ZP(e,t){const r=this||$P,o=t||r,c=cd.from(o.headers);let u=o.data;return et.forEach(e,function(f){u=f.call(r,u,c.normalize(),t?t.status:void 0)}),c.normalize(),u}function JB(e){return!(!e||!e.__CANCEL__)}function ky(e,t,r){Jn.call(this,e??"canceled",Jn.ERR_CANCELED,t,r),this.name="CanceledError"}function ZB(e,t,r){const o=r.config.validateStatus;r.status&&o&&!o(r.status)?t(new Jn("Request failed with status code "+r.status,[Jn.ERR_BAD_REQUEST,Jn.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}et.inherits(ky,Jn,{__CANCEL__:!0});const gA=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,f){u=u||10;const g=new Array(u),E=new Array(u);let v,S=0,R=0;return f=f!==void 0?f:1e3,function(I){const D=Date.now(),V=E[R];v||(v=D),g[S]=I,E[S]=D;let M=R,j=0;for(;M!==S;)j+=g[M++],M%=u;if(S=(S+1)%u,S===R&&(R=(R+1)%u),D-v<f)return;const W=V&&D-V;return W?Math.round(1e3*j/W):void 0}}(50,250);return function(u,f){let g,E,v=0,S=1e3/f;const R=function(I){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),g=null,E&&(clearTimeout(E),E=null),u.apply(null,I)};return[function(){const I=Date.now(),D=I-v;for(var V=arguments.length,M=new Array(V),j=0;j<V;j++)M[j]=arguments[j];D>=S?R(M,I):(g=M,E||(E=setTimeout(()=>{E=null,R(g)},S-D)))},()=>g&&R(g)]}(u=>{const f=u.loaded,g=u.lengthComputable?u.total:void 0,E=f-o,v=c(E);o=f,e({loaded:f,total:g,progress:g?f/g:void 0,bytes:E,rate:v||void 0,estimated:v&&g&&f<=g?(g-f)/v:void 0,event:u,lengthComputable:g!=null,[t?"download":"upload"]:!0})},r)},e3=(e,t)=>{const r=e!=null;return[o=>t[0]({lengthComputable:r,total:e,loaded:o}),t[1]]},t3=e=>function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return et.asap(()=>e(...r))};var jte=to.hasStandardBrowserEnv?((e,t)=>r=>(r=new WC(r,to.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new WC(to.origin),to.navigator&&/(msie|trident)/i.test(to.navigator.userAgent)):()=>!0,Ute=to.hasStandardBrowserEnv?{write(e,t,r,o,c,u){const f=[e+"="+encodeURIComponent(t)];et.isNumber(r)&&f.push("expires="+new Date(r).toGMTString()),et.isString(o)&&f.push("path="+o),et.isString(c)&&f.push("domain="+c),u===!0&&f.push("secure"),document.cookie=f.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function n3(e,t,r){let o=!function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}(t);return e&&(o||r==0)?function(c,u){return u?c.replace(/\/?\/$/,"")+"/"+u.replace(/^\/+/,""):c}(e,t):t}function r3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}const i3=e=>e instanceof cd?function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?r3(Object(o),!0).forEach(function(c){H(t,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):r3(Object(o)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(o,c))})}return t}({},e):e;function Pg(e,t){t=t||{};const r={};function o(v,S,R,I){return et.isPlainObject(v)&&et.isPlainObject(S)?et.merge.call({caseless:I},v,S):et.isPlainObject(S)?et.merge({},S):et.isArray(S)?S.slice():S}function c(v,S,R,I){return et.isUndefined(S)?et.isUndefined(v)?void 0:o(void 0,v,0,I):o(v,S,0,I)}function u(v,S){if(!et.isUndefined(S))return o(void 0,S)}function f(v,S){return et.isUndefined(S)?et.isUndefined(v)?void 0:o(void 0,v):o(void 0,S)}function g(v,S,R){return R in t?o(v,S):R in e?o(void 0,v):void 0}const E={url:u,method:u,data:u,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,withXSRFToken:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:g,headers:(v,S,R)=>c(i3(v),i3(S),0,!0)};return et.forEach(Object.keys(Object.assign({},e,t)),function(v){const S=E[v]||c,R=S(e[v],t[v],v);et.isUndefined(R)&&S!==g||(r[v]=R)}),r}var s3=e=>{const t=Pg({},e);let r,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:f,headers:g,auth:E}=t;if(t.headers=g=cd.from(g),t.url=SF(n3(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),E&&g.set("Authorization","Basic "+btoa((E.username||"")+":"+(E.password?unescape(encodeURIComponent(E.password)):""))),et.isFormData(o)){if(to.hasStandardBrowserEnv||to.hasStandardBrowserWebWorkerEnv)g.setContentType(void 0);else if((r=g.getContentType())!==!1){const[v,...S]=r?r.split(";").map(R=>aa(R).call(R)).filter(Boolean):[];g.setContentType([v||"multipart/form-data",...S].join("; "))}}if(to.hasStandardBrowserEnv&&(c&&et.isFunction(c)&&(c=c(t)),c||c!==!1&&jte(t.url))){const v=u&&f&&Ute.read(f);v&&g.set(u,v)}return t},Vte=typeof XMLHttpRequest<"u"&&function(e){return new tt(function(t,r){const o=s3(e);let c=o.data;const u=cd.from(o.headers).normalize();let f,g,E,v,S,{responseType:R,onUploadProgress:I,onDownloadProgress:D}=o;function V(){v&&v(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(f),o.signal&&o.signal.removeEventListener("abort",f)}let M=new XMLHttpRequest;function j(){if(!M)return;const Y=cd.from("getAllResponseHeaders"in M&&M.getAllResponseHeaders());ZB(function(le){t(le),V()},function(le){r(le),V()},{data:R&&R!=="text"&&R!=="json"?M.response:M.responseText,status:M.status,statusText:M.statusText,headers:Y,config:e,request:M}),M=null}M.open(o.method.toUpperCase(),o.url,!0),M.timeout=o.timeout,"onloadend"in M?M.onloadend=j:M.onreadystatechange=function(){M&&M.readyState===4&&(M.status!==0||M.responseURL&&M.responseURL.indexOf("file:")===0)&&setTimeout(j)},M.onabort=function(){M&&(r(new Jn("Request aborted",Jn.ECONNABORTED,e,M)),M=null)},M.onerror=function(){r(new Jn("Network Error",Jn.ERR_NETWORK,e,M)),M=null},M.ontimeout=function(){let Y=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const le=o.transitional||bF;o.timeoutErrorMessage&&(Y=o.timeoutErrorMessage),r(new Jn(Y,le.clarifyTimeoutError?Jn.ETIMEDOUT:Jn.ECONNABORTED,e,M)),M=null},c===void 0&&u.setContentType(null),"setRequestHeader"in M&&et.forEach(u.toJSON(),function(Y,le){M.setRequestHeader(le,Y)}),et.isUndefined(o.withCredentials)||(M.withCredentials=!!o.withCredentials),R&&R!=="json"&&(M.responseType=o.responseType),D&&([E,S]=gA(D,!0),M.addEventListener("progress",E)),I&&M.upload&&([g,v]=gA(I),M.upload.addEventListener("progress",g),M.upload.addEventListener("loadend",v)),(o.cancelToken||o.signal)&&(f=Y=>{M&&(r(!Y||Y.type?new ky(null,e,M):Y),M.abort(),M=null)},o.cancelToken&&o.cancelToken.subscribe(f),o.signal&&(o.signal.aborted?f():o.signal.addEventListener("abort",f)));const W=function(Y){const le=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Y);return le&&le[1]||""}(o.url);W&&to.protocols.indexOf(W)===-1?r(new Jn("Unsupported protocol "+W+":",Jn.ERR_BAD_REQUEST,e)):M.send(c||null)})},Fte=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let o,c=new AbortController;const u=function(v){if(!o){o=!0,g();const S=v instanceof Error?v:this.reason;c.abort(S instanceof Jn?S:new ky(S instanceof Error?S.message:S))}};let f=t&&setTimeout(()=>{f=null,u(new Jn("timeout ".concat(t," of ms exceeded"),Jn.ETIMEDOUT))},t);const g=()=>{e&&(f&&clearTimeout(f),f=null,e.forEach(v=>{v.unsubscribe?v.unsubscribe(u):v.removeEventListener("abort",u)}),e=null)};e.forEach(v=>v.addEventListener("abort",u));const{signal:E}=c;return E.unsubscribe=()=>et.asap(g),E}},ek=l(vg),a3=Ny.f("asyncIterator"),Bte=l(a3);function tk(e,t){this.v=e,this.k=t}function Ac(e){return function(){return new wb(e.apply(this,arguments))}}function wb(e){var t,r;function o(u,f){try{var g=e[u](f),E=g.value,v=E instanceof tk;ek.resolve(v?E.v:E).then(function(S){if(v){var R=u==="return"?"return":"next";if(!E.k||S.done)return o(R,S);S=e[R](S).value}c(g.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(u,f){switch(u){case"return":t.resolve({value:f,done:!0});break;case"throw":t.reject(f);break;default:t.resolve({value:f,done:!1})}(t=t.next)?o(t.key,t.arg):r=null}this._invoke=function(u,f){return new ek(function(g,E){var v={key:u,arg:f,resolve:g,reject:E,next:null};r?r=r.next=v:(t=r=v,o(u,f))})},typeof e.return!="function"&&(this.return=void 0)}function In(e){return new tk(e,0)}function _A(e){var t={},r=!1;function o(c,u){return r=!0,u=new ek(function(f){f(e[c](u))}),{done:!1,value:new tk(u,1)}}return t[Py!==void 0&&kB||"@@iterator"]=function(){return this},t.next=function(c){return r?(r=!1,c):o("next",c)},typeof e.throw=="function"&&(t.throw=function(c){if(r)throw r=!1,c;return o("throw",c)}),typeof e.return=="function"&&(t.return=function(c){return r?(r=!1,c):o("return",c)}),t}wb.prototype[typeof Py=="function"&&Bte||"@@asyncIterator"]=function(){return this},wb.prototype.next=function(e){return this._invoke("next",e)},wb.prototype.throw=function(e){return this._invoke("throw",e)},wb.prototype.return=function(e){return this._invoke("return",e)};var nk=l(a3);function rk(e){var t,r,o,c=2;for(typeof Symbol<"u"&&(r=nk,o=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(o&&(t=e[o])!=null)return new EA(t.call(e));r="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function EA(e){function t(r){if(Object(r)!==r)return tt.reject(new TypeError(r+" is not an object."));var o=r.done;return tt.resolve(r.value).then(function(c){return{value:c,done:o}})}return EA=function(r){this.s=r,this.n=r.next},EA.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var o=this.s.return;return o===void 0?tt.resolve({value:r,done:!0}):t(o.apply(this.s,arguments))},throw:function(r){var o=this.s.return;return o===void 0?tt.reject(r):t(o.apply(this.s,arguments))}},new EA(e)}const Hte=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let o,c=0;for(;c<r;)o=c+t,yield e.slice(c,o),c=o},Gte=function(){var e=Ac(function*(t,r){var o,c=!1,u=!1;try{for(var f,g=rk(Wte(t));c=!(f=yield In(g.next())).done;c=!1){const E=f.value;yield*_A(rk(Hte(E,r)))}}catch(E){u=!0,o=E}finally{try{c&&g.return!=null&&(yield In(g.return()))}finally{if(u)throw o}}});return function(t,r){return e.apply(this,arguments)}}(),Wte=function(){var e=Ac(function*(t){if(t[nk])return void(yield*_A(rk(t)));const r=t.getReader();try{for(;;){const{done:o,value:c}=yield In(r.read());if(o)break;yield c}}finally{yield In(r.cancel())}});return function(t){return e.apply(this,arguments)}}(),o3=(e,t,r,o)=>{const c=Gte(e,t);let u,f=0,g=E=>{u||(u=!0,o&&o(E))};return new ReadableStream({async pull(E){try{const{done:v,value:S}=await c.next();if(v)return g(),void E.close();let R=S.byteLength;if(r){let I=f+=R;r(I)}E.enqueue(new Uint8Array(S))}catch(v){throw g(v),v}},cancel:E=>(g(E),c.return())},{highWaterMark:2})};function c3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function l3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?c3(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c3(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const yA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",d3=yA&&typeof ReadableStream=="function",zte=yA&&(typeof TextEncoder=="function"?(u3=new TextEncoder,e=>u3.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var u3;const h3=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];return!!e(...r)}catch{return!1}},Yte=d3&&h3(()=>{let e=!1;const t=new Request(to.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),ik=d3&&h3(()=>et.isReadableStream(new Response("").body)),vA={stream:ik&&(e=>e.body)};var p3;yA&&(p3=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!vA[e]&&(vA[e]=et.isFunction(p3[e])?t=>t[e]():(t,r)=>{throw new Jn("Response type '".concat(e,"' is not supported"),Jn.ERR_NOT_SUPPORT,r)})}));const qte=async(e,t)=>{const r=et.toFiniteNumber(e.getContentLength());return r??(async o=>o==null?0:et.isBlob(o)?o.size:et.isSpecCompliantForm(o)?(await new Request(to.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:et.isArrayBufferView(o)||et.isArrayBuffer(o)?o.byteLength:(et.isURLSearchParams(o)&&(o+=""),et.isString(o)?(await zte(o)).byteLength:void 0))(t)};var Kte=yA&&(async e=>{let{url:t,method:r,data:o,signal:c,cancelToken:u,timeout:f,onDownloadProgress:g,onUploadProgress:E,responseType:v,headers:S,withCredentials:R="same-origin",fetchOptions:I}=s3(e);v=v?(v+"").toLowerCase():"text";let D,V=Fte([c,u&&u.toAbortSignal()],f);const M=V&&V.unsubscribe&&(()=>{V.unsubscribe()});let j;try{if(E&&Yte&&r!=="get"&&r!=="head"&&(j=await qte(S,o))!==0){let Ee,me=new Request(t,{method:"POST",body:o,duplex:"half"});if(et.isFormData(o)&&(Ee=me.headers.get("content-type"))&&S.setContentType(Ee),me.body){const[Ae,Pe]=e3(j,gA(t3(E)));o=o3(me.body,65536,Ae,Pe)}}et.isString(R)||(R=R?"include":"omit");const W="credentials"in Request.prototype;D=new Request(t,l3(l3({},I),{},{signal:V,method:r.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:W?R:void 0}));let Y=await fetch(D);const le=ik&&(v==="stream"||v==="response");if(ik&&(g||le&&M)){const Ee={};["status","statusText","headers"].forEach($e=>{Ee[$e]=Y[$e]});const me=et.toFiniteNumber(Y.headers.get("content-length")),[Ae,Pe]=g&&e3(me,gA(t3(g),!0))||[];Y=new Response(o3(Y.body,65536,Ae,()=>{Pe&&Pe(),M&&M()}),Ee)}v=v||"text";let ye=await vA[et.findKey(vA,v)||"text"](Y,e);return!le&&M&&M(),await new tt((Ee,me)=>{ZB(Ee,me,{data:ye,headers:cd.from(Y.headers),status:Y.status,statusText:Y.statusText,config:e,request:D})})}catch(W){throw M&&M(),W&&W.name==="TypeError"&&/Load failed|fetch/i.test(W.message)?Object.assign(new Jn("Network Error",Jn.ERR_NETWORK,e,D),{cause:W.cause||W}):Jn.from(W,W&&W.code,e,D)}});const sk={http:null,xhr:Vte,fetch:Kte};et.forEach(sk,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const f3=e=>"- ".concat(e),Xte=e=>et.isFunction(e)||e===null||e===!1;var m3={getAdapter:e=>{e=et.isArray(e)?e:[e];const{length:t}=e;let r,o;const c={};for(let u=0;u<t;u++){let f;if(r=e[u],o=r,!Xte(r)&&(o=sk[(f=String(r)).toLowerCase()],o===void 0))throw new Jn("Unknown adapter '".concat(f,"'"));if(o)break;c[f||"#"+u]=o}if(!o){const u=Object.entries(c).map(f=>{let[g,E]=f;return"adapter ".concat(g," ")+(E===!1?"is not supported by the environment":"is not available in the build")});throw new Jn("There is no suitable adapter to dispatch the request "+(t?u.length>1?`since :
`+u.map(f3).join(`
`):" "+f3(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:sk};function ak(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ky(null,e)}function g3(e){return ak(e),e.headers=cd.from(e.headers),e.data=ZP.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),m3.getAdapter(e.adapter||$P.adapter)(e).then(function(t){return ak(e),t.data=ZP.call(e,e.transformResponse,t),t.headers=cd.from(t.headers),t},function(t){return JB(t)||(ak(e),t&&t.response&&(t.response.data=ZP.call(e,e.transformResponse,t.response),t.response.headers=cd.from(t.response.headers))),tt.reject(t)})}const _3="1.9.0",SA={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{SA[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const E3={};SA.transitional=function(e,t,r){function o(c,u){return"[Axios v"+_3+"] Transitional option '"+c+"'"+u+(r?". "+r:"")}return(c,u,f)=>{if(e===!1)throw new Jn(o(u," has been removed"+(t?" in "+t:"")),Jn.ERR_DEPRECATED);return t&&!E3[u]&&(E3[u]=!0,console.warn(o(u," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(c,u,f)}},SA.spelling=function(e){return(t,r)=>(console.warn("".concat(r," is likely a misspelling of ").concat(e)),!0)};var TA={assertOptions:function(e,t,r){if(typeof e!="object")throw new Jn("options must be an object",Jn.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let c=o.length;for(;c-- >0;){const u=o[c],f=t[u];if(f){const g=e[u],E=g===void 0||f(g,u,e);if(E!==!0)throw new Jn("option "+u+" must be "+E,Jn.ERR_BAD_OPTION_VALUE)}else if(r!==!0)throw new Jn("Unknown option "+u,Jn.ERR_BAD_OPTION)}},validators:SA};const du=TA.validators;let bA=class{constructor(e){this.defaults=e||{},this.interceptors={request:new TF,response:new TF}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{r.stack?c&&!String(r.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+c):r.stack=c}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Pg(this.defaults,t);const{transitional:r,paramsSerializer:o,headers:c}=t;r!==void 0&&TA.assertOptions(r,{silentJSONParsing:du.transitional(du.boolean),forcedJSONParsing:du.transitional(du.boolean),clarifyTimeoutError:du.transitional(du.boolean)},!1),o!=null&&(et.isFunction(o)?t.paramsSerializer={serialize:o}:TA.assertOptions(o,{encode:du.function,serialize:du.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),TA.assertOptions(t,{baseUrl:du.spelling("baseURL"),withXsrfToken:du.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let u=c&&et.merge(c.common,c[t.method]);c&&et.forEach(["delete","get","head","post","put","patch","common"],D=>{delete c[D]}),t.headers=cd.concat(u,c);const f=[];let g=!0;this.interceptors.request.forEach(function(D){typeof D.runWhen=="function"&&D.runWhen(t)===!1||(g=g&&D.synchronous,f.unshift(D.fulfilled,D.rejected))});const E=[];let v;this.interceptors.response.forEach(function(D){E.push(D.fulfilled,D.rejected)});let S,R=0;if(!g){const D=[g3.bind(this),void 0];for(D.unshift.apply(D,f),D.push.apply(D,E),S=D.length,v=tt.resolve(t);R<S;)v=v.then(D[R++],D[R++]);return v}S=f.length;let I=t;for(R=0;R<S;){const D=f[R++],V=f[R++];try{I=D(I)}catch(M){V.call(this,M);break}}try{v=g3.call(this,I)}catch(D){return tt.reject(D)}for(R=0,S=E.length;R<S;)v=v.then(E[R++],E[R++]);return v}getUri(e){return SF(n3((e=Pg(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};et.forEach(["delete","get","head","options"],function(e){bA.prototype[e]=function(t,r){return this.request(Pg(r||{},{method:e,url:t,data:(r||{}).data}))}}),et.forEach(["post","put","patch"],function(e){function t(r){return function(o,c,u){return this.request(Pg(u||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}bA.prototype[e]=t(),bA.prototype[e+"Form"]=t(!0)});var wA=bA;class ok{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new tt(function(c){r=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const f=new tt(g=>{o.subscribe(g),u=g}).then(c);return f.cancel=function(){o.unsubscribe(u)},f},t(function(c,u,f){o.reason||(o.reason=new ky(c,u,f),r(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=o=>{t.abort(o)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new ok(function(o){t=o}),cancel:t}}}var Qte=ok;const ck={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ck).forEach(e=>{let[t,r]=e;ck[r]=t});var $te=ck;const $s=function e(t){const r=new wA(t),o=iF(wA.prototype.request,r);return et.extend(o,wA.prototype,r,{allOwnKeys:!0}),et.extend(o,r,null,{allOwnKeys:!0}),o.create=function(c){return e(Pg(t,c))},o}($P);$s.Axios=wA,$s.CanceledError=ky,$s.CancelToken=Qte,$s.isCancel=JB,$s.VERSION=_3,$s.toFormData=rA,$s.AxiosError=Jn,$s.Cancel=$s.CanceledError,$s.all=function(e){return tt.all(e)},$s.spread=function(e){return function(t){return e.apply(null,t)}},$s.isAxiosError=function(e){return et.isObject(e)&&e.isAxiosError===!0},$s.mergeConfig=Pg,$s.AxiosHeaders=cd,$s.formToJSON=e=>QB(et.isHTMLForm(e)?new FormData(e):e),$s.getAdapter=m3.getAdapter,$s.HttpStatusCode=$te,$s.default=$s;var ka=$s;const Jte=()=>{};function Rb(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Jte};return e.promise=new tt((t,r)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(o))}}),e}const RA=new Map,CA=new Map,uu=new Map;let Fi=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Mn=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const y3=new IJ;let ld=y3.getResult(),lk=null;function Nn(e){if(!lk){ld=y3.getResult();const t=function(g){if(g.engine.name==="Blink"&&g.browser.name!=="WeChat")return Mn.CHROME;switch(g.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Mn.CHROME;case"Safari":case"Mobile Safari":return Mn.SAFARI;case"Edge":return Mn.EDGE;case"Firefox":return Mn.FIREFOX;case"QQ":case"QQBrowser":return Mn.QQ;case"Opera":return Mn.OPERA;case"WeChat":return Mn.WECHAT;default:return g.browser.name||""}}(ld),r=v3(ld),o=function(g){return g.os.name==="Windows"?g.os.version?g.os.name+" "+g.os.version:g.os.name:g.os.name||""}(ld),c=ld.os.version,u=v3(ld,!1),f=ld.device.type;if(!(t&&r&&o&&c))return{name:t,version:r,os:o,osVersion:c,browserVersion:u,deviceType:f};lk={name:t,version:r,os:o,osVersion:c,browserVersion:u,deviceType:f}}return lk}function v3(e){let t,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function AA(){return Nn().os}function S3(){const e=Nn();return"".concat(e.os," ").concat(e.osVersion)}function IA(){const e=Nn();return!!(ld.engine.name==="WebKit"&&e.os===Fi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Mn.SAFARI||_a()&&e.name!==Mn.SAFARI)}function Uh(){return Nn().name===Mn.CHROME}function _s(){return Nn().name===Mn.SAFARI}function T3(){return Nn().name===Mn.EDGE}function Br(){return Nn().name===Mn.FIREFOX}function _a(){return Nn().os===Fi.IOS}function Cb(e){const t=Nn();return!(t.name!==Mn.CHROME||!t.osVersion)&&Number(t.version)>=e}function b3(e){const t=Nn();return!(t.name!==Mn.CHROME||!t.osVersion)&&Number(t.version)<e}function dk(e,t,r){const o=Nn();return!(o.name!==e||!o.osVersion)&&(r?Number(o.version)>=t&&Number(o.version)<=r:Number(o.version)===t)}function uk(e){const t=Nn();return!(t.name!==Mn.EDGE||!t.osVersion)&&Number(t.version)>=e}function w3(e){const t=Nn();return!(t.name!==Mn.SAFARI||!t.osVersion)&&Number(t.version)>=e}function R3(e,t,r){const o=Nn();if(o.os!==Fi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e}function C3(e,t,r){const o=Nn();if(o.name!==Mn.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return r?t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e:t?Number(c[0])===e&&Number(c[1])<=t||Number(c[0])<e:Number(c[0])<=e}function hk(e){const t=Nn();return!(t.name!==Mn.OPERA||!t.osVersion)&&Number(t.version)>=e}function A3(){const e=Nn();if(e.os!==Fi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Ly(){const e=Nn();if(e.os!==Fi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function pk(){const e=Nn();if(e.os!==Fi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function I3(){const e=Nn();if(e.os!==Fi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function gl(){return _s()&&navigator.maxTouchPoints>0}function N3(){return Nn().name===Mn.WECHAT}function O3(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function fk(){const e=AA();return function(){const{deviceType:t}=Nn();return t==="mobile"||t==="tablet"}()||e===Fi.ANDROID||e===Fi.IOS||e===Fi.HARMONY_OS}function Vh(){const e=Nn();return e.name!==Mn.EDGE&&e.name!==Mn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function NA(){return AA()===Fi.ANDROID}function Ab(){const e=Nn();return NA()&&(e.name===Mn.CHROME||e.name===Mn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Vt(e,t,r){return(t=function(o){var c=function(u,f){if(typeof u!="object"||!u)return u;var g=u[Symbol.toPrimitive];if(g!==void 0){var E=g.call(u,"string");if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function D3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function dt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?D3(Object(r),!0).forEach(function(o){Vt(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D3(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let K=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Ie=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),Vt(this,"code",void 0),Vt(this,"message",void 0),Vt(this,"data",void 0),Vt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Fh(e,t){if(typeof e!="boolean")throw new Ie(K.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Mi(e,t,r){if(!Ze(r).call(r,e))throw new Ie(K.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function Zn(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<r||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new Ie(K.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(r,", ").concat(o,"]. integer only"))}function mk(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Ie(K.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Zn(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Zn(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Zn(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Zn(e.ideal,"".concat(t,".ideal"),1,1/0)}else Zn(e,t,1,1/0)}function os(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Ie(K.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!x3(e,r,o,c))throw new Ie(K.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function Bh(e,t){if(!Array.isArray(e))throw new Ie(K.INVALID_PARAMS,"".concat(t," should be an array"))}function Hr(e){return e==null}function x3(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=r&&e.length>=t&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const f=c.charCodeAt(u);if(f<0||f>255)return!1}return!0}(e))}var Ib=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Ib||{}),gk=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(gk||{});const P3=new class{constructor(){Vt(this,"_clientSize",null),Vt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Vt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Vt(this,"getStyle",e=>window.getComputedStyle(e,null)),Vt(this,"checkCssVisibleProperty",e=>{var t;let r=!0;const o=this.getStyle(e),{display:c,visibility:u,opacity:f,filter:g}=o;return(c==="none"||Ze(t=["hidden","collapse"]).call(t,u)||Number(f)<.1)&&(r=!1),!!r&&(g&&g.split(" ").filter(E=>{var v;const S=E.split("(")[0];return Ze(v=["brightness","blur","opacity"]).call(v,S)}).map(E=>{const[v,S]=E.split(/\(|\)/);return[v,Number(S.match(/^[0-9\.]+/))]}).forEach(E=>{const[v,S]=E;switch(v){case"brightness":(S<.1||S>3)&&(r=!1);break;case"blur":S>3&&(r=!1);break;case"opacity":S<.1&&(r=!1)}}),r)}),Vt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let r=!0,o=!0;const c=f=>t(f);let u=e;for(;u&&o;)c(u)||(r=!1,o=!1),u=u.parentElement,u||(o=!1);return r}),Vt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Vt(this,"getSizeAboutClient",e=>{const{width:t,height:r,left:o,right:c,top:u,bottom:f}=e.getBoundingClientRect(),g=this.getClientWidth(),E=this.getClientHeight();return{width:t,height:r,left:o,right:c,top:u,bottom:f,clientWidth:g,clientHeight:E,clientMin:Math.min(g,E)}}),Vt(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)}),Vt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),Vt(this,"checkCoverForAPoint",(e,t,r)=>{const o=this.elementFromPoint(e,t);return o!==null&&o!==r}),Vt(this,"getPointPositionList",()=>{const{width:e,height:t,left:r,top:o}=this._clientSize,c=e/6,u=t/6,f=[],g=10**6;for(let E=0;E<5;E++)for(let v=0;v<5;v++){const S=(r*g+(E===0?.1:E===4?(c*E*g-1e5)/g:c*E)*g)/g,R=(o*g+(v===0?.1:v===4?(u*v*g-1e5)/g:u*v)*g)/g;f.push({x:S,y:R})}return[...f]}),Vt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),Vt(this,"checkSizeIsVisible",(e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10)),Vt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:r,bottom:o,clientHeight:c,clientWidth:u,clientMin:f}=this._clientSize;let g,E,v,S;if(e<0)g=0;else{if(!(e<u))return!1;g=e}if(t<0)return!1;if(E=t<u?t:u,r<0)v=0;else{if(!(r<c))return!1;v=r}if(o<0)return!1;S=o<c?o:c;const R=E-g,I=S-v;return this.checkSizeIsVisible(R,I,f)}),Vt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Vt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Ib.COVERED);{const t=this.checkActualSize(),r=this.checkSizeOfPartInClient();return t&&!r?this.returnHiddenResult(Ib.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Ib.SIZE)}}return this.returnHiddenResult(Ib.STYLE)}return this.returnHiddenResult(gk.UNMOUNTED)}return this.returnHiddenResult(gk.INVALID_HTML_ELEMENT)}),Vt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function _k(e){return new TextEncoder().encode(e)}const k3=function(e,t){const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},Ek=async e=>function(t,r){let o="";return new Uint8Array(t).forEach(c=>{o+=c.toString(r).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",_k(e)),16);let xr=class{constructor(){Vt(this,"_events",{}),Vt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const r=this._events[e],o=this._indexOfListener(r,t);o!==-1&&r.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(u=>u);for(var r=arguments.length,o=new Array(r>1?r-1:0),c=1;c<r;c++)o[c-1]=arguments[c];for(let u=0;u<t.length;u+=1){const f=t[u];f.once&&this.off(e,f.listener),f.listener.apply(this,o||[])}}safeEmit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,r)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,t){let r=e.length;for(;r--;)if(e[r].listener===t)return r;return-1}},Nb=null;function L3(){if(Nb)return Nb;if(window.electron)return Nb=window.electron;if(!window.require)return null;try{return Nb=window.require("electron"),Nb}catch{return null}}let fi=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Gr=function(e){return e.TRACER="tracer",e}({});function M3(e){return Zn(e.timeout,"config.timeout",0,1e5),Zn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Zn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Zn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Zte=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Vn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Ob(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function j3(e){return os(e.turnServerURL,"turnServerURL"),os(e.username,"username"),os(e.password,"password"),e.udpport&&Zn(e.udpport,"udpport",1,99999,!0),e.forceturn&&Fh(e.forceturn,"forceturn"),e.security&&Fh(e.security,"security"),e.tcpport&&Zn(e.tcpport,"tcpport",1,99999,!0),!0}function yk(e){return e.level!==void 0&&Mi(e.level,"level",[1,2,3]),e.delay!==void 0&&Zn(e.delay,"delay",0,3e3,!0),!0}let gn=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Es=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Do=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),My=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function ys(e,t){for(var r=arguments.length,o=new Array(r>2?r-2:0),c=2;c<r;c++)o[c-2]=arguments[c];return e.getListeners(t).length===0?tt.reject(new Ie(K.UNEXPECTED_ERROR,"can not emit promise")):new tt((u,f)=>{e.emit(t,...o,u,f)})}function ir(e,t){if(e.getListeners(t).length===0)return tt.resolve();for(var r=arguments.length,o=new Array(r>2?r-2:0),c=2;c<r;c++)o[c-2]=arguments[c];return ys(e,t,...o)}function Jo(e,t){if(e.getListeners(t).length===0)return null;for(var r=arguments.length,o=new Array(r>2?r-2:0),c=2;c<r;c++)o[c-2]=arguments[c];return Db(e,t,...o)}function Db(e,t){let r=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),f=2;f<c;f++)u[f-2]=arguments[f];if(e.emit(t,...u,g=>{r=g},g=>{o=g}),o!==null)throw o;if(r===null)throw new Ie(K.UNEXPECTED_ERROR,"handler is not sync");return r}const mi=new class extends xr{set networkState(e){this.emit(My.NETWORK_STATE_CHANGE,e,this._networkState),e===Do.ONLINE?this.emit(My.ONLINE):e===Do.OFFLINE&&(this.onlineWaiter=new tt(t=>{this.once(My.ONLINE,()=>{this.onlineWaiter=void 0,t(Do.ONLINE)})}),this.emit(My.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Do.ONLINE}constructor(){super(),Vt(this,"_moduleName","network-indicator"),Vt(this,"_networkState",Do.ONLINE),Vt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Do.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Do.OFFLINE})}};function OA(e,t){const r=e.indexOf(t);r!==-1&&e.splice(r,1)}function jy(e){const t=[];return e.forEach(r=>{t.indexOf(r)===-1&&t.push(r)}),t}function DA(e){tt!==void 0?tt.resolve().then(e):setTimeout(e,0)}function Pr(e){return JSON.parse(JSON.stringify(e))}function kg(e){try{return Pr(e)}catch{return e}}const U3={};function vf(e,t){U3[t]||(U3[t]=!0,e())}function Lg(e){const t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let o=0;o<t.length;o+=1)r[o]=t.charCodeAt(o);return r}function Sf(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function V3(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=new TextEncoder().encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){const o=new Uint8Array(t);o.set(r),r=o}return r}function F3(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const o=Qa(t).call(t,(f,g)=>f+g.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return t.forEach(f=>{c.set(f,u),u+=f.length}),c}function hu(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function B3(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(r=>{t+=typeof r=="string"?hu(r):r.size}),t+138}function ene(e){const t=new Ie(K.TIMEOUT,"timeout");return new tt((r,o)=>{window.setTimeout(()=>o(t),e)})}function cs(e){return new tt(t=>{window.setTimeout(t,e)})}function dr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+dr(e-r.length,"")}function Mg(){return dr(32,"").toUpperCase()}const xA=()=>{},H3=new class{constructor(){Vt(this,"fnMap",new Map)}throttleByKey(e,t,r,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),f=4;f<c;f++)u[f-4]=arguments[f];if(this.fnMap.has(t)){const g=this.fnMap.get(t);if(g.threshold!==r){g.fn(...g.args),clearTimeout(g.timer);const E=window.setTimeout(()=>{const v=this.fnMap.get(t);v&&v.fn(...v.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:E,args:u,skipFn:o})}else g.skipFn&&g.skipFn(...g.args),this.fnMap.set(t,dt(dt({},g),{},{fn:e,args:u,skipFn:o}))}else{const g=window.setTimeout(()=>{const E=this.fnMap.get(t);E&&E.fn(...E.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:g,args:u,skipFn:o})}}},G3=H3.throttleByKey.bind(H3);function W3(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function vk(e,t){if(!W3(e)||!W3(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const r=[...e];for(let o=0;o<t.length;o++)r[o]=vk(e[o],t[o]);return r}{const r=dt({},e);for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(Object.prototype.hasOwnProperty.call(e,o)?r[o]=vk(e[o],t[o]):r[o]=t[o]);return r}}function z3(e,t){let r=[0];if(r=new Array(t).fill(0),e===0)return r;let o=0;for(;e>0&&(r[o]=255&e,e>>=8,o++,o!==t););return r}function Sk(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function Tk(e){return Qa(e).call(e,(t,r)=>t+r,0)}function Y3(e){const t="0123456789abcdef";function r(le){let ye,Ee="";for(ye=0;ye<=3;ye++)Ee+=t.charAt(le>>8*ye+4&15)+t.charAt(le>>8*ye&15);return Ee}function o(le,ye){const Ee=(65535&le)+(65535&ye);return(le>>16)+(ye>>16)+(Ee>>16)<<16|65535&Ee}function c(le,ye,Ee,me,Ae,Pe){return o(function($e,at){return $e<<at|$e>>>32-at}(o(o(ye,le),o(me,Pe)),Ae),Ee)}function u(le,ye,Ee,me,Ae,Pe,$e){return c(ye&Ee|~ye&me,le,ye,Ae,Pe,$e)}function f(le,ye,Ee,me,Ae,Pe,$e){return c(ye&me|Ee&~me,le,ye,Ae,Pe,$e)}function g(le,ye,Ee,me,Ae,Pe,$e){return c(ye^Ee^me,le,ye,Ae,Pe,$e)}function E(le,ye,Ee,me,Ae,Pe,$e){return c(Ee^(ye|~me),le,ye,Ae,Pe,$e)}const v=function(le){let ye;const Ee=1+(le.length+8>>6),me=new Array(16*Ee);for(ye=0;ye<16*Ee;ye++)me[ye]=0;for(ye=0;ye<le.length;ye++)me[ye>>2]|=le.charCodeAt(ye)<<ye%4*8;return me[ye>>2]|=128<<ye%4*8,me[16*Ee-2]=8*le.length,me}(e);let S,R,I,D,V,M=1732584193,j=-271733879,W=-1732584194,Y=271733878;for(S=0;S<v.length;S+=16)R=M,I=j,D=W,V=Y,M=u(M,j,W,Y,v[S+0],7,-680876936),Y=u(Y,M,j,W,v[S+1],12,-389564586),W=u(W,Y,M,j,v[S+2],17,606105819),j=u(j,W,Y,M,v[S+3],22,-1044525330),M=u(M,j,W,Y,v[S+4],7,-176418897),Y=u(Y,M,j,W,v[S+5],12,1200080426),W=u(W,Y,M,j,v[S+6],17,-1473231341),j=u(j,W,Y,M,v[S+7],22,-45705983),M=u(M,j,W,Y,v[S+8],7,1770035416),Y=u(Y,M,j,W,v[S+9],12,-1958414417),W=u(W,Y,M,j,v[S+10],17,-42063),j=u(j,W,Y,M,v[S+11],22,-1990404162),M=u(M,j,W,Y,v[S+12],7,1804603682),Y=u(Y,M,j,W,v[S+13],12,-40341101),W=u(W,Y,M,j,v[S+14],17,-1502002290),j=u(j,W,Y,M,v[S+15],22,1236535329),M=f(M,j,W,Y,v[S+1],5,-165796510),Y=f(Y,M,j,W,v[S+6],9,-1069501632),W=f(W,Y,M,j,v[S+11],14,643717713),j=f(j,W,Y,M,v[S+0],20,-373897302),M=f(M,j,W,Y,v[S+5],5,-701558691),Y=f(Y,M,j,W,v[S+10],9,38016083),W=f(W,Y,M,j,v[S+15],14,-660478335),j=f(j,W,Y,M,v[S+4],20,-405537848),M=f(M,j,W,Y,v[S+9],5,568446438),Y=f(Y,M,j,W,v[S+14],9,-1019803690),W=f(W,Y,M,j,v[S+3],14,-187363961),j=f(j,W,Y,M,v[S+8],20,1163531501),M=f(M,j,W,Y,v[S+13],5,-1444681467),Y=f(Y,M,j,W,v[S+2],9,-51403784),W=f(W,Y,M,j,v[S+7],14,1735328473),j=f(j,W,Y,M,v[S+12],20,-1926607734),M=g(M,j,W,Y,v[S+5],4,-378558),Y=g(Y,M,j,W,v[S+8],11,-2022574463),W=g(W,Y,M,j,v[S+11],16,1839030562),j=g(j,W,Y,M,v[S+14],23,-35309556),M=g(M,j,W,Y,v[S+1],4,-1530992060),Y=g(Y,M,j,W,v[S+4],11,1272893353),W=g(W,Y,M,j,v[S+7],16,-155497632),j=g(j,W,Y,M,v[S+10],23,-1094730640),M=g(M,j,W,Y,v[S+13],4,681279174),Y=g(Y,M,j,W,v[S+0],11,-358537222),W=g(W,Y,M,j,v[S+3],16,-722521979),j=g(j,W,Y,M,v[S+6],23,76029189),M=g(M,j,W,Y,v[S+9],4,-640364487),Y=g(Y,M,j,W,v[S+12],11,-421815835),W=g(W,Y,M,j,v[S+15],16,530742520),j=g(j,W,Y,M,v[S+2],23,-995338651),M=E(M,j,W,Y,v[S+0],6,-198630844),Y=E(Y,M,j,W,v[S+7],10,1126891415),W=E(W,Y,M,j,v[S+14],15,-1416354905),j=E(j,W,Y,M,v[S+5],21,-57434055),M=E(M,j,W,Y,v[S+12],6,1700485571),Y=E(Y,M,j,W,v[S+3],10,-1894986606),W=E(W,Y,M,j,v[S+10],15,-1051523),j=E(j,W,Y,M,v[S+1],21,-2054922799),M=E(M,j,W,Y,v[S+8],6,1873313359),Y=E(Y,M,j,W,v[S+15],10,-30611744),W=E(W,Y,M,j,v[S+6],15,-1560198380),j=E(j,W,Y,M,v[S+13],21,1309151649),M=E(M,j,W,Y,v[S+4],6,-145523070),Y=E(Y,M,j,W,v[S+11],10,-1120210379),W=E(W,Y,M,j,v[S+2],15,718787259),j=E(j,W,Y,M,v[S+9],21,-343485551),M=o(M,R),j=o(j,I),W=o(W,D),Y=o(Y,V);return r(M)+r(j)+r(W)+r(Y)}let tne=1,q3=console,Ls=class{static setLogger(e){q3=e}constructor(e,t){Vt(this,"id",void 0),Vt(this,"lockingPromise",tt.resolve()),Vt(this,"locks",0),Vt(this,"name",""),Vt(this,"lockId",void 0),this.lockId=tne++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const r=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");q3.debug("".concat(r," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const r=new tt(c=>{t=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),o}};function Uy(e,t){return function(r,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const f=this[t];if(!f)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const g=await f.lock("From ".concat(e,".").concat(o));try{for(var E=arguments.length,v=new Array(E),S=0;S<E;S++)v[S]=arguments[S];return await u.apply(this,v)}finally{g()}},c}}const Ri={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function bk(e,t){const r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function dd(e,t,r,o){const c=Object.assign({},Ri,o);let u=c.timeout;const f=async()=>{await function(v){return new tt(S=>{window.setTimeout(S,v)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let g=!1;const E=new tt(async(v,S)=>{t=t||(()=>!1),r=r||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(g)return S(new Ie(K.OPERATION_ABORTED));try{const I=await e();if(!t(I,R)||R+1===c.maxRetryCount)return v(I);await f()}catch(I){if(!r(I,R)||R+1===c.maxRetryCount)return S(I);await f()}}});return E.cancel=()=>g=!0,E}let PA,K3=class{constructor(e){Vt(this,"input",[]),Vt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Qa(e=this.input).call(e,(t,r)=>t+r)/this.input.length}},kA=0,wk=0;function Rk(e,t,r,o){return new tt((c,u)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),kA+=hu(t.data)):r&&(t.data.size?kA+=t.data.size:t.data instanceof FormData?kA+=B3(t.data):kA+=hu(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,ka.request(t).then(f=>{typeof f.data=="string"?wk+=hu(f.data):f.data instanceof ArrayBuffer||f.data instanceof Uint8Array?wk+=f.data.byteLength:wk+=hu(JSON.stringify(f.data)),c(f.data)}).catch(f=>{ka.isCancel(f)?u(new Ie(K.OPERATION_ABORTED,"cancel token canceled")):f.code==="ECONNABORTED"?u(new Ie(K.NETWORK_TIMEOUT,f.message)):f.response?u(new Ie(K.NETWORK_RESPONSE_ERROR,f.response.status)):u(new Ie(K.NETWORK_ERROR,f.message))})})}async function nne(e,t){const r=new Blob([t.data],{type:"buffer"});return await Rk(e,dt(dt({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}const X3=()=>window.isSecureContext!==void 0;function _l(e){if(Array.isArray(e))return e.map(r=>r);if(!Q3(e))return e;const t={};for(const r in e){const o=e[r];Q3(o)||Array.isArray(o)?t[r]=_l(o):t[r]=o}return t}function Q3(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let Ck=class{constructor(e){Vt(this,"input",[]),Vt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const pu={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},xb={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:pu,remoteCandidate:pu},updateInterval:0},$3={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},J3={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Z3={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},e4={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let Ak=class{constructor(e,t){Vt(this,"onFirstVideoReceived",void 0),Vt(this,"onFirstVideoDecoded",void 0),Vt(this,"onFirstAudioReceived",void 0),Vt(this,"onFirstVideoDecodedTimeout",void 0),Vt(this,"onFirstAudioDecoded",void 0),Vt(this,"onSelectedLocalCandidateChanged",void 0),Vt(this,"onSelectedRemoteCandidateChanged",void 0),Vt(this,"videoIsReady",!1),Vt(this,"videoIsReady2",{}),Vt(this,"pc",void 0),Vt(this,"options",void 0),Vt(this,"intervalTimer",void 0),Vt(this,"stats",_l(xb)),Vt(this,"isFirstVideoReceived",{}),Vt(this,"isFirstVideoDecoded",{}),Vt(this,"isFirstAudioReceived",{}),Vt(this,"isFirstAudioDecoded",{}),Vt(this,"isFirstVideoDecodedTimeout",{}),Vt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new tt(e=>{e({local:dt({},pu),remote:dt({},pu)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,f=0;for(const g of r)e[g].forEach((E,v)=>{if(!this.lossRateWindowStats[t-1][g][v]||!this.lossRateWindowStats[0][g][v])return;const S=this.lossRateWindowStats[t-1][g][v].packets-this.lossRateWindowStats[0][g][v].packets,R=this.lossRateWindowStats[t-1][g][v].packetsLost-this.lossRateWindowStats[0][g][v].packetsLost;g==="videoSend"||g==="audioSend"?(o+=S,u+=R):(c+=S,f+=R),Number.isNaN(S)||Number.isNaN(S)?E.packetLostRate=0:E.packetLostRate=S<=0||R<=0?0:R/(S+R)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||f<=0?0:f/(c+f)}},rne=class extends Ak{constructor(){super(...arguments),Vt(this,"_stats",xb),Vt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=_l(xb);const r=t.filter(c=>c.type==="ssrc");this.processSSRCStats(r);const o=t.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var r;const o=Ze(r=t.id).call(r,"send");switch("".concat(t.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=_l(J3);c.codec=t.googCodecName,c.adaptionChangeReason="none",t.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(t.googAvgEncodeMs),c.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.firsCount=Number(t.googFirReceived),c.nacksCount=Number(t.googNacksReceived),c.plisCount=Number(t.googPlisReceived),c.frameCount=Number(t.framesEncoded),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=_l($3),u=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(c.codec=t.googCodecName,c.targetDelayMs=Number(t.googTargetDelayMs),c.renderDelayMs=Number(t.googRenderDelayMs),c.currentDelayMs=Number(t.googCurrentDelayMs),c.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),c.decodeMs=Number(t.googDecodeMs),c.maxDecodeMs=Number(t.googMaxDecodeMs),c.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},c.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},c.decodeFrameRate=Number(t.googFrameRateDecoded),c.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},c.jitterBufferMs=Number(t.googJitterBufferMs),c.firsCount=Number(t.googFirsSent),c.nacksCount=Number(t.googNacksSent),c.plisCount=Number(t.googPlisSent),c.framesDecodeCount=Number(t.framesDecoded),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const f=u.stats,g=Date.now()-u.lts;c.framesDecodeFreezeTime=f.framesDecodeFreezeTime,c.framesDecodeInterval=f.framesDecodeInterval,c.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=g,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:dt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=_l(e4);c.codec=t.googCodecName,c.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,c.decodingCNG=Number(t.googDecodingCNG),c.decodingCTN=Number(t.googDecodingCTN),c.decodingCTSG=Number(t.googDecodingCTSG),c.decodingNormal=Number(t.googDecodingNormal),c.decodingPLC=Number(t.googDecodingPLC),c.decodingPLCCNG=Number(t.googDecodingPLCCNG),c.expandRate=Number(t.googExpandRate),c.accelerateRate=Number(t.googAccelerateRate),c.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),c.speechExpandRate=Number(t.googSpeechExpandRate),c.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),c.jitterBufferMs=Number(t.googJitterBufferMs),c.jitterMs=Number(t.googJitterReceived),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),c.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=_l(Z3);c.codec=t.googCodecName,c.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,c.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new tt((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(r=>{const o={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(c=>{o[c]=r.stat(c)}),t.push(o)}),t}},Pb=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),LA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),Ik=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Zo=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Vy=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Vy||{});function kb(e,t,r,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Vy.kNone;if(!t)return;const u=Number(t[r]);if(typeof u!="number")return;const f=Number(t[o]);if(typeof f!="number")return;if(!e)return f?u/f*c:void 0;const g=Number(e[r]);if(typeof g!="number")return;const E=Number(e[o]);if(typeof E!="number")return;const v=f-E;return v?(u-g)/v*c:void 0}let t4=class extends Ak{constructor(){super(...arguments),Vt(this,"_stats",xb),Vt(this,"report",void 0),Vt(this,"lastDecodeVideoReceiverStats",new Map),Vt(this,"lastVideoFramesRecv",new Map),Vt(this,"lastVideoFramesSent",new Map),Vt(this,"lastVideoFramesDecode",new Map),Vt(this,"lastVideoFramesOutput",new Map),Vt(this,"lastVideoJBDelay",new Map),Vt(this,"lastAudioJBDelay",new Map),Vt(this,"mediaBytesSent",new Map),Vt(this,"mediaBytesRetransmit",new Map),Vt(this,"mediaBytesTargetEncode",new Map),Vt(this,"lastDecodeAudioReceiverStats",new Map),Vt(this,"lastAudioConcealment",new Map),Vt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=_l(xb),this.report.forEach(e=>{switch(e.type){case Zo.OUTBOUND:case Zo.INBOUND:{const t=e.mediaType||e.kind,r=!t&&"frameWidth"in e,o=!t&&!("frameWidth"in e);e.type===Zo.OUTBOUND?t==="audio"||o?this.processAudioOutboundStats(e):(t==="video"||r)&&this.processVideoOutboundStats(e):e.type===Zo.INBOUND&&(t==="audio"||o?this.processAudioInboundStats(e):(t==="video"||r)&&this.processVideoInboundStats(e));break}case Zo.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Zo.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:dt({},pu),remote:dt({},pu)};return e.forEach(r=>{let o;if(r.type===Zo.TRANSPORT&&(o=e.get(r.selectedCandidatePairId)),r.type===Zo.CANDIDATE_PAIR&&r.selected&&(o=r),o){const c=(u,f)=>{u.type=f.type,u.id=f.id,f.address&&(u.address=f.address),f.candidateType&&(u.candidateType=f.candidateType),f.port&&(u.port=f.port),f.priority&&(u.priority=f.priority),f.protocol&&(u.protocol=f.protocol),f.relayProtocol&&(u.relayProtocol=f.relayProtocol)};if(o.localCandidateId){const u=e.get(o.localCandidateId);u&&c(t.local,u)}if(o.remoteCandidateId){const u=e.get(o.remoteCandidateId);u&&c(t.remote,u)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Zo.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Zo.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Zo.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(dt({},t),dt({},this.stats.selectedCandidatePair.localCandidate)),e.type===Zo.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(dt({},t),dt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);t||(t=_l(e4),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const r=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=kb(r,t,"totalProcessingDelay","jitterBufferEmittedCount",Vy.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,r,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,dt({},t))}calculateAudioFreeze(e,t,r){const o=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&o!=null){const c=o.lts,u=r.timestamp,f=u-c;if(f<=0)return;const g=e.concealedSamples-t.concealedSamples-0,E=o.nonSilent+g,v=e.totalSamplesReceived-t.totalSamplesReceived;if(v<=0)return;const S=80*v/f,R=200*v/f,I=f/v;let D=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,E>S&&(o.plc80>0?(e.freezeSamples80+=g,e.freezeMs80+=Math.round(g*I)):(e.freezeSamples80+=E,e.freezeMs80+=Math.round(E*I)),D=o.plc80+1);let V=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,E>R&&(o.plc200>0?(e.freezeSamples200+=g,e.freezeMs200+=Math.round(g*I)):(e.freezeSamples200+=E,e.freezeMs200+=Math.round(E*I)),V=o.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:g,lts:u,plc80:D,plc200:V})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:r.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(f=>f.ssrc===e.ssrc);t||(t=_l($3),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const r=this.lastDecodeVideoReceiverStats.get(t.ssrc),o=this.lastVideoFramesDecode.get(t.ssrc),c=this.lastVideoFramesOutput.get(t.ssrc),u=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const f=t.decodedFrame?t.decodedFrame.width:0,g=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,f,g),this.isFirstVideoDecoded[t.ssrc]=!0}if(r){const f=r.stats,g=u-r.lts;t.framesDecodeFreezeTime=f.framesDecodeFreezeTime,t.framesDecodeInterval=f.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&g>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=g,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<f.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=kb(r==null?void 0:r.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=kb(r==null?void 0:r.stats,t,"totalProcessingDelay","framesDecodeCount",Vy.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=kb(r==null?void 0:r.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",Vy.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=kb(r==null?void 0:r.stats,t,"totalInterFrameDelay","framesDecodeCount",Vy.kMillisecondsFromSeconds),o&&u-o.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:u,rate:t.decodeFrameRate})):o?t.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:u,rate:0}),t.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:u,rate:Math.max(t.outputFrameRate,0)})):c?t.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:dt({},t),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);t||(t=_l(J3),this._stats.videoSend.push(t));const r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{const o=new Ck(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const c=new Ck(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const c=new Ck(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;t.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const o=this.findRemoteStatsId(e.ssrc,Zo.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(r=>r.ssrc===e.ssrc);if(t||(t=_l(Z3),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,Zo.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}findRemoteStatsId(e,t){var r;const o=Array.from(Pa(r=this.report).call(r)).find(c=>c.type===t&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,t){const r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(t.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,t){const r=this.report.get(e);r&&(t.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,t,r){var o,c,u,f;const g=t?this.report.get(t):void 0,E=(o=g==null?void 0:g.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof E!="number")return;let v=(c=g==null?void 0:g.frameWidth)!==null&&c!==void 0?c:e.frameWidth,S=(u=g==null?void 0:g.frameHeight)!==null&&u!==void 0?u:e.frameHeight,R=(f=g==null?void 0:g.framesPerSecond)!==null&&f!==void 0?f:e.framesPerSecond;if(typeof v=="number"&&typeof S=="number"||(v=0,S=0),R==null){const I=Date.now(),D=this.lastVideoFramesSent.get(r.ssrc);D&&I-D.lts>=800?(R=Math.round((E-D.count)/((I-D.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:E,lts:I,rate:R})):D?R=D.rate:this.lastVideoFramesSent.set(r.ssrc,{count:E,lts:I,rate:0})}r.sentFrame={width:v,height:S,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(e,t,r){var o,c,u,f,g;const E=t?this.report.get(t):void 0,v=(o=E==null?void 0:E.framesReceived)!==null&&o!==void 0?o:e.framesReceived,S=(c=E==null?void 0:E.frameWidth)!==null&&c!==void 0?c:e.frameWidth,R=(u=E==null?void 0:E.frameHeight)!==null&&u!==void 0?u:e.frameHeight,I=(f=E==null?void 0:E.jitterBufferDelay)!==null&&f!==void 0?f:e.jitterBufferDelay,D=(g=E==null?void 0:E.jitterBufferEmittedCount)!==null&&g!==void 0?g:e.jitterBufferEmittedCount;if(typeof v=="number"){const V=this.lastVideoFramesRecv.get(r.ssrc),M=Date.now();r.framesReceivedCount=v;let j=0;V&&M-V.lts>=800?(j=Math.round((v-V.count)/((M-V.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:v,lts:M,rate:j})):V?j=V.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:v,lts:M,rate:0}),r.receivedFrame={width:S||0,height:R||0,frameRate:j||0},r.decodedFrame={width:S||0,height:R||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:S||0,height:R||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(I&&D){const V=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let M=V.jitterBufferMs;const j=D-V.jitterBufferEmittedCount;j>0&&(M=1e3*(I-V.jitterBufferDelay)/j),r.jitterBufferMs=M,r.currentDelayMs=Math.round(M),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:D,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,t,r){var o,c,u,f;const g=t?this.report.get(t):void 0,E=(o=(c=g==null?void 0:g.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,v=(u=(f=g==null?void 0:g.echoReturnLossEnhancement)!==null&&f!==void 0?f:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;r.aecReturnLoss=E,r.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(e,t,r){var o,c,u,f,g,E,v,S,R;const I=t?this.report.get(t):void 0,D=(o=I==null?void 0:I.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,V=(c=I==null?void 0:I.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,M=(u=I==null?void 0:I.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,j=(f=I==null?void 0:I.jitterBufferEmittedCount)!==null&&f!==void 0?f:e.jitterBufferEmittedCount,W=(g=I==null?void 0:I.audioLevel)!==null&&g!==void 0?g:e==null?void 0:e.audioLevel,Y=(E=I==null?void 0:I.totalSamplesDuration)!==null&&E!==void 0?E:e==null?void 0:e.totalSamplesDuration,le=(v=I==null?void 0:I.concealedSamples)!==null&&v!==void 0?v:e.concealedSamples,ye=(S=I==null?void 0:I.silentConcealedSamples)!==null&&S!==void 0?S:e.silentConcealedSamples,Ee=(R=I==null?void 0:I.concealmentEvents)!==null&&R!==void 0?R:e.concealmentEvents;if(typeof V=="number"&&(r.totalSamplesReceived=V),typeof ye=="number"&&(r.silentConcealedSamples=ye),typeof Ee=="number"&&(r.concealmentEvents=Ee),typeof le=="number"&&(r.concealedSamples=le),D&&V&&(r.accelerateRate=D/V),M&&j){const Ae=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Pe=Ae.jitterBufferMs;const $e=j-Ae.jitterBufferEmittedCount;$e>0&&(Pe=1e3*(M-Ae.jitterBufferDelay)/$e),r.jitterBufferMs=Math.round(Pe),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:M,jitterBufferEmittedCount:j,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=W;let me=1920;Y&&V&&(me=V/Y/50,r.receivedFrames=Math.round(V/me)),le&&(r.droppedFrames=Math.round(le/me))}processRemoteInboundStats(e,t){const r=this.report.get(e);r&&(t.packetsLost=r.packetsLost,r.roundTripTime&&(t.rttMs=1e3*r.roundTripTime),r.jitter&&(t.jitterMs=1e3*r.jitter),r.timestamp&&(t.timestamp=r.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const r=t.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,t=null,r=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{t=t===null?c.diffMean():t+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()});const o=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}},ine=class extends Ak{updateStats(){return tt.resolve()}};function Nk(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const f=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return f&&f[0]?Number(f[0].split("/")[1]):null}();return u?u<76?new rne(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new t4(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(f){if(!window.RTCStatsReport)return!1;const g=f.getStats();return!!(g instanceof tt||function(E){return!!E&&(typeof E=="object"||typeof E=="function")&&typeof E.then=="function"}(g))}(e)?new t4(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new ine(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const n4="websdk_ng_install_id";function Ok(){try{if(te("INSTALL_ID"))return te("INSTALL_ID");let e=window.localStorage.getItem(n4);return e||(e=Mg(),window.localStorage.setItem(n4,e)),Kn("INSTALL_ID",e),e}catch{return}}const Ic=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const r=t[1],o=t[2];return"".concat(r,".").concat(o)}return"4.0.0.999"}("4.23.3"),Dk=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let jg=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const vs=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const o=r.join(""),c=[];for(let g=0;g<6;g++)c.push("1");const u=c.join(""),f={};return f[e]=o,f[t]=u,Object.assign(f,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=vs;const MA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},xk={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Pk="v4.23.3-0-g83bb9b5a-dirty(4/29/2025, 5:16:52 PM)",kk={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1},Tr=dt(dt(dt(dt({},kk),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:xk,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},MA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:void 0,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function Kn(e,t,r){var o,c,u;Ze(o=Object.keys(Tr)).call(o,e)&&(!r&&Ze(c=Object.keys(ud)).call(c,e)||(Tr[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||t!==!0||(Tr.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(Tr.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&t&&(u=!!t,Tr.USE_NEW_NETWORK_CONFIG=u,u&&(Tr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Tr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Tr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Tr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Tr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Tr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Tr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Tr.ENABLE_INSTANT_VIDEO=!0,Tr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Tr.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Tr.NEW_TURN_MODE||(Tr.NEW_TURN_MODE=4))))}function te(e){return Tr[e]}Dk||(Tr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Tr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Tr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Tr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Tr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Tr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Tr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Tr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Tr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Tr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Tr.AREAS=["NORTH_AMERICA","OVERSEA"]);let r4=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const ud={};var Sn=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Sn||{});let jA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const i4=128,sne=96,s4=1e3,Fy=10;let ane=0;var a4=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>$e,Printer:()=>mr,parse:()=>Ye,print:()=>pt});const f=`
`,g="".concat("\r").concat(f),E=" ";let v;function S(Le){return Le>="0"&&Le<="9"}function R(Le){return Le>="!"&&Le<="~"}function I(Le){return R(Le)||Le>=""&&Le<=""}function D(Le){return Le==="!"||Le>="#"&&Le<="'"||Le>="*"&&Le<="+"||Le>="-"&&Le<="."||Le>="0"&&Le<="9"||Le>="A"&&Le<="Z"||Le>="^"&&Le<="~"}function V(Le){return Le>="1"&&Le<="9"}function M(Le){return Le>="A"&&Le<="Z"||Le>="a"&&Le<="z"}function j(Le){return Le==="d"||Le==="h"||Le==="m"||Le==="s"}function W(Le){return Le>""&&Le<"	"||Le>"\v"&&Le<"\f"||Le>""&&Le<""}function Y(Le){return M(Le)||S(Le)||Le==="+"||Le==="/"}function le(Le){return S(Le)||M(Le)||Le==="+"||Le==="/"||Le==="-"||Le==="_"}function ye(Le){return M(Le)||S(Le)||Le==="+"||Le==="/"}function Ee(Le,L){var ne=Object.keys(Le);if(Object.getOwnPropertySymbols){var he=Object.getOwnPropertySymbols(Le);L&&(he=he.filter(function(ze){return Object.getOwnPropertyDescriptor(Le,ze).enumerable})),ne.push.apply(ne,he)}return ne}function me(Le){for(var L=1;L<arguments.length;L++){var ne=arguments[L]!=null?arguments[L]:{};L%2?Ee(Object(ne),!0).forEach(function(he){Ae(Le,he,ne[he])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Le,Object.getOwnPropertyDescriptors(ne)):Ee(Object(ne)).forEach(function(he){Object.defineProperty(Le,he,Object.getOwnPropertyDescriptor(ne,he))})}return Le}function Ae(Le,L,ne){return L in Le?Object.defineProperty(Le,L,{value:ne,enumerable:!0,configurable:!0,writable:!0}):Le[L]=ne,Le}(function(Le){Le.VERSION="v",Le.ORIGIN="o",Le.SESSION_NAME="s",Le.INFORMATION="i",Le.URI="u",Le.EMAIL="e",Le.PHONE="p",Le.CONNECTION="c",Le.BANDWIDTH="b",Le.TIME="t",Le.REPEAT="r",Le.ZONE_ADJUSTMENTS="z",Le.KEY="k",Le.ATTRIBUTE="a",Le.MEDIA="m"})(v||(v={}));class Pe{consumeText(L,ne){let he=ne;for(;he<L.length;){const ze=L[he];if(ze==="\0"||ze==="\r"||ze===f)break;he+=1}if(he-ne==0)throw new Error("Invalid text, at ".concat(L));return he}consumeUnicastAddress(L,ne,he){return this.consumeTill(L,ne,E)}consumeOneOrMore(L,ne,he){let ze=ne;for(;he(L[ze]);)ze++;if(ze-ne==0)throw new Error("Invalid rule at ".concat(ne,"."));return ze}consumeSpace(L,ne){if(L[ne]===E)return ne+1;throw new Error("Invalid space at ".concat(ne,"."))}consumeIP4Address(L,ne){let he=ne;for(let ze=0;ze<4;ze++)if(he=this.consumeDecimalUChar(L,he),ze!==3){if(L[he]!==".")throw new Error("Invalid IP4 address.");he++}return he}consumeDecimalUChar(L,ne){let he=ne;for(let Wt=0;Wt<3&&S(L[he]);Wt++,he++);if(he-ne==0)throw new Error("Invalid decimal uchar.");const ze=parseInt(L.slice(ne,he));if(ze>=0&&ze<=255)return he;throw new Error("Invalid decimal uchar")}consumeIP6Address(L,ne){let he=this.consumeHexpart(L,ne);return L[he]===":"&&(he+=1,he=this.consumeIP4Address(L,he)),he}consumeHexpart(L,ne){let he=ne;if(L[he]===":"&&L[he+1]===":"){he+=2;try{he=this.consumeHexseq(L,he)}catch{}return he}if(he=this.consumeHexseq(L,he),L[he]===":"&&L[he+1]===":"){he+=2;try{he=this.consumeHexseq(L,he)}catch{}return he}return he}consumeHexseq(L,ne){let he=ne;for(;he=this.consumeHex4(L,he),L[he]===":"&&L[he+1]!==":";)he+=1;return he}consumeHex4(L,ne){let he=0;for(;he<4;he++)if(!((ze=L[ne+he])>="0"&&ze<="9"||ze>="a"&&ze<="f"||ze>="A"&&ze<="F")){if(he===0)throw new Error("Invalid hex 4");break}var ze;return ne+he}consumeFQDN(L,ne){let he=ne;for(;S(L[he])||M(L[he])||L[he]==="-"||L[he]===".";)he+=1;if(he-ne<4)throw new Error("Invalid FQDN");return he}consumeExtnAddr(L,ne){return this.consumeOneOrMore(L,ne,I)}consumeMulticastAddress(L,ne,he){switch(he){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(L,ne);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(L,ne);default:try{return this.consumeFQDN(L,ne)}catch{return this.consumeExtnAddr(L,ne)}}}consumeIP6MulticastAddress(L,ne){const he=this.consumeHexpart(L,ne);return L[he]==="/"?this.consumeInteger(L,he+1):he}consumeIP4MulticastAddress(L,ne){let he=ne+3;const ze=L.slice(ne,he),Wt=parseInt(ze);if(Wt<224||Wt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let ur=0;ur<3;ur++){if(L[he]!==".")throw new Error("Invalid IP4 multicast address.");he+=1,he=this.consumeDecimalUChar(L,he)}return L[he]==="/"&&(he+=1),he=this.consumeTTL(L,he),L[he]==="/"&&(he=this.consumeInteger(L,he)),he}consumeInteger(L,ne){if(!V(L[ne]))throw new Error("Invalid integer.");for(ne+=1;S(L[ne]);)ne+=1;return ne}consumeTTL(L,ne){if(L[ne]==="0")return ne+1;if(!V(L[ne]))throw new Error("Invalid TTL.");ne+=1;for(let he=0;he<2&&S(L[ne]);he++)ne+=1;return ne}consumeToken(L,ne){return this.consumeOneOrMore(L,ne,D)}consumeTime(L,ne){let he=ne;if(L[he]==="0")return he+1;for(V(L[he])&&(he+=1);S(L[he]);)he++;if(he-ne<10)throw new Error("Invalid time");return he}consumeAddress(L,ne){return this.consumeTill(L,ne,E)}consumeTypedTime(L,ne){let he=ne;return he=this.consumeOneOrMore(L,he,S),j(L[he])?he+1:he}consumeRepeatInterval(L,ne){if(!V(L[ne]))throw new Error("Invalid repeat interval");for(ne+=1;S(L[ne]);)ne+=1;return j(L[ne])&&(ne+=1),ne}consumePort(L,ne){return this.consumeOneOrMore(L,ne,S)}consume(L,ne,he){for(let ze=0;ze<he.length;ze++){if(ne+ze>=L.length)throw new Error("consume exceeding value length");if(L[ne+ze]!==he[ze])throw new Error("consume ".concat(he," failed at ").concat(ze))}return ne+he.length}consumeTill(L,ne,he){let ze=ne;for(;ze<L.length&&(typeof he!="string"||L[ze]!==he)&&(typeof he!="function"||!he(L[ze]));)ze++;return ze}}class $e extends Pe{constructor(){super(),Ae(this,"records",[]),Ae(this,"currentLine",0)}parse(L){const ne=this.probeEOL(L);this.records=L.split(ne).filter($h=>!!aa($h).call($h)).map(this.parseLine),this.currentLine=0;const he=this.parseVersion(),ze=this.parseOrigin(),Wt=this.parseSessionName(),ur=this.parseInformation(),Di=this.parseUri(),Lc=this.parseEmail(),Ol=this.parsePhone(),yw=this.parseConnection(),r_=this.parseBandWidth(),yv=this.parseTimeFields(),YI=this.parseKey(),qI=this.parseSessionAttribute(),Mc=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:he,origin:ze,sessionName:Wt,information:ur,uri:Di,emails:Lc,phones:Ol,connection:yw,bandwidths:r_,timeFields:yv,key:YI,attributes:qI,mediaDescriptions:Mc}}getCurrentRecord(){const L=this.records[this.currentLine];if(!L)throw new Error("Record doesn't exit.");return L}probeEOL(L){for(let ne=0;ne<L.length;ne++)if(L[ne]===f)return L[ne-1]==="\r"?g:f;throw new Error("Invalid newline character.")}parseLine(L,ne){if(L.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const he=L[0];if(L[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:he,value:L.slice(2),line:ne,cur:0}}parseSessionAttribute(){const L=new nn;for(;this.currentLine<this.records.length;){const ne=this.getCurrentRecord();if(ne.type!==v.ATTRIBUTE)break;const he={attField:this.extractOneOrMore(ne,ze=>D(ze)&&ze!==":"),_cur:0};ne.value[ne.cur]===":"&&(ne.cur+=1,he.attValue=this.extractOneOrMore(ne,W)),L.parse(he),this.currentLine++}return L.digest()}parseMediaAttributes(L){const ne=new Xt(L);for(;this.currentLine<this.records.length;){const he=this.getCurrentRecord();if(he.type!==v.ATTRIBUTE)break;const ze={attField:this.extractOneOrMore(he,Wt=>D(Wt)&&Wt!==":"),_cur:0};he.value[he.cur]===":"&&(he.cur+=1,ze.attValue=this.extractOneOrMore(he,W)),ne.parse(ze),this.currentLine++}return ne.digest()}parseKey(){const L=this.getCurrentRecord();if(L.type===v.KEY){if(L.value==="prompt"||L.value==="clear:"||L.value==="base64:"||L.value==="uri:")return L.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const L=this.getCurrentRecord();if(L.type===v.ZONE_ADJUSTMENTS){const ne=[];for(;;)try{const he=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);let ze=!1;L.value[L.cur]==="-"&&(ze=!0,L.cur+=1);const Wt=this.extract(L,this.consumeTypedTime);ne.push({time:he,typedTime:Wt,back:ze})}catch{break}if(ne.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ne}return[]}parseRepeat(){const L=[];for(;;){const ne=this.getCurrentRecord();if(ne.type!==v.REPEAT)break;{const he=this.extract(ne,this.consumeRepeatInterval),ze=this.parseTypedTime(ne);L.push({repeatInterval:he,typedTimes:ze}),this.currentLine++}}return L}parseTypedTime(L){const ne=[];for(;;)try{this.consumeSpaceForRecord(L),ne.push(this.extract(L,this.consumeTypedTime))}catch{break}if(ne.length===0)throw new Error("Invalid typed time.");return ne}parseTime(){const L=this.getCurrentRecord(),ne=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);const he=this.extract(L,this.consumeTime);return this.currentLine++,{startTime:ne,stopTime:he}}parseBandWidth(){const L=[];for(;this.currentLine<this.records.length;){const ne=this.getCurrentRecord();if(ne.type!==v.BANDWIDTH)break;{const he=this.extractOneOrMore(ne,D);if(ne.value[ne.cur]!==":")throw new Error("Invalid bandwidth field.");ne.cur++;const ze=this.extractOneOrMore(ne,S);L.push({bwtype:he,bandwidth:ze}),this.currentLine++}}return L}parseVersion(){const L=this.getCurrentRecord();if(L.type!==v.VERSION)throw new Error("first sdp record must be version");const ne=L.value.slice(0,this.consumeOneOrMore(L.value,0,S));if(ne.length!==L.value.length)throw new Error('invalid proto version, "v='.concat(L.value,'"'));return this.currentLine++,ne}parseOrigin(){const L=this.getCurrentRecord();if(L.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const ne=this.extractOneOrMore(L,I);this.consumeSpaceForRecord(L);const he=this.extractOneOrMore(L,S);this.consumeSpaceForRecord(L);const ze=this.extractOneOrMore(L,S);this.consumeSpaceForRecord(L);const Wt=this.extractOneOrMore(L,D);this.consumeSpaceForRecord(L);const ur=this.extractOneOrMore(L,D);this.consumeSpaceForRecord(L);const Di=this.extract(L,this.consumeUnicastAddress);return this.currentLine++,{username:ne,sessId:he,sessVersion:ze,nettype:Wt,addrtype:ur,unicastAddress:Di}}parseSessionName(){const L=this.getCurrentRecord();if(L.type===v.SESSION_NAME){const ne=this.extract(L,this.consumeText);return this.currentLine++,ne}}parseInformation(){const L=this.getCurrentRecord();if(L.type!==v.INFORMATION)return;const ne=this.extract(L,this.consumeText);return this.currentLine++,ne}parseUri(){const L=this.getCurrentRecord();if(L.type===v.URI)return this.currentLine++,L.value}parseEmail(){const L=[];for(;;){const ne=this.getCurrentRecord();if(ne.type!==v.EMAIL)break;L.push(ne.value),this.currentLine++}return L}parsePhone(){const L=[];for(;;){const ne=this.getCurrentRecord();if(ne.type!==v.PHONE)break;L.push(ne.value),this.currentLine++}return L}parseConnection(){const L=this.getCurrentRecord();if(L.type===v.CONNECTION){const ne=this.extractOneOrMore(L,D);this.consumeSpaceForRecord(L);const he=this.extractOneOrMore(L,D);this.consumeSpaceForRecord(L);const ze=this.extract(L,this.consumeAddress);return this.currentLine++,{nettype:ne,addrtype:he,address:ze}}}parseMedia(){const L=this.getCurrentRecord(),ne=this.extract(L,this.consumeToken);this.consumeSpaceForRecord(L);let he=this.extract(L,this.consumePort);L.value[L.cur]==="/"&&(L.cur+=1,he+=this.extract(L,this.consumeInteger)),this.consumeSpaceForRecord(L);const ze=[];for(ze.push(this.extract(L,this.consumeToken));L.value[L.cur]==="/";)L.cur+=1,ze.push(this.extract(L,this.consumeToken));if(ze.length===0)throw new Error("Invalid proto");const Wt=this.parseFmt(L);return this.currentLine++,{mediaType:ne,port:he,protos:ze,fmts:Wt}}parseTimeFields(){const L=[];for(;this.getCurrentRecord().type===v.TIME;){const ne=this.parseTime(),he=this.parseRepeat(),ze=this.parseZone();L.push({time:ne,repeats:he,zones:ze})}return L}parseMediaDescription(){const L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const ne=this.parseMedia(),he=this.parseInformation(),ze=this.parseConnections(),Wt=this.parseBandWidth(),ur=this.parseKey(),Di=this.parseMediaAttributes(ne);L.push({media:ne,information:he,connections:ze,bandwidths:Wt,key:ur,attributes:Di})}return L}parseConnections(){const L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)L.push(this.parseConnection());return L}parseFmt(L){const ne=[];for(;;)try{this.consumeSpaceForRecord(L),ne.push(this.extract(L,this.consumeToken))}catch{break}if(ne.length===0)throw new Error("Invalid fmts");return ne}extract(L,ne){for(var he=arguments.length,ze=new Array(he>2?he-2:0),Wt=2;Wt<he;Wt++)ze[Wt-2]=arguments[Wt];const ur=ne.call(this,L.value,L.cur,...ze),Di=L.value.slice(L.cur,ur);return L.cur=ur,Di}extractOneOrMore(L,ne){const he=this.consumeOneOrMore(L.value,L.cur,ne),ze=L.value.slice(L.cur,he);return L.cur=he,ze}consumeSpaceForRecord(L){if(L.value[L.cur]!==E)throw new Error("Invalid space at ".concat(L.cur,"."));L.cur+=1}}class at extends Pe{constructor(){super(...arguments),Ae(this,"attributes",void 0),Ae(this,"digested",!1)}extractOneOrMore(L,ne,he){const ze=this.consumeOneOrMore(L.attValue,L._cur,ne),Wt=L.attValue.slice(L._cur,ze),[ur,Di]=he||[];if(typeof ur=="number"&&Wt.length<ur)throw new Error("error in length, should be more or equal than ".concat(ur," characters."));if(typeof Di=="number"&&Wt.length>Di)throw new Error("error in length, should be less or equal than ".concat(Di," characters."));return L._cur=ze,Wt}consumeAttributeSpace(L){if(L.attValue[L._cur]!==E)throw new Error("Invalid space at ".concat(L._cur,"."));L._cur+=1}extract(L,ne){if(!L.attValue)throw new Error("Nothing to extract from attValue.");for(var he=arguments.length,ze=new Array(he>2?he-2:0),Wt=2;Wt<he;Wt++)ze[Wt-2]=arguments[Wt];const ur=ne.call(this,L.attValue,L._cur,...ze),Di=L.attValue.slice(L._cur,ur);return L._cur=ur,Di}atEnd(L){if(!L.attValue)throw new Error;return L._cur>=L.attValue.length}peekChar(L){if(!L.attValue)throw new Error;return L.attValue[L._cur]}peek(L,ne){if(!L.attValue)throw new Error;for(let he=0;he<ne.length;he++)if(ne[he]!==L.attValue[L._cur+he])return!1;return!0}parseIceUfrag(L){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(L,Y,[4,256])}parseIcePwd(L){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(L,Y,[22,256])}parseIceOptions(L){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ne=[];for(;!this.atEnd(L);){ne.push(this.extractOneOrMore(L,Y));try{this.consumeAttributeSpace(L)}catch(he){if(this.atEnd(L))break;throw he}}this.attributes.iceOptions=ne}parseFingerprint(L){const ne=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const he=this.extract(L,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ne,fingerprint:he})}parseExtmap(L){const ne=this.extractOneOrMore(L,S);let he;this.peekChar(L)==="/"&&(this.extract(L,this.consume,"/"),he=this.extract(L,this.consumeToken)),this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeTill,E),Wt=me(me({entry:parseInt(ne,10)},he&&{direction:he}),{},{extensionName:ze});this.peekChar(L)===E&&(this.consumeAttributeSpace(L),Wt.extensionAttributes=this.extract(L,this.consumeTill)),this.attributes.extmaps.push(Wt)}parseSetup(L){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ne=this.extract(L,this.consumeTill);if(ne!=="active"&&ne!=="passive"&&ne!=="actpass"&&ne!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ne}}class nn extends at{constructor(){super(...arguments),Ae(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"group":this.parseGroup(L);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"fingerprint":this.parseFingerprint(L);break;case"setup":this.parseSetup(L);break;case"tls-id":this.parseTlsId(L);break;case"identity":this.parseIdentity(L);break;case"extmap":this.parseExtmap(L);break;case"msid-semantic":this.parseMsidSemantic(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(ne){throw console.error("parsing session attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),ne}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(L){const ne=this.extract(L,this.consumeToken),he=[];for(;!this.atEnd(L)&&this.peekChar(L)===E;)this.consumeAttributeSpace(L),he.push(this.extract(L,this.consumeToken));this.attributes.groups.push({semantic:ne,identificationTag:he})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(L){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(L,le)}parseIdentity(L){const ne=this.extractOneOrMore(L,ye),he=[];for(;!this.atEnd(L)&&this.peekChar(L)===E;){this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeToken);this.extract(L,this.consume,"=");const Wt=this.extractOneOrMore(L,ur=>ur!==E&&W(ur));he.push({name:ze,value:Wt})}this.attributes.identities.push({assertionValue:ne,extensions:he})}parseMsidSemantic(L){this.peekChar(L)===E&&this.consumeAttributeSpace(L);const ne={semantic:this.extract(L,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(L)}catch{break}if(this.peekChar(L)==="*"){this.extract(L,this.consume,"*"),ne.applyForAll=!0;break}{const he=this.extract(L,this.consumeTill,E);ne.identifierList.push(he)}}this.attributes.msidSemantic=ne}}class Xt extends at{constructor(L){super(),Ae(this,"attributes",void 0),L.protos.indexOf("RTP")!==-1||L.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"extmap":this.parseExtmap(L);break;case"setup":this.parseSetup(L);break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"candidate":this.parseCandidate(L);break;case"remote-candidate":this.parseRemoteCandidate(L);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(L);break;case"rtpmap":this.parseRtpmap(L);break;case"ptime":this.parsePtime(L);break;case"maxptime":this.parseMaxPtime(L);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(L);break;case"ssrc":this.parseSSRC(L);break;case"fmtp":this.parseFmtp(L);break;case"rtcp-fb":this.parseRtcpFb(L);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(L);break;case"mid":this.parseMid(L);break;case"msid":this.parseMsid(L);break;case"imageattr":this.parseImageAttr(L);break;case"rid":this.parseRid(L);break;case"simulcast":this.parseSimulcast(L);break;case"sctp-port":this.parseSctpPort(L);break;case"max-message-size":this.parseMaxMessageSize(L);break;case"ssrc-group":this.parseSSRCGroup(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(ne){throw console.error("parsing media attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),ne}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}parseCandidate(L){const ne=this.extractOneOrMore(L,Y,[1,32]);this.consumeAttributeSpace(L);const he=this.extractOneOrMore(L,S,[1,5]);this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const Wt=this.extractOneOrMore(L,S,[1,10]);this.consumeAttributeSpace(L);const ur=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);const Di=this.extract(L,this.consumePort);this.consumeAttributeSpace(L),this.extract(L,this.consume,"typ"),this.consumeAttributeSpace(L);const Lc={foundation:ne,componentId:he,transport:ze,priority:Wt,connectionAddress:ur,port:Di,type:this.extract(L,this.consumeToken),extension:{}};for(this.peek(L," raddr")&&(this.extract(L,this.consume," raddr"),this.consumeAttributeSpace(L),Lc.relAddr=this.extract(L,this.consumeAddress)),this.peek(L," rport")&&(this.extract(L,this.consume," rport"),this.consumeAttributeSpace(L),Lc.relPort=this.extract(L,this.consumePort));this.peekChar(L)===E;){this.consumeAttributeSpace(L);const Ol=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L),Lc.extension[Ol]=this.extractOneOrMore(L,R)}this.attributes.candidates.push(Lc)}parseRemoteCandidate(L){const ne=[];for(;;){const he=this.extractOneOrMore(L,S,[1,5]);this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);const Wt=this.extract(L,this.consumePort);ne.push({componentId:he,connectionAddress:ze,port:Wt});try{this.consumeAttributeSpace(L)}catch{break}}this.attributes.remoteCandidatesList.push(ne)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(L){const ne=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const he=this.extract(L,this.consumeTill,"/");this.extract(L,this.consume,"/");const ze={encodingName:he,clockRate:this.extractOneOrMore(L,S)};this.atEnd(L)||this.peekChar(L)!=="/"||(this.extract(L,this.consume,"/"),ze.encodingParameters=parseInt(this.extract(L,this.consumeTill),10));const Wt=this.attributes.payloads.find(ur=>ur.payloadType===parseInt(ne,10));Wt?Wt.rtpMap=ze:this.attributes.payloads.push({payloadType:parseInt(ne,10),rtpMap:ze,rtcpFeedbacks:[]})}parsePtime(L){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(L,this.consumeTill)}parseMaxPtime(L){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(L,this.consumeTill)}parseDirection(L){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=L.attField}parseSSRC(L){const ne=this.extractOneOrMore(L,S);this.consumeAttributeSpace(L);const he=this.extract(L,this.consumeTill,":");let ze;this.peekChar(L)===":"&&(this.extract(L,this.consume,":"),ze=this.extract(L,this.consumeTill));const Wt=this.attributes.ssrcs.find(ur=>ur.ssrcId===parseInt(ne,10));Wt?Wt.attributes[he]=ze:this.attributes.ssrcs.push({ssrcId:parseInt(ne,10),attributes:{[he]:ze}})}parseFmtp(L){const ne=this.extract(L,this.consumeTill,E);this.consumeAttributeSpace(L);const he=this.extract(L,this.consumeTill),ze={};he.split(";").forEach(ur=>{let[Di,Lc]=ur.split("=");Di=aa(Di).call(Di);const Ol=typeof Lc=="string"?aa(Lc).call(Lc):null;typeof Di=="string"&&Di.length>0&&(ze[Di]=Ol)});const Wt=this.attributes.payloads.find(ur=>ur.payloadType===parseInt(ne,10));Wt?Wt.fmtp={parameters:ze}:this.attributes.payloads.push({payloadType:parseInt(ne,10),rtcpFeedbacks:[],fmtp:{parameters:ze}})}parseFmtParameters(L){const ne={},he=this.extract(L,this.consumeTill,"=");L._cur++;const ze=this.extract(L,this.consumeTill,";");for(ne[he]=ze;L.attValue[L._cur]===";";){const Wt=this.extract(L,this.consumeTill,"=");L._cur++;const ur=this.extract(L,this.consumeTill,";");ne[Wt]=ur}return ne}parseRtcpFb(L){let ne="";ne=this.peekChar(L)==="*"?this.extract(L,this.consume,"*"):this.extract(L,this.consumeTill,E),this.consumeAttributeSpace(L);const he=this.extract(L,this.consumeTill,E);let ze;if(he==="trr-int")ze={type:he,interval:this.extract(L,this.consumeTill)};else{const Wt={type:he};this.peekChar(L)===E&&(this.consumeAttributeSpace(L),Wt.parameter=this.extract(L,this.consumeToken),this.peekChar(L)===E&&(Wt.additional=this.extract(L,this.consumeTill))),ze=Wt}if(ne==="*")this.attributes.rtcpFeedbackWildcards.push(ze);else{const Wt=this.attributes.payloads.find(ur=>ur.payloadType===parseInt(ne,10));Wt?Wt.rtcpFeedbacks.push(ze):this.attributes.payloads.push({payloadType:parseInt(ne,10),rtcpFeedbacks:[ze]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(L){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ne={port:this.extract(L,this.consumePort)};this.peekChar(L)===E&&(this.consumeAttributeSpace(L),ne.netType=this.extractOneOrMore(L,D),this.consumeAttributeSpace(L),ne.addressType=this.extractOneOrMore(L,D),this.consumeAttributeSpace(L),ne.address=this.extract(L,this.consumeAddress)),this.attributes.rtcp=ne}parseMsid(L){const ne={id:this.extractOneOrMore(L,D,[1,64])};this.peekChar(L)===E&&(this.consumeAttributeSpace(L),ne.appdata=this.extractOneOrMore(L,D,[1,64])),this.attributes.msids.push(ne)}parseImageAttr(L){this.attributes.imageattr.push(L.attValue)}parseRid(L){const ne=this.extractOneOrMore(L,ze=>M(ze)||S(ze)||ze==="_"||ze==="-");this.consumeAttributeSpace(L);const he={id:ne,direction:this.extract(L,this.consumeToken),params:[]};if(this.peekChar(L)===E){if(this.consumeAttributeSpace(L),this.peek(L,"pt=")){this.extract(L,this.consume,"pt=");const ze=[];for(;;){const Wt=this.extract(L,this.consumeToken);ze.push(Wt);try{this.extract(L,this.consume,",")}catch{break}}he.payloads=ze,this.peekChar(L)===E&&this.extract(L,this.consume,E)}for(;;){const ze=this.extract(L,this.consumeToken);switch(ze){case"depend":{const Wt={type:ze,rids:this.extract(L,this.consume,"=").split(",")};he.params.push(Wt);break}default:{const Wt={type:ze};this.peekChar(L)==="="&&(this.extract(L,this.consume,"="),Wt.val=this.extract(L,this.consumeTill,";")),he.params.push(Wt)}}try{this.extract(L,this.consume,";")}catch{break}}}this.attributes.rids.push(he)}parseSimulcast(L){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=L.attValue,this.extract(L,this.consumeTill)}parseSctpPort(L){this.attributes.sctpPort=this.extractOneOrMore(L,S,[1,5])}parseMaxMessageSize(L){this.attributes.maxMessageSize=this.extractOneOrMore(L,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(L){this.attributes.mid=this.extract(L,this.consumeToken)}parseSSRCGroup(L){const ne=this.extract(L,this.consumeToken),he=[];for(;;)try{this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeInteger);he.push(parseInt(ze,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ne,ssrcIds:he})}}function Lt(Le,L,ne){return L in Le?Object.defineProperty(Le,L,{value:ne,enumerable:!0,configurable:!0,writable:!0}):Le[L]=ne,Le}class mr{constructor(){Lt(this,"eol",g)}print(L,ne){let he="";return ne&&(this.eol=ne),he+=this.printVersion(L.version),he+=this.printOrigin(L.origin),he+=this.printSessionName(L.sessionName),he+=this.printInformation(L.information),he+=this.printUri(L.uri),he+=this.printEmail(L.emails),he+=this.printPhone(L.phones),he+=this.printConnection(L.connection),he+=this.printBandwidth(L.bandwidths),he+=this.printTimeFields(L.timeFields),he+=this.printKey(L.key),he+=this.printSessionAttributes(L.attributes),he+=this.printMediaDescription(L.mediaDescriptions),he}printVersion(L){return"v=".concat(L).concat(this.eol)}printOrigin(L){return"o=".concat(L.username," ").concat(L.sessId," ").concat(L.sessVersion," ").concat(L.nettype," ").concat(L.addrtype," ").concat(L.unicastAddress).concat(this.eol)}printSessionName(L){return L?"s=".concat(L).concat(this.eol):""}printInformation(L){return L?"i=".concat(L).concat(this.eol):""}printUri(L){return L?"u=".concat(L).concat(this.eol):""}printEmail(L){let ne="";for(const he of L)ne+="e=".concat(he).concat(this.eol);return ne}printPhone(L){let ne="";for(const he of L)ne+="e=".concat(he).concat(this.eol);return ne}printConnection(L){return L?"c=".concat(L.nettype," ").concat(L.addrtype," ").concat(L.address).concat(this.eol):""}printBandwidth(L){let ne="";for(const he of L)ne+="b=".concat(he.bwtype,":").concat(he.bandwidth).concat(this.eol);return ne}printTimeFields(L){let ne="";for(const he of L){ne+="t=".concat(he.time.startTime," ").concat(he.time.startTime).concat(this.eol);for(const ze of he.repeats)ne+="r=".concat(ze.repeatInterval," ").concat(ze.typedTimes.join(" ")).concat(this.eol);he.zoneAdjustments&&(ne+="z=",ne+="z=".concat(he.zoneAdjustments.map(ze=>"".concat(ze.time," ").concat(ze.back?"-":""," ").concat(ze.typedTime)).join(" ")).concat(this.eol),ne+=this.eol)}return ne}printKey(L){return L?"k=".concat(L).concat(this.eol):""}printAttributes(L){let ne="";for(const he of L)ne+="a=".concat(he.attField).concat(he.attValue?":".concat(he.attValue):"").concat(this.eol);return ne}printMediaDescription(L){let ne="";for(const he of L)ne+=this.printMedia(he.media),ne+=this.printInformation(he.information),ne+=this.printConnections(he.connections),ne+=this.printBandwidth(he.bandwidths),ne+=this.printKey(he.key),ne+=this.printMediaAttributes(he);return ne}printConnections(L){let ne="";for(const he of L)ne+=this.printConnection(he);return ne}printMedia(L){return"m=".concat(L.mediaType," ").concat(L.port," ").concat(L.protos.join("/")," ").concat(L.fmts.join(" ")).concat(this.eol)}printSessionAttributes(L){return new Va(this.eol).print(L)}printMediaAttributes(L){return new ke(this.eol).print(L)}}class tr{constructor(L){Lt(this,"eol",void 0),this.eol=L}printIceUfrag(L){return L===void 0?"":"a=ice-ufrag:".concat(L).concat(this.eol)}printIcePwd(L){return L===void 0?"":"a=ice-pwd:".concat(L).concat(this.eol)}printIceOptions(L){return L===void 0?"":"a=ice-options:".concat(L.join(E)).concat(this.eol)}printFingerprints(L){return L.length>0?L.map(ne=>"a=fingerprint:".concat(ne.hashFunction).concat(E).concat(ne.fingerprint)).join(this.eol)+this.eol:""}printExtmap(L){return L.map(ne=>"a=extmap:".concat(ne.entry).concat(ne.direction?"/".concat(ne.direction):"").concat(E).concat(ne.extensionName).concat(ne.extensionAttributes?"".concat(E).concat(ne.extensionAttributes):"").concat(this.eol)).join("")}printSetup(L){return L===void 0?"":"a=setup:".concat(L).concat(this.eol)}printUnrecognized(L){return L.map(ne=>"a=".concat(ne.attField).concat(ne.attValue?":".concat(ne.attValue):"").concat(this.eol)).join("")}}class Va extends tr{print(L){let ne="";return ne+=this.printGroups(L.groups),ne+=this.printMsidSemantic(L.msidSemantic),ne+=this.printIceLite(L.iceLite),ne+=this.printIceUfrag(L.iceUfrag),ne+=this.printIcePwd(L.icePwd),ne+=this.printIceOptions(L.iceOptions),ne+=this.printFingerprints(L.fingerprints),ne+=this.printSetup(L.setup),ne+=this.printTlsId(L.tlsId),ne+=this.printIdentity(L.identities),ne+=this.printExtmap(L.extmaps),ne+=this.printUnrecognized(L.unrecognized),ne}printGroups(L){let ne="";return L.length>0&&(ne+=L.map(he=>"a=group:".concat(he.semantic).concat(he.identificationTag.map(ze=>"".concat(E).concat(ze)).join("")).concat(this.eol)).join("")),ne}printIceLite(L){return L===void 0?"":"a=ice-lite"+this.eol}printTlsId(L){return L?"a=tls-id:".concat(L).concat(this.eol):""}printIdentity(L){return L.length===0?"":L.map(ne=>"a=identity:".concat(ne.assertionValue).concat(ne.extensions.map(he=>"".concat(E).concat(he.name).concat(he.value?"=".concat(he.value):"")))).join(this.eol)+this.eol}printMsidSemantic(L){if(!L)return"";let ne="a=msid-semantic:".concat(L.semantic);return L.applyForAll?ne+="".concat(E,"*"):L.identifierList.length>0&&(ne+=L.identifierList.map(he=>"".concat(E).concat(he))),ne+this.eol}}class ke extends tr{print(L){const ne=L.attributes;let he="";return he+=this.printRTCP(ne.rtcp),he+=this.printIceUfrag(ne.iceUfrag),he+=this.printIcePwd(ne.icePwd),he+=this.printIceOptions(ne.iceOptions),he+=this.printCandidates(ne.candidates),he+=this.printRemoteCandidatesList(ne.remoteCandidatesList),he+=this.printEndOfCandidates(ne.endOfCandidates),he+=this.printFingerprints(ne.fingerprints),he+=this.printSetup(ne.setup),he+=this.printMid(ne.mid),he+=this.printExtmap(ne.extmaps),he+=this.printRTPRelated(ne),he+=this.printPtime(ne.ptime),he+=this.printMaxPtime(ne.maxPtime),he+=this.printDirection(ne.direction),he+=this.printSSRCGroups(ne.ssrcGroups),he+=this.printSSRC(ne.ssrcs),he+=this.printRTCPMux(ne.rtcpMux),he+=this.printRTCPMuxOnly(ne.rtcpMuxOnly),he+=this.printRTCPRsize(ne.rtcpRsize),he+=this.printMSId(ne.msids),he+=this.printImageattr(ne.imageattr),he+=this.printRid(ne.rids),he+=this.printSimulcast(ne.simulcast),he+=this.printSCTPPort(ne.sctpPort),he+=this.printMaxMessageSize(ne.maxMessageSize),he+=this.printUnrecognized(ne.unrecognized),he}printCandidates(L){return L.map(ne=>"a=candidate:".concat(ne.foundation).concat(E).concat(ne.componentId).concat(E).concat(ne.transport).concat(E).concat(ne.priority).concat(E).concat(ne.connectionAddress).concat(E).concat(ne.port).concat(E,"typ").concat(E).concat(ne.type).concat(ne.relAddr?"".concat(E,"raddr").concat(E).concat(ne.relAddr):"").concat(ne.relPort?"".concat(E,"rport").concat(E).concat(ne.relPort):"").concat(Object.keys(ne.extension).map(he=>"".concat(E).concat(he).concat(E).concat(ne.extension[he])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(L){return L.map(ne=>"a=remote-candidates:".concat(ne.join(E)).concat(this.eol)).join("")}printEndOfCandidates(L){return L===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(L){if(!L.payloads)return"";const ne=L.payloads;let he="";he+=L.rtcpFeedbackWildcards.map(ze=>this.printRTCPFeedback("*",ze)).join("");for(const ze of ne)he+=this.printRtpMap(ze.payloadType,ze.rtpMap),he+=this.printFmtp(ze.payloadType,ze.fmtp),he+=ze.rtcpFeedbacks.map(Wt=>this.printRTCPFeedback(ze.payloadType,Wt)).join("");return he}printFmtp(L,ne){if(!ne)return"";const he=Object.keys(ne.parameters);return he.length===1&&ne.parameters[he[0]]===null?"a=fmtp:".concat(L).concat(E).concat(he[0]).concat(this.eol):"a=fmtp:".concat(L).concat(E).concat(Object.keys(ne.parameters).map(ze=>"".concat(ze,"=").concat(ne.parameters[ze])).join(";")).concat(this.eol)}printRtpMap(L,ne){return ne?"a=rtpmap:".concat(L).concat(E).concat(ne.encodingName,"/").concat(ne.clockRate).concat(ne.encodingParameters?"/".concat(ne.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(L,ne){let he="a=rtcp-fb:".concat(L).concat(E),ze=ne;return ze.type==="trr-int"?he+="ttr-int".concat(E).concat(ze.interval):(he+="".concat(ze.type),ze.parameter&&(he+="".concat(E).concat(ze.parameter),ze.additional&&(he+="".concat(E).concat(ze.additional)))),he+this.eol}printPtime(L){return L===void 0?"":"a=ptime:".concat(L).concat(this.eol)}printMaxPtime(L){return L===void 0?"":"a=maxptime:".concat(L).concat(this.eol)}printDirection(L){return L===void 0?"":"a=".concat(L).concat(this.eol)}printSSRC(L){return L.map(ne=>Object.keys(ne.attributes).map(he=>"a=ssrc:".concat(ne.ssrcId.toString(10)).concat(E).concat(he).concat(ne.attributes[he]?":".concat(ne.attributes[he]):"").concat(this.eol)).join("")).join("")}printRTCPMux(L){return L===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(L){return L===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(L){return L===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(L){if(L===void 0)return"";let ne="a=rtcp:".concat(L.port);return L.netType&&(ne+="".concat(E).concat(L.netType)),L.addressType&&(ne+="".concat(E).concat(L.addressType)),L.address&&(ne+="".concat(E).concat(L.address)),ne+this.eol}printMSId(L){return L.map(ne=>"a=msid:".concat(ne.id).concat(ne.appdata?"".concat(E).concat(ne.appdata):"").concat(this.eol)).join("")}printImageattr(L){return L.map(ne=>"a=imageattr:".concat(ne).concat(this.eol)).join("")}printRid(L){return L.map(ne=>{let he="a=rid:".concat(ne.id).concat(E).concat(ne.direction);return ne.payloads&&(he+="".concat(E,"pt=").concat(ne.payloads.join(","))),ne.params.length>0&&(he+="".concat(E).concat(ne.params.map(ze=>ze.type==="depend"?"depend=".concat(ze.rids.join(",")):"".concat(ze.type,"=").concat(ze.val)).join(";"))),he+this.eol}).join("")}printSimulcast(L){return L===void 0?"":"a=simulcast:".concat(L).concat(this.eol)}printSCTPPort(L){return L===void 0?"":"a=sctp-port:".concat(L).concat(this.eol)}printMaxMessageSize(L){return L===void 0?"":"a=max-message-size:".concat(L).concat(this.eol)}printMid(L){return L===void 0?"":"a=mid:".concat(L).concat(this.eol)}printSSRCGroups(L){return L.map(ne=>"a=ssrc-group:".concat(ne.semantic).concat(ne.ssrcIds.map(he=>"".concat(E).concat(he.toString(10))).join("")).concat(this.eol)).join("")}}function Ye(Le){return new $e().parse(Le)}function pt(Le,L){return new mr().print(Le,L)}}},t={};function r(o){if(t[o])return t[o].exports;var c=t[o]={exports:{}};return e[o](c,c.exports,r),c.exports}return r.d=(o,c)=>{for(var u in c)r.o(c,u)&&!r.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},r.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),r.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},r(8)})();function no(e){return a4.parse(e)}function Tf(e,t){return a4.print(e,t)}var one=So("Array","keys"),cne=zl,lne=hi,dne=U,une=one,Lk=Array.prototype,hne={DOMTokenList:!0,NodeList:!0},pne=function(e){var t=e.keys;return e===Lk||dne(Lk,e)&&t===Lk.keys||lne(hne,cne(e))?une:t},ec=l(pne);function Wr(e,t,r){return(t=function(o){var c=function(u,f){if(typeof u!="object"||!u)return u;var g=u[Symbol.toPrimitive];if(g!==void 0){var E=g.call(u,"string");if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function en(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?o4(Object(r),!0).forEach(function(o){Wr(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o4(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const c4=new class extends xr{constructor(){super(...arguments),Wr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class fne{constructor(t){Wr(this,"logger",void 0),Wr(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];this.logger.debug(...this.prefixLists,...r)}info(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];this.logger.info(...this.prefixLists,...r)}warning(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];this.logger.warning(...this.prefixLists,...r)}error(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];this.logger.error(...this.prefixLists,...r)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function Mk(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function l4(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Nc={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},UA=Date.now(),Lb=e=>{for(const t in Nc)if(Object.prototype.hasOwnProperty.call(Nc,t)&&Nc[t]===e)return t;return"DEFAULT"},x=new class{constructor(){Wr(this,"proxyServerURL",void 0),Wr(this,"logLevel",Nc.DEBUG),Wr(this,"uploadState","collecting"),Wr(this,"uploadLogWaitingList",[]),Wr(this,"uploadLogUploadingList",[]),Wr(this,"uploadErrorCount",0),Wr(this,"currentLogID",0),Wr(this,"url",void 0),Wr(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const o=[Nc.DEBUG].concat(t);this.log.apply(this,o)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const o=[Nc.INFO].concat(t);this.log.apply(this,o)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const o=[Nc.WARNING].concat(t);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const o=[Nc.ERROR].concat(t);this.log.apply(this,o)}upload(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const o=[Nc.DEBUG].concat(t);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Kn("UPLOAD_LOG",!0)}disableLogUpload(){Kn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new fne(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-UA<100)return void setTimeout(()=>{this.log(...t)},Date.now()-UA);const o=Math.max(0,Math.min(4,t[0]));if(t[0]=Mk()+" Agora-SDK [".concat(Lb(o),"]:"),this.appendLogToWaitingList(o,...t),o<this.logLevel)return;const c=Mk()+" %cAgora-SDK [".concat(Lb(o),"]:");let u=[];if(!te("USE_NEW_LOG"))switch(o){case Nc.DEBUG:u=[c,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,u);break;case Nc.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,u);break;case Nc.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,u);break;case Nc.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-UA<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-UA);const o=Math.max(0,Math.min(4,t[0]));t[0]=Mk()+" Agora-SDK [".concat(Lb(o),"]:"),this.appendLogToWaitingList(o,...t)}appendLogToWaitingList(e){if(!te("UPLOAD_LOG"))return;for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];Array.isArray(r[0])?r[0][0]=l4()+" Agora-SDK [".concat(Lb(e),"]:"):r[0]=l4()+" Agora-SDK [".concat(Lb(e),"]:");let c="";r.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Ic,process_id:te("PROCESS_ID"),payload:JSON.stringify(e)};return dd(async()=>{const r=await ka.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(te("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(te("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(r.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=r,o}},()=>(this.uploadLogUploadingList=[],!1),r=>{const o={status:-1,message:r.message,errorRange:e.map(c=>c.log_item_id)};return r.response?(o.status=r.response.status,o.data=r.response.data,o.headers=r.response.headers):r.request&&(o.status=r.request.status),c4.reportLogUploadError(o),!0},{timeout:te("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:te("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,te("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),te("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),te("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),te("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var d4;function mne(e){return os(e.reportId,"params.reportId",0,100,!1),os(e.category,"params.category",0,100,!1),os(e.event,"params.event",0,100,!1),os(e.label,"params.label",0,100,!1),Zn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(d4={}).FREE="free",d4.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const gne={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Bi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Nr=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let _ne=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Ot(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,r,o){const c=o.value;if(typeof c=="function"){const u=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);o.value=function(){for(var f,g=arguments.length,E=new Array(g),v=0;v<g;v++)E[v]=arguments[v];let S=E;if(e.argsMap)try{S=e.argsMap(this,...E)}catch(I){x.warning(I),S=[]}try{JSON.stringify(S)}catch{x.warning("arguments for method ".concat(u,".").concat(String(r)," not serializable for apiInvoke.")),S=[]}const R=(e.report||St).reportApiInvoke(this._sessionId||null,{id:this._clientId||((f=this.store)===null||f===void 0?void 0:f.clientId)||this._ID,name:"".concat(u,".").concat(String(r)),options:S,tag:Gr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const I=c.apply(this,E);return I instanceof tt?I.then(D=>(R.onSuccess(e.reportResult&&D),D)).catch(D=>{throw R.onError(D),D}):(R.onSuccess(e.reportResult&&I),I)}catch(I){throw R.onError(I),I}}}return o}}const St=new class{constructor(){Wr(this,"baseInfoMap",new Map),Wr(this,"proxyServer",void 0),Wr(this,"eventUploadTimer",void 0),Wr(this,"setSessionIdTimer",void 0),Wr(this,"url",void 0),Wr(this,"sids",new Set),Wr(this,"backupUrl",void 0),Wr(this,"_appId",void 0),Wr(this,"_aid",0),Wr(this,"keyEventUploadPendingItems",[]),Wr(this,"normalEventUploadPendingItems",[]),Wr(this,"apiInvokeUploadPendingItems",[]),Wr(this,"apiInvokeCount",0),Wr(this,"apiInvokeLoggedCount",0),Wr(this,"ltsList",[]),Wr(this,"lastSendNormalEventTime",Date.now()),Wr(this,"customReportCounterTimer",void 0),Wr(this,"customReportCount",0),Wr(this,"extApiInvoke",async e=>{for(const t of e){const r=en(en({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Gr.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),te("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),te("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[r,o]=t;return r+o}),16)||0}reportApiInvoke(e,t,r){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!te("SHOW_REPORT_INVOKER_LOG"),f=!!te("SHOW_REPORT_USER_INVOKER_LOG"),g=u||f&&t.id;g&&(this.apiInvokeLoggedCount+=1);const E=this.apiInvokeLoggedCount;function v(D,V){if(g){let M="[apiInvoke-".concat(E,"]");if(t.id&&(M+="[".concat(t.id,"]")),t.name&&(M+="[".concat(t.name,"]"),t.name===fi.JOIN))return x.info("".concat(M," ").concat(D));x.info("".concat(M," ").concat(D),D==="start"?t.options:V||"")}}const S=()=>({tag:t.tag,invokeId:c,sid:e,name:t.name,apiInvokeTime:o,options:t.options,states:t.states||null});v("start");let R=!1;cs(t.timeout).then(()=>{R||(this.sendApiInvoke(en(en({},S()),{},{error:K.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const I=new Ie(K.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:D=>{const V=()=>{if(R)throw I;return R=!0,this.sendApiInvoke(en(en({},S()),{},{success:!0},t.reportResult&&{result:D})),v("onSuccess"),D};return r?G3(V,t.name+"Success",r,()=>R=!0):V()},onError:D=>{const V=()=>{if(R)throw D;R=!0,this.sendApiInvoke(en(en({},S()),{},{success:!1,error:D})),v("onFailure",D.toString())};return r?G3(V,t.name+"Error",r,()=>R=!0):V()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const r=Date.now(),o=this.createBaseInfo(e,r);o.cname=t.cname;const c=Object.assign({},{willUploadConsoleLog:te("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Dk?"global":"oversea",areas:te("AREAS")&&te("AREAS").join(",")},t.extend),{stringUid:u,channelProfile:f,channelMode:g,isABTestSuccess:E,lsid:v,clientRole:S}=t,R=Date.now(),I=en(en({},o),{},{eventType:Bi.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:Pk,lts:R,elapse:R-r,extend:JSON.stringify(c),mode:t.mode,process:te("PROCESS_ID"),appType:te("APP_TYPE"),success:!0,version:Ic,stringUid:u,channelProfile:f,channelMode:g,isABTestSuccess:E,lsid:v,clientType:Ze(D=window.navigator.userAgent).call(D,"AgoraWebView")?42:20,clientRole:S,serviceId:te("PROCESS_ID"),extensionID:te("PLUGIN_INFO").join(",")||""});var D;this.send({type:Nr.SESSION,data:I},!0)}joinChooseServer(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=en(en({},o),{},{role:t.role,eventType:Bi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:t.elapse||c-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:c-r.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:Nr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=en(en({},o),{},{eventType:Bi.REQ_USER_ACCOUNT,lts:c,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||c-r.startTime,eventElapse:c-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Nr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info;t.vid&&(o.vid=t.vid),o.uid=t.uid,o.cid=t.cid;const c=Date.now(),{firstSuccess:u,addr:f,isProxy:g}=t,E=c-r.startTime,v=en(en({},o),{},{eventType:Bi.JOIN_GATEWAY,lts:c,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:E,eventElapse:c-t.lts,firstSuccess:u,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:Ok(),isABTestSuccess:t.isABTestSuccess?1:0}),S=v.success?1:0;if(t.succ&&(r.lastJoinSuccessTime=c),u)this.send({type:Nr.JOIN_GATEWAY,data:v},!0);else{let R;if(f)if(g){const D=f.match(/h=(\d{1,3}-){3}\d{1,3}/g),V=f.match(/p=[0-9]{1,6}/g);R={isSuccess:S,gatewayIp:D&&D.length?D[0].split("=")[1].replace(/-/g,"."):"",port:V&&V.length?V[0].split("=")[1]:"",isProxy:g?1:0}}else{const D=f.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),V=f.match(/(:|p=)[0-9]{1,6}/g);R={isSuccess:S,gatewayIp:D&&D.length?D[0].split("//")[1].replace(/-/g,"."):"",port:V&&V.length?V[0].split(/:|p=/g)[1]:"",isProxy:g?1:0}}else R={isSuccess:S,gatewayIp:"",port:"",isProxy:g?1:0};delete v.success,delete v.eventType,delete v.firstSuccess,v.vid=Number(v.vid);const I=Object.assign({},v,R,{eventType:Bi.REJOIN_GATEWAY});this.send({type:Nr.RE_JOIN_GATEWAY,data:I},!0)}}joinChannelTimeout(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=Date.now(),c=en(en({},r.info),{},{lts:o,timeout:t,elapse:o-r.startTime});this.send({type:Nr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=en(en({},o),{},{eventType:Bi.PUBLISH,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Nr.PUBLISH,data:u},!0)}subscribe(e,t,r){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,u=Date.now(),f=en(en({},c),{},{eventType:Bi.SUBSCRIBE,lts:u,eventElapse:t.eventElapse,elapse:u-o.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?f.peerSuid=t.peerid:f.peer=t.peerid,this.send({type:Nr.SUBSCRIBE,data:f},!0)}wsCompressorInit(e){var t;const r=[...ec(t=this.baseInfoMap).call(t)],o=r.length?r[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,f=Date.now(),g=en(en({},u),{},{eventType:Bi.WS_COMPRESSOR_INIT,lts:f,eventElapse:e.eventElapse,elapse:f-c.startTime,status:e.status?1:2});this.send({type:Nr.WS_COMPRESSOR_INIT,data:g},!0)}firstRemoteVideoDecode(e,t,r,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,f=Date.now(),g=en(en(en({},u),o),{},{elapse:f-c.startTime,eventType:t,lts:f,firstDecodeFrame:Math.max((o.firstFrame||f)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:r,data:g},!0)}firstRemoteFrame(e,t,r,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,f=Date.now(),g=en(en(en({},u),o),{},{elapse:f-c.startTime,eventType:t,lts:f});this.send({type:r,data:g},!0)}abTest(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=en(en(en({},o),t),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-r.startTime,eventType:Bi.AB_TEST,lts:c});this.send({type:Nr.AB_TEST,data:u},!0)}pcStats(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=en(en(en({},o),t),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-r.startTime,eventType:Bi.PC_STATS,lts:c,preallocation:t.preallocation?1:0});this.send({type:Nr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,t){if(e){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=en(en(en({},o),t),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Bi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Nr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,t,r,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,f=Date.now(),g=en(en(en({},u),o),{},{eventType:t,lts:f});this.send({type:r,data:g},!0)}streamSwitch(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=en(en({},o),{},{eventType:Bi.STREAM_SWITCH,lts:c,isDual:t.isdual,elapse:c-r.startTime,success:t.succ});this.send({type:Nr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=en(en({},o),{},{eventType:Bi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-t.lts,elapse:c-r.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Nr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=en(en({},o),{},{eventType:Bi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-t.lts,elapse:c-r.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Nr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?x.debug("reportProxyServerurl: ".concat(e)):x.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=en(en({},o),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:c,elapse:c-r.startTime,joinChannelSuccessElapse:c-(r.lastJoinSuccessTime||c),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Nr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now();(function(u,f,g){const E=u[f];if(!E||typeof E!="string")return[u];u[f]="";const v=hu(JSON.stringify(u));let S=0;const R=[];let I=0;for(let D=0;D<E.length;D++)I+=E.charCodeAt(D)<=127?1:3,I<=g-v||(R[R.length]=dt(dt({},u),{},{[f]:E.substring(S,D)}),S=D,I=E.charCodeAt(D)<=127?1:3);return S!==E.length-1&&(R[R.length]=dt(dt({},u),{},{[f]:E.substring(S)})),R})(en(en(en({},o),t),{},{elapse:c-r.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Nr.WORKER_EVENT,data:u},!0))}apworkerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=en(en(en({},o),t),{},{elapse:c-r.startTime,lts:c});this.send({type:Nr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=en(en(en({},o),t),{},{elapse:c-r.startTime,lts:c,extend:t.extend||void 0});this.send({type:Nr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,c=Date.now(),u=en(en(en({},o),t),{},{elapse:c-r.startTime,lts:c});this.send({type:Nr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>te("CUSTOM_REPORT_LIMIT"))throw new Ie(K.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const r=Date.now(),o=t.map(c=>({type:Nr.USER_ANALYTICS,data:en(en({sid:e},c),{},{lts:r})}));try{te("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw x.error("send custom report message failed",c.toString()),new Ie(K.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const t=te("NOT_REPORT_EVENT");if(e.tag&&Ze(t)&&Ze(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const r=this.baseInfoMap.get(e.sid);if(!r)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:c,cid:u}=r.info;let f;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Ie){const{code:E,message:v}=e.error;f=E||v||e.error.toString()}else f=e.error.toString();const g={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-r.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?f:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Nr.API_INVOKE,data:g},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(r=>r!==null);t&&e.forEach(r=>{r&&(r.sid=t,this.sendApiInvoke(Object.assign({},r)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>te("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const r=[],o=[];for(;e.length;){const u=e.shift();r.length<20?r.push(u):o.push(u)}e.push(...o);for(const u of[...r]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),Gt(c=this.ltsList).call(c,(f,g)=>f-g))}return t||(this.lastSendNormalEventTime=Date.now()),te("ENABLE_EVENT_REPORT")&&r.length&&(te("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((u=>f=>{te("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>te("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-te("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(r)),e}async postDataToStatsCollector2(e){mi.networkState===Do.OFFLINE&&await tt.race([mi.onlineWaiter,cs(2*Ri.maxRetryTimeout)]);const t=c=>{let u=new Uint8Array;return c.forEach(f=>{const g=_k(JSON.stringify(f.data)),E=new ArrayBuffer(5),v=(R=>{let I=0;return Object.entries(Nr).forEach(D=>{let[V,M]=D;M===R.type&&(I=_ne[V])}),I})(f),S=new DataView(E);S.setUint16(0,g.byteLength,!0),S.setUint8(2,255&v),S.setUint8(3,v>>>8&255),S.setUint8(4,v>>>16&255),u=k3(u,new Uint8Array(E)),u=k3(u,g)}),u},r="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(te("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(te("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(te("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(te("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await Rk(o,{timeout:1e4,data:t(e),headers:en(en({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=(g=>{const E=g&&g.data.sid&&this.baseInfoMap.get(g.data.sid);return E&&E.info.vid&&+E.info.vid||0})(e[0]),o=r?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(g=>JSON.stringify(g)),vid:r,aid:o};mi.networkState===Do.OFFLINE&&await tt.race([mi.onlineWaiter,cs(2*Ri.maxRetryTimeout)]);const u=t?"/events/proto-raws":"/events/messages";let f=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(te("EVENT_REPORT_DOMAIN"),"&p=").concat(te("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(te("EVENT_REPORT_DOMAIN"),":").concat(te("STATS_COLLECTOR_PORT")).concat(u));for(let g=0;g<2;g+=1){g===1&&(f=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(te("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(te("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(te("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(te("STATS_COLLECTOR_PORT")).concat(u)));try{t?await nne(f,{timeout:1e4,data:c}):await Rk(f,{timeout:1e4,data:c})}catch(E){if(g===1)throw E;continue}return}}createBaseInfo(e,t){const r=Object.assign({},gne);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:t}),r}reportResourceTiming(e,t){const r=performance.getEntriesByName(e),o=r[r.length-1];o&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:o,tag:Gr.TRACER}).onSuccess()}};c4.on("REPORT_LOG_UPLOAD",e=>{e.networkState=mi.networkState,St.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Gr.TRACER}).onSuccess("logUploadError")});class Te extends Ie{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Wr(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,x)}throw(){super.throw(x)}}const ls={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function On(){return ls}function u4(){return"setSinkId"in HTMLAudioElement.prototype&&(!te("RESTRICTION_SET_PLAYBACK_DEVICE")||(Uh()||T3())&&!fk())}function h4(){return!ls.supportUnifiedPlan||te("CHROME_FORCE_PLAN_B")&&Vh()}let ds=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function By(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function Dn(e,t,r,o,c){return{width:e,height:t,frameRate:r,bitrateMin:o,bitrateMax:c}}function El(e,t,r,o,c){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:o,bitrateMax:c}}function jk(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const Ene={"90p":Dn(160,90),"90p_1":Dn(160,90),"120p":Dn(160,120,15,30,65),"120p_1":Dn(160,120,15,30,65),"120p_3":Dn(120,120,15,30,50),"120p_4":Dn(212,120),"180p":Dn(320,180,15,30,140),"180p_1":Dn(320,180,15,30,140),"180p_3":Dn(180,180,15,30,100),"180p_4":Dn(240,180,15,30,120),"240p":Dn(320,240,15,40,200),"240p_1":Dn(320,240,15,40,200),"240p_3":Dn(240,240,15,40,140),"240p_4":Dn(424,240,15,40,220),"360p":Dn(640,360,15,80,400),"360p_1":Dn(640,360,15,80,400),"360p_3":Dn(360,360,15,80,260),"360p_4":Dn(640,360,30,80,600),"360p_6":Dn(360,360,30,80,400),"360p_7":Dn(480,360,15,80,320),"360p_8":Dn(480,360,30,80,490),"360p_9":Dn(640,360,15,80,800),"360p_10":Dn(640,360,24,80,800),"360p_11":Dn(640,360,24,80,1e3),"480p":Dn(640,480,15,100,500),"480p_1":Dn(640,480,15,100,500),"480p_2":Dn(640,480,30,100,1e3),"480p_3":Dn(480,480,15,100,400),"480p_4":Dn(640,480,30,100,750),"480p_6":Dn(480,480,30,100,600),"480p_8":Dn(848,480,15,100,610),"480p_9":Dn(848,480,30,100,930),"480p_10":Dn(640,480,10,100,400),"720p":Dn(1280,720,15,120,1130),"720p_auto":Dn(1280,720,30,900,3e3),"720p_1":Dn(1280,720,15,120,1130),"720p_2":Dn(1280,720,30,120,2e3),"720p_3":Dn(1280,720,30,120,1710),"720p_5":Dn(960,720,15,120,910),"720p_6":Dn(960,720,30,120,1380),"1080p":Dn(1920,1080,15,120,2080),"1080p_1":Dn(1920,1080,15,120,2080),"1080p_2":Dn(1920,1080,30,120,3e3),"1080p_3":Dn(1920,1080,30,120,3150),"1080p_5":Dn(1920,1080,60,120,4780),"1440p":Dn(2560,1440,30,120,4850),"1440p_1":Dn(2560,1440,30,120,4850),"1440p_2":Dn(2560,1440,60,120,7350),"4k":Dn(3840,2160,30,120,8910),"4k_1":Dn(3840,2160,30,120,8910),"4k_3":Dn(3840,2160,60,120,13500)},yne={"480p":El(640,480,5),"480p_1":El(640,480,5),"480p_2":El(640,480,30),"480p_3":El(640,480,15),"720p":El(1280,720,5),"720p_auto":Dn(1280,720,30,900,3e3),"720p_1":El(1280,720,5),"720p_2":El(1280,720,30),"720p_3":El(1280,720,15),"1080p":El(1920,1080,5),"1080p_1":El(1920,1080,5),"1080p_2":El(1920,1080,30),"1080p_3":El(1920,1080,15)},vne={"1SL1TL":jk(1,1),"3SL3TL":jk(3,3),"2SL3TL":jk(2,3)};function yl(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Ene[e]):e}function Uk(e){return typeof e=="string"?Object.assign({},yne[e]):e}function VA(e){return typeof e=="string"?Object.assign({},vne[e]):e}const Sne={speech_low_quality:By(16e3,!1),speech_standard:By(32e3,!1,18),music_standard:By(48e3,!1),standard_stereo:By(48e3,!0,56),high_quality:By(48e3,!1,128),high_quality_stereo:By(48e3,!0,192)};function FA(e){return typeof e=="string"?Object.assign({},Sne[e]):e}const Hy=[];function p4(e){return Mi(e,"mediaSource",["screen","window","application"]),!0}let ft=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),er=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Gy=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Tne=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),bne=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),Ug=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Wy=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),zy=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Yy=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),tc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const Vk={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Fk={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},f4={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},wne={uplinkNetworkQuality:0,downlinkNetworkQuality:0},m4={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Ea=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),nc=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Mb=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Vg=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Js=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),fu=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const Bk={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let BA=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function bn(e,t,r,o,c){var u,f,g={};return Object.keys(o).forEach(function(E){g[E]=o[E]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=Qa(u=uE(f=r.slice()).call(f)).call(u,function(E,v){return v(e,t,E)||E},g),c&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(c):void 0,g.initializer=void 0),g.initializer===void 0?(Object.defineProperty(e,t,g),null):g}function Se(e,t,r){return(t=function(o){var c=function(u,f){if(typeof u!="object"||!u)return u;var g=u[Symbol.toPrimitive];if(g!==void 0){var E=g.call(u,"string");if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Or(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?g4(Object(r),!0).forEach(function(o){Se(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g4(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class _4 extends xr{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Ug.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,r){super(),Se(this,"trackMediaType",void 0),Se(this,"_ID",void 0),Se(this,"_rtpTransceiver",void 0),Se(this,"_lowRtpTransceiver",void 0),Se(this,"_hints",[]),Se(this,"_isClosed",!1),Se(this,"_originMediaStreamTrack",void 0),Se(this,"mediaStreamTrack",void 0),Se(this,"_external",{}),this._ID=r||dr(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(o){Ze(Hy).call(Hy,o)||Hy.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||vf(()=>{var r;St.reportApiInvoke(null,{name:fi.GET_MEDIA_STREAM_TRACK,options:[],tag:Gr.TRACER}).onSuccess(((r=this._mediaStreamTrack)===null||r===void 0?void 0:r.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Gy.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const r=Hy.indexOf(t);r!==-1&&Hy.splice(r,1)}(this),this.emit(Wy.CLOSED),this.removeAllListeners(Ug.SEI_RECEIVED)}_updateRtpTransceiver(t,r){if(r===Gy.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Ug.TRANSCEIVER_UPDATED,t,r)}}class qy extends _4{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,r){super(t,r),Se(this,"_enabled",!0),Se(this,"_muted",!1),Se(this,"_isExternalTrack",!1),Se(this,"_isClosed",!1),Se(this,"_enabledMutex",void 0),Se(this,"processor",void 0),Se(this,"_processorContext",void 0),Se(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ls("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,r;return(t=(r=this._originMediaStreamTrack)===null||r===void 0?void 0:r.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(ft.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,r){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ir(this,ft.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Wy.TRACK_ENDED)}stateCheck(t,r){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(r,"]")),Fh(r,t),this._enabled&&this._muted&&t==="enabled"&&r===!1)throw new Ie(K.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&t==="muted"&&r===!0)throw new Ie(K.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():tt.resolve([])}}const E4=window.AudioContext||window.webkitAudioContext;let rc=null;const Xn=new class extends xr{constructor(){super(...arguments),Se(this,"prevState",void 0),Se(this,"curState",void 0),Se(this,"currentTime",void 0),Se(this,"currentTimeStuckAt",void 0),Se(this,"interruptDetectorTrack",void 0),Se(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(ds.IOS_15_16_INTERRUPTION_START)}),Se(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):(rc&&await rc.suspend(),this.emit(ds.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){x.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){x.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Ky(){if(!rc){if(function(){if(!E4)return void x.error("your browser is not support web audio");x.info("create audio context");const e=Or({},te("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(e)),rc=new E4(e),Xn.curState=rc.state,rc.onstatechange=()=>{Xn.prevState=Xn.curState,Xn.curState=rc?rc.state:void 0;const{prevState:t,curState:r}=Xn,o=r==="running",c=r==="interrupted",u=t==="running",f=t==="suspended",g=t==="interrupted",E=Nn().osVersion;(_a()||gl())&&u&&c&&(x.info("ios".concat(E,"-interruption-start")),Xn.emit(ds.IOS_INTERRUPTION_START)),(_a()||gl())&&(f||g)&&o&&(x.info("ios".concat(E,"-interruption-end")),Xn.emit(ds.IOS_INTERRUPTION_END)),t!==r&&Xn.emit(ds.STATE_CHANGE,r,t)},setInterval(()=>{var t;const r=(t=rc)===null||t===void 0?void 0:t.currentTime;Xn.currentTime!==r?(Xn.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(r)),Xn.currentTimeStuckAt=void 0),Xn.currentTime=r):(r!==Xn.currentTimeStuckAt&&(St.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:Gr.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(r))),Xn.currentTimeStuckAt=r)},5e3),async function(t){const r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,f=!1;function g(M){t.state==="running"?E(!1):_a()||gl()?t.state==="suspended"&&(E(!0),M&&t.resume().then(v,v)):t.state!=="closed"&&(E(!0),M&&t.resume().then(v,v))}function E(M){if(c!==M){c=M;for(let j=0,W=r;j<W.length;j+=1){const Y=W[j];M?window.addEventListener(Y,S,{capture:!0,passive:!0}):window.removeEventListener(Y,S,{capture:!0,passive:!0})}}}function v(){g(!1)}function S(){g(!0)}function R(M){if(!f)if(o.paused)if(M){let j;I(!1),f=!0;try{j=o.play(),j?j.then(D,D):(o.addEventListener("playing",D),o.addEventListener("abort",D),o.addEventListener("error",D))}catch{D()}}else I(!0);else I(!1)}function I(M){if(u!==M){u=M;for(let j=0,W=r;j<W.length;j++){const Y=W[j];M?window.addEventListener(Y,V,{capture:!0,passive:!0}):window.removeEventListener(Y,V,{capture:!0,passive:!0})}}}function D(){o.removeEventListener("playing",D),o.removeEventListener("abort",D),o.removeEventListener("error",D),f=!1,R(!1)}function V(){R(!0)}if(_a()){const M=t.createMediaStreamDestination(),j=document.createElement("div");j.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=j.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=M.stream,R(!0)}Xn.on(ds.STATE_CHANGE,function(){g(!0)}),g(!1)}(rc)}(),!rc)throw new Ie(K.NOT_SUPPORTED,"can not create audio context");return rc}return rc}function Fg(e){if(function(){if(Hk!==null)return Hk;const o=Ky(),c=o.createBufferSource(),u=o.createGain(),f=o.createGain();c.connect(u),c.connect(f),c.disconnect(u);let g=!1;try{c.disconnect(u)}catch{g=!0}return c.disconnect(),Hk=g,g}())return;const t=e.connect,r=e.disconnect;e.connect=(o,c,u)=>{var f;return e._inputNodes||(e._inputNodes=[]),Ze(f=e._inputNodes).call(f,o)||(o instanceof AudioNode?(e._inputNodes.push(o),t.call(e,o,c,u)):t.call(e,o,c)),e},e.disconnect=(o,c,u)=>{r.call(e),o?OA(e._inputNodes,o):e._inputNodes=[];for(const f of e._inputNodes)t.call(e,f)}}let Hk=null;function Gk(e,t){let r=!1;const o=1/t;if(te("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{r?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{const c=Ky();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const f=()=>{if(r)return void(u=null);const g=c.createOscillator();g.onended=f,g.connect(u),g.start(0),g.stop(c.currentTime+o),e(c.currentTime)};f()}return()=>{r=!0}}class y4{constructor(){Se(this,"context",void 0),Se(this,"analyserNode",void 0),Se(this,"sourceNode",void 0),this.context=Ky(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||_a()||gl()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<t.length;++c)t[c]=o[c]/128-1}const r=Qa(t).call(t,(o,c)=>o+c*c,0)/t.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,r;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(r=this.sourceNode)===null||r===void 0||r.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class v4 extends xr{get processSourceNode(){return this.sourceNode}set processedNode(t){var r;if(!this.isDestroyed&&this._processedNode!==t){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(r=this._processedNode)===null||r===void 0||r.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Se(this,"outputNode",void 0),Se(this,"outputTrack",void 0),Se(this,"isPlayed",!1),Se(this,"sourceNode",void 0),Se(this,"context",void 0),Se(this,"audioBufferNode",void 0),Se(this,"destNode",void 0),Se(this,"audioOutputLevel",0),Se(this,"volumeLevelAnalyser",void 0),Se(this,"_processedNode",void 0),Se(this,"playNode",void 0),Se(this,"isDestroyed",!1),Se(this,"onNoAudioInput",void 0),Se(this,"isNoAudioInput",!1),Se(this,"_noAudioInputCount",0),this.context=Ky(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Fg(this.outputNode),this.volumeLevelAnalyser=new y4}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(tc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let f=0;f<u.length;f+=1)u[f]=0}return o.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!On().webAudioMediaStreamDest)throw new Ie(K.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&DA(()=>{Xn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;_a()||gl()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const r=this.volumeLevelAnalyser.getAnalyserNode();let o;r.getFloatTimeDomainData?(o=new Float32Array(r.fftSize),r.getFloatTimeDomainData(o)):(o=new Uint8Array(r.fftSize),r.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await cs(200),await this.checkHasAudioInput(t?t+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,r;(t=this.processedNode)===null||t===void 0||t.disconnect(),(r=this.sourceNode)===null||r===void 0||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class S4 extends v4{get isFreeze(){return!1}constructor(t,r,o){var c;if(super(),Se(this,"sourceNode",void 0),Se(this,"track",void 0),Se(this,"clonedTrack",void 0),Se(this,"audioElement",void 0),Se(this,"isCurrentTrackCloned",!1),Se(this,"isRemoteTrack",!1),Se(this,"originVolumeLevelAnalyser",void 0),Se(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const g=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?g.stop():this.isCurrentTrackCloned=!0;const E=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(E),Fg(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),Fg(this.outputNode),this.emit(tc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=E,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new Ie(K.UNEXPECTED_ERROR);this.track=t;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(u),Fg(this.sourceNode),o){const g=o.clone();g.enabled=!0,this.clonedTrack=g,x.debug("create an unmuted track ".concat(g.id," from the original track ").concat(o.id," to get the volume"));const E=this.context.createMediaStreamSource(new MediaStream([g]));Fg(E),this.originVolumeLevelAnalyser=new y4,this.originVolumeLevelAnalyser.updateSource(E)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const f=Nn();r&&f.os===Fi.IOS&&Number((c=f.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Xn.on(ds.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(g=>{g||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const r=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(r),Fg(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(tc.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Xn.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const r=t.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),x.debug("create an unmuted track ".concat(r.id," from the original track ").concat(t.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([r]));Fg(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function T4(e,t,r){const o=(u,f)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||f:u:f,c={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(t.height,1080),maxWidth:o(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(c.video.mandatory.maxFrameRate=t.frameRate.max,c.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(c.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Rne(e,t){const r=await b4(e.mediaSource),{sourceId:o,audio:c}=await function(u){let f=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new tt((g,E)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const I=document.createElement("div");I.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const D=document.createElement("div");D.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const V=document.createElement("button");V.innerHTML="cancel",V.setAttribute("style","width: 85px;"),V.onclick=()=>{document.body.removeChild(W);const Y=new Error("NotAllowedError");Y.name="NotAllowedError",E(Y)};let M=f;const j=document.createElement("div");if(f){const Y=document.createElement("input");Y.setAttribute("type","checkbox");const le=document.createElement("span");Y.setAttribute("style","margin-right: 6px;"),le.innerText="Share audio",Y.checked=M,Y.onchange=()=>{M=Y.checked},j.appendChild(Y),j.appendChild(le)}D.appendChild(j),D.appendChild(V),S.appendChild(R),S.appendChild(I),S.appendChild(D);const W=document.createElement("div");W.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),W.appendChild(v),W.appendChild(S),document.body.appendChild(W),u.map(Y=>{if(Y.id){const le=document.createElement("div");le.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ye=Y.thumbnail;try{const{width:Ee}=ye.getSize();Ee>1920&&(ye=ye.resize({width:1920}))}catch(Ee){throw Ee&&Ee.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Ee}le.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ye.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Y.name.replace(/[\u00A0-\u9999<>\&]/g,function(Ee){return"&#"+Ee.charCodeAt(0)+";"})+"</span>",le.onclick=()=>{document.body.removeChild(W),g({sourceId:Y.id,audio:M})},I.appendChild(le)}})})}(r,t);return await T4(o,e,c)}async function b4(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const r=L3();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new Ie(K.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=r.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{o=null}o&&o.then||(o=new tt((u,f)=>{r.desktopCapturer.getSources({types:t},(g,E)=>{g?f(g):u(E)})}));try{return await o}catch(u){throw new Ie(K.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const Wk=new Ls("safari");let w4=!1,R4=!1;async function ic(e,t){let r=0,o=null;for(;r<2;)try{o=await Cne(e,t,r>0);break}catch(c){if(c instanceof Ie)throw x.error("[".concat(t,"] ").concat(c.toString())),c;const u=HA(c.name||c.code||c,c.message);if(u.code===K.MEDIA_OPTION_INVALID){x.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await cs(500);continue}throw x.error("[".concat(t,"] ").concat(u.toString())),u}if(!o)throw new Ie(K.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Cne(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Ie(K.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=On(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return x.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(L3())e.screen.sourceId?Xy(c,await T4(e.screen.sourceId,e.screen,!!e.screenAudio)):Xy(c,await Rne(e.screen,!!e.screenAudio));else if(Uh()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new Ie(K.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const I=await(f=e.screen.extensionId,g=t,new tt((D,V)=>{try{chrome.runtime.sendMessage(f,{getStream:!0},M=>{if(!M||!M.streamId)return x.error("[".concat(g,"] No response from Chrome Plugin. Plugin not installed properly"),M),void V(new Ie(K.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));D(M.streamId)})}catch(M){x.error("[".concat(g,"] AgoraRTC screensharing plugin is not accessible(").concat(f,")"),M.toString()),V(new Ie(K.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=I,Xy(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&p4(e.screen.mediaSource);const I={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:D,surfaceSwitching:V,systemAudio:M,preferCurrentTab:j}=e.screen,W={selfBrowserSurface:D,surfaceSwitching:V,systemAudio:M,preferCurrentTab:j};!D&&delete W.selfBrowserSurface,!V&&delete W.surfaceSwitching,!M&&delete W.systemAudio,!j&&delete W.preferCurrentTab,x.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:I,audio:e.screenAudio,controls:W})),Xy(c,await navigator.mediaDevices.getDisplayMedia(Or({video:I,audio:e.screenAudio},W)))}else{if(!Br())throw x.error("[".concat(t,"] This browser does not support screenSharing")),new Ie(K.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&p4(e.screen.mediaSource);const I={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};x.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(I))),Xy(c,await navigator.mediaDevices.getUserMedia(I))}}var f,g;if(!e.video&&!e.audio)return c;let E={video:e.video,audio:e.audio},v=te("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),E=vk(E,v)}catch{}x.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(E)),Nn();let S,R=null;(_s()||_a()||IA())&&(R=await Wk.lock());try{S=await navigator.mediaDevices.getUserMedia(E)}catch(I){throw R&&R(),I}return E.audio&&(w4=!0),E.video&&(R4=!0),Xy(c,S),R&&R(),c}function HA(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Ie(K.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Ie(K.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new Ie(K.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new Ie(K.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Ie(K.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new Ie(K.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return x.error("getUserMedia unexpected error",e),new Ie(K.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Xy(e,t){const r=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=t.getVideoTracks()[0],u=t.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(r&&e.removeTrack(r),e.addTrack(c))}const sc=new class extends xr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Vg.STATE_CHANGE,e),this._state=e)}constructor(){super(),Se(this,"_state",Mb.IDLE),Se(this,"isAccessMicrophonePermission",!1),Se(this,"isAccessCameraPermission",!1),Se(this,"lastAccessMicrophonePermission",!1),Se(this,"lastAccessCameraPermission",!1),Se(this,"checkdeviceMatched",!1),Se(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(te("ENUMERATE_DEVICES_INTERVAL")||(NA()||AA()===Fi.HARMONY_OS)&&Vh())&&this.updateDevicesInfo()},te("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>x.error(e.toString()))}async enumerateDevices(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Ie(K.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&e,f=!this.isAccessCameraPermission&&t;c.audio&&(u=!1),c.video&&(f=!1);let g=null,E=null,v=null;if(!r&&(u||f)){if(Wk.isLocked&&(x.debug("[device manager] wait GUM lock"),(await Wk.lock())(),x.debug("[device manager] GUM unlock")),w4&&(u=!1,this.isAccessMicrophonePermission=!0),R4&&(f=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",e,t,u,f),u&&f){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const R=HA(S.name||S.code||S,S.message);if(R.code===K.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{g=await navigator.mediaDevices.getUserMedia({audio:e})}catch(S){const R=HA(S.name||S.code||S,S.message);if(R.code===K.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(f){try{E=await navigator.mediaDevices.getUserMedia({video:t})}catch(S){const R=HA(S.name||S.code||S,S.message);if(R.code===K.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",e,"cam permission",t)}try{const S=await navigator.mediaDevices.enumerateDevices();return g&&g.getTracks().forEach(R=>R.stop()),E&&E.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),g=null,E=null,v=null,S}catch(S){return g&&g.getTracks().forEach(R=>R.stop()),E&&E.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),g=null,E=null,v=null,new Ie(K.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(r=>{r.device.label===e&&(t=r.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(r=>r.deviceId===e);if(!t)throw new Ie(K.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Mb.INITING;try{await this.updateDevicesInfo(),this.state=Mb.INITEND}catch(e){throw x.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Mb.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Ie(K.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(f=>f.kind==="audioinput"&&f.deviceId==="default"),u=e.find(f=>f.kind==="audiooutput"&&f.deviceId==="default");c&&u?u.groupId===c.groupId?x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):x.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const f={initAt:t,updateAt:t,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),f),r.push(f)}u&&(u.updateAt=t)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==t&&(c.state="INACTIVE",r.push(c))}),this.state!==Mb.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Vg.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Vg.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Vg.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(c=>c.kind==="audioinput"),r=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of t)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of r)if(c.label&&c.deviceId){o.video=!0;break}return o}};let zk=!1;const ac=new class extends xr{constructor(){super(...arguments),Se(this,"onAutoplayFailed",void 0),Se(this,"onAudioAutoplayFailed",void 0)}};function C4(){if(Nn(),!zk){const e=t=>{t.preventDefault(),zk=!1,Ab()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};zk=!0,Ab()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ac.onAutoplayFailed?ac.onAutoplayFailed():ac.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ac.emit("autoplay-failed")}}function A4(e,t,r,o){if(!e)return;const c=St.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,f=Date.now(),g=Or(Or({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:f,elapse:f-c.startTime,cbRegistered:ac.onAutoplayFailed||ac.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:o,extend:void 0});St.send({type:Nr.AUTOPLAY_FAILED,data:g},!0)}const Ane=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],La=new class{constructor(){Se(this,"onAutoplayFailed",void 0),Se(this,"elementMap",new Map),Se(this,"elementStateMap",new Map),Se(this,"elementsNeedToResume",[]),Se(this,"sinkIdMap",new Map),Se(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,o]=t;const c=this.elementStateMap.get(r),u=o.srcObject.getAudioTracks()[0],f=u&&u.readyState;if(x.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(f," ").concat(e)),f==="live"){if(e)return o.pause(),void o.play();if(Xn.curState==="running")return Ly()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,r]=e;const o=r.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),Xn.on(ds.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Xn.on(ds.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Xn.on(ds.STATE_CHANGE,()=>{_a()&&Xn.prevState==="suspended"&&Xn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(o){throw new Ie(K.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,t,r,o){if(this.elementMap.has(t))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,c),this.elementMap.set(t,c),this.elementStateMap.set(t,Js.INIT),this.setVolume(t,r);const u=this.sinkIdMap.get(t);if(u)try{c.setSinkId(u).catch(g=>{x.warning("[".concat(t,"] set sink id failed"),g.toString())})}catch(g){x.warning("[".concat(t,"] set sink id failed"),g.toString())}const f=c.play();f&&f.then&&f.catch(g=>{o&&A4(o,"audio",g.message,t),x.warning("audio element play warning",g.toString()),this.elementMap.has(t)&&g.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),DA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),C4()}))})}updateTrack(e,t){const r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Ane.forEach(r=>{t.addEventListener(r,o=>{const c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(x.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const f=t==null?void 0:t.error;f&&x.error("[".concat(e,"] media error, code: ").concat(f.code,", message: ").concat(f.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(r=>{x.debug("Auto resume audio element success")}).catch(r=>{x.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new tt(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Ab()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function ei(){return function(e,t,r){const o=r.value;return typeof o=="function"&&(r.value=function(){this._isClosed&&new Ie(K.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var c=arguments.length,u=new Array(c),f=0;f<c;f++)u[f]=arguments[f];const g=o.apply(this,u);return g instanceof tt?new tt((E,v)=>{g.then(E).catch(v)}):g}),r}}class I4 extends xr{constructor(t){super(),Se(this,"name","VideoProcessorDestination"),Se(this,"ID","0"),Se(this,"_source",void 0),Se(this,"videoContext",void 0),Se(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Ie(K.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Ie(K.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Ea.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Ea.ON_TRACK,void 0)}}class N4 extends xr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r){super(),Se(this,"constraintsMap",new Map),Se(this,"statsRegistry",[]),Se(this,"usageRegistry",[]),Se(this,"trackId",void 0),Se(this,"direction",void 0),Se(this,"_chained",!1),this.trackId=t,this.direction=r}async getConstraints(){return await ys(this,nc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,r){var o;return x.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),ir(this,nc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pa(o=this.constraintsMap).call(o)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return x.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),ir(this,nc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pa(r=this.constraintsMap).call(r)))}registerStats(t,r,o){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:o})}unregisterStats(t,r){const o=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const t=[];for(const{processorID:r,processorName:o,type:c,cb:u}of this.statsRegistry)try{const f=u();t.push({processorID:r,processorName:o,type:c,stats:f})}catch(f){x.error(new Ie(K.UNEXPECTED_ERROR,f.message))}return t}registerUsage(t,r){this.usageRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){const r=this.usageRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let o=r();o instanceof tt&&(o=await o),t.push(Or(Or({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return t}getDirection(){return this.direction}}class O4 extends xr{constructor(t){super(),Se(this,"name","AudioProcessorDestination"),Se(this,"ID","0"),Se(this,"inputTrack",void 0),Se(this,"inputNode",void 0),Se(this,"audioProcessorContext",void 0),Se(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Ie(K.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Ie(K.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Ea.ON_TRACK,void 0),this.emit(Ea.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Ea.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Ea.ON_NODE,this.inputNode))}}class D4 extends xr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r,o){super(),Se(this,"constraintsMap",new Map),Se(this,"statsRegistry",[]),Se(this,"audioContext",void 0),Se(this,"trackId",void 0),Se(this,"direction",void 0),Se(this,"usageRegistry",[]),Se(this,"_chained",!1),this.audioContext=t,this.trackId=r,this.direction=o}async getConstraints(){return ys(this,nc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,r){var o;return x.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),ir(this,nc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pa(o=this.constraintsMap).call(o)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),ir(this,nc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pa(r=this.constraintsMap).call(r)))}registerStats(t,r,o){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:o})}unregisterStats(t,r){const o=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const t=[];for(const{processorID:r,processorName:o,type:c,cb:u}of this.statsRegistry)try{const f=u();t.push({processorID:r,processorName:o,type:c,stats:f})}catch(f){x.error(new Ie(K.UNEXPECTED_ERROR,f.message))}return t}registerUsage(t,r){this.usageRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){const r=this.usageRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let o=r();o instanceof tt&&(o=await o),t.push(Or(Or({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return t}getDirection(){return this.direction}}class Yk extends xr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Se(this,"context",void 0),Se(this,"processSourceNode",void 0),Se(this,"outputTrack",void 0),Se(this,"processedNode",void 0),Se(this,"clonedTrack",void 0),Se(this,"outputNode",void 0),this.outputNode=new Ine}setVolume(){}createOutputTrack(){throw new Ie(K.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Ine{disconnect(){}connect(){}}function x4(e){return new tt((t,r)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=_a()?"canplay":"playing";c.addEventListener(u,()=>{const f=c.videoWidth,g=c.videoHeight;!f&&Br()||(o=!0,c.srcObject=null,c.remove(),t([f,g]))}),c.srcObject=new MediaStream([e]),c.play().catch(xA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),t([c.videoWidth,c.videoHeight]))},4e3)})}function GA(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const r=yl(e.encoderConfig);return r.width!=null&&(t.width=r.width),r.height!=null&&(t.height=r.height),!O3()&&r.frameRate&&(t.frameRate=r.frameRate),T3()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Br()&&(t.frameRate={ideal:30,max:30}),t}function P4(e){const t={};return O3()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Uh()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function k4(e){const t=P4(e);if(e.encoderConfig){const r=FA(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),NA()&&(t.sampleRate=void 0),t}const Nne=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:r,width:o,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=r,width:f=o,height:g=c}=t;if(!u||!f||!g)return;f=Sk(f),g=Sk(g),u=Sk(u);const{max:E,min:v}=function(D,V,M){const j=200*Math.pow(M/15,.6)*Math.pow(D*V/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}}(f,g,u),{bitrateMax:S,bitrateMin:R}=t||{};S||x.debug("calculate bitrate: [w: ".concat(f,", h: ").concat(g,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(R,"]"));const{maxFramerate:I}=te("ENCODER_CONFIG_LIMIT");return I&&typeof I=="number"&&(u=Math.min(u,I)),{frameRate:u,bitrateMax:S||E,bitrateMin:R||v,scaleResolutionDownBy:1,scale:0}},L4=async(e,t,r)=>await(async(o,c,u)=>{const f=function(v){const S=[];for(let R=0;R<v.length;R+=2)S.push(parseInt(v.slice(R,R+2),16));return Uint8Array.from(S)}(Y3(""+c+u)).slice(0,16),g=f.slice(0,12),E=await window.crypto.subtle.importKey("raw",f,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:g},E,o))})(e.buffer,t,r),qk=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new tt((r,o)=>{t.toBlob(async c=>{if(t.remove(),c){const u=await M4(c);r({buffer:u,width:t.width,height:t.height})}else o(new Ie(K.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},M4=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var j4,U4,V4,F4,B4,H4,G4,W4,z4,Y4,q4,K4,X4,Q4,$4,J4,Z4,e5,kr,t5,n5,r5,i5,s5,a5,mu,o5,c5,l5,d5,u5,h5,p5,f5,m5,g5,_5,E5,y5,Ss;let Xr=(j4=Ot({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),U4=Ot({argsMap:(e,t)=>[e.getTrackId(),t]}),V4=ei(),F4=Uy("LocalAudioTrack","_enabledMutex"),B4=Ot({argsMap:(e,t)=>[e.getTrackId(),t]}),H4=ei(),G4=Uy("LocalAudioTrack","_enabledMutex"),W4=Ot({argsMap:(e,t)=>[e.getTrackId(),t]}),z4=ei(),Y4=ei(),q4=ei(),K4=Ot({argsMap:e=>[e.getTrackId()]}),X4=ei(),Q4=Ot({argsMap:e=>[e.getTrackId()]}),$4=ei(),J4=Ot({argsMap:e=>[e.getTrackId()]}),Z4=Ot({argsMap:(e,t)=>[e.getTrackId(),t.name]}),e5=Ot({argsMap:e=>[e.getTrackId()]}),bn((kr=class extends qy{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?La.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,o){super(e,r),Se(this,"trackMediaType",Yy.AUDIO),Se(this,"_encoderConfig",void 0),Se(this,"_trackSource",void 0),Se(this,"metadata",[]),Se(this,"_enabled",!0),Se(this,"_volume",100),Se(this,"_useAudioElement",!0),Se(this,"_bypassWebAudio",!1),Se(this,"processor",void 0),Se(this,"_processorContext",void 0),Se(this,"_processorDestination",void 0),Se(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!o,this._trackSource=new Yk,te("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),te("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),_s()&&!rc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Zn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&La.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,ir(this,ft.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(r=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!u4())throw new Ie(K.NOT_SUPPORTED,"your browser does not support setting the audio output device");await La.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await ir(this,ft.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw r||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await ir(this,ft.NEED_DISABLE_TRACK,this)}catch(o){throw r||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await ir(this,ft.NEED_MUTE_TRACK,this):await ir(this,ft.NEED_UNMUTE_TRACK,this))}getStats(){return vf(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Jo(this,ft.GET_STATS)||Or({},Vk)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(tc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(tc.ON_AUDIO_BUFFER),this._source.on(tc.ON_AUDIO_BUFFER,r=>e(r))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),La.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?La.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&La.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ir(this,ft.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return tt.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Ie(K.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Ie(K.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Ea.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await ir(this,ft.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ir(this,ft.NEED_REPLACE_TRACK,this))}),e.on(Ea.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Ea.ON_TRACK),e.removeAllListeners(Ea.ON_NODE)}bindProcessorContextEvents(e){e.on(nc.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(nc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Yk&&(this._trackSource=new S4(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new D4(this._source.context,this.getTrackId(),"local"),t=new O4(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(tc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(La.stop(this.getTrackId()),this._source.play()),ir(this,ft.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(r=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[j4],Object.getOwnPropertyDescriptor(kr.prototype,"setVolume"),kr.prototype),bn(kr.prototype,"setPlaybackDevice",[U4,V4],Object.getOwnPropertyDescriptor(kr.prototype,"setPlaybackDevice"),kr.prototype),bn(kr.prototype,"setEnabled",[F4,B4,H4],Object.getOwnPropertyDescriptor(kr.prototype,"setEnabled"),kr.prototype),bn(kr.prototype,"setMuted",[G4,W4,z4],Object.getOwnPropertyDescriptor(kr.prototype,"setMuted"),kr.prototype),bn(kr.prototype,"getStats",[Y4],Object.getOwnPropertyDescriptor(kr.prototype,"getStats"),kr.prototype),bn(kr.prototype,"setAudioFrameCallback",[q4],Object.getOwnPropertyDescriptor(kr.prototype,"setAudioFrameCallback"),kr.prototype),bn(kr.prototype,"play",[K4,X4],Object.getOwnPropertyDescriptor(kr.prototype,"play"),kr.prototype),bn(kr.prototype,"stop",[Q4,$4],Object.getOwnPropertyDescriptor(kr.prototype,"stop"),kr.prototype),bn(kr.prototype,"close",[J4],Object.getOwnPropertyDescriptor(kr.prototype,"close"),kr.prototype),bn(kr.prototype,"pipe",[Z4],Object.getOwnPropertyDescriptor(kr.prototype,"pipe"),kr.prototype),bn(kr.prototype,"unpipe",[e5],Object.getOwnPropertyDescriptor(kr.prototype,"unpipe"),kr.prototype),kr),jb=(t5=Ot({argsMap:(e,t)=>[e.getTrackId(),t]}),n5=ei(),r5=Uy("MicrophoneAudioTrack","_enabledMutex"),i5=Ot({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),s5=ei(),a5=Ot({argsMap:e=>[e.getTrackId()]}),bn((mu=class extends Xr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,o){super(e,t.encoderConfig?FA(t.encoderConfig):{},o,te("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Se(this,"_config",void 0),Se(this,"_deviceName","default"),Se(this,"_constraints",void 0),Se(this,"_originalConstraints",void 0),Se(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Ly()||pk())&&Xn.bindInterruptDetectorTrack(this)}async setDevice(e){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await sc.getDeviceById(e),r={};r.audio=Or({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await ic(r,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await ic({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await sc.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}x.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),e),te("AUTO_RESET_AUDIO_ROUTE")&&(_a()||gl())){const f=navigator.audioSession;f&&(e||(f.type="playback"),f.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),r||(this._enabled=!1);try{await ir(this,ft.NEED_DISABLE_TRACK,this)}catch(f){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),f.toString()),f}return}const c=Or({},this._constraints),u=sc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{r||(this._enabled=!0);const f=await ic({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(f.getAudioTracks()[0],!1),await ir(this,ft.NEED_ENABLE_TRACK,this)}catch(f){throw r||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),f.toString()),f}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Ly()||pk())&&Xn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((_a()||gl())&&this._enabled&&!this._isClosed&&Xn.duringInterruption){const e=async()=>{Xn.off(ds.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Xn.on(ds.IOS_INTERRUPTION_END,e)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Wy.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,r=sc.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const o=await ic({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(nc.REQUEST_UPDATE_CONSTRAINTS,async(t,r,o)=>{try{const c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),r()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(nc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[t5,n5],Object.getOwnPropertyDescriptor(mu.prototype,"setDevice"),mu.prototype),bn(mu.prototype,"setEnabled",[r5,i5,s5],Object.getOwnPropertyDescriptor(mu.prototype,"setEnabled"),mu.prototype),bn(mu.prototype,"close",[a5],Object.getOwnPropertyDescriptor(mu.prototype,"close"),mu.prototype),mu),One=(o5=Ot({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),c5=ei(),l5=Ot({argsMap:e=>[e.getTrackId()]}),d5=ei(),u5=Ot({argsMap:e=>[e.getTrackId()]}),h5=ei(),p5=Ot({argsMap:e=>[e.getTrackId()]}),f5=ei(),m5=Ot({argsMap:e=>[e.getTrackId()]}),g5=ei(),_5=Ot({argsMap:e=>[e.getTrackId()]}),E5=Ot({argsMap:e=>[e.getTrackId()]}),y5=ei(),bn((Ss=class extends Xr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,o){super(t.createOutputTrack(),r,o),Se(this,"source",void 0),Se(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(tc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Wy.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Zn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[o5,c5],Object.getOwnPropertyDescriptor(Ss.prototype,"startProcessAudioBuffer"),Ss.prototype),bn(Ss.prototype,"pauseProcessAudioBuffer",[l5,d5],Object.getOwnPropertyDescriptor(Ss.prototype,"pauseProcessAudioBuffer"),Ss.prototype),bn(Ss.prototype,"seekAudioBuffer",[u5,h5],Object.getOwnPropertyDescriptor(Ss.prototype,"seekAudioBuffer"),Ss.prototype),bn(Ss.prototype,"resumeProcessAudioBuffer",[p5,f5],Object.getOwnPropertyDescriptor(Ss.prototype,"resumeProcessAudioBuffer"),Ss.prototype),bn(Ss.prototype,"stopProcessAudioBuffer",[m5,g5],Object.getOwnPropertyDescriptor(Ss.prototype,"stopProcessAudioBuffer"),Ss.prototype),bn(Ss.prototype,"close",[_5],Object.getOwnPropertyDescriptor(Ss.prototype,"close"),Ss.prototype),bn(Ss.prototype,"setAudioBufferPlaybackSpeed",[E5,y5],Object.getOwnPropertyDescriptor(Ss.prototype,"setAudioBufferPlaybackSpeed"),Ss.prototype),Ss);class Ni extends Xr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Ky().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,dr(8,"track-mix-")),Se(this,"trackList",void 0),Se(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(x.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):x.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){x.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}OA(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(r=>{r instanceof Ni?r.emit(Ug.TRANSCEIVER_UPDATED,t):r._updateRtpTransceiver(t)}))}}class Dne extends v4{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(tc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Se(this,"audioBuffer",void 0),Se(this,"sourceNode",void 0),Se(this,"startPlayTime",0),Se(this,"startPlayOffset",0),Se(this,"pausePlayTime",0),Se(this,"options",void 0),Se(this,"currentLoopCount",0),Se(this,"currentPlaybackSpeed",100),Se(this,"_currentState","stopped"),this.audioBuffer=t,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const v5=new Map;function S5(e,t){if(e.length===0||t.length===0)return 1/0;const r=Tk(e),o=Tk(t);return Math.floor(o/r)}class Kk{get rendFrameRate(){const t=Math.max(1,S5(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var r;t!==this._videoState&&(this._videoState=t,(r=this.onVideoStateChanged)===null||r===void 0||r.call(this,this.videoState))}constructor(t){Se(this,"trackId",void 0),Se(this,"config",void 0),Se(this,"onFirstVideoFrameDecoded",void 0),Se(this,"onVideoStateChanged",void 0),Se(this,"freezeTimeCounterList",[]),Se(this,"renderFreezeAccTime",0),Se(this,"renderFreezeAccTime2",0),Se(this,"isKeepLastFrame",!1),Se(this,"timeUpdatedCount",0),Se(this,"freezeTime",0),Se(this,"playbackTime",0),Se(this,"lastTimeUpdatedTime",0),Se(this,"autoplayFailed",!1),Se(this,"videoTrack",void 0),Se(this,"videoElement",void 0),Se(this,"cacheVideoElement",void 0),Se(this,"_render_interframe_delays",[]),Se(this,"_render_interframe_delays_sizes",[]),Se(this,"_videoState",fu.VideoStateStopped),Se(this,"videoElementCheckInterval",void 0),Se(this,"videoElementFreezeTimeout",void 0),Se(this,"_videoElementStatus",Js.NONE),Se(this,"isGettingVideoDimensions",!1),Se(this,"startGetVideoDimensions",()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),Se(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Xn.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(S3())),I3()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Se(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Js.PLAYING;break;case"loadeddata":if(this.videoState=fu.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Js.CANPLAY;break;case"stalled":this.videoElementStatus=Js.STALLED;break;case"suspend":this.videoElementStatus=Js.SUSPEND;break;case"pause":this.videoElementStatus=Js.PAUSED,_a()||gl()||_s()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Js.WAITING;break;case"abort":this.videoElementStatus=Js.ABORT;break;case"ended":this.videoElementStatus=Js.ENDED;break;case"emptied":this.videoElementStatus=Js.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=Js.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,gu.lastVisibleTime<gu.lastHiddenTime||u<gu.lastHiddenTime||u<gu.lastVisibleTime)return;for(c>te("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const f=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(f),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(S3())),I3()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Xn.on(ds.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Xn.on(ds.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const r=this.videoElement.play();r&&r.catch&&r.catch(c=>{t&&A4(t,"video",c.message,this.trackId),c.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),c)});const o=Nn();if((o.name==="Safari"&&Number(o.version)===15||Ly())&&r&&r.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(c).catch(c)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const r=t.getContext("2d");if(!r)return x.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,t.width,t.height);const o=r.getImageData(0,0,t.width,t.height);return t.remove(),o}async getCurrentFrameToUint8Array(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new tt((u,f)=>{o.toBlob(async g=>{if(o.remove(),g){const E=await M4(g);u({buffer:E,width:o.width,height:o.height})}else f(new Ie(K.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,r<0?.1:r>1?1:r)})):await qk(t)}destroy(){Xn.off(ds.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Xn.off(ds.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=fu.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Js.INIT,!this.videoElementCheckInterval&&(T5.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=Js.DESTROYED)},1e3),te("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,r;let u;const f=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",f),this.videoElementFreezeTimeout=window.setTimeout(g,te("VIDEO_FREEZE_DURATION")))},g=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===fu.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=fu.VideoStateFrozen:document.addEventListener("visibilitychange",f))},E=(v,S)=>{if(this.videoElementStatus===Js.PLAYING){if(u){const D=S.presentationTime-u.presentationTime,V=S.presentedFrames-u.presentedFrames;this._render_interframe_delays_sizes.push(V),this._render_interframe_delays.push(D);const M=Tk(this._render_interframe_delays_sizes),j=M-this._render_interframe_delays_sizes[0];if(M>30&&j>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===fu.VideoStateStarting&&(this.videoState=fu.VideoStateDecoding),this.videoState===fu.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(g,te("VIDEO_FREEZE_DURATION"))),D<te("VIDEO_FREEZE_DURATION")&&this.videoState===fu.VideoStateFrozen&&(this.videoState=fu.VideoStateDecoding),D>te("VIDEO_FREEZE_DURATION")&&gu.lastVisibleTime>=gu.lastHiddenTime&&u.timestamp>gu.lastVisibleTime&&u.timestamp>gu.lastHiddenTime){const W=Math.min(66,S5(this._render_interframe_delays_sizes,this._render_interframe_delays)),Y=Math.max(0,D-(V-1)*W);this.renderFreezeAccTime2+=Y>W?Y:0,this.renderFreezeAccTime+=D}}u=Or(Or({},S),{},{timestamp:v})}var R,I;te("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(I=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(I,E))};(t=(r=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(r,E)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),NA()&&!te("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=Nn();o.name==="Safari"&&Number(o.version)===15||Ly()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Br()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Br()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{x.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){T5.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Js.NONE}handleAutoPlayFailed(){const t=r=>{r.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{x.error(o)}),this.autoplayFailed=!1,Ab()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Ab()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),C4()}}const T5=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class b5 extends Kk{constructor(t){super(t),Se(this,"container",void 0),Se(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const r=t.element;r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var r;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,o):await qk(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",te("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var w5,R5,C5,A5,I5,N5,O5,D5,x5,P5,k5,L5,M5,j5,U5,V5,F5,B5,H5,G5,W5,z5,Y5,q5,K5,X5,_n,Q5,$5,J5,Z5,e9,t9,n9,r9,oc;let Er=(w5=Ot({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),R5=ei(),C5=Ot({argsMap:e=>[e.getTrackId()]}),A5=Uy("LocalVideoTrack","_enabledMutex"),I5=Ot({argsMap:(e,t)=>[e.getTrackId(),t]}),N5=ei(),O5=Uy("LocalVideoTrack","_enabledMutex"),D5=Ot({argsMap:(e,t)=>[e.getTrackId(),t]}),x5=ei(),P5=Ot({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),k5=ei(),L5=Ot({argsMap:(e,t)=>[e.getTrackId(),t]}),M5=ei(),j5=ei(),U5=Ot({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),V5=ei(),F5=ei(),B5=ei(),H5=ei(),G5=ei(),W5=ei(),z5=ei(),Y5=Ot({argsMap:(e,t)=>[e.getTrackId(),t.name]}),q5=Ot({argsMap:e=>[e.getTrackId()]}),K5=Ot({argsMap:e=>[e.getTrackId()]}),X5=Ot({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),_n=class kX extends qy{get videoHeight(){if(_s()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(_s()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Js.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,r,o,c,u,f){if(super(t,u),Se(this,"trackMediaType",Yy.VIDEO),Se(this,"_player",void 0),Se(this,"isUseScaleResolutionDownBy",!1),Se(this,"_videoVisibleTimer",null),Se(this,"_previousVideoVisibleStatus",void 0),Se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Se(this,"_encoderConfig",void 0),Se(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Se(this,"_optimizationMode",void 0),Se(this,"_saveEncodeBitrateRatio",1),Se(this,"_videoHeight",void 0),Se(this,"_videoWidth",void 0),Se(this,"_forceBitrateLimit",void 0),Se(this,"_enabled",!0),Se(this,"_processorDestination",void 0),Se(this,"_processorContext",void 0),_s()){const{width:g,height:E}=t.getSettings();this._videoWidth=g,this._videoHeight=E}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=o,this._optimizationMode=c,this._hints=f||[],r&&this._hints.indexOf(er.CUSTOM_TRACK)!==-1?this._encoderConfig=Pr(r):this._encoderConfig=r,this._hints.indexOf(er.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(dk(Mn.CHROME,115)&&AA().indexOf("Windows")!==-1){const g=function(E,v){if("VideoFrame"in window&&"TransformStream"in window&&On().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(E),R=new MediaStreamTrackGenerator({kind:"video"});let I,D,V=Date.now();const M=()=>{j&&(clearInterval(j),j=void 0),I&&(I.close(),I=void 0),E.stop(),D=void 0,R.removeEventListener("ended",M)};let j=window.setInterval(()=>{if(D&&I&&Date.now()-V>1e3)try{R.readyState==="live"?D.enqueue(I.clone()):M()}catch{M()}},1e3);const W=new TransformStream({transform:(Y,le)=>{R.readyState==="live"?(D=le,V=Date.now(),I===void 0?(I=Y,le.enqueue(Y.clone())):(le.enqueue(I),I=Y)):Y.close()}});return R.addEventListener("ended",M),S.readable.pipeThrough(W).pipeTo(R.writable),R}}(t);g&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=g)}r&&this._hints.indexOf(er.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r),this._processorContext=new N4(this.getTrackId(),"local"),this._processorDestination=new I4(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const c=document.getElementById(t);c?t=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const o=Or(Or(Or({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(o):(t instanceof HTMLVideoElement?this._player=new Kk(o):this._player=new b5(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Wy.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},te("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await ir(this,ft.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return r||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await ir(this,ft.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await ir(this,ft.NEED_MUTE_TRACK,this):await ir(this,ft.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),x.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await ir(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(x)}}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new Ie(K.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=yl(t),te("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const o=GA({encoderConfig:t});(_s()||_a()||gl())&&(o.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new Ie(K.UNEXPECTED_ERROR,c.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=t,this._hints.indexOf(er.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ir(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(x)}}getStats(){return vf(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Jo(this,ft.GET_STATS)||Or({},Fk)}async setBeautyEffect(t){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):await qk(t)}async setBitrateLimit(t){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void x.error(K.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const r=this._optimizationMode;try{this._optimizationMode=t,await ir(this,ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=r,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return x.error(K.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){x4(this._originMediaStreamTrack).then(t=>{let[r,o]=t;this._videoHeight=o,this._videoWidth=r}).catch(xA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new Ie(K.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=yl(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(er.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ir(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:r,frameRate:o}=this.getMediaStreamTrackSettings();if(!t||!r||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:f,min:g}=function(E,v,S,R,I){const D=te("BITRATE_ADAPTER_TYPE");if(D==="DEFAULT_BITRATE")return{min:R,max:I};if(I===void 0){const V=Math.floor(200*Math.pow(S/15,.6)*Math.pow(E*v/640/360,.75));I=D==="STANDARD_BITRATE"?4*V:2*V,R=R??V}else R=R??Math.floor(I/10);return{min:R,max:I}}(t,r,o,u,c);if(this._encoderConfig.bitrateMin=g,this._encoderConfig.bitrateMax=f,te("VIDEO_STANDARD_BITRATE_VERSION")&&u==null&&c==null){const[E,v]=function(S,R,I){const D=4*Math.floor(2e5*Math.pow(I/15,.6)*Math.pow(S*R/230400,.75)),V=S*R,M=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),j=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let W=Pa(M).call(M).next().value,Y=1;if(M.has(V))W=M.get(V);else{var le;const at=Gt(le=Array.from(M.entries())).call(le,(Xt,Lt)=>{let[mr]=Xt,[tr]=Lt;return mr-tr}),nn=at.find(Xt=>{let[Lt]=Xt;return Lt>V});if(nn){const Xt=at.indexOf(nn);if(Xt>0){const Lt=at[Xt-1],mr=(V-Lt[0])/(nn[0]-Lt[0]);W=Lt[1]+mr*(nn[1]-Lt[1])}else W=nn[1]}else W=at[at.length-1][1]}if(j.has(V))Y=j.get(V);else{var ye;const at=Gt(ye=Array.from(j.entries())).call(ye,(Xt,Lt)=>{let[mr]=Xt,[tr]=Lt;return mr-tr}),nn=at.find(Xt=>{let[Lt]=Xt;return Lt>V});if(nn){const Xt=at.indexOf(nn);if(Xt>0){const Lt=at[Xt-1],mr=(V-Lt[0])/(nn[0]-Lt[0]);Y=Lt[1]+mr*(nn[1]-Lt[1])}else Y=nn[1]}else Y=at[at.length-1][1]}const Ee=te("VIDEO_NEW_BITRATE_RATIO");Ee&&Ee>0&&(W=Ee/100);const me=Math.floor(D*W),Ae=Math.floor(65e4*Math.pow(S*R/230400,.5)*Math.pow(I/15,.69));let Pe=me;const $e=te("VIDEO_STANDARD_BITRATE_VERSION");return $e&&$e>0&&($e===1?Pe=D:$e===2?Pe=me:$e===3&&(Pe=Ae)),[Math.floor(Pe/1e3),Y]}(t,r,o);this._encoderConfig.bitrateMax=E,this._encoderConfig.bitrateMin=g?Math.min(g,E):E,this._saveEncodeBitrateRatio=v,x.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(o,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(o,"] => [brMax: ").concat(f,", brMin: ").concat(g,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,r;const o=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),c={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:f}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&f instanceof HTMLElement){const g=P3.checkOneElementVisible(u),E=Object.assign({},g);if(E.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=E.visible;const v=St.reportApiInvoke(null,{tag:Gr.TRACER,name:fi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});E.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(E.reason))}return E}return}catch(o){throw new Ie(K.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new Ie(K.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;t&&(o=Or(Or({},o),yl(t))),o=kg(o);const c=dr(8,"track-video-cloned-"),u=new kX(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,kg(this._scalabilityMode),this._optimizationMode,c,kg(this._hints));return t&&o&&u.setEncoderConfiguration(o),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),u}async replaceTrack(t,r){if(!(t instanceof MediaStreamTrack))throw new Ie(K.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new Ie(K.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,r,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(vf(()=>{St.reportApiInvoke(null,{name:fi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Gr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!te("ENABLE_VIDEO_SEI")||!te("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new Ie(K.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const r=this.getRTCRtpTransceiver();if(!r)return void x.warning("Video track is not published, SEI can not be send");const o=r.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",t):x.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(Ea.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await ir(this,ft.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ir(this,ft.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ea.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(nc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(nc.REQUEST_CONSTRAINTS)}},bn(_n.prototype,"play",[w5,R5],Object.getOwnPropertyDescriptor(_n.prototype,"play"),_n.prototype),bn(_n.prototype,"stop",[C5],Object.getOwnPropertyDescriptor(_n.prototype,"stop"),_n.prototype),bn(_n.prototype,"setEnabled",[A5,I5,N5],Object.getOwnPropertyDescriptor(_n.prototype,"setEnabled"),_n.prototype),bn(_n.prototype,"setMuted",[O5,D5,x5],Object.getOwnPropertyDescriptor(_n.prototype,"setMuted"),_n.prototype),bn(_n.prototype,"setSaveEncodeBitrateRatio",[P5,k5],Object.getOwnPropertyDescriptor(_n.prototype,"setSaveEncodeBitrateRatio"),_n.prototype),bn(_n.prototype,"setEncoderConfiguration",[L5,M5],Object.getOwnPropertyDescriptor(_n.prototype,"setEncoderConfiguration"),_n.prototype),bn(_n.prototype,"getStats",[j5],Object.getOwnPropertyDescriptor(_n.prototype,"getStats"),_n.prototype),bn(_n.prototype,"setBeautyEffect",[U5,V5],Object.getOwnPropertyDescriptor(_n.prototype,"setBeautyEffect"),_n.prototype),bn(_n.prototype,"getCurrentFrameData",[F5],Object.getOwnPropertyDescriptor(_n.prototype,"getCurrentFrameData"),_n.prototype),bn(_n.prototype,"getCurrentFrameImage",[B5],Object.getOwnPropertyDescriptor(_n.prototype,"getCurrentFrameImage"),_n.prototype),bn(_n.prototype,"setBitrateLimit",[H5],Object.getOwnPropertyDescriptor(_n.prototype,"setBitrateLimit"),_n.prototype),bn(_n.prototype,"setOptimizationMode",[G5],Object.getOwnPropertyDescriptor(_n.prototype,"setOptimizationMode"),_n.prototype),bn(_n.prototype,"setScalabiltyMode",[W5],Object.getOwnPropertyDescriptor(_n.prototype,"setScalabiltyMode"),_n.prototype),bn(_n.prototype,"updateMediaStreamTrackResolution",[z5],Object.getOwnPropertyDescriptor(_n.prototype,"updateMediaStreamTrackResolution"),_n.prototype),bn(_n.prototype,"pipe",[Y5],Object.getOwnPropertyDescriptor(_n.prototype,"pipe"),_n.prototype),bn(_n.prototype,"unpipe",[q5],Object.getOwnPropertyDescriptor(_n.prototype,"unpipe"),_n.prototype),bn(_n.prototype,"close",[K5],Object.getOwnPropertyDescriptor(_n.prototype,"close"),_n.prototype),bn(_n.prototype,"replaceTrack",[X5],Object.getOwnPropertyDescriptor(_n.prototype,"replaceTrack"),_n.prototype),_n),Xk=(Q5=Ot({argsMap:(e,t)=>[e.getTrackId(),t]}),$5=ei(),J5=Uy("CameraVideoTrack","_enabledMutex"),Z5=Ot({argsMap:(e,t)=>[e.getTrackId(),t]}),e9=ei(),t9=Ot({argsMap:(e,t)=>[e.getTrackId(),t]}),n9=ei(),r9=Ot({argsMap:e=>[e.getTrackId()]}),oc=class LX extends Er{get __className__(){return"CameraVideoTrack"}constructor(t,r,o,c,u,f){super(t,yl(r.encoderConfig),c,u,f),Se(this,"_config",void 0),Se(this,"_originalConstraints",void 0),Se(this,"_constraints",void 0),Se(this,"_enabled",!0),Se(this,"_deviceName","default"),Se(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Ly()||pk())&&!function(){const g=Nn();if(g.os!==Fi.IOS||!g.osVersion)return!1;const E=g.osVersion.split(".");return Number(E[0])===15&&Number(E[1])>=2}()&&N3()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=r,this._originalConstraints=o,this._constraints=o,this._deviceName=t.label,this._encoderConfig=yl(this._config.encoderConfig),Xn.on(ds.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Xn.on(ds.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const r=await sc.getDeviceById(t),o={};o.video=Or({},this._constraints),o.video.deviceId={exact:t},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await ic(o,this.getTrackId())}catch(u){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await ic({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await sc.getDeviceById(t);this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const r={video:Or(Or({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await ic(r,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await ic({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Or({},r.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await ic({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await ir(this,ft.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r||(this._enabled=!1);try{await ir(this,ft.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new Ie(K.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=yl(t),te("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const o=Pr(this._config);o.encoderConfig=t;const c=GA(o);(_s()||_a()||gl())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const f=new Ie(K.UNEXPECTED_ERROR,u.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),f.toString()),f}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=t,this._hints.indexOf(er.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ir(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((_a()||gl())&&this._enabled&&!this._isClosed&&Xn.duringInterruption){const t=async()=>{Xn.off(ds.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Xn.on(ds.IOS_INTERRUPTION_END,t)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Wy.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,o=sc.searchDeviceIdByName(this._deviceName);if(o&&!r.deviceId&&(r.deviceId={exact:o}),this._enabled){const c=await ic({video:r},this.getTrackId());this._constraints=r,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Xn.off(ds.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Xn.off(ds.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;t&&(o=Or(Or({},o),yl(t))),o=kg(o);const c=dr(8,"track-cam-cloned-"),u=new LX(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,kg(Or(Or({},this._config),{},{encoderConfig:o})),kg(this._constraints),kg(this._scalabilityMode),this._optimizationMode,c);return t&&o&&u.setEncoderConfiguration(o),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),u}bindProcessorContextEvents(){this.processorContext.on(nc.REQUEST_UPDATE_CONSTRAINTS,async(t,r,o)=>{try{const c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),r()}catch(c){o(c)}}),this.processorContext.on(nc.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},bn(oc.prototype,"setDevice",[Q5,$5],Object.getOwnPropertyDescriptor(oc.prototype,"setDevice"),oc.prototype),bn(oc.prototype,"setEnabled",[J5,Z5,e9],Object.getOwnPropertyDescriptor(oc.prototype,"setEnabled"),oc.prototype),bn(oc.prototype,"setEncoderConfiguration",[t9,n9],Object.getOwnPropertyDescriptor(oc.prototype,"setEncoderConfiguration"),oc.prototype),bn(oc.prototype,"close",[r9],Object.getOwnPropertyDescriptor(oc.prototype,"close"),oc.prototype),oc);function Qk(e,t,r,o){r.optimizationMode&&(o&&o.width&&o.height?(r.encoderConfig=Or(Or({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?x.debug("[".concat(e,"] set content hint to"),r.optimizationMode):x.debug("[".concat(e,"] set content hint failed")))):x.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var i9,s9,a9,o9,Oc,c9,l9,d9,u9,h9,p9,oa;class f9 extends _4{getUserId(){return this._userId}constructor(t,r,o,c){super(t,"track-".concat(t.kind,"-").concat(r,"-").concat(c.clientId,"_").concat(dr(5,""))),Se(this,"_userId",void 0),Se(this,"_uintId",void 0),Se(this,"_isDestroyed",!1),Se(this,"store",void 0),Se(this,"processor",void 0),Se(this,"processorContext",void 0),this._userId=r,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Qy=(i9=Ot({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),s9=Ot({argsMap:e=>[e.getTrackId()]}),a9=Ot({argsMap:(e,t)=>[e.getTrackId(),t.name]}),o9=Ot({argsMap:e=>[e.getTrackId()]}),bn((Oc=class extends f9{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Js.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,o){super(e,t,r,o),Se(this,"_videoVisibleTimer",null),Se(this,"_previousVideoVisibleStatus",void 0),Se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Se(this,"trackMediaType",Yy.VIDEO),Se(this,"_videoWidth",void 0),Se(this,"_videoHeight",void 0),Se(this,"_player",void 0),Se(this,"processorDestination",void 0),Se(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new N4(this.getTrackId(),"remote"),this.processorDestination=new I4(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return vf(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Jo(this,ft.GET_STATS)||Or({},m4)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const r=Or(Or({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new Kk(r):this._player=new b5(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(zy.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(zy.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(zy.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},te("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){x4(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(xA)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const f=P3.checkOneElementVisible(c),g=Object.assign({},f);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const E=St.reportApiInvoke(null,{tag:Gr.TRACER,name:fi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?E.onSuccess("Video is visible"):E.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(r){throw new Ie(K.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Ie(K.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ea.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ea.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Ug.SEI_RECEIVED,e)}}).prototype,"play",[i9],Object.getOwnPropertyDescriptor(Oc.prototype,"play"),Oc.prototype),bn(Oc.prototype,"stop",[s9],Object.getOwnPropertyDescriptor(Oc.prototype,"stop"),Oc.prototype),bn(Oc.prototype,"pipe",[a9],Object.getOwnPropertyDescriptor(Oc.prototype,"pipe"),Oc.prototype),bn(Oc.prototype,"unpipe",[o9],Object.getOwnPropertyDescriptor(Oc.prototype,"unpipe"),Oc.prototype),Oc),$y=(c9=Ot({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),l9=Ot({argsMap:(e,t)=>[e.getTrackId(),t]}),d9=Ot({argsMap:e=>[e.getTrackId()]}),u9=Ot({argsMap:e=>[e.getTrackId()]}),h9=Ot({argsMap:(e,t)=>[e.getTrackId(),t.name]}),p9=Ot({argsMap:e=>[e.getTrackId()]}),bn((oa=class extends f9{get isPlaying(){return this._useAudioElement?La.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,o){super(e,t,r,o),Se(this,"trackMediaType",Yy.AUDIO),Se(this,"_source",void 0),Se(this,"_useAudioElement",!0),Se(this,"_volume",100),Se(this,"processorContext",void 0),Se(this,"processorDestination",void 0),Se(this,"_played",!1),Se(this,"_bypassWebAudio",!1),te("DISABLE_WEBAUDIO")?(this._source=new Yk,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new S4(e,!0),te("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(tc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(zy.FIRST_FRAME_DECODED)}),this.processorContext=new D4(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new O4(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(tc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(tc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(tc.ON_AUDIO_BUFFER),this._source.on(tc.ON_AUDIO_BUFFER,r=>e(r))}setVolume(e){this._volume=e,this._useAudioElement?La.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!u4())throw new Ie(K.NOT_SUPPORTED,"your browser does not support setting the audio output device");await La.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return vf(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Jo(this,ft.GET_STATS)||Or({},f4)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),La.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?La.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&La.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Ie(K.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Ie(K.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Ie(K.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ea.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Ea.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ea.ON_TRACK),this.processorDestination.removeAllListeners(Ea.ON_NODE)}}).prototype,"setVolume",[c9],Object.getOwnPropertyDescriptor(oa.prototype,"setVolume"),oa.prototype),bn(oa.prototype,"setPlaybackDevice",[l9],Object.getOwnPropertyDescriptor(oa.prototype,"setPlaybackDevice"),oa.prototype),bn(oa.prototype,"play",[d9],Object.getOwnPropertyDescriptor(oa.prototype,"play"),oa.prototype),bn(oa.prototype,"stop",[u9],Object.getOwnPropertyDescriptor(oa.prototype,"stop"),oa.prototype),bn(oa.prototype,"pipe",[h9],Object.getOwnPropertyDescriptor(oa.prototype,"pipe"),oa.prototype),bn(oa.prototype,"unpipe",[p9],Object.getOwnPropertyDescriptor(oa.prototype,"unpipe"),oa.prototype),oa);const gu=new class extends xr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Se(this,"_lastHiddenTime",0),Se(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class m9 extends xr{constructor(t,r){super(),Se(this,"trackMediaType",Yy.DATA),Se(this,"_version",1),Se(this,"_type",3),Se(this,"_config",void 0),Se(this,"_originDataChannel",void 0),Se(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Se(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Se(this,"_datachannelEventMap",new Map),this._config=t,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return te("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new tt((t,r)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const o=setTimeout(()=>{var c;r(new Ie(K.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Ie(K.DATACHANNEL_CONNECTION_TIMEOUT)}}else r(new Ie(K.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[BA.OPEN,BA.CLOSE,BA.ERROR].forEach(r=>{const o=()=>{this.emit(r)};this._datachannelEventMap.set(r,o),t.addEventListener(r,o)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[o,c]=r;t.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class xne extends m9{constructor(t){super(t),Se(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=r.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(te("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=r.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(BA.MESSAGE,u)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Pne extends m9{send(t){if(this._originDataChannel){let r=t;r=this._dataStreamPacketHandler.serialize(t);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function WA(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>WC.revokeObjectURL(e),0),new Worker(WC.createObjectURL(e))}const g9=71,$k=1,Jk=2,Zk=1,_9=2;var Hh=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Hh||{});function E9(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=e.getUint8(0);if(r!==g9)return;const o=e.getUint16(1),c=$k+Jk+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const f={m:r,tlvLen:o,tlv:[],frame:u};let g=$k+Jk;for(;g<c;){const E=e.getUint8(g),v=e.getUint16(g+Zk),S=Zk+_9;if(E===Hh.AUDIO_LEVEL){let R=e.getUint8(g+S);for(let I=1;I<v;I++)R=R<<8|e.getUint8(g+S+I);f.tlv.push({tag:E,length:v,value:t?127^R>>1:127&R})}else if(E===Hh.METADATA||E===Hh.AUDIO_64_BIT_PTS){const R=new Uint8Array(v);for(let I=0;I<v;I++)R[I]=e.getUint8(g+S+I);f.tlv.push({tag:E,length:v,value:R})}g+=S+v}return f}const zA=new Map,YA=127,Bg=1e-10,e1=139/13,qA=new Map;function t1(e,t,r){const o="".concat(e,"-").concat(t,"-").concat(r);let c=0;return qA.has(o)?c=qA.get(o):(c=Math.log(function(f,g){const E=f-g;g<E&&(g=E);let v=1;for(let S=f,R=1;S>g;S--,R++)v=v*S/R;return v}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(r)+r*e,qA.set(o,c)),c<Bg&&(c=Bg),c}function y9(e,t,r){const o=t.length,c=e.length/o;let u=!1;for(let f=0,g=0;f<o;f++){let E=0;for(let v=g+c;g<v;g++)e[g]>r&&E++;t[f]!==E&&(t[f]=E,u=!0)}return u}window.cache=qA;let kne=0;class v9{constructor(t){Se(this,"id",void 0),Se(this,"immediates",[]),Se(this,"lastNonSilence",-1),Se(this,"immediateSpeechActivityScore",Bg),Se(this,"lastLevelChangedTime",Date.now()),Se(this,"levels",[]),Se(this,"longs",[]),Se(this,"longSpeechActivityScore",Bg),Se(this,"mediums",[]),Se(this,"mediumSpeechActivityScore",Bg),Se(this,"minLevel",0),Se(this,"nextMinLevel",0),Se(this,"nextMinLevelWindowLength",0),Se(this,"energyScore",0),this.id=t||"".concat(kne++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,r=this.levels,o=this.minLevel+e1;let c=!1;for(let u=0;u<t.length;++u){let f=r[u];f<o&&(f=0);const g=Math.floor(f/e1);t[u]!==g&&(t[u]=g,c=!0)}return c}computeLongs(){return y9(this.mediums,this.longs,4)}computeMediums(){return y9(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=t1(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=t1(this.longs[0],10,47),this.longSpeechActivityScore>Bg&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=t1(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(uE(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,r){if(this.lastLevelChangedTime<=r){this.lastLevelChangedTime=r;let o=t;return t<0&&(o=0),t>YA&&(o=YA),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+e1?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let r=Math.sqrt(this.minLevel*this.nextMinLevel);r<0?r=0:r>YA&&(r=YA),this.minLevel=r,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Lne{constructor(t){Se(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const r=this.algorithm.runInDecisionMaker(this);r<=0?t=!0:setTimeout(this.execute.bind(this),r)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class n1{constructor(t,r,o){Se(this,"isDominant",void 0),Se(this,"energyRanking",void 0),Se(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=r,this.energyScore=o}}class Mne extends xr{constructor(t){super(),Se(this,"dominantId",null),Se(this,"lastDecisionTime",0),Se(this,"lastLevelChangedTime",0),Se(this,"lastLevelIdleTime",0),Se(this,"relativeSpeechActivities",[]),Se(this,"speakers",new Map),Se(this,"enableSilence",!1),Se(this,"timeoutToSilenceInterval",0),Se(this,"decisionMaker",null),Se(this,"loudest",[]),Se(this,"numLoudestToTrack",3),Se(this,"energyExpireTimeMs",250),Se(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,r=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,r!=null&&(this.energyExpireTimeMs=r),o!=null&&(this.energyAlphaPct=o),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(r=>r.id===t)}levelChanged(t,r){const o=Date.now(),c=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(r,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(r=>{this.speakers.has(r.id)||this.speakers.set(r.id,r)})}removeSpeakers(t){t.forEach(r=>{this.speakers.delete(r.id)})}getOrCreateSpeaker(t){let r=this.speakers.get(t);return r||(r=new v9(t),this.speakers.set(t,r),this.maybeStartDecisionMaker()),r}updateLoudestList(t,r,o){const c=t.id===this.dominantId;if(r<0){let E=0;for(;E<this.loudest.length&&this.loudest[E]!==t;)++E;return new n1(c,E,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*r+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new n1(c,0,t.energyScore);const u=o-this.energyExpireTimeMs;let f=0;for(;f<this.loudest.length;){const E=this.loudest[f];if(E.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(f,1);else if(E.id!==t.id)++f;else if(this.loudest.splice(f,1),this.loudest.length<this.numLoudestToTrack)break}let g=0;for(;g<this.loudest.length&&!(this.loudest[g].energyScore<t.energyScore);)++g;return g<this.numLoudestToTrack&&(this.loudest.splice(g,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new n1(c,g,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Lne(this),this.decisionMaker.execute())}makeDecision(t){let r=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var f;const g=Pa(f=this.speakers).call(f).next().value;this.enableSilence&&g&&(u=g.id,g.evaluateSpeechActivityScores(t),t-g.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let g=this.dominantId==null?null:this.speakers.get(this.dominantId);if(g==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],g=S.value[1])}else u=g.id;g!=null&&g.evaluateSpeechActivityScores(t);const E=this.relativeSpeechActivities;let v=2;for(const S of this.speakers.entries()){const[R,I]=S;if(I===g)continue;I.evaluateSpeechActivityScores(t);for(let j=0;j<E.length;++j){const W=g==null?Bg:g.getSpeechActivityScore(j);E[j]=Math.log(I.getSpeechActivityScore(j)/W)}const D=E[0],V=E[1],M=E[2];D>3&&V>2&&M>0&&V>v&&(v=V,u=R)}this.enableSilence&&g!=null&&u===g.id&&t-g.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(r=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===r||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const t=Date.now(),r=300-(t-this.lastLevelIdleTime);let o=0;r<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):o=r;let c=300-(t-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=t,this.makeDecision(t),c=300-(Date.now()-t)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(t){const r=[];for(const c of Pa(o=this.speakers).call(o)){var o;const u=t-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?r.push(c.id):300<u&&c.levelTimedOut()}r.forEach(c=>this.speakers.delete(c))}}const Jy=new Map;let hd=null,KA=null;const S9=3;let Hg=[];const pd=new Map,XA=new Map;class jne{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,r){Se(this,"id",void 0),Se(this,"track",void 0),Se(this,"score",0),Se(this,"active",!0),Se(this,"muted",!1),Se(this,"timer",0),Se(this,"actives",0),Se(this,"inactives",0),this.id=t,this.track=r,this.setActive(pd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:r,inactives:o}=function(){const c=[],u=[];return Array.from(Pa(pd).call(pd)).forEach(f=>{f.active?c.push(f):u.push(f)}),{actives:c,inactives:u}}();if(r.length>3){let c;r.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(r.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&t&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(r){let o;return Array.from(Pa(pd).call(pd)).forEach(c=>{!c.active||c.id===r||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(r){let o;return Array.from(Pa(pd).call(pd)).forEach(c=>{c.active||c.id===r||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let QA;function T9(e){const t=pd.get(e);t&&(pd.delete(e),t.clearTimer())}const $A=new Map,Une=new Map;function Vne(e,t,r){let o=new Uint8Array(e,t,r),c=[],u=0;for(;c.length<r;)u+3<r&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const JA=new Map,Ub=new Map;(function(){const e=Nn();ls.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ls.getStreamFromExtension=e.name===Mn.CHROME&&Number(e.version)>34,ls.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let r=!1;try{t.addTransceiver("audio"),r=!0}catch{}return t.close(),r}(),ls.supportMinBitrate=e.name===Mn.CHROME||e.name===Mn.EDGE,ls.supportSetRtpSenderParameters=function(){const t=Nn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Vh()||!(!_s()&&!IA())||t.name===Mn.FIREFOX&&Number(t.version)>=64)}(),e.name===Mn.SAFARI&&(Number(e.version)>=14?ls.supportDualStream=!0:ls.supportDualStream=!1),ls.webAudioMediaStreamDest=function(){const t=Nn();return!(t.name===Mn.SAFARI&&Number(t.version)<12)}(),ls.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ls.supportWebGL=typeof WebGLRenderingContext<"u",ls.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Vh()||(ls.webAudioWithAEC=!0),ls.supportShareAudio=function(){const t=Nn();return(t.os===Fi.WIN_10||t.os===Fi.WIN_81||t.os===Fi.WIN_7||t.os===Fi.LINUX||t.os===Fi.MAC_OS||t.os===Fi.CHROMIUM_OS)&&t.name===Mn.CHROME&&Number(t.version)>=74}(),ls.supportDataChannel=!!(Cb(76)||function(t){const r=Nn();return!(r.name!==Mn.FIREFOX||!r.osVersion)&&Number(r.version)>=t}(68)||w3(14)),ls.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Br()&&!!t&&t.prototype.setConfiguration instanceof Function}(),ls.supportWebRTCEncodedTransform=function(){const t=Nn();return t.name==="Chrome"&&Number(t.version)>=87||t.name==="Safari"&&Number(t.version)>=15}(),ls.supportWebRTCInsertableStream=function(){const t=Nn();return(t.name===Mn.CHROME||t.name===Mn.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ls.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ls.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,DA(()=>{ls.supportDualStreamEncoding=function(){const t=Nn();return!!te("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&te("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",e),x.info("browser compatibility: ",ls)})})();const Fne=["CHINA","GLOBAL"],b9=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Gg=[],Zy=[];function Wg(e,t){return!!t&&Gg.some(r=>r.uid===e&&r.channelName===t)}function r1(){return Zy.length>0}var Bne=BF.forEach,w9=ah("forEach")?[].forEach:function(e){return Bne(this,e,arguments.length>1?arguments[1]:void 0)};Pn({target:"Array",proto:!0,forced:[].forEach!==w9},{forEach:w9});var Hne=So("Array","forEach"),Gne=zl,Wne=hi,zne=U,Yne=Hne,i1=Array.prototype,qne={DOMTokenList:!0,NodeList:!0},Kne=function(e){var t=e.forEach;return e===i1||zne(i1,e)&&t===i1.forEach||Wne(qne,Gne(e))?Yne:t},Xne=l(Kne),Qne=Eo,R9=Lp;Pn({target:"Object",stat:!0,forced:p(function(){R9(1)})},{keys:function(e){return R9(Qne(e))}});var $ne=l(Mt.Object.keys),Jne=l(Fd),Zne=l(NS),ere=Pn,C9=Zc,tre=eg,nre=xt,A9=Ve,rre=qn,ire=wt,sre=qx,are=jr,ore=Da,cre=DF("slice"),lre=are("species"),s1=Array,dre=Math.max;ere({target:"Array",proto:!0,forced:!cre},{slice:function(e,t){var r,o,c,u=ire(this),f=rre(u),g=A9(e,f),E=A9(t===void 0?f:t,f);if(C9(u)&&(r=u.constructor,(tre(r)&&(r===s1||C9(r.prototype))||nre(r)&&(r=r[lre])===null)&&(r=void 0),r===s1||r===void 0))return ore(u,g,E);for(o=new(r===void 0?s1:r)(dre(E-g,0)),c=0;g<E;g++,c++)g in u&&sre(o,c,u[g]);return o.length=c,o}});var ure=So("Array","slice"),hre=U,pre=ure,a1=Array.prototype,fre=function(e){var t=e.slice;return e===a1||hre(a1,e)&&t===a1.slice?pre:t},mre=l(fre);function gt(e,t,r,o,c){var u,f,g,E={};return Xne(u=$ne(o)).call(u,function(v){E[v]=o[v]}),E.enumerable=!!E.enumerable,E.configurable=!!E.configurable,("value"in E||E.initializer)&&(E.writable=!0),E=Jne(f=Zne(g=mre(r).call(r)).call(g)).call(f,function(v,S){return S(e,t,v)||v},E),c&&E.initializer!==void 0&&(E.value=E.initializer?E.initializer.call(c):void 0,E.initializer=void 0),E.initializer===void 0?(AF(e,t,E),null):E}let ZA=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),o1=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),vl=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),ya=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Ct=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),fr=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),jt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),kt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),Vb=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),En=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),va=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),qt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function eI(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw x.error("Invalid Channel Name ".concat(e)),new Te(K.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function tI(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||x3(e,1,255)))throw new Te(K.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Gh=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const gre={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},c1={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function l1(e,t){os(e.url,"".concat(t,".url"),1,1e3,!1),Hr(e.x)||Zn(e.x,"".concat(t,".x"),0,1e4),Hr(e.y)||Zn(e.y,"".concat(t,".y"),0,1e4),Hr(e.width)||Zn(e.width,"".concat(t,".width"),0,1e4),Hr(e.height)||Zn(e.height,"".concat(t,".height"),0,1e4),Hr(e.zOrder)||Zn(e.zOrder,"".concat(t,".zOrder"),0,255),Hr(e.alpha)||Zn(e.alpha,"".concat(t,".alpha"),0,1,!1)}const _re={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let bf=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),d1=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Oi=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function I9(e){if(!e.channelName)throw new Te(K.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Te(K.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&os(e.token,"info.token",1,2047),tI(e.uid),eI(e.channelName),!0}let Sa=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Wh=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),ro=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),ev=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Hn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Ki=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),nI=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Hi=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),jn=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const N9=[jn.AFRICA,jn.ASIA,jn.CHINA,jn.EUROPE,jn.GLOBAL,jn.INDIA,jn.JAPAN,jn.NORTH_AMERICA,jn.OCEANIA,jn.OVERSEA,jn.SOUTH_AMERICA];let Ms=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const rI={CHINA:{},ASIA:{CODE:Ms.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Ms.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Ms.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Ms.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Ms.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Ms.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Ms.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Ms.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Ms.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Ms.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Ms.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Ms.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Ms.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Dk&&(rI.CHINA={CODE:Ms.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Fb=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function O9(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class D9 extends xr{constructor(t,r){super(),H(this,"onICEConnectionStateChange",void 0),H(this,"onConnectionStateChange",void 0),H(this,"onDTLSTransportStateChange",void 0),H(this,"onDTLSTransportError",void 0),H(this,"onICETransportStateChange",void 0),H(this,"onFirstAudioReceived",void 0),H(this,"onFirstVideoReceived",void 0),H(this,"onFirstAudioDecoded",void 0),H(this,"onFirstVideoDecoded",void 0),H(this,"onFirstVideoDecodedTimeout",void 0),H(this,"onSelectedLocalCandidateChanged",void 0),H(this,"onSelectedRemoteCandidateChanged",void 0),H(this,"onICECandidateError",void 0),H(this,"getLocalVideoStats",void 0)}}class x9 extends D9{constructor(t,r){super(t,r),H(this,"establishPromise",void 0)}}let lt=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),js=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),zh=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const P9=["disconnected","failed"];let Fe=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Fn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Rt=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Sl=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Tl=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Xi=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),k9=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),_u=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Dc=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),fd=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),tv=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),oi=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),nv=function(e){return e.ABORT="abort",e}({}),wf=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Ere=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const yre={[ZA.ACCESS_POINT]:{[ya.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[ya.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[ya.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[ya.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[ya.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[ya.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[ya.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[ya.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[ya.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[ya.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[ya.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[ya.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[ya.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[ya.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[ya.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[ya.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[ya.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[ya.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[ZA.UNILBS]:{[vl.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[vl.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[vl.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[vl.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[vl.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[vl.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[vl.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[vl.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[vl.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[vl.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[vl.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[vl.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[ZA.STRING_UID_ALLOCATOR]:{[o1.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[o1.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[o1.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function rv(e){const t=yre[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===ZA.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}const vre={[Ct.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ct.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ct.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ct.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ct.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ct.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ct.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ct.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ct.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ct.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ct.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ct.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ct.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ct.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ct.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ct.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ct.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ct.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ct.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ct.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ct.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ct.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ct.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ct.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ct.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ct.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ct.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ct.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ct.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ct.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ct.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ct.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ct.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ct.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ct.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ct.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ct.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ct.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ct.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ct.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ct.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ct.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ct.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ct.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ct.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ct.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ct.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ct.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ct.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ct.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ct.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ct.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ct.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ct.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ct.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ct.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ct.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ct.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ct.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ct.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ct.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ct.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ct.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Bb(e){return vre[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function L9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function u1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?L9(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L9(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function h1(e,t){if(typeof e=="string")return e;const{proxy:r,host:o,port:c}=e;if(t){const u=te("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const Sre=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Tre=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,bre=/wss:\/\/(.+):([0-9]+)\/?/,wre=/wss:\/\/(.[^\/]+)\/?/;let Rre=0;class Cre{constructor(t,r){H(this,"id",0),H(this,"store",void 0),H(this,"recordIndex",void 0),H(this,"websockets",[]),H(this,"try443PortDuration",2e3),H(this,"forceCloseWSDuration",5e3),H(this,"try443PortTimeout",null),H(this,"forceCloseTimeout",null),H(this,"isTry443PortFailed",!1),H(this,"isNormalPortFailed",!1),H(this,"useDoubleDomain",!1),H(this,"useProxy",!1),H(this,"startTime",Date.now()),this.id=++Rre,this.try443PortDuration=te("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const r=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];x.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...c)}createWebSocket(t,r,o){this.logger("createWebSocket:",t,{isTry443Port:r,hasTimeoutDetection:o});const c=te("GATEWAY_DOMAINS"),u=Date.now(),f=[],g=c.find(I=>{var D;return Ze(D=t.host).call(D,I)});g||(this.useDoubleDomain=!1);const E=[];if(this.useDoubleDomain)c.forEach(I=>{E.push(h1(u1(u1({},t),{},{host:t.host.replace(g,I)}),r))});else{const I=u1({},t);if(r&&g){const D=c.find(V=>V!==g);D&&(I.host=I.host.replace(g,D))}E.push(h1(I,r))}try{E.forEach(I=>{const D=new WebSocket(I);D.binaryType="arraybuffer",f.push(D),this.logger("ws is connecting:",D.url)})}catch(I){if(this.logger("ws create failed"),f.forEach(D=>D.close()),f.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,r,o);if(!r&&Number(t.port)!==443)return this.createWebSocket(t,!0,o);throw new Te(K.WS_ERR,"init websocket failed! Error: ".concat(I.toString()))}const v=Rb();this.store&&this.store.recordJoinChannelService({urls:f.map(I=>I.url),service:"gateway"},this.recordIndex),f.forEach(I=>{I.onopen=()=>{this.logger("onopen: ws ".concat(I.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(D=>{D!==I&&(D.onopen=null,D.onclose=null,D.onmessage=null,D.close(),this.logger("close backup websocket: ".concat(D.url)))}),this.websockets.length=0,v.resolve(I)},I.onclose=D=>{this.logger("onclose: ws ".concat(I.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(I.readyState));const V=f.every(M=>M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING);this.logger("".concat(r?"443":"47xx"," websocket closed, all failed: ").concat(V)),V&&(r||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(D.reason)),v.reject({code:D.code,reason:nI.A_ROUND_WS_FAILED})):!r&&V&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),r?this.isTry443PortFailed=V:this.isNormalPortFailed=V},I.onmessage=D=>this.logger("".concat(I.url," onmessage: ").concat(D.data))}),this.websockets.push(...f);const S=()=>{this.websockets.forEach(I=>I.readyState!==WebSocket.OPEN&&I.close())},R=()=>{if(v.isResolved)return S();Nn().os===Fi.MAC_OS&&Br()&&S(),this.createWebSocket(t,!0,!0).then(I=>{v.resolve(I)}).catch(I=>{this.isNormalPortFailed&&v.reject(I),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(t,r,o,c){return this.useDoubleDomain=!!r,typeof t=="string"&&(t=function(u){let f,g,E;return[,f,g,E]=u.match(Sre)||[],f||([,g,E]=u.match(Tre)||[]),g&&E||([,g,E]=u.match(bre)||[]),g&&E||([,g]=u.match(wre)||[]),g||x.warning("un-destructible url: ",u),{proxy:f,host:g,port:E||"443"}}(t)),this.recordIndex=c,this.useProxy=!!t.proxy,o&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(t,!!o,!1).finally(()=>this.clearTimeout())}}function M9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}class j9 extends xr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var r;Ze(r=["tryNext","recover"]).call(r,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(qt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(qt.CONNECTED):this._state==="closed"?this.emit(qt.CLOSED):this._state==="failed"&&this.emit(qt.FAILED))}resetReconnectCount(t){x.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,r){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],f=arguments.length>5?arguments[5]:void 0;super(),H(this,"_websocketUrl",null),H(this,"connectionID",0),H(this,"currentURLIndex",0),H(this,"urls",[]),H(this,"_reconnectMode","tryNext"),H(this,"reconnectReason",void 0),H(this,"_initMutex",void 0),H(this,"name",void 0),H(this,"_state","closed"),H(this,"reconnectInterrupter",void 0),H(this,"websocket",void 0),H(this,"retryConfig",void 0),H(this,"reconnectCount",0),H(this,"forceCloseTimeout",5e3),H(this,"onlineReconnectListener",void 0),H(this,"useCompress",void 0),H(this,"tryDoubleDomain",!1),H(this,"use443PortOnly",!1),H(this,"wsInflateLength",0),H(this,"wsDeflateLength",0),H(this,"closeEstablishingWs",()=>{}),H(this,"store",void 0),H(this,"joinGatewayRecordIndex",void 0),this.store=f,this.name=t,this.retryConfig=function(R){for(var I=1;I<arguments.length;I++){var D=arguments[I]!=null?arguments[I]:{};I%2?M9(Object(D),!0).forEach(function(V){H(R,V,D[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(D)):M9(Object(D)).forEach(function(V){Object.defineProperty(R,V,Object.getOwnPropertyDescriptor(D,V))})}return R}({},r),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Ls("websocket",f?f.clientId:void 0);const{timeout:g,timeoutFactor:E}=r,v=Math.max(300,Math.floor(3*g/5)),S=Math.max(1.2,Math.floor(8*E)/10);Do.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=S),mi.on(My.NETWORK_STATE_CHANGE,(R,I)=>{R!==I&&(this.resetReconnectCount("network state change: ".concat(I," -> ").concat(R)),R===Do.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=E))})}getConnection(){return this.websocket||void 0}async init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=r,this.urls=t,this.state="connecting";try{const c=Rb(),u=this.urls[this.currentURLIndex];te("ENABLE_PREALLOC_PC")&&this.emit(k9.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(qt.CLOSED,()=>{c.reject(new Ie(K.WS_DISCONNECT))}),this.once(qt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(t,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;r?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,r){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:r})}sendMessage(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Ie(K.WS_ABORT,"websocket is not ready");try{r||(t=JSON.stringify(t)),this.websocket.send(t)}catch(o){throw new Ie(K.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var r;const o=Rb();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async S=>{var R;if(x.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Ie(K.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const I=Jo(this,qt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,D=await this.reconnectWithAction(I);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!D)return o.reject(new Ie(K.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},f=S=>{this.emit(qt.ON_MESSAGE,S)},g=S=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),te("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=te("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),t);const E=(r=this.store)===null||r===void 0?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;this._websocketUrl=h1(t);const S=await this.chooseBestWebsocketConnection(t);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=f,this.websocket.onerror=g,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},E),this.joinGatewayRecordIndex=E}catch(S){const R=this.state==="closed",I=S instanceof Ie,D=I&&S.code===K.WS_ABORT,V=I&&S.code===K.WS_ERR,M=I?S.message:S&&(S.reason||S.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(M)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:D?"aborted":"error",errors:[S]},E),R||V?(o.reject(R?new Ie(K.WS_DISCONNECT,"websocket is closed: ".concat(M)):new Ie(K.WS_ERR,"init websocket failed: ".concat(M))),V&&x.error("[".concat(this.name,"] init websocket failed: ").concat(M))):u&&u(S)}return o.promise}async reconnectWithAction(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||mi.isOnline||!mi.onlineWaiter||(this.onlineReconnectListener=mi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,r){const f=bk(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(f,"ms to reconnect websocket, mode: ").concat(t)),await tt.race([cs(f),this.onlineReconnectListener||new tt(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(f,g)=>{this.emit(qt.RECONNECT_CREATE_CONNECTION,g),await this.createWebSocketConnection(f)};try{if(t==="retry")await c(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],t)}else t==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ys(this,qt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],t))}catch(f){var u;x.error("[".concat(this.name,"] reconnect failed ").concat(f&&f.toString()));const g=f==null||(u=f.data)===null||u===void 0?void 0:u.desc;return Array.isArray(g)&&Ze(g).call(g,"dynamic key expired")?(this.emit(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,r)}return!0}}class p1 extends j9{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){const o=Rb(),c=function(f,g){return new Cre(f,g)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new Ie(K.WS_ABORT,"choose best websocket aborted"))};const u=te("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",t,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,r).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Hb extends j9{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){return new tt((o,c)=>{let u=!1;const f=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),f.forEach(V=>{V.onclose=null,V.onopen=null,V.onmessage=null,V.close()}),c(new Ie(K.WS_ABORT,"choose best websocket aborted"))};const g=te("GATEWAY_DOMAINS");let E;const v=t.indexOf("?h="),S=g.find(V=>v!==-1?Ze(t).call(t,V,v):Ze(t).call(t,V));x.debug("[choose-best-ws] currentDomain: ",S,", domains: ",g);let R=!this.tryDoubleDomain||!S;if(!R&&S){var I;const V=Date.now();try{g.forEach(M=>{const j=v===-1?t.replace(S,M):t.substr(0,v)+t.substr(v).replace(S,M),W=new WebSocket(j);W.binaryType="arraybuffer",f.push(W),x.debug("[choose-best-ws] ws is connecting:",W.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),f.forEach(j=>j.close());f.length;)f.pop();R=!0}(I=this.store)===null||I===void 0||I.recordJoinChannelService({urls:f.map(M=>M.url),service:"gateway"},r),f.forEach(M=>{M.onopen=()=>{if(u)return;const j=Date.now()-V;x.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),f.filter(W=>W!==M).forEach(W=>{x.debug("[choose-best-ws]close backup websocket: ".concat(W.url)),W.close()}),u=!0,o(M)},M.onclose=j=>{E=j,!u&&(f.find(W=>!(W.readyState===WebSocket.CLOSED||W.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),u=!0,c(E)))},M.onmessage=j=>{x.debug("[choose-best-ws]".concat(M.url," onmessage: ").concat(j.data))}}),cs(this.forceCloseTimeout).then(()=>{f.forEach(M=>{M.readyState!==WebSocket.OPEN&&M.close()})})}if(R){var D;let V;x.debug("[choose-best-ws] use single url: ",t),(D=this.store)===null||D===void 0||D.recordJoinChannelService({urls:[t],service:"gateway"},r);try{V=new WebSocket(t),f.push(V),V.binaryType="arraybuffer"}catch(M){const j=new Ie(K.WS_ERR,"init websocket failed! Error: ".concat(M.toString()));return x.error("[".concat(this.name,"]").concat(j)),void c(j)}V.onopen=()=>{o(V)},V.onclose=M=>{c(M)},V.onmessage=M=>{x.debug("[choose-best-ws]".concat(V.url," onmessage: ").concat(M.data))},cs(this.forceCloseTimeout).then(()=>{V&&V.readyState!==WebSocket.OPEN&&V.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class Are extends xr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===fr.CONNECTED?this.emit(jt.WS_CONNECTED):t===fr.RECONNECTING?this.emit(jt.WS_RECONNECTING,this._websocketReconnectReason):t===fr.CLOSED&&this.emit(jt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),H(this,"_disconnectedReason",void 0),H(this,"_websocketReconnectReason",void 0),H(this,"_connectionState",fr.CLOSED),H(this,"reconnectToken",void 0),H(this,"websocket",void 0),H(this,"openConnectionTime",void 0),H(this,"clientId",void 0),H(this,"lastMsgTime",Date.now()),H(this,"uploadCache",[]),H(this,"uploadCacheInterval",void 0),H(this,"rttRolling",new K3(5)),H(this,"pingpongTimer",void 0),H(this,"wsInflateDataTimer",void 0),H(this,"pingpongTimeoutCount",0),H(this,"joinResponse",void 0),H(this,"multiIpOption",void 0),H(this,"initError",void 0),H(this,"spec",void 0),H(this,"store",void 0),H(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(jt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===En.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===En.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Vn.UID_BANNED);break;case 15:this.close(Vn.IP_BANNED);break;case 16:this.close(Vn.CHANNEL_BANNED)}if(c._type===En.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ct.ERR_LICENSE_MISSING:this.close(Vn.LICENSE_MISSING);break;case Ct.ERR_LICENSE_EXPIRED:this.close(Vn.LICENSE_EXPIRED);break;case Ct.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Vn.LICENSE_MINUTES_EXCEEDED);break;case Ct.ERR_LICENSE_PERIOD_INVALID:this.close(Vn.LICENSE_PERIOD_INVALID);break;case Ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Vn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ct.ERR_LICENSE_ILLEGAL:this.close(Vn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new p1("gateway-".concat(this.clientId),this.spec.retryConfig,!0,te("JOIN_GATEWAY_USE_DUAL_DOMAIN"),te("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===fr.CONNECTED&&this.reconnect("retry",Es.OFFLINE)})}async request(t,r,o,c){const u=dr(6,""),f={_id:u,_type:t,_message:r},g=this.websocket.connectionID,E=()=>new tt((V,M)=>{if(this.connectionState===fr.CONNECTED)return V();const j=()=>{this.off(jt.WS_CLOSED,W),V()},W=()=>{this.off(jt.WS_CONNECTED,j),M(new Te(K.WS_ABORT))};this.once(jt.WS_CONNECTED,j),this.once(jt.WS_CLOSED,W),t!==kt.PUBLISH&&t!==kt.PUBLISH_DATASTREAM&&t!==kt.SUBSCRIBE&&t!==kt.SUBSCRIBE_DATASTREAM&&t!==kt.UNSUBSCRIBE&&t!==kt.UNSUBSCRIBE_DATASTREAM&&t!==kt.UNPUBLISH&&t!==kt.UNPUBLISH_DATASTREAM&&t!==kt.CONTROL&&t!==kt.RESTART_ICE||this.once(jt.DISCONNECT_P2P,()=>{M(new Te(K.DISCONNECT_P2P))}),t!==kt.PUBLISH&&t!==kt.RESTART_ICE||this.once(jt.ABORT_P2P_EXECUTION,()=>{M(new Te(K.DISCONNECT_P2P))})});if(this.connectionState!==fr.CONNECTING&&this.connectionState!==fr.RECONNECTING||t===kt.JOIN||t===kt.REJOIN||await E(),this.websocket.sendMessage(f,!0),c)return;const v=new tt((V,M)=>{let j=!1;const W=(le,ye)=>{j=!0,V({isSuccess:le==="success",message:ye||{}}),this.off(jt.WS_CLOSED,Y),this.off(jt.WS_RECONNECTING,Y),this.emit(jt.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(u),W);const Y=()=>{M(new Te(K.WS_ABORT,"type: ".concat(t))),this.off(jt.WS_CLOSED,Y),this.off(jt.WS_RECONNECTING,Y),this.off("res-@".concat(u),W)};this.once(jt.WS_CLOSED,Y),this.once(jt.WS_RECONNECTING,Y),cs(te("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==g||j||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(jt.REQUEST_TIMEOUT,t,r))})});let S=null;try{S=await v}catch(V){if(this.connectionState===fr.CLOSED||t===kt.LEAVE)throw new Te(K.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?V.throw():t===kt.JOIN||t===kt.REJOIN?null:(await E(),await this.request(t,r))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),I=Bb(R),D=new Te(K.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:I.desc});return I.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(R,", message: ").concat(I.desc,", action: ").concat(I.action)),R===Ct.ERR_TOO_MANY_BROADCASTERS?((t===kt.JOIN||t===kt.REJOIN)&&(this.initError=D,this.close()),D.throw()):I.action==="failed"?D.throw():I.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===Ct.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Es.MULTI_IP)):this.reconnect(I.action,Es.SERVER_ERROR),t===kt.JOIN||t===kt.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new tt(o=>{const c=u=>{(!r||r(u))&&(this.off(t,c),o(u))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Vb.WRTC_STATS,r)}upload(t,r){const o={_type:t,_message:r};try{this.websocket.sendMessage(o)}catch{const u=te("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==fr.CONNECTED)return;const f=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(f._type,f._message)},te("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const o={_type:t,_message:r};this.websocket.sendMessage(o)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new tt((r,o)=>{this.once(jt.WS_CONNECTED,()=>r(this.joinResponse)),this.once(jt.WS_CLOSED,c=>o(this.initError||new Te(K.WS_ABORT,c))),this.connectionState=fr.CONNECTING,this.websocket.init(t).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Vn.LEAVE,this.connectionState=fr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(jt.ABORT_P2P_EXECUTION);const t=await ys(this,jt.REQUEST_JOIN_INFO),r=await this.request(kt.JOIN,t);if(!r)return this.emit(jt.REPORT_JOIN_GATEWAY,nI.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(jt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Te(K.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Db(this,jt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const r=await this.request(kt.REJOIN,t);return!!r&&(this.connectionState=fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r.peers&&r.peers.forEach(o=>{this.emit(En.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(En.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(En.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(En.MUTE_AUDIO,{uid:o.uid}):this.emit(En.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(En.MUTE_VIDEO,{uid:o.uid}):this.emit(En.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(En.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(En.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(En.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(En.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(En.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleNotification(t){x.debug("[".concat(this.clientId,"] receive notification: "),t);const r=Bb(t.code);if(t.code===28&&"detail"in t&&(x.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(jt.RECOVER_NOTIFICATION,t.detail)),r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Vn.UID_BANNED),void this.close()):void this.reconnect(r.action,Es.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=te("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>te("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Es.TIMEOUT):this.request(kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-r;this.rttRolling.add(o),te("REPORT_STATS")&&this.send(kt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:r}=this.websocket.getWsInflateData();t!==0&&r!==0&&this.upload(Vb.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(qt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(jt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(qt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(qt.CLOSED,()=>{this.connectionState=fr.CLOSED}),this.websocket.on(qt.FAILED,()=>{this._disconnectedReason=Vn.NETWORK_ERROR,this.connectionState=fr.CLOSED}),this.websocket.on(qt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===fr.CONNECTED?this.connectionState=fr.RECONNECTING:this.connectionState=fr.CONNECTING}),this.websocket.on(qt.WILL_RECONNECT,(t,r,o)=>{const c=Db(this,jt.IS_P2P_DISCONNECTED),u=c||t!=="retry";c&&t==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",r=nI.P2P_DISCONNECTED),u&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(jt.REPORT_JOIN_GATEWAY,r||nI.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(jt.DISCONNECT_P2P)),o(t)}),this.websocket.on(qt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Es.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(jt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Te){if(t.code===K.UNEXPECTED_RESPONSE&&t.data.code===Ct.ERR_NO_AUTHORIZED)return this.initError=new Te(K.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Vn.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Es.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(qt.REQUEST_NEW_URLS,(t,r)=>{ys(this,jt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(k9.PRE_CONNECT_PC,()=>{this.emit(jt.PRE_CONNECT_PC)})}}let Ire=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),gi=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function U9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function iI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?U9(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U9(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function Rf(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(te("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function f1(e,t){e.addresses||(e.addresses=[]);const r=function(g,E){if(te("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return g.map(R=>{let{ip:I,port:D}=R;return{address:"".concat(I,":").concat(D)}});const v=te("GATEWAY_DOMAINS");let S=v[1]&&Ze(E).call(E,v[1])?1:0;return g.map(R=>{let{domain_prefix:I,port:D,ip:V}=R;if(I)return{address:"".concat(I,".").concat(v[S++%v.length],":").concat(D)};const M=/^[\.\:\d]+$/.test(V),j=M?"".concat(V.replace(/[^\d]/g,"-"),".").concat(v[S++%v.length],":").concat(D):"".concat(V,":").concat(D);return M||x.debug("Cannot recognized as ip address: ".concat(V,", use as host")),{ip:V,port:D,address:j}})}(e.addresses,t),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const g=o.split(";");for(let E=0;E<g.length;E++){var c;const v=aa(c=g[E]).call(c);r[E]&&v&&(r[E].ip6=v)}}const u=e.detail&&e.detail.candidate;let f;if(u){const[g,E]=u.split(":");g&&E&&(f={port:Number(E),ip:g,address:"".concat(g,":").concat(E)})}return{gatewayAddrs:r,apGatewayAddress:f,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function xo(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function V9(e){const t=e._encoderConfig;if(!t)return{};const r={resolution:t.width&&t.height?"".concat(xo(t.width),"x").concat(xo(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function F9(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Gb(e,t){let r,o,c;switch(t){case gi.CHOOSE_SERVER:o=4096,c="choose server";break;case gi.CLOUD_PROXY:o=1048576,c="proxy";break;case gi.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case gi.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Te(K.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(r={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(f=>iI(iI({},f),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:iI(iI({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!r)throw new Te(K.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function B9(e,t){return await tt.all(e.addresses.map(async r=>({address:te("USE_TURN_IP")?r.ip:Rf(r.ip),tcpport:r.port,udpport:r.port,username:t&&te("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():vs.username,password:t&&te("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Ek(t.toString()):vs.password})))}function m1(e,t){const r=t.getMediaStreamTrack(!0).getSettings(),o=t.videoHeight||r.height,c=t.videoWidth||r.width;return o&&c?Math.max(Math.min(o,c)/Math.min(xo(e.height),xo(e.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Cf(e){let{candidateType:t,relayProtocol:r,type:o,address:c,port:u,protocol:f}=e;const g={candidateType:t,relayProtocol:r,protocol:f};if(o!=="local-candidate"){const E=c.split(".");E.length>=4&&(E[1]="*",E[2]="*"),g.address=E.join("."),g.port=u}return g}function sI(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:te("SVC_MODE");if(te("ENABLE_SVC"))return function(t){return t in LA}(e)?e:LA.L1T3}const H9={[lt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[lt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function aI(e,t,r){t.forEach(o=>{var c;const u=H9[e].find(g=>{var E;let{key:v}=g;return Ze(E=o.extensionName).call(E,v)});if(!u)return;const f=r.find(g=>{let{extensionName:E}=g;return Ze(E).call(E,u.key)});f&&Ze(c=f.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=f.extensionName)})}function iv(e,t){t.forEach(r=>{var o;const c=H9[e].find(u=>{var f;let{key:g}=u;return Ze(f=r.extensionName).call(f,g)});Ze(o=r.extensionName).call(o,"gdpr_forbidden")&&c&&(r.extensionName=c.extensionName)})}function G9(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Ze(e).call(e,"abs-send-time")}function oI(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Ze(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function W9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function z9(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?W9(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W9(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function Wb(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:f,filterAudioCodec:g,filterVideoCodec:E}=t,{useXR:v}=r;let S=[],R=[],I=[],D=[],V=!1,M=!1;if(no(e).mediaDescriptions.forEach(W=>{o&&o!==W.attributes.direction||(W.media.mediaType!=="video"||V||(R=W.attributes.payloads,D=W.attributes.extmaps,V=!0),W.media.mediaType!=="audio"||M||(S=W.attributes.payloads,I=W.attributes.extmaps,M=!0))}),!D||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!I||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(W=>{var Y;(Y=W.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(W.rtpMap.clockRate=parseInt(W.rtpMap.clockRate)),v&&W.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(W=>{var Y;(Y=W.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(W.rtpMap.clockRate=parseInt(W.rtpMap.clockRate)),v&&W.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(W=>{var Y;return((Y=W.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"}),R=R.filter(W=>{var Y;return((Y=W.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"})),u&&(R=R.filter(W=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=W.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),f&&(S=S.filter(W=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=W.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),g&&(g==null?void 0:g.length)>0&&(S=S.filter(W=>{var Y;return Ze(g).call(g,((Y=W.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())||"")})),E&&(E==null?void 0:E.length)>0){const W=R.filter(Y=>{var le;return Ze(E).call(E,((le=Y.rtpMap)===null||le===void 0?void 0:le.encodingName.toLowerCase())||"")});R=W.concat(c?[]:E1(W,R))}const j=te("UNSUPPORTED_VIDEO_CODEC");return j&&j.length>0&&(R=R.filter(W=>!(W.rtpMap&&Ze(j).call(j,W.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:R,audioExtensions:I,videoExtensions:D}}function Af(e){const t=no(e);let r,o;for(const c of t.mediaDescriptions){if(!r){const u=c.attributes.iceUfrag,f=c.attributes.icePwd;if(!u||!f)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:u,icePwd:f}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&t.attributes.fingerprints.length>0&&(o={fingerprints:t.attributes.fingerprints}),!o||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:o}}function Y9(e,t){const r=[],o=e.attributes.ssrcGroups.filter(f=>f.semantic==="FID"),c=e.attributes.ssrcGroups.find(f=>f.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(f=>{var g;const E=(g=o.find(v=>v.ssrcIds[0]===f))===null||g===void 0?void 0:g.ssrcIds[1];r.push({ssrcId:f,rtx:t?E:void 0})});else if(o.length>0){const f=o[0].ssrcIds[0],g=o[0].ssrcIds[1];r.push({ssrcId:f,rtx:t?g:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:u[0].ssrcId})}return r}function q9(e,t,r){const{cname:o}=e;let c=[];t&&(c=K9(t)),c.length===0&&(c=e.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),x.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},f={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let g;switch(e.dtlsParameters.role){case"server":g="passive";break;case"client":g="active";break;case"auto":g="actpass"}const E=lI(e.rtpCapabilities),v=[];return Array.isArray(r)&&r.length>0&&r.forEach(S=>{v.push({kind:lt.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:lt.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:f,candidates:c,rtpCapabilities:E,setup:g,cname:o,preSSRCs:v}}function K9(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function zg(e,t,r){const o=[],c=[];return e.forEach(u=>{let{ssrcId:f,rtx:g}=u;const E=dr(8,"track-"),v={ssrcId:f,attributes:z9({label:E,mslabel:r=r||dr(10,""),msid:"".concat(r," ").concat(E)},t&&{cname:t})};if(o.push(v),g!==void 0){const S={ssrcId:g,attributes:z9({label:E,mslabel:r,msid:"".concat(r," ").concat(E)},t&&{cname:t})};o.push(S),c.push({semantic:"FID",ssrcIds:[f,g]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:f}=u;return f})}),{ssrcs:o,ssrcGroups:c}}function sv(e,t){t instanceof Xr&&e.attributes.payloads.forEach(r=>{var o;const c=(o=r.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;r.fmtp||(r.fmtp={parameters:{}}),c==="opus"&&typeof te("OPUS_PTIME")=="number"?r.fmtp.parameters.ptime=te("OPUS_PTIME"):r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";const u=t._encoderConfig;u&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Br()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1")),t instanceof jb&&c==="opus"&&t._config.DTX&&(r.fmtp.parameters.usedtx="1"))})}function g1(e){const t=e.attributes.unrecognized.findIndex(r=>r.attField==="x-google-flag"&&r.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function _1(e,t){var r;if(!(t instanceof Er&&t._encoderConfig&&t._hints.indexOf(er.SCREEN_TRACK)===-1))return;const o=t._encoderConfig;On().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,f;Ze(u=["h264","h265","vp8","vp9","av1"]).call(u,((f=c.rtpMap)===null||f===void 0?void 0:f.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),On().supportMinBitrate&&!Ze(r=t._hints).call(r,er.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,f;Ze(u=["h264","h265","vp8","vp9","av1"]).call(u,((f=c.rtpMap)===null||f===void 0?void 0:f.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(te("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function X9(e){if(e.media.mediaType!=="video")return;const t=Nn();if(t.name!==Mn.SAFARI&&t.os!==Fi.IOS)return;const r=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));r!==-1&&e.attributes.extmaps.splice(r,1)}function cI(e,t,r){if(!t)return;let o,c;if(e.media.mediaType==="video"?(o=r.videoExtensions,c=r.videoCodecs):(o=r.audioExtensions,c=r.audioCodecs),t.twcc===!0){const u=o.find(f=>oI(f.extensionName));if(u){const f=u.extensionName;e.attributes.extmaps.find(E=>oI(E.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:f}),function(E,v){return v.filter(S=>!!E.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(I=>I.type==="transport-cc")))}(c,e.attributes.payloads).forEach(E=>{E.rtcpFeedbacks.find(v=>v.type==="transport-cc")||E.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const u=e.attributes.extmaps.findIndex(f=>oI(f.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(f=>{const g=f.rtcpFeedbacks.findIndex(E=>E.type==="transport-cc");g!==-1&&f.rtcpFeedbacks.splice(g,1)})}if(t.remb===!0){const u=o.find(f=>G9(f.extensionName));if(u){const f=u.extensionName;e.attributes.extmaps.find(E=>E.extensionName===f)||e.attributes.extmaps.push({entry:u.entry,extensionName:f}),function(E,v){return v.filter(S=>!!E.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(I=>I.type==="goog-remb")))}(c,e.attributes.payloads).forEach(E=>{E.rtcpFeedbacks.find(v=>v.type==="goog-remb")||E.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const u=e.attributes.extmaps.findIndex(f=>G9(f.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(f=>{const g=f.rtcpFeedbacks.findIndex(E=>E.type==="goog-remb");g!==-1&&f.rtcpFeedbacks.splice(g,1)})}}function Q9(e,t,r){if(Br()||e.media.mediaType!=="video"||!(t instanceof Er)||r!=="vp9"&&r!=="vp8"||r==="vp8"&&!te("SIMULCAST")||r==="vp9"&&te("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const o=r==="vp8"?2:t._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(g=>g.semantic==="FID"&&g.ssrcIds[0]===c.ssrcId),f={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let g=1;g<o;g++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+g,attributes:Pr(c.attributes)}),f.ssrcIds.push(c.ssrcId+g),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+g,attributes:Pr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+g,u.ssrcIds[1]+g]}));e.attributes.ssrcGroups.unshift(f)}async function $9(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const o=(await r.createOffer()).sdp,{send:c,recv:u,sendrecv:f}=function(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const S=Wb(v,g,E,"sendonly"),R=Wb(v,g,E,"recvonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},V={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bl(S,R,"videoExtensions",I,D,V),bl(S,R,"videoCodecs",I,D,V),bl(S,R,"audioExtensions",I,D,V),bl(S,R,"audioCodecs",I,D,V),te("RAISE_H264_BASELINE_PRIORITY")){const M=[],j=[];V.videoCodecs.forEach((W,Y)=>{var le;if(((le=W.rtpMap)===null||le===void 0?void 0:le.encodingName.toLocaleLowerCase())==="h264"){var ye,Ee;const me=V.videoCodecs[Y+1],Ae=me&&n6(W,me),Pe=(ye=W.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"],$e=(Ee=W.fmtp)===null||Ee===void 0?void 0:Ee.parameters["packetization-mode"];!Pe||Pe!==te("FIRST_H264_PROFILE_LEVEL_ID")||te("FIRST_PACKETIZATION_MODE")&&$e!==te("FIRST_PACKETIZATION_MODE")?Ae?j.push([W,me]):j.push([W]):Ae?M.push([W,me]):M.push([W])}}),M.length>0&&j.length>0&&(x.debug("raising H264 baseline profile priority"),V.videoCodecs.forEach((W,Y)=>{var le;if(((le=W.rtpMap)===null||le===void 0?void 0:le.encodingName.toLocaleLowerCase())==="h264"){const ye=n6(W,V.videoCodecs[Y+1]),Ee=M.shift()||j.shift()||[];Ee.length>0&&(ye?V.videoCodecs.splice(Y,2,...Ee):V.videoCodecs.splice(Y,1,...Ee))}}),D.videoCodecs=D.videoCodecs.filter(W=>{var Y,le;return!(((Y=W.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((le=W.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"])!==te("FIRST_H264_PROFILE_LEVEL_ID"))}),te("FILTER_SEND_H264_BASELINE")&&(I.videoCodecs=I.videoCodecs.filter(W=>{var Y,le;return!(((Y=W.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((le=W.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"])!==te("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:I,recv:D,sendrecv:V}}(e,t,o);try{r.close()}catch{}return{send:c,recv:u,sendrecv:f}}function J9(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Wb(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bl(e,t,"videoExtensions",r,o,c),bl(e,t,"videoCodecs",r,o,c),bl(e,t,"audioExtensions",r,o,c),bl(e,t,"audioCodecs",r,o,c),te("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(f=>f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&f.fmtp&&f.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const f=c.videoCodecs.findIndex(g=>g.rtpMap&&g.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(f<u){x.debug("raising H264 baseline profile priority");const g=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(f,0,g)}f!==-1&&(o.videoCodecs=o.videoCodecs.filter(g=>!(g.rtpMap&&g.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&g.fmtp&&g.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:r,recv:o,sendrecv:c}}function bl(e,t,r,o,c,u){if(r==="videoExtensions"||r==="audioExtensions"){const f=[];return e[r].forEach(g=>{t[r].some((E,v)=>{if(g.entry===E.entry&&g.extensionName===E.extensionName)return f.push(v),!0})?u[r].push(g):o[r].push(g)}),void t[r].forEach((g,E)=>{f.indexOf(E)===-1&&c[r].push(g)})}if(r==="videoCodecs"||r==="audioCodecs"){const f=[];return e[r].forEach(g=>{t[r].some((E,v)=>{if(g.payloadType===E.payloadType&&JSON.stringify(g)===JSON.stringify(E))return f.push(v),!0})?u[r].push(g):o[r].push(g)}),void t[r].forEach((g,E)=>{f.indexOf(E)===-1&&c[r].push(g)})}}function lI(e){const{send:t,recv:r,sendrecv:o}=e;if(!o){if(!t||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:r}}let c,u;return t?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...t.audioCodecs,...o.audioCodecs],c.videoCodecs=[...t.videoCodecs,...o.videoCodecs],c.audioExtensions=[...t.audioExtensions,...o.audioExtensions],c.videoExtensions=[...t.videoExtensions,...o.videoExtensions]):c=o,r?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...r.audioCodecs,...o.audioCodecs],u.videoCodecs=[...r.videoCodecs,...o.videoCodecs],u.audioExtensions=[...r.audioExtensions,...o.audioExtensions],u.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function av(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var r;return((r=t.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function zb(e,t,r,o){let c=[];if(e===lt.VIDEO){if(te("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=t.videoCodecs.filter(u=>{var f;return Ze(f=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(f,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===te("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const f=[],g=[],E=[];if(r.videoCodecs.forEach(v=>{const S=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";Ze(S).call(S,o)?u.push(v):Ze(S).call(S,"vp9")?f.push(v):Ze(S).call(S,"vp8")?g.push(v):Ze(S).call(S,"h264")&&E.push(v)}),u.length===0){let v="";f.length!==0?(u=f,v="vp9"):g.length!==0?(u=g,v="vp8"):E.length!==0&&(u=E,v="h264"),x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}u.length!==0&&(c=t.videoCodecs.filter(v=>u.some(S=>S.payloadType===v.payloadType)))}if(c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),c=t.videoCodecs),te("USE_PUB_RTX")||te("USE_SUB_RTX")){const u=E1(c,t.videoCodecs);c=[...c,...u]}}else{c=t.audioCodecs.filter(f=>{var g;return Ze(g=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"").call(g,o)});const u=t.audioCodecs.filter(f=>{var g;return Ze(g=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"").call(g,"red")});c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=t.audioCodecs.filter(f=>{var g;return Ze(g=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"").call(g,"opus")})),te("ENABLE_AUDIO_RED")&&u.length!==0&&(c=[...u,...c])}return c}function E1(e,t){const r=e.map(o=>o.payloadType.toString());return t.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&Ze(r).call(r,o.fmtp&&o.fmtp.parameters.apt))}async function Yb(e,t,r){const o=t.toString(),c=e6(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let f=u.sdp;f=Z9(f,r||{}),c==null||c(f||""),await e.setLocalDescription({type:"answer",sdp:f})}function Z9(e,t,r){const o=no(e),{useXR:c}=t;return o.mediaDescriptions.forEach(u=>{var f;u.attributes.mid&&(Array.isArray(r)&&!Ze(r).call(r,u.attributes.mid)||(u.media.mediaType==="audio"&&av(u),c&&Ze(f=["audio","video"]).call(f,u.media.mediaType)&&u.attributes.payloads.forEach(g=>{g.rtcpFeedbacks.findIndex(E=>E.type==="rrtr")===-1&&g.rtcpFeedbacks.push({type:"rrtr"})})))}),Tf(o)}function e6(e,t,r,o){if(te("SDP_LOGGING"))return x.upload("exchanging ".concat(r," ").concat(t," SDP during P2PConnection.").concat(o,`
`),e),t==="offer"?c=>{e6(c,"answer",r==="local"?"remote":"local",o)}:void 0}function t6(e){const t=te("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(r=>Ze(e).call(e,r))}function n6(e,t){try{var r;return((r=e.fmtp)===null||r===void 0?void 0:r.parameters.apt)===t.payloadType.toString()}catch{return!1}}function r6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Po(e,t){return typeof te(e)===t?te(e):void 0}function Nre(){try{const e=te("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?r6(Object(o),!0).forEach(function(c){H(t,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):r6(Object(o)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(o,c))})}return t}({},e)}catch(e){return x.debug("handle gateway attributes failed: ",e),{}}}const i6={};function If(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(e.name)),i6[e.name]=e}function Yh(e){const t=i6[e];if(!t)throw new Ie(K.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function s6(e,t){return Yh("DataStream").create(e,t)}function dI(){return Yh("InterceptFrame").create()}function a6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Eu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?a6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const y1=new Map;class Ore extends xr{get state(){return this._state}set state(t){if(t===this._state)return;const r=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Ki.CONNECTION_STATE_CHANGE,t,r,this._disconnectedReason):this.emit(Ki.CONNECTION_STATE_CHANGE,t,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,r){var o,c,u;super(),H(this,"store",void 0),H(this,"joinInfo",void 0),H(this,"key",void 0),H(this,"ntpOffset",0),H(this,"signal",void 0),H(this,"role",void 0),H(this,"inChannelInfo",{joinAt:null,duration:0}),H(this,"spec",void 0),H(this,"_state","DISCONNECTED"),H(this,"_statsCollector",void 0),H(this,"_disconnectedReason",void 0),H(this,"isSignalRecover",!1),H(this,"hasChangeBGPAddress",!1),H(this,"trafficStatsInterval",void 0),H(this,"networkQualityInterval",void 0),H(this,"_joinGatewayStartTime",0),H(this,"_signalTimeout",!1),H(this,"_clientRoleOptions",void 0),H(this,"_isProactiveJoin",!1),this.store=t,this.spec=r,this.signal=this.store.useP2P?(o={spec:Eu(Eu({},r),{},{retryConfig:r.websocketRetryConfig}),store:t},(c=(u=Yh("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new Are(Eu(Eu({},r),{},{retryConfig:r.websocketRetryConfig}),t),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}async join(t,r,o){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=y1.get(t.cname);if(u||(u=new Map,y1.set(t.cname,u)),this._isProactiveJoin=!0,u.has(t.uid)){const v=new Te(K.UID_CONFLICT);throw St.joinGateway(t.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),v}u.set(t.uid,!0),this.joinInfo=t,this.key=r;let f=0;this.joinGatewayStartTime=c;const g=t.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(f));const v=t.gatewayAddrs.map(S=>{let{address:R}=S;const[I,D]=R.split(":"),V={host:I,port:D};return t.proxyServer&&(V.proxy=t.proxyServer),V});f=(await this.signal.init(v)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(f," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var E;throw x.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),St.joinGateway(t.sid,{lts:c,succ:!1,ec:((E=v.data)===null||E===void 0?void 0:E.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!g,signalChannel:"0",preload:t.preload}),u.delete(t.uid),this.signal.close(),v}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(v=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Ki.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Ki.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Ki.NETWORK_QUALITY,{uplinkNetworkQuality:F9(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:F9(this._statsCollector.trafficStats.B_dnq)}):this.emit(Ki.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),f}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){r!==Vn.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==fr.CONNECTED||await function(o,c){return c===1/0?o:tt.race([o,ene(c)])}(this.signal.request(kt.LEAVE,void 0,!0),3e3)}catch(o){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(r),r!==Vn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,r,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:r,mode:this.spec.mode,extend:te("PUB_EXTEND"),twcc:!!te("PUBLISH_TWCC"),rtx:!!te("USE_PUB_RTX")};try{return(await this.signal.request(kt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(t,r),this.publish(t,r,!1);throw u}}async publishDataChannel(t,r,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:(c=r.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:r.channelId,metadata:r.metadata};try{await this.signal.request(kt.PUBLISH_DATASTREAM,u,!0)}catch(f){if(o&&f.data&&f.data.code===Ct.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),f.toString()),await this.tryUnpubDataChannelBeforeRepub(t,r),this.publishDataChannel(t,r,!1);throw f}}async unpublish(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(kt.UNPUBLISH,{stream_id:r,ortc:t},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await tt.all(t.map(r=>this.signal.request(kt.UNPUBLISH_DATASTREAM,{channel_id:r},!0)))}catch(r){x.warning("unpublish datachannels warning: ",r)}}async presubscribe(t,r,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:t,stream_type:r,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!te("SUBSCRIBE_TWCC"),rtx:!!te("USE_SUB_RTX")||void 0,extend:te("SUB_EXTEND"),svc:Array.isArray(te("SVC"))&&te("SVC").length!==0?te("SVC"):void 0};try{return await this.signal.request(kt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(t,r,!1);throw u}}async subscribe(t,r,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:t,stream_type:r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!te("SUBSCRIBE_TWCC"),rtx:!!te("USE_SUB_RTX"),extend:te("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(te("SVC"))&&te("SVC").length!==0?te("SVC"):void 0};try{return(await this.signal.request(kt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(t,r),await this.subscribe(t,r,!1);throw u}}async subscribeDataChannel(t,r,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:t,stream_id:r.id,channel_id:r.datachannelId};try{return void await this.signal.request(kt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(t,r),await this.subscribeDataChannel(t,r,!1);throw u}}async subscribeAll(t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!te("USE_SUB_RTX"),twcc:!!te("SUBSCRIBE_TWCC"),svc:Array.isArray(te("SVC"))&&te("SVC").length!==0?te("SVC"):void 0};try{return await this.signal.request(kt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(r&&c.data&&c.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw c}}async setVideoProfile(t){const r=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,f=o.height,g=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(g=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(g=!1)),typeof f!="number"&&(f=f.exact||f.ideal||f.max||f.min||0,c||(g=!1)),g?{stream_type:0,width:u,height:f,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(t);if(r)return this.signal.request(kt.SET_VIDEO_PROFILE,r);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,r){try{await this.signal.request(kt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:r},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await tt.all(t.map(o=>this.signal.request(kt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:r},!0)))}catch(o){x.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(t){try{await this.signal.request(kt.UNSUBSCRIBE_STREAMS,t,!0)}catch(r){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),r)}}async reconnectPC(t){const{iceParameters:r,dtlsParameters:o,rtpCapabilities:c}=t;return{gatewayEstablishParams:await this.signal.request(kt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(kt.GATEWAY_INFO)}async renewToken(t){await this.signal.request(kt.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,r){r&&(this._clientRoleOptions=Object.assign({},r)),te("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(te("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},te("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,r){if(r&&(this._clientRoleOptions=Object.assign({},r)),te("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},te("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(te("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let o,c=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(kt.SET_CLIENT_ROLE,{role:t,level:c,delay:o,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,r){await this.signal.request(kt.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:r})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(kt.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,r){await this.signal.request(kt.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:r})}async pickSVCLayer(t,r){await this.signal.request(kt.PICK_SVC_LAYER,{stream_id:t,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}async setRTM2Flag(t){await this.signal.request(kt.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,r,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,r,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Eu({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(kt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=y1.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(r){let o;return o=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:vs.username,password:vs.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Eu(Eu({},vs),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(kt.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(r=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===r.peer_uid);o&&o.B_st!==r.B_st&&DA(()=>{this.emit(Ki.STREAM_TYPE_CHANGE,r.peer_uid,r.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var r;if(!this.joinInfo||!this.key)throw new Te(K.UNEXPECTED_ERROR,"can not generate join message, no join info");const o=Object.assign({},this.joinInfo.apResponse);let c=te("REPORT_APP_SCENARIO");if(typeof c!="string")try{c=JSON.stringify(c)}catch{c=void 0}var u;c&&c.length>128&&(c=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Ki.UPDATE_GATEWAY_CONFIG),u=this.store.clientId,Ze(Zy).call(Zy,u)||Zy.push(u);const f=!(Br()||b3(87)||h4())&&typeof te("ENABLE_PRE_SUB")=="boolean"&&te("ENABLE_PRE_SUB"),g=!h4()&&Po("ENABLE_PREALLOC_PC","boolean"),E=Nre(),v=Cb(87)||function(){const R=Nn();if(R.name!==Mn.SAFARI||!R.browserVersion)return!1;const I=R.browserVersion.split(".");return Number(I[0])>15||Number(I[0])===15&&Number(I[1])>=4}(),S=Eu({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ic,browser:navigator.userAgent,process_id:te("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:o,extend:te("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:c,attributes:{userAttributes:Eu(Eu({enableEncodedTransform:!!te("ENABLE_AUDIO_METADATA")&&v||!!te("ENABLE_AUDIO_TOPN")&&dk(Mn.CHROME,87,116)||void 0,enableAudioMetadata:!!te("ENABLE_AUDIO_METADATA")&&v,enableAudioPts:!!te("ENABLE_AUDIO_PTS_METADATA")&&v,topnSmoothLevel:te("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:te("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:te("TOPN_SWITCH_HOLD_MS"),topnAudioGain:te("TOPN_AUDIO_GAIN"),enablePublishedUserList:te("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:te("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Po("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Po("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Po("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:te("USE_PUB_RTX")===!0||te("USE_SUB_RTX")===!0||void 0,disableFEC:te("DISABLE_FEC"),enableNTPReport:!!te("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!te("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!te("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Po("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!te("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!te("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Po("USE_XR","boolean"),enableLossbasedBwe:Po("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!te("ENABLE_AUT_CC")||void 0,enableCCFallback:Po("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:g,preSubNum:f?Po("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Po("PUBLISH_TWCC","boolean"),enableSubTWCC:Po("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Po("USE_PUB_RTX","boolean"),enableSubRTX:Po("USE_SUB_RTX","boolean"),enableSubSVC:te("ENABLE_SVC")?te("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(te("SVC"))&&te("SVC").length!==0?te("SVC"):void 0,enableSvcExtended:te("ENABLE_SVC")&&Array.isArray(te("SVC_EXTENDED"))&&te("SVC_EXTENDED").length!==0?te("SVC_EXTENDED"):void 0},E),{},{audioDuplicate:Po("ENABLE_AUDIO_RED","boolean")?(r=Po("AUDIO_DUPLICATE_NUM","number"))!==null&&r!==void 0?r:2:void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(S.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(S.aes_mode=this.joinInfo.aesmode,te("ENCRYPT_AES")?(S.aes_secret=this.joinInfo.aespassword,S.aes_encrypt=!0):S.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(S.aes_salt=this.joinInfo.aessalt)),o.addresses[this.signal.websocket.currentURLIndex]&&(S.ap_response.ticket=o.addresses[this.signal.websocket.currentURLIndex].ticket,delete o.addresses),this.joinInfo.defaultVideoStream!==void 0&&(S.default_video_stream=this.joinInfo.defaultVideoStream),S}getRejoinMessage(){if(!this.joinInfo)throw new Te(K.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(jt.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(jt.WS_RECONNECTING,t=>{this.joinInfo&&St.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Es.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",St.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(jt.WS_CLOSED,t=>{let r;switch(t){case Vn.LEAVE:r=Es.LEAVE;break;case Vn.UID_BANNED:case Vn.IP_BANNED:case Vn.CHANNEL_BANNED:case Vn.SERVER_ERROR:r=Es.SERVER_ERROR;break;case Vn.FALLBACK:r=Es.FALLBACK;break;case Vn.LICENSE_MISSING:case Vn.LICENSE_EXPIRED:case Vn.LICENSE_MINUTES_EXCEEDED:case Vn.LICENSE_PERIOD_INVALID:case Vn.LICENSE_MULTIPLE_SDK_SERVICE:case Vn.LICENSE_ILLEGAL:case Vn.TOKEN_EXPIRE:r=t;break;default:r=Es.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(r||"undefined -> "+Es.NETWORK_ERROR)),this.joinInfo&&St.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Vn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this._disconnectedReason=t,t!==Vn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(jt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=te("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(St.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Kn("EVENT_REPORT_DOMAIN",t[1]),Kn("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Kn("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(En.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(jt.REQUEST_RECOVER,(t,r,o)=>{if(!this.joinInfo)return o(new Te(K.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ys(this,Ki.REQUEST_NEW_GATEWAY_LIST).then(r).catch(o)}),this.signal.on(jt.REQUEST_JOIN_INFO,async(t,r,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const u=Pr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(te("NEW_TURN_MODE")&&u){let v=u.servers,S=u.serversFromGateway;const R=this.signal.currentURLIndex;v.length>0&&(v=[v[R%v.length]],u.servers=v),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:f,dtlsParameters:g,rtpCapabilities:E}=await ys(this,Ki.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{t(this.getJoinMessage({ortc:{iceParameters:f,dtlsParameters:g,rtpCapabilities:E,version:"2"}}))}catch(v){r(v)}}),this.signal.on(jt.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(jt.REPORT_JOIN_GATEWAY,(t,r)=>{if(!this.joinInfo)return;let o,c="";var u;t instanceof Te?(o=((u=t.data)===null||u===void 0?void 0:u.desc)||t.code,c=t.message):o=t,St.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(jt.IS_P2P_DISCONNECTED,t=>{t(Db(this,Ki.IS_P2P_DISCONNECTED))}),this.signal.on(jt.DISCONNECT_P2P,()=>{this.emit(Ki.DISCONNECT_P2P)}),this.signal.on(jt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(jt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(jt.JOIN_RESPONSE,t=>{const r=this.getCurrentGatewayAddress();this.emit(Ki.JOIN_RESPONSE,t,r)}),this.signal.on(jt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const t=this.getCurrentGatewayAddress(),r=te("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(t&&r){const o=K9(t);this.emit(Ki.PRE_CONNECT_PC,{candidates:o,fingerprint:r})}}}),this.signal.on(jt.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof te("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(te("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,r){try{await this.signal.request(kt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[r]},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(t,r){try{await this.signal.request(kt.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(o){throw x.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(t,r){try{await this.signal.request(kt.UNPUBLISH,{stream_id:t,ortc:r},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(t,r){try{await this.signal.request(kt.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(o){throw x.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(t){const r={users:t.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(kt.UNSUBSCRIBE_STREAMS,r,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(t,r){const o={action:t.find(c=>c.stream_type===Hn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(kt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(t,r){const o={action:t.find(c=>c.stream_type===Hn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(kt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(t,r){const o={action:t===lt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(kt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(t,r){const o={action:t===lt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(kt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,r){this.signal.upload(t,r)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(kt.RESTART_ICE,r,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(t,r){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,r||Es.P2P_FAILED)}getCurrentGatewayAddress(){var t,r;if(!te("GATEWAY_WSS_ADDRESS"))return te("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(r=this.joinInfo)!==null&&r!==void 0&&r.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(kt.SET_PARAMETER,{enablePublishAudioFilter:t})}}let uI=0,v1=0;function md(e,t,r,o){return new tt((c,u)=>{t.timeout=t.timeout||te("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),uI+=hu(t.data)):r&&(t.data.size?uI+=t.data.size:t.data instanceof FormData?uI+=B3(t.data):uI+=hu(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,ka.request(t).then(f=>{typeof f.data=="string"?v1+=hu(f.data):f.data instanceof ArrayBuffer||f.data instanceof Uint8Array?v1+=f.data.byteLength:v1+=hu(JSON.stringify(f.data)),o&&c({data:f.data,headers:f.headers}),c(f.data)}).catch(f=>{ka.isCancel(f)?u(new Te(K.OPERATION_ABORTED,"cancel token canceled")):f.code==="ECONNABORTED"?u(new Te(K.NETWORK_TIMEOUT,f.message)):f.response?u(new Te(K.NETWORK_RESPONSE_ERROR,f.response.status)):u(new Te(K.NETWORK_ERROR,f.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(ke){var Ye=0;return function(){return Ye<ke.length?{done:!1,value:ke[Ye++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(ke,Ye,pt){return ke==Array.prototype||ke==Object.prototype||(ke[Ye]=pt.value),ke},o,c=function(ke){ke=[typeof globalThis=="object"&&globalThis,ke,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var Ye=0;Ye<ke.length;++Ye){var pt=ke[Ye];if(pt&&pt.Math==Math)return pt}throw Error("Cannot find global object")}(this);function u(ke,Ye){if(Ye)e:{var pt=c;ke=ke.split(".");for(var Le=0;Le<ke.length-1;Le++){var L=ke[Le];if(!(L in pt))break e;pt=pt[L]}(Ye=Ye(Le=pt[ke=ke[ke.length-1]]))!=Le&&Ye!=null&&r(pt,ke,{configurable:!0,writable:!0,value:Ye})}}function f(ke){return(ke={next:ke})[Symbol.iterator]=function(){return this},ke}function g(ke){var Ye=typeof Symbol<"u"&&Symbol.iterator&&ke[Symbol.iterator];return Ye?Ye.call(ke):{next:t(ke)}}if(u("Symbol",function(ke){function Ye(L,ne){this.A=L,r(this,"description",{configurable:!0,writable:!0,value:ne})}if(ke)return ke;Ye.prototype.toString=function(){return this.A};var pt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Le=0;return function L(ne){if(this instanceof L)throw new TypeError("Symbol is not a constructor");return new Ye(pt+(ne||"")+"_"+Le++,ne)}}),u("Symbol.iterator",function(ke){if(ke)return ke;ke=Symbol("Symbol.iterator");for(var Ye="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),pt=0;pt<Ye.length;pt++){var Le=c[Ye[pt]];typeof Le=="function"&&typeof Le.prototype[ke]!="function"&&r(Le.prototype,ke,{configurable:!0,writable:!0,value:function(){return f(t(this))}})}return ke}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var E;e:{var v={};try{v.__proto__={a:!0},E=v.a;break e}catch{}E=!1}o=E?function(ke,Ye){if(ke.__proto__=Ye,ke.__proto__!==Ye)throw new TypeError(ke+" is not extensible");return ke}:null}var S=o;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function I(ke){if(ke.m)throw new TypeError("Generator is already running");ke.m=!0}function D(ke,Ye){return ke.h=3,{value:Ye}}function V(ke){this.g=new R,this.G=ke}function M(ke,Ye,pt,Le){try{var L=Ye.call(ke.g.j,pt);if(!(L instanceof Object))throw new TypeError("Iterator result "+L+" is not an object");if(!L.done)return ke.g.m=!1,L;var ne=L.value}catch(he){return ke.g.j=null,ke.g.s(he),j(ke)}return ke.g.j=null,Le.call(ke.g,ne),j(ke)}function j(ke){for(;ke.g.h;)try{var Ye=ke.G(ke.g);if(Ye)return ke.g.m=!1,{value:Ye.value,done:!1}}catch(pt){ke.g.v=void 0,ke.g.s(pt)}if(ke.g.m=!1,ke.g.l){if(Ye=ke.g.l,ke.g.l=null,Ye.F)throw Ye.D;return{value:Ye.return,done:!0}}return{value:void 0,done:!0}}function W(ke){this.next=function(Ye){return ke.o(Ye)},this.throw=function(Ye){return ke.s(Ye)},this.return=function(Ye){return function(pt,Le){I(pt.g);var L=pt.g.j;return L?M(pt,"return"in L?L.return:function(ne){return{value:ne,done:!0}},Le,pt.g.return):(pt.g.return(Le),j(pt))}(ke,Ye)},this[Symbol.iterator]=function(){return this}}function Y(ke,Ye){return Ye=new W(new V(Ye)),S&&ke.prototype&&S(Ye,ke.prototype),Ye}if(R.prototype.o=function(ke){this.v=ke},R.prototype.s=function(ke){this.l={D:ke,F:!0},this.h=this.C||this.u},R.prototype.return=function(ke){this.l={return:ke},this.h=this.u},V.prototype.o=function(ke){return I(this.g),this.g.j?M(this,this.g.j.next,ke,this.g.o):(this.g.o(ke),j(this))},V.prototype.s=function(ke){return I(this.g),this.g.j?M(this,this.g.j.throw,ke,this.g.o):(this.g.s(ke),j(this))},u("Array.prototype.entries",function(ke){return ke||function(){return function(Ye,pt){Ye instanceof String&&(Ye+="");var Le=0,L=!1,ne={next:function(){if(!L&&Le<Ye.length){var he=Le++;return{value:pt(he,Ye[he]),done:!1}}return L=!0,{done:!0,value:void 0}}};return ne[Symbol.iterator]=function(){return ne},ne}(this,function(Ye,pt){return[Ye,pt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var le=function(ke,Ye){for(var pt=0;pt<ke.length;pt++)Ye(ke[pt])},ye=function(ke){return ke.replace(/\r?\n|\r/g,`\r
`)},Ee=function(ke,Ye,pt){return Ye instanceof Blob?(pt=pt!==void 0?pt+"":typeof Ye.name=="string"?Ye.name:"blob",Ye.name===pt&&Object.prototype.toString.call(Ye)!=="[object Blob]"||(Ye=new File([Ye],pt)),[String(ke),Ye]):[String(ke),String(Ye)]},me=function(ke,Ye){if(ke.length<Ye)throw new TypeError(Ye+" argument required, but only "+ke.length+" present.")},Ae=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Pe=Ae.FormData,$e=Ae.XMLHttpRequest&&Ae.XMLHttpRequest.prototype.send,at=Ae.Request&&Ae.fetch,nn=Ae.navigator&&Ae.navigator.sendBeacon,Xt=Ae.Element&&Ae.Element.prototype,Lt=Ae.Symbol&&Symbol.toStringTag;Lt&&(Blob.prototype[Lt]||(Blob.prototype[Lt]="Blob"),"File"in Ae&&!File.prototype[Lt]&&(File.prototype[Lt]="File"));try{new File([],"")}catch{Ae.File=function(Ye,pt,Le){return Ye=new Blob(Ye,Le||{}),Object.defineProperties(Ye,{name:{value:pt},lastModified:{value:+(Le&&Le.lastModified!==void 0?new Date(Le.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Lt&&Object.defineProperty(Ye,Lt,{value:"File"}),Ye}}var mr=function(ke){return ke.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},tr=function(ke){this.i=[];var Ye=this;ke&&le(ke.elements,function(pt){if(pt.name&&!pt.disabled&&pt.type!=="submit"&&pt.type!=="button"&&!pt.matches("form fieldset[disabled] *"))if(pt.type==="file"){var Le=pt.files&&pt.files.length?pt.files:[new File([],"",{type:"application/octet-stream"})];le(Le,function(L){Ye.append(pt.name,L)})}else pt.type==="select-multiple"||pt.type==="select-one"?le(pt.options,function(L){!L.disabled&&L.selected&&Ye.append(pt.name,L.value)}):pt.type==="checkbox"||pt.type==="radio"?pt.checked&&Ye.append(pt.name,pt.value):(Le=pt.type==="textarea"?ye(pt.value):pt.value,Ye.append(pt.name,Le))})};if((e=tr.prototype).append=function(ke,Ye,pt){me(arguments,2),this.i.push(Ee(ke,Ye,pt))},e.delete=function(ke){me(arguments,1);var Ye=[];ke=String(ke),le(this.i,function(pt){pt[0]!==ke&&Ye.push(pt)}),this.i=Ye},e.entries=function ke(){var Ye,pt=this;return Y(ke,function(Le){if(Le.h==1&&(Ye=0),Le.h!=3)return Ye<pt.i.length?Le=D(Le,pt.i[Ye]):(Le.h=0,Le=void 0),Le;Ye++,Le.h=2})},e.forEach=function(ke,Ye){me(arguments,1);for(var pt=g(this),Le=pt.next();!Le.done;Le=pt.next()){var L=g(Le.value);Le=L.next().value,L=L.next().value,ke.call(Ye,L,Le,this)}},e.get=function(ke){me(arguments,1);var Ye=this.i;ke=String(ke);for(var pt=0;pt<Ye.length;pt++)if(Ye[pt][0]===ke)return Ye[pt][1];return null},e.getAll=function(ke){me(arguments,1);var Ye=[];return ke=String(ke),le(this.i,function(pt){pt[0]===ke&&Ye.push(pt[1])}),Ye},e.has=function(ke){me(arguments,1),ke=String(ke);for(var Ye=0;Ye<this.i.length;Ye++)if(this.i[Ye][0]===ke)return!0;return!1},e.keys=function ke(){var Ye,pt,Le,L,ne=this;return Y(ke,function(he){if(he.h==1&&(Ye=g(ne),pt=Ye.next()),he.h!=3)return pt.done?void(he.h=0):(Le=pt.value,L=g(Le),D(he,L.next().value));pt=Ye.next(),he.h=2})},e.set=function(ke,Ye,pt){me(arguments,2),ke=String(ke);var Le=[],L=Ee(ke,Ye,pt),ne=!0;le(this.i,function(he){he[0]===ke?ne&&(ne=!Le.push(L)):Le.push(he)}),ne&&Le.push(L),this.i=Le},e.values=function ke(){var Ye,pt,Le,L,ne=this;return Y(ke,function(he){if(he.h==1&&(Ye=g(ne),pt=Ye.next()),he.h!=3)return pt.done?void(he.h=0):(Le=pt.value,(L=g(Le)).next(),D(he,L.next().value));pt=Ye.next(),he.h=2})},tr.prototype._asNative=function(){for(var ke=new Pe,Ye=g(this),pt=Ye.next();!pt.done;pt=Ye.next()){var Le=g(pt.value);pt=Le.next().value,Le=Le.next().value,ke.append(pt,Le)}return ke},tr.prototype._blob=function(){var ke="----formdata-polyfill-"+Math.random(),Ye=[],pt="--"+ke+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Le,L){return typeof Le=="string"?Ye.push(pt+mr(ye(L))+`"\r
\r
`+ye(Le)+`\r
`):Ye.push(pt+mr(ye(L))+'"; filename="'+mr(Le.name)+`"\r
Content-Type: `+(Le.type||"application/octet-stream")+`\r
\r
`,Le,`\r
`)}),Ye.push("--"+ke+"--"),new Blob(Ye,{type:"multipart/form-data; boundary="+ke})},tr.prototype[Symbol.iterator]=function(){return this.entries()},tr.prototype.toString=function(){return"[object FormData]"},Xt&&!Xt.matches&&(Xt.matches=Xt.matchesSelector||Xt.mozMatchesSelector||Xt.msMatchesSelector||Xt.oMatchesSelector||Xt.webkitMatchesSelector||function(ke){for(var Ye=(ke=(this.document||this.ownerDocument).querySelectorAll(ke)).length;0<=--Ye&&ke.item(Ye)!==this;);return-1<Ye}),Lt&&(tr.prototype[Lt]="FormData"),$e){var Va=Ae.XMLHttpRequest.prototype.setRequestHeader;Ae.XMLHttpRequest.prototype.setRequestHeader=function(ke,Ye){Va.call(this,ke,Ye),ke.toLowerCase()==="content-type"&&(this.B=!0)},Ae.XMLHttpRequest.prototype.send=function(ke){ke instanceof tr?(ke=ke._blob(),this.B||this.setRequestHeader("Content-Type",ke.type),$e.call(this,ke)):$e.call(this,ke)}}at&&(Ae.fetch=function(ke,Ye){return Ye&&Ye.body&&Ye.body instanceof tr&&(Ye.body=Ye.body._blob()),at.call(this,ke,Ye)}),nn&&(Ae.navigator.sendBeacon=function(ke,Ye){return Ye instanceof tr&&(Ye=Ye._asNative()),nn.call(this,ke,Ye)}),Ae.FormData=tr}})();const qb=()=>{const e=te("AREAS");return e.length===0&&e.push(jn.GLOBAL),Qa(e).call(e,(t,r,o)=>{const c=o6(r);return c?o===0?c:"".concat(t,",").concat(c):t},"")},o6=e=>e===jn.OVERSEA?"".concat(Ms.ASIA,",").concat(Ms.EUROPE,",").concat(Ms.AFRICA,",").concat(Ms.NORTH_AMERICA,",").concat(Ms.SOUTH_AMERICA,",").concat(Ms.OCEANIA):Ms[e],Dre=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(r=>{const o=rI[r],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(t[u]=t[u].concat(o[u]))})}),t},hI={GLOBAL:{ASIA:[jn.CHINA,jn.JAPAN,jn.INDIA,jn.KOREA,jn.HKMC],EUROPE:[],NORTH_AMERICA:[jn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},pI=Object.keys(hI[jn.GLOBAL]),S1=[jn.CHINA,jn.NORTH_AMERICA,jn.EUROPE,jn.ASIA,jn.JAPAN,jn.INDIA,jn.OCEANIA,jn.SOUTH_AMERICA,jn.AFRICA,jn.KOREA,jn.HKMC,jn.US],xre=function(e,t){let r=[];if(Ze(e).call(e,jn.GLOBAL)){const u=[jn.GLOBAL,jn.OVERSEA],f=Object.keys(rI);if(t===jn.GLOBAL)throw new Te(K.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===jn.CHINA)r=[jn.OVERSEA];else if(c=t,Ze(pI).call(pI,c)){const g=(o=t,hI[jn.GLOBAL][o]||[]),E=[...u,t,...g];r=f.filter(v=>!Ze(E).call(E,v))}else if(function(g){let E=!1;return pI.forEach(v=>{var S;Ze(S=hI[jn.GLOBAL][v]).call(S,g)&&(E=!0)}),E}(t)){const g=function(v){let S;return pI.forEach(R=>{var I;Ze(I=hI[jn.GLOBAL][R]).call(I,v)&&(S=R)}),S}(t),E=[...u,g,t];r=f.filter(v=>!Ze(E).call(E,v))}else r=e;r=function(g){const E=[];return S1.forEach(v=>{Ze(g).call(g,v)&&E.push(v)}),E.concat(g.filter(v=>!Ze(S1).call(S1,v)))}(r)}else r=e;var o,c;return r};function c6(e){var t,r;if(!e&&Ze(t=te("AREAS")).call(t,jn.EXTENSIONS))return x.debug("update area from ap : reset"),void T1(Fne,!0);if(!Ze(r=te("AREAS")).call(r,jn.GLOBAL)||!e)return;let o=rI.EXTENSIONS;o&&(o={CODE:o6(jn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},x.debug("update area from ap success: ".concat(e,",config is "),o),Kn("AREAS",[jn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Kn(c,o[c][0]):Kn(c,o[c])}))}function T1(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=St.reportApiInvoke(null,{name:fi.SET_AREA,options:e,tag:Gr.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!Ze(N9).call(N9,u))throw new Te(K.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:f}=e;if(!u)throw new Te(K.INVALID_PARAMS,"area code is needed");let g=u;typeof u=="string"&&(g=[u]),o=f?xre(g,f):g}if(!t){if(ud.AREAS){const u=new Te(K.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(u),void x.warning("setArea is prohibited because of config-distribute")}if(Ze(o).call(o,jn.GLOBAL)&&te("AREAS")===jn.EXTENSIONS){const u=new Te(K.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(u),void x.warning("setArea is prohibited because of ap extensions")}}Kn("AREAS",o,t);const c=Dre(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Kn(u,c[u][0]):Kn(u,c[u])}),x.debug("set area success:",o.join(","))}catch(o){throw r.onError(o),o}r.onSuccess()}function l6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function yu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?l6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let b1=1;function Pre(e,t,r,o,c){b1+=1;const u={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:b1,requestId:b1,version:Ic,cname:r.cname},f={service_name:t,json_body:JSON.stringify(u)};let g,E,v=e[0];return dd(async()=>{g=Date.now();const S=await md(v,{data:f,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(E=Date.now()-g,S.code!==0){const D=new Te(K.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:E});throw x.error(D.toString()),D}const R=JSON.parse(S.json_body);if(R.code!==200){const D=new Te(K.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:E});throw x.error(D.toString()),D}if(!R.servers||R.servers.length===0){const D=new Te(K.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:E});throw x.error(D.toString()),D}const I=function(D,V){return{addressList:D.servers.map(M=>"wss://".concat(M.address.replace(/\./g,"-"),".").concat(te("WORKER_DOMAIN"),":").concat(M.wss,"?serviceName=").concat(encodeURIComponent(V))),workerToken:D.workerToken,vid:D.vid}}(R,t);return te("LIVE_STREAMING_ADDRESS")&&(I.addressList=te("LIVE_STREAMING_ADDRESS")instanceof Array?te("LIVE_STREAMING_ADDRESS"):[te("LIVE_STREAMING_ADDRESS")]),yu(yu({},I),{},{responseTime:E})},(S,R)=>(St.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(S.addressList),firstSuccess:R===0,responseTime:E,serverIp:e[R%e.length]}),!1),(S,R)=>(St.apworkerEvent(r.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:t,responseTime:E,serverIp:e[R%e.length]}),!!(S.code!==K.OPERATION_ABORTED&&S.code!==K.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(v=e[(R+1)%e.length],!0)),c)}let w1=1;function d6(e,t,r,o){let{url:c,areaCode:u}=e;const{clientId:f,sid:g}=t,E=Date.now();let v;const S=t.role,[R,I]=C1(t,u,[gi.CHOOSE_SERVER]);let D=mi.networkState;return dd(async()=>{D&&mi.networkState===Do.OFFLINE&&mi.onlineWaiter&&await tt.race([mi.onlineWaiter,cs(o&&o.maxRetryTimeout||Ri.maxRetryTimeout)]),D=mi.networkState;const{data:V,headers:M}=await md(c,{data:R,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=M.http3==="1"?1:-1,St.reportResourceTiming(c,g),h6(V,c,t,E,[gi.CHOOSE_SERVER],v);const j=Gb(V,gi.CHOOSE_SERVER);return R1(j),f1(j,c)},V=>(V&&St.joinChooseServer(g,{role:S,lts:E,succ:!0,csAddr:c,opid:I,serverList:V.gatewayAddrs.map(M=>M.address),ec:null,cid:V.cid.toString(),uid:V.uid.toString(),csIp:V.csIp,unilbsServerIds:[gi.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:V.res.detail&&V.res.detail[38]}),!1),V=>V.code!==K.OPERATION_ABORTED&&(V.code===K.CAN_NOT_GET_GATEWAY_SERVER?V.data.retry:(St.joinChooseServer(g,{role:S,lts:E,succ:!1,csAddr:c,serverList:null,opid:I,ec:V.code,csIp:V.data&&V.data.csIp,unilbsServerIds:[gi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:D}),isHttp3:v,corssRegionTagReq:t.apRequestDetail}),x.warning("[".concat(f||"sid-".concat(g.slice(0,6)),"] Choose server network error, retry"),V),!0)),o)}function u6(e,t,r,o){let c,{url:u,areaCode:f,serviceIds:g}=e;const E=Date.now(),v=t.role,[S,R]=C1(t,f,g);let I;return dd(async()=>{I&&mi.networkState===Do.OFFLINE&&mi.onlineWaiter&&await tt.race([mi.onlineWaiter,cs(o&&o.maxRetryTimeout||Ri.maxRetryTimeout)]),I=mi.networkState;const{data:D,headers:V}=await md(u,{data:S,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=V.http3==="1"?1:-1,St.reportResourceTiming(u,t.sid),h6(D,u,t,E,g,c);const M=Gb(D,gi.CHOOSE_SERVER),j=Gb(D,t.cloudProxyServer==="proxy5"?gi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?gi.CLOUD_PROXY:gi.CLOUD_PROXY_FALLBACK);return R1(M),{gatewayInfo:f1(M,u),proxyInfo:j,url:u}},D=>(D.gatewayInfo&&St.joinChooseServer(t.sid,{role:v,lts:E,succ:!0,csAddr:u,serverList:D.gatewayInfo.gatewayAddrs.map(V=>V.address),ec:null,opid:R,cid:D.gatewayInfo.cid.toString(),uid:D.gatewayInfo.uid.toString(),csIp:D.gatewayInfo.csIp,unilbsServerIds:g.toString(),isHttp3:c,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:D.gatewayInfo.res.detail&&D.gatewayInfo.res.detail[38]}),D.proxyInfo&&St.joinWebProxyAP(t.sid,{lts:E,sucess:1,apServerAddr:u,turnServerAddrList:D.proxyInfo.addresses.map(V=>V.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:g.toString()}),!1),D=>D.code!==K.OPERATION_ABORTED&&(D.code===K.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(St.joinWebProxyAP(t.sid,{lts:E,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:D.code,eventType:t.cloudProxyServer,unilbsServerIds:g.toString(),extend:JSON.stringify({networkState:I})}),x.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),D),!0)),o)}const h6=(e,t,r,o,c,u)=>{const{sid:f,clientId:g,cloudProxyServer:E}=r,v=[],S=R=>{R.flag===4096?St.joinChooseServer(f,{role:r.role,lts:o,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:r.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||St.joinWebProxyAP(f,{lts:o,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:R.error.code,eventType:E,unilbsServerIds:c.toString()})};if(e.response_body.forEach(R=>{const I=R.buffer.code;if(R.uri===23&&I===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const D={error:new Te(K.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:R.buffer.flag};v.push(D),S(D)}if(I!==0){const D=rv(I),V={error:new Te(K.CAN_NOT_GET_GATEWAY_SERVER,D.desc,{desc:D.desc,retry:D.retry,csIp:e.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?x.warning(V.error.toString()):v.push(V),S(V)}}),v.length)throw x.warning("[".concat(g||"sid-".concat(f.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Te(K.CAN_NOT_GET_GATEWAY_SERVER,v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!v.find(R=>R.error.data.retry),csIp:e.detail[502],desc:[...new Set(v.map(R=>{var I;return R==null||(I=R.error)===null||I===void 0||(I=I.data)===null||I===void 0?void 0:I.desc}).filter(R=>!!R))]})},R1=e=>{var t,r,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Te(K.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(te("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?c6(e.detail[23].toLowerCase()):c6()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((r=e.detail)===null||r===void 0?void 0:r[19])=="string"){const f=e.detail[19],g=f==null?void 0:f.split(";");for(let E=0;E<g.length;E++){var u;const v=aa(u=g[E]).call(u);e.addresses[E]&&g&&(e.addresses[E].fingerprint=v)}}if(te("GATEWAY_ADDRESS")&&te("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",te("GATEWAY_ADDRESS"));const f=te("GATEWAY_ADDRESS").map(g=>{var E,v;const S=(E=(v=e.addresses.find(R=>R.ip===g.ip&&R.port===g.port))===null||v===void 0?void 0:v.fingerprint)!==null&&E!==void 0?E:"";return{ip:g.ip,port:g.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:S}});e.addresses=f}},kre=(e,t)=>{if(e.response_body&&e.response_body.length){const r=e.response_body[0];if(r.buffer.code!==0){const o=rv(r.buffer.code);throw new Te(K.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return r.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",t),new Te(K.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},C1=(e,t,r)=>{const o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:yu(yu(yu({6:e.stringUid,11:t,12:te("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};u.request_bodies.forEach(g=>{e.multiIP&&e.multiIP.gateway_ip&&(g.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const f=new FormData;return f.append("request",JSON.stringify(u)),[f,o]},Lre=(e,t)=>{const r=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,r]};let ov=0;function cv(e){return tt.all(e.map(t=>t.then(r=>{throw r},r=>r))).then(t=>{throw t},t=>t)}const Kb=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,f=0;const g=t;let E,v=0;const S=async()=>{const R=(()=>{const I=f*g,D=I+g;return r.slice(I,D).map(o)})();u&&u.push(...R);try{E=await cv(R)}catch(I){if(v+=g,f++,!(v>=r.length))return void await S();c(I)}R.forEach(I=>I.cancel())};return await S(),E},p6=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:o}=e;const c=t.length;let u=0;const f=async()=>{const g=r(t.shift());try{return await g}catch(E){if(u++,u>=c||o!=null&&o(E))throw E;return f()}};return f()};async function A1(e,t,r,o){return{gatewayInfo:await async function(u,f,g,E){let v=null;const S=[],R=async()=>{const D=te("WEBCS_DOMAIN").slice(0,te("AJAX_REQUEST_CONCURRENT")).map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:qb()})),V=E.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),M=await Kb({fragementLength:te("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(x.debug("[".concat(u.clientId,"] Connect to choose_server:"),j.url),d6(j,u,f,g)),allFailedhandler:j=>{throw E.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},V),j[0]},promisesCollector:S});return E.recordJoinChannelService({endTs:Date.now(),status:"success"},V),M},I=async()=>{if(await cs(1e3),v!==null)return v;const D=te("WEBCS_DOMAIN_BACKUP_LIST").map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:qb()})),V=E.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),M=await Kb({fragementLength:te("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(x.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),j.url),d6(j,u,f,g)),allFailedhandler:j=>{throw E.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},V),j[0]},promisesCollector:S});return E.recordJoinChannelService({endTs:Date.now(),status:"success"},V),M};try{return v=await cv([R(),I()]),S.length&&S.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),v}catch(D){throw D[0]}}(e,t,r,o)}}async function f6(e,t,r,o,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await A1(e,t,r,c);if(te("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:I,proxyInfo:D}=await _6(e,t,r,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:I};const V=D.map(M=>({turnServerURL:M.address,tcpport:M.tcpport||vs.tcpport,udpport:M.udpport||vs.udpport,username:M.username||vs.username,password:M.password||vs.password,forceturn:!1,security:!0}));if(c.useP2P){var f;const M=(f=e.uid)!==null&&f!==void 0?f:I.uid,j="glb:".concat(M.toString()),W=await Ek(j),Y=D.map(le=>({turnServerURL:le.address,tcpport:le.tcpport||vs.tcpport,udpport:le.udpport||vs.udpport,username:j,password:W,forceturn:!1,security:!0}));V.push(...Y)}return e.turnServer={mode:"manual",servers:V},{gatewayInfo:I}}return await A1(e,t,r,c)}const{proxyInfo:g,gatewayInfo:E}=await _6(e,t,r,c),v={gatewayInfo:E},S=g.map(I=>({turnServerURL:I.address,tcpport:u==="proxy3"?void 0:I.tcpport?I.tcpport:vs.tcpport,udpport:u==="proxy4"?void 0:I.udpport?I.udpport:vs.udpport,username:I.username||vs.username,password:I.password||vs.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;const I=(R=e.uid)!==null&&R!==void 0?R:E.uid,D="glb:".concat(I.toString()),V=await Ek(D),M=g.map(j=>({turnServerURL:j.address,tcpport:u==="proxy3"?void 0:j.tcpport||vs.tcpport,udpport:u==="proxy4"?void 0:j.udpport||vs.udpport,username:D,password:V,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...M)}return e.turnServer={mode:"manual",servers:S},x.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),v}async function m6(e,t,r,o,c){const u=te("ACCOUNT_REGISTER").slice(0,te("AJAX_REQUEST_CONCURRENT"));let f=[];f=t.proxyServer?u.map(E=>"https://".concat(t.proxyServer,"/ap/?url=").concat(E+"/api/v1")):u.map(E=>"https://".concat(E,"/api/v1"));const g=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:f});try{const E=await async function(v,S,R,I,D){const V=Date.now(),M={sid:R.sid,opid:10,appid:R.appId,string_uid:S};let j=v[0];const W=await dd(()=>md(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:M,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Y,le)=>{if(Y.code===0){if(Y.uid<=0||Y.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(S," => ").concat(Y.uid),Y),St.reqUserAccount(M.sid,{lts:V,success:!1,serverAddr:j,stringUid:M.string_uid,uid:Y.uid,errorCode:K.INVALID_UINT_UID_FROM_STRING_UID,extend:M}),new Te(K.INVALID_UINT_UID_FROM_STRING_UID);return St.reqUserAccount(M.sid,{lts:V,success:!0,serverAddr:j,stringUid:M.string_uid,uid:Y.uid,errorCode:null,extend:M}),!1}const ye=rv(Y.code);return ye.retry&&(j=v[(le+1)%v.length]),St.reqUserAccount(M.sid,{lts:V,success:!1,serverAddr:j,stringUid:M.string_uid,uid:Y.uid,errorCode:ye.desc,extend:M}),ye.retry},(Y,le)=>Y.code!==K.OPERATION_ABORTED&&(St.reqUserAccount(M.sid,{lts:V,success:!1,serverAddr:j,stringUid:M.string_uid,uid:null,errorCode:Y.code,extend:M}),j=v[(le+1)%v.length],!0),D);if(W.code!==0){const Y=rv(W.code);throw new Te(K.UNEXPECTED_RESPONSE,Y.desc)}return W}(f,e,t,r,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},g),E.uid}catch(E){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[E]},g),E}}async function Mre(e,t,r){const o=te("ACCOUNT_REGISTER");let c=[];c=t.proxyServer?o.map(u=>"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await p6({referenceList:c,asyncMapHandler:f=>async function(g,E,v,S){const R=Date.now(),I={sid:v.sid,opid:10,appid:v.appId,string_uid:E};try{const D=await md(g+"".concat(g.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(D.code!==0){const V=rv(D.code);throw new Te(K.UNEXPECTED_RESPONSE,"preload sua error:".concat(V.desc),V)}if(D.uid<=0||D.uid>=Math.pow(2,32))throw new Te(K.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:g,req:I,uid:D.uid,elapse:Date.now()-R}}catch(D){throw D}}(f,e,t,r),closeFn:f=>f.code===K.OPERATION_ABORTED||f.code===K.UNEXPECTED_RESPONSE&&!f.data.retry})}catch(u){throw u}}async function jre(e,t,r){const o=te("CDS_AP").slice(0,te("AJAX_REQUEST_CONCURRENT")).map(E=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(E+"/api/v1"):"https://".concat(E,"/api/v1?action=config")),c=o.map(E=>function(v,S,R,I){const D=Nn(),V={flag:64,cipher_method:0,features:yu(yu(yu(yu(yu({install_id:Ok(),device:D.name,system:D.os,system_general:navigator.userAgent,vendor:S.appId,version:Ic,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:Ire.WEB_RTC,browser_name:D.name,browser_version:D.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),D.os&&{os_name:D.os}),D.osVersion&&{os_version:D.osVersion}),{},{detail:""})};return dd(()=>md(v,{data:V,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,M=>M.code!==K.OPERATION_ABORTED,I)}(E,e,t,r));let u=null,f=null,g={};try{u=await cv(c)}catch(E){if(E.code===K.OPERATION_ABORTED)throw E;f=E}if(c.forEach(E=>E.cancel()),St.reportApiInvoke(e.sid,{name:fi.REQUEST_CONFIG_DISTRIBUTE,options:{error:f,res:u}}).onSuccess(),u&&u.test_tags)try{g=function(E){if(!E.test_tags)return{};const v=E.test_tags,S=Object.keys(v),R={};return S.forEach(I=>{var D;const V=aa(D=I.slice(4)).call(D),M=JSON.parse(v[I]),j=M[1];R[V]={tag:M[0]||"",value:j}}),R}(u)}catch{}return g}async function g6(e,t){const r=te("WEBCS_DOMAIN").concat(te("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:qb(),serviceIds:[gi.CHOOSE_SERVER,gi.CLOUD_PROXY_FALLBACK]}));try{return await p6({referenceList:r,asyncMapHandler:c=>async function(u,f,g){let E,{url:v,areaCode:S,serviceIds:R}=u;const I=Date.now(),[D,V]=C1(f,S,R);let M=mi.networkState;try{M&&mi.networkState===Do.OFFLINE&&mi.onlineWaiter&&await tt.race([mi.onlineWaiter,cs(Ri.maxRetryTimeout)]),M=mi.networkState;const{data:j,headers:W}=await md(v,{data:D,cancelToken:g,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);E=W.http3==="1"?1:-1,(Ee=>{const me=[];if(Ee.response_body.forEach(Ae=>{const Pe=Ae.buffer.code;if(Ae.uri===23&&Pe===0&&!Ae.buffer.edges_services)if(Ae.buffer.flag===4194310)Ae.buffer.edges_services=[];else{const $e={error:new Te(K.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Ee.detail[502]}),flag:Ae.buffer.flag};me.push($e)}if(Pe!==0){const $e=rv(Pe),at={error:new Te(K.CAN_NOT_GET_GATEWAY_SERVER,$e.desc,{desc:$e.desc,retry:$e.retry,csIp:Ee.detail[502]}),flag:Ae.buffer.flag};Ae.buffer.flag===4194310?x.warning(at.error.toString()):me.push(at)}}),me.length)throw new Te(K.CAN_NOT_GET_GATEWAY_SERVER,me.map(Ae=>"flag: ".concat(Ae.flag,", message: ").concat(Ae.error.message)).join(" | "),{retry:!!me.find(Ae=>Ae.error.data.retry),csIp:Ee.detail[502],desc:[...new Set(me.map(Ae=>{var Pe;return Ae==null||(Pe=Ae.error)===null||Pe===void 0||(Pe=Pe.data)===null||Pe===void 0?void 0:Pe.desc}).filter(Ae=>!!Ae))]})})(j);const le=Gb(j,gi.CHOOSE_SERVER),ye=Gb(j,gi.CLOUD_PROXY_FALLBACK);return R1(le),{gatewayInfo:f1(le,v),proxyInfo:ye,opid:V,requestTime:I,url:v,isHttp3:E,elapse:Date.now()-I}}catch(j){throw j}}(c,e,t),closeFn:c=>c.code===K.OPERATION_ABORTED||c.code===K.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function _6(e,t,r,o){const c=te("PROXY_SERVER_TYPE3"),u=(D,V,M)=>{let j=M||c;return Array.isArray(j)&&(j=V%2==0?c[1]:c[0]),"https://".concat(j,"/ap/?url=").concat(D)};let f=null;const g=[],E=async()=>{const D=te("WEBCS_DOMAIN").slice(0,te("AJAX_REQUEST_CONCURRENT")).map((j,W)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),W,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),W),{url:Y,areaCode:qb(),serviceIds:[gi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?gi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?gi.CLOUD_PROXY:gi.CLOUD_PROXY_FALLBACK]}}),V=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),M=await Kb({fragementLength:te("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(x.debug("[".concat(e.clientId,"] Connect to choose_server:"),j.url),u6(j,e,t,r)),allFailedhandler:j=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},V),j[0]},promisesCollector:g});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},V),M},v=async()=>{if(await cs(1e3),f!==null)return f;const D=te("WEBCS_DOMAIN_BACKUP_LIST").map((j,W)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),W,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),W),{url:Y,areaCode:qb(),serviceIds:[gi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?gi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?gi.CLOUD_PROXY:gi.CLOUD_PROXY_FALLBACK]}}),V=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),M=await Kb({fragementLength:te("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(x.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),j.url),u6(j,e,t,r)),allFailedhandler:j=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},V),j[0]},promisesCollector:g});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},V),M};let S,R,I;try{({gatewayInfo:S,proxyInfo:R,url:I}=await cv([E(),v()]))}catch(D){throw D[0]}if(g.length&&g.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),!S||!R)throw new Te(K.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=I,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&I){const D=/^https?:\/\/(.+?)(\/.*)?$/.exec(I)[1];Ze(c).call(c,D)&&(e.proxyServer=D,x.setProxyServer(D),St.setProxyServer(D))}return f={gatewayInfo:S,proxyInfo:await B9(R,S.uid)},f}async function Ure(e,t,r){const o=te("UAP_AP").slice(0,te("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(f,g,E,v){const S={command:"convergeAllocateEdge",sid:g.sid,appId:g.appId,token:g.token,ts:Date.now(),version:Ic,cname:g.cname,uid:g.uid.toString(),requestId:w1,seq:w1};w1+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(S)};return dd(async()=>{const I=await md(f,{data:R,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(I.code!==0){const V=new Te(K.UNEXPECTED_RESPONSE,"cross channel ap error, code"+I.code,{retry:!0});throw x.error(V.toString()),V}const D=JSON.parse(I.json_body);if(D.code!==200){const V=new Te(K.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(D.code,", reason: ").concat(D.reason));throw x.error(V.toString()),V}if(!D.servers||D.servers.length===0){const V=new Te(K.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(V.toString()),V}return{vid:D.vid,workerToken:D.workerToken,addressList:(te("CHANNEL_MEDIA_RELAY_SERVERS")||D.servers).map(V=>"wss://".concat(V.address.replace(/\./g,"-"),".").concat(te("WORKER_DOMAIN"),":").concat(V.wss))}},void 0,I=>!!(I.code!==K.OPERATION_ABORTED&&I.code!==K.UNEXPECTED_RESPONSE||I.data&&I.data.retry),v)}(u,e,t,r));try{const u=await cv(c);return c.forEach(f=>f.cancel()),u}catch(u){throw u[0]}}async function Vre(e,t,r){let o=null;const c=[],u=async f=>{const g=te(f?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(E=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(E+"/api/v2/transpond/webrtc?v=2"):"https://".concat(E,"/api/v2/transpond/webrtc?v=2"));return f&&(await cs(1e3),o!==null)?o:await Kb({fragementLength:te("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:E=>(x.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(f?"backup":""," choose_server:"),E),function(v,S,R,I){const[D]=Lre(S,[gi.CHOOSE_SERVER]);let V=mi.networkState;return dd(async()=>{V&&mi.networkState===Do.OFFLINE&&mi.onlineWaiter&&await tt.race([mi.onlineWaiter,cs(I&&I.maxRetryTimeout||Ri.maxRetryTimeout)]),V=mi.networkState;const M=await md(v,{data:D,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return kre(M,v)},()=>!1,M=>M.code!==K.OPERATION_ABORTED&&(M.code===K.UPDATE_TICKET_FAILED?M.data.retry:(x.warning("[".concat(S.clientId,"] update ticket network error, retry"),M),!0)),I)}(E,e,t,r)),allFailedhandler:E=>{throw E[0]},promisesCollector:c})};try{return o=await cv([u(!1),u(!0)]),c.length&&c.forEach(f=>f.cancel&&typeof f.cancel=="function"&&f.cancel()),o}catch(f){throw f[0]}}function E6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function I1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?E6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class Fre extends xr{get isSuccess(){return!!this.configs}constructor(t,r){super(),H(this,"configs",void 0),H(this,"store",void 0),H(this,"joinInfo",void 0),H(this,"cancelToken",void 0),H(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),H(this,"interval",void 0),H(this,"mutex",void 0),H(this,"mutableParamsRead",!1),H(this,"configCache",{}),H(this,"limit_bitrate",void 0),this.mutex=new Ls("config-distribute",t),this.store=r}startGetConfigDistribute(t,r){this.joinInfo=t,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),te("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},te("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,St.reportApiInvoke(null,{options:void 0,name:fi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Gr.TRACER}).onSuccess(JSON.stringify(ud))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const r=await this.mutex.lock();try{t=await jre(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(t));const o=function(c){var u;const f=Gt(u=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(u);for(let v=0;v<f.length;v++)for(let S=f.length-1;S>v;S--){const R=f[S],I=c[R].value;if(typeof I.__priority=="number"){const D=I.__priority,V=f[S-1],M=c[V].value;if(typeof M.__priority=="number"){if(!(D>M.__priority))continue;{const j=R;f[S]=f[S-1],f[S-1]=j}}else{const j=R;f[S]=f[S-1],f[S-1]=j}}}const g=Date.now();let E={};return f.forEach(v=>{const S=c[v].value.__expires;S&&S<=g||(E[v]=c[v])}),E}(t);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Te(K.NETWORK_RESPONSE_ERROR,o);x.warning("[config-distribute] ".concat(c.toString()))}finally{r()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){O9(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Fb.UPDATE_BITRATE_LIMIT,t):this.emit(Fb.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&I1({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const r={},o=Object.keys(t),c=[];o.forEach(u=>{const f=t[u].value;r[u]=f;const g=f.__id;if(g&&this.configCache[u]&&this.configCache[u].__id===g)return;const E=f.__type,v=t[u].value,S=t[u].tag;let R=0;E?E===r4.REALTIME&&(R=1):Object.keys(v).some(I=>Object.prototype.hasOwnProperty.call(kk,I)||!r1()&&Object.prototype.hasOwnProperty.call(MA,I)?(R=1,!0):void 0),c.push({tag:S,isApplied:R,feature:u,params:JSON.stringify(f)})}),c.forEach(u=>{let{tag:f,feature:g,params:E,isApplied:v}=u;this.store.sessionId&&St.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:f,feature:g,params:E,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=r}catch(r){x.debug("handleABTestConfigDistribute error",r)}}cacheGlobalParameterConfig(t){const r=function(c){const u={};return Object.keys(c).forEach(f=>{const g=c[f].value,E=g.__expires,v=g.__type;Object.keys(g).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=I1(I1({value:g[S]},E&&{expires:E}),v&&{type:v}))})}),u}(t);try{var o;const c=(o=r.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete r.LIMIT_BITRATE,c&&O9(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(r),this.handleABTestConfigDistribute(t),function(g){try{const E=Date.now();Object.keys(g).forEach(v=>{const{value:S,type:R,expires:I}=g[v];I&&I<=E||((R===r4.REALTIME||Object.prototype.hasOwnProperty.call(kk,v))&&(ud[v]=S,Tr[v]=S,x.debug("Update realtime parameters from config distribute",v,S)),R||r1()||!Object.prototype.hasOwnProperty.call(MA,v)||(ud[v]=S,Tr[v]=S,x.debug("Update gateway parameters from config distribute",v,S)))})}catch(E){x.error("Error update config immediately: ".concat(g),E.message)}}(r);const u=JSON.stringify(r),f=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",f),x.debug("Caching global parameters ".concat(u))}catch(c){x.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(t){try{const r=Date.now();Object.keys(t).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Tr,o)){const{value:c,expires:u}=t[o];if(u&&u<=r)return;(function(f,g){try{return typeof f=="object"&&typeof g=="object"&&JSON.stringify(f)===JSON.stringify(g)}catch{return!1}})(Tr[o],c)||(ud[o]=c,Tr[o]=c,this.emit(Fb.UPDATE_CLIENT_ROLE_OPTIONS,c),x.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(r){x.error("Error handling global parameter config:",r.message)}}}class Bre extends xr{constructor(){super(...arguments),H(this,"resultStorage",new Map)}setLocalAudioStats(t,r,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(o,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(o,r))}setLocalVideoStats(t,r,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(o,r)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(o,r)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(o))}setRemoteAudioStats(t,r){const o=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(r))}setRemoteVideoStats(t,r){const o=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(r))}record(t,r,o){if(te("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(t);if(c&&(c.result.push(o),c.result.length>=5)){var u;const f=Ze(u=c.result).call(u,!0);c.isPrevNormal&&!f&&this.emit("exception",y6[t],t,r),!c.isPrevNormal&&f&&this.emit("exception",y6[t]+2e3,t+"_RECOVER",r),c.isPrevNormal=f,c.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,r){return r instanceof Ni&&!r.isActive||!!r.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,r){let o=null;r._encoderConfig&&r._encoderConfig.frameRate&&(o=xo(r._encoderConfig.frameRate));const c=t.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,r){return!!r.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,r){return r instanceof Ni&&!r.isActive||!!r.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const y6={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Us=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){const o=r[r.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,t){const r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){const o=r[r.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function v6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Yg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?v6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class Xb{constructor(t){H(this,"store",void 0),H(this,"onStatsException",void 0),H(this,"onUploadPublishDuration",void 0),H(this,"onStatsChanged",void 0),H(this,"onVideoCodecChanged",void 0),H(this,"localStats",new Map),H(this,"remoteStats",new Map),H(this,"updateStatsInterval",void 0),H(this,"trafficStats",void 0),H(this,"trafficStatsPeerList",[]),H(this,"uplinkStats",void 0),H(this,"exceptionMonitor",void 0),H(this,"p2pChannel",void 0),H(this,"scalabilityMode",LA.L1T1),H(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Bre,this.exceptionMonitor.on("exception",(r,o,c)=>{this.onStatsException&&this.onStatsException(r,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Fe.LocalAudioTrack)||Yg({},Vk)}getLocalVideoTrackStats(){return this.localStats.get(Fe.LocalVideoTrack)||Yg({},Fk)}getRemoteAudioTrackStats(t){const r=(u,f)=>{if(!this.trafficStats)return f;const g=this.trafficStats.peer_delay.find(E=>E.peer_uid===u);return g&&(f.publishDuration=g.B_ppad+(Date.now()-this.trafficStats.timestamp)),f},o={};if(t){var c;const u=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.audioStats;u&&(o[t]=r(t,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[f,{audioStats:g}]=u;g&&(o[f]=r(f,g))});return o}getRemoteNetworkQualityStats(t){const r={};if(t){var o;const c=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.networkStats;c&&(r[t]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:f}]=c;f&&(r[u]=f)});return r}getRemoteVideoTrackStats(t){const r=(u,f)=>{if(!this.trafficStats)return f;const g=this.trafficStats.peer_delay.find(E=>E.peer_uid===u);return g&&(f.publishDuration=g.B_ppvd+(Date.now()-this.trafficStats.timestamp)),f},o={};if(t){var c;const u=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.videoStats;u&&(o[t]=r(t,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[f,{videoStats:g}]=u;g&&(o[f]=r(f,g))});return o}getRTCStats(){let t=0,r=0,o=0,c=0;const u=this.localStats.get(Fe.LocalAudioTrack);u&&(t+=u.sendBytes,r+=u.sendBitrate);const f=this.localStats.get(Fe.LocalVideoTrack);f&&(t+=f.sendBytes,r+=f.sendBitrate);const g=this.localStats.get(Fe.LocalVideoLowTrack);g&&(t+=g.sendBytes,r+=g.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:S,videoStats:R}=v;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),R&&(o+=R.receiveBytes,c+=R.receiveBitrate)});let E=1;return this.trafficStats&&(E+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:E,SendBitrate:r,SendBytes:t,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(r=>r.B_ppad!==void 0||r.B_ppvd!==void 0),t.peer_delay.filter(r=>this.trafficStatsPeerList.indexOf(r.peer_uid)===-1).forEach(r=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(r.peer_uid),u=c!=null&&c.videoSSRC?Us.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,f=c!=null&&c.audioSSRC?Us.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;r.B_ppad!==void 0&&r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,u>f?u:f),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,o){if(!t)return!1;const c=!!o&&r.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||r.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(r=>{let[o,c]=r;switch(o){case Fe.LocalVideoTrack:case Fe.LocalVideoLowTrack:{const g=c,E=Yg({},Fk),v=t.getStats(),S=t.getLocalMedia(o);if(v){const R=v.videoSend.find(I=>I.ssrc===(S==null?void 0:S.ssrcs[0].ssrcId));if(R){const I=t.getLocalVideoSize(),D=t.getEncoderConfig(Fe.LocalVideoTrack);var u;(R.codec==="H264"||R.codec==="H265"||R.codec==="VP8"||R.codec==="VP9"||R.codec==="AV1X"||R.codec==="AV1")&&(E.codecType=R.codec,(g==null?void 0:g.codecType)!==R.codec&&((u=this.onVideoCodecChanged)===null||u===void 0||u.call(this,R.codec.toLocaleLowerCase()))),E.sendBytes=R.bytes,E.sendBitrate=g?8*Math.max(0,E.sendBytes-g.sendBytes):0,R.inputFrame?(E.captureFrameRate=R.inputFrame.frameRate,E.captureResolutionHeight=R.inputFrame.height,E.captureResolutionWidth=R.inputFrame.width):I&&(E.captureResolutionWidth=I.width,E.captureResolutionHeight=I.height),R.sentFrame?(E.sendFrameRate=R.sentFrame.frameRate,E.sendResolutionHeight=R.sentFrame.height,E.sendResolutionWidth=R.sentFrame.width):I&&(E.sendResolutionWidth=I.width,E.sendResolutionHeight=I.height),R.avgEncodeMs&&(E.encodeDelay=R.avgEncodeMs),D&&D.bitrateMax?E.targetSendBitrate=1e3*D.bitrateMax:R.targetBitrate&&(E.targetSendBitrate=R.targetBitrate),E.sendPackets=R.packets,E.sendPacketsLost=R.packetsLost,E.sendJitterMs=R.jitterMs,E.sendRttMs=R.rttMs,E.totalDuration=g?g.totalDuration+1:1,E.totalFreezeTime=g?g.totalFreezeTime:0,this.isLocalVideoFreeze(R)&&(E.totalFreezeTime+=1),R.scalabilityMode&&this.scalabilityMode!==R.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(R.scalabilityMode)),this.scalabilityMode=R.scalabilityMode)}this.trafficStats&&(E.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var f;this.localStats.set(o,E),((g==null?void 0:g.sendResolutionWidth)!==E.sendResolutionWidth||(g==null?void 0:g.sendResolutionHeight)!==E.sendResolutionHeight)&&((f=this.onStatsChanged)===null||f===void 0||f.call(this,"resolution",{width:E.sendResolutionWidth,height:E.sendResolutionHeight})),E&&S&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,S.track,E);break}case Fe.LocalAudioTrack:{const g=c,E=Yg({},Vk),v=t.getStats(),S=t.getLocalMedia(o);if(v){const R=v.audioSend.find(I=>I.ssrc===(S==null?void 0:S.ssrcs[0].ssrcId));if(R){if(R.codec!=="opus"&&R.codec!=="aac"&&R.codec!=="PCMU"&&R.codec!=="PCMA"&&R.codec!=="G722"||(E.codecType=R.codec),R.inputLevel)E.sendVolumeLevel=Math.round(32767*R.inputLevel);else{const I=t.getLocalAudioVolume();I&&(E.sendVolumeLevel=Math.round(32767*I))}E.sendBytes=R.bytes,E.sendPackets=R.packets,E.sendPacketsLost=R.packetsLost,E.sendJitterMs=R.jitterMs,E.sendRttMs=R.rttMs,E.sendBitrate=g?8*Math.max(0,E.sendBytes-g.sendBytes):0}}this.trafficStats&&(E.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Fe.LocalAudioTrack,E),E&&S&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,S.track,E);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(r=>{var o,c;let[u,{videoStats:f,audioStats:g,videoPcStats:E}]=r;const v=g,S=f,R=E,I=Yg({},f4),D=Yg({},m4),V=Yg({},wne),{audioTrack:M,videoTrack:j,audioSSRC:W,videoSSRC:Y}=t.getRemoteMedia(u);let le;le=this.store.useP2P?t.getStats(!0):t.getStats();const ye=(o=le)===null||o===void 0?void 0:o.audioRecv.find(Pe=>Pe.ssrc===W),Ee=(c=le)===null||c===void 0?void 0:c.videoRecv.find(Pe=>Pe.ssrc===Y),me=this.trafficStats&&this.trafficStats.peer_delay.find(Pe=>Pe.peer_uid===u);if(ye&&(ye.codec!=="opus"&&ye.codec!=="aac"&&ye.codec!=="PCMU"&&ye.codec!=="PCMA"&&ye.codec!=="G722"||(I.codecType=ye.codec),ye.outputLevel?I.receiveLevel=Math.round(32767*ye.outputLevel):M&&(I.receiveLevel=Math.round(32767*M.getVolumeLevel())),I.receiveBytes=ye.bytes,I.receivePackets=ye.packets,I.receivePacketsLost=ye.packetsLost,I.receivePacketsDiscarded=ye.packetsDiscarded,I.packetLossRate=I.receivePacketsLost/(I.receivePackets+I.receivePacketsLost),I.receiveBitrate=v?8*Math.max(0,I.receiveBytes-v.receiveBytes):0,I.totalDuration=v?v.totalDuration+1:1,I.totalFreezeTime=v?v.totalFreezeTime:0,I.freezeRate=I.totalFreezeTime/I.totalDuration,I.receiveDelay=ye.jitterBufferMs,I.totalDuration>10&&Xb.isRemoteAudioFreeze(M)&&(I.totalFreezeTime+=1)),Ee){var Ae;Ee.codec!=="H264"&&Ee.codec!=="H265"&&Ee.codec!=="VP8"&&Ee.codec!=="VP9"&&Ee.codec!=="AV1X"&&Ee.codec!=="AV1"||(D.codecType=Ee.codec),D.receiveBytes=Ee.bytes,D.receiveBitrate=S?8*Math.max(0,D.receiveBytes-S.receiveBytes):0,D.decodeFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,D.renderFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,Ee.outputFrame&&(D.renderFrameRate=Ee.outputFrame.frameRate),Ee.receivedFrame?(D.receiveFrameRate=Ee.receivedFrame.frameRate,D.receiveResolutionHeight=Ee.receivedFrame.height,D.receiveResolutionWidth=Ee.receivedFrame.width):j&&(D.receiveResolutionHeight=j._videoHeight||0,D.receiveResolutionWidth=j._videoWidth||0),Ee.framesRateFirefox!==void 0&&(D.receiveFrameRate=Math.round(Ee.framesRateFirefox)),D.receivePackets=Ee.packets,D.receivePacketsLost=Ee.packetsLost,D.packetLossRate=D.receivePacketsLost/(D.receivePackets+D.receivePacketsLost);const Pe=S?S.totalFreezeTime:0,$e=S?S.totalDuration:0;D.totalDuration=S?S.totalDuration+1:1,D.totalFreezeTime=(Ae=Ee.totalFreezesDuration)!==null&&Ae!==void 0?Ae:Pe||0,D.receiveDelay=Ee.jitterBufferMs||0;const at=!!Y&&t.getRemoteVideoIsReady(Y);Ee.totalFreezesDuration===void 0&&j&&at&&Xb.isRemoteVideoFreeze(j,Ee,R)&&(D.totalFreezeTime+=1),D.freezeRate=Math.max(0,Math.min((D.totalFreezeTime-Pe)/(D.totalDuration-$e),1))}me&&(I.end2EndDelay=me.B_ad,D.end2EndDelay=me.B_vd,I.transportDelay=me.B_ed,D.transportDelay=me.B_ed,I.currentPacketLossRate=me.B_ealr4/100,D.currentPacketLossRate=me.B_evlr4/100,V.uplinkNetworkQuality=me.B_punq?me.B_punq:0,V.downlinkNetworkQuality=me.B_pdnq?me.B_pdnq:0),this.remoteStats.set(u,{audioStats:I,videoStats:D,videoPcStats:Ee,networkStats:V}),M&&this.exceptionMonitor.setRemoteAudioStats(M,I),j&&this.exceptionMonitor.setRemoteVideoStats(j,D)})}}class S6{constructor(){H(this,"destChannelMediaInfos",new Map),H(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){I9(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){I9(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){eI(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function T6(e){if(!(e instanceof S6))return new Te(K.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();if(!t)return new Te(K.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new Te(K.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Nf{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,r){H(this,"uid",void 0),H(this,"_uintid",void 0),H(this,"_trust_in_room_",!0),H(this,"_trust_audio_enabled_state_",!0),H(this,"_trust_video_enabled_state_",!0),H(this,"_trust_audio_mute_state_",!0),H(this,"_trust_video_mute_state_",!0),H(this,"_audio_muted_",!1),H(this,"_video_muted_",!1),H(this,"_audio_enabled_",!0),H(this,"_video_enabled_",!0),H(this,"_audio_added_",!1),H(this,"_video_added_",!1),H(this,"_is_pre_created",!1),H(this,"_video_pre_subscribed",!1),H(this,"_audio_pre_subscribed",!1),H(this,"_trust_video_stream_added_state_",!0),H(this,"_trust_audio_stream_added_state_",!0),H(this,"_audioTrack",void 0),H(this,"_videoTrack",void 0),H(this,"_dataChannels",[]),H(this,"_audioSSRC",void 0),H(this,"_videoSSRC",void 0),H(this,"_audioOrtc",void 0),H(this,"_videoOrtc",void 0),H(this,"_cname",void 0),H(this,"_rtxSsrcId",void 0),H(this,"_videoMid",void 0),H(this,"_audioMid",void 0),this.uid=t,this._uintid=r}}function b6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function w6(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?b6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const Qb="9",R6=4e4;function C6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function qh(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?C6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}var lv=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(lv||{});const fI=new Map;function A6(e,t,r,o){let{scale:c}=e;if(c===0&&o===lv.UP||c>=t.length-1&&o===lv.DOWN)return e;let u=qh(qh({},e),{},{scale:o===lv.DOWN?++c:--c});switch(r){case"maintain-framerate":u=qh(qh({},u),t[c].motion);break;case"maintain-resolution":u=qh(qh({},u),t[c].detail);break;case"balanced":u=qh(qh({},u),t[c].balanced)}return u}function I6(e,t){if(t){const r={overUse:0,underUse:0,adaptationList:N6(t)};fI.set(e,r)}else fI.delete(e)}function N6(e){const t=qh({},e),{bitrateMax:r,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=t,{MIN_FRAME_RATE:f,MAX_THRESHOLD_FRAMERATE:g,MAX_SCALE:E,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:I,PERF_SCALE_DOWN_THRESHOLD:D,PERF_SCALE_UP_THRESHOLD:V,BALANCE_BITRATE_FACTOR:M,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:W,MOTION_RESOLUTION_FACTOR:Y,MOTION_BITRATE_FACTOR:le,DETAIL_FRAMERATE_FACTOR:ye,DETAIL_BITRATE_FACTOR:Ee}=xk,me=Math.min(t.frameRate,g),Ae=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(I,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(D,1)*me),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:r,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:r,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:r,bitrateMin:u}}];for(let Pe=1;Pe<=E;Pe++){const $e={bwe_up:Math.round(Math.pow(R,Pe)*r),bwe_down:Math.round(Math.pow(I,Pe+1)*r),fps_up:Math.round(Math.pow(V,Pe)*me),fps_down:Math.round(Math.pow(D,Pe+1)*me)},at={scaleResolutionDownBy:c/Math.pow(W,Pe),frameRate:Math.max(Math.round(Math.pow(j,Pe)*o),f),bitrateMax:Math.max(Math.round(Math.pow(M,Pe)*r),S),bitrateMin:Math.max(Math.round(Math.pow(M,Pe)*u),v)},nn={scaleResolutionDownBy:c/Math.pow(Y,Pe),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(le,Pe)*r),S),bitrateMin:Math.max(Math.round(Math.pow(le,Pe)*u),v)},Xt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ye,Pe)*o),f),bitrateMax:Math.max(Math.round(Math.pow(Ee,Pe)*r),S),bitrateMin:Math.max(Math.round(Math.pow(Ee,Pe)*u),v)};Ae.push({scale:Pe,threshold:$e,balanced:at,motion:nn,detail:Xt})}return Ae}function Hre(e,t,r,o,c,u){const f=fI.get(e)||{overUse:0,underUse:0,adaptationList:N6(c)},{adaptationList:g}=f;fI.set(e,f);const{OVERUSE_TIMES_THRESHOLD:E,UNDERUSE_TIMES_THRESHOLD:v}=xk,{scale:S}=o;let R,I;return typeof t=="number"&&t>0&&function(D,V,M,j){if(V>=M.length)return!1;let{threshold:{fps_down:W}}=M[V];return te("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(W=M[0].threshold.fps_down),D<W}(t,S,g,u)&&(f.overUse++,I=Pb.CPU,f.overUse>E)||typeof r=="number"&&r>0&&function(D,V,M){if(V>=M.length)return!1;const{threshold:{bwe_down:j}}=M[V];return D<j}(r,S,g)&&(f.overUse++,I=Pb.BANDWIDTH,f.overUse>E)?(f.overUse=0,f.underUse=0,R=A6(o,g,u,lv.DOWN),[R,I]):(typeof t=="number"&&t>0&&typeof r=="number"&&r>0&&function(D,V,M,j){if(V===0)return;let{threshold:{fps_up:W}}=M[V];return te("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(W=M[1].threshold.fps_up),D>W}(t,S,g,u)&&function(D,V,M){if(V===0)return;const{threshold:{bwe_up:j}}=M[V];return D>j}(r,S,g)&&(f.underUse++,f.underUse>v&&(f.overUse=0,f.underUse=0,R=A6(o,g,u,lv.UP),R.scale===0&&(I=Pb.NONE))),[R,I])}function O6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function N1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?O6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function Gre(e){var t;return!!te("ENABLE_AG_ADAPTATION")&&!!(e instanceof Xk||Ze(t=e._hints).call(t,er.CUSTOM_TRACK))&&(!!te("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(r){const o=Nn();if(o.os!==Fi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=r}(14)&&R3(17,4)||w3(14)&&C3(17,4,!0)))}const mI=new Map;function gI(e,t){const r=mI.get(e);if(r){const{timer:o}=r;window.clearTimeout(o),mI.delete(e)}t.qualityLimitationReason=Pb.NONE,I6(e)}function Wre(e,t){var r;let o;switch(t){case Fe.LocalAudioTrack:o=Hn.Audio;break;case Fe.LocalVideoTrack:o=Ze(r=e._hints).call(r,er.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Fe.LocalVideoLowTrack:o=Hn.Low}return o}function O1(e){const t=On();if(e.some(r=>r._bypassWebAudio))throw new Ie(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new Ie(K.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function D1(e,t){O1(e);const r=new Ni;return e.forEach(o=>r.addAudioTrack(o)),r}const zre=!On().supportUnifiedPlan||te("CHROME_FORCE_PLAN_B")&&Vh();function _I(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;return zre?(r={spec:t,store:e},Yh("PlanBConnection").create(r)):new vu(t,e)}function x1(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function D6(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Ob(e.turnServer.servers))return!1;if(te("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var wn;function x6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function gd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let vu=(wn=class c_ extends x9{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return Ze(r=Object.keys(jA)).call(r,t)}))]}constructor(t,r){super(t,r),H(this,"id",dr(5,"connection-")),H(this,"store",void 0),H(this,"peerConnection",void 0),H(this,"forceTurn",!1),H(this,"remoteSDP",void 0),H(this,"initialOffer",void 0),H(this,"transportEventReceiver",void 0),H(this,"statsFilter",void 0),H(this,"extension",{useXR:te("USE_XR")}),H(this,"localCapabilities",void 0),H(this,"remoteCodecs",void 0),H(this,"localCandidateCount",0),H(this,"allCandidatesReceived",!1),H(this,"isPreallocation",!1),H(this,"preSSRCMap",new Map),H(this,"dataStreamChannelMap",new Map),H(this,"establishPromise",void 0),H(this,"recoveredDataChannelIds",[]),H(this,"currentDataChannelId",1),H(this,"supportAV1RtpSpec",!1),H(this,"mutex",void 0),H(this,"qualityLimitationReason",Pb.NONE),H(this,"isFirstConnected",!1),this.store=r,this.forceTurn=D6(t),this.mutex=new Ls("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(c_.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=Nk(this.peerConnection,te("STATS_UPDATE_INTERVAL"),void 0,Br()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){const r=this.preSSRCMap.get(t);if(r!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(o)return{transceiver:o,track:o.receiver.track,id:r}}}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Af(o.sdp),u=await $9({filterRTX:!te("USE_PUB_RTX")&&!te("USE_SUB_RTX"),filterVideoFec:te("FILTER_VIDEO_FEC"),filterAudioFec:te("FILTER_AUDIO_FEC"),filterVideoCodec:te("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=lI(u),this.initialOffer=o,te("ENABLE_SVC")&&this.store.codec=="av1"){const g=await async function(){try{const E=new RTCPeerConnection;E.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:LA.L1T3}]});const v=await E.createOffer();if(!v.sdp)return void E.close();const S=no(v.sdp).mediaDescriptions[0];if(!S)return;const R=S.attributes.extmaps.find(I=>I.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return E.close(),R}catch{return}}();var t;g&&(this.supportAV1RtpSpec=!0,(t=u.send)===null||t===void 0||t.videoExtensions.push(g))}let f;return o.sdp&&t6(o.sdp)&&(f=Pr(u),(r=f).send&&(iv(lt.VIDEO,r.send.videoExtensions),iv(lt.AUDIO,r.send.audioExtensions)),r.recv&&(iv(lt.VIDEO,r.recv.videoExtensions),iv(lt.AUDIO,r.recv.audioExtensions)),r.sendrecv&&(iv(lt.VIDEO,r.sendrecv.videoExtensions),iv(lt.AUDIO,r.sendrecv.audioExtensions))),gd(gd({},c),{},{rtpCapabilities:f||u,offerSDP:o.sdp})}catch(o){throw new Ie(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var r}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&t6(this.initialOffer.sdp)&&(r=t.rtpCapabilities,o=this.localCapabilities,r.send&&(aI(lt.VIDEO,r.send.videoExtensions,o.send.videoExtensions),aI(lt.AUDIO,r.send.audioExtensions,o.send.audioExtensions)),r.recv&&(aI(lt.VIDEO,r.recv.videoExtensions,o.recv.videoExtensions),aI(lt.AUDIO,r.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Pr(this._localCapabilities)}get rtpCapabilities(){return Pr(this._rtpCapabilities)}get candidates(){return Pr(this._candidates)}get iceParameters(){return Pr(this._iceParameters)}get dtlsParameters(){return Pr(this._dtlsParameters)}constructor(v){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];H(this,"sessionDesc",void 0),H(this,"_localCapabilities",void 0),H(this,"_rtpCapabilities",void 0),H(this,"_candidates",void 0),H(this,"_originCandidates",void 0),H(this,"_iceParameters",void 0),H(this,"_isUseExtmapAllowMixed",void 0),H(this,"_dtlsParameters",void 0),H(this,"setup",void 0),H(this,"currentMidIndex",void 0),H(this,"cname",void 0),H(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,v=Pr(v);const{iceParameters:R,dtlsParameters:I,candidates:D,rtpCapabilities:V,setup:M,localCapabilities:j,cname:W}=v;this._rtpCapabilities=V,this._candidates=D,this._originCandidates=Pr(D),this._iceParameters=R,this._dtlsParameters=I,this._localCapabilities=j,this.setup=M,this.cname=W,this.sessionDesc=this.updateRemoteRTPCapabilities(V),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(v){const S=this.candidates,R=this.dtlsParameters,I=this.iceParameters,D=this.rtpCapabilities.send;let V=this.sessionDesc.mediaDescriptions.length-1;for(let M=1;M<v;M++){const j=2*M+2e4,W=2*M+R6,{ssrcs:Y,ssrcGroups:le}=zg([{ssrcId:j}],this.cname),{ssrcs:ye,ssrcGroups:Ee}=zg([{ssrcId:W,rtx:te("USE_SUB_RTX")?W+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Qb,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.videoCodecs.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:S,extmaps:D.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ye,ssrcGroups:Ee,rtcpFeedbackWildcards:[],payloads:D.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++V)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Qb,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.audioCodecs.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:S,extmaps:D.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Y,ssrcGroups:le,rtcpFeedbackWildcards:[],payloads:D.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++V)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Tf(this.sessionDesc)}send(v,S,R,I){const{ssrcs:D,ssrcGroups:V}=zg(S,this.cname,te("SYNC_GROUP")?R:void 0),M=this.findPreloadMediaDesc(D);if(M){if(Br()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,M.attributes.mid),I&&(I.twcc||I.remb)){const j=this.sessionDesc.mediaDescriptions.indexOf(M);return this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(M,I),{mid:M.attributes.mid,needExchangeSDP:!0}}return{mid:M.attributes.mid,needExchangeSDP:!1}}{const j=this.findAvailableMediaIndex(v,D);let W;return j===-1||j===1&&(_s()||function(){const Y=Nn();return!(Y.name!==Mn.CHROME||!Y.osVersion)&&Number(Y.version)<=90}()||te("ENABLE_ENCODED_TRANSFORM")&&Uh())||j===0&&te("USE_SUB_RTX")||A3()?(W=this.createOrRecycleSendMedia(v,D,V,"sendonly",I),this.updateBundleMids()):(W=Pr(this.sessionDesc.mediaDescriptions[j]),W.attributes.direction="sendonly",W.attributes.ssrcs=D,W.attributes.ssrcGroups=V,this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(W,I)),Br()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,W.attributes.mid),{mid:W.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:v,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:v.attributes.mid,needExchangeSDP:S}}batchSend(v){const S=v.map(D=>{let{kind:V,ssrcMsg:M,mslabel:j}=D;return this.send(V,M,j)}),R=[];let I=!1;return S.forEach(D=>{let{mid:V,needExchangeSDP:M}=D;M&&(I=!0),R.push(V)}),{mids:R,needExchangeSDP:I}}stopSending(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&v.indexOf(R.attributes.mid)!==-1);if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(R=>{R.attributes.mid==="0"||Br()||A3()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(v){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!S)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(v){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!S)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>Ze(v).call(v,R.attributes.mid||""));if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>Ze(v).call(v,R.attributes.mid||""));if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="recvonly"})}receive(v,S,R,I){v.forEach((D,V)=>{this.createOrRecycleRecvMedia(D,[],"recvonly",S,R,I[V])}),this.updateBundleMids()}stopReceiving(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>v.indexOf(R.attributes.mid)!==-1);if(S.length!==v.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(v){const S=this.sessionDesc||no((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=v;const I=this.rtpCapabilities.send,D=this.localCapabilities.send;for(const V of S.mediaDescriptions){if(V.attributes.iceUfrag=this._iceParameters.iceUfrag,V.attributes.icePwd=this._iceParameters.icePwd,V.attributes.fingerprints=this._dtlsParameters.fingerprints,V.attributes.candidates=this._candidates,V.attributes.setup=this.setup,V.media.mediaType==="application"&&(V.attributes.sctpPort="5000"),V.media.mediaType==="video"){if(I.videoCodecs.length===0){const M=D.videoCodecs.filter(j=>{var W,Y;return(W=j.rtpMap)===null||W===void 0?void 0:Ze(Y=W.encodingName.toLowerCase()).call(Y,"vp8")})||[D.videoCodecs[0]];V.media.fmts=M.map(j=>j.payloadType.toString(10)),V.attributes.payloads=M,V.attributes.extmaps=[]}else if(V.media.fmts=I.videoCodecs.map(M=>M.payloadType.toString(10)),V.attributes.payloads=I.videoCodecs,V.attributes.extmaps=I.videoExtensions,te("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:M,ssrcGroups:j}=zg([{ssrcId:R6,rtx:te("USE_SUB_RTX")?40001:void 0}],this.cname);V.attributes.ssrcs=M,V.attributes.ssrcGroups=j}}if(V.media.mediaType==="audio"){if(I.audioCodecs.length===0){const M=D.audioCodecs.filter(j=>{var W,Y;return(W=j.rtpMap)===null||W===void 0?void 0:Ze(Y=W.encodingName.toLowerCase()).call(Y,"opus")})||[D.audioCodecs[0]];V.media.fmts=M.map(j=>j.payloadType.toString(10)),V.attributes.payloads=M,V.attributes.extmaps=[]}else if(V.media.fmts=I.audioCodecs.map(M=>M.payloadType.toString(10)),V.attributes.payloads=I.audioCodecs,V.attributes.extmaps=I.audioExtensions,av(V),te("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:M,ssrcGroups:j}=zg([{ssrcId:2e4}],this.cname);V.attributes.ssrcs=M,V.attributes.ssrcGroups=j}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(v){const S=this._originCandidates.filter(I=>I.transport==="udp"),R=[];if(S.forEach(I=>{R.push(w6(w6({},I),{},{foundation:"tcpcandidate",priority:Number(I.priority)-1+"",transport:"tcp",port:Number(I.port)+90+""}))}),S.length!==0){switch(v){case js.TCP_RELAY:this._candidates=R;break;case js.UDP_TCP_RELAY:case js.RELAY:this._candidates=[...S,...R];break;default:this._candidates=S}for(const I of this.sessionDesc.mediaDescriptions)I.attributes.candidates=this.candidates}}restartICE(v){v=Pr(v),this._iceParameters=v,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=v.iceUfrag,S.attributes.icePwd=v.icePwd})}predictReceivingMids(v){const S=[];for(let R=0;R<v;R++)S.push((this.currentMidIndex+R+1).toString(10));return S}findAvailableMediaIndex(v,S){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const I=R.media.mediaType===v&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(Br()){if(I){const D=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(D||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!D||D!==R.attributes.mid)}return!1}return I})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const v="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:Qb,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(v),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(v,S,R,I,D,V){const M=v._mediaStreamTrack.kind,j=this.rtpCapabilities.recv,W=zb(M,j,this.localCapabilities.send,M===lt.VIDEO?I:D),Y=M===lt.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const le="".concat(this.currentMidIndex);let ye={media:{mediaType:M,port:Qb,protos:["UDP","TLS","RTP","SAVPF"],fmts:W.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:W,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(le)}};ye=this.mungRecvMediaDsec(ye,v,V);const Ee=this.findFirstClosedMedia(M);if(Ee){const me=this.sessionDesc.mediaDescriptions.indexOf(Ee);this.sessionDesc.mediaDescriptions[me]=ye}else this.sessionDesc.mediaDescriptions.push(ye);return ye}updateRemoteCodec(v,S,R){const I=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").filter(ye=>{var Ee;return Ze(Ee=Object.keys(jA)).call(Ee,ye)}))],D=new Set(S);if(I.every(ye=>D.has(ye)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const V=this._rtpCapabilities.recv.videoCodecs.filter(ye=>S.some(Ee=>{var me;return Ze(me=ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").call(me,Ee)}));if(V.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(I," codecs: ").concat(S)),!1;const M=[...new Set(V.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||""))];let j;if(x.debug("updateRemoteCodec, from ".concat(I," to ").concat(M)),v.length===0)j=this.sessionDesc.mediaDescriptions.filter(ye=>ye.media.mediaType==="video"&&ye.attributes.direction==="recvonly");else if(j=this.sessionDesc.mediaDescriptions.filter(ye=>ye.attributes.mid&&Ze(v).call(v,ye.attributes.mid)&&ye.attributes.direction==="recvonly"),j.length!==v.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(v,", codecs: ").concat(S)),!1;if(te("USE_PUB_RTX")||te("USE_SUB_RTX")){const ye=E1(V,this.rtpCapabilities.recv.videoCodecs);V.push(...ye)}this._rtpCapabilities.recv.videoCodecs=V;const W=this.localCapabilities.send,Y=this.rtpCapabilities.recv,le=zb(lt.VIDEO,Y,W,R);return j.forEach(ye=>{const Ee=le.map(me=>me.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(ye.attributes.mid,", from"),ye.attributes.payloads,"to",le),ye.attributes.payloads=le,ye.media.fmts=Ee}),!0}createOrRecycleSendMedia(v,S,R,I,D){const V=this.rtpCapabilities.send,M=v===lt.VIDEO?V.videoCodecs:V.audioCodecs,j=v===lt.VIDEO?V.videoExtensions:V.audioExtensions;this.currentMidIndex+=1;const W="".concat(this.currentMidIndex);let Y={media:{mediaType:v,port:Qb,protos:["UDP","TLS","RTP","SAVPF"],fmts:M.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:M,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:I,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(W)}};Y=this.mungSendMediaDesc(Y,D);const le=this.findFirstClosedMedia(v);if(le){const ye=this.sessionDesc.mediaDescriptions.indexOf(le);this.sessionDesc.mediaDescriptions[ye]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(v=>v.media.port!=="0").map(v=>v.attributes.mid)}mungRecvMediaDsec(v,S,R){const I=Pr(v);return g1(I),sv(I,S),_1(I,S),X9(I),cI(I,R,this.localCapabilities.send),I}mungSendMediaDesc(v,S){const R=Pr(v);return cI(R,S,this.localCapabilities.recv),av(R),R}updateRecvMedia(v,S){const R=this.sessionDesc.mediaDescriptions.findIndex(I=>I.attributes.mid===v);if(R!==-1){const I=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],S);this.sessionDesc.mediaDescriptions[R]=I}}bumpMid(v){this.currentMidIndex+=v}findFirstClosedMedia(v){return this.sessionDesc.mediaDescriptions.find(S=>Br()?S.media.port==="0"&&S.media.mediaType===v:S.media.port==="0")}findPreloadMediaDesc(v){return this.sessionDesc.mediaDescriptions.find(S=>{var R;return((R=S.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===v[0].ssrcId})}getSSRC(v){var S;return(S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v))===null||S===void 0?void 0:S.attributes.ssrcs}}(gd(gd({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=Z9(this.initialOffer.sdp,this.extension),f=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),f==null||f(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const g=this.peerConnection.getTransceivers()[0];if(g!=null&&g.receiver&&this.tryBindTransportEvents(g.receiver),te("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(te("PRELOAD_MEDIA_COUNT"));const v=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:v});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:E}=t;if(Array.isArray(E)&&E.length>0){const{mids:v}=this.remoteSDP.batchSend(E.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));v.forEach((S,R)=>{this.preSSRCMap.set(E[R].ssrcId,S)}),await Yb(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var r,o}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:r}=t;this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=t;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,f)=>{this.preSSRCMap.set(o[f].ssrcId,u)})}await Yb(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r.toString()))}}send(t,r,o){var c=this;return Ac(function*(){const u=yield In(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const f=[],g=sI();t.forEach(j=>{const W=c.peerConnection.addTransceiver(j._mediaStreamTrack,gd({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&g?{sendEncodings:[{scalabilityMode:g}]}:{}));f.push(W),j._updateRtpTransceiver(W)}),Br()&&te("SIMULCAST")===!0&&(yield In(c.applySimulcastForFirefox(f,t)));const E=yield In(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(t.length),S=c.mungSendOfferSDP(E.sdp,t,v),R=no(S),I=v.map(j=>{const W=R.mediaDescriptions.find(Y=>Y.attributes.mid===j);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return Y9(W,te("USE_PUB_RTX"))});let D;try{D=yield I}catch(j){D=[],c.remoteSDP.receive(t,r,o,D);const W=c.remoteSDP.toString();throw yield In(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield In(c.peerConnection.setRemoteDescription({type:"answer",sdp:W})),yield In(c.stopSending(v,!0)),j}c.remoteSDP.receive(t,r,o,D);const V=c.remoteSDP.toString(),M=c.logSDPExchange(S,"offer","local","send");return yield In(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield In(c.applySimulcastEncodings(f,t)),yield In(c.applySendEncodings(f,t)),M==null||M(V),yield In(c.peerConnection.setRemoteDescription({type:"answer",sdp:V})),f.map((j,W)=>{const Y=v[W];return{localSSRC:I[W],id:Y,transceiver:j}})}catch(f){throw f instanceof Ie?f:new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(f.toString()))}finally{u()}})()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(t);if(o&&o.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:te("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,o)}r.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(f),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Ie?o:new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(t){try{const r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof Ie?r:new Ie(K.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){const o=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(E=>t.indexOf(E.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(E=>{var v;gI(this.id+E.mid,this),E.direction="inactive",(v=E.stop)===null||v===void 0||v.call(E)});const u=await this.peerConnection.createOffer(),f=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(t);const g=this.remoteSDP.toString();f==null||f(g),await this.peerConnection.setRemoteDescription({type:"answer",sdp:g})}catch(c){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(t,r,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:u,needExchangeSDP:f}=this.remoteSDP.send(t,r,o,c);f&&(await Yb(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const g=this.peerConnection.getTransceivers().find(E=>E.mid===u);if(!g)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:g.receiver.track,id:u,transceiver:g}}catch(u){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:r,needExchangeSDP:o}=this.remoteSDP.batchSend(t);return o&&(await Yb(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r.map(c=>{const u=this.peerConnection.getTransceivers().find(f=>f.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(f=>{let[g,E]=f;if(E===u)return this.preSSRCMap.delete(g),!0})}),this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(f=>f.mid&&t.indexOf(f.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(f=>{f.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(t);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(f=>f.mid&&t.indexOf(f.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(f,g)=>{f.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return Ac(function*(){const o=yield In(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=On().supportPCSetConfiguration,u=te("FORCE_TURN_TCP")||r.forceTurn;if(t===js.RELAY&&!c)return;if(c&&!u){const R=t===js.RELAY?"relay":"all",I=r.peerConnection.getConfiguration();I.iceTransportPolicy!==R&&(x.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(I.iceTransportPolicy,"] to [").concat(R,"]")),I.iceTransportPolicy=R,r.peerConnection.setConfiguration(I))}r.remoteSDP.updateCandidates(t);const f=yield In(r.peerConnection.createOffer({iceRestart:!0}));if(!f.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const g=Af(f.sdp),{remoteIceParameters:E}=yield g.iceParameters;r.remoteSDP.restartICE(E);const v=r.remoteSDP.toString(),S=r.logSDPExchange(f.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield In(r.peerConnection.setLocalDescription(f)),S==null||S(v),yield In(r.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){x.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(js.TCP_RELAY),await Yb(this.peerConnection,this.remoteSDP,this.extension)}catch(r){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),r)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(r=>{gI(this.id+r.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return gd(gd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const u=this.remoteSDP.toString(),f=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),f==null||f(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ie(K.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,r){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===t);o.length===1&&(this.isVP8Simulcast(r)?Br()||await this.applySimulcastEncodings(o,[r]):await this.applySendEncodings(o,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const o=this.peerConnection.getTransceivers().find(c=>c.mid===r);o&&await o.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:o,remote:c}=r.getSelectedCandidatePair();return{local:gd(gd({},pu),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:gd(gd({},pu),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var r;const o="code: ".concat(t.errorCode,", message: ").concat(t.errorText),c=t.port?"local: ".concat(t.port):"";x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(t.url||"",", host_candidate:").concat(c)),(r=this.onICECandidateError)===null||r===void 0||r.call(this,o)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},te("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[]};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&(Ob(t.turnServer.servers)?r.iceServers=t.turnServer.servers:te("NEW_TURN_MODE")&&r.iceServers?(te("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&r.iceServers.push(...c_.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):r.iceServers.push(...c_.newTurnServerConfigToIceServers(t.turnServer.servers)),te("NEW_FORCE_TURN")&&(r.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(r.iceServers&&r.iceServers.push(...c_.turnServerConfigToIceServers(t.turnServer.servers)),te("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...c_.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),te("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(r.iceTransportPolicy="relay")}))),te("ENABLE_ENCODED_TRANSFORM")&&On().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach(o=>{o.security?o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Rf(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!te("FORCE_TURN_TCP")&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),r}static newTurnServerConfigToIceServers(t){const r=[];return t.forEach(o=>{const c=te("NEW_TURN_MODE");c===1?r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Rf(o.turnServerURL),":443?transport=tcp")}):c===4&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Rf(o.turnServerURL),":443?transport=tcp")}))}),r}tryBindTransportEvents(t){const r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var c;r!=null&&r.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,r.state))},r.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=r.iceTransport;o&&(o.onstatechange=()=>{const c=r==null?void 0:r.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var o,c;if(r||(r=this.peerConnection.getSenders().find(j=>j.track===t._mediaStreamTrack)),!r)return x.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!On().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},f={};switch(t._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const g=function(M,j){return M.getTransceivers().find(W=>W.sender.track===j||W.receiver.track===j)}(this.peerConnection,t._mediaStreamTrack),E=Nne(t);if(Gre(t)&&g&&r&&E&&this.getLocalVideoStats&&Ze(o=["vp8","vp9"]).call(o,this.store.codec)){var v;const M=u.degradationPreference||(Ze(v=t._hints).call(v,er.CUSTOM_TRACK)?te("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(j,W,Y,le,ye,Ee){if(gI(j,Y),ye(W),le!=="balanced"&&le!=="maintain-framerate"&&le!=="maintain-resolution")return;let me=-1;I6(j,W);const Ae=window.setInterval(()=>{const $e=mI.get(j);if(!te("ENABLE_AG_ADAPTATION")||!$e)return gI(j,Y),void ye(W);const at=Ee();if(at.sendPackets>0&&at.OutgoingAvailableBandwidth>0){if(me===-1)return void(me=Date.now());if(Date.now()-me<1e3)return;const nn=at.sendFrameRate,Xt=at.OutgoingAvailableBandwidth,[Lt,mr]=Hre(j,nn,Xt,$e.adaptationConfig,W,le);mr&&(Y.qualityLimitationReason=mr),Lt&&$e.adaptationConfig.scale!==Lt.scale&&(x.debug("[".concat(j,"] applyAdaptation: ").concat(Y.qualityLimitationReason,`
           sendFps `).concat(nn,", bwe ").concat(Xt,", switch from ").concat($e.adaptationConfig.scale," to ").concat(Lt.scale," ")),$e.adaptationConfig=N1(N1({},$e.adaptationConfig),Lt),ye(Lt))}},te("CHECK_LOCAL_STATS_INTERVAL")),Pe=N1({},W);mI.set(j,{timer:Ae,adaptationConfig:Pe,originConfig:W,adaptationFunc:ye}),x.debug("[".concat(j,"] start adaptation, originConfig: ").concat(JSON.stringify(W),", degradationPreference: ").concat(le))})(this.id+g.mid,E,this,M,j=>{r&&this.updateAdaptation(r,j)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var S;const{bitrateMax:M,frameRate:j,scaleResolutionDownBy:W}=t._encoderConfig;M&&(f.maxBitrate=1e3*M),(Ze(S=t._hints).call(S,er.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(j&&(f.maxFramerate=xo(j)),W&&W>=1&&(f.scaleResolutionDownBy=W))}const{maxFramerate:R}=te("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(f.maxFramerate=f.maxFramerate?Math.min(f.maxFramerate,R):R),te("DSCP_TYPE")&&Vh()){var I;const M=te("DSCP_TYPE");Ze(I=["very-low","low","medium","high"]).call(I,M)&&(f.networkPriority=M)}const D=r.getParameters(),V=(c=D.encodings)===null||c===void 0?void 0:c[0];Br()&&!V&&(u.encodings=[f]),V&&Object.assign(V,f),Object.assign(D,u),x.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(D.encodings))),await r.setParameters(D),await async function(M,j,W){try{var Y;if(!On().supportSetRtpSenderParameters||!function(Ae){return Ae==="vp9"||Ae==="av1"}(M)||!te("ENABLE_SVC"))return;const le={},ye={},Ee=j.getParameters(),me=(Y=Ee.encodings)===null||Y===void 0?void 0:Y[0];ye.scalabilityMode=sI(W),me&&Object.assign(me,ye),Object.assign(Ee,le),await j.setParameters(Ee),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Ee.encodings)))}catch(le){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",le)}}(this.store.codec,r,te("SVC_MODE"))}async updateAdaptation(t,r){var o,c;if(!t)return x.debug("[updateAdaptation] no rtpSender found");if(!On().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:f,frameRate:g,scaleResolutionDownBy:E}=r;f&&(u.maxBitrate=1e3*f),g&&(u.maxFramerate=xo(g)),E&&E>=1&&Ze(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=E);const v=t.getParameters(),S=(c=v.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(v,{});try{await t.setParameters(v),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(R){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!On().supportSetRtpSenderParameters||t.length!==r.length)return;for(let o=0;o<t.length;o++){const c=t[o],u=r[o];u instanceof Er&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,o){const c=no(t);return r.forEach((u,f)=>{const g=o[f],E=c.mediaDescriptions.find(v=>v.attributes.mid===g);E&&(sv(E,u),Q9(E,u,this.store.codec))}),Tf(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let E=0;E<t.length;E++){var o,c,u,f,g;const v=t[E],S=r[E];if(S instanceof Er&&!Ze(o=S._hints).call(o,er.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(f=S._scalabilityMode)!==null&&f!==void 0&&f.numSpatialLayers&&((g=S._scalabilityMode)===null||g===void 0?void 0:g.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},I={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const D=v.sender.getParameters();await v.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(t,r){if(!Br()&&t.length===r.length)for(let o=0;o<t.length;o++){const c=r[o];if(c instanceof Er&&this.isVP8Simulcast(c)){const u=t[o],f={},g={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:g.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:g.medium,scaleResolutionDownBy:4}];const E=u.sender.getParameters();await u.sender.setParameters(Object.assign(E,f))}}}isVP8Simulcast(t){var r,o,c,u,f;return!!(t instanceof Er&&te("SIMULCAST")&&this.store.codec==="vp8"&&!Ze(r=t._hints).call(r,er.LOW_STREAM)&&(o=t._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=t._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((f=t._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1)}logSDPExchange(t,r,o,c){if(te("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(r," SDP during P2PConnection.").concat(c,`
`),t),r==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(t){if(On().supportPCSetConfiguration){const r=c_.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},gt(wn.prototype,"updateRemoteRTPCapabilities",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"updateRemoteRTPCapabilities"),wn.prototype),gt(wn.prototype,"connect",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"connect"),wn.prototype),gt(wn.prototype,"updateRemoteConnect",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"updateRemoteConnect"),wn.prototype),gt(wn.prototype,"createDataChannels",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"createDataChannels"),wn.prototype),gt(wn.prototype,"receive",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"receive"),wn.prototype),gt(wn.prototype,"batchReceive",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"batchReceive"),wn.prototype),gt(wn.prototype,"stopReceiving",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"stopReceiving"),wn.prototype),gt(wn.prototype,"muteRemote",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"muteRemote"),wn.prototype),gt(wn.prototype,"unmuteRemote",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteRemote"),wn.prototype),gt(wn.prototype,"muteLocal",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"muteLocal"),wn.prototype),gt(wn.prototype,"unmuteLocal",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteLocal"),wn.prototype),gt(wn.prototype,"close",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"close"),wn.prototype),gt(wn.prototype,"updateEncoderConfig",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"updateEncoderConfig"),wn.prototype),gt(wn.prototype,"updateSendParameters",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"updateSendParameters"),wn.prototype),gt(wn.prototype,"replaceTrack",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"replaceTrack"),wn.prototype),gt(wn.prototype,"updateAdaptation",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"updateAdaptation"),wn.prototype),gt(wn.prototype,"getRemoteSSRC",[Ma],Object.getOwnPropertyDescriptor(wn.prototype,"getRemoteSSRC"),wn.prototype),wn);function Ma(e,t,r){const o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(t));try{for(var f=arguments.length,g=new Array(f),E=0;E<f;E++)g[E]=arguments[E];return await o.apply(this,g)}finally{u()}},r}function P1(e,t){let r=document.createElement("video"),o=document.createElement("canvas");r.setAttribute("style","display:none"),o.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),o.width=xo(t.width),o.height=xo(t.height);const c=xo(t.framerate||15);document.body.append(r),document.body.append(o);let u=e._mediaStreamTrack;r.srcObject=new MediaStream([u]),r.play();const f=o.getContext("2d");if(!f)throw new Te(K.UNEXPECTED_ERROR,"can not get canvas context");const g=On(),E=o.captureStream(g.supportRequestFrame?0:c).getVideoTracks()[0];E.canvas||(E.canvas=o),o.startCapture=()=>{if(!r)return o.stopCapture&&o.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const S=r.videoWidth,R=r.videoHeight/S,I=o.width*R;Math.abs(I-o.height)>=2&&(x.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(I)),o.height=I)}f.drawImage(r,0,0,o.width,o.height),E.requestFrame&&E.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,r.srcObject=new MediaStream([u]))},o.stopCapture=Gk(()=>o.startCapture&&o.startCapture(),c);const v=E.stop;return E.stop=()=>{v.call(E),r&&(r.remove(),r.srcObject=null,r=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),x.debug("clean low stream renderer")},E}var wl=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e[e.Video_Send_Type=2225]="Video_Send_Type",e}(wl||{}),Ft=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(Ft||{}),us=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(us||{}),ja=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(ja||{}),EI=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(EI||{});const qg=1e3,yI=6,$b=3,Yre=Math.max(yI,$b);function At(e,t,r){r!=null&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function P6(e){const t={[ja.CONN_TYPE]:0,[ja.RTT]:e.rtt,[ja.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r=e.selectedCandidatePair.localCandidate.relayProtocol;r==="udp"&&(t[ja.CONN_TYPE]=1),r==="tcp"&&(t[ja.CONN_TYPE]=3),r==="tls"&&(t[ja.CONN_TYPE]=4);break}case"srflx":t[ja.CONN_TYPE]=2;break;case"unknown":t[ja.CONN_TYPE]=5;break;default:t[ja.CONN_TYPE]=0}return t}function k6(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class L6 extends xr{constructor(t){super(),H(this,"store",void 0),H(this,"uploadWRTCStatsTimer",void 0),H(this,"uploadOutboundDenoiserStatsTimer",void 0),H(this,"uploadExtStatsTimer",void 0),H(this,"uploadExtUsageStatsTimer",void 0),H(this,"uploadInboundExtStatsTimer",void 0),H(this,"requestStats",void 0),H(this,"requestTransportStats",void 0),H(this,"requestLocalMedia",void 0),H(this,"requestRemoteMedia",void 0),H(this,"requestAllTracks",void 0),H(this,"requestVideoIsReady",void 0),H(this,"requestUploadStats",void 0),H(this,"requestUpload",void 0),H(this,"uploadOutboundStarted",!1),H(this,"uploadInboundStarted",!1),H(this,"uploadTransportStarted",!1),H(this,"uploadBaseStatsStarted",!1),H(this,"uploadExtensionUsageStarted",!1),H(this,"lastRecvStats",void 0),H(this,"lastSendStats",void 0),H(this,"lastRefRecvStats",void 0),H(this,"lastRefSendStats",void 0),H(this,"lastNormalRecvStats",void 0),H(this,"lastNormalSendStats",void 0),H(this,"needUploadRenderFreezeTime",!0),H(this,"lastUploadCompensateTime",-1),H(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const r=t%$b==0,o=t%yI==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var f;const g={};if(this.uploadTransportStarted&&c){const v=this.getTransportStats(c,u,r);v&&(g.misc=[v])}if(this.uploadOutboundStarted&&c){const v=this.getOutboundStats(c,o?this.lastNormalSendStats:void 0,r?this.lastRefSendStats:void 0,this.lastSendStats);v&&(g.outbound=[v])}if(this.uploadInboundStarted&&u){this.uploadCompensateStats(t);const v=this.getInboundStats(u,o?this.lastNormalRecvStats:void 0,r?this.lastRefRecvStats:void 0,this.lastRecvStats);v&&(g.inbound=v)}const E=(f=this.requestTransportStats)===null||f===void 0?void 0:f.call(this).connectState;E&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[EI.RTC_PEER_CONNECTION_STATE]=Ik[E]):g.misc=[{addition:{[EI.RTC_PEER_CONNECTION_STATE]:Ik[E]}}]),this.requestUploadStats(g)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastNormalRecvStats=u,this.lastNormalSendStats=c),r&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var r,o;const c=(r=this.requestTransportStats)===null||r===void 0?void 0:r.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[EI.RTC_PEER_CONNECTION_STATE]:Ik[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===Yre+1&&(t=1)},qg)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const r=t%$b==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!r)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const o=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=o,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;const u=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const f={};if(this.uploadInboundStarted&&u){const g=this.requestRemoteMedia()||[],E=[];g.forEach(v=>{let[S,R]=v;const I={peer:S.uid};if(S._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(S._videoSSRC)&&R.has(lt.VIDEO)&&S.videoTrack){const D=function(V,M,j){if(!M.videoRecv.find(Y=>Y.ssrc===V))return;const W={};if(j&&j._player){const Y=j._player,{renderFreezeAccTime2:le,videoElementStatus:ye}=Y;if(gu.visibility==="visible"&&ye===Js.PLAYING&&On().supportRequestVideoFrameCallback){const Ee=Math.min(6e3,le);Y.renderFreezeAccTime2=Math.max(0,le-Ee),At(W,wl.Video_Render_Freeze_Time_Render2,Ee),te("USE_NEW_RENDER_FREEZE_TIME")&&At(W,wl.Video_Render_Freeze_Time_Render,Ee)}}return W}(S._videoSSRC,u,S.videoTrack);D&&(I.video=D)}I.video&&E.push(I)}),E.length>0&&(f.inbound=E,this.requestUploadStats(f))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,r,o){if(!this.requestStats)return;if(!o)return t.rtt==null?void 0:{addition:{[ja.RTT]:t.rtt,[ja.CONN_TYPE]:void 0,[ja.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const c=P6(t);if(this.store.useP2P){if(r){const u=P6(r);c[ja.CONN_TYPE]+=u[ja.CONN_TYPE]<<3}c[ja.CONN_TYPE]+=110}else c[ja.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(t,r,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let f,g,E;return u.forEach(v=>{let[S,{track:R,ssrcs:I}]=v;switch(S){case Fe.LocalVideoLowTrack:case Fe.LocalVideoTrack:if(S===Fe.LocalVideoTrack){const D=function(j,W,Y,le,ye,Ee){const me=W.videoSend.find(nn=>nn.ssrc===j);if(!me)return;const Ae={},{sentFrame:Pe,inputFrame:$e}=me;if(le&&(At(Ae,wl.Video_Send_Qp_Sum,me.qpSumPerFrame),$e&&Pe)){var at;const nn=$e.frameRate,Xt=Pe.frameRate;Ae[wl.Video_Send_Freeze]=function(Lt,mr){let tr=!0;return tr=!(Lt<=5)&&(Lt<=10?mr<3:Lt<=20?mr<4:mr<5),tr}(nn,Xt)?1:0,Ae[wl.Video_Send_Type]=Y.__className__==="CameraVideoTrack"?0:Ze(at=Y._hints).call(at,er.SCREEN_TRACK)?1:2}if(ye){switch(Pe&&(At(Ae,Ft.Video_Send_Height,Pe.height),At(Ae,Ft.Video_Send_Width,Pe.width),At(Ae,Ft.Video_Send_Frame_Rate,Pe.frameRate)),Ae[Ft.Video_Send_Disabled]=Y._originMediaStreamTrack&&!Y._originMediaStreamTrack.enabled||Y._mediaStreamTrack&&!Y._mediaStreamTrack.enabled?1:0,me.adaptionChangeReason){case"none":Ae[Ft.Video_Send_Adaptation]=0;break;case"cpu":Ae[Ft.Video_Send_Adaptation]=1;break;case"bandwidth":Ae[Ft.Video_Send_Adaptation]=2;break;case"other":Ae[Ft.Video_Send_Adaptation]=3}let nn=0;me.adaptionChangeReason&&(nn+=k6(me.adaptionChangeReason)),W.qualityLimitationReason&&(nn+=k6(W.qualityLimitationReason)<<3),Ae[Ft.Video_Send_Adaptation]=nn,Ae[Ft.Video_Send_Player_Status]=Bk[Y._player?Y._player.videoElementStatus:"uninit"],At(Ae,Ft.Video_Send_Nacks,me.nacksCount),At(Ae,Ft.Video_Send_Plis,me.plisCount),At(Ae,Ft.Video_Send_Firs,me.firsCount),At(Ae,Ft.Video_Send_Avg_Encode,me.avgEncodeMs),At(Ae,Ft.Video_Send_Huge_Frame_Sent,me.hugeFramesSent),At(Ae,Ft.Video_Send_Bytes_Retransmit,me.retransmittedBytesSent),At(Ae,Ft.Video_Send_Packages_Retransmit,me.retransmittedPacketsSent),At(Ae,Ft.Video_Send_Key_Frames_Encoded,me.keyFramesEncoded);const Xt=ye.videoSend.find(Lt=>Lt.ssrc===j);if(Xt){let Lt=qg*$b;Xt.timestamp&&me.timestamp&&(Lt=me.timestamp-Xt.timestamp),Xt.packets!=null&&me.packets!=null&&At(Ae,Ft.Video_Send_Package_Rate,1e3*(me.packets-Xt.packets)/Lt),me.packetsLost!=null&&Xt.packetsLost!=null&&At(Ae,Ft.Video_Send_Package_Lost,me.packetsLost-Xt.packetsLost),Xt.bytes!=null&&me.bytes!=null&&At(Ae,Ft.Video_Send_Bitrate,8*(me.bytes-Xt.bytes)/Lt)}}return Ae}(I[0].ssrcId,t,R,r,o),V=R&&function(j,W,Y,le){const ye=W.videoSend.find(me=>me.ssrc===j);if(!ye)return null;const Ee={};if(le){const me=ye.inputFrame,Ae=me&&me.height||Y.videoHeight||0,Pe=me&&me.width||Y.videoWidth||0,$e=me&&me.frameRate||0;At(Ee,Ft.Video_Capture_Height,Ae),At(Ee,Ft.Video_Capture_Width,Pe),At(Ee,Ft.Video_Capture_Frame_Rate,$e)}return Ee}(I[0].ssrcId,t,R,!!o),M=function(j,W){const Y={};return W&&(At(Y,Ft.Video_Send_Retransmit,j.bitrate.retransmit),At(Y,Ft.Video_Send_Target_Encoded,j.bitrate.targetEncoded),At(Y,Ft.Video_Send_Actual_Encoded,j.bitrate.actualEncoded),At(Y,Ft.Video_Send_Transmit,j.bitrate.transmit),At(Y,Ft.Video_Send_Bandwidth,j.sendBandwidth)),Y}(t,!!o);g=Object.assign({},D,V,M)}else E=function(D,V,M,j,W){const Y=V.videoSend.find(ye=>ye.ssrc===D);if(!Y)return;const le={};if(j){const ye=Y.sentFrame;ye&&(At(le,Ft.Video_Send_Low_Height,ye.height),At(le,Ft.Video_Send_Low_Width,ye.width),At(le,Ft.Video_Send_Low_Frame_Rate,ye.frameRate));const Ee=j.videoSend.find(me=>me.ssrc===D);if(Ee){let me=qg*yI;Ee.timestamp&&Y.timestamp&&(me=Y.timestamp-Ee.timestamp),Ee.packets!=null&&Y.packets!=null&&At(le,Ft.Video_Send_Low_Package_Rate,1e3*(Y.packets-Ee.packets)/me),Y.packetsLost!=null&&Ee.packetsLost!=null&&At(le,Ft.Video_Send_Low_Package_Lost,Y.packetsLost-Ee.packetsLost),Ee.bytes!=null&&Y.bytes!=null&&At(le,Ft.Video_Send_Low_Bitrate,8*(Y.bytes-Ee.bytes)/me)}}return le}(I[0].ssrcId,t,0,o);break;case Fe.LocalAudioTrack:f=R&&function(D,V,M,j,W,Y){const le=V.audioSend.find(Ee=>Ee.ssrc===D);if(!le)return;const ye={};if(W){ye[Ft.Audio_Send_Disabled]=M._originMediaStreamTrack&&!M._originMediaStreamTrack.enabled||M._mediaStreamTrack&&!M._mediaStreamTrack.enabled?1:0;const Ee=100*M._source.getAccurateVolumeLevel(),me=le.inputLevel;if(me!=null){const Pe=Math.ceil(50*Math.log10(100*me+1));At(ye,Ft.Audio_Send_Level,Pe)}At(ye,Ft.Audio_Capture_PCM_Level,Ee),At(ye,Ft.Audio_Send_AEC_Return_Loss,le.aecReturnLoss),At(ye,Ft.Audio_Send_AEC_Return_Loss_Enhancement,le.aecReturnLossEnhancement),At(ye,Ft.Audio_Send_Bytes_Retransmit,le.retransmittedBytesSent),At(ye,Ft.Audio_Send_Packages_Retransmit,le.retransmittedPacketsSent),ye[Ft.Audio_Send_Freeze]=0;const Ae=W.audioSend.find(Pe=>Pe.ssrc===D);if(Ae){let Pe=qg*yI;Ae.timestamp&&le.timestamp&&(Pe=le.timestamp-Ae.timestamp),Ae.bytes!=null&&le.bytes!=null&&At(ye,Ft.Audio_Send_Bitrate,8*(le.bytes-Ae.bytes)/Pe),Ae.packets!=null&&le.packets!=null&&At(ye,Ft.Audio_Send_Package_Rate,1e3*(le.packets-Ae.packets)/Pe)}}return ye}(I[0].ssrcId,t,R,0,o)}}),{high:g,low:E,audio:f}}getInboundStats(t,r,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],f=[];return u.forEach(g=>{let[E,v]=g;const S={peer:E.uid};if(v.has(lt.VIDEO)&&E.videoTrack){const R=E._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(E._videoSSRC)||!1,I=E.videoTrack?function(D,V,M,j,W,Y,le,ye){const Ee=V.videoRecv.find(Lt=>Lt.ssrc===D);if(!Ee)return;const me={},{receivedFrame:Ae,outputFrame:Pe,decodeFrameRate:$e}=Ee;At(me,us.Video_Render_Frame_Rate_Decode,$e),Ee.framesRateFirefox&&At(me,us.Video_Recv_Frame_Rate,Ee.framesRateFirefox),Ae&&At(me,us.Video_Recv_Frame_Rate,Ae.frameRate),At(me,us.Video_Recv_Frame_Dropped,Ee.framesDroppedCount),At(me,us.Video_Recv_Bytes_Retransmit,Ee.retransmittedBytesReceived),At(me,us.Video_Recv_Packages_Retransmit,Ee.retransmittedPacketsReceived),At(me,us.Video_Recv_Packages_Discarded,Ee.packetsDiscarded),At(me,us.Video_Recv_Avg_Decode,Ee.avgDecodeMs),At(me,us.Video_Recv_Avg_Processing_Delay,Ee.avgProcessingDelayMs),At(me,us.Video_Recv_Avg_Assembly_Time,Ee.avgFramesAssembledFromMultiplePacketsMs),At(me,us.Video_Recv_Avg_Inter_Frame_Delay,Ee.avgInterFrameDelayMs),At(me,us.Video_Recv_Key_Frames_Decoded,Ee.keyFramesDecoded);const at=ye&&ye.videoRecv.find(Lt=>Lt.ssrc===D);if(at){const Lt=V.timestamp-ye.timestamp||qg;Ee.packetsLost!=null&&at.packetsLost!=null&&At(me,us.Video_Recv_Package_Lost,Ee.packetsLost-at.packetsLost),at.bytes!=null&&Ee.bytes!=null&&At(me,us.Video_Recv_Bitrate,8*(Ee.bytes-at.bytes)/Lt),at.packets!=null&&Ee.packets!=null&&At(me,us.Video_Recv_Package_Rate,1e3*(Ee.packets-at.packets)/Lt)}const nn=Y&&Y.videoRecv.find(Lt=>Lt.ssrc===D);if(nn&&(At(me,wl.Video_Recv_Qp_Sum,Ee.qpSumPerFrame),me[wl.Video_Recv_Freeze]=j&&Xb.isRemoteVideoFreeze(M,Ee,nn)?1:0),le){var Xt;const Lt=le.videoRecv.find(tr=>tr.ssrc===D);Ae?(At(me,Ft.Video_Recv_Height,Ae.height),At(me,Ft.Video_Recv_Width,Ae.width)):M&&(At(me,Ft.Video_Recv_Height,M._videoHeight||0),At(me,Ft.Video_Recv_Width,M._videoWidth||0)),Pe&&At(me,Ft.Video_Recv_Frame_Rate_Output,Pe.frameRate);const mr=(Xt=M._player)===null||Xt===void 0?void 0:Xt.rendFrameRate.toFixed(0);if(mr&&At(me,Ft.Video_Render_Frame_Rate_Render,+mr),At(me,Ft.Video_Recv_Jitter_Buffer,Ee.jitterBufferMs),At(me,Ft.Video_Recv_Current_Delay,Ee.currentDelayMs),At(me,Ft.Video_Recv_Firs,Ee.firsCount),At(me,Ft.Video_Recv_Nacks,Ee.nacksCount),At(me,Ft.Video_Recv_Plis,Ee.plisCount),M){me[Ft.Video_Recv_Disabled]=M._originMediaStreamTrack.enabled&&M._mediaStreamTrack.enabled?0:1;const tr=M._player;if(tr){const{freezeTimeCounterList:Va,renderFreezeAccTime:ke,renderFreezeAccTime2:Ye,videoElementStatus:pt}=tr;if(Va&&Va.length>0&&At(me,wl.Video_Render_Freeze_Time,Va.splice(0,1)[0]),W&&gu.visibility==="visible"&&pt===Js.PLAYING&&On().supportRequestVideoFrameCallback){const Le=Math.min(6e3,Ye);tr.renderFreezeAccTime2=Math.max(0,Ye-Le),At(me,wl.Video_Render_Freeze_Time_Render2,Le);const L=Math.min(6e3,ke);tr.renderFreezeAccTime=Math.max(0,ke-L),At(me,wl.Video_Render_Freeze_Time_Render,te("USE_NEW_RENDER_FREEZE_TIME")?Le:L)}if(typeof Ee.totalFreezesDuration=="number"){const Le=Lt&&Lt.totalFreezesDuration?Ee.totalFreezesDuration-Lt.totalFreezesDuration:Ee.totalFreezesDuration;At(me,Ft.Video_Render_Freeze_Duration,1e3*Le)}}}if(me[Ft.Video_Recv_Player_Status]=Bk[M._player?M._player.videoElementStatus:"uninit"],Lt&&Ee.totalInterFrameDelay!==void 0&&Ee.totalSquaredInterFrameDelay!==void 0&&Lt.totalInterFrameDelay!==void 0&&Lt.totalSquaredInterFrameDelay!==void 0){const tr=Ee.totalInterFrameDelay-Lt.totalInterFrameDelay,Va=Ee.totalSquaredInterFrameDelay-Lt.totalSquaredInterFrameDelay,ke=Ee.framesDecodeCount-Lt.framesDecodeCount,Ye=tr/ke*1e3,pt=Math.round(1e3*Math.sqrt((Va-Math.pow(tr,2)/ke)/ke));!isNaN(pt)&&Ye+pt>Math.max(3*Ye,Ye+150)&&(me[Ft.Video_Recv_I_Frame_Delay]=pt)}}return me}(E._videoSSRC,t,E.videoTrack,R===!0,this.needUploadRenderFreezeTime,r,o,c):void 0;I&&(S.video=I)}if(v.has(lt.AUDIO)&&E.audioTrack){const R=E.audioTrack?function(I,D,V,M,j,W){const Y=D.audioRecv.find(me=>me.ssrc===I);if(!Y)return;const le={};At(le,us.Audio_Recv_Jitter,Y.jitterMs),At(le,us.Audio_Recv_Bytes_Retransmit,Y.retransmittedBytesReceived),At(le,us.Audio_Recv_Packages_Retransmit,Y.retransmittedPacketsReceived),At(le,us.Audio_Recv_Packages_Discarded,Y.packetsDiscarded),At(le,us.Audio_Recv_Avg_Processing_Delay,Y.avgProcessingDelayMs);const ye=W&&W.audioRecv.find(me=>me.ssrc===I);if(ye){const me=qg;Y.packets!=null&&ye.packets!=null&&At(le,us.Audio_Recv_Package_Rate,1e3*(Y.packets-ye.packets)/me),Y.packetsLost!=null&&ye.packetsLost!=null&&At(le,us.Audio_Recv_Package_Lost,Y.packetsLost-ye.packetsLost)}if(M){const{receivedFrames:me,droppedFrames:Ae}=Y;me!=null&&Ae!=null&&(le[wl.Audio_Recv_Freeze]=(Ee=me)===0||100*Ae/Ee>20?1:0)}var Ee;if(j){const me=100*V._source.getAccurateVolumeLevel(),Ae=Y.outputLevel;if(Ae!=null){const $e=Math.ceil(50*Math.log10(100*Ae+1));At(le,Ft.Audio_Render_Level,$e)}At(le,Ft.Audio_Recv_PCM_Level,me),V&&(le[Ft.Audio_Recv_Disabled]=V._originMediaStreamTrack.enabled&&V._mediaStreamTrack.enabled?0:1),At(le,Ft.Audio_Recv_Jitter_Buffer,Y.jitterBufferMs),At(le,Ft.Audio_Recv_Current_Delay,Y.jitterBufferMs),le[Ft.Audio_Recv_Player_Status]=Bk[La.getPlayerState(V.getTrackId())];const Pe=j.audioRecv.find($e=>$e.ssrc===I);if(Pe){Pe.bytes!=null&&Y.bytes!=null&&At(le,Ft.Audio_Recv_Bitrate,8*(Y.bytes-Pe.bytes)/(qg*$b));const $e=Y.concealedSamples-Pe.concealedSamples;$e>0&&At(le,Ft.Audio_Recv_Concealed_Samples,$e);const at=Y.totalSamplesReceived-Pe.totalSamplesReceived;at>0&&At(le,Ft.Audio_Recv_Total_Samples_Received,at);const nn=Y.freezeSamples80-Pe.freezeSamples80;nn>0&&At(le,Ft.Audio_Render_Freeze_Samples_80ms,nn);const Xt=Y.freezeSamples200-Pe.freezeSamples200;Xt>0&&At(le,Ft.Audio_Render_Freeze_Samples_200ms,Xt);const Lt=Y.freezeMs80-Pe.freezeMs80;At(le,Ft.Audio_Render_Freeze_Time_80ms,Lt<0?0:Lt);const mr=Y.freezeMs200-Pe.freezeMs200;At(le,Ft.Audio_Render_Freeze_Time_200ms,mr<0?0:mr)}}return le}(E._audioSSRC,t,E.audioTrack,r,o,c):void 0;R&&(S.audio=R)}(S.video||S.audio)&&f.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,f}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(r=>r instanceof jb);if(t&&t._external.getDenoiserStats){const r=t._external.getDenoiserStats();r&&this.requestUpload(Vb.DENOISER_STATS,r)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[r,o]=t;o.has(lt.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(lt.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const r=Date.now(),o={connectionInterval:te("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of u)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const f=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,S]of f)S.has(lt.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),S.has(lt.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(v,S){const R={};for(const{id:M,value:j,level:W,direction:Y}of v){var I;const le=(I=S.get(M))!==null&&I!==void 0?I:0,ye=j===2?le+te("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:le;var D,V;S.set(M,ye),R[M]?(j===2&&(R[M].value=j),W>R[M].level&&(R[M].level=W),Y==="remote"&&(R[M].remoteUidCount+=1),R[M].totalTs=(D=S.get(M))!==null&&D!==void 0?D:0):R[M]={value:j,level:W,remoteUidCount:Y==="local"?0:1,totalTs:(V=S.get(M))!==null&&V!==void 0?V:0}}return Object.keys(R).map(M=>{const{level:j,value:W,totalTs:Y}=R[M];return{id:M,level:j,value:W,totalTs:Y}})}(c,t);const g=Date.now(),E=g>r?g:r+1;this.requestUpload&&this.requestUpload(Vb.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:E})},te("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const qre=te("ICE_RESTART_INTERVAL");let vI=new Map,dv=new Map,Of=[js.UDP_TCP_RELAY,js.TCP_RELAY,js.RELAY],k1=te("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&On().supportPCSetConfiguration;function M6(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=vI.get(e.id);r&&(window.clearTimeout(r),vI.delete(e.id));const o=dv.get(e.id);t&&o&&o.index===Of.length-1&&(x.debug("[".concat(e.id,"] reset ICE restart policy")),dv.delete(e.id))}function j6(e,t,r){if(vI.size===0&&dv.size===0&&(Array.isArray(te("RESTART_SEQUENCE"))&&te("RESTART_SEQUENCE").length>0&&!function(g,E){if(g.length!==E.length)return!1;for(let v=0;v<g.length;v+=1){const S=g[v];if(g.filter(R=>R===S).length!==E.filter(R=>R===S).length)return!1}return!0}(Of,te("RESTART_SEQUENCE"))&&(Of=te("RESTART_SEQUENCE").filter(g=>{var E;if(Ze(E=Object.values(js)).call(E,g))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(Of.join(" => ")))),k1=te("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&On().supportPCSetConfiguration),Of.length===0)return void r();let o,{index:c=0,type:u}=dv.get(e.id)||{};if(k1&&u===js.RELAY)return void r();let f=u&&c>=Of.length-1;if(k1)u=js.RELAY;else{if(f)return void r();u?(c++,u=Of[c]):(u=Of[0],c=0)}x.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),t(u),dv.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>j6(e,t,r),qre),vI.set(e.id,o)}var pn;function U6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Su(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?U6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function V6(e){var t,r,o,c=2;for(typeof Symbol<"u"&&(r=nk,o=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(o&&(t=e[o])!=null)return new SI(t.call(e));r="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function SI(e){function t(r){if(Object(r)!==r)return tt.reject(new TypeError(r+" is not an object."));var o=r.done;return tt.resolve(r.value).then(function(c){return{value:c,done:o}})}return SI=function(r){this.s=r,this.n=r.next},SI.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var o=this.s.return;return o===void 0?tt.resolve({value:r,done:!0}):t(o.apply(this.s,arguments))},throw:function(r){var o=this.s.return;return o===void 0?tt.reject(r):t(o.apply(this.s,arguments))}},new SI(e)}let Jb=(pn=class extends xr{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Rt.StateChange,t,this._state)}constructor(e,t){super(),H(this,"isPlanB",void 0),H(this,"store",void 0),H(this,"statsUploader",void 0),H(this,"connection",void 0),H(this,"localTrackMap",new Map),H(this,"remoteUserMap",new Map),H(this,"localDataChannels",[]),H(this,"remoteDataChannelMap",new Map),H(this,"pendingLocalTracks",[]),H(this,"pendingRemoteTracks",[]),H(this,"pendingLocalDataChannels",[]),H(this,"pendingRemoteDataChannels",[]),H(this,"statsCollector",void 0),H(this,"shouldForwardP2PCreation",void 0),H(this,"iceFailedCount",0),H(this,"dtlsFailedCount",0),H(this,"mutex",void 0),H(this,"_state",Fn.Disconnected),H(this,"_pcStatsUploadType",te("NEW_ICE_RESTART")?zh.FIRST_CONNECTION:zh.OLD_FIRST_CONNECTION),H(this,"_isStartRestartIce",!1),H(this,"_restartTimer",void 0),H(this,"_isTryConnecting",!1),H(this,"_iceError",null),H(this,"_forceTurn",!1),H(this,"_isWaitPcToRePub",!1),H(this,"handleMuteLocalTrack",async(r,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Fn.Connected)return void c(new Ie(K.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const f=this.filterTobeMutedTracks(r);if(f.length===0)return void o();const g=f.find(v=>v[0]==="videoLowTrack");g&&g[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(f.map(v=>{let[,{id:S}]=v;return S}));const E=this.createMuteMessage(f);await ir(this,Rt.RequestMuteLocal,E),o()}catch(f){c(f)}finally{u()}}),H(this,"handleUnmuteLocalTrack",async(r,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Fn.Connected)return void c(new Ie(K.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const f=this.filterTobeUnmutedTracks(r);if(f.length===0)return void o();const g=f.find(v=>v[0]==="videoLowTrack");if(g){const v=g[1];if(v.track._originMediaStreamTrack.stop(),!te("DISABLE_DUAL_STREAM_USE_ENCODING")&&On().supportDualStreamEncoding){const S=r._mediaStreamTrack.clone();v.track._mediaStreamTrack=S,v.track._originMediaStreamTrack=S}else{const S=P1(r,Db(this,Rt.RequestLowStreamParameter));v.track._mediaStreamTrack=S,v.track._originMediaStreamTrack=S}await new tt((S,R)=>{this.handleReplaceTrack(v.track,S,R,!0)})}await this.connection.unmuteLocal(f.map(v=>{let[,{id:S}]=v;return S}));const E=this.createUnmuteMessage(f);await ir(this,Rt.RequestUnmuteLocal,E),o()}catch(f){c(f)}finally{u()}}),H(this,"handleUpdateVideoEncoder",async(r,o,c,u)=>{let f;u||(f=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const E=this.localTrackMap.get(Fe.LocalVideoTrack);if(!this.connection||!E||E.track!==r||this.state!==Fn.Connected)return void o();const{id:v,track:S}=E;await this.connection.updateSendParameters(v,S),await this.connection.updateEncoderConfig(v,S),this.emit(Rt.UpdateVideoEncoder,S),o()}catch(E){c(E)}finally{var g;(g=f)===null||g===void 0||g()}}),H(this,"handleUpdateVideoSendParameters",async(r,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const f=this.localTrackMap.get(Fe.LocalVideoTrack);if(!this.connection||!f||f.track!==r||this.state!==Fn.Connected)return void o();const{id:g,track:E}=f;await this.connection.updateSendParameters(g,E),o()}catch(f){c(f)}finally{u()}}),H(this,"handleReplaceMixingTrack",async(r,o,c,u)=>{if(!this.connection||this.state!==Fn.Connected)return void o();const f=D1([r]);let g;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(f.getTrackId(),"]")),typeof u=="boolean"&&u||(g=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r,f),o()}catch(v){c(v)}finally{var E;(E=g)===null||E===void 0||E()}}),H(this,"handleReplaceTrack",async(r,o,c,u)=>{let f;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof u=="boolean"&&u||(f=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var g;const v=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return r===R});if(!this.connection||!v||this.state!==Fn.Connected)return void o();if(await((g=this.connection)===null||g===void 0?void 0:g.replaceTrack(r,v[1].id)),this.isPlanB){const S=v[1];S.id=r._mediaStreamTrack.id,this.localTrackMap.set(v[0],S)}if(v[0]===Fe.LocalVideoTrack&&!te("DISABLE_DUAL_STREAM_USE_ENCODING")&&On().supportDualStreamEncoding){const S=this.localTrackMap.get(Fe.LocalVideoLowTrack);if(S){const R=r._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new tt((I,D)=>{this.handleReplaceTrack(S.track,I,D,!0)})}}o()}catch(v){c(v)}finally{var E;(E=f)===null||E===void 0||E()}}),H(this,"handleGetRTCStats",r=>{r(this.statsCollector.getRTCStats())}),H(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),H(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),H(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),H(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new L6(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ls("P2PChannel-mutex",this.store.clientId),this.isPlanB=!On().supportUnifiedPlan||te("CHROME_FORCE_PLAN_B")&&Vh(),this.shouldForwardP2PCreation=te("FORWARD_P2P_CREATION")&&On().supportPCSetConfiguration&&fk(),this.shouldForwardP2PCreation&&(this.connection=_I(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=Fn.New,this._forceTurn=D6(e),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=_I(this.store,e),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Ie(K.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=te("NEW_ICE_RESTART")?zh.FIRST_CONNECTION:zh.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Ie(K.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");te("ENABLE_PREALLOC_PC")&&this.state===Fn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Fn.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[f]=c;return Ze(u=[Fe.LocalVideoLowTrack,Fe.LocalVideoTrack]).call(u,f)}),r=t.map(c=>{let[,{id:u}]=c;return u}),o=t.map(c=>{let[u]=c;return u});if(this.connection instanceof vu){if(St.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Ze(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>Ze(e).call(e,u));c&&(this.store.codec=c,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async getEstablishParams(){var e;if(this.connection instanceof vu&&this.connection.peerConnectionState!=="closed"&&Ze(e=[Fn.New,Fn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Fn.Connected){if(this.state===Fn.Disconnected)throw new Ie(K.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(r=>{var o;Ze(o=this.pendingLocalDataChannels).call(o,r)||this.pendingLocalDataChannels.push(r)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(r=>{const o=Date.now();this.store.publish(r.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(r=>{this.localDataChannels.push(r);const o=Date.now();this.store.publish(r.id+"","datachannel",void 0,o)}),e.map(r=>({streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId})))}publish(e,t,r){var o=this;return Ac(function*(){const c=yield In(o.mutex.lock("From P2PChannel.publish"));try{var u;const f=o.connection&&Ze(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==Fn.Connected||f){if(o.state===Fn.Disconnected)throw new Ie(K.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const E=e.filter(v=>o.pendingLocalTracks.indexOf(v)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(E),void(f&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Us.markPublishStart(o.store.clientId,o.store.pubId);const g=o.filterTobePublishedTracks(e,t,r);if(g.length===0)return void(yield In(o.tryToUnmuteAudio(e)));yield*_A(V6(o.doPublish(o.connection,g)))}finally{c()}})()}doPublish(e,t){var r=this;return Ac(function*(){t.forEach(I=>{let{track:D,type:V}=I;const M=Date.now();r.store.publish(D.getTrackId(),V===Fe.LocalAudioTrack?"audio":"video",M)}),r.bindLocalTrackEvents(t);const o=t.map(I=>{let{track:D}=I;return D}),c=yield In(e.send(o,r.store.codec,r.store.audioCodec)),u=(yield In(c.next())).value,f=r.createGatewayPublishMessage(t,u);let g;try{g=yield f}catch(I){throw c.throw(I),(I==null?void 0:I.code)===K.WS_ABORT&&t.forEach(D=>{let{track:V}=D;r.pendingLocalTracks.indexOf(V)===-1&&r.pendingLocalTracks.push(V)}),r.unbindLocalTrackEvents(t),I}const E=r.mapPubResToRemoteConfig(f,g,o),v=(yield In(c.next(E))).value;if(r.state===Fn.Disconnected)throw new Ie(K.UNEXPECTED_ERROR,"PeerConnection already disconnected.");te("ENABLE_VIDEO_SEI");const S=te("ENABLE_ENCODED_TRANSFORM"),R=te("ENABLE_AUDIO_METADATA");o.forEach(async I=>{const D=I.getRTCRtpTransceiver();if(!D||!S)return;const{interceptLocalVideoFrame:V,interceptLocalAudioFrame:M}=dI();I.trackMediaType===lt.VIDEO?await V(D.sender,I):I.trackMediaType===lt.AUDIO&&await M(D.sender,{metadata:R?()=>{const j=I.metadata.shift();return j&&j.value}:void 0})}),t.forEach(I=>{let{type:D}=I;r.statsCollector.addLocalStats(D)}),r.assignLocalTracks(t,v),r.statsUploader.startUploadOutboundStats(),t.forEach(I=>{let{track:D,type:V}=I;const M=Date.now();r.store.publish(D.getTrackId(),V===Fe.LocalAudioTrack?"audio":"video",void 0,M)})})()}async updateVideoStreamParameter(e,t){const r=this.localTrackMap.get(t);if(!r||!this.connection)return;if(!(r.track instanceof Er))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=r,c=function(u,f){const g={};return u.height&&u.width&&(g.scaleResolutionDownBy=m1(u,f)),g.maxFramerate=u.framerate?xo(u.framerate):void 0,g.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,g}(e,o);if(o._encoderConfig||(o._encoderConfig={}),t!==Fe.LocalVideoLowTrack||!te("DISABLE_DUAL_STREAM_USE_ENCODING")&&On().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return x.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(f,g){const E=f.canvas;g.width&&(E.width=xo(g.width)),g.height&&(E.height=xo(g.height)),g.framerate&&(E.stopCapture&&E.stopCapture(),E.stopCapture=Gk(()=>{!E.startCapture&&E.stopCapture&&E.stopCapture(),E.startCapture&&E.startCapture()},xo(g.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),x.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var t=this;return Ac(function*(){if(!t.connection||t.state!==Fn.Connected)return;const r=yield In(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=t.localTrackMap.get(Fe.LocalVideoTrack);if(!c)throw new Ie(K.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Fe.LocalVideoLowTrack))throw new Ie(K.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:t.getLowVideoTrack(c.track,e),type:Fe.LocalVideoLowTrack}];if(yield*_A(V6(t.doPublish(t.connection,u))),c.track.muted||!c.track.enabled){var o;const f=(o=t.localTrackMap.get(Fe.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;f!==void 0&&(yield In(t.connection.muteLocal([f])))}}finally{r()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ys(this,Rt.RequestRePublish,this.pendingLocalTracks),this.emit(Rt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ys(this,Rt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:r,kind:o}=this.pendingRemoteTracks[t];(o!==lt.AUDIO||r._audio_added_&&r._audioSSRC)&&(o!==lt.VIDEO||r._video_added_&&r._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await ys(this,Rt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:r}of this.pendingRemoteTracks)await this.subscribe(t,r,r===lt.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:r}=t;this.emit(Rt.MediaReconnectEnd,r.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Fn.Connected)return void e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const r=t.find(o=>o[0]==="videoLowTrack");return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Fn.Connected)return void e.forEach(r=>{const o=this.pendingLocalDataChannels.indexOf(r);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(r=>{const o=this.localDataChannels.indexOf(r);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(r=>r.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Fn.Connected)return;const e=this.localTrackMap.get(Fe.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[Fe.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),t.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Fn.Connected)throw new Ie(K.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const r=t.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(r.length!==0)return await this.connection.createDataChannels(e.uid,r),r.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(f=>{let{user:g,id:E}=f;return g.uid===e.uid&&E===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),r.map(o=>o.id)}async subscribe(e,t,r,o,c){var u;if(!this.connection||this.state!==Fn.Connected)throw new Ie(K.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(t))return;let f,g,E;const v=this.connection.getPreMedia(r);if(v)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),E=v.transceiver,f=v.track,g=v.id;else if(c){const I=c.find(V=>{let{stream_type:M}=V;return M===t});if(!I)throw new Ie(K.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const D=await this.connection.receive(t,I.ssrcs,String(e._uintid),I.attributes);this.connection instanceof vu&&(E=D.transceiver),f=D.track,g=D.id}else{const I=await this.connection.receive(t,[{ssrcId:r,rtx:o}],String(e._uintid),void 0);this.connection instanceof vu&&(E=I.transceiver),f=I.track,g=I.id}if(t===lt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(f):(e._audioTrack=new $y(f,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),E&&e._audioTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(f):(e._videoTrack=new Qy(f,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),E&&e._videoTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(e,e._videoTrack)),E&&te("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:I,interceptRemoteAudioFrame:D}=dI();t==lt.VIDEO?await I(E.receiver,{onSei:te("ENABLE_VIDEO_SEI")&&(V=>{var M;return(M=e._videoTrack)===null||M===void 0?void 0:M._onSei(V)})}):t==lt.AUDIO&&await D(E.receiver,{enableTopn:!!te("ENABLE_AUDIO_TOPN"),enableMetadata:!!te("ENABLE_AUDIO_METADATA"),onMetadata:V=>{this.safeEmit(Rt.AudioMetadata,V)}})}const S=this.remoteUserMap.get(e);S?S.set(t,g):this.remoteUserMap.set(e,new Map([[t,g]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(I=>{let{user:D,kind:V}=I;return D.uid===e.uid&&t===V});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(Rt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Fn.Connected)throw new Ie(K.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:f,mediaType:g}=c;return!((u=this.remoteUserMap.get(f))!==null&&u!==void 0&&u.has(g))});const t=[],r=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?r.set(c.ssrcId,u):t.push(c)});const o=await this.connection.batchReceive(t.map(c=>{let{user:u,mediaType:f,ssrcId:g,rtxSsrcId:E}=c;return{kind:f,ssrcMsg:[{ssrcId:g,rtx:E}],mslabel:String(u._uintid)}}));t.forEach((c,u)=>{r.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:f}of e){const g=r.get(f);if(!g)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(f));const{track:E,id:v,transceiver:S}=g;if(S&&te("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:V}=dI();u==lt.VIDEO?await D(S.receiver,{onSei:te("ENABLE_VIDEO_SEI")&&(M=>{var j;return(j=c._videoTrack)===null||j===void 0?void 0:j._onSei(M)})}):u==lt.AUDIO&&await V(S.receiver,{enableTopn:!!te("ENABLE_AUDIO_TOPN"),enableMetadata:!!te("ENABLE_AUDIO_METADATA"),onMetadata:M=>{this.safeEmit(Rt.AudioMetadata,M)}})}if(u===lt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(E):(c._audioTrack=new $y(E,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(E):(c._videoTrack=new Qy(E,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),te("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:V}=dI();u==lt.VIDEO?await D(S.receiver,{onSei:M=>{var j;(j=c._videoTrack)===null||j===void 0||j._onSei(M)}}):u==lt.AUDIO&&await V(S.receiver)}const R=this.remoteUserMap.get(c);R?R.set(u,v):this.remoteUserMap.set(c,new Map([[u,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const I=this.pendingRemoteTracks.findIndex(D=>{let{user:V,kind:M}=D;return V.uid===c.uid&&u===M});I!==-1&&(this.pendingRemoteTracks.splice(I,1),this.emit(Rt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,t,r){const o=this.pendingRemoteTracks.filter(f=>{let{user:g,kind:E}=f;return t!==void 0?g.uid===e.uid&&t===E:g.uid===e.uid});if(o.forEach(f=>{const g=this.pendingRemoteTracks.indexOf(f);this.pendingRemoteTracks.splice(g,1)}),this.connection&&this.state===Fn.Connected||r||o.forEach(f=>{let{kind:g}=f;var E;if(g===lt.AUDIO)(E=e._audioTrack)===null||E===void 0||E._destroy(),e._audioTrack=void 0;else if(g===lt.VIDEO){var v;(v=e._videoTrack)===null||v===void 0||v._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Fn.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,t);if(c.length===0)return;await this.connection.stopReceiving(c.map(f=>{let[,{id:g}]=f;return g}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(f=>{let[g,{kind:E}]=f;var v,S;if(E===lt.VIDEO&&g._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(g._videoSSRC,!1)),E===lt.VIDEO)this.unbindRemoteTrackEvents(g._videoTrack),r||((S=g._videoTrack)===null||S===void 0||S._destroy(),g._videoTrack=void 0);else if(E===lt.AUDIO){var R;this.unbindRemoteTrackEvents(g._audioTrack),!r&&((R=g._audioTrack)===null||R===void 0||R._destroy(),g._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,t){if(t.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(f=>f.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const r=this.filterTobeUnSubscribedDataChannels(e,t);if(r.length===0)return;t.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(e);return r.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:c,mediaType:u}of e){const f=this.pendingRemoteTracks.filter(g=>{let{user:E,kind:v}=g;return u!==void 0?E.uid===c.uid&&u===v:E.uid===c.uid});f.forEach(g=>{const E=this.pendingRemoteTracks.indexOf(g);this.pendingRemoteTracks.splice(E,1)}),t=t.concat(f)}if(!this.connection||this.state!==Fn.Connected)return void t.forEach(c=>{let{user:u,kind:f}=c;var g;if(f===lt.AUDIO)(g=u._audioTrack)===null||g===void 0||g._destroy(),u._audioTrack=void 0;else if(f===lt.VIDEO){var E;(E=u._videoTrack)===null||E===void 0||E._destroy(),u._videoTrack=void 0}});const r=Qa(e).call(e,(c,u)=>{let{user:f,mediaType:g}=u;const E=this.filterTobeUnSubscribedTracks(f,g);return c.concat(E)},[]);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[u,{kind:f}]=c;var g,E;if(f===lt.VIDEO&&u._videoSSRC&&((g=this.connection)===null||g===void 0||g.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),f===lt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(E=u._videoTrack)===null||E===void 0||E._destroy(),u._videoTrack=void 0;else if(f===lt.AUDIO){var v;this.unbindRemoteTrackEvents(u._audioTrack),(v=u._audioTrack)===null||v===void 0||v._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==Fn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const r=this.remoteUserMap.get(e);if(!r)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const o=t===lt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const r=this.remoteUserMap.get(e);if(!r)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(Fe.LocalAudioTrack),r=t&&t.track;r&&r.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(Fe.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ni){const r=t.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Fe.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Fe.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[o]=r;return!(e&&o===Fe.LocalVideoLowTrack)}).map(r=>{let[,{track:o}]=r;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,o,c){if(e){const f=this.localTrackMap.get(Fe.LocalAudioTrack),g=o?this.localTrackMap.get(Fe.LocalVideoLowTrack):this.localTrackMap.get(Fe.LocalVideoTrack);St.publish(this.store.sessionId,{eventElapse:Us.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:f==null?void 0:f.track.getTrackLabel(),videoName:g==null?void 0:g.track.getTrackLabel(),screenshare:(g==null?void 0:g.track._hints.indexOf(er.SCREEN_TRACK))!==-1,audio:!!f,video:!!g,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;r||(r=[]);const f=r.find(E=>E instanceof Xr),g=o?(u=this.localTrackMap.get(Fe.LocalVideoTrack))===null||u===void 0?void 0:u.track:r.find(E=>E instanceof Er);St.publish(this.store.sessionId,{eventElapse:Us.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:f==null?void 0:f.getTrackLabel(),videoName:g==null?void 0:g.getTrackLabel(),screenshare:(g==null?void 0:g._hints.indexOf(er.SCREEN_TRACK))!==-1,audio:!!f,video:!!g,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,r,o){const c=o===lt.VIDEO?r._videoSSRC:r._audioSSRC;c&&St.subscribe(this.store.sessionId,{succ:e,ec:t,video:o===lt.VIDEO,audio:o===lt.AUDIO,peerid:r.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Us.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ls("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=_I(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Fe.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ni){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Fn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Fe.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Fe.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Er||t&&t.track instanceof Xr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;const r=Array.from(ec(t=this.remoteUserMap).call(t)).find(o=>o.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[o]=r;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Fe.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Gt(e).call(e,(r,o)=>r.level-o.level),e}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Fn.Reconnecting,te("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=_I(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:o}]=e;switch(r){case Fe.LocalVideoTrack:Ze(t=o._hints).call(t,er.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Fe.LocalAudioTrack:o instanceof Ni?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Fe.LocalVideoLowTrack:}}),this.emit(Rt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(ec(r).call(r)).forEach(o=>{this.setPendingRemoteMedia(t,o)}),this.emit(Rt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,r]=e;Array.from(ec(r).call(r)).forEach(o=>{this.setPendingRemoteDataChannel(t,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const r of this.pendingRemoteDataChannels){const{user:o,id:c}=r;if((e instanceof Nf?e.uid:e)===o.uid&&c===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const r of this.pendingRemoteTracks){const{user:o,kind:c}=r;if((e instanceof Nf?e.uid:e)===o.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Ac(function*(){if(!t.connection||t.state!==Fn.Connected)return;const r=yield In(t.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield In(t.connection.restartICE(e));const u=yield In(o.next());if(u.done)return;const f=u.value,g=yield f;switch(x1(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case js.UDP_TCP_RELAY:t._pcStatsUploadType=zh.UDP_TCP_RESTART;break;case js.TCP_RELAY:t._pcStatsUploadType=zh.TCP_RESTART;break;case js.RELAY:t._pcStatsUploadType=zh.RELAY_RESTART;break;default:t._pcStatsUploadType=zh.OLD_RESTART}t._isTryConnecting=!0,o.next(g)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{r()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(Fe.LocalVideoTrack),r=this.localTrackMap.get(Fe.LocalAudioTrack),o=e.videoSend.find(D=>D.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),c=e.audioSend.find(D=>D.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=Jo(this,Rt.NeedSignalRTT),f=o?o.rttMs:void 0,g=c?c.rttMs:void 0,E=f&&g?(f+g)/2:f||g,v=(E&&u?(E+u)/2:E||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*v/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,I=t==null?void 0:t.track;if(I&&I._encoderConfig&&I._hints.indexOf(er.SCREEN_TRACK)===-1){const D=I._encoderConfig.bitrateMax,V=e.bitrate.actualEncoded;if(D&&V){const M=(1e3*D-V)/(1e3*D);return b9[M<.15?0:M<.3?1:M<.45?2:M<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[o]=r;const c=o._audioSSRC,u=o._videoSSRC,f=e.audioRecv.find(V=>V.ssrc===c),g=e.videoRecv.find(V=>V.ssrc===u);if(!f&&!g)return void(t+=1);const E=Jo(this,Rt.NeedSignalRTT),v=e.rtt,S=(v&&E?(v+E)/2:v||E)||0,R=f?f.jitterMs:void 0,I=e.recvPacketLossRate;let D=.7*I*100/50+.3*S/1500;R&&(D=.6*I*100/50+.2*S/1500+.2*R/400),t+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new tt((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}async replaceTrack(e,t){var r;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Fn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:f}]=u;return e===f});if(!o)return;const c=o[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:t,type:c}]),o[1].track=t),await((r=this.connection)===null||r===void 0?void 0:r.replaceTrack(t,o[1].id)),this.isPlanB){const u=o[1];u.id=t._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Fe.LocalVideoTrack&&!te("DISABLE_DUAL_STREAM_USE_ENCODING")&&On().supportDualStreamEncoding){const u=this.localTrackMap.get(Fe.LocalVideoLowTrack);if(u){const f=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=f,u.track._originMediaStreamTrack=f,await new tt((g,E)=>{this.handleReplaceTrack(u.track,g,E,!0)})}}}filterTobePublishedTracks(e,t,r){const o=[],c=this.getAllTracks();e=jy(e=e.filter(E=>c.indexOf(E)===-1));let u,f=!1;const g=this.localTrackMap.get(Fe.LocalAudioTrack);for(const E of e){if(E instanceof Er&&(this.localTrackMap.has(Fe.LocalVideoTrack)||f?new Ie(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:E,type:Fe.LocalVideoTrack}),f=!0),t)){const v=this.getLowVideoTrack(E,r);o.push({track:v,type:Fe.LocalVideoLowTrack})}if(E instanceof Xr)if(g){const v=g.track;if(v instanceof Ni)O1([E]),v.addAudioTrack(E),this.bindLocalAudioTrackEvents(E,!0);else{const S=D1([v,E]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(v,S)}}else u instanceof Ni?(O1([E]),u.addAudioTrack(E)):u||!E._useAudioElement&&On().webAudioMediaStreamDest&&!E._bypassWebAudio?u=D1(u?[E,u]:[E]):u=E}return u&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:Fe.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const t=[],r=this.getAllTracks();e=jy(e=e.filter(o=>r.indexOf(o)!==-1));for(const o of e){if(o instanceof Xr){const c=this.localTrackMap.get(Fe.LocalAudioTrack);if(!c)continue;c.track instanceof Ni?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(t.push([Fe.LocalAudioTrack,c]),c.track.close())):t.push([Fe.LocalAudioTrack,c])}if(o instanceof Er){const c=this.localTrackMap.get(Fe.LocalVideoTrack);if(!c)continue;t.push([Fe.LocalVideoTrack,c]);const u=this.localTrackMap.get(Fe.LocalVideoLowTrack);u&&t.push([Fe.LocalVideoLowTrack,u])}}return t}filterTobePublishedDataChannels(e){return e=(e=jy(e)).filter(t=>this.localDataChannels.findIndex(r=>r.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=jy(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:o}=t;switch(o){case Fe.LocalVideoTrack:r.addListener(ft.GET_STATS,this.handleGetLocalVideoStats),r.addListener(ft.GET_RTC_STATS,this.handleGetRTCStats),r.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Fe.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case Fe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ni?e.trackList.forEach(r=>{r.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),r.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(ft.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:o}]=t;return{track:o,type:r}})),e.forEach(t=>{let{track:r,type:o}=t;switch(o){case Fe.LocalVideoTrack:r.off(ft.GET_STATS,this.handleGetLocalVideoStats),r.off(ft.GET_RTC_STATS,this.handleGetRTCStats),r.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Fe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case Fe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ni?e.trackList.forEach(t=>{t.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ft.GET_STATS,this.handleGetLocalAudioStats),t.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ft.GET_STATS,this.handleGetLocalAudioStats),e.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ft.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Qy&&t.addListener(ft.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof $y&&t.addListener(ft.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ft.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(lt.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(lt.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,o)=>{var c;let u,f,{track:g,type:E}=r;switch(E){case Fe.LocalAudioTrack:u=Hn.Audio,f={dtx:g instanceof jb&&g._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Fe.LocalVideoTrack:u=Ze(c=g._hints).call(c,er.SCREEN_TRACK)?Hn.Screen:Hn.High,f=Su(Su({},V9(g)),{},{codec:this.store.codec,svc_mode:sI()});break;case Fe.LocalVideoLowTrack:u=Hn.Low,f=Su(Su({},V9(g)),{},{codec:this.store.codec,svc_mode:sI()})}return{stream_type:u,attributes:f,ssrcs:t[o]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:f,id:g}]=t;switch(c){case Fe.LocalVideoTrack:o=Ze(r=u._hints).call(r,er.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Fe.LocalAudioTrack:o=Hn.Audio;break;case Fe.LocalVideoLowTrack:o=Hn.Low}return{stream_type:o,ssrcs:f,mid:g}})}assignLocalTracks(e,t){e.forEach((r,o)=>{let{track:c,type:u}=r;this.localTrackMap.set(u,{track:c,id:t[o].id,ssrcs:t[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Rt.PeerConnectionStateChange,t),t==="connecting"&&e instanceof vu&&!Br()&&te("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},te("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof vu&&M6(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=zh.DISCONNECTED_OR_FAILED,Jo(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const r=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));St.reportApiInvoke(this.store.sessionId,{name:fi.REPUB_AFTER_PC_CONNECTED,options:r.concat(o),tag:Gr.TRACER}).onSuccess(),this.republish()}if(te("NEW_ICE_RESTART")&&e instanceof vu&&!Br()&&!this._forceTurn){if(Ze(P9).call(P9,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const r=c=>{x1(e)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Jo(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Rt.RequestRestartICE,c))},o=()=>{x1(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{j6(e,r,o)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&te("ICE_RESTART")&&Jo(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Rt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),St.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Gr.TRACER}).onSuccess(),this.emit(Rt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;const o=Array.from(ec(r=this.remoteUserMap).call(r)).find(u=>u._audioSSRC===t);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(zy.FIRST_FRAME_DECODED),St.firstRemoteFrame(this.store.sessionId,Bi.FIRST_AUDIO_DECODE,Nr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;const o=Array.from(ec(r=this.remoteUserMap).call(r)).find(c=>c._audioSSRC===t);o&&St.firstRemoteFrame(this.store.sessionId,Bi.FIRST_AUDIO_RECEIVED,Nr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,o)=>{this.reportVideoFirstFrameDecoded(t,r,o)},e.onFirstVideoReceived=t=>{var r;const o=Array.from(ec(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);o&&St.firstRemoteFrame(this.store.sessionId,Bi.FIRST_VIDEO_RECEIVED,Nr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{const o=t.candidateType==="relay",c=r.candidateType==="relay";r.candidateType!=="unknown"&&o===c||this.emit(Rt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Cf(r))," -> ").concat(JSON.stringify(Cf(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Cf(r))," -> ").concat(JSON.stringify(Cf(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),r=this.statsCollector.getRTCStats();return Su(Su({},t),r)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof vu&&function(t){dv.delete(t.id),M6(t)}(e),e.close(),this.emit(Rt.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const r=this.localTrackMap.get(Fe.LocalAudioTrack);if(e instanceof Xr&&(r==null?void 0:r.track)instanceof Ni)return r.track.isActive||t.push([Fe.LocalAudioTrack,r]),t;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(t.push(o),o[0]===Fe.LocalVideoTrack)){const c=this.localTrackMap.get(Fe.LocalVideoLowTrack);c&&t.push([Fe.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){const t=[],r=this.localTrackMap.get(Fe.LocalAudioTrack);if(e instanceof Xr&&(r==null?void 0:r.track)instanceof Ni)return r.track.isActive&&t.push([Fe.LocalAudioTrack,r]),t;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Fe.LocalVideoTrack){t.push(o);const c=this.localTrackMap.get(Fe.LocalVideoLowTrack);c&&t.push([Fe.LocalVideoLowTrack,c])}else t.push(o);return t}createMuteMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:f,id:g}]=t;switch(c){case Fe.LocalAudioTrack:o=Hn.Audio;break;case Fe.LocalVideoTrack:o=Ze(r=u._hints).call(r,er.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Fe.LocalVideoLowTrack:o=Hn.Low}return{stream_type:o,ssrcs:f,mid:g}})}createUnmuteMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:f,id:g}]=t;switch(c){case Fe.LocalAudioTrack:o=Hn.Audio;break;case Fe.LocalVideoTrack:o=Ze(r=u._hints).call(r,er.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Fe.LocalVideoLowTrack:o=Hn.Low}return{stream_type:o,ssrcs:f,mid:g}})}filterTobeUnSubscribedTracks(e,t){const r=[],o=this.remoteUserMap.get(e);if(!o)return r;if(t){const c=o.get(t);if(!c)return r;r.push([e,{kind:t,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,f]=c;r.push([e,{kind:u,id:f}])});return r}filterTobeUnSubscribedDataChannels(e,t){const r=[];return t.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&r.push(o)}),r}createUnsubscribeMessage(e){const t=[];return e.forEach(r=>{let[o,{kind:c,id:u}]=r;switch(c){case lt.VIDEO:return void(o._videoSSRC&&t.push({stream_type:lt.VIDEO,ssrcId:o._videoSSRC}));case lt.AUDIO:return void(o._audioSSRC&&t.push({stream_type:lt.AUDIO,ssrcId:o._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(r=>{let[o,{kind:c}]=r;if(t.has(o)){let u=t.get(o);c===lt.VIDEO?u|=Hi.Video:u|=Hi.Audio,t.set(o,u)}else c===lt.VIDEO?t.set(o,Hi.Video):t.set(o,Hi.Audio)}),{users:Array.from(t.entries()).map(r=>{let[o,c]=r;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:o}]=t;const c=this.remoteUserMap.get(r);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Fe.LocalVideoTrack),r=this.localTrackMap.get(Fe.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new tt((o,c)=>{this.handleUpdateVideoEncoder(t.track,o,c,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new tt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t,r){return e.map((o,c)=>{var u;let{stream_type:f}=o;const g=(u=t.find(E=>{let{stream_type:v}=E;return f===v}))===null||u===void 0?void 0:u.attributes;if(g&&te("DISABLE_SCREEN_SHARE_REMB")){const E=r[c]._hints;(Ze(E).call(E,er.SCREEN_TRACK)||Ze(E).call(E,er.SCREEN_LOW_TRACK))&&(g.remb=!1,x.debug("disable remb for screen share, hints:",E))}return g})}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof Xr){var t;const o=this.filterTobeUnmutedTracks(e[r]);if(o.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(o.map(u=>{let[,{id:f}]=u;return f})));const c=this.createUnmuteMessage(o);return void await ir(this,Rt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Rt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Rt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await cs(bk(this.dtlsFailedCount,Ri)),this.emit(Rt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await ys(this,Rt.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Rt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Fe.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Er)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Er).length>1)throw new Ie(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Xr).length>1&&(e.some(t=>t instanceof Xr&&t._bypassWebAudio)||!On().webAudioMediaStreamDest))throw new Ie(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Er&&this.pendingLocalTracks.some(r=>r instanceof Er))throw new Ie(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Xr&&this.pendingLocalTracks.some(r=>r instanceof Xr)&&(!On().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof Xr&&r._bypassWebAudio)))throw new Ie(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var r;const o=!te("DISABLE_DUAL_STREAM_USE_ENCODING")&&On().supportDualStreamEncoding,c=Su(Su({},{width:160,height:120,framerate:15,bitrate:50}),t);let u;u=o?e._mediaStreamTrack.clone():P1(e,c);const f=dr(8,"track-low-"),g=new Er(u,Su(Su({},o&&{scaleResolutionDownBy:m1(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,f);return g.on(Ug.TRANSCEIVER_UPDATED,E=>{e._updateRtpTransceiver(E,Gy.LOW_STREAM)}),g._hints.push(er.LOW_STREAM),Ze(r=e._hints).call(r,er.SCREEN_TRACK)&&g._hints.push(er.SCREEN_LOW_TRACK),e.on("sei-to-send",E=>{g.emit("sei-to-send",E)}),e.addListener(ft.NEED_CLOSE,()=>{g.close()}),g}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof vu){var c,u,f,g;const E=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:S,peerConnectionState:R}=this.connection,{local:I,remote:D}=await this.connection.getSelectedCandidatePair();St.pcStats(this.store.sessionId,{startTime:E,eventElapse:e-E||0,iceconnectionsate:v,dtlsstate:S,connectionstate:R,intSucc:t?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=I==null?void 0:I.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=I.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(I.address,":").concat(I.port),selectedRemoteCandidateProtocol:(f=D.protocol)!==null&&f!==void 0?f:"",selectedRemoteCandidateType:(g=D.candidateType)!==null&&g!==void 0?g:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:r,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,t,r,o){var c;const u=Array.from(ec(c=this.remoteUserMap).call(c)).find(f=>f._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const f=this.store.keyMetrics,g=f.subscribe.find(E=>E.userId===u.uid&&E.type==="video");St.firstRemoteVideoDecode(this.store.sessionId,Bi.FIRST_VIDEO_DECODE,Nr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:t,videoheight:r,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:f.requestAPEnd||0,apStart:f.requestAPStart||0,joinGwEnd:f.joinGatewayEnd||0,joinGwStart:f.joinGatewayStart||0,pcEnd:f.peerConnectionEnd||0,pcStart:f.peerConnectionStart||0,subscriberEnd:(g==null?void 0:g.subscribeEnd)||0,subscriberStart:(g==null?void 0:g.subscribeStart)||0,videoAddNotify:(g==null?void 0:g.streamAdded)||0,state:o?1:0,firstFrame:(g==null?void 0:g.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(t);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==r}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===Fe.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,Gy.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},gt(pn.prototype,"startP2PConnection",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"startP2PConnection"),pn.prototype),gt(pn.prototype,"connect",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"connect"),pn.prototype),gt(pn.prototype,"updateRemoteRTPCapabilities",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"updateRemoteRTPCapabilities"),pn.prototype),gt(pn.prototype,"publishDataChannel",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"publishDataChannel"),pn.prototype),gt(pn.prototype,"unpublish",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"unpublish"),pn.prototype),gt(pn.prototype,"unpublishDataChannel",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"unpublishDataChannel"),pn.prototype),gt(pn.prototype,"unpublishLowStream",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"unpublishLowStream"),pn.prototype),gt(pn.prototype,"subscribeDataChannel",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"subscribeDataChannel"),pn.prototype),gt(pn.prototype,"subscribe",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"subscribe"),pn.prototype),gt(pn.prototype,"massSubscribe",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"massSubscribe"),pn.prototype),gt(pn.prototype,"unsubscribe",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"unsubscribe"),pn.prototype),gt(pn.prototype,"unsubscribeDataChannel",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"unsubscribeDataChannel"),pn.prototype),gt(pn.prototype,"massUnsubscribe",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"massUnsubscribe"),pn.prototype),gt(pn.prototype,"muteRemote",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"muteRemote"),pn.prototype),gt(pn.prototype,"unmuteRemote",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"unmuteRemote"),pn.prototype),gt(pn.prototype,"hasRemoteMediaWithLock",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"hasRemoteMediaWithLock"),pn.prototype),gt(pn.prototype,"disconnectForReconnect",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"disconnectForReconnect"),pn.prototype),gt(pn.prototype,"updateBitrateLimit",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"updateBitrateLimit"),pn.prototype),gt(pn.prototype,"remoteMediaSsrcChanged",[ca],Object.getOwnPropertyDescriptor(pn.prototype,"remoteMediaSsrcChanged"),pn.prototype),pn);function ca(e,t,r){const o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(t));try{for(var f=arguments.length,g=new Array(f),E=0;E<f;E++)g[E]=arguments[E];return await o.apply(this,g)}finally{u()}},r}function F6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function B6(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?F6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const Kre=Date.now(),Xre=20,L1=new Map,TI=new Map;async function H6(e){const t=L1.get(e),r=Array.isArray(t)&&t[t.length-1],o=TI.get(e);if(!r)return void(o.isSyncing=!1);const c={uid:r.uid,payload:r.payload};o.firstRecvTs===0&&(o.firstRecvTs=r.recvTs,o.firstSendTs=r.sendTs);const u=r.sendTs-o.firstSendTs,f=u-(Date.now()-o.firstRecvTs);f>0&&(o.firstRecvTs=Date.now()-u);let g=r.mediaDelay+f;g<=0?(t.pop(),G6(r.context,c),g=0):g=Math.min(g,Xre),setTimeout(()=>t.length&&H6(e),g)}function G6(e,t){e.safeEmit(gn.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function Qre(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return G6(r,{uid:e.uid,payload:e.payload});const o="".concat(r.id,"-").concat(e.uid),c=L1.get(o)||[],u=c.findIndex(v=>e.sendTs>=v.sendTs),f=B6(B6({},e),{},{context:r,mediaDelay:t,recvTs:Date.now()});u===-1?c.push(f):c.splice(u,0,f),L1.set(o,c);let g=!1;var E;TI.has(o)?g=!((E=TI.get(o))===null||E===void 0||!E.isSyncing):TI.set(o,{isSyncing:g,firstRecvTs:0,firstSendTs:0}),g||H6(o)}const $re=Nn().name;function W6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function z6(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?W6(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W6(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const uv="websdk_ng_cache_parameter",Jre=te("MAX_PRELOAD_ASYNC_LENGTH"),Zre=1e4,Kg=new Map,Xg=[];let M1=null,j1=0,U1=0;const bI=new Map,eie=function(e,t){const r=[];let o=0;const c=async()=>{const u=r.shift();u&&await u(),r.length>0&&o<t?c():o--};return async function(){for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];return new tt(async(E,v)=>{r.push(async()=>{try{const S=await e(...f);E(S)}catch(S){v(S)}}),o<t&&(o++,c())})}}(Y6,Jre),V1=ka.CancelToken.source();async function Y6(e,t,r,o,c,u){try{if(!te("ENABLE_PRELOAD"))return;if(!On().supportWebCrypto)return void vf(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r&&r!==null)throw new Ie(K.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&os(r,"token",1,2047),os(e,"appid",1,2047),eI(t),o&&tI(o);const f=Mg();x.debug("preload channel ".concat(t,", uid is ").concat(o));const g={appId:e,cname:t,token:r||e,uid:typeof o!="string"?o:null,sid:f,proxyServer:c};let E,v;typeof o=="string"?(g.stringUid=o,[v,E]=await tt.all([Mre(o,{sid:f,appId:e},V1.token),g6(z6(z6({},g),{},{token:r||e,uid:0}),V1.token)]),g.uid=v.uid,E.gatewayInfo.uid=g.uid,E.gatewayInfo.res.uid=g.uid):(u&&(g.stringUid=u),E=await g6(g,V1.token));const S={sid:f,appId:e,cname:t,token:r||e,uid:g.stringUid||o,intUid:g.uid||E.gatewayInfo.uid,stringUid:g.stringUid,ts:Date.now(),sua:v,ap:E};await async function(R){let I;try{R.uid&&K6({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const D=J6(R),V=await async function(j,W){try{const Y=await window.crypto.subtle.importKey("raw",V3(W),"AES-GCM",!1,["encrypt"]),le=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Y,Lg(window.btoa(JSON.stringify(j))));return Sf(new Uint8Array(le))}catch{return}}(R,R.token||R.appId);if(!V)return;I=$6(uv);const M=I?JSON.parse(I):[];M.push({[D]:V}),M.length>te("AP_CACHE_NUM")&&M.shift(),wI(uv,JSON.stringify(M))}catch(D){x.warn("Error caching server parameters:",D.message),wI(uv,"")}}(S),j1++}catch(f){throw U1++,function(g){M1||(M1=window.setTimeout(()=>{let v="";bI.forEach((S,R)=>{v+="".concat(R,": ").concat(S," ;")}),St.reportApiInvoke(null,{name:fi.PRELOAD,options:{success:j1,failed:U1,err:v}}).onError(g),j1=0,U1=0,bI.clear(),M1=null},Zre));const E=bI.get(g.code)||0;bI.set(g.code,E+1)}(f),f}}async function q6(e){try{if(te("AP_REQUEST_DETAIL")||te("ENABLE_ROLE_SELECT_EDGE"))return;const t=K6(e);if(!t||e.cloudProxyServer!=="disabled")return;const r=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",V3(c),"AES-GCM",!1,["decrypt"]),f=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,Lg(o));return JSON.parse(window.atob(Sf(new Uint8Array(f))))}catch{return}}(t,e.token||e.appId);if(!r||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(r,e))return;if(r&&Date.now()-r.ts<te("AP_CACHE_LIFETIME"))return r}catch(t){x.warn("Error get preloadInfo",t.message)}}function K6(e){let t;try{if(t=$6(uv),!t)return;const r=JSON.parse(t),o=J6(e),c=function(f,g){for(let E=f.length-1;E>=0;E--)if(g(f[E]))return E;return-1}(r,f=>o in f);if(c===-1)return;const u=r.splice(c,1)[0];return wI(uv,JSON.stringify(r)),u[o]}catch(r){x.warn("Error delete preload info: ".concat(t),r.message),wI(uv,"")}}function F1(e){if(e){let t=Kg.get(e);t&&(window.clearTimeout(t),t=null,Kg.delete(e)),Ze(Xg).call(Xg,e)||e.cloudProxyServer!=="disabled"||Xg.push(e)}if(Kg.size<te("AP_CACHE_NUM")&&Xg.length>0){const t=Xg.shift();Kg.set(t,window.setTimeout(async()=>{const{appId:r,cname:o,token:c,stringUid:u,uid:f,proxyServer:g}=t;try{await eie(r,o,c,f,g,u),Kg.has(t)&&F1(t)}catch(E){x.warn("update preload failed",E.message),X6(t)}},te("AP_UPDATE_INTERVAL")))}}function X6(e){const t=Xg.indexOf(e);t!==-1&&Xg.splice(t,1);let r=Kg.get(e);r&&(window.clearTimeout(r),r=null,Kg.delete(e),F1())}function Q6(e,t){const r=e.sua,o=e.ap;t&&r&&St.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),St.reportResourceTiming(e.ap.url,e.sid),St.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[gi.CHOOSE_SERVER,gi.CLOUD_PROXY_FALLBACK].toString()}),St.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[gi.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function $6(e){return window.atob(window.localStorage.getItem(e)||"")}function wI(e,t){window.localStorage.setItem(e,window.btoa(t))}function J6(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),Y3(t)}function tie(e){let t=function(){const r=iie.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,o){let c=r.appId;c!==void 0&&(_i(o,10),Df(o,c));let u=r.cid;u!==void 0&&(_i(o,16),_i(o,u));let f=r.cname;f!==void 0&&(_i(o,26),Df(o,f));let g=r.deviceId;g!==void 0&&(_i(o,34),Df(o,g));let E=r.elapse;E!==void 0&&(_i(o,40),xf(o,E));let v=r.fileSize;v!==void 0&&(_i(o,48),xf(o,hv(v)));let S=r.height;S!==void 0&&(_i(o,56),xf(o,hv(S)));let R=r.jpg;R!==void 0&&(_i(o,66),_i(o,R.length),eH(o,R));let I=r.networkType;I!==void 0&&(_i(o,72),xf(o,hv(I)));let D=r.osType;D!==void 0&&(_i(o,80),xf(o,hv(D)));let V=r.requestId;V!==void 0&&(_i(o,90),Df(o,V));let M=r.sdkVersion;M!==void 0&&(_i(o,98),Df(o,M));let j=r.sequence;j!==void 0&&(_i(o,104),xf(o,hv(j)));let W=r.sid;W!==void 0&&(_i(o,114),Df(o,W));let Y=r.timestamp;Y!==void 0&&(_i(o,120),xf(o,Y));let le=r.uid;le!==void 0&&(_i(o,128),_i(o,le));let ye=r.vid;ye!==void 0&&(_i(o,136),_i(o,ye));let Ee=r.width;Ee!==void 0&&(_i(o,144),xf(o,hv(Ee)));let me=r.service;me!==void 0&&(_i(o,152),_i(o,me));let Ae=r.callbackData;Ae!==void 0&&(_i(o,162),_i(o,Ae.length),eH(o,Ae));let Pe=r.ticket;Pe!==void 0&&(_i(o,170),Df(o,Pe));let $e=r.vendorConfigs;$e!==void 0&&(_i(o,178),Df(o,$e))}(e,t),function(r){let o=r.bytes,c=r.limit;return o.length===c?o:o.subarray(0,c)}(t)}function nie(e){return function(r){let o={};e:for(;!sie(r);){let c=Zb(r);switch(c>>>3){case 0:break e;case 1:o.code=Zb(r);break;case 2:o.msg=tH(r,Zb(r));break;case 3:o.requestId=tH(r,Zb(r));break;case 4:o.timestamp=aie(r,!1);break;default:rie(r,7&c)}}return o}({bytes:t=e,offset:0,limit:t.length});var t}function rie(e,t){switch(t){case 0:for(;128&Rl(e););break;case 2:B1(e,Zb(e));break;case 5:B1(e,4);break;case 1:B1(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function hv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let iie=[];function B1(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function sie(e){return e.offset>=e.limit}function RI(e,t){let r=e.bytes,o=e.offset,c=e.limit,u=o+t;if(u>r.length){let f=new Uint8Array(2*u);f.set(r),e.bytes=f}return e.offset=u,u>c&&(e.limit=u),o}function Z6(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function eH(e,t){let r=RI(e,t.length);e.bytes.set(t,r)}function tH(e,t){let r=Z6(e,t),o=String.fromCharCode,c=e.bytes,u="",f="";for(let g=0;g<t;g++){let E,v,S,R,I=c[g+r];(128&I)==0?f+=o(I):(224&I)==192?g+1>=t?f+=u:(E=c[g+r+1],(192&E)!=128?f+=u:(R=(31&I)<<6|63&E,R<128?f+=u:(f+=o(R),g++))):(240&I)==224?g+2>=t?f+=u:(E=c[g+r+1],v=c[g+r+2],(49344&(E|v<<8))!=32896?f+=u:(R=(15&I)<<12|(63&E)<<6|63&v,R<2048||R>=55296&&R<=57343?f+=u:(f+=o(R),g+=2))):(248&I)==240?g+3>=t?f+=u:(E=c[g+r+1],v=c[g+r+2],S=c[g+r+3],(12632256&(E|v<<8|S<<16))!=8421504?f+=u:(R=(7&I)<<18|(63&E)<<12|(63&v)<<6|63&S,R<65536||R>1114111?f+=u:(R-=65536,f+=o(55296+(R>>10),56320+(1023&R)),g+=3))):f+=u}return f}function Df(e,t){let r=t.length,o=0;for(let f=0;f<r;f++){let g=t.charCodeAt(f);g>=55296&&g<=56319&&f+1<r&&(g=(g<<10)+t.charCodeAt(++f)-56613888),o+=g<128?1:g<2048?2:g<65536?3:4}_i(e,o);let c=RI(e,o),u=e.bytes;for(let f=0;f<r;f++){let g=t.charCodeAt(f);g>=55296&&g<=56319&&f+1<r&&(g=(g<<10)+t.charCodeAt(++f)-56613888),g<128?u[c++]=g:(g<2048?u[c++]=g>>6&31|192:(g<65536?u[c++]=g>>12&15|224:(u[c++]=g>>18&7|240,u[c++]=g>>12&63|128),u[c++]=g>>6&63|128),u[c++]=63&g|128)}}function Rl(e){return e.bytes[Z6(e,1)]}function nH(e,t){let r=RI(e,1);e.bytes[r]=t}function Zb(e){let t,r=0,o=0;do t=Rl(e),r<32&&(o|=(127&t)<<r),r+=7;while(128&t);return o}function _i(e,t){for(t>>>=0;t>=128;)nH(e,127&t|128),t>>>=7;nH(e,t)}function aie(e,t){let r,o=0,c=0,u=0;return r=Rl(e),o=127&r,128&r&&(r=Rl(e),o|=(127&r)<<7,128&r&&(r=Rl(e),o|=(127&r)<<14,128&r&&(r=Rl(e),o|=(127&r)<<21,128&r&&(r=Rl(e),c=127&r,128&r&&(r=Rl(e),c|=(127&r)<<7,128&r&&(r=Rl(e),c|=(127&r)<<14,128&r&&(r=Rl(e),c|=(127&r)<<21,128&r&&(r=Rl(e),u=127&r,128&r&&(r=Rl(e),u|=(127&r)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:t}}function xf(e,t){let r=t.low>>>0,o=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,u=c===0?o===0?r<16384?r<128?1:2:r<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,f=RI(e,u),g=e.bytes;switch(u){case 10:g[f+9]=c>>>7&1;case 9:g[f+8]=u!==9?128|c:127&c;case 8:g[f+7]=u!==8?o>>>21|128:o>>>21&127;case 7:g[f+6]=u!==7?o>>>14|128:o>>>14&127;case 6:g[f+5]=u!==6?o>>>7|128:o>>>7&127;case 5:g[f+4]=u!==5?128|o:127&o;case 4:g[f+3]=u!==4?r>>>21|128:r>>>21&127;case 3:g[f+2]=u!==3?r>>>14|128:r>>>14&127;case 2:g[f+1]=u!==2?r>>>7|128:r>>>7&127;case 1:g[f]=u!==1?128|r:127&r}}const rH={},iH={},CI=4294967296,oie=CI*CI,cie=oie/2;aH(0,!0);const sH=aH(0),lie=ew(0,-2147483648,!1),die=ew(-1,2147483647,!1);function aH(e,t){let r,o,c;return t?(c=0<=(e>>>=0)&&e<256)&&(o=iH[e],o)?o:(r=ew(e,0,!0),c&&(iH[e]=r),r):(c=-128<=(e|=0)&&e<128)&&(o=rH[e],o)?o:(r=ew(e,e<0?-1:0,!1),c&&(rH[e]=r),r)}function ew(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}function oH(e,t){if(isNaN(e))return sH;{if(e<=-9223372036854776e3)return lie;if(e+1>=cie)return die}return e<0?sH:ew(e%CI|0,e/CI|0,t)}function cH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}class H1 extends xr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const r=this._connectionState;this._connectionState=t,this.emit(fd.CONNECTION_STATE_CHANGE,t,r)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var r;super(),H(this,"name","AgoraRTCImageModeration"),H(this,"_connectionState",Dc.CONNECTING),H(this,"_sequence",0),H(this,"_moderationStartTime",void 0),H(this,"_workerConnection",void 0),H(this,"_workerMessageLengthLimit",void 0),H(this,"_qualityRatio",void 0),H(this,"_connectInfo",void 0),H(this,"_cancelTokenSource",ka.CancelToken.source()),H(this,"_retryConfig",void 0),H(this,"_moderationInterval",void 0),H(this,"_moderationTimer",null),H(this,"_moderationMode",1),H(this,"_quality",1),H(this,"_qualityTimer",null),H(this,"_ticket",void 0),H(this,"_moderationIntervalMinimum",void 0),H(this,"_uploadFailedNum",0),H(this,"_uploadNum",0),H(this,"_uploadTimer",null),H(this,"_extraInfo",void 0),H(this,"_vendor",""),H(this,"_encoder",new TextEncoder),H(this,"_moderationId",void 0),H(this,"inspectImage",()=>{if(this.connectionState!==Dc.CONNECTED)throw new Te(K.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Dc.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=dr(5,"image-moderation-"),this._workerMessageLengthLimit=te("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=te("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=te("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Hb("worker-"+this._moderationId,Ri),this.on(fd.STATE_CHANGE,(o,c)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(tv[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(t,r){this.emit(fd.STATE_CHANGE,tv.CONNECT_AP),this._connectInfo=t;const o=this._cancelTokenSource.token;return this._retryConfig=r,new tt((c,u)=>{this.on(fd.CONNECTION_STATE_CHANGE,(f,g)=>{f===Dc.CONNECTED&&c()}),this.requestAP(t,o,r).then(f=>{this.connectWorker(f)}).catch(f=>{u(f)})})}updateConfig(t){var r;this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Dc.CONNECTED&&this.inspectImage()}async requestAP(t,r,o){const c=te("WEBCS_DOMAIN").map(E=>"https://".concat(E,"/api/v1")),u=await function(E,v,S,R){let{appId:I,areaCode:D,cname:V,sid:M,token:j,uid:W}=v;ov++;const Y="moderation_plugin",le={service_name:Y,json_body:JSON.stringify({appId:I,areaCode:D,cname:V,command:"allocateEdge",requestId:ov,seq:ov,sid:M,appToken:j,ts:Date.now(),uid:W+""})};let ye,Ee,me=E[0];return dd(async()=>{ye=Date.now();const Ae=await md(me,{data:le,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ee=Date.now()-ye,Ae.code!==0){const at=new Te(K.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ae.code,{retry:!0,responseTime:Ee});throw x.error(at.toString()),at}const Pe=JSON.parse(Ae.json_body);if(Pe.code!==200){const at=new Te(K.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Pe.code,", reason: ").concat(Pe.reason),{code:Pe.code,responseTime:Ee});throw x.error(at.toString()),at}if(!Pe.servers||!Array.isArray(Pe.servers)||Pe.servers.length===0){const at=new Te(K.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Pe.code,responseTime:Ee});throw x.error(at.toString()),at}if(!Pe.servers.some(at=>!!at.wss)){const at=new Te(K.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Pe.code,responseTime:Ee});throw x.error(at.toString()),at}const $e=te("IMAGE_MODERATION_WORKER_HOST");return{addressList:Pe.servers.map(at=>{let{address:nn,wss:Xt}=at;if(nn&&Xt)return"wss://".concat(nn.replace(/\./g,"-"),".").concat($e,":").concat(Xt,"/moderation")}).filter(at=>!!at),workerToken:Pe.workerToken,vid:Pe.vid,ticket:Pe.appTicket,responseTime:Ee}},(Ae,Pe)=>(St.apworkerEvent(M,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(Ae.addressList),firstSuccess:Pe===0,responseTime:Ee,serverIp:E[Pe%E.length]}),!1),(Ae,Pe)=>(St.apworkerEvent(M,{success:!1,sc:Ae.data&&Ae.data.code||200,serviceName:Y,responseTime:Ee,serverIp:E[Pe%E.length]}),!!(Ae.code!==K.OPERATION_ABORTED&&Ae.code!==K.UNEXPECTED_RESPONSE||Ae.data&&Ae.data.retry)&&(me=E[(Pe+1)%E.length],!0)),R)}(c,t,r,o);this.emit(fd.STATE_CHANGE,tv.AP_CONNECTED);const{addressList:f,ticket:g}=u;return this._ticket=g,f}async connectWorker(t){this.emit(fd.STATE_CHANGE,tv.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(qt.CONNECTED,async()=>{this.emit(fd.STATE_CHANGE,tv.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Dc.CONNECTED}),this._workerConnection.on(qt.CLOSED,()=>{this.connectionState=Dc.CLOSED}),this._workerConnection.on(qt.FAILED,()=>{this.connectionState=Dc.CLOSED}),this._workerConnection.on(qt.RECONNECTING,()=>{this.connectionState=this.connectionState===Dc.CONNECTED?Dc.RECONNECTING:Dc.CONNECTING}),this._workerConnection.on(qt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=nie(new Uint8Array(t.data));te("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),this._uploadNum++,r.code===void 0||r.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{St.reportApiInvoke(this._connectInfo.sid||null,{name:fi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r.code],tag:Gr.TRACER}).onError(new Te(K.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),this._uploadTimer=null},te("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(qt.WILL_RECONNECT,(t,r,o)=>{t==="recover"&&o(t),o("tryNext")}),this._workerConnection.on(qt.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Jo(this,fd.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(te("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(t,r);this._workerConnection.sendMessage(o,!0,!0)}else te("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(t,r){let{appId:o,cname:c,cid:u,vid:f,sid:g,uid:E}=r;const v=Date.now(),S=await t.getCurrentFrameImage("image/jpeg",this.quality),R=await L4(S,o,c),I=this._sequence+"-"+u+"-"+E+"-"+v+"-"+dr(12,""),D={appId:o,cid:u,cname:c,deviceId:"",elapse:H1.intToLong(Number(v-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:I,sdkVersion:"4.23.3",sequence:this._sequence,sid:g,timestamp:oH(v),uid:E,vid:f,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete D.callbackData;const V=tie(D);if(V.byteLength<this._workerMessageLengthLimit){if(te("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const M=function(j){for(var W=1;W<arguments.length;W++){var Y=arguments[W]!=null?arguments[W]:{};W%2?cH(Object(Y),!0).forEach(function(le){H(j,le,Y[le])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(Y)):cH(Object(Y)).forEach(function(le){Object.defineProperty(j,le,Object.getOwnPropertyDescriptor(Y,le))})}return j}({},D);delete M.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(M))}return V}{const M=this.quality*this._qualityRatio;return this.quality=M,await this.generateRequestData(t,{appId:o,cname:c,cid:u,vid:f,sid:g,uid:E})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ka.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Dc.CLOSED,this.emit(fd.STATE_CHANGE,tv.CLOSED)}}function lH(e){if(Zn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Te(K.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Te(K.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const uie={name:"ImageModeration",create:function(e){let{config:t}=e;return lH(t),new H1(t)}};var dH,uH,hH,pH,fH,mH,gH,_H,EH,yH,vH,SH,TH,bH,wH,RH,CH,AH,IH,NH,OH,DH,xH,PH,kH,LH,MH,jH,UH,VH,FH,BH,HH,GH,WH,zH,YH,qH,KH,XH,QH,st;function $H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Cl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$H(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$H(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}Ls.setLogger(x);let hie=(dH=Ot(),uH=Ot({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof qy))return[t];t=[t]}return t.map(r=>r?Object(r).toString():"null")}}),hH=Ot({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Yy.DATA?(Array.isArray(t)||(t=[t]),t.map(r=>r.getTrackId())):[t.getChannelId()])}),pH=Ot({argsMap:(e,t,r,o)=>[typeof t=="object"?t.uid:t,r,o]}),fH=Ot({argsMap:(e,t,r)=>[t,r]}),mH=Ot({argsMap:(e,t)=>t.map(r=>{let{user:o,mediaType:c}=r;return[o==null?void 0:o.uid,c]})}),gH=Ot({argsMap:(e,t,r,o)=>[typeof t=="object"?t.uid:t,r,o]}),_H=Ot({argsMap:(e,t)=>t.map(r=>{let{user:o,mediaType:c}=r;return{uid:o==null?void 0:o.uid,mediaType:c}})}),EH=Ot(),yH=Ot(),vH=Ot(),SH=Ot(),TH=Ot(),bH=Ot(),wH=Ot(),RH=Ot(),CH=Ot(),AH=Ot(),IH=Ot(),NH=Ot(),OH=Ot(),DH=Ot(),xH=Ot(),PH=Ot({argsMap:(e,t)=>[t]}),kH=Ot(),LH=Ot(),MH=Ot(),jH=Ot(),UH=Ot(),VH=Ot(),FH=Ot(),BH=Ot(),HH=Ot({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),GH=Ot(),WH=Ot(),zH=Ot(),YH=Ot(),qH=Ot(),KH=Ot(),XH=Ot({reportResult:!0}),QH=Ot(),st=class extends xr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let r;if(super(),H(this,"store",void 0),H(this,"_uid",void 0),H(this,"_channelName",void 0),H(this,"_uintUid",void 0),H(this,"_users",[]),H(this,"_config",void 0),H(this,"_clientId",void 0),H(this,"_appId",void 0),H(this,"_sessionId",null),H(this,"_key",void 0),H(this,"_rtmConfig",{}),H(this,"_joinInfo",void 0),H(this,"_gateway",void 0),H(this,"_statsCollector",void 0),H(this,"_configDistribute",void 0),H(this,"_leaveMutex",void 0),H(this,"_publishMutex",void 0),H(this,"_renewTokenMutex",void 0),H(this,"_subscribeMutex",void 0),H(this,"_encryptionMode","none"),H(this,"_encryptionSecret",null),H(this,"_encryptionSalt",null),H(this,"_encryptDataStream",!1),H(this,"_encryptDataStreamKey",null),H(this,"_encryptDataStreamIv",null),H(this,"_proxyServer",void 0),H(this,"_turnServer",{servers:[],mode:"auto"}),H(this,"_cloudProxyServerMode","disabled"),H(this,"_isDualStreamEnabled",!1),H(this,"_defaultStreamFallbackType",void 0),H(this,"_lowStreamParameter",void 0),H(this,"_streamFallbackTypeCacheMap",new Map),H(this,"_remoteStreamTypeCacheMap",new Map),H(this,"_axiosCancelSource",ka.CancelToken.source()),H(this,"_audioVolumeIndicationInterval",void 0),H(this,"_networkQualityInterval",void 0),H(this,"_userOfflineTimeout",void 0),H(this,"_streamRemovedTimeout",void 0),H(this,"_liveTranscodeStreamingClient",void 0),H(this,"_liveRawStreamingClient",void 0),H(this,"_channelMediaRelayClient",void 0),H(this,"_networkQualitySensitivity","normal"),H(this,"_p2pChannel",void 0),H(this,"_useLocalAccessPoint",!1),H(this,"_setLocalAPVersion",void 0),H(this,"_joinAndNotLeaveYet",!1),H(this,"_numberOfJoinCount",0),H(this,"_remoteDefaultVideoStreamType",void 0),H(this,"_inspect",void 0),H(this,"_moderation",void 0),H(this,"_license",void 0),H(this,"_pendingPublishedUsers",[]),H(this,"ntpAlignErrorCount",0),H(this,"remoteInboundOffset",0),H(this,"_peerConnectionState",void 0),H(this,"_handleLocalTrackEnable",(c,u,f)=>{this.publish(c,!1).then(u).catch(f)}),H(this,"_handleLocalTrackDisable",(c,u,f)=>{this.unpublish(c).then(u).catch(f)}),H(this,"_handleUserOnline",c=>{if(te("BLOCK_LOCAL_CLIENT")&&Wg(c.uid,this.channelName))return void x.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(f=>f.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(gn.USER_JOINED,u));else{const f=new Nf(c.uid,c.uint_id||c.uid);this._users.push(f),x.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(gn.USER_JOINED,f)}}),H(this,"_handleUserOffline",c=>{if(te("BLOCK_LOCAL_CLIENT")&&Wg(c.uid,this.channelName))return;const u=this._users.find(f=>f.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:OA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),x.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(gn.USER_LEAVED,u,c.reason))}),H(this,"_handleAddAudioOrVideoStream",(c,u,f,g,E,v,S)=>{if(te("BLOCK_LOCAL_CLIENT")&&Wg(u,this.channelName))return;const R=this._users.find(D=>D.uid===u);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const I=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=E||u),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,f!==void 0&&(R._audioSSRC=f),g!==void 0&&(R._cname=g),v&&(R._audioOrtc=v)):(R._video_added_=!0,f!==void 0&&(R._videoSSRC=f),g!==void 0&&(R._cname=g),S!==void 0&&(R._rtxSsrcId=S),v&&(R._videoOrtc=v)),(c==="audio"?R.hasAudio:R.hasVideo)&&!I&&(x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(gn.USER_PUBLISHED,R,c)),c==="video"?St.onGatewayStream(this._sessionId,Bi.ON_ADD_VIDEO_STREAM,Nr.ON_ADD_VIDEO_STREAM,{peer:E||u,ssrc:R._videoSSRC}):St.onGatewayStream(this._sessionId,Bi.ON_ADD_AUDIO_STREAM,Nr.ON_ADD_AUDIO_STREAM,{peer:E||u,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,f).then(D=>{if(D&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Jb))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(V=>{x.error("[".concat(this._clientId,"] resubscribe error"),V.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(D=>{x.error("[".concat(this._clientId,"] resubscribe error"),D.toString())}))}),H(this,"_handleRemoveStream",c=>{if(te("BLOCK_LOCAL_CLIENT")&&Wg(c.uid,this.channelName))return;const u=this._users.find(g=>g.uid===c.uid);if(!u)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let f=()=>{};u.hasAudio&&u.hasVideo?f=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(gn.USER_UNPUBLISHED,u,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(gn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?f=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(gn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(f=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(gn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof Jb&&this._p2pChannel.unsubscribe(u).then(g=>{if(g)return this._gateway.unsubscribe(g,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),St.onGatewayStream(this._sessionId,Bi.ON_REMOVE_STREAM,Nr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),f()}),H(this,"_handleSetStreamLocalEnable",(c,u,f)=>{if(te("BLOCK_LOCAL_CLIENT")&&Wg(u,this.channelName))return;const g=this._users.find(S=>S.uid===u);if(!g)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(f?"enabled":"disabled"," with uid ").concat(u));const E=c==="audio"?g.hasAudio:g.hasVideo;if(c==="audio"){g._trust_audio_enabled_state_=!0;const S=g._audio_enabled_;if(g._audio_enabled_=f,g._audio_enabled_===S)return;{const R=g._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(gn.USER_INFO_UPDATED,u,R)}}else{g._trust_video_enabled_state_=!0;const S=g._video_enabled_;if(g._video_enabled_=f,g._video_enabled_===S)return;{const R=g._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(gn.USER_INFO_UPDATED,u,R)}}const v=c==="audio"?g.hasAudio:g.hasVideo;return E!==v?!E&&v?(x.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(gn.USER_PUBLISHED,g,c)):(c==="video"&&g._videoTrack&&g._videoTrack._destroy(),c==="audio"&&g._audioTrack,this._p2pChannel.muteRemote(g,c),x.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(gn.USER_UNPUBLISHED,g,c)):void 0}),H(this,"_handleMuteStream",(c,u,f)=>{if(te("BLOCK_LOCAL_CLIENT")&&Wg(c,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),c,u,f);const g=this._users.find(S=>S.uid===c);if(!g)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const E=u==="audio"?g.hasAudio:g.hasVideo;if(u==="audio"){g._trust_audio_mute_state_=!0;const S=g._audio_muted_;if(g._audio_muted_=f,g._audio_muted_===S)return;{const R=g._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(gn.USER_INFO_UPDATED,c,R)}}else{g._trust_video_mute_state_=!0;const S=g._video_muted_;if(g._video_muted_=f,g._video_muted_===S)return;{const R=g._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(gn.USER_INFO_UPDATED,c,R)}}const v=u==="audio"?g.hasAudio:g.hasVideo;if(E!==v){if(!E&&v)return(u==="audio"?g._audioSSRC:g._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(gn.USER_PUBLISHED,g,u)):void x.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&g._videoTrack&&!g._video_pre_subscribed&&g._videoTrack._destroy(),u==="audio"&&g._audioTrack,this._p2pChannel.muteRemote(g,u),x.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(gn.USER_UNPUBLISHED,g,u)}}),H(this,"_handleP2PLost",async c=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),H(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(gn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),H(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),H(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(gn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(gn.NETWORK_QUALITY,c)}),H(this,"_handleP2PAddAudioOrVideoStream",(c,u,f,g)=>{const E=this._users.find(S=>S.uid===u);if(!E)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(E.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?E.hasAudio:E.hasVideo;c==="audio"?E._trust_audio_stream_added_state_=!0:E._trust_video_stream_added_state_=!0,c==="audio"?(E._audio_added_=!0,f!==void 0&&(E._audioSSRC=f),g!==void 0&&(E._audioMid=g)):(E._video_added_=!0,f!==void 0&&(E._videoSSRC=f),g!==void 0&&(E._videoMid=g)),(c==="audio"?E.hasAudio:E.hasVideo)&&!v&&(x.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published ").concat(c)),this.safeEmit(gn.USER_PUBLISHED,E,c)),this._p2pChannel.hasPendingRemoteMedia(E,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(E.uid," after reconnect.")),this._subscribe(E,c,!0).catch(S=>{x.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=e,this._clientId=t||dr(5,"client-"),this.store=new class{constructor(c,u,f,g){Vt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:f,clientId:g,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:jg.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,f){switch(f.type){case Sn.SET_SESSION_ID:return dt(dt({},u),{},{sessionId:f.sessionId});case Sn.SET_P2P_ID:return dt(dt({},u),{},{p2pId:f.p2pId});case Sn.SET_UID:return dt(dt({},u),{},{uid:f.uid});case Sn.SET_INT_UID:return dt(dt({},u),{},{intUid:f.intUid});case Sn.SET_PUB_ID:return dt(dt({},u),{},{pubId:f.pubId});case Sn.KEY_METRIC_CLIENT_CREATED:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{clientCreated:f.metric})});case Sn.KEY_METRIC_JOIN_START:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{joinStart:f.metric})});case Sn.KEY_METRIC_JOIN_END:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{joinEnd:f.metric})});case Sn.KEY_METRIC_REQUEST_AP_START:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{requestAPStart:f.metric})});case Sn.KEY_METRIC_REQUEST_AP_END:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{requestAPEnd:f.metric})});case Sn.KEY_METRIC_JOIN_GATEWAY_START:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{joinGatewayStart:f.metric})});case Sn.KEY_METRIC_JOIN_GATEWAY_END:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{joinGatewayEnd:f.metric})});case Sn.KEY_METRIC_PEER_CONNECTION_START:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{peerConnectionStart:f.metric})});case Sn.KEY_METRIC_PEER_CONNECTION_END:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{peerConnectionEnd:f.metric})});case Sn.KEY_METRIC_DESCRIPTION_START:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{descriptionStart:f.metric})});case Sn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{signalChannelOpen:f.metric})});case Sn.KEY_METRIC_ICE_CONNECTION_END:return dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{iceConnectionEnd:f.metric})});case Sn.KEY_METRIC_PUBLISH:{const g=u.keyMetrics.publish,E=g.findIndex(v=>v.trackId===f.metric.trackId);return E!==-1?(g[E]=dt(dt({},g[E]),f.metric),dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{publish:[...g]})})):dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,f.metric]})})}case Sn.KEY_METRIC_SUBSCRIBE:{const g=u.keyMetrics.subscribe,E=g.findIndex(v=>v.userId===f.metric.userId&&v.type===f.metric.type);return E!==-1?(g[E]=dt(dt({},g[E]),f.metric),dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{subscribe:[...g]})})):dt(dt({},u),{},{keyMetrics:dt(dt({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,f.metric]})})}case Sn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=f.mode,u;case Sn.RECORD_JOIN_CHANNEL_SERVICE:return typeof f.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,f.record]:(u.joinChannelServiceRecords[f.index]=dt(dt({},u.joinChannelServiceRecords[f.index]),f.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case Sn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case Sn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case Sn.SET_USE_P2P:return dt(dt({},u),{},{useP2P:f.val});case Sn.SET_TRANSPORT_TYPE:return dt(dt({},u),{},{p2pTransport:f.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:Sn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:Sn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:Sn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:Sn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:Sn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:Sn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:Sn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:Sn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:Sn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Sn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Sn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Sn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Sn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Sn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Sn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Sn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Sn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Sn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Sn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Sn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Sn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,f,g){this.dispatch({type:Sn.KEY_METRIC_PUBLISH,metric:dt(dt({trackId:c,type:u},f&&{publishStart:f}),g&&{publishEnd:g})})}subscribe(c,u,f,g,E,v,S){this.dispatch({type:Sn.KEY_METRIC_SUBSCRIBE,metric:dt(dt(dt(dt(dt({userId:c,type:u},f&&{subscribeStart:f}),g&&{subscribeEnd:g}),E&&{firstFrame:E}),v&&{streamAdded:v}),S&&{firstDecoded:S})})}massSubscribe(c,u,f,g){c.forEach(E=>{this.dispatch({type:Sn.KEY_METRIC_SUBSCRIBE,metric:dt(dt(dt({userId:E.userId,type:E.type},u&&{subscribeStart:u}),f&&{subscribeEnd:f}),g&&{firstFrame:g})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(f=>f.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:Sn.RECORD_JOIN_CHANNEL_SERVICE,record:dt(dt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Sn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Sn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Sn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Ls("client-leave",this._clientId),this._publishMutex=new Ls("client-publish",this._clientId),this._renewTokenMutex=new Ls("client-renewtoken",this._clientId),this._subscribeMutex=new Ls("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ic," build: ").concat(Pk,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{yk(e.clientRoleOptions),r=Object.assign({},e.clientRoleOptions)}catch(c){x.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new Xb(this.store),this._statsCollector.onStatsException=(c,u,f)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(f)),this.safeEmit(gn.EXCEPTION,{code:c,msg:u,uid:f})},this._statsCollector.onUploadPublishDuration=(c,u,f,g)=>{const E=this._users.find(v=>v.uid===c);E&&St.peerPublishStatus(this._sessionId,{subscribeElapse:g,audioPublishDuration:u,videoPublishDuration:f,peer:E._uintid})},this._statsCollector.onVideoCodecChanged=c=>{if(te("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){const u=this.localTracks.find(f=>f instanceof Er);u&&u._saveEncodeBitrateRatio!==1&&u.setSaveEncodeBitrateRatio(c==="h264"?te("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Ore(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Ri,httpRetryConfig:e.httpRetryConfig||Ri,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:r}),this._configDistribute=new Fre(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},Yh("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new Jb(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],f=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Kn("JOIN_GATEWAY_USE_443PORT_ONLY",u),Kn("JOIN_GATEWAY_USE_DUAL_DOMAIN",f);const g=this._gateway.signal.websocket;return g instanceof p1&&(g.use443PortOnly=u,g.tryDoubleDomain=f),async function(E,v,S){RA.get(E)||RA.set(E,[]),CA.get(E)||CA.set(E,v),uu.get(E)||uu.set(E,0);const R=RA.get(E),I=CA.get(E);if(!R||!I)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(uu.get(E)===I){const W=Rb();R.push(W),await W.promise}uu.set(E,uu.get(E)+1);for(var D=arguments.length,V=new Array(D>3?D-3:0),M=3;M<D;M++)V[M-3]=arguments[M];const j=await S(...V);return uu.set(E,uu.get(E)-1),uu.get(E)===I-1&&R.length>0&&(R[0].resolve(),R.shift()),uu.get(E)===0&&(RA.set(E,[]),CA.set(E,0),uu.set(E,0)),j}("client.join",te("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,r,o,c)}async join(e,t,r,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const f=(PA||PA||(PA=(window.location.protocol.split(":")[0]||"").toUpperCase(),PA))==="HTTPS",g=X3()?window.isSecureContext:"Browser Not Support";(!X3()&&!f||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),St.setAppId(e);try{if(!r&&r!==null)throw new Te(K.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&os(r,"token",1,2047),os(e,"appid",1,2047),eI(t),o&&tI(o),c&&os(c,"optionalInfo",1,2047)}catch(M){throw St.reportApiInvoke(Mg(),{name:fi.JOIN,options:[e,t,r,o],states:{isHttps:f,isSecureContext:g},tag:Gr.TRACER}).onError(M),M}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const M=new Te(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw St.reportApiInvoke(Mg(),{name:fi.JOIN,options:[e,t,r,o],states:{isHttps:f,isSecureContext:g},tag:Gr.TRACER}).onError(M),M}this._gateway.state="CONNECTING";const E=await q6({appId:e,cname:t,uid:o,stringUid:typeof o=="string"?o:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Te(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const v=(E==null?void 0:E.sid)||Mg();x.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(u)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);const S=St.reportApiInvoke(v,{id:this._clientId,name:fi.JOIN,options:[e,t,r,o],states:{isHttps:f,isSecureContext:g},tag:Gr.TRACER}),R=Cl(Cl(Cl({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!E},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:te("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(R.stringUid=o,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async M=>{const j=function(ye){const Ee=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),me=new Uint8Array(new ArrayBuffer(Ee.length));for(let Ae=0;Ae<Ee.length;Ae+=1)me[Ae]=Ee.charCodeAt(Ae);return me}(),W=await window.crypto.subtle.importKey("spki",j,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Y=_k(M),le=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},W,Y);return function(ye){let Ee="";for(let me=0;me<ye.length;me+=1)Ee+=String.fromCharCode(ye[me]);return window.btoa(Ee)}(new Uint8Array(le))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Te(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const M=new TextEncoder,j=te("USE_PURE_ENCRYPTION_MASTER_KEY")?M.encode(R.appId+this._encryptionSecret+this._encryptionSecret):M.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(W,Y,le){const ye=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=W==="aes-128-gcm2"?128:256,me=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:s4,hash:"SHA-256",salt:le},ye,Ee+sne);return new Uint8Array(me).subarray(Ee/8)}(this._encryptionMode,j,Lg(this._encryptionSalt)),this._encryptDataStreamKey=await async function(W,Y,le){const ye=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=W==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:s4,hash:"SHA-256",salt:le},ye,{name:"AES-GCM",length:Ee},!0,["encrypt","decrypt"])}(this._encryptionMode,j,Lg(this._encryptionSalt))}else g?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:R.stringUid});const I=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&I===this._sessionId&&St.joinChannelTimeout(this._sessionId,5)},5e3);try{var D;let M;const j=R.cloudProxyServer;if(Ze(D=["proxy3","proxy4","proxy5"]).call(D,j)){const Ee=te("PROXY_SERVER_TYPE3");Array.isArray(Ee)?R.proxyServer=Ee[0]:R.proxyServer=Ee}if(St.setProxyServer(R.proxyServer),x.setProxyServer(R.proxyServer),this.store.requestAPStart(),E){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(E.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=E.intUid),M={gatewayInfo:E.ap.gatewayInfo},te("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(E.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Ee=(await B9(E.ap.proxyInfo,E.ap.gatewayInfo.uid)).map(me=>({turnServerURL:me.address,tcpport:me.tcpport||vs.tcpport,udpport:me.udpport||vs.udpport,username:me.username||vs.username,password:me.password||vs.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:Ee}}Q6(E,R.stringUid)}else{if(R.stringUid&&!R.uid){let Ee;[Ee,M]=await tt.all([m6(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||Ri,this.store),f6(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Ri,!0,this.store)]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(Ee)),R.uid=Ee,M.gatewayInfo.uid=Ee,M.gatewayInfo.res.uid=Ee}else M=await f6(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Ri,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Te(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(Fb.UPDATE_BITRATE_LIMIT,Ee=>{this._p2pChannel.updateBitrateLimit(Ee)}),this._configDistribute.on(Fb.UPDATE_CLIENT_ROLE_OPTIONS,Ee=>{this._setClientRoleOptions(Ee)})},0),this._key=r||e;const W=M.gatewayInfo,Y=R.uid?R.uid:W.uid;this._joinInfo=Cl(Cl({},R),{},{cid:W.cid,uid:Y,vid:W.vid,apResponse:W.res,apGatewayAddress:W.apGatewayAddress,uni_lbs_ip:W.uni_lbs_ip,gatewayAddrs:W.gatewayAddrs}),this.store.intUid=Y,this.store.cid=W.cid;const le=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Te(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(le),this._appId=e,this._channelName=R.cname,this._uid=le,this.store.uid=le,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(_s()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ye=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(ye)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),V=this,Ze(Gg).call(Gg,V)||Gg.push(V),this._cloudProxyServerMode==="disabled"&&On().supportWebCrypto&&te("ENABLE_PRELOAD")&&F1(this._joinInfo),le}catch(M){const j=Array.isArray(M)?M[0]:M;throw j&&j.code===K.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),j):x.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),j),j.code!==K.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(j),j}var V}_joinGateway(){if(!this._joinInfo||!this._key)throw new Te(K.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!te("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(_s()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const r=Gg.indexOf(t);r!==-1&&Gg.splice(r,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Vn.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof qy))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Te(K.INVALID_PARAMS,"param list is empty");const r=e;if(this._gateway.role==="audience")throw new Te(K.INVALID_OPERATION,"audience can not publish stream");for(const c of r){if(!(c instanceof qy))throw new Te(K.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&t)throw new Te(K.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof Er&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(r),x.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw x.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){Zn(e.id,"id",0,65535,!0),Fh(e.ordered,"ordered"),os(e.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new Te(K.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Te(K.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&te("FORCE_TURN")&&!te("TURN_ENABLE_TCP")&&!te("TURN_ENABLE_UDP"))throw new Te(K.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const r=function(c){return s6(c,!1)}(e),o=await this._p2pChannel.publishDataChannel([r]);if(o.length>0){if(typeof r._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Te(K.CREATE_DATACHANNEL_ERROR);try{await tt.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await r._waitTillOpen()}catch(c){if(c.code!==K.DISCONNECT_P2P)throw c}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r}catch(r){throw x.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Te(K.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof qy))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(o=>"".concat(o.getTrackId()," "))," "));const r=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(t);o&&await this._gateway.sendExtensionMessage(oi.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(t);o&&await this._gateway.unpublish(o,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw x.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{r&&r()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(r=>"".concat(r.id," "))," "));const t=await this._publishMutex.lock();try{const r=await this._p2pChannel.unpublishDataChannel(e);r&&await this._gateway.unpublishDataChannel(r),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(r){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),r.toString()),r}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof Nf)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new Te(K.INVALID_REMOTE_USER,"user is not in the channel");e=o}return t==="datachannel"?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(Mi(t,"mediaType",["audio","video"]),this.store.useP2P)throw new Te(K.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Te(K.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const r=t===lt.AUDIO,o=t===lt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:f,rtxSsrcId:g,cname:E,uint_id:v}=await this._gateway.presubscribe(e,t,!0);if(u==null)throw new Te(K.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(I=>I.uid===e);S||(S=new Nf(e,v||e),S._is_pre_created=!0,this._users.push(S)),E&&(S._cname=E),S._uintid||(S._uintid=v||e),r&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,f&&(S._audioOrtc=f)),o&&(S._videoSSRC=u,S._video_pre_subscribed=!0,f&&(S._videoOrtc=f),g!=null&&(S._rtxSsrcId=g)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,t,u,g,f);const R=r?S._audioTrack:S._videoTrack;if(!R)throw new Te(K.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),R}catch(u){throw x.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,t){var r;if(Zn(t,"channelId",0,65535,!0),!this._joinInfo)throw new Te(K.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(g=>g===e))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Te(K.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Te(K.INVALID_REMOTE_USER,"user is not published");const c=(r=e._dataChannels)===null||r===void 0?void 0:r.find(g=>g.id===t);if(!c)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Te(K.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const g=await this._p2pChannel.subscribeDataChannel(e,[c]);if(g&&Ze(g).call(g,c.id))try{var f;if(typeof c._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Te(K.CREATE_DATACHANNEL_ERROR);const E={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(f=c.metadata)!==null&&f!==void 0?f:""};await this._gateway.subscribeDataChannel(e.uid,E,!0),await c._waitTillOpen()}catch(E){if((E==null?void 0:E.code)!==K.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),E;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,t,r){if(Mi(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Te(K.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new Te(K.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new Te(K.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!r&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const u=new Te(K.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),u}const c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const f=t==="audio"?e._audioSSRC:e._videoSSRC,g=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,f,g)}catch(f){throw f}x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(f=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),f)});const u=t==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new Te(K.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,t,r){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(Mi(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Te(K.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===e)){const v=new Te(K.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),v}if(!e.hasAudio&&!e.hasVideo){const v=new Te(K.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),v}if(!(r||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const v=new Te(K.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),v}let c=t==="audio"?e._audioSSRC:e._videoSSRC,u=t==="audio"?e._audioOrtc:e._videoOrtc,f=t==="video"?e._rtxSsrcId:void 0,g={stream_type:t==="audio"?lt.AUDIO:lt.VIDEO,ssrcId:c};const E=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const S=t==="audio"?e._audioSSRC:e._videoSSRC;S!==void 0&&S!==c&&(c=S,u=t==="audio"?e._audioOrtc:e._videoOrtc,f=t==="video"?e._rtxSsrcId:void 0,g={stream_type:t==="audio"?lt.AUDIO:lt.VIDEO,ssrcId:c}),Us.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,c,f,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,g,!0)}catch(R){if((R==null?void 0:R.code)!==K.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),R;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,e,t),S}x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(S=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const v=t==="audio"?e._audioTrack:e._videoTrack;if(!v)throw new Te(K.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),v),v}finally{E()}}async massSubscribe(e){if(Bh(e,"subscribeList"),!this._joinInfo)throw new Te(K.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),r=new Map,o=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(g=>{let{user:E,mediaType:v}=g;return"user: ".concat(E==null?void 0:E.uid,", mediaType: ").concat(v)}).join("; ")));const c=(e=[...e]).map(g=>{let{user:E,mediaType:v}=g;return{user:E,mediaType:v}}),u=await this._p2pChannel.globalLock();try{var f;for(let E=e.length-1;E>=0;E--){const v=e[E],{user:S,mediaType:R}=v;if(Mi(R,"mediaType",["audio","video"]),!S){const M=new Te(K.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),M}if(!this._users.find(M=>M===S)){const M=new Te(K.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[E].error=M,e.splice(E,1);continue}if(R==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||R==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const M=new Te(K.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(R,", remote user is not published")),c[E].error=M,e.splice(E,1);continue}const D=Hi.Video|Hi.LwoVideo,V=r.get(S);if(V){if(R==="video"?V&D:V&Hi.Audio){e.splice(E,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(R," twice"));continue}r.set(S,V|(R==="video"?D:Hi.Audio))}else r.set(S,R==="video"?D:Hi.Audio)}for(let E=e.length-1;E>=0;E--){const v=e[E],{user:S,mediaType:R}=v,I=Hi.Video|Hi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,R)){await this._p2pChannel.unmuteRemoteNoLock(S,R);const D=r.get(S);r.set(S,R==="video"?D^I:D^Hi.Audio),e.splice(E,1)}}this.store.massSubscribe(e.map(E=>({userId:E.user.uid,type:E.mediaType})),t);let g=Qa(f=Array.from(r.entries())).call(f,(E,v)=>{let[S,R]=v;if(R===0)return E;const I={stream_id:S.uid,stream_type:R};return R&Hi.Audio&&(I.audio_ssrc=S._audioSSRC),R&Hi.Video&&(I.video_ssrc=S._videoSSRC),E.push(I),E},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(v=>{let{user:S,mediaType:R}=v;return{user:S,mediaType:R,ssrcId:R===lt.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:R===lt.VIDEO?S._rtxSsrcId:void 0}}));const E=new Map;if(g=g.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),g.length>0){const v=await this._gateway.subscribeAll(g,!0);((v==null?void 0:v.users)||[]).forEach(S=>{let{stream_id:R,video_error_code:I,audio_error_code:D,error_code:V}=S;(I||D||V)&&E.set(R,{video_error_code:I,audio_error_code:D,error_code:V})})}if(Array.from(E.entries()).length>0){const v=[];Array.from(E.entries()).forEach(S=>{let[R,I]=S;const D=this.remoteUsers.find(V=>V.uid===R);if(D){let V;I.error_code||I.video_error_code&&I.audio_error_code?V=void 0:I.video_error_code?V=lt.VIDEO:I.audio_error_code&&(V=lt.AUDIO),v.push({user:D,mediaType:V})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const S=E.get(v.user.uid);if(S){const R=S.error_code||v.mediaType==="audio"&&S.audio_error_code||v.mediaType==="video"&&S.video_error_code;if(R){const I=Bb(R);x.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(I.desc)),v.error=new Te(K.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(I.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var S;St.subscribe(this.store.sessionId,{succ:!!v.error,ec:((S=v.error)===null||S===void 0?void 0:S.code)||null,video:v.mediaType===lt.VIDEO,audio:v.mediaType===lt.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===lt.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(v=>{let{user:S,mediaType:R}=v;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(E){throw await this._p2pChannel.massUnsubscribeNoLock(e),E}}finally{u(),o()}}async unsubscribe(e,t,r){if(!(e instanceof Nf)){const u=this.remoteUsers.find(f=>f.uid===e);if(!u)throw new Te(K.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&Mi(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Te(K.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new Te(K.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const u=await this._p2pChannel.unsubscribe(e,t);u&&await this._gateway.unsubscribe(u,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&OA(this._users,e),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(u){if(u.code===K.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,t){if(t&&Zn(t,"id",0,65535,!0),!this._joinInfo)throw new Te(K.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new Te(K.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let o;if(typeof t=="number"){const c=e._dataChannels.find(u=>u.id===t);c&&(o=[c])}else o=e._dataChannels;if(o===void 0){const c=new Te(K.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),c}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,o);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===K.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(Bh(e,"unsubscribeList"),!this._joinInfo)throw new Te(K.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(r=>{let{user:o,mediaType:c}=r;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const t=new Map;for(let r=e.length-1;r>=0;r--){const{user:o,mediaType:c}=e[r];if(!o){const g=new Te(K.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),g}if(Mi(c,"mediaType",["video","audio",void 0]),!this._users.find(g=>g===o)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(r,1);continue}const f=Hi.Video|Hi.LwoVideo;if(t.has(o)){const g=t.get(o);let E;switch(c){case"video":E=g&f;break;case"audio":E=g&Hi.Audio;break;default:E=g&(Hi.Audio|f)}if(E){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(r,1);continue}c?c==="audio"?t.set(o,g|Hi.Audio):c==="video"&&t.set(o,g|f):t.set(o,g|Hi.Audio|f)}else c?c==="audio"?t.set(o,Hi.Audio):c==="video"&&t.set(o,f):t.set(o,Hi.Audio|f)}try{const r=await this._p2pChannel.massUnsubscribe(e);r&&await this._gateway.massUnsubscribe(r),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(r){if(r.code===K.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),r.toString()),r}}async setLowStreamParameter(e){(function(r){if(!r)throw new Ie(K.INVALID_PARAMS);Hr(r.width)||mk(r.width,"streamParameter.width"),Hr(r.height)||mk(r.height,"streamParameter.height"),Hr(r.framerate)||mk(r.framerate,"streamParameter.framerate"),Hr(r.bitrate)||Zn(r.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Fe.LocalVideoLowTrack)}async enableDualStream(){if(!On().supportDualStream)throw St.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Te(K.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Te(K.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw St.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,St.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Te(K.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Fe.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw St.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,St.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(o){Mi(o,"role",["audience","host"])}(e),t&&yk(t),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Te(K.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new Te(K.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Te(K.INVALID_OPERATION,"can not set client role to audience when publishing stream");const r=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==r&&te("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Es.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),x.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&yk(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(os(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new Te(K.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Te(K.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,St.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new Te(K.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Te(K.INVALID_OPERATION,"You have already set the proxy")}if(Ob(e))return this._turnServer={servers:e,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(r=>r.urls).join(","),"."));e.forEach(r=>j3(r)),this._turnServer={servers:e,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Te(K.INVALID_OPERATION,"you should set license before join channel");if(os(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Te(K.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,x.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Te(K.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Te(K.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let r;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Te(K.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r="proxy3";break;case 4:r="proxy4";break;case 5:r="proxy5";break;default:throw new Te(K.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=r,this.store.cloudProxyServerMode=r,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Te(K.INVALID_OPERATION,"Stop proxy server after leave channel");St.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Te(K.INVALID_PARAMS,"accessPoints is required.");Bh(e.accessPoints.serverList,"accessPoints.serverList"),os(e.accessPoints.domain,"accessPoints.domain");const t=(I,D)=>{Zn(I,D,0,65535,!0)};let r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Te(K.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");te("CLOSE_AFB_FOR_LOCAL_AP")&&(Kn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Kn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(I=>o.test(I)?"".concat(I.replace(/\./g,"-"),".").concat(c):I),f=u.map(I=>"".concat(I,":").concat(r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Kn("WEBCS_DOMAIN",f),Kn("WEBCS_DOMAIN_BACKUP_LIST",f),Kn("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Bh(e.report.hostname,"report.hostname"),Kn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Kn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Kn("EVENT_REPORT_DOMAIN",u[0]),Kn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let g=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),g=e.report.port),Kn("STATS_COLLECTOR_PORT",g),e.report?Kn("ENABLE_EVENT_REPORT",!0):Kn("ENABLE_EVENT_REPORT",!1);let E="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Bh(e.log.hostname,"log.hostname"),E=e.log.hostname[0]):E=u[0];let v=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),v=e.log.port),Kn("LOG_UPLOAD_SERVER","".concat(E,":").concat(v));let S=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Bh(e.cds.hostname,"cds.hostname"),S=e.cds.hostname):S=u;let R=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),R=e.cds.port),Kn("CDS_AP",S.map(I=>"".concat(I,":").concat(R))),e.cds?Kn("ENABLE_CONFIG_DISTRIBUTE",!0):Kn("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Bh(e,"serverList"),os(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Te(K.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>r.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(t):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Kn("WEBCS_DOMAIN",e),Kn("WEBCS_DOMAIN_BACKUP_LIST",e),Kn("GATEWAY_DOMAINS",[t]),Kn("EVENT_REPORT_DOMAIN",e[0]),Kn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Kn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Mi(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Mi(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const r=this._users.find(o=>o.uid===e);r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(r){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),r.toString()),r}x.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Mi(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(r){throw x.error("[".concat(this._clientId,"] set stream fallback option"),r.toString()),r}x.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,o){(function(u){Mi(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),os(t,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(Ze(c).call(c,e)){if(!r||!(r instanceof Uint8Array&&r.length===32))throw new Te(K.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new Te(K.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(Fh(o,"encryptDataStream"),!Ze(c).call(c,e))throw new Te(K.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=Sf(r))}async renewToken(e){if(os(e,"token",1,2047),!this._key||!this._joinInfo)throw new Te(K.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const r=await this._renewTokenMutex.lock();try{if(te("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await Vre(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ri);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=t,this._joinInfo.token=t,x.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(gn.VOLUME_INDICATOR,e)},te("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new Te(K.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Te(K.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Te(K.LIVE_STREAMING_TASK_CONFLICT);const r=t?Gh.TRANSCODE:Gh.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(Gh.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(r=>r&&r.hasUrl(e));if(!t.length)throw new Te(K.INVALID_PARAMS,"can not find live streaming url to stop");await tt.all(t.map(r=>r&&r.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){T6(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){T6(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Jb&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Te(K.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ze(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(o=!0,e.payload=await async function(c,u,f){var g;const E=Qa(g=Array.from(f)).call(g,(M,j)=>M+j,0),v={serverTs:0,seq:ane++,length:f.length,checkSum:E},S=new Uint8Array(z3(E,2)),R=new ArrayBuffer(Fy),I=new DataView(R);I.setUint32(0,v.serverTs),I.setUint16(4,v.seq),I.setUint16(6,v.length),I.setUint16(8,v.checkSum);const D=16-f.length%16;f=F3(f,new Uint8Array(D));const V=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:i4,additionalData:S},u,f);return F3(new Uint8Array(R),new Uint8Array(V))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Te(K.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(kt.DATA_STREAM,{payload:Sf(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Kre},!r)}sendMetadata(e){if(!this._joinInfo)throw new Te(K.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Te(K.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(kt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Sf(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(mne),!this._joinInfo)throw new Te(K.INVALID_OPERATION,"can not send custom report, not joined");await St.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){Mi(t.spatialLayer,"spatialLayer",[0,1,2,3]),Mi(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(r){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),r.toString()),r}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:r}=e;if(Fh(t,"apRTM"),Zn(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(e){const t=Zy.indexOf(e);t!==-1&&Zy.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=ka.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&X6(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&St.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ls("client-publish",this._clientId),this._subscribeMutex=new Ls("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var r;const o=e||Mg();e?x.debug("[".concat(this._clientId,"] new Session ").concat(o)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,St.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((r=this._joinInfo)===null||r===void 0?void 0:r.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};St.sessionInit(this._sessionId,Cl({cname:t.channel,appid:t.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Te(K.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&te("FORCE_TURN")&&!te("TURN_ENABLE_TCP")&&!te("TURN_ENABLE_UDP"))throw new Te(K.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await r.next()).value;if(o){try{await this._gateway.sendExtensionMessage(oi.PUBLISH,o,!0)}catch(c){throw r.throw(c),c}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await r.next()).value;if(o){var t;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==K.DISCONNECT_P2P)throw r.throw(u),u}await r.next(((t=c)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof Er&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,e),(r==null?void 0:r.code)===K.WS_ABORT)return;throw r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Te(K.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(K.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await r.next()).value;if(o){var t;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==K.DISCONNECT_P2P)throw r.throw(u),u}r.next(((t=c)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,void 0,!0),(r==null?void 0:r.code)===K.WS_ABORT)return;throw r}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new Te(K.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Yh("LiveStreaming").create(o));var o;return r.onLiveStreamError=(c,u)=>{St.reportApiInvoke(this._sessionId,{name:fi.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Gr.TRACER}).onSuccess(),this.safeEmit(gn.LIVE_STREAMING_ERROR,c,u)},r.onLiveStreamWarning=(c,u)=>{St.reportApiInvoke(this._sessionId,{name:fi.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Gr.TRACER}).onSuccess(),this.safeEmit(gn.LIVE_STREAMING_WARNING,c,u)},r.on(d1.REQUEST_WORKER_MANAGER_LIST,(c,u,f)=>{if(!this._joinInfo)return f(new Te(K.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(g,E,v,S){const R=te("UAP_AP").slice(0,te("AJAX_REQUEST_CONCURRENT")).map(I=>E.proxyServer?"https://".concat(E.proxyServer,"/ap/?url=").concat(I+"/api/v1?action=uap"):"https://".concat(I,"/api/v1?action=uap"));return await Pre(R,g,E,v,S)})(c,this._joinInfo,this._axiosCancelSource.token,Ri).then(u).catch(f)}),r};return e===Gh.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Te(K.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:r}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:r}},Yh("ChannelMediaRelay").create(e));o.on("state",c=>{c===ro.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(gn.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(gn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var f;c==="resolution"&&((f=this._channelMediaRelayClient)===null||f===void 0||f.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:r,deleted:o}=e,c=[];if(t){const u=[];this._users.forEach(f=>{f._dataChannels.forEach(g=>{r.every(E=>E.uid!==f._uintid||E.stream_id!==g.id)&&u.push({uid:f._uintid,stream_id:g.id,ordered:g.ordered,max_retrans_times:g.maxRetransmits,metadata:g.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(r)&&r.length>0&&r.forEach(u=>{const{uid:f,stream_id:g,ordered:E,max_retrans_times:v,metadata:S}=u,R=this._users.find(I=>I._uintid===f);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(f)),Ze(c).call(c,R)||c.push(R),R._uintid||(R._uintid=f),R._dataChannels.findIndex(I=>I.id===u.stream_id)===-1){const I={id:g,ordered:!!E,maxRetransmits:v,metadata:S},D=function(V){return s6(V,!0)}(I);R._dataChannels.push(D),x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),t||this.safeEmit(gn.USER_PUBLISHED,R,"datachannel",I)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(I=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),I.toString())}))}),t&&(this.safeEmit(gn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:f,stream_id:g}=u,E=this._users.find(S=>S._uintid===f);if(!E)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=E._dataChannels.find(S=>S.id===u.stream_id);v&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(f)),this._p2pChannel.unsubscribeDataChannel(E,[v]).then(S=>{if(E._dataChannels=E._dataChannels.filter(R=>R!==v),S)return this._gateway.unsubscribeDataChannel(S,E.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(f," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(gn.USER_UNPUBLISHED,E,"datachannel",v._config))})}_handleRemoveDataChannels(e){const t=this._users.find(r=>r.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const r=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(o=>{this.safeEmit(gn.USER_UNPUBLISHED,t,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,t.uid)}),r()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Ki.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void x.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),r=Date.now();Object.keys(t).forEach(o=>{const{value:c,type:u,expires:f}=t[o];f&&f<=r||u||r1()||!Object.prototype.hasOwnProperty.call(MA,o)||(ud[o]=c,Tr[o]=c,x.debug("Update gateway parameters from config distribute",o,c))})}catch(t){x.error("Error update config from local cache",t.message)}})()}),this._gateway.on(Ki.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Ki.CONNECTION_STATE_CHANGE,(e,t,r)=>{var o;if(r===Vn.FALLBACK)return;const c=()=>{this.safeEmit(gn.CONNECTION_STATE_CHANGE,e,t,r)};if(St.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:fi.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:Gr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(f=>{f._trust_in_room_=!1,f._trust_audio_enabled_state_=!1,f._trust_video_enabled_state_=!1,f._trust_audio_mute_state_=!1,f._trust_video_mute_state_=!1,f._trust_audio_stream_added_state_=!1,f._trust_video_stream_added_state_=!1,f._is_pre_created||(f._audio_pre_subscribed||(f._audioSSRC=void 0,f._audioOrtc=void 0),f._video_pre_subscribed||(f._videoSSRC=void 0,f._videoOrtc=void 0,f._rtxSsrcId=void 0),f._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((f,g)=>{this._gateway.setStreamFallbackOption(g,f).catch(E=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),E)})}),this._remoteStreamTypeCacheMap.forEach((f,g)=>{this._gateway.setRemoteVideoStreamType(g,f).catch(E=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),E)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(f=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(f))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(f=>!f._trust_in_room_).forEach(f=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(f.uid)),this._handleUserOffline({uid:f.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(f=>{f._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(f.uid)),this._handleMuteStream(f.uid,lt.AUDIO,!1)),f._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(f.uid)),this._handleMuteStream(f.uid,lt.VIDEO,!1)),f._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(f.uid)),this._handleSetStreamLocalEnable("audio",f.uid,!0)),f._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(f.uid)),this._handleSetStreamLocalEnable("video",f.uid,!0)),f._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(f.uid)),this._handleResetAddStream(f,"video")),f._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(f.uid)),this._handleResetAddStream(f,"audio")),f._video_added_||f._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(f.uid)),this._handleRemoveStream({uid:f.uid,uint_id:f._uintid}))}))},1e3))}c()}),this._gateway.on(Ki.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new Te(K.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r;const o=await q6(Cl(Cl({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(r=o.ap,Q6(o),this._joinInfo.preload=!0):(r=await A1(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ri,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=r.gatewayInfo.res,this._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);const c=[];r.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:f}=u;const[g,E]=f.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:g,port:E}):c.push({host:g,port:E})}),e(c)}catch(r){t(r)}}),this._gateway.on(Ki.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(gn.NETWORK_QUALITY,e)}),this._gateway.on(Ki.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(gn.STREAM_TYPE_CHANGED,e,t),St.reportApiInvoke(this._sessionId,{name:fi.STREAM_TYPE_CHANGE,options:[e,t],tag:Gr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(Ki.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Ki.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,r)=>{try{let o=await this._p2pChannel.getEstablishParams();te("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),t(o)}catch(o){r(o)}}),this._gateway.on(Ki.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let r;e.attributes?r=e.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const o=q9(e.ortc,t,r);this._p2pChannel.connect(o)}),this._gateway.on(Ki.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=te("FINGERPRINT"))!==null&&o!==void 0?o:r}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(En.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(En.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(En.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(En.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(En.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(En.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(En.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(En.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(En.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,lt.AUDIO,!0)),this._gateway.signal.on(En.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,lt.AUDIO,!1)),this._gateway.signal.on(En.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,lt.VIDEO,!0)),this._gateway.signal.on(En.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,lt.VIDEO,!1)),this._gateway.signal.on(En.RECEIVE_METADATA,e=>{const t=Lg(e.metadata);this.safeEmit(gn.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(En.ON_DATA_STREAM,async e=>{var t;if(!e)return;let r=Lg(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ze(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Fy)throw new Te(K.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Fy));r=await async function(u,f,g){const E=g.subarray(0,Fy),v=E.slice(8,Fy),S=(v[0]<<8)+v[1],R=(E[6]<<8)+E[7],I=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:i4,additionalData:new Uint8Array(z3(S,2))},f,g.subarray(Fy));return new Uint8Array(I).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let o=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(g=>g.uid===e.uid),f=c==null?void 0:c.audioRecv.find(g=>g.ssrc===(u==null?void 0:u._audioSSRC));o=f==null?void 0:f.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),Qre(Cl(Cl({},e),{},{payload:r}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(En.ON_CRYPT_ERROR,()=>{vf(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(gn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(En.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Vn.TOKEN_EXPIRE),this.safeEmit(gn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(En.ON_STREAM_FALLBACK_UPDATE,e=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(gn.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(En.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(En.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(En.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(jt.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case kt.PUBLISH:{if(!t)return;const c=t.ortc;if(c){var r,o;const u=c.some(E=>{let{stream_type:v}=E;return v===Hn.Audio}),f=c.some(E=>{let{stream_type:v}=E;return v!==Hn.Audio}),g=c.some(E=>{let{stream_type:v}=E;return v===Hn.Screen||v===Hn.ScreenLow});t.state==="offer"&&St.publish(this._joinInfo.sid,{eventElapse:Us.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:K.TIMEOUT,audio:u,video:f,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:g,audioName:u?(r=c.find(E=>{let{stream_type:v}=E;return v===Hn.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:f?(o=c.find(E=>{let{stream_type:v}=E;return v!==Hn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case kt.SUBSCRIBE:t&&St.subscribe(this._joinInfo.sid,{succ:!1,ec:K.TIMEOUT,audio:t.stream_type===lt.AUDIO,video:t.stream_type===lt.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Us.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(En.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(En.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;te("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!Wg(o.string_id||o.stream_id,this.channelName)));const t=[],r=[];for(const o of e.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Nf(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(gn.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(gn.USER_JOINED,c)));const u=Hi.Audio&o.stream_type,f=(Hi.Video|Hi.LwoVideo)&o.stream_type,g=(65280&o.stream_type)!=0,E=u&&c.hasAudio,v=f&&c.hasVideo;f&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!E&&this.getListeners(gn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(gn.USER_PUBLISHED,c,"audio")),f&&!v&&this.getListeners(gn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(gn.USER_PUBLISHED,c,"video")),(u&&!E||f&&!v||g)&&t.push(c),f&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&r.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&r.push({user:c,mediaType:"audio"})}r.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(r).catch(o=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(gn.PUBLISHED_USER_LIST).length>0?te("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(o=>o.uid).join(", "))),this.safeEmit(gn.PUBLISHED_USER_LIST,t)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(En.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof Jb&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(r=>r.toLowerCase()).filter(r=>{var o;return Ze(o=Object.keys(jA)).call(o,r)}))})}_handleP2PEvents(){this._gateway.signal.on(En.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(oi.PUBLISH,(e,t,r)=>{const{uid:o}=e;e.forEach(c=>{const{kind:u,ssrcs:f,mid:g,isMuted:E}=c;this._handleP2PAddAudioOrVideoStream(u,o,f[0].ssrcId,g);const v=this._users.find(S=>S.uid===o);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,u,f[0].ssrcId,g).then(()=>{t()}).catch(r):t(),this._handleMuteStream(o,u,!!E)})}),this._gateway.signal.on(oi.CALL,async(e,t,r)=>{if(this.store.useP2P)try{var o;t(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){r(c)}}),this._gateway.signal.on(jt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(oi.UNPUBLISH,async(e,t,r)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=e,u=this._users.find(f=>f.uid===c);if(!u)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void t();try{o.forEach(async f=>{let{stream_type:g}=f;const E=g===Hn.Audio?lt.AUDIO:lt.VIDEO;await this._p2pChannel.unsubscribe(u,E),this._handleMuteStream(c,E,!0)}),t()}catch(f){r(f)}}}),this._gateway.signal.on(oi.CONTROL,async(e,t)=>{const{action:r}=e;switch(r){case wf.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,lt.VIDEO,!0);break;case wf.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,lt.AUDIO,!0);break;case wf.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,lt.VIDEO,!1);break;case wf.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,lt.AUDIO,!1)}}),this._gateway.signal.on(oi.RESTART_ICE,async(e,t,r)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=e;o!==va.SEND_ONLY||c?t(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),t())}catch(o){r(o)}}),this._gateway.signal.on(oi.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}}),this._p2pChannel.on(Rt.RequestP2PRestartICE,async(e,t,r)=>{try{const{direction:o}=e;t(await this._gateway.sendExtensionMessage(oi.RESTART_ICE,e,o===va.SEND_ONLY))}catch(o){r(o)}}),this._p2pChannel.on(Rt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(oi.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Rt.RequestP2PMuteLocal,async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(oi.CONTROL,e,!0),t()}catch(o){r(o)}}),this._p2pChannel.on(Rt.RequestP2PUnmuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===K.DISCONNECT_P2P?t():r(o)}else t()}),this._p2pChannel.on(Rt.RequestP2PMuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===K.DISCONNECT_P2P?t():r(o)}else t()}),this._p2pChannel.on(Rt.StateChange,(e,t)=>{t===Fn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Rt.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(gn.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Rt.RequestMuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===K.DISCONNECT_P2P?t():r(o)}else t()}),this._p2pChannel.on(Rt.RequestUnmuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===K.DISCONNECT_P2P?t():r(o)}else t()}),this._p2pChannel.on(Rt.RequestRePublish,(e,t,r)=>{this.publish(e,!1).then(t).catch(r)}),this._p2pChannel.on(Rt.RequestRePublishDataChannel,(e,t,r)=>{tt.all(e.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==K.DISCONNECT_P2P)throw u}})).then(t).catch(r)}),this._p2pChannel.on(Rt.RequestReSubscribe,async(e,t,r)=>{try{for(const{user:o,kind:c}of e)c===lt.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");t()}catch(o){r(o)}}),this._p2pChannel.on(Rt.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Rt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Rt.MediaReconnectStart,e=>{this.safeEmit(gn.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Rt.MediaReconnectEnd,e=>{this.safeEmit(gn.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Rt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Rt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),r=await t.next();if(r.done)return;const o=r.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(f){return void t.throw(f)}const{iceParameters:u}=function(f){const g=f.iceParameters;return{iceParameters:{iceUfrag:g.iceUfrag,icePwd:g.icePwd}}}(c);await t.next({remoteIceParameters:u})}),this._p2pChannel.on(Rt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Rt.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:r,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:o}),f=q9(c,u);await this._p2pChannel.connect(f),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Rt.RequestUnpublishForReconnectPC,async(e,t,r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):r()}),this._p2pChannel.on(Rt.P2PLost,()=>{this.safeEmit(gn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Rt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Rt.ConnectionTypeChange,e=>{this.safeEmit(gn.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Rt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Rt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Rt.AudioMetadata,e=>{this.safeEmit(gn.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Te(K.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Te(K.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const r=(t={config:e},Yh("ContentInspect").create(t));this._inspect=r,this.handleVideoInspectEvents(r);const{appId:o,cname:c,sid:u,token:f,uid:g,cid:E,vid:v}=this._joinInfo;await r.init({appId:o,areaCode:"",cname:c,sid:u,token:f,uid:g,cid:E,vid:v?Number(v):0},Ri)}catch(r){throw Array.isArray(r)?r[0]:r}var t}handleVideoInspectEvents(e){e.on(Xi.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(gn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===Sl.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(gn.CONTENT_INSPECT_ERROR,new Te(K.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Xi.INSPECT_RESULT,(t,r)=>{var o;if((r==null?void 0:r.code)===K.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(gn.CONTENT_INSPECT_RESULT,t,r)}),e.on(Xi.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Te(K.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Fh(e,"enabled"),e){if(!t)throw new Te(K.INVALID_PARAMS,"config is required");if(lH(t),!this._joinInfo)throw new Te(K.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const o=(r={config:t},Yh("ImageModeration").create(r));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:f,token:g,uid:E,cid:v,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:f,token:g,uid:E,cid:v,vid:S?Number(S):0},Ri)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var r;if(!this._moderation)throw new Te(K.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(fd.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(gn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===Dc.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Te(K.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(fd.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){Mi(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Te(K.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Fh(e,"enabled"),Kn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},gt(st.prototype,"leave",[dH],Object.getOwnPropertyDescriptor(st.prototype,"leave"),st.prototype),gt(st.prototype,"publish",[uH],Object.getOwnPropertyDescriptor(st.prototype,"publish"),st.prototype),gt(st.prototype,"unpublish",[hH],Object.getOwnPropertyDescriptor(st.prototype,"unpublish"),st.prototype),gt(st.prototype,"subscribe",[pH],Object.getOwnPropertyDescriptor(st.prototype,"subscribe"),st.prototype),gt(st.prototype,"presubscribe",[fH],Object.getOwnPropertyDescriptor(st.prototype,"presubscribe"),st.prototype),gt(st.prototype,"massSubscribe",[mH],Object.getOwnPropertyDescriptor(st.prototype,"massSubscribe"),st.prototype),gt(st.prototype,"unsubscribe",[gH],Object.getOwnPropertyDescriptor(st.prototype,"unsubscribe"),st.prototype),gt(st.prototype,"massUnsubscribe",[_H],Object.getOwnPropertyDescriptor(st.prototype,"massUnsubscribe"),st.prototype),gt(st.prototype,"setLowStreamParameter",[EH],Object.getOwnPropertyDescriptor(st.prototype,"setLowStreamParameter"),st.prototype),gt(st.prototype,"enableDualStream",[yH],Object.getOwnPropertyDescriptor(st.prototype,"enableDualStream"),st.prototype),gt(st.prototype,"disableDualStream",[vH],Object.getOwnPropertyDescriptor(st.prototype,"disableDualStream"),st.prototype),gt(st.prototype,"setClientRole",[SH],Object.getOwnPropertyDescriptor(st.prototype,"setClientRole"),st.prototype),gt(st.prototype,"_setClientRoleOptions",[TH],Object.getOwnPropertyDescriptor(st.prototype,"_setClientRoleOptions"),st.prototype),gt(st.prototype,"setProxyServer",[bH],Object.getOwnPropertyDescriptor(st.prototype,"setProxyServer"),st.prototype),gt(st.prototype,"setTurnServer",[wH],Object.getOwnPropertyDescriptor(st.prototype,"setTurnServer"),st.prototype),gt(st.prototype,"setLicense",[RH],Object.getOwnPropertyDescriptor(st.prototype,"setLicense"),st.prototype),gt(st.prototype,"startProxyServer",[CH],Object.getOwnPropertyDescriptor(st.prototype,"startProxyServer"),st.prototype),gt(st.prototype,"stopProxyServer",[AH],Object.getOwnPropertyDescriptor(st.prototype,"stopProxyServer"),st.prototype),gt(st.prototype,"setLocalAccessPointsV2",[IH],Object.getOwnPropertyDescriptor(st.prototype,"setLocalAccessPointsV2"),st.prototype),gt(st.prototype,"setLocalAccessPoints",[NH],Object.getOwnPropertyDescriptor(st.prototype,"setLocalAccessPoints"),st.prototype),gt(st.prototype,"setRemoteDefaultVideoStreamType",[OH],Object.getOwnPropertyDescriptor(st.prototype,"setRemoteDefaultVideoStreamType"),st.prototype),gt(st.prototype,"setRemoteVideoStreamType",[DH],Object.getOwnPropertyDescriptor(st.prototype,"setRemoteVideoStreamType"),st.prototype),gt(st.prototype,"setStreamFallbackOption",[xH],Object.getOwnPropertyDescriptor(st.prototype,"setStreamFallbackOption"),st.prototype),gt(st.prototype,"setEncryptionConfig",[PH],Object.getOwnPropertyDescriptor(st.prototype,"setEncryptionConfig"),st.prototype),gt(st.prototype,"renewToken",[kH],Object.getOwnPropertyDescriptor(st.prototype,"renewToken"),st.prototype),gt(st.prototype,"enableAudioVolumeIndicator",[LH],Object.getOwnPropertyDescriptor(st.prototype,"enableAudioVolumeIndicator"),st.prototype),gt(st.prototype,"startLiveStreaming",[MH],Object.getOwnPropertyDescriptor(st.prototype,"startLiveStreaming"),st.prototype),gt(st.prototype,"setLiveTranscoding",[jH],Object.getOwnPropertyDescriptor(st.prototype,"setLiveTranscoding"),st.prototype),gt(st.prototype,"stopLiveStreaming",[UH],Object.getOwnPropertyDescriptor(st.prototype,"stopLiveStreaming"),st.prototype),gt(st.prototype,"startChannelMediaRelay",[VH],Object.getOwnPropertyDescriptor(st.prototype,"startChannelMediaRelay"),st.prototype),gt(st.prototype,"updateChannelMediaRelay",[FH],Object.getOwnPropertyDescriptor(st.prototype,"updateChannelMediaRelay"),st.prototype),gt(st.prototype,"stopChannelMediaRelay",[BH],Object.getOwnPropertyDescriptor(st.prototype,"stopChannelMediaRelay"),st.prototype),gt(st.prototype,"sendCustomReportMessage",[HH],Object.getOwnPropertyDescriptor(st.prototype,"sendCustomReportMessage"),st.prototype),gt(st.prototype,"pickSVCLayer",[GH],Object.getOwnPropertyDescriptor(st.prototype,"pickSVCLayer"),st.prototype),gt(st.prototype,"setRTMConfig",[WH],Object.getOwnPropertyDescriptor(st.prototype,"setRTMConfig"),st.prototype),gt(st.prototype,"enableContentInspect",[zH],Object.getOwnPropertyDescriptor(st.prototype,"enableContentInspect"),st.prototype),gt(st.prototype,"disableContentInspect",[YH],Object.getOwnPropertyDescriptor(st.prototype,"disableContentInspect"),st.prototype),gt(st.prototype,"setImageModeration",[qH],Object.getOwnPropertyDescriptor(st.prototype,"setImageModeration"),st.prototype),gt(st.prototype,"setP2PTransport",[KH],Object.getOwnPropertyDescriptor(st.prototype,"setP2PTransport"),st.prototype),gt(st.prototype,"getJoinChannelServiceRecords",[XH],Object.getOwnPropertyDescriptor(st.prototype,"getJoinChannelServiceRecords"),st.prototype),gt(st.prototype,"setPublishAudioFilterEnabled",[QH],Object.getOwnPropertyDescriptor(st.prototype,"setPublishAudioFilterEnabled"),st.prototype),st);class tw{constructor(t,r){H(this,"id",0),H(this,"element",void 0),H(this,"peerPair",void 0),H(this,"context",void 0),H(this,"audioPlayerElement",void 0),H(this,"audioTrack",void 0),tw.count+=1,this.id=tw.count,this.element=t,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const r=document.createElement("audio");r.srcObject=new MediaStream([t.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;const t=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new tt(f=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&f(o.localDescription)}})},r=async(o,c)=>await o.setRemoteDescription(c);try{const o=await t(this.peerPair[0],"offer");await r(this.peerPair[1],o);const c=await t(this.peerPair[1],"answer");await r(this.peerPair[0],c)}catch(o){throw new Te(K.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let r;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(r)}catch(c){throw new Te(K.LOCAL_AEC_ERROR,c.toString()).print()}if(!r)throw new Te(K.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=r.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,r=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var JH,AI;H(tw,"count",0);const pie=window.AudioContext||window.webkitAudioContext,fie=new(JH=Ot({report:St}),gt((AI=class{constructor(){H(this,"units",[]),H(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new pie);let t=this.units.find(r=>r&&r.getElement()===e);return t||(t=new tw(e,this.context),this.units.push(t)),t.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Nn().name!==Mn.SAFARI}}).prototype,"processExternalMediaAEC",[JH],Object.getOwnPropertyDescriptor(AI.prototype,"processExternalMediaAEC"),AI.prototype),AI);function ZH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function eG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZH(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZH(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const G1=window||document;function tG(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!G1)return;const r=Ci._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);const o=c=>{if(!(c&&c.blockedURI&&(Ci.onSecurityPolicyViolation||Ci.getListeners(_u.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;te("CSP_DETECTED_HOSTNAME_LIST").some(f=>Ze(u).call(u,f))&&(Ci.onSecurityPolicyViolation&&typeof Ci.onSecurityPolicyViolation=="function"&&Ci.onSecurityPolicyViolation(c),Ci.getListeners(_u.SECURITY_POLICY_VIOLATION).length>0&&Ci.safeEmit(_u.SECURITY_POLICY_VIOLATION,c))};r&&G1.removeEventListener("securitypolicyviolation",r),(t||e&&typeof e=="function"||Ci.getListeners(_u.SECURITY_POLICY_VIOLATION).length>0)&&G1.addEventListener("securitypolicyviolation",o),Ci._cspEventHandlerPointer=o}var mie=U,gie=VB,nG=RegExp.prototype,_ie=function(e){return e===nG||mie(nG,e)?gie(e):e.flags},la=l(_ie);function pv(e){let t=e.length;for(;--t>=0;)e[t]=0}const W1=256,rG=286,nw=30,rw=15,z1=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),II=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Eie=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),iG=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Kh=new Array(576);pv(Kh);const iw=new Array(60);pv(iw);const sw=new Array(512);pv(sw);const aw=new Array(256);pv(aw);const Y1=new Array(29);pv(Y1);const NI=new Array(nw);function q1(e,t,r,o,c){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let sG,aG,oG;function K1(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}pv(NI);const cG=e=>e<256?sw[e]:sw[256+(e>>>7)],ow=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},cc=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,ow(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},Tu=(e,t,r)=>{cc(e,r[2*t],r[2*t+1])},lG=(e,t)=>{let r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1},dG=(e,t,r)=>{const o=new Array(16);let c,u,f=0;for(c=1;c<=rw;c++)f=f+r[c-1]<<1,o[c]=f;for(u=0;u<=t;u++){let g=e[2*u+1];g!==0&&(e[2*u]=lG(o[g]++,g))}},uG=e=>{let t;for(t=0;t<rG;t++)e.dyn_ltree[2*t]=0;for(t=0;t<nw;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},hG=e=>{e.bi_valid>8?ow(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},pG=(e,t,r,o)=>{const c=2*t,u=2*r;return e[c]<e[u]||e[c]===e[u]&&o[t]<=o[r]},X1=(e,t,r)=>{const o=e.heap[r];let c=r<<1;for(;c<=e.heap_len&&(c<e.heap_len&&pG(t,e.heap[c+1],e.heap[c],e.depth)&&c++,!pG(t,o,e.heap[c],e.depth));)e.heap[r]=e.heap[c],r=c,c<<=1;e.heap[r]=o},fG=(e,t,r)=>{let o,c,u,f,g=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+g++],o+=(255&e.pending_buf[e.sym_buf+g++])<<8,c=e.pending_buf[e.sym_buf+g++],o===0?Tu(e,c,t):(u=aw[c],Tu(e,u+W1+1,t),f=z1[u],f!==0&&(c-=Y1[u],cc(e,c,f)),o--,u=cG(o),Tu(e,u,r),f=II[u],f!==0&&(o-=NI[u],cc(e,o,f)));while(g<e.sym_next);Tu(e,256,t)},Q1=(e,t)=>{const r=t.dyn_tree,o=t.stat_desc.static_tree,c=t.stat_desc.has_stree,u=t.stat_desc.elems;let f,g,E,v=-1;for(e.heap_len=0,e.heap_max=573,f=0;f<u;f++)r[2*f]!==0?(e.heap[++e.heap_len]=v=f,e.depth[f]=0):r[2*f+1]=0;for(;e.heap_len<2;)E=e.heap[++e.heap_len]=v<2?++v:0,r[2*E]=1,e.depth[E]=0,e.opt_len--,c&&(e.static_len-=o[2*E+1]);for(t.max_code=v,f=e.heap_len>>1;f>=1;f--)X1(e,r,f);E=u;do f=e.heap[1],e.heap[1]=e.heap[e.heap_len--],X1(e,r,1),g=e.heap[1],e.heap[--e.heap_max]=f,e.heap[--e.heap_max]=g,r[2*E]=r[2*f]+r[2*g],e.depth[E]=(e.depth[f]>=e.depth[g]?e.depth[f]:e.depth[g])+1,r[2*f+1]=r[2*g+1]=E,e.heap[1]=E++,X1(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((S,R)=>{const I=R.dyn_tree,D=R.max_code,V=R.stat_desc.static_tree,M=R.stat_desc.has_stree,j=R.stat_desc.extra_bits,W=R.stat_desc.extra_base,Y=R.stat_desc.max_length;let le,ye,Ee,me,Ae,Pe,$e=0;for(me=0;me<=rw;me++)S.bl_count[me]=0;for(I[2*S.heap[S.heap_max]+1]=0,le=S.heap_max+1;le<573;le++)ye=S.heap[le],me=I[2*I[2*ye+1]+1]+1,me>Y&&(me=Y,$e++),I[2*ye+1]=me,ye>D||(S.bl_count[me]++,Ae=0,ye>=W&&(Ae=j[ye-W]),Pe=I[2*ye],S.opt_len+=Pe*(me+Ae),M&&(S.static_len+=Pe*(V[2*ye+1]+Ae)));if($e!==0){do{for(me=Y-1;S.bl_count[me]===0;)me--;S.bl_count[me]--,S.bl_count[me+1]+=2,S.bl_count[Y]--,$e-=2}while($e>0);for(me=Y;me!==0;me--)for(ye=S.bl_count[me];ye!==0;)Ee=S.heap[--le],Ee>D||(I[2*Ee+1]!==me&&(S.opt_len+=(me-I[2*Ee+1])*I[2*Ee],I[2*Ee+1]=me),ye--)}})(e,t),dG(r,v,e.bl_count)},mG=(e,t,r)=>{let o,c,u=-1,f=t[1],g=0,E=7,v=4;for(f===0&&(E=138,v=3),t[2*(r+1)+1]=65535,o=0;o<=r;o++)c=f,f=t[2*(o+1)+1],++g<E&&c===f||(g<v?e.bl_tree[2*c]+=g:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):g<=10?e.bl_tree[34]++:e.bl_tree[36]++,g=0,u=c,f===0?(E=138,v=3):c===f?(E=6,v=3):(E=7,v=4))},gG=(e,t,r)=>{let o,c,u=-1,f=t[1],g=0,E=7,v=4;for(f===0&&(E=138,v=3),o=0;o<=r;o++)if(c=f,f=t[2*(o+1)+1],!(++g<E&&c===f)){if(g<v)do Tu(e,c,e.bl_tree);while(--g!=0);else c!==0?(c!==u&&(Tu(e,c,e.bl_tree),g--),Tu(e,16,e.bl_tree),cc(e,g-3,2)):g<=10?(Tu(e,17,e.bl_tree),cc(e,g-3,3)):(Tu(e,18,e.bl_tree),cc(e,g-11,7));g=0,u=c,f===0?(E=138,v=3):c===f?(E=6,v=3):(E=7,v=4)}};let _G=!1;const EG=(e,t,r,o)=>{cc(e,0+(o?1:0),3),hG(e),ow(e,r),ow(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var yie=e=>{_G||((()=>{let t,r,o,c,u;const f=new Array(16);for(o=0,c=0;c<28;c++)for(Y1[c]=o,t=0;t<1<<z1[c];t++)aw[o++]=c;for(aw[o-1]=c,u=0,c=0;c<16;c++)for(NI[c]=u,t=0;t<1<<II[c];t++)sw[u++]=c;for(u>>=7;c<nw;c++)for(NI[c]=u<<7,t=0;t<1<<II[c]-7;t++)sw[256+u++]=c;for(r=0;r<=rw;r++)f[r]=0;for(t=0;t<=143;)Kh[2*t+1]=8,t++,f[8]++;for(;t<=255;)Kh[2*t+1]=9,t++,f[9]++;for(;t<=279;)Kh[2*t+1]=7,t++,f[7]++;for(;t<=287;)Kh[2*t+1]=8,t++,f[8]++;for(dG(Kh,287,f),t=0;t<nw;t++)iw[2*t+1]=5,iw[2*t]=lG(t,5);sG=new q1(Kh,z1,257,rG,rw),aG=new q1(iw,II,0,nw,rw),oG=new q1(new Array(0),Eie,0,19,7)})(),_G=!0),e.l_desc=new K1(e.dyn_ltree,sG),e.d_desc=new K1(e.dyn_dtree,aG),e.bl_desc=new K1(e.bl_tree,oG),e.bi_buf=0,e.bi_valid=0,uG(e)},vie=(e,t,r,o)=>{let c,u,f=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(g=>{let E,v=4093624447;for(E=0;E<=31;E++,v>>>=1)if(1&v&&g.dyn_ltree[2*E]!==0)return 0;if(g.dyn_ltree[18]!==0||g.dyn_ltree[20]!==0||g.dyn_ltree[26]!==0)return 1;for(E=32;E<W1;E++)if(g.dyn_ltree[2*E]!==0)return 1;return 0})(e)),Q1(e,e.l_desc),Q1(e,e.d_desc),f=(g=>{let E;for(mG(g,g.dyn_ltree,g.l_desc.max_code),mG(g,g.dyn_dtree,g.d_desc.max_code),Q1(g,g.bl_desc),E=18;E>=3&&g.bl_tree[2*iG[E]+1]===0;E--);return g.opt_len+=3*(E+1)+5+5+4,E})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=r+5,r+4<=c&&t!==-1?EG(e,t,r,o):e.strategy===4||u===c?(cc(e,2+(o?1:0),3),fG(e,Kh,iw)):(cc(e,4+(o?1:0),3),((g,E,v,S)=>{let R;for(cc(g,E-257,5),cc(g,v-1,5),cc(g,S-4,4),R=0;R<S;R++)cc(g,g.bl_tree[2*iG[R]+1],3);gG(g,g.dyn_ltree,E-1),gG(g,g.dyn_dtree,v-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,f+1),fG(e,e.dyn_ltree,e.dyn_dtree)),uG(e),o&&hG(e)},Sie=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(aw[r]+W1+1)]++,e.dyn_dtree[2*cG(t)]++),e.sym_next===e.sym_end),Tie=e=>{cc(e,2,3),Tu(e,256,Kh),(t=>{t.bi_valid===16?(ow(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},bie={_tr_init:yie,_tr_stored_block:EG,_tr_flush_block:vie,_tr_tally:Sie,_tr_align:Tie},cw=(e,t,r,o)=>{let c=65535&e|0,u=e>>>16&65535|0,f=0;for(;r!==0;){f=r>2e3?2e3:r,r-=f;do c=c+t[o++]|0,u=u+c|0;while(--f);c%=65521,u%=65521}return c|u<<16|0};const wie=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var Ta=(e,t,r,o)=>{const c=wie,u=o+r;e^=-1;for(let f=o;f<u;f++)e=e>>>8^c[255&(e^t[f])];return-1^e},Qg={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},OI={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Rie,_tr_stored_block:$1,_tr_flush_block:Cie,_tr_tally:Pf,_tr_align:Aie}=bie,{Z_NO_FLUSH:kf,Z_PARTIAL_FLUSH:Iie,Z_FULL_FLUSH:Nie,Z_FINISH:Al,Z_BLOCK:yG,Z_OK:Ua,Z_STREAM_END:vG,Z_STREAM_ERROR:bu,Z_DATA_ERROR:Oie,Z_BUF_ERROR:J1,Z_DEFAULT_COMPRESSION:Die,Z_FILTERED:xie,Z_HUFFMAN_ONLY:DI,Z_RLE:Pie,Z_FIXED:kie,Z_DEFAULT_STRATEGY:Lie,Z_UNKNOWN:Mie,Z_DEFLATED:xI}=OI,Z1=286,jie=30,Uie=19,Vie=2*Z1+1,Fie=15,$g=258,wu=262,fv=42,Jg=113,lw=666,Zg=(e,t)=>(e.msg=Qg[t],t),SG=e=>2*e-(e>4?9:0),Lf=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Bie=e=>{let t,r,o,c=e.w_size;t=e.hash_size,o=t;do r=e.head[--o],e.head[o]=r>=c?r-c:0;while(--t);t=c,o=t;do r=e.prev[--o],e.prev[o]=r>=c?r-c:0;while(--t)};let Mf=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const xc=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},Pc=(e,t)=>{Cie(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,xc(e.strm)},ti=(e,t)=>{e.pending_buf[e.pending++]=t},dw=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},eL=(e,t,r,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,t.set(e.input.subarray(e.next_in,e.next_in+c),r),e.state.wrap===1?e.adler=cw(e.adler,t,c,r):e.state.wrap===2&&(e.adler=Ta(e.adler,t,c,r)),e.next_in+=c,e.total_in+=c,c)},TG=(e,t)=>{let r,o,c=e.max_chain_length,u=e.strstart,f=e.prev_length,g=e.nice_match;const E=e.strstart>e.w_size-wu?e.strstart-(e.w_size-wu):0,v=e.window,S=e.w_mask,R=e.prev,I=e.strstart+$g;let D=v[u+f-1],V=v[u+f];e.prev_length>=e.good_match&&(c>>=2),g>e.lookahead&&(g=e.lookahead);do if(r=t,v[r+f]===V&&v[r+f-1]===D&&v[r]===v[u]&&v[++r]===v[u+1]){u+=2,r++;do;while(v[++u]===v[++r]&&v[++u]===v[++r]&&v[++u]===v[++r]&&v[++u]===v[++r]&&v[++u]===v[++r]&&v[++u]===v[++r]&&v[++u]===v[++r]&&v[++u]===v[++r]&&u<I);if(o=$g-(I-u),u=I-$g,o>f){if(e.match_start=t,f=o,o>=g)break;D=v[u+f-1],V=v[u+f]}}while((t=R[t&S])>E&&--c!=0);return f<=e.lookahead?f:e.lookahead},mv=e=>{const t=e.w_size;let r,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-wu)&&(e.window.set(e.window.subarray(t,t+t-o),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Bie(e),o+=t),e.strm.avail_in===0)break;if(r=eL(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=r,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=Mf(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=Mf(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<wu&&e.strm.avail_in!==0)},bG=(e,t)=>{let r,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,f=0,g=e.strm.avail_in;do{if(r=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,r>o+e.strm.avail_in&&(r=o+e.strm.avail_in),r>c&&(r=c),r<u&&(r===0&&t!==Al||t===kf||r!==o+e.strm.avail_in)))break;f=t===Al&&r===o+e.strm.avail_in?1:0,$1(e,0,0,f),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,xc(e.strm),o&&(o>r&&(o=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,r-=o),r&&(eL(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(f===0);return g-=e.strm.avail_in,g&&(g>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=g&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-g,e.strm.next_in),e.strstart),e.strstart+=g,e.insert+=g>e.w_size-e.insert?e.w_size-e.insert:g),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),f?4:t!==kf&&t!==Al&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(eL(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||t===Al)&&t!==kf&&e.strm.avail_in===0&&o<=c)&&(r=o>c?c:o,f=t===Al&&e.strm.avail_in===0&&r===o?1:0,$1(e,e.block_start,r,f),e.block_start+=r,xc(e.strm)),f?3:1)},tL=(e,t)=>{let r,o;for(;;){if(e.lookahead<wu){if(mv(e),e.lookahead<wu&&t===kf)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Mf(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-wu&&(e.match_length=TG(e,r)),e.match_length>=3)if(o=Pf(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Mf(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Mf(e,e.ins_h,e.window[e.strstart+1]);else o=Pf(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(Pc(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Al?(Pc(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Pc(e,!1),e.strm.avail_out===0)?1:2},gv=(e,t)=>{let r,o,c;for(;;){if(e.lookahead<wu){if(mv(e),e.lookahead<wu&&t===kf)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Mf(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-wu&&(e.match_length=TG(e,r),e.match_length<=5&&(e.strategy===xie||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=Pf(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=Mf(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(Pc(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=Pf(e,0,e.window[e.strstart-1]),o&&Pc(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=Pf(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Al?(Pc(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Pc(e,!1),e.strm.avail_out===0)?1:2};function Ru(e,t,r,o,c){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=o,this.func=c}const uw=[new Ru(0,0,0,0,bG),new Ru(4,4,8,4,tL),new Ru(4,5,16,8,tL),new Ru(4,6,32,32,tL),new Ru(4,4,16,16,gv),new Ru(8,16,32,32,gv),new Ru(8,16,128,128,gv),new Ru(8,32,128,256,gv),new Ru(32,128,258,1024,gv),new Ru(32,258,258,4096,gv)];function Hie(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=xI,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Vie),this.dyn_dtree=new Uint16Array(2*(2*jie+1)),this.bl_tree=new Uint16Array(2*(2*Uie+1)),Lf(this.dyn_ltree),Lf(this.dyn_dtree),Lf(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Fie+1),this.heap=new Uint16Array(2*Z1+1),Lf(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Z1+1),Lf(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const hw=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==fv&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Jg&&t.status!==lw?1:0},wG=e=>{if(hw(e))return Zg(e,bu);e.total_in=e.total_out=0,e.data_type=Mie;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?fv:Jg,e.adler=t.wrap===2?0:1,t.last_flush=-2,Rie(t),Ua},RG=e=>{const t=wG(e);return t===Ua&&(r=>{r.window_size=2*r.w_size,Lf(r.head),r.max_lazy_match=uw[r.level].max_lazy,r.good_match=uw[r.level].good_length,r.nice_match=uw[r.level].nice_length,r.max_chain_length=uw[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0})(e.state),t},CG=(e,t,r,o,c,u)=>{if(!e)return bu;let f=1;if(t===Die&&(t=6),o<0?(f=0,o=-o):o>15&&(f=2,o-=16),c<1||c>9||r!==xI||o<8||o>15||t<0||t>9||u<0||u>kie||o===8&&f!==1)return Zg(e,bu);o===8&&(o=9);const g=new Hie;return e.state=g,g.strm=e,g.status=fv,g.wrap=f,g.gzhead=null,g.w_bits=o,g.w_size=1<<g.w_bits,g.w_mask=g.w_size-1,g.hash_bits=c+7,g.hash_size=1<<g.hash_bits,g.hash_mask=g.hash_size-1,g.hash_shift=~~((g.hash_bits+3-1)/3),g.window=new Uint8Array(2*g.w_size),g.head=new Uint16Array(g.hash_size),g.prev=new Uint16Array(g.w_size),g.lit_bufsize=1<<c+6,g.pending_buf_size=4*g.lit_bufsize,g.pending_buf=new Uint8Array(g.pending_buf_size),g.sym_buf=g.lit_bufsize,g.sym_end=3*(g.lit_bufsize-1),g.level=t,g.strategy=u,g.method=r,RG(e)};var Gie=(e,t)=>{if(hw(e)||t>yG||t<0)return e?Zg(e,bu):bu;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===lw&&t!==Al)return Zg(e,e.avail_out===0?J1:bu);const o=r.last_flush;if(r.last_flush=t,r.pending!==0){if(xc(e),e.avail_out===0)return r.last_flush=-1,Ua}else if(e.avail_in===0&&SG(t)<=SG(o)&&t!==Al)return Zg(e,J1);if(r.status===lw&&e.avail_in!==0)return Zg(e,J1);if(r.status===fv&&r.wrap===0&&(r.status=Jg),r.status===fv){let c=xI+(r.w_bits-8<<4)<<8,u=-1;if(u=r.strategy>=DI||r.level<2?0:r.level<6?1:r.level===6?2:3,c|=u<<6,r.strstart!==0&&(c|=32),c+=31-c%31,dw(r,c),r.strstart!==0&&(dw(r,e.adler>>>16),dw(r,65535&e.adler)),e.adler=1,r.status=Jg,xc(e),r.pending!==0)return r.last_flush=-1,Ua}if(r.status===57){if(e.adler=0,ti(r,31),ti(r,139),ti(r,8),r.gzhead)ti(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),ti(r,255&r.gzhead.time),ti(r,r.gzhead.time>>8&255),ti(r,r.gzhead.time>>16&255),ti(r,r.gzhead.time>>24&255),ti(r,r.level===9?2:r.strategy>=DI||r.level<2?4:0),ti(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(ti(r,255&r.gzhead.extra.length),ti(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Ta(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(ti(r,0),ti(r,0),ti(r,0),ti(r,0),ti(r,0),ti(r,r.level===9?2:r.strategy>=DI||r.level<2?4:0),ti(r,3),r.status=Jg,xc(e),r.pending!==0)return r.last_flush=-1,Ua}if(r.status===69){if(r.gzhead.extra){let c=r.pending,u=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+u>r.pending_buf_size;){let g=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+g),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>c&&(e.adler=Ta(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex+=g,xc(e),r.pending!==0)return r.last_flush=-1,Ua;c=0,u-=g}let f=new Uint8Array(r.gzhead.extra);r.pending_buf.set(f.subarray(r.gzindex,r.gzindex+u),r.pending),r.pending+=u,r.gzhead.hcrc&&r.pending>c&&(e.adler=Ta(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex=0}r.status=73}if(r.status===73){if(r.gzhead.name){let c,u=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>u&&(e.adler=Ta(e.adler,r.pending_buf,r.pending-u,u)),xc(e),r.pending!==0)return r.last_flush=-1,Ua;u=0}c=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,ti(r,c)}while(c!==0);r.gzhead.hcrc&&r.pending>u&&(e.adler=Ta(e.adler,r.pending_buf,r.pending-u,u)),r.gzindex=0}r.status=91}if(r.status===91){if(r.gzhead.comment){let c,u=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>u&&(e.adler=Ta(e.adler,r.pending_buf,r.pending-u,u)),xc(e),r.pending!==0)return r.last_flush=-1,Ua;u=0}c=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,ti(r,c)}while(c!==0);r.gzhead.hcrc&&r.pending>u&&(e.adler=Ta(e.adler,r.pending_buf,r.pending-u,u))}r.status=103}if(r.status===103){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(xc(e),r.pending!==0))return r.last_flush=-1,Ua;ti(r,255&e.adler),ti(r,e.adler>>8&255),e.adler=0}if(r.status=Jg,xc(e),r.pending!==0)return r.last_flush=-1,Ua}if(e.avail_in!==0||r.lookahead!==0||t!==kf&&r.status!==lw){let c=r.level===0?bG(r,t):r.strategy===DI?((u,f)=>{let g;for(;;){if(u.lookahead===0&&(mv(u),u.lookahead===0)){if(f===kf)return 1;break}if(u.match_length=0,g=Pf(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,g&&(Pc(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,f===Al?(Pc(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Pc(u,!1),u.strm.avail_out===0)?1:2})(r,t):r.strategy===Pie?((u,f)=>{let g,E,v,S;const R=u.window;for(;;){if(u.lookahead<=$g){if(mv(u),u.lookahead<=$g&&f===kf)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(v=u.strstart-1,E=R[v],E===R[++v]&&E===R[++v]&&E===R[++v])){S=u.strstart+$g;do;while(E===R[++v]&&E===R[++v]&&E===R[++v]&&E===R[++v]&&E===R[++v]&&E===R[++v]&&E===R[++v]&&E===R[++v]&&v<S);u.match_length=$g-(S-v),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(g=Pf(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(g=Pf(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),g&&(Pc(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,f===Al?(Pc(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Pc(u,!1),u.strm.avail_out===0)?1:2})(r,t):uw[r.level].func(r,t);if(c!==3&&c!==4||(r.status=lw),c===1||c===3)return e.avail_out===0&&(r.last_flush=-1),Ua;if(c===2&&(t===Iie?Aie(r):t!==yG&&($1(r,0,0,!1),t===Nie&&(Lf(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),xc(e),e.avail_out===0))return r.last_flush=-1,Ua}return t!==Al?Ua:r.wrap<=0?vG:(r.wrap===2?(ti(r,255&e.adler),ti(r,e.adler>>8&255),ti(r,e.adler>>16&255),ti(r,e.adler>>24&255),ti(r,255&e.total_in),ti(r,e.total_in>>8&255),ti(r,e.total_in>>16&255),ti(r,e.total_in>>24&255)):(dw(r,e.adler>>>16),dw(r,65535&e.adler)),xc(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Ua:vG)},Wie=(e,t)=>{let r=t.length;if(hw(e))return bu;const o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==fv||o.lookahead)return bu;if(c===1&&(e.adler=cw(e.adler,t,r,0)),o.wrap=0,r>=o.w_size){c===0&&(Lf(o.head),o.strstart=0,o.block_start=0,o.insert=0);let E=new Uint8Array(o.w_size);E.set(t.subarray(r-o.w_size,r),0),t=E,r=o.w_size}const u=e.avail_in,f=e.next_in,g=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,mv(o);o.lookahead>=3;){let E=o.strstart,v=o.lookahead-2;do o.ins_h=Mf(o,o.ins_h,o.window[E+3-1]),o.prev[E&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=E,E++;while(--v);o.strstart=E,o.lookahead=2,mv(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=f,e.input=g,e.avail_in=u,o.wrap=c,Ua},pw={deflateInit:(e,t)=>CG(e,t,xI,15,8,Lie),deflateInit2:CG,deflateReset:RG,deflateResetKeep:wG,deflateSetHeader:(e,t)=>hw(e)||e.state.wrap!==2?bu:(e.state.gzhead=t,Ua),deflate:Gie,deflateEnd:e=>{if(hw(e))return bu;const t=e.state.status;return e.state=null,t===Jg?Zg(e,Oie):Ua},deflateSetDictionary:Wie,deflateInfo:"pako deflate (from Nodeca project)"};const zie=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var PI={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const o in r)zie(r,o)&&(e[o]=r[o])}}return e},flattenChunks:e=>{let t=0;for(let o=0,c=e.length;o<c;o++)t+=e[o].length;const r=new Uint8Array(t);for(let o=0,c=0,u=e.length;o<u;o++){let f=e[o];r.set(f,c),c+=f.length}return r}};let AG=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{AG=!1}const fw=new Uint8Array(256);for(let e=0;e<256;e++)fw[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;fw[254]=fw[254]=1;var mw={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,o,c,u,f=e.length,g=0;for(c=0;c<f;c++)r=e.charCodeAt(c),(64512&r)==55296&&c+1<f&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(r=65536+(r-55296<<10)+(o-56320),c++)),g+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(g),u=0,c=0;u<g;c++)r=e.charCodeAt(c),(64512&r)==55296&&c+1<f&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(r=65536+(r-55296<<10)+(o-56320),c++)),r<128?t[u++]=r:r<2048?(t[u++]=192|r>>>6,t[u++]=128|63&r):r<65536?(t[u++]=224|r>>>12,t[u++]=128|r>>>6&63,t[u++]=128|63&r):(t[u++]=240|r>>>18,t[u++]=128|r>>>12&63,t[u++]=128|r>>>6&63,t[u++]=128|63&r);return t},buf2string:(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let o,c;const u=new Array(2*r);for(c=0,o=0;o<r;){let f=e[o++];if(f<128){u[c++]=f;continue}let g=fw[f];if(g>4)u[c++]=65533,o+=g-1;else{for(f&=g===2?31:g===3?15:7;g>1&&o<r;)f=f<<6|63&e[o++],g--;g>1?u[c++]=65533:f<65536?u[c++]=f:(f-=65536,u[c++]=55296|f>>10&1023,u[c++]=56320|1023&f)}}return((f,g)=>{if(g<65534&&f.subarray&&AG)return String.fromCharCode.apply(null,f.length===g?f:f.subarray(0,g));let E="";for(let v=0;v<g;v++)E+=String.fromCharCode(f[v]);return E})(u,c)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(192&e[r])==128;)r--;return r<0||r===0?t:r+fw[e[r]]>t?r:t}},IG=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const NG=Object.prototype.toString,{Z_NO_FLUSH:Yie,Z_SYNC_FLUSH:qie,Z_FULL_FLUSH:Kie,Z_FINISH:Xie,Z_OK:kI,Z_STREAM_END:Qie,Z_DEFAULT_COMPRESSION:$ie,Z_DEFAULT_STRATEGY:Jie,Z_DEFLATED:Zie}=OI;function LI(e){this.options=PI.assign({level:$ie,method:Zie,chunkSize:16384,windowBits:15,memLevel:8,strategy:Jie},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new IG,this.strm.avail_out=0;let r=pw.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==kI)throw new Error(Qg[r]);if(t.header&&pw.deflateSetHeader(this.strm,t.header),t.dictionary){let o;if(o=typeof t.dictionary=="string"?mw.string2buf(t.dictionary):NG.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,r=pw.deflateSetDictionary(this.strm,o),r!==kI)throw new Error(Qg[r]);this._dict_set=!0}}function ese(e,t){const r=new LI(t);if(r.push(e,!0),r.err)throw r.msg||Qg[r.err];return r.result}LI.prototype.push=function(e,t){const r=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=t===~~t?t:t===!0?Xie:Yie,typeof e=="string"?r.input=mw.string2buf(e):NG.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(r.avail_out===0&&(r.output=new Uint8Array(o),r.next_out=0,r.avail_out=o),(u===qie||u===Kie)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(c=pw.deflate(r,u),c===Qie)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),c=pw.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===kI;if(r.avail_out!==0){if(u>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(r.avail_in===0)break}else this.onData(r.output)}return!0},LI.prototype.onData=function(e){this.chunks.push(e)},LI.prototype.onEnd=function(e){e===kI&&(this.result=PI.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var tse={deflate:ese};const MI=16209;var nse=function(e,t){let r,o,c,u,f,g,E,v,S,R,I,D,V,M,j,W,Y,le,ye,Ee,me,Ae,Pe,$e;const at=e.state;r=e.next_in,Pe=e.input,o=r+(e.avail_in-5),c=e.next_out,$e=e.output,u=c-(t-e.avail_out),f=c+(e.avail_out-257),g=at.dmax,E=at.wsize,v=at.whave,S=at.wnext,R=at.window,I=at.hold,D=at.bits,V=at.lencode,M=at.distcode,j=(1<<at.lenbits)-1,W=(1<<at.distbits)-1;e:do{D<15&&(I+=Pe[r++]<<D,D+=8,I+=Pe[r++]<<D,D+=8),Y=V[I&j];t:for(;;){if(le=Y>>>24,I>>>=le,D-=le,le=Y>>>16&255,le===0)$e[c++]=65535&Y;else{if(!(16&le)){if((64&le)==0){Y=V[(65535&Y)+(I&(1<<le)-1)];continue t}if(32&le){at.mode=16191;break e}e.msg="invalid literal/length code",at.mode=MI;break e}ye=65535&Y,le&=15,le&&(D<le&&(I+=Pe[r++]<<D,D+=8),ye+=I&(1<<le)-1,I>>>=le,D-=le),D<15&&(I+=Pe[r++]<<D,D+=8,I+=Pe[r++]<<D,D+=8),Y=M[I&W];n:for(;;){if(le=Y>>>24,I>>>=le,D-=le,le=Y>>>16&255,!(16&le)){if((64&le)==0){Y=M[(65535&Y)+(I&(1<<le)-1)];continue n}e.msg="invalid distance code",at.mode=MI;break e}if(Ee=65535&Y,le&=15,D<le&&(I+=Pe[r++]<<D,D+=8,D<le&&(I+=Pe[r++]<<D,D+=8)),Ee+=I&(1<<le)-1,Ee>g){e.msg="invalid distance too far back",at.mode=MI;break e}if(I>>>=le,D-=le,le=c-u,Ee>le){if(le=Ee-le,le>v&&at.sane){e.msg="invalid distance too far back",at.mode=MI;break e}if(me=0,Ae=R,S===0){if(me+=E-le,le<ye){ye-=le;do $e[c++]=R[me++];while(--le);me=c-Ee,Ae=$e}}else if(S<le){if(me+=E+S-le,le-=S,le<ye){ye-=le;do $e[c++]=R[me++];while(--le);if(me=0,S<ye){le=S,ye-=le;do $e[c++]=R[me++];while(--le);me=c-Ee,Ae=$e}}}else if(me+=S-le,le<ye){ye-=le;do $e[c++]=R[me++];while(--le);me=c-Ee,Ae=$e}for(;ye>2;)$e[c++]=Ae[me++],$e[c++]=Ae[me++],$e[c++]=Ae[me++],ye-=3;ye&&($e[c++]=Ae[me++],ye>1&&($e[c++]=Ae[me++]))}else{me=c-Ee;do $e[c++]=$e[me++],$e[c++]=$e[me++],$e[c++]=$e[me++],ye-=3;while(ye>2);ye&&($e[c++]=$e[me++],ye>1&&($e[c++]=$e[me++]))}break}}break}}while(r<o&&c<f);ye=D>>3,r-=ye,D-=ye<<3,I&=(1<<D)-1,e.next_in=r,e.next_out=c,e.avail_in=r<o?o-r+5:5-(r-o),e.avail_out=c<f?f-c+257:257-(c-f),at.hold=I,at.bits=D};const jI=15,rse=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ise=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),sse=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ase=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var gw=(e,t,r,o,c,u,f,g)=>{const E=g.bits;let v,S,R,I,D,V,M=0,j=0,W=0,Y=0,le=0,ye=0,Ee=0,me=0,Ae=0,Pe=0,$e=null;const at=new Uint16Array(16),nn=new Uint16Array(16);let Xt,Lt,mr,tr=null;for(M=0;M<=jI;M++)at[M]=0;for(j=0;j<o;j++)at[t[r+j]]++;for(le=E,Y=jI;Y>=1&&at[Y]===0;Y--);if(le>Y&&(le=Y),Y===0)return c[u++]=20971520,c[u++]=20971520,g.bits=1,0;for(W=1;W<Y&&at[W]===0;W++);for(le<W&&(le=W),me=1,M=1;M<=jI;M++)if(me<<=1,me-=at[M],me<0)return-1;if(me>0&&(e===0||Y!==1))return-1;for(nn[1]=0,M=1;M<jI;M++)nn[M+1]=nn[M]+at[M];for(j=0;j<o;j++)t[r+j]!==0&&(f[nn[t[r+j]]++]=j);if(e===0?($e=tr=f,V=20):e===1?($e=rse,tr=ise,V=257):($e=sse,tr=ase,V=0),Pe=0,j=0,M=W,D=u,ye=le,Ee=0,R=-1,Ae=1<<le,I=Ae-1,e===1&&Ae>852||e===2&&Ae>592)return 1;for(;;){Xt=M-Ee,f[j]+1<V?(Lt=0,mr=f[j]):f[j]>=V?(Lt=tr[f[j]-V],mr=$e[f[j]-V]):(Lt=96,mr=0),v=1<<M-Ee,S=1<<ye,W=S;do S-=v,c[D+(Pe>>Ee)+S]=Xt<<24|Lt<<16|mr|0;while(S!==0);for(v=1<<M-1;Pe&v;)v>>=1;if(v!==0?(Pe&=v-1,Pe+=v):Pe=0,j++,--at[M]==0){if(M===Y)break;M=t[r+f[j]]}if(M>le&&(Pe&I)!==R){for(Ee===0&&(Ee=le),D+=W,ye=M-Ee,me=1<<ye;ye+Ee<Y&&(me-=at[ye+Ee],!(me<=0));)ye++,me<<=1;if(Ae+=1<<ye,e===1&&Ae>852||e===2&&Ae>592)return 1;R=Pe&I,c[R]=le<<24|ye<<16|D-u|0}}return Pe!==0&&(c[D+Pe]=M-Ee<<24|64<<16|0),g.bits=le,0};const{Z_FINISH:OG,Z_BLOCK:ose,Z_TREES:UI,Z_OK:e_,Z_STREAM_END:cse,Z_NEED_DICT:lse,Z_STREAM_ERROR:Il,Z_DATA_ERROR:DG,Z_MEM_ERROR:xG,Z_BUF_ERROR:dse,Z_DEFLATED:PG}=OI,VI=16180,FI=16190,Xh=16191,nL=16192,rL=16194,BI=16199,HI=16200,iL=16206,Qi=16209,kG=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function use(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const t_=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<VI||t.mode>16211?1:0},LG=e=>{if(t_(e))return Il;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=VI,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,e_},MG=e=>{if(t_(e))return Il;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,LG(e)},jG=(e,t)=>{let r;if(t_(e))return Il;const o=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Il:(o.window!==null&&o.wbits!==t&&(o.window=null),o.wrap=r,o.wbits=t,MG(e))},UG=(e,t)=>{if(!e)return Il;const r=new use;e.state=r,r.strm=e,r.window=null,r.mode=VI;const o=jG(e,t);return o!==e_&&(e.state=null),o};let sL,aL,VG=!0;const hse=e=>{if(VG){sL=new Int32Array(512),aL=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(gw(1,e.lens,0,288,sL,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;gw(2,e.lens,0,32,aL,0,e.work,{bits:5}),VG=!1}e.lencode=sL,e.lenbits=9,e.distcode=aL,e.distbits=5},FG=(e,t,r,o)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(t.subarray(r-u.wsize,r),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(t.subarray(r-o,r-o+c),u.wnext),(o-=c)?(u.window.set(t.subarray(r-o,r),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var pse=(e,t)=>{let r,o,c,u,f,g,E,v,S,R,I,D,V,M,j,W,Y,le,ye,Ee,me,Ae,Pe=0;const $e=new Uint8Array(4);let at,nn;const Xt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(t_(e)||!e.output||!e.input&&e.avail_in!==0)return Il;r=e.state,r.mode===Xh&&(r.mode=nL),f=e.next_out,c=e.output,E=e.avail_out,u=e.next_in,o=e.input,g=e.avail_in,v=r.hold,S=r.bits,R=g,I=E,Ae=e_;e:for(;;)switch(r.mode){case VI:if(r.wrap===0){r.mode=nL;break}for(;S<16;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(2&r.wrap&&v===35615){r.wbits===0&&(r.wbits=15),r.check=0,$e[0]=255&v,$e[1]=v>>>8&255,r.check=Ta(r.check,$e,2,0),v=0,S=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",r.mode=Qi;break}if((15&v)!==PG){e.msg="unknown compression method",r.mode=Qi;break}if(v>>>=4,S-=4,me=8+(15&v),r.wbits===0&&(r.wbits=me),me>15||me>r.wbits){e.msg="invalid window size",r.mode=Qi;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&v?16189:Xh,v=0,S=0;break;case 16181:for(;S<16;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(r.flags=v,(255&la(r))!==PG){e.msg="unknown compression method",r.mode=Qi;break}if(57344&la(r)){e.msg="unknown header flags set",r.mode=Qi;break}r.head&&(r.head.text=v>>8&1),512&la(r)&&4&r.wrap&&($e[0]=255&v,$e[1]=v>>>8&255,r.check=Ta(r.check,$e,2,0)),v=0,S=0,r.mode=16182;case 16182:for(;S<32;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}r.head&&(r.head.time=v),512&la(r)&&4&r.wrap&&($e[0]=255&v,$e[1]=v>>>8&255,$e[2]=v>>>16&255,$e[3]=v>>>24&255,r.check=Ta(r.check,$e,4,0)),v=0,S=0,r.mode=16183;case 16183:for(;S<16;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}r.head&&(r.head.xflags=255&v,r.head.os=v>>8),512&la(r)&&4&r.wrap&&($e[0]=255&v,$e[1]=v>>>8&255,r.check=Ta(r.check,$e,2,0)),v=0,S=0,r.mode=16184;case 16184:if(1024&la(r)){for(;S<16;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}r.length=v,r.head&&(r.head.extra_len=v),512&la(r)&&4&r.wrap&&($e[0]=255&v,$e[1]=v>>>8&255,r.check=Ta(r.check,$e,2,0)),v=0,S=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&la(r)&&(D=r.length,D>g&&(D=g),D&&(r.head&&(me=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(o.subarray(u,u+D),me)),512&la(r)&&4&r.wrap&&(r.check=Ta(r.check,o,D,u)),g-=D,u+=D,r.length-=D),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&la(r)){if(g===0)break e;D=0;do me=o[u+D++],r.head&&me&&r.length<65536&&(r.head.name+=String.fromCharCode(me));while(me&&D<g);if(512&la(r)&&4&r.wrap&&(r.check=Ta(r.check,o,D,u)),g-=D,u+=D,me)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&la(r)){if(g===0)break e;D=0;do me=o[u+D++],r.head&&me&&r.length<65536&&(r.head.comment+=String.fromCharCode(me));while(me&&D<g);if(512&la(r)&&4&r.wrap&&(r.check=Ta(r.check,o,D,u)),g-=D,u+=D,me)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&la(r)){for(;S<16;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(4&r.wrap&&v!==(65535&r.check)){e.msg="header crc mismatch",r.mode=Qi;break}v=0,S=0}r.head&&(r.head.hcrc=la(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Xh;break;case 16189:for(;S<32;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}e.adler=r.check=kG(v),v=0,S=0,r.mode=FI;case FI:if(r.havedict===0)return e.next_out=f,e.avail_out=E,e.next_in=u,e.avail_in=g,r.hold=v,r.bits=S,lse;e.adler=r.check=1,r.mode=Xh;case Xh:if(t===ose||t===UI)break e;case nL:if(r.last){v>>>=7&S,S-=7&S,r.mode=iL;break}for(;S<3;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}switch(r.last=1&v,v>>>=1,S-=1,3&v){case 0:r.mode=16193;break;case 1:if(hse(r),r.mode=BI,t===UI){v>>>=2,S-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=Qi}v>>>=2,S-=2;break;case 16193:for(v>>>=7&S,S-=7&S;S<32;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",r.mode=Qi;break}if(r.length=65535&v,v=0,S=0,r.mode=rL,t===UI)break e;case rL:r.mode=16195;case 16195:if(D=r.length,D){if(D>g&&(D=g),D>E&&(D=E),D===0)break e;c.set(o.subarray(u,u+D),f),g-=D,u+=D,E-=D,f+=D,r.length-=D;break}r.mode=Xh;break;case 16196:for(;S<14;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(r.nlen=257+(31&v),v>>>=5,S-=5,r.ndist=1+(31&v),v>>>=5,S-=5,r.ncode=4+(15&v),v>>>=4,S-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=Qi;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;S<3;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}r.lens[Xt[r.have++]]=7&v,v>>>=3,S-=3}for(;r.have<19;)r.lens[Xt[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,at={bits:r.lenbits},Ae=gw(0,r.lens,0,19,r.lencode,0,r.work,at),r.lenbits=at.bits,Ae){e.msg="invalid code lengths set",r.mode=Qi;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;Pe=r.lencode[v&(1<<r.lenbits)-1],j=Pe>>>24,W=Pe>>>16&255,Y=65535&Pe,!(j<=S);){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(Y<16)v>>>=j,S-=j,r.lens[r.have++]=Y;else{if(Y===16){for(nn=j+2;S<nn;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(v>>>=j,S-=j,r.have===0){e.msg="invalid bit length repeat",r.mode=Qi;break}me=r.lens[r.have-1],D=3+(3&v),v>>>=2,S-=2}else if(Y===17){for(nn=j+3;S<nn;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}v>>>=j,S-=j,me=0,D=3+(7&v),v>>>=3,S-=3}else{for(nn=j+7;S<nn;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}v>>>=j,S-=j,me=0,D=11+(127&v),v>>>=7,S-=7}if(r.have+D>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=Qi;break}for(;D--;)r.lens[r.have++]=me}}if(r.mode===Qi)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=Qi;break}if(r.lenbits=9,at={bits:r.lenbits},Ae=gw(1,r.lens,0,r.nlen,r.lencode,0,r.work,at),r.lenbits=at.bits,Ae){e.msg="invalid literal/lengths set",r.mode=Qi;break}if(r.distbits=6,r.distcode=r.distdyn,at={bits:r.distbits},Ae=gw(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,at),r.distbits=at.bits,Ae){e.msg="invalid distances set",r.mode=Qi;break}if(r.mode=BI,t===UI)break e;case BI:r.mode=HI;case HI:if(g>=6&&E>=258){e.next_out=f,e.avail_out=E,e.next_in=u,e.avail_in=g,r.hold=v,r.bits=S,nse(e,I),f=e.next_out,c=e.output,E=e.avail_out,u=e.next_in,o=e.input,g=e.avail_in,v=r.hold,S=r.bits,r.mode===Xh&&(r.back=-1);break}for(r.back=0;Pe=r.lencode[v&(1<<r.lenbits)-1],j=Pe>>>24,W=Pe>>>16&255,Y=65535&Pe,!(j<=S);){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(W&&(240&W)==0){for(le=j,ye=W,Ee=Y;Pe=r.lencode[Ee+((v&(1<<le+ye)-1)>>le)],j=Pe>>>24,W=Pe>>>16&255,Y=65535&Pe,!(le+j<=S);){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}v>>>=le,S-=le,r.back+=le}if(v>>>=j,S-=j,r.back+=j,r.length=Y,W===0){r.mode=16205;break}if(32&W){r.back=-1,r.mode=Xh;break}if(64&W){e.msg="invalid literal/length code",r.mode=Qi;break}r.extra=15&W,r.mode=16201;case 16201:if(r.extra){for(nn=r.extra;S<nn;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}r.length+=v&(1<<r.extra)-1,v>>>=r.extra,S-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;Pe=r.distcode[v&(1<<r.distbits)-1],j=Pe>>>24,W=Pe>>>16&255,Y=65535&Pe,!(j<=S);){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if((240&W)==0){for(le=j,ye=W,Ee=Y;Pe=r.distcode[Ee+((v&(1<<le+ye)-1)>>le)],j=Pe>>>24,W=Pe>>>16&255,Y=65535&Pe,!(le+j<=S);){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}v>>>=le,S-=le,r.back+=le}if(v>>>=j,S-=j,r.back+=j,64&W){e.msg="invalid distance code",r.mode=Qi;break}r.offset=Y,r.extra=15&W,r.mode=16203;case 16203:if(r.extra){for(nn=r.extra;S<nn;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}r.offset+=v&(1<<r.extra)-1,v>>>=r.extra,S-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=Qi;break}r.mode=16204;case 16204:if(E===0)break e;if(D=I-E,r.offset>D){if(D=r.offset-D,D>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=Qi;break}D>r.wnext?(D-=r.wnext,V=r.wsize-D):V=r.wnext-D,D>r.length&&(D=r.length),M=r.window}else M=c,V=f-r.offset,D=r.length;D>E&&(D=E),E-=D,r.length-=D;do c[f++]=M[V++];while(--D);r.length===0&&(r.mode=HI);break;case 16205:if(E===0)break e;c[f++]=r.length,E--,r.mode=HI;break;case iL:if(r.wrap){for(;S<32;){if(g===0)break e;g--,v|=o[u++]<<S,S+=8}if(I-=E,e.total_out+=I,r.total+=I,4&r.wrap&&I&&(e.adler=r.check=la(r)?Ta(r.check,c,I,f-I):cw(r.check,c,I,f-I)),I=E,4&r.wrap&&(la(r)?v:kG(v))!==r.check){e.msg="incorrect data check",r.mode=Qi;break}v=0,S=0}r.mode=16207;case 16207:if(r.wrap&&la(r)){for(;S<32;){if(g===0)break e;g--,v+=o[u++]<<S,S+=8}if(4&r.wrap&&v!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=Qi;break}v=0,S=0}r.mode=16208;case 16208:Ae=cse;break e;case Qi:Ae=DG;break e;case 16210:return xG;default:return Il}return e.next_out=f,e.avail_out=E,e.next_in=u,e.avail_in=g,r.hold=v,r.bits=S,(r.wsize||I!==e.avail_out&&r.mode<Qi&&(r.mode<iL||t!==OG))&&FG(e,e.output,e.next_out,I-e.avail_out),R-=e.avail_in,I-=e.avail_out,e.total_in+=R,e.total_out+=I,r.total+=I,4&r.wrap&&I&&(e.adler=r.check=la(r)?Ta(r.check,c,I,e.next_out-I):cw(r.check,c,I,e.next_out-I)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Xh?128:0)+(r.mode===BI||r.mode===rL?256:0),(R===0&&I===0||t===OG)&&Ae===e_&&(Ae=dse),Ae},Qh={inflateReset:MG,inflateReset2:jG,inflateResetKeep:LG,inflateInit:e=>UG(e,15),inflateInit2:UG,inflate:pse,inflateEnd:e=>{if(t_(e))return Il;let t=e.state;return t.window&&(t.window=null),e.state=null,e_},inflateGetHeader:(e,t)=>{if(t_(e))return Il;const r=e.state;return(2&r.wrap)==0?Il:(r.head=t,t.done=!1,e_)},inflateSetDictionary:(e,t)=>{const r=t.length;let o,c,u;return t_(e)?Il:(o=e.state,o.wrap!==0&&o.mode!==FI?Il:o.mode===FI&&(c=1,c=cw(c,t,r,0),c!==o.check)?DG:(u=FG(e,t,r,r),u?(o.mode=16210,xG):(o.havedict=1,e_)))},inflateInfo:"pako inflate (from Nodeca project)"},fse=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const BG=Object.prototype.toString,{Z_NO_FLUSH:mse,Z_FINISH:gse,Z_OK:_w,Z_STREAM_END:oL,Z_NEED_DICT:cL,Z_STREAM_ERROR:_se,Z_DATA_ERROR:HG,Z_MEM_ERROR:Ese}=OI;function GI(e){this.options=PI.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new IG,this.strm.avail_out=0;let r=Qh.inflateInit2(this.strm,t.windowBits);if(r!==_w)throw new Error(Qg[r]);if(this.header=new fse,Qh.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=mw.string2buf(t.dictionary):BG.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Qh.inflateSetDictionary(this.strm,t.dictionary),r!==_w)))throw new Error(Qg[r])}function yse(e,t){const r=new GI(t);if(r.push(e),r.err)throw r.msg||Qg[r.err];return r.result}GI.prototype.push=function(e,t){const r=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,f,g;if(this.ended)return!1;for(f=t===~~t?t:t===!0?gse:mse,BG.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(o),r.next_out=0,r.avail_out=o),u=Qh.inflate(r,f),u===cL&&c&&(u=Qh.inflateSetDictionary(r,c),u===_w?u=Qh.inflate(r,f):u===HG&&(u=cL));r.avail_in>0&&u===oL&&r.state.wrap>0&&e[r.next_in]!==0;)Qh.inflateReset(r),u=Qh.inflate(r,f);switch(u){case _se:case HG:case cL:case Ese:return this.onEnd(u),this.ended=!0,!1}if(g=r.avail_out,r.next_out&&(r.avail_out===0||u===oL))if(this.options.to==="string"){let E=mw.utf8border(r.output,r.next_out),v=r.next_out-E,S=mw.buf2string(r.output,E);r.next_out=v,r.avail_out=o-v,v&&r.output.set(r.output.subarray(E,E+v),0),this.onData(S)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(u!==_w||g!==0){if(u===oL)return u=Qh.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},GI.prototype.onData=function(e){this.chunks.push(e)},GI.prototype.onEnd=function(e){e===_w&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=PI.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var vse={inflate:yse};const{deflate:Sse}=tse,{inflate:Tse}=vse;var bse=Sse,wse=Tse,GG=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(GG||{});class Rse{constructor(){H(this,"_sequence",0),H(this,"_startTime",Date.now()),H(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const g=new Uint8Array(4);g.set([1,0,0,0]);const E={id:0,length:4,data:g.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[E]};r.commonPacketHeader.extension=1,r.extension=v,r.payload=this.compress(t),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;te("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));const o=new ArrayBuffer(r.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let f=0;if(u.setUint16(f,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),f+=2,u.setUint32(f,r.commonPacketHeader.sequence,!0),f+=4,u.setUint16(f,r.commonStreamHeader,!0),f+=2,r.extension){const g=this.serializeExtension(r.extension);c.set(new Uint8Array(g),f),f+=g.byteLength}if(c.set(new Uint8Array(r.payload),f),f+=r.payload.byteLength,f!==r.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const r=new DataView(t);let o=0;const c=r.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:r.getUint16(o+2,!0)<<16|r.getUint16(o,!0)};let f,g;if(o+=4,te("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(u))),r.getUint16(o,!0),o+=2,u.extension){g=this.deserializeExtension(t.slice(o)),o+=2+g.length,f=t.slice(o);let E=!1;if(g.datas.length>0){const v=g.datas.find(S=>S.id===0);v&&(E=(1&new DataView(v.data).getUint32(0,!0))==1)}f=E?this.decompress(f):f}else f=t.slice(8);return f}serializeExtension(t){const{profile:r,length:o,datas:c}=t,u=new ArrayBuffer(o+2),f=new Uint8Array(u),g=new DataView(u);let E=0;if(g.setUint8(E++,r),g.setUint8(E++,o),c.forEach(v=>{r?(g.setUint8(E++,v.id),g.setUint8(E++,v.length),f.set(new Uint8Array(v.data),E),E+=v.data.byteLength):(g.setUint8(E++,v.id|v.length<<4),f.set(new Uint8Array(v.data),E),E+=v.data.byteLength)}),E!==o+2)throw Error("serialize extension error, is ".concat(E,"!==").concat(o+2));return u}deserializeExtension(t){const r=new DataView(t);let o=0;const c=r.getUint8(o);o++;const u=r.getUint8(o);o++;const f=c===GG.TWO_BYTE,g=[],E=new DataView(t,2);let v=0;for(;v<u;){let S=0,R=0,I=new ArrayBuffer(0);f?(S=E.getUint8(v),v++,R=E.getUint8(v),v++):(S=15&E.getUint8(v),R=E.getUint8(v)>>4,v++),R>0&&(I=E.buffer.slice(v+2,v+2+R),v+=I.byteLength),g.push({id:S,length:R,data:I})}if(v!==u)throw Error("parse error");return{profile:c,length:u,datas:g}}decompress(t){return wse(new Uint8Array(t))}compress(t){return bse(new Uint8Array(t))}}const Cse={name:"DataStream",create:(e,t)=>{const r=t?new xne(e):new Pne(e);return r.useDataStream(new Rse),r}};class Ase extends xr{constructor(t,r,o){super(),H(this,"ws",void 0),H(this,"requestId",1),H(this,"heartBeatTimer",void 0),H(this,"joinInfo",void 0),H(this,"clientId",void 0),H(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),H(this,"onClose",c=>{this.emit("close"),this.dispose()}),H(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=t,this.clientId=r,this.ws=new Hb("cross-channel-".concat(this.clientId),o),this.ws.on(qt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(qt.CONNECTED,this.onOpen),this.ws.on(qt.ON_MESSAGE,this.onMessage),this.ws.on(qt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const r=this.requestId++;return t.requestId=r,t.seq=r,this.ws.sendMessage(t),r}waitStatus(t){return new tt((r,o)=>{const c=window.setTimeout(()=>{o(new Te(K.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Te(K.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Te(K.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new Te(K.WS_DISCONNECT);const r=()=>new tt((f,g)=>{this.ws.once(qt.CLOSED,()=>g(new Te(K.WS_ABORT))),this.ws.once(qt.CONNECTED,f)});this.ws.state!=="connected"&&await r();const o=this.sendMessage(t),c=new tt((f,g)=>{const E=()=>{g(new Te(K.WS_ABORT))};this.ws.once(qt.RECONNECTING,E),this.ws.once(qt.CLOSED,E),this.once("req_".concat(o),f),cs(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(qt.RECONNECTING,E),this.ws.off(qt.CLOSED,E),g(new Te(K.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Te(K.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(t){this.ws.removeAllListeners(qt.REQUEST_NEW_URLS),this.ws.on(qt.REQUEST_NEW_URLS,r=>{r(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const r=this.requestId++;return t.requestId=r,this.ws.sendMessage(t),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Ise extends xr{set state(t){t!==this._state&&(t!==ro.RELAY_STATE_FAILURE&&(this.errorCode=ev.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,r,o,c,u){super(),H(this,"joinInfo",void 0),H(this,"sid",void 0),H(this,"clientId",void 0),H(this,"cancelToken",ka.CancelToken.source()),H(this,"workerToken",void 0),H(this,"requestId",0),H(this,"signal",void 0),H(this,"prevChannelMediaConfig",void 0),H(this,"httpRetryConfig",void 0),H(this,"_resolution",void 0),H(this,"_state",ro.RELAY_STATE_IDLE),H(this,"errorCode",ev.RELAY_OK),H(this,"onStatus",f=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(f))),f&&f.command&&(f.command==="onAudioPacketReceived"&&this.emit("event",Wh.PACKET_RECEIVED_AUDIO_FROM_SRC),f.command==="onVideoPacketReceived"&&this.emit("event",Wh.PACKET_RECEIVED_VIDEO_FROM_SRC),f.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=ev.SRC_TOKEN_EXPIRED,this.state=ro.RELAY_STATE_FAILURE),f.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=ev.DEST_TOKEN_EXPIRED,this.state=ro.RELAY_STATE_FAILURE))}),H(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Wh.NETWORK_DISCONNECTED),this.state=ro.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(f=>{this.state!==ro.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",f.toString()),this.errorCode=ev.SERVER_CONNECTION_LOST,this.state=ro.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=r,this.sid=Mg(),this.signal=new Ase(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(t){if(this.state!==ro.RELAY_STATE_IDLE)throw new Te(K.INVALID_OPERATION);this.state=ro.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(r){throw r.data&&r.data.serverResponse&&r.data.serverResponse.command==="SetSourceChannel"?new Te(K.CROSS_CHANNEL_FAILED_JOIN_SRC):r.data&&r.data.serverResponse&&r.serverResponse.command==="SetDestChannelStatus"?new Te(K.CROSS_CHANNEL_FAILED_JOIN_DEST):r.data&&r.data.serverResponse&&r.serverResponse.command==="StartPacketTransfer"?new Te(K.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==ro.RELAY_STATE_RUNNING)throw new Te(K.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==ro.RELAY_STATE_RUNNING)throw new Te(K.INVALID_OPERATION);const r=this.genMessage(Sa.SetVideoProfile);await this.signal.request(r),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ro.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=ka.CancelToken.source(),this.state=ro.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await Ure(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Wh.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const r=this.genMessage(Sa.StopPacketTransfer);await this.signal.request(r),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(Sa.SetSdkProfile,t);await this.signal.request(o),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(Sa.SetSourceChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Wh.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(Sa.SetSourceUserId,t);await this.signal.request(u),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const f=this.genMessage(Sa.SetDestChannel,t);await this.signal.request(f),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Wh.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const g=this.genMessage(Sa.StartPacketTransfer,t);await this.signal.request(g),this.emit("event",Wh.PACKET_SENT_TO_DEST_CHANNEL),this.state=ro.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const r=this.genMessage(Sa.UpdateDestChannel,t);await this.signal.request(r),this.emit("event",Wh.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Sa.StopPacketTransfer);await this.signal.request(t),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,r){const o=[],c=[],u=[];this.requestId+=1;const f={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ic,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};f.sdkVersion==="4.23.3"&&(f.sdkVersion="0.0.1");let g=null,E=null;switch(t){case Sa.SetSdkProfile:return f.clientRequest={command:"SetSdkProfile",type:"multi_channel"},f;case Sa.SetSourceChannel:if(E=r&&r.getSrcChannelMediaInfo(),!E)throw new Te(K.UNEXPECTED_ERROR,"can not find source config");return f.clientRequest={command:"SetSourceChannel",uid:"0",channelName:E.channelName,token:E.token||this.joinInfo.appId},f;case Sa.SetSourceUserId:if(E=r&&r.getSrcChannelMediaInfo(),!E)throw new Te(K.UNEXPECTED_ERROR,"can not find source config");return f.clientRequest={command:"SetSourceUserId",uid:E.uid+""},f;case Sa.SetDestChannel:if(g=r&&r.getDestChannelMediaInfo(),!g)throw new Te(K.UNEXPECTED_ERROR,"can not find dest config");return g.forEach(v=>{o.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),f.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},f;case Sa.StartPacketTransfer:return f.clientRequest={command:"StartPacketTransfer"},f;case Sa.Reconnect:return f.clientRequest={command:"Reconnect"},f;case Sa.StopPacketTransfer:return f.clientRequest={command:"StopPacketTransfer"},f;case Sa.UpdateDestChannel:if(g=r&&r.getDestChannelMediaInfo(),!g)throw new Te(K.UNEXPECTED_ERROR,"can not find dest config");return g.forEach(v=>{o.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),f.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},f;case Sa.SetVideoProfile:f.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return f}}const Nse={name:"ChannelMediaRelay",create:function(e){return new Ise(e.joinInfo,e.clientId,e.websocketRetryConfig||Ri,e.httpRetryConfig||Ri,e.resolution)}};function WG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Ew(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?WG(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):WG(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class Ose extends xr{constructor(t,r,o,c){super(),H(this,"spec",void 0),H(this,"token",void 0),H(this,"websocket",void 0),H(this,"pingpongTimer",void 0),H(this,"reconnectMode","retry"),H(this,"serviceMode",void 0),H(this,"reqId",0),H(this,"commandReqId",0),H(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),H(this,"handleWebSocketMessage",u=>{if(!u.data)return;const f=JSON.parse(u.data);f.requestId?this.emit("@".concat(f.requestId,"-").concat(f.sid),f):(St.workerEvent(this.spec.sid,{actionType:"status",serverCode:f.code,workerType:this.serviceMode===Gh.TRANSCODE?1:2}),this.emit(bf.PUBLISH_STREAM_STATUS,f))}),this.spec=r,this.token=t,this.serviceMode=c,this.websocket=new Hb("live-streaming",o),this.websocket.on(qt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(qt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(qt.REQUEST_NEW_URLS,(u,f)=>{ys(this,bf.REQUEST_NEW_ADDRESS).then(u).catch(f)}),this.websocket.on(qt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,r,o,c){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const u=this.commandReqId,f=this.reqId;if(!f||!this.websocket)throw new Te(K.UNEXPECTED_ERROR);const g=Ew({command:t,sdkVersion:Ic==="4.23.3"?"0.0.1":Ic,seq:f,requestId:f,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if(this.websocket.state==="closed")throw new Te(K.WS_DISCONNECT);const E=()=>new tt((I,D)=>{this.websocket.once(qt.CLOSED,()=>D(new Te(K.WS_ABORT))),this.websocket.once(qt.CONNECTED,I)});this.websocket.state!=="connected"&&await E(),g.clientRequest&&(g.clientRequest.workerToken=this.token);const v=new tt((I,D)=>{const V=()=>{D(new Te(K.WS_ABORT))};this.websocket.once(qt.RECONNECTING,V),this.websocket.once(qt.CLOSED,V),this.once("@".concat(f,"-").concat(this.spec.sid),M=>{I(M)})});c&&St.workerEvent(this.spec.sid,Ew(Ew({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(g);let R=null;try{R=await v}catch(I){if(this.websocket.state==="closed")throw I;return await E(),await this.request(t,r,o)}return c&&St.workerEvent(this.spec.sid,Ew(Ew({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-S})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Ic==="4.23.3"?"0.0.1":Ic;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Oi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case Oi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Oi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Oi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Te(K.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Oi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new Te(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Oi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Te(K.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Oi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new Te(K.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(bf.WARNING,r,t.serverResponse.url)}case Oi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new Te(K.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(bf.WARNING,r,t.serverResponse.url)}case Oi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Te(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Oi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Te(K.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Oi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new Te(K.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(bf.WARNING,r,t.serverResponse.url)}case Oi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Te(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Oi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Te(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Oi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Oi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new Te(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Oi.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new Te(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new Te(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Oi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Oi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Oi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Oi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Te(K.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(xA)},6e3)}}function zG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function io(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zG(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zG(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class Dse extends xr{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ri,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ri;super(),H(this,"onLiveStreamWarning",void 0),H(this,"onLiveStreamError",void 0),H(this,"spec",void 0),H(this,"retryTimeout",1e4),H(this,"connection",void 0),H(this,"httpRetryConfig",void 0),H(this,"wsRetryConfig",void 0),H(this,"streamingTasks",new Map),H(this,"isStartingStreamingTask",!1),H(this,"taskMutex",new Ls("live-streaming")),H(this,"cancelToken",ka.CancelToken.source()),H(this,"transcodingConfig",void 0),H(this,"uapResponse",void 0),H(this,"lastTaskId",1),H(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=o,this.wsRetryConfig=r}async setTranscodingConfig(t){const r=io(io({},_re),t);r.videoCodecProfile!==66&&r.videoCodecProfile!==77&&r.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(r.videoCodecProfile," -> 100")),r.videoCodecProfile=100),r.transcodingUsers||(r.transcodingUsers=r.userConfigs),r.transcodingUsers&&(r.transcodingUsers=r.transcodingUsers.map(f=>io(io(io({},gre),f),{},{zOrder:f.zOrder?f.zOrder+1:1}))),function(f){Hr(f.width)||Zn(f.width,"config.width",0,1e4),Hr(f.height)||Zn(f.height,"config.height",0,1e4),Hr(f.videoBitrate)||Zn(f.videoBitrate,"config.videoBitrate",1,1e6),Hr(f.videoFrameRate)||Zn(f.videoFrameRate,"config.videoFrameRate"),Hr(f.lowLatency)||Fh(f.lowLatency,"config.lowLatency"),Hr(f.audioSampleRate)||Mi(f.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Hr(f.audioBitrate)||Zn(f.audioBitrate,"config.audioBitrate",1,128),Hr(f.audioChannels)||Mi(f.audioChannels,"config.audioChannels",[1,2,3,4,5]),Hr(f.videoGop)||Zn(f.videoGop,"config.videoGop"),Hr(f.videoCodecProfile)||Mi(f.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Hr(f.userCount)||Zn(f.userCount,"config.userCount",0,17),Hr(f.backgroundColor)||Zn(f.backgroundColor,"config.backgroundColor",0,16777215),Hr(f.userConfigExtraInfo)||os(f.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),f.transcodingUsers&&!Hr(f.transcodingUsers)&&(Bh(f.transcodingUsers,"config.transcodingUsers"),f.transcodingUsers.forEach((g,E)=>{tI(g.uid),Hr(g.x)||Zn(g.x,"transcodingUser[".concat(E,"].x"),0,1e4),Hr(g.y)||Zn(g.y,"transcodingUser[".concat(E,"].y"),0,1e4),Hr(g.width)||Zn(g.width,"transcodingUser[".concat(E,"].width"),0,1e4),Hr(g.height)||Zn(g.height,"transcodingUser[".concat(E,"].height"),0,1e4),Hr(g.zOrder)||Zn(g.zOrder-1,"transcodingUser[".concat(E,"].zOrder"),0,100),Hr(g.alpha)||Zn(g.alpha,"transcodingUser[".concat(E,"].alpha"),0,1,!1)})),Hr(f.watermark)||l1(f.watermark,"watermark"),Hr(f.backgroundImage)||l1(f.backgroundImage,"backgroundImage"),f.images&&!Hr(f.images)&&(Bh(f.images,"config.images"),f.images.forEach((g,E)=>{l1(g,"images[".concat(E,"]"))}))}(r);const o=[];r.images&&o.push(...r.images.map(f=>io(io(io({},c1),f),{},{zOrder:255}))),r.backgroundImage&&(o.push(io(io(io({},c1),r.backgroundImage),{},{zOrder:0})),delete r.backgroundImage),r.watermark&&(o.push(io(io(io({},c1),r.watermark),{},{zOrder:255})),delete r.watermark),r.images=o,r.transcodingUsers&&(r.userConfigs=r.transcodingUsers.map(f=>io({},f)),r.userCount=r.transcodingUsers.length,delete r.transcodingUsers);const c=(r.userConfigs||[]).map(f=>typeof f.uid=="number"?tt.resolve(f.uid):m6(f.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await tt.all(c)).forEach((f,g)=>{r.userConfigs&&r.userConfigs[g]&&(r.userConfigs[g].uid=f)}),this.transcodingConfig=r,this.connection)try{var u;const f=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Pa(u=this.streamingTasks).call(u)).map(g=>g.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(f.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(f){if(!f.data||!f.data.retry)throw f;f.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(g=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),f.toString(),"try to republish",g.url),this.startLiveStreamingTask(g.url,g.mode,f).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(g.url," success"))}).catch(E=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),g.url,E.toString()),this.onLiveStreamError&&this.onLiveStreamError(g.url,E)})})}}async startLiveStreamingTask(t,r,o){if(!this.transcodingConfig&&r===Gh.TRANSCODE)throw new Te(K.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(r));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(t)&&!o)return u(),new Te(K.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r))}catch(g){throw u(),g}switch(r){case Gh.TRANSCODE:c.transcodingConfig=io({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const f=this.lastTaskId++;try{const g=new tt((v,S)=>{cs(this.retryTimeout).then(()=>{if(o)return S(o);const R=this.statusError.get(t);return R?(this.statusError.delete(t),S(R)):void 0})}),E=await tt.race([this.connection.request("request",{clientRequest:c},!0,{url:t,command:"PublishStream",workerType:r===Gh.TRANSCODE?1:2,requestByUser:!o,tid:f.toString()}),g]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(E.code)),this.streamingTasks.set(t,{clientRequest:c,mode:r,url:t,taskId:f}),u()}catch(g){if(u(),this.isStartingStreamingTask=!1,!g.data||!g.data.retry||o)throw g;return g.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,r,g)):await this.startLiveStreamingTask(t,r,g)}}stopLiveStreamingTask(t){return new tt((r,o)=>{const c=this.streamingTasks.get(t);if(!c||!this.connection)return new Te(K.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),r()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:t,command:"UnPublishStream",workerType:u===Gh.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(f=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(f.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),r()}).catch(o)})}resetAllTask(){var t;const r=Array.from(Pa(t=this.streamingTasks).call(t));this.terminate();for(const o of r)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=ka.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new Te(K.UNEXPECTED_ERROR,"live streaming connection has already connected");const r=await ys(this,d1.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=r,this.connection=new Ose(r.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(bf.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(bf.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(bf.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Te(K.UNEXPECTED_ERROR,"can not get new live streaming address list"));ys(this,d1.REQUEST_WORKER_MANAGER_LIST,t).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(r.addressList),this.connection}handlePublishStreamServer(t){const r=t.serverStatus&&t.serverStatus.url||"empty_url",o=this.streamingTasks.get(r),c=t.reason;switch(t.code){case Oi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Oi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Oi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Oi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const f=new Te(K.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(o)return x.error(f.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,f);if(!this.isStartingStreamingTask)return;this.statusError.set(r,f)}case Oi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const f=new Te(K.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,f)}case Oi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Oi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const f=Array.from(Pa(u=this.streamingTasks).call(u));for(const g of f)g.abortTask?g.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",g.url),this.startLiveStreamingTask(g.url,g.mode,new Te(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),g.url)}).catch(E=>{x.error(E.toString()),this.onLiveStreamError&&this.onLiveStreamError(g.url,E)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const xse={name:"LiveStreaming",create:function(e){return new Dse(e.joinInfo,e.websocketRetryConfig||Ri,e.httpRetryConfig||Ri)}};function Pse(e){let t=KG();return function(r,o){let c=r.appId;c!==void 0&&(Wn(o,10),Cu(o,c));let u=r.cid;u!==void 0&&(Wn(o,16),Wn(o,u));let f=r.cname;f!==void 0&&(Wn(o,26),Cu(o,f));let g=r.deviceId;g!==void 0&&(Wn(o,34),Cu(o,g));let E=r.elapse;E!==void 0&&(Wn(o,40),jf(o,E));let v=r.fileSize;v!==void 0&&(Wn(o,48),jf(o,_v(v)));let S=r.height;S!==void 0&&(Wn(o,56),jf(o,_v(S)));let R=r.jpg;R!==void 0&&(Wn(o,66),Wn(o,R.length),function(Va,ke){let Ye=Ev(Va,ke.length);Va.bytes.set(ke,Ye)}(o,R));let I=r.networkType;I!==void 0&&(Wn(o,72),jf(o,_v(I)));let D=r.osType;D!==void 0&&(Wn(o,80),jf(o,_v(D)));let V=r.requestId;V!==void 0&&(Wn(o,90),Cu(o,V));let M=r.sdkVersion;M!==void 0&&(Wn(o,98),Cu(o,M));let j=r.sequence;j!==void 0&&(Wn(o,104),jf(o,_v(j)));let W=r.sid;W!==void 0&&(Wn(o,114),Cu(o,W));let Y=r.timestamp;Y!==void 0&&(Wn(o,120),jf(o,Y));let le=r.uid;le!==void 0&&(Wn(o,128),Wn(o,le));let ye=r.vid;ye!==void 0&&(Wn(o,136),Wn(o,ye));let Ee=r.width;Ee!==void 0&&(Wn(o,144),jf(o,_v(Ee)));let me=r.service;me!==void 0&&(Wn(o,152),Wn(o,me));let Ae=r.callbackData;Ae!==void 0&&(Wn(o,162),Cu(o,Ae));let Pe=r.jpgEncryption;Pe!==void 0&&(Wn(o,168),Wn(o,Pe));let $e=r.requestType;$e!==void 0&&(Wn(o,176),Wn(o,$e));let at=r.scorePorn;at!==void 0&&(Wn(o,185),pL(o,at));let nn=r.scoreSexy;nn!==void 0&&(Wn(o,193),pL(o,nn));let Xt=r.scoreNeutral;Xt!==void 0&&(Wn(o,201),pL(o,Xt));let Lt=r.scene;Lt!==void 0&&(Wn(o,208),Wn(o,Lt));let mr=r.ossFilePrefix;mr!==void 0&&(Wn(o,218),Cu(o,mr));let tr=r.serviceVendor;if(tr!==void 0)for(let Va of tr){Wn(o,226);let ke=KG();Mse(Va,ke),Wn(o,ke.limit),Fse(o,ke),Vse(ke)}}(e,t),function(r){let o=r.bytes,c=r.limit;return o.length===c?o:o.subarray(0,c)}(t)}function kse(e){return function(r){let o={};e:for(;!XG(r);){let c=Au(r);switch(c>>>3){case 0:break e;case 1:o.code=Au(r);break;case 2:o.msg=QG(r,Au(r));break;case 3:{let u=jse(r);o.data=Lse(r),r.limit=u;break}default:YG(r,7&c)}}return o}({bytes:t=e,offset:0,limit:t.length});var t}function Lse(e){let t={};e:for(;!XG(e);){let r=Au(e);switch(r>>>3){case 0:break e;case 1:t.requestId=QG(e,Au(e));break;case 2:t.requestType=Au(e)>>>0;break;case 3:t.scorePorn=hL(e);break;case 4:t.scoreSexy=hL(e);break;case 5:t.scoreNeutral=hL(e);break;case 6:t.requestScene=Au(e)>>>0;break;case 7:t.scene=Au(e)>>>0;break;default:YG(e,7&r)}}return t}function Mse(e,t){let r=e.service;r!==void 0&&(Wn(t,8),Wn(t,r));let o=e.vendor;o!==void 0&&(Wn(t,16),Wn(t,o));let c=e.token;c!==void 0&&(Wn(t,26),Cu(t,c));let u=e.callbackUrl;u!==void 0&&(Wn(t,34),Cu(t,u))}function jse(e){let t=Au(e),r=e.limit;return e.limit=e.offset+t,r}function YG(e,t){switch(t){case 0:for(;128&$G(e););break;case 2:dL(e,Au(e));break;case 5:dL(e,4);break;case 1:dL(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Use=new Float32Array(1);new Uint8Array(Use.buffer);let lL=new Float64Array(1),so=new Uint8Array(lL.buffer);function _v(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let qG=[];function KG(){const e=qG.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Vse(e){qG.push(e)}function dL(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function XG(e){return e.offset>=e.limit}function Ev(e,t){let r=e.bytes,o=e.offset,c=e.limit,u=o+t;if(u>r.length){let f=new Uint8Array(2*u);f.set(r),e.bytes=f}return e.offset=u,u>c&&(e.limit=u),o}function uL(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function QG(e,t){let r=uL(e,t),o=String.fromCharCode,c=e.bytes,u="",f="";for(let g=0;g<t;g++){let E,v,S,R,I=c[g+r];(128&I)==0?f+=o(I):(224&I)==192?g+1>=t?f+=u:(E=c[g+r+1],(192&E)!=128?f+=u:(R=(31&I)<<6|63&E,R<128?f+=u:(f+=o(R),g++))):(240&I)==224?g+2>=t?f+=u:(E=c[g+r+1],v=c[g+r+2],(49344&(E|v<<8))!=32896?f+=u:(R=(15&I)<<12|(63&E)<<6|63&v,R<2048||R>=55296&&R<=57343?f+=u:(f+=o(R),g+=2))):(248&I)==240?g+3>=t?f+=u:(E=c[g+r+1],v=c[g+r+2],S=c[g+r+3],(12632256&(E|v<<8|S<<16))!=8421504?f+=u:(R=(7&I)<<18|(63&E)<<12|(63&v)<<6|63&S,R<65536||R>1114111?f+=u:(R-=65536,f+=o(55296+(R>>10),56320+(1023&R)),g+=3))):f+=u}return f}function Cu(e,t){let r=t.length,o=0;for(let f=0;f<r;f++){let g=t.charCodeAt(f);g>=55296&&g<=56319&&f+1<r&&(g=(g<<10)+t.charCodeAt(++f)-56613888),o+=g<128?1:g<2048?2:g<65536?3:4}Wn(e,o);let c=Ev(e,o),u=e.bytes;for(let f=0;f<r;f++){let g=t.charCodeAt(f);g>=55296&&g<=56319&&f+1<r&&(g=(g<<10)+t.charCodeAt(++f)-56613888),g<128?u[c++]=g:(g<2048?u[c++]=g>>6&31|192:(g<65536?u[c++]=g>>12&15|224:(u[c++]=g>>18&7|240,u[c++]=g>>12&63|128),u[c++]=g>>6&63|128),u[c++]=63&g|128)}}function Fse(e,t){let r=Ev(e,t.limit),o=e.bytes,c=t.bytes;for(let u=0,f=t.limit;u<f;u++)o[u+r]=c[u]}function $G(e){return e.bytes[uL(e,1)]}function JG(e,t){let r=Ev(e,1);e.bytes[r]=t}function hL(e){let t=uL(e,8),r=e.bytes;return so[0]=r[t++],so[1]=r[t++],so[2]=r[t++],so[3]=r[t++],so[4]=r[t++],so[5]=r[t++],so[6]=r[t++],so[7]=r[t++],lL[0]}function pL(e,t){let r=Ev(e,8),o=e.bytes;lL[0]=t,o[r++]=so[0],o[r++]=so[1],o[r++]=so[2],o[r++]=so[3],o[r++]=so[4],o[r++]=so[5],o[r++]=so[6],o[r++]=so[7]}function Au(e){let t,r=0,o=0;do t=$G(e),r<32&&(o|=(127&t)<<r),r+=7;while(128&t);return o}function Wn(e,t){for(t>>>=0;t>=128;)JG(e,127&t|128),t>>>=7;JG(e,t)}function jf(e,t){let r=t.low>>>0,o=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,u=c===0?o===0?r<16384?r<128?1:2:r<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,f=Ev(e,u),g=e.bytes;switch(u){case 10:g[f+9]=c>>>7&1;case 9:g[f+8]=u!==9?128|c:127&c;case 8:g[f+7]=u!==8?o>>>21|128:o>>>21&127;case 7:g[f+6]=u!==7?o>>>14|128:o>>>14&127;case 6:g[f+5]=u!==6?o>>>7|128:o>>>7&127;case 5:g[f+4]=u!==5?128|o:127&o;case 4:g[f+3]=u!==4?r>>>21|128:r>>>21&127;case 3:g[f+2]=u!==3?r>>>14|128:r>>>14&127;case 2:g[f+1]=u!==2?r>>>7|128:r>>>7&127;case 1:g[f]=u!==1?128|r:127&r}}function ZG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}const Bse=new Map([["moderation",1],["supervise",2]]);class Hse extends xr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const r=this._connectionState;this._connectionState=t,this.emit(Xi.CONNECTION_STATE_CHANGE,r,t)}get inspectType(){return this._inspectType}set inspectType(t){var r;this._inspectMode=Qa(r=t.map(o=>Bse.get(o)||0)).call(r,(o,c)=>o+c),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),H(this,"name","AgoraRTCVideoContentInspect"),H(this,"_connectionState",Sl.CONNECTING),H(this,"_innerConnectionState",void 0),H(this,"sequence",0),H(this,"inspectStartTime",void 0),H(this,"workerManagerConnection",void 0),H(this,"workerConnection",void 0),H(this,"workerMessageLengthLimit",void 0),H(this,"inspectIntervalMinimum",void 0),H(this,"qualityRatio",void 0),H(this,"_connectInfo",void 0),H(this,"_cancelTokenSource",ka.CancelToken.source()),H(this,"_retryConfig",void 0),H(this,"wmSequence",0),H(this,"inspectInterval",void 0),H(this,"inspectTimer",null),H(this,"ossFilePrefix",void 0),H(this,"extraInfo",void 0),H(this,"_inspectType",void 0),H(this,"_inspectMode",void 0),H(this,"_quality",1),H(this,"qualityTimer",null),H(this,"_inspectId",void 0),H(this,"_needWorkUrlOnly",!1),H(this,"inspectImage",()=>{if(this.connectionState!==Sl.CONNECTED)throw new Te(K.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Sl.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=dr(5,"inspect-"),this.workerMessageLengthLimit=te("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=te("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=te("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Hb("worker-manager-"+this._inspectId,Ri),this.on(Xi.STATE_CHANGE,(r,o)=>{this._innerConnectionState=r,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Tl[r]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Hb("worker-"+this._inspectId,Ri),this.handleWorkerEvents()}async init(t,r){this.emit(Xi.STATE_CHANGE,Tl.CONNECT_AP),this._connectInfo=t;const o=this._cancelTokenSource.token;return this._retryConfig=r,new tt((c,u)=>{this.on(Xi.CONNECTION_STATE_CHANGE,(f,g)=>{g===Sl.CONNECTED&&c()}),this.requestAP(t,o,r).then(f=>{this.connectWorkerManager(f)}).catch(f=>{u(f)})})}async requestAP(t,r,o){const c=te("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),u=await function(g,E,v,S){let{appId:R,areaCode:I,cname:D,sid:V,token:M,uid:j}=E;ov++;const W="image_moderation_api",Y={service_name:W,json_body:JSON.stringify({appId:R,areaCode:I,cname:D,command:"allocateEdge",requestId:ov,seq:ov,sid:V,token:M,ts:Date.now(),uid:j+""})};let le,ye,Ee=g[0];return dd(async()=>{le=Date.now();const me=await md(Ee,{data:Y,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-le,me.code!==0){const at=new Te(K.UNEXPECTED_RESPONSE,"image inspect ap error, code"+me.code,{retry:!0,responseTime:ye});throw x.error(at.toString()),at}const Ae=JSON.parse(me.json_body);if(Ae.code!==200){const at=new Te(K.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ae.code,", reason: ").concat(Ae.reason),{code:Ae.code,responseTime:ye});throw x.error(at.toString()),at}if(!Ae.servers||!Array.isArray(Ae.servers)||Ae.servers.length===0){const at=new Te(K.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ae.code,responseTime:ye});throw x.error(at.toString()),at}const Pe=te("VIDEO_INSPECT_WORKER_MANAGER_HOST"),$e=te("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ae.servers.map(at=>{let{address:nn,wss:Xt}=at;if(nn&&Xt)return"wss://".concat(nn.replace(/\./g,"-"),".").concat(Pe,":").concat($e||Xt)}).filter(at=>!!at),workerToken:Ae.workerToken,vid:Ae.vid,responseTime:ye}},(me,Ae)=>(St.apworkerEvent(V,{success:!0,sc:200,serviceName:W,responseDetail:JSON.stringify(me.addressList),firstSuccess:Ae===0,responseTime:ye,serverIp:g[Ae%g.length]}),!1),(me,Ae)=>(St.apworkerEvent(V,{success:!1,sc:me.data&&me.data.code||200,serviceName:W,responseTime:ye,serverIp:g[Ae%g.length]}),!!(me.code!==K.OPERATION_ABORTED&&me.code!==K.UNEXPECTED_RESPONSE||me.data&&me.data.retry)&&(Ee=g[(Ae+1)%g.length],!0)),S)}(c,t,r,o);this.emit(Xi.STATE_CHANGE,Tl.AP_CONNECTED);const{addressList:f}=u;return this.wmSequence++,f}async connectWorkerManager(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(Xi.STATE_CHANGE,Tl.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(qt.CONNECTED,async()=>{this.emit(Xi.STATE_CHANGE,Tl.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.3",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(qt.CLOSED,()=>{this._innerConnectionState<Tl.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(qt.FAILED,()=>{this._innerConnectionState<Tl.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(qt.RECONNECTING,()=>{this._innerConnectionState<Tl.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(qt.ON_MESSAGE,async t=>{this.emit(Xi.STATE_CHANGE,Tl.GET_WORKER_MANAGER_RESPONSE);const r=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(t.data);if(o.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Te(K.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&r))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Te(K.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=te("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=r.replace(/:\d+\/?$/,":".concat(c));this.emit(Xi.STATE_CHANGE,Tl.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(Xi.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(qt.WILL_RECONNECT,(t,r,o)=>{o(t)}),this.workerManagerConnection.on(qt.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}handleWorkerEvents(){this.workerConnection.on(qt.CONNECTED,async()=>{this.emit(Xi.STATE_CHANGE,Tl.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Sl.CONNECTED}),this.workerConnection.on(qt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const o=kse(new Uint8Array(t.data));if(te("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Xi.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var r;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=Qa(r=Object.keys(c)).call(r,(g,E)=>c[g]>c[E]?g:E,"porn"),f=Object.keys(c).find(g=>g===u);this.emit(Xi.INSPECT_RESULT,f)}else this.emit(Xi.INSPECT_RESULT,void 0,new Te(K.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(Xi.INSPECT_RESULT,void 0,new Te(K.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Xi.INSPECT_RESULT,void 0,new Te(K.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(qt.CLOSED,()=>{this.connectionState=Sl.CLOSED}),this.workerConnection.on(qt.FAILED,()=>{this.connectionState=Sl.CLOSED}),this.workerConnection.on(qt.RECONNECTING,()=>{this.connectionState=this.connectionState===Sl.CONNECTED?Sl.RECONNECTING:Sl.CONNECTING}),this.workerConnection.on(qt.WILL_RECONNECT,(t,r,o)=>{t==="recover"&&o(t),o("tryNext")}),this.workerConnection.on(qt.REQUEST_NEW_URLS,(t,r)=>{this.workerManagerConnection.close(),this.once(Xi.REQUEST_NEW_WORKER_URL,o=>{t([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{r(o)})})}async requestToInspectImage(){this.sequence++;const t=Jo(this,Xi.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Xi.INSPECT_RESULT,void 0,new Te(K.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(t,r);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(Xi.INSPECT_RESULT,void 0,new Te(K.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,r){let{appId:o,cname:c,cid:u,vid:f,sid:g,uid:E}=r;const v=Date.now(),S=await t.getCurrentFrameImage("image/jpeg",this.quality),R=await L4(S,o,c),I=this.sequence+"-"+u+"-"+E+"-"+v+"-"+dr(12,""),D={appId:o,cid:u,cname:c,deviceId:"",elapse:(V=Number(v-this.inspectStartTime),{low:V|=0,high:V>>31,unsigned:V>=0}),fileSize:R.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:I,sdkVersion:"4.23.3",sequence:this.sequence,sid:g,timestamp:oH(v),uid:E,vid:f,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var V;this.extraInfo===void 0&&delete D.callbackData,this.ossFilePrefix===void 0&&delete D.ossFilePrefix;const M=Pse(D);if(M.byteLength<this.workerMessageLengthLimit){if(te("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const j=function(W){for(var Y=1;Y<arguments.length;Y++){var le=arguments[Y]!=null?arguments[Y]:{};Y%2?ZG(Object(le),!0).forEach(function(ye){H(W,ye,le[ye])}):Object.getOwnPropertyDescriptors?Object.defineProperties(W,Object.getOwnPropertyDescriptors(le)):ZG(Object(le)).forEach(function(ye){Object.defineProperty(W,ye,Object.getOwnPropertyDescriptor(le,ye))})}return W}({},D);delete j.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return M}{const j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(t,{appId:o,cname:c,cid:u,vid:f,sid:g,uid:E})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ka.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Sl.CLOSED,this.emit(Xi.STATE_CHANGE,Tl.CLOSED)}}const Gse={name:"ContentInspect",create:function(e){let{config:t}=e;return function(r){if(!r)throw new Te(K.INVALID_PARAMS,"inspectConfig is necessary.");if(!r.inspectType||!Array.isArray(r.inspectType))throw new Te(K.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(r.inspectType)];o.forEach(c=>{var u;if(!Ze(u=["supervise","moderation"]).call(u,c))throw new Te(K.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),r.inspectType=o}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new Te(K.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Hse(t)}};var eW=l(Mt.Object.getOwnPropertySymbols),Wse=Pn,zse=Go.indexOf,Yse=ah,fL=ae([].indexOf),tW=!!fL&&1/fL([1],1,-0)<0;Wse({target:"Array",proto:!0,forced:tW||!Yse("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return tW?fL(this,e,t)||0:zse(this,e,t)}});var qse=So("Array","indexOf"),Kse=U,Xse=qse,mL=Array.prototype,Qse=function(e){var t=e.indexOf;return e===mL||Kse(mL,e)&&t===mL.indexOf?Xse:t},nW=l(Qse);function $se(e,t){if(e==null)return{};var r,o,c=function(f,g){if(f==null)return{};var E={};for(var v in f)if({}.hasOwnProperty.call(f,v)){if(nW(g).call(g,v)!==-1)continue;E[v]=f[v]}return E}(e,t);if(eW){var u=eW(e);for(o=0;o<u.length;o++)r=u[o],nW(t).call(t,r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(c[r]=e[r])}return c}let rW=class{get localCapabilities(){return Pr(this._localCapabilities)}get rtpCapabilities(){return Pr(this._rtpCapabilities)}get candidates(){return Pr(this._candidates)}get iceParameters(){return Pr(this._iceParameters)}get dtlsParameters(){return Pr(this._dtlsParameters)}constructor(e){H(this,"sessionDesc",void 0),H(this,"_localCapabilities",void 0),H(this,"_rtpCapabilities",void 0),H(this,"_candidates",void 0),H(this,"_iceParameters",void 0),H(this,"_dtlsParameters",void 0),H(this,"setup",void 0),H(this,"currentMidIndex",void 0),H(this,"cname","o/i14u9pJrxRKAsu"),H(this,"firefoxSsrcMidMap",new Map),e=Pr(e);const{remoteIceParameters:t,remoteDtlsParameters:r,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:f,setup:g,videoCodec:E,audioCodec:v}=e;let S;this.setup=g,S=f===va.RECEIVE_ONLY?no(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):no(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=u;const R=f===va.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,I=f===va.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,D=f===va.RECEIVE_ONLY?c.send.videoCodecs:zb(lt.VIDEO,R,I,E),V=f===va.RECEIVE_ONLY?c.send.audioCodecs:zb(lt.AUDIO,R,I,v);for(const M of S.mediaDescriptions)M.attributes.iceUfrag=t.iceUfrag,M.attributes.icePwd=t.icePwd,M.attributes.fingerprints=r.fingerprints,M.attributes.candidates=o,M.attributes.setup=this.setup,M.media.mediaType==="application"&&(M.attributes.sctpPort="5000"),M.media.mediaType==="video"&&(M.media.fmts=D.map(j=>j.payloadType.toString(10)),M.attributes.payloads=D,M.attributes.extmaps=R.videoExtensions),M.media.mediaType==="audio"&&(M.media.fmts=V.map(j=>j.payloadType.toString(10)),M.attributes.payloads=V,M.attributes.extmaps=R.audioExtensions,av(M));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Tf(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,r,o,c){r=r.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:f}=zg(t,this.cname,te("SYNC_GROUP")?r:void 0),g=this.findPreloadMediaDesc(u);if(g){if(Br()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,g.attributes.mid),c&&(c.twcc||c.remb)){const E=this.sessionDesc.mediaDescriptions.indexOf(g);return this.sessionDesc.mediaDescriptions[E]=this.mungSendMediaDesc(g,c),{mid:g.attributes.mid,needExchangeSDP:!0}}return{mid:g.attributes.mid,needExchangeSDP:!1}}{const E=this.findAvailableMediaIndex(e,u,o);let v;return E===-1?(v=this.createOrRecycleSendMedia(e,u,f,"sendonly",o,c),this.updateBundleMids()):(v=Pr(this.sessionDesc.mediaDescriptions[E]),v.attributes.direction="sendonly",v.attributes.ssrcs=u,v.attributes.ssrcGroups=f,this.sessionDesc.mediaDescriptions[E]=this.mungSendMediaDesc(v,c)),Br()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,r){const o=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,f=this.findAvailableRecvMediaIndex(u);let g,E=!1;f===-1?(E=!0,g=this.createOrRecycleRecvMedia(c,[],"recvonly",t,r),this.updateBundleMids()):(g=Pr(this.sessionDesc.mediaDescriptions[f]),g.attributes.direction="recvonly"),o.push({mid:g.attributes.mid,needCreateTransceiver:E})}),o}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:r,address:o,port:c,type:u,relatedAddress:f,relatedPort:g,priority:E}=new RTCIceCandidate(e),v={foundation:t??"",componentId:"1",transport:r??"",priority:E?E+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:f??"",relPort:g?g+"":"",extension:{}};this.candidates.some(S=>S.priority===v.priority&&S.connectionAddress===v.connectionAddress&&S.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,r,o,c){const u=e._mediaStreamTrack.kind,f=this.rtpCapabilities.recv,g=zb(u,f,this.localCapabilities.send,u===lt.AUDIO?c:o),E=u===lt.VIDEO?f.videoExtensions:f.audioExtensions,v="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:E,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};S=this.mungRecvMediaDsec(S,e);const R=this.findFirstClosedMedia(u);if(R){const I=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[I]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>Ze(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>Ze(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,r){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Br()){if(c){const u=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===r})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const r=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&r})}predictReceivingMids(e){const t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}restartICE(e){e=Pr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,r,o,c,u){const f=this.rtpCapabilities.send,g=e===lt.VIDEO?f.videoCodecs:f.audioCodecs,E=e===lt.VIDEO?f.videoExtensions:f.audioExtensions;Br()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:E,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,u);const S=this.findFirstClosedMedia(e);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(e,t,r){const o=Pr(e);return g1(o),sv(o,t),_1(o,t),X9(o),cI(o,r,this.localCapabilities.send),o}mungSendMediaDesc(e,t){const r=Pr(e);return cI(r,t,this.localCapabilities.recv),av(r),r}updateRecvMedia(e,t){const r=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(r!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Br()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const Jse=["sdp"];var yr;function iW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Uf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iW(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iW(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let sW=(yr=class Iv extends D9{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,r,o){super(t,r),H(this,"direction",void 0),H(this,"name",void 0),H(this,"store",void 0),H(this,"spec",void 0),H(this,"peerConnection",void 0),H(this,"initialOffer",void 0),H(this,"transport",void 0),H(this,"statsFilter",void 0),H(this,"localCandidateCount",0),H(this,"_isInRestartIce",!1),H(this,"mutex",void 0),H(this,"onLocalCandidate",void 0),H(this,"remoteSDP",void 0),H(this,"pendingCandidates",[]),H(this,"localCapabilities",void 0),H(this,"isReady",!1),H(this,"restartCnt",0),H(this,"curTurnServerIndex",0),this.store=r,this.spec=t,this.mutex=new Ls("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(Iv.resolvePCConfiguration(t,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??va.SEND_ONLY,this.name=this.direction===va.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Nk(this.peerConnection,te("STATS_UPDATE_INTERVAL"),void 0,Br()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const r=await $9();if(this.localCapabilities=lI(r),t){const{sdp:o}=t,c=$se(t,Jse),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=Wb(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},V={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bl(R,S,"videoExtensions",I,D,V),bl(R,S,"videoCodecs",I,D,V),bl(R,S,"audioExtensions",I,D,V),bl(R,S,"audioCodecs",I,D,V),te("RAISE_H264_BASELINE_PRIORITY")){const M=V.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(M!==-1){const j=V.videoCodecs.findIndex(W=>W.rtpMap&&W.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<M){x.debug("raising H264 baseline profile priority");const W=V.videoCodecs[M];V.videoCodecs.splice(M,1),V.videoCodecs.splice(j,0,W)}j!==-1&&te("FILTER_SEND_H264_BASELINE")&&(I.videoCodecs=I.videoCodecs.filter(W=>!(W.rtpMap&&W.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&W.fmtp&&W.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:I,recv:D,sendrecv:V}}({},{},o);this.remoteSDP=new rW({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const f=await this.peerConnection.createAnswer();if(!f.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const g=Af(f.sdp);await this.peerConnection.setLocalDescription(f);const E=await J9({},{},f.sdp);this.localCapabilities=lI(E);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),Uf(Uf({},g),{},{sdp:f.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Af(o.sdp);return this.initialOffer=o,Uf(Uf({},c),{},{sdp:o.sdp})}}catch(r){throw new Ie(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:r,iceParameters:o,dtlsParameters:c}=t,u=await J9({},{},r);this.remoteSDP=new rW({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const f=this.peerConnection.getTransceivers()[0];f!=null&&f.sender&&f.sender.transport&&this.tryBindTransportEvents(f.sender.transport)}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(r=>{this.peerConnection.addIceCandidate(r)}),this.pendingCandidates=[])}catch(r){throw new Ie(K.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r.toString()))}}send(t,r,o){var c=this;return Ac(function*(){const u=yield In(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const f=[],g=c.remoteSDP.receive(t,r,o);t.forEach((j,W)=>{if(g[W].needCreateTransceiver){const Y=c.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});f.push(Y),j._updateRtpTransceiver(Y)}else{const Y=c.peerConnection.getTransceivers().find(le=>le.mid===g[W].mid);if(!Y)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(g[W].mid));f.push(Y),j._updateRtpTransceiver(Y)}}),Br()&&te("SIMULCAST")===!0&&(yield In(c.applySimulcastForFirefox(f,t)));const E=g.map(j=>j.mid),v=yield In(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(v.sdp,t,E),R=no(S),I=E.map(j=>{const W=R.mediaDescriptions.find(Y=>Y.attributes.mid===j);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return Y9(W,te("USE_PUB_RTX"))}),D=f.map((j,W)=>{const Y=E[W];return{localSSRC:I[W],id:Y}});yield In(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield D}catch(j){const W=c.remoteSDP.toString();throw yield In(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield In(c.peerConnection.setRemoteDescription({type:"answer",sdp:W})),yield In(c.stopSending(E,!0)),j}yield In(c.applySimulcastEncodings(f,t)),yield In(c.applySendEncodings(f,t));const V=c.remoteSDP.toString(),M=c.logSDPExchange(S,"offer","local","send");return M==null||M(V),yield In(c.setRemoteDescription({type:"answer",sdp:V})),f.map((j,W)=>{const Y=E[W];return{localSSRC:I[W],id:Y}})}catch(f){throw f instanceof Ie?f:new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(f.toString()))}finally{u()}})()}async stopSending(t,r){const o=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(E=>t.indexOf(E.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));c.map(E=>{var v;E.direction="inactive",(v=E.stop)===null||v===void 0||v.call(E)});const u=await this.peerConnection.createOffer(),f=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(t);const g=this.remoteSDP.toString();f==null||f(g),await this.setRemoteDescription({type:"answer",sdp:g})}catch(c){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(t,r,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:u,needExchangeSDP:f}=this.remoteSDP.send(t,r,o,c);if(f){const E=this.remoteSDP.toString(),v=this.logSDPExchange(E,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:E});const S=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(S.sdp,u,t);v==null||v(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const g=this.peerConnection.getTransceivers().find(E=>E.mid===u);if(!g||g.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:g.receiver.track,mid:g.mid,transceiver:g}}catch(u){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(t,r,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:u,needExchangeSDP:f}=this.remoteSDP.send(t,r,o,c);if(f){const g=this.remoteSDP.toString(),E=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const v=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(v.sdp,u,t);E==null||E(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(u){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===jg.Auto&&(this.store.p2pTransport=jg.SdRtn,On().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Iv.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,On().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Iv.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const r=await this.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Af(r.sdp);return this.store.descriptionStart(),this.direction===va.SEND_ONLY&&await this.peerConnection.setLocalDescription(r),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===va.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Af(r.sdp);return await this.peerConnection.setLocalDescription(r),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const u=this.remoteSDP.toString(),f=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),f==null||f(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ie(K.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,r){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===t);o.length===1&&(this.isVP8Simulcast(r)?Br()||await this.applySimulcastEncodings(o,[r]):await this.applySendEncodings(o,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const o=this.peerConnection.getTransceivers().find(c=>c.mid===r);o&&await o.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:o,remote:c}=r.getSelectedCandidatePair();return{local:Uf(Uf({},pu),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Uf(Uf({},pu),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,r;Ze(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var r;t.candidate.candidate&&((r=this.onLocalCandidate)===null||r===void 0||r.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,r){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return t.iceServers?c.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Ob(t.turnServer.servers)?c.iceServers=t.turnServer.servers:(c.iceServers&&c.iceServers.push(...Iv.turnServerConfigToIceServers(t.turnServer.servers,r,o)),te("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&t.turnServer.serversFromGateway&&c.iceServers.push(...Iv.turnServerConfigToIceServers(t.turnServer.serversFromGateway,r,o)),Ze(u=[jg.Relay,jg.SdRtn]).call(u,r)&&(c.iceTransportPolicy="relay"),te("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(f=>{f.forceturn&&(c.iceTransportPolicy="relay")}))),te("ENABLE_ENCODED_TRANSFORM")&&On().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(r)),c}static turnServerConfigToIceServers(t,r){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=t.filter(g=>g.tcpport);x.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const f=u.length>o?u[o]:u[0];switch(r){case jg.SdRtn:const g=t.filter(v=>{var S;return Ze(S=v.username).call(S,"glb:")&&v.turnServerURL==v.turnServerURL}),E=g.length>o?g[o]:g[0];E&&(c.push({username:E.username,credential:E.password,credentialType:"password",urls:"turn:".concat(Rf(E.turnServerURL),":").concat(E.tcpport,"?transport=udp")}),c.push({username:E.username,credential:E.password,credentialType:"password",urls:"turns:".concat(Rf(E.turnServerURL),":").concat(E.tcpport,"?transport=tcp")}));break;case jg.Relay:f&&(c.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(f.turnServerURL,":").concat(f.tcpport,"?transport=udp")}),c.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(Rf(f.turnServerURL),":").concat(f.tcpport,"?transport=tcp")}));break;default:f&&(c.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(f.turnServerURL,":").concat(f.tcpport,"?transport=udp")}),c.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(Rf(f.turnServerURL),":").concat(f.tcpport,"?transport=tcp")}),c.push({username:f.username,credential:f.password,credentialType:"password",urls:"stun:".concat(f.turnServerURL,":").concat(f.tcpport)}))}return c}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var o;t!=null&&t.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,t.state))},t.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const r=t.iceTransport;r&&(r.onstatechange=()=>{const o=t==null?void 0:t.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:o,remote:c}=r.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var o;if(r||(r=this.peerConnection.getSenders().find(S=>S.track===t._mediaStreamTrack)),!r)return x.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!On().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(t._encoderConfig){var f;const{bitrateMax:S,frameRate:R,scaleResolutionDownBy:I}=t._encoderConfig;S&&(u.maxBitrate=1e3*S),Ze(f=t._hints).call(f,er.LOW_STREAM)&&(R&&(u.maxFramerate=xo(R)),I&&I>=1&&(u.scaleResolutionDownBy=I))}if(te("DSCP_TYPE")&&Vh()){var g;const S=te("DSCP_TYPE");Ze(g=["very-low","low","medium","high"]).call(g,S)&&(u.networkPriority=S)}const E=r.getParameters(),v=(o=E.encodings)===null||o===void 0?void 0:o[0];Br()&&!v&&(c.encodings=[u]),v&&Object.assign(v,u),Object.assign(E,c),x.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(E.encodings))),await r.setParameters(E)}async applySendEncodings(t,r){try{if(!On().supportSetRtpSenderParameters||t.length!==r.length)return;for(let o=0;o<t.length;o++){const c=t[o],u=r[o];u instanceof Er&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,o){const c=no(t);return r.forEach((u,f)=>{const g=o[f],E=c.mediaDescriptions.find(v=>v.attributes.mid===g);E&&(sv(E,u),Q9(E,u,this.store.codec))}),Tf(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let E=0;E<t.length;E++){var o,c,u,f,g;const v=t[E],S=r[E];if(S instanceof Er&&!Ze(o=S._hints).call(o,er.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(f=S._scalabilityMode)!==null&&f!==void 0&&f.numSpatialLayers&&((g=S._scalabilityMode)===null||g===void 0?void 0:g.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},I={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const D=v.sender.getParameters();await v.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(t,r){if(!Br()&&t.length===r.length)for(let o=0;o<t.length;o++){const c=r[o];if(c instanceof Er&&this.isVP8Simulcast(c)){const u=t[o],f={},g={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:g.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:g.medium,scaleResolutionDownBy:4}];const E=u.sender.getParameters();await u.sender.setParameters(Object.assign(E,f))}}}isVP8Simulcast(t){var r,o,c,u,f;return!!(t instanceof Er&&te("SIMULCAST")&&this.store.codec==="vp8"&&!Ze(r=t._hints).call(r,er.LOW_STREAM)&&(o=t._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=t._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((f=t._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1)}logSDPExchange(t,r,o,c){if(te("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(r," SDP during P2PConnection.").concat(c,`
`),t),r==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(f=>f.mid&&t.indexOf(f.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(f=>{f.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(t);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(f=>f.mid&&t.indexOf(f.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async f=>{f.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(t);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}async getRemoteSSRC(t,r){var o;if(r=r??((o=this.currentRemoteDescription)===null||o===void 0?void 0:o.sdp)){var c;const u=(c=no(r).mediaDescriptions.find(f=>f.attributes.mid===t))===null||c===void 0?void 0:c.attributes.ssrcs;return u==null?void 0:u[0].ssrcId}}async setRemoteDescription(t){var r;await this.peerConnection.setRemoteDescription(t),Ze(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,r,o){const c=no(t),u=c.mediaDescriptions.find(f=>f.attributes.mid===r);return u&&o===lt.AUDIO&&u.media.mediaType==="audio"&&av(u),Tf(c)}},gt(yr.prototype,"establish",[Nl],Object.getOwnPropertyDescriptor(yr.prototype,"establish"),yr.prototype),gt(yr.prototype,"connect",[Nl],Object.getOwnPropertyDescriptor(yr.prototype,"connect"),yr.prototype),gt(yr.prototype,"receive",[Nl],Object.getOwnPropertyDescriptor(yr.prototype,"receive"),yr.prototype),gt(yr.prototype,"mockReceive",[Nl],Object.getOwnPropertyDescriptor(yr.prototype,"mockReceive"),yr.prototype),gt(yr.prototype,"stopReceiving",[Nl],Object.getOwnPropertyDescriptor(yr.prototype,"stopReceiving"),yr.prototype),gt(yr.prototype,"restartICE",[Nl],Object.getOwnPropertyDescriptor(yr.prototype,"restartICE"),yr.prototype),gt(yr.prototype,"close",[Nl],Object.getOwnPropertyDescriptor(yr.prototype,"close"),yr.prototype),gt(yr.prototype,"updateEncoderConfig",[Nl],Object.getOwnPropertyDescriptor(yr.prototype,"updateEncoderConfig"),yr.prototype),gt(yr.prototype,"updateSendParameters",[Nl],Object.getOwnPropertyDescriptor(yr.prototype,"updateSendParameters"),yr.prototype),gt(yr.prototype,"replaceTrack",[Nl],Object.getOwnPropertyDescriptor(yr.prototype,"replaceTrack"),yr.prototype),gt(yr.prototype,"muteLocal",[Nl],Object.getOwnPropertyDescriptor(yr.prototype,"muteLocal"),yr.prototype),gt(yr.prototype,"unmuteLocal",[Nl],Object.getOwnPropertyDescriptor(yr.prototype,"unmuteLocal"),yr.prototype),yr);function Nl(e,t,r){const o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(t));try{for(var f=arguments.length,g=new Array(f),E=0;E<f;E++)g[E]=arguments[E];return await o.apply(this,g)}finally{u()}},r}let _d=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var aW,oW,cW,lW,dW,uW,hW,pW,fW,mW,gW,Dr;function _W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function WI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_W(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_W(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let Zse=(aW=Ed(_d.SEND_ONLY),oW=Ed(_d.SEND_ONLY),cW=Ed(),lW=Ed(_d.RECEIVE_ONLY),dW=Ed(_d.RECEIVE_ONLY),uW=Ed(_d.RECEIVE_ONLY),hW=Ed(_d.RECEIVE_ONLY),pW=Ed(_d.RECEIVE_ONLY),fW=Ed(_d.RECEIVE_ONLY),mW=Ed(),gW=Ed(_d.RECEIVE_ONLY),Dr=class extends xr{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Rt.StateChange,t,this._state)}constructor(e,t){super(),H(this,"isPlanB",!1),H(this,"store",void 0),H(this,"statsUploader",void 0),H(this,"sendConnection",void 0),H(this,"recvConnection",void 0),H(this,"localTrackMap",new Map),H(this,"remoteUserMap",new Map),H(this,"localDataChannels",[]),H(this,"pendingLocalTracks",[]),H(this,"pendingRemoteTracks",[]),H(this,"statsCollector",void 0),H(this,"dtlsFailedCount",0),H(this,"sendMutex",void 0),H(this,"recvMutex",void 0),H(this,"_state",Fn.Disconnected),H(this,"_restartStates",["disconnected","failed"]),H(this,"reconnectInterval",void 0),H(this,"uploadUnplinkStarted",!1),H(this,"uploadDownlinkStarted",!1),H(this,"uplinkStateUploadInterval",void 0),H(this,"downlinkStatsUploadInterval",void 0),H(this,"handleMuteLocalTrack",async(r,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Fn.Connected)return void c(new Ie(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const E=this.filterTobeMutedTracks(r);if(E.length===0)return void o();const v=E.find(D=>D[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(E.map(D=>{let[,{id:V}]=D;return V}));let S=!1;var f,g;r.trackMediaType==="video"?S=!((f=this.localTrackMap.get(Fe.LocalAudioTrack))===null||f===void 0||!f.track._muted):S=((g=this.localTrackMap.get(Fe.LocalVideoTrack))===null||g===void 0?void 0:g.id)===void 0;const R=this.createMuteMessage(E);await ir(this,Rt.RequestMuteLocal,R);const I=r.trackMediaType==="video"?wf.MUTE_LOCAL_VIDEO:wf.MUTE_LOCAL_AUDIO;await ir(this,Rt.RequestP2PMuteLocal,{action:I,message:R,isMuteAll:S}),o()}catch(E){c(E)}finally{u()}}),H(this,"handleUnmuteLocalTrack",async(r,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Fn.Connected)return void c(new Ie(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const f=this.filterTobeUnmutedTracks(r);if(f.length===0)return void o();await this.sendConnection.unmuteLocal(f.map(v=>{let[,{id:S}]=v;return S}));const g=this.createUnmuteMessage(f),E=r.trackMediaType==="video"?wf.UNMUTE_LOCAL_VIDEO:wf.UNMUTE_LOCAL_AUDIO;await ir(this,Rt.RequestP2PMuteLocal,{action:E,message:g}),o()}catch(f){c(f)}finally{u()}}),H(this,"handleUpdateVideoEncoder",async(r,o,c,u)=>{let f;typeof u=="boolean"&&u||(f=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const E=this.localTrackMap.get(Fe.LocalVideoTrack);if(!this.sendConnection||!E||E.track!==r||this.state!==Fn.Connected)return void o();const{id:v,track:S}=E;v&&(await this.sendConnection.updateSendParameters(v,S),await this.sendConnection.updateEncoderConfig(v,S),this.emit(Rt.UpdateVideoEncoder,S)),o()}catch(E){c(E)}finally{var g;(g=f)===null||g===void 0||g()}}),H(this,"handleUpdateVideoSendParameters",async(r,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const f=this.localTrackMap.get(Fe.LocalVideoTrack);if(!this.sendConnection||!f||f.track!==r||this.state!==Fn.Connected)return void o();const{id:g,track:E}=f;g&&await this.sendConnection.updateSendParameters(g,E),o()}catch(f){c(f)}finally{u()}}),H(this,"handleReplaceTrack",async(r,o,c,u)=>{let f;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof u=="boolean"&&u||(f=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var g;const v=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return r===R});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==Fn.Connected)return void o();if(await((g=this.sendConnection)===null||g===void 0?void 0:g.replaceTrack(r,v[1].id)),v[0]===Fe.LocalVideoTrack&&On().supportDualStreamEncoding){const S=this.localTrackMap.get(Fe.LocalVideoLowTrack);if(S){const R=r._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new tt((I,D)=>{this.handleReplaceTrack(S.track,I,D,!0)})}}o()}catch(v){c(v)}finally{var E;(E=f)===null||E===void 0||E()}}),H(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),H(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),H(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),H(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new L6(e),this.bindStatsUploaderEvents(),this.sendMutex=new Ls("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Ls("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(r=>{r&&(r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))})},te("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new Ie(K.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Ie(K.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let r;try{if(t){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new sW(e,this.store,va.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(t);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Fn.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new sW(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{r&&r()}}async p2pConnect(e){if(!this.sendConnection)throw new Ie(K.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Fn.Connected}async addRemoteCandidate(e,t){if(t===va.RECEIVE_ONLY){if(!this.sendConnection)throw new Ie(K.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Ie(K.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,r){var o=this;return Ac(function*(){const c=yield In(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Fn.Connected){o.throwIfTrackTypeNotMatch(e);const v=e.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(v))}o.store.pubId=o.store.pubId+1,Us.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(e,t,r);if(u.length===0)return void(yield In(o.tryToUnmuteAudio(e)));u.forEach(v=>{let{track:S,type:R}=v;const I=Date.now();o.store.publish(S.getTrackId(),R===Fe.LocalAudioTrack?"audio":"video",I)}),o.bindLocalTrackEvents(u);const f=yield In(o.sendConnection.send(u.map(v=>{let{track:S}=v;return S}),o.store.codec,o.store.audioCodec)),g=(yield In(f.next())).value,E=o.createGatewayPublishMessage(u,g);try{yield E}catch(v){throw f.throw(v),(v==null?void 0:v.code)===K.WS_ABORT&&u.forEach(S=>{let{track:R}=S;o.pendingLocalTracks.indexOf(R)===-1&&o.pendingLocalTracks.push(R)}),o.unbindLocalTrackEvents(u),v}yield In(f.next()),u.forEach(v=>{let{type:S}=v;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,g),u.forEach(v=>{let{track:S,type:R}=v;const I=Date.now();o.store.publish(S.getTrackId(),R===Fe.LocalAudioTrack?"audio":"video",void 0,I)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Fn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!Ze(e).call(e,c)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const r=t.find(c=>c[0]==="videoLowTrack");r&&r[1].track.close();const o=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(c=>{let[u,{track:f}]=c;return{type:u,track:f}})),t.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Fn.Connected)return r&&r[1].track.close(),o;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],r=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:f}]=o;const g={stream_type:Wre(u,c),ssrcs:f};u._muted||!u._enabled?t.push(g):r.push(g)}),t.length>0&&t.forEach(o=>{ir(this,Rt.RequestMuteLocal,[o])}),r.length>0&&r.forEach(o=>{ir(this,Rt.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Ac(function*(){throw new Ie(K.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ys(this,Rt.RequestRePublish,this.pendingLocalTracks),this.emit(Rt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Ie(K.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,r,o){var c;if(!this.recvConnection)throw new Ie(K.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;const{track:u,mid:f,transceiver:g}=await this.recvConnection.receive(t,[{ssrcId:r}],String(e.uid),o);t===lt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new $y(u,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),g&&e._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new Qy(u,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),g&&e._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._videoTrack));const E=this.remoteUserMap.get(e);E?E.set(t,f):this.remoteUserMap.set(e,new Map([[t,f]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:I}=S;return R.uid===e.uid&&t===I});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(Rt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,r,o){if(!this.recvConnection)throw new Ie(K.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:r}],String(e.uid),o)}async unsubscribe(e,t,r){const o=this.pendingRemoteTracks.filter(u=>{let{user:f,kind:g}=u;return t!==void 0?f.uid===e.uid&&t===g:f.uid===e.uid});if(o.forEach(u=>{const f=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(f,1)}),this.recvConnection||r||o.forEach(u=>{let{kind:f}=u;var g;if(f===lt.AUDIO)(g=e._audioTrack)===null||g===void 0||g._destroy(),e._audioTrack=void 0;else if(f===lt.VIDEO){var E;(E=e._videoTrack)===null||E===void 0||E._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,t);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:f}]=u;return f})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[f,{kind:g}]=u;var E,v;if(g===lt.VIDEO&&f._videoSSRC&&((E=this.recvConnection)===null||E===void 0||E.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),g===lt.VIDEO)this.unbindRemoteTrackEvents(f._videoTrack),r||((v=f._videoTrack)===null||v===void 0||v._destroy(),f._videoTrack=void 0);else if(g===lt.AUDIO){var S;this.unbindRemoteTrackEvents(f._audioTrack),!r&&((S=f._audioTrack)===null||S===void 0||S._destroy(),f._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:f}]=u;ir(this,Rt.RequestP2PMuteRemote,f)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,r]=t;[lt.VIDEO,lt.AUDIO].forEach(o=>{r.has(o)?ir(this,Rt.RequestP2PUnmuteRemote,o):ir(this,Rt.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Ie(K.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Ie(K.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Ie(K.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Ie(K.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const r=this.remoteUserMap.get(e);if(!r)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const o=t===lt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const r=this.remoteUserMap.get(e);if(!r)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(Fe.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ni){const r=t.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Fe.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Fe.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[o]=r;return!(e&&o===Fe.LocalVideoLowTrack)}).map(r=>{let[,{track:o}]=r;return o})}reportPublishEvent(e,t,r,o,c){if(e){const f=this.localTrackMap.get(Fe.LocalAudioTrack),g=o?this.localTrackMap.get(Fe.LocalVideoLowTrack):this.localTrackMap.get(Fe.LocalVideoTrack);St.publish(this.store.sessionId,{eventElapse:Us.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:f==null?void 0:f.track.getTrackLabel(),videoName:g==null?void 0:g.track.getTrackLabel(),screenshare:(g==null?void 0:g.track._hints.indexOf(er.SCREEN_TRACK))!==-1,audio:!!f,video:!!g,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;r||(r=[]);const f=r.find(E=>E instanceof Xr),g=o?(u=this.localTrackMap.get(Fe.LocalVideoTrack))===null||u===void 0?void 0:u.track:r.find(E=>E instanceof Er);St.publish(this.store.sessionId,{eventElapse:Us.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:f==null?void 0:f.getTrackLabel(),videoName:g==null?void 0:g.getTrackLabel(),screenshare:(g==null?void 0:g._hints.indexOf(er.SCREEN_TRACK))!==-1,audio:!!f,video:!!g,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,r,o){const c=o===lt.VIDEO?r._videoSSRC:r._audioSSRC;c&&St.subscribe(this.store.sessionId,{succ:e,ec:t,video:o===lt.VIDEO,audio:o===lt.AUDIO,peerid:r.uid,subscribeRequestid:o===lt.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:Us.measureFromSubscribeStart(this.store.clientId,c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ls("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ls("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Fe.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ni){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Fn.Disconnected}getStats(e){var t,r;return e?(r=this.recvConnection)===null||r===void 0?void 0:r.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Fe.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Fe.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Er||t&&t.track instanceof Xr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;const r=Array.from(ec(t=this.remoteUserMap).call(t)).find(o=>o.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[o]=r;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Fe.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Gt(e).call(e,(r,o)=>r.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Fn.Reconnecting,te("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:o}]=e;switch(r){case Fe.LocalVideoTrack:Ze(t=o._hints).call(t,er.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Fe.LocalAudioTrack:o instanceof Ni?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Fe.LocalVideoLowTrack:}}),this.emit(Rt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(ec(r).call(r)).forEach(o=>{this.setPendingRemoteMedia(t,o)}),this.emit(Rt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const r of this.pendingRemoteTracks){const{user:o,kind:c}=r;if((e instanceof Nf?e.uid:e)===o.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let r,o;if(e===va.SEND_ONLY){if(!this.sendConnection)throw new Ie(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Ie(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(t){const c=await o.restartICE(t);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await ys(this,Rt.RequestP2PRestartICE,{direction:va.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(Fe.LocalVideoTrack),r=this.localTrackMap.get(Fe.LocalAudioTrack),o=e.videoSend.find(D=>{var V;return D.ssrc===(t==null||(V=t.ssrcs)===null||V===void 0?void 0:V[0].ssrcId)}),c=e.audioSend.find(D=>{var V;return D.ssrc===(r==null||(V=r.ssrcs)===null||V===void 0?void 0:V[0].ssrcId)});if(!o||!c)return 1;const u=Jo(this,Rt.NeedSignalRTT),f=o?o.rttMs:void 0,g=c?c.rttMs:void 0,E=f&&g?(f+g)/2:f||g,v=(E&&u?(E+u)/2:E||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*v/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,I=t==null?void 0:t.track;if(I&&I._encoderConfig&&I._hints.indexOf(er.SCREEN_TRACK)===-1){const D=I._encoderConfig.bitrateMax,V=e.bitrate.actualEncoded;if(D&&V){const M=(1e3*D-V)/(1e3*D);return b9[M<.15?0:M<.3?1:M<.45?2:M<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[o]=r;const c=o._audioSSRC,u=o._videoSSRC,f=e.audioRecv.find(V=>V.ssrc===c),g=e.videoRecv.find(V=>V.ssrc===u);if(!f&&!g)return void(t+=1);const E=Jo(this,Rt.NeedSignalRTT),v=e.rtt,S=(v&&E?(v+E)/2:v||E)||0,R=f?f.jitterMs:void 0,I=e.recvPacketLossRate;let D=.7*I*100/50+.3*S/1500;R&&(D=.6*I*100/50+.2*S/1500+.2*R/400),t+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new tt((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}filterTobePublishedTracks(e,t,r){const o=[],c=On(),u=this.getAllTracks();e=jy(e=e.filter(E=>u.indexOf(E)===-1));let f=!1,g=!1;for(const E of e){if(E instanceof Er&&(this.localTrackMap.has(Fe.LocalVideoTrack)||f?new Ie(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:E,type:Fe.LocalVideoTrack}),f=!0),t)){const v=this.getLowVideoTrack(E,r);o.push({track:v,type:Fe.LocalVideoLowTrack})}if(E instanceof Xr){const v=this.localTrackMap.get(Fe.LocalAudioTrack);if(v){if(!(v.track instanceof Ni))throw new Ie(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(E._bypassWebAudio)throw new Ie(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(E),this.bindLocalAudioTrackEvents(E,!0)}else if(g){const S=o.find(R=>{let{type:I}=R;return I===Fe.LocalAudioTrack});if(!(S.track instanceof Ni))throw new Ie(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(E._bypassWebAudio)throw new Ie(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(E)}else{if(!c.webAudioMediaStreamDest||E instanceof Ni||E._bypassWebAudio)o.push({track:E,type:Fe.LocalAudioTrack});else{const S=new Ni;S.addAudioTrack(E),o.push({track:S,type:Fe.LocalAudioTrack})}g=!0}}}return o}filterTobeUnpublishedTracks(e){const t=[],r=this.getAllTracks();e=jy(e=e.filter(o=>r.indexOf(o)!==-1));for(const o of e){if(o instanceof Xr){const c=this.localTrackMap.get(Fe.LocalAudioTrack);if(!c)continue;c.track instanceof Ni?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(t.push([Fe.LocalAudioTrack,c]),c.track.close())):t.push([Fe.LocalAudioTrack,c])}if(o instanceof Er){const c=this.localTrackMap.get(Fe.LocalVideoTrack);if(!c)continue;t.push([Fe.LocalVideoTrack,c]);const u=this.localTrackMap.get(Fe.LocalVideoLowTrack);u&&t.push([Fe.LocalVideoLowTrack,u])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:o}=t;switch(o){case Fe.LocalVideoTrack:r.addListener(ft.GET_STATS,this.handleGetLocalVideoStats),r.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Fe.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case Fe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ni?e.trackList.forEach(r=>{r.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),r.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:o}]=t;return{track:o,type:r}})),e.forEach(t=>{let{track:r,type:o}=t;switch(o){case Fe.LocalVideoTrack:r.off(ft.GET_STATS,this.handleGetLocalVideoStats),r.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Fe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case Fe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ni?e.trackList.forEach(t=>{t.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ft.GET_STATS,this.handleGetLocalAudioStats),t.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ft.GET_STATS,this.handleGetLocalAudioStats),e.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Qy&&t.addListener(ft.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof $y&&t.addListener(ft.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ft.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(lt.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(lt.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,o)=>{var c;let u,{track:f,type:g}=r;switch(g){case Fe.LocalAudioTrack:u=Hn.Audio;break;case Fe.LocalVideoTrack:u=Ze(c=f._hints).call(c,er.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Fe.LocalVideoLowTrack:u=Hn.Low}return{kind:g===Fe.LocalAudioTrack?lt.AUDIO:lt.VIDEO,stream_type:u,mid:t[o].id,ssrcs:t[o].localSSRC,isMuted:f.muted||!f.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:f,id:g}]=t;switch(c){case Fe.LocalVideoTrack:o=Ze(r=u._hints).call(r,er.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Fe.LocalAudioTrack:o=Hn.Audio;break;case Fe.LocalVideoLowTrack:o=Hn.Low}return{stream_type:o,ssrcs:f,mid:g}})}assignLocalTracks(e,t){e.forEach((r,o)=>{let{track:c,type:u}=r;this.localTrackMap.set(u,{track:c,id:t[o].id,ssrcs:t[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var r;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Rt.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Ze(r=this._restartStates).call(r,t)&&!e.isInRestartIce&&(t==="disconnected"&&await cs(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),St.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Gr.TRACER}).onSuccess(),this.emit(Rt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;const o=Array.from(ec(r=this.remoteUserMap).call(r)).find(u=>u._audioSSRC===t);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(zy.FIRST_FRAME_DECODED),St.firstRemoteFrame(this.store.sessionId,Bi.FIRST_AUDIO_DECODE,Nr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;const o=Array.from(ec(r=this.remoteUserMap).call(r)).find(c=>c._audioSSRC===t);o&&St.firstRemoteFrame(this.store.sessionId,Bi.FIRST_AUDIO_RECEIVED,Nr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,o)=>{this.reportVideoFirstFrameDecoded(t,r,o)},e.onFirstVideoReceived=t=>{var r;const o=Array.from(ec(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);o&&St.firstRemoteFrame(this.store.sessionId,Bi.FIRST_VIDEO_RECEIVED,Nr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{const o=t.candidateType==="relay",c=r.candidateType==="relay";r.candidateType!=="unknown"&&o===c||this.emit(Rt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Cf(r))," -> ").concat(JSON.stringify(Cf(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Cf(r))," -> ").concat(JSON.stringify(Cf(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Rt.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===va.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===va.SEND_ONLY?this.restartICE(e):ys(this,Rt.RequestP2PRestartICE,{direction:va.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const r=this.localTrackMap.get(Fe.LocalAudioTrack);if(e instanceof Xr&&(r==null?void 0:r.track)instanceof Ni)return r.track.isActive||t.push([Fe.LocalAudioTrack,r]),t;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(t.push(o),o[0]===Fe.LocalVideoTrack)){const c=this.localTrackMap.get(Fe.LocalVideoLowTrack);c&&t.push([Fe.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){const t=[],r=this.localTrackMap.get(Fe.LocalAudioTrack);if(e instanceof Xr&&(r==null?void 0:r.track)instanceof Ni)return r.track.isActive&&t.push([Fe.LocalAudioTrack,r]),t;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Fe.LocalVideoTrack){t.push(o);const c=this.localTrackMap.get(Fe.LocalVideoLowTrack);c&&t.push([Fe.LocalVideoLowTrack,c])}else t.push(o);return t}createMuteMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:f,id:g}]=t;switch(c){case Fe.LocalAudioTrack:o=Hn.Audio;break;case Fe.LocalVideoTrack:o=Ze(r=u._hints).call(r,er.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Fe.LocalVideoLowTrack:o=Hn.Low}return{stream_type:o,ssrcs:f,mid:g}})}createUnmuteMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:f,id:g}]=t;switch(c){case Fe.LocalAudioTrack:o=Hn.Audio;break;case Fe.LocalVideoTrack:o=Ze(r=u._hints).call(r,er.SCREEN_TRACK)?Hn.Screen:Hn.High;break;case Fe.LocalVideoLowTrack:o=Hn.Low}return{stream_type:o,ssrcs:f,mid:g}})}filterTobeUnSubscribedTracks(e,t){const r=[],o=this.remoteUserMap.get(e);if(!o)return r;if(t){const c=o.get(t);if(!c)return r;r.push([e,{kind:t,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,f]=c;r.push([e,{kind:u,id:f}])});return r}createUnsubscribeMessage(e){const t=[];return e.forEach(r=>{let[o,{kind:c,id:u}]=r;switch(c){case lt.VIDEO:return void(o._videoSSRC&&t.push({stream_type:lt.VIDEO,ssrcId:o._videoSSRC}));case lt.AUDIO:return void(o._audioSSRC&&t.push({stream_type:lt.AUDIO,ssrcId:o._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:o}]=t;const c=this.remoteUserMap.get(r);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Fe.LocalVideoTrack),r=this.localTrackMap.get(Fe.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new tt((o,c)=>{this.handleUpdateVideoEncoder(t.track,o,c,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new tt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Xr){const r=this.filterTobeUnmutedTracks(e[t]);if(r.length===0)continue;const o=this.createUnmuteMessage(r);return void await ir(this,Rt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Rt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Rt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await cs(bk(this.dtlsFailedCount,Ri)),this.emit(Rt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Fe.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Er)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Er).length>1)throw new Ie(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Xr).length>1&&(e.some(t=>t instanceof Xr&&t._bypassWebAudio)||!On().webAudioMediaStreamDest))throw new Ie(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Er&&this.pendingLocalTracks.some(r=>r instanceof Er))throw new Ie(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Xr&&this.pendingLocalTracks.some(r=>r instanceof Xr)&&(!On().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof Xr&&r._bypassWebAudio)))throw new Ie(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const r=!te("DISABLE_DUAL_STREAM_USE_ENCODING")&&On().supportDualStreamEncoding,o=WI(WI({},{width:160,height:120,framerate:15,bitrate:50}),t);let c;c=r?e._mediaStreamTrack.clone():P1(e,o);const u=dr(8,"track-low-"),f=new Er(c,WI(WI({},r&&{scaleResolutionDownBy:m1(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return f.on(Ug.TRANSCEIVER_UPDATED,g=>{e._updateRtpTransceiver(g,Gy.LOW_STREAM)}),f._hints.push(er.LOW_STREAM),e.addListener(ft.NEED_CLOSE,()=>{f.close()}),f}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,r,o){var c;const u=Array.from(ec(c=this.remoteUserMap).call(c)).find(f=>f._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const f=this.store.keyMetrics,g=f.subscribe.find(E=>E.userId===u.uid&&E.type==="video");St.firstRemoteVideoDecode(this.store.sessionId,Bi.FIRST_VIDEO_DECODE,Nr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:t,videoheight:r,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:f.requestAPEnd||0,apStart:f.requestAPStart||0,joinGwEnd:f.joinGatewayEnd||0,joinGwStart:f.joinGatewayStart||0,pcEnd:f.peerConnectionEnd||0,pcStart:f.peerConnectionStart||0,subscriberEnd:(g==null?void 0:g.subscribeEnd)||0,subscriberStart:(g==null?void 0:g.subscribeStart)||0,videoAddNotify:(g==null?void 0:g.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(t);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==r}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Ie(K.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Ie(K.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new Ie(K.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new Ie(K.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new Ie(K.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new Ie(K.NOT_SUPPORTED)}async preConnect(e){throw new Ie(K.NOT_SUPPORTED)}getEstablishParams(){throw new Ie(K.NOT_SUPPORTED)}async reSubscribe(e){throw new Ie(K.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new Ie(K.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===Fe.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,Gy.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},gt(Dr.prototype,"p2pConnect",[aW],Object.getOwnPropertyDescriptor(Dr.prototype,"p2pConnect"),Dr.prototype),gt(Dr.prototype,"unpublish",[oW],Object.getOwnPropertyDescriptor(Dr.prototype,"unpublish"),Dr.prototype),gt(Dr.prototype,"unpublishLowStream",[cW],Object.getOwnPropertyDescriptor(Dr.prototype,"unpublishLowStream"),Dr.prototype),gt(Dr.prototype,"subscribe",[lW],Object.getOwnPropertyDescriptor(Dr.prototype,"subscribe"),Dr.prototype),gt(Dr.prototype,"mockSubscribe",[dW],Object.getOwnPropertyDescriptor(Dr.prototype,"mockSubscribe"),Dr.prototype),gt(Dr.prototype,"unsubscribe",[uW],Object.getOwnPropertyDescriptor(Dr.prototype,"unsubscribe"),Dr.prototype),gt(Dr.prototype,"muteRemote",[hW],Object.getOwnPropertyDescriptor(Dr.prototype,"muteRemote"),Dr.prototype),gt(Dr.prototype,"unmuteRemote",[pW],Object.getOwnPropertyDescriptor(Dr.prototype,"unmuteRemote"),Dr.prototype),gt(Dr.prototype,"hasRemoteMediaWithLock",[fW],Object.getOwnPropertyDescriptor(Dr.prototype,"hasRemoteMediaWithLock"),Dr.prototype),gt(Dr.prototype,"disconnectForReconnect",[mW],Object.getOwnPropertyDescriptor(Dr.prototype,"disconnectForReconnect"),Dr.prototype),gt(Dr.prototype,"remoteMediaSsrcChanged",[gW],Object.getOwnPropertyDescriptor(Dr.prototype,"remoteMediaSsrcChanged"),Dr.prototype),Dr);function Ed(e){return function(t,r,o){const c=t[r];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];switch(e){case _d.SEND_ONLY:{const E=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,f)}finally{E()}}case _d.RECEIVE_ONLY:{const E=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,f)}finally{E()}}default:{const E=await this.sendMutex.lock("From P2PChannel2.".concat(r)),v=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,f)}finally{E(),v()}}}},o}}class n_ extends xr{constructor(t,r){super(),H(this,"signal",void 0),H(this,"token",void 0),H(this,"tokenTimeout",void 0),H(this,"tokenInterval",void 0),H(this,"_sequence",0),H(this,"userMap",new Map),H(this,"encoder",new TextEncoder),this.signal=t,this.token=r;const o=()=>{this.signal.connectionState===fr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*te("P2P_TOKEN_INTERVAL"))};o()}async send(t,r,o,c,u){var f;if(this.userMap.size===0)return;const g=Array.from(Pa(f=this.userMap).call(f))[0].token;typeof r!="string"&&(r=JSON.stringify(r)),c=c??dr(6,""),u=u??this._sequence++;const E={_id:c,_type:t,_seq:u,_message:r,token:"".concat(this.token,"_").concat(g)};te("SHOW_P2P_LOG")&&x.debug("send message",E,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(E)).forEach(S=>{this.signal.request(kt.DATA_STREAM,{payload:Sf(this.encoder.encode(S))})});const v=new tt((S,R)=>{const I=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),D),this.off("res-@".concat(c),M),this.off(nv.ABORT,V),x.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(c)),this.userMap.size===0?R(new Ie(K.INVALID_REMOTE_USER)):R(new Ie(K.TIMEOUT))},te("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),D=()=>{I&&window.clearTimeout(I),this.off(nv.ABORT,V),o&&S()},V=()=>{I&&window.clearTimeout(I),this.off("res-@".concat(c,"_ack"),D),this.off("res-@".concat(c),M),R(new Ie(K.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(c)))};this.once(nv.ABORT,V),this.once("res-@".concat(c,"_ack"),D);const M=(W,Y)=>{j=!0,I&&window.clearTimeout(I),this.off("res-@".concat(c,"_ack"),D),this.off(nv.ABORT,V),W==="success"?S(Y):R(new Ie(K.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(c)))};let j=!1;o||(this.once("res-@".concat(c),M),cs(te("SIGNAL_REQUEST_TIMEOUT")).then(()=>{j||x.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(c,", ").concat(E))}))});try{return await v}catch(S){if(S.code===K.TIMEOUT)return await this.send(t,r,o,c,u);throw S}}onMessage(t){var r;const{_uid:o}=t;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==oi.CHECK)return;const{token:v}=t;c=new Map,u={uid:o,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(En.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in t&&"total"in t){var f;const{id:v,total:S}=t,R=(f=c.get(v))!==null&&f!==void 0?f:[];if(R.push(t),c.has(v)||c.set(v,R),R.length!==S)return;{const I=Gt(R).call(R,(D,V)=>D.index-V.index).map(D=>D.payload).join("");c.delete(v),(t=JSON.parse(I))._uid=o}}const{_type:g,token:E}=t;if(Ze(r=[oi.ACK,oi.CHECK]).call(r,g))return g===oi.CHECK&&this.handleCheckToken(u,E),void this.receiveMessage(t);E==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(t):x.debug('Receive unexpected message", '.concat(E,", cur_token: ").concat(u.token,"_").concat(this.token),t)}check(){const t={_id:dr(6,""),token:this.token,_type:oi.CHECK};te("SHOW_P2P_LOG")&&x.debug("send message",t),this.signal.request(kt.DATA_STREAM,{payload:Sf(this.encoder.encode(JSON.stringify(t)))})}ack(t){const r={_id:t,_type:oi.ACK,token:this.token};te("SHOW_P2P_LOG")&&x.debug("send message",r),this.signal.request(kt.DATA_STREAM,{payload:Sf(this.encoder.encode(JSON.stringify(r)))})}response(t,r,o){this.send(oi.RESPONSE,JSON.stringify({success:!o,message:r}),!0,t)}handleReceivedMessage(t){const r=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:R}=v;for(;S.has(R);){const I=S.get(R);S.delete(R),this.receiveMessage(I),v.nextExpectedSequenceNumber++}})};if(!t)return void r();const{_uid:o,_seq:c}=t,u=this.userMap.get(o),{receivedMessagesMap:f,isStart:g,nextExpectedSequenceNumber:E}=u;if(c<E)return this.ack(t._id),void x.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(t._message));f.set(c,t),g&&c===E&&(this.receiveMessage(t),f.delete(E),u.nextExpectedSequenceNumber++,r())}receiveMessage(t){const{_id:r,_type:o,_message:c,_uid:u}=t;if(te("SHOW_P2P_LOG")&&x.debug("receive message",t),r){let f;switch(t._type!==oi.ACK&&(c&&(f=JSON.parse(c)),this.ack(t._id)),t._type){case oi.CANDIDATE:case oi.CONTROL:this.signal.emit(o,f,u);break;case oi.PUBLISH:case oi.UNPUBLISH:case oi.RESTART_ICE:case oi.CALL:f.uid=u,ys(this.signal,o,f).then(g=>{this.response(t._id,g)}).catch(()=>{this.response(t._id,void 0,!0)});break;case oi.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case oi.RESPONSE:{const{success:g,message:E}=f;this.emit("res-@".concat(r),g?"success":"failed",E);break}}}}splitMessage(t){if(t.length<n_.MAX_MESSAGE_SIZE)return[t];const r=[],{remoteToken:o}=JSON.parse(t),c=dr(6,"");let u=0,f=800;const g=Math.ceil(t.length/f);for(;t.length>0;){u++;const E={id:c,index:u,total:g,payload:t.slice(0,f),token:"".concat(this.token,"_").concat(o)};JSON.stringify(E).length>n_.MAX_MESSAGE_SIZE?f-=50:(r.push(E),t=t.slice(f))}return r.map(E=>JSON.stringify(E))}handleCheckToken(t,r){return t.token!==r?(x.debug("token changed, from ".concat(t.token," to ").concat(r)),this.reset(t.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(r)),this.reset(t.uid)},te("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await ys(this.signal,oi.CALL,void 0),r=await this.send(oi.CALL,t);this.signal.emit(jt.P2P_CONNECTION,r,!0)}async reset(t,r){const o=this.userMap.get(t);o&&(this.emit(nv.ABORT),this.signal.emit(En.ON_USER_OFFLINE,{uid:o.uid,reason:Ere.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r||(x.debug("change local token from ".concat(r," to ").concat(r)),this.token=dr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(nv.ABORT)}}H(n_,"MAX_SIZE",1),H(n_,"MAX_MESSAGE_SIZE",1024);class eae extends xr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===fr.CONNECTED?this.emit(jt.WS_CONNECTED):t===fr.RECONNECTING?this.emit(jt.WS_RECONNECTING,this._websocketReconnectReason):t===fr.CLOSED&&this.emit(jt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),H(this,"_disconnectedReason",void 0),H(this,"_websocketReconnectReason",void 0),H(this,"_connectionState",fr.CLOSED),H(this,"reconnectToken",void 0),H(this,"p2pToken",void 0),H(this,"websocket",void 0),H(this,"openConnectionTime",void 0),H(this,"clientId",void 0),H(this,"lastMsgTime",Date.now()),H(this,"uploadCache",[]),H(this,"uploadCacheInterval",void 0),H(this,"rttRolling",new K3(5)),H(this,"pingpongTimer",void 0),H(this,"pingpongTimeoutCount",0),H(this,"joinResponse",void 0),H(this,"multiIpOption",void 0),H(this,"initError",void 0),H(this,"spec",void 0),H(this,"store",void 0),H(this,"_external_signal",void 0),H(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(jt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case En.ON_DATA_STREAM:return void this.handleDataStream(c._message);case En.MUTE_AUDIO:case En.MUTE_VIDEO:case En.ON_P2P_LOST:case En.ON_USER_ONLINE:return;case En.ON_USER_OFFLINE:const{uid:u}=c._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===En.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===En.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Vn.UID_BANNED);break;case 15:this.close(Vn.IP_BANNED);break;case 16:this.close(Vn.CHANNEL_BANNED)}if(c._type===En.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ct.ERR_LICENSE_MISSING:this.close(Vn.LICENSE_MISSING);break;case Ct.ERR_LICENSE_EXPIRED:this.close(Vn.LICENSE_EXPIRED);break;case Ct.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Vn.LICENSE_MINUTES_EXCEEDED);break;case Ct.ERR_LICENSE_PERIOD_INVALID:this.close(Vn.LICENSE_PERIOD_INVALID);break;case Ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Vn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ct.ERR_LICENSE_ILLEGAL:this.close(Vn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new p1("gateway-".concat(this.clientId),this.spec.retryConfig,!0,te("JOIN_GATEWAY_USE_DUAL_DOMAIN"),te("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===fr.CONNECTED&&this.reconnect("retry",Es.OFFLINE)}),this.p2pToken=dr(6,""),this._external_signal=new n_(this,this.p2pToken)}async request(t,r,o,c){const u=dr(6,""),f={_id:u,_type:t,_message:r},g=this.websocket.connectionID,E=()=>new tt((V,M)=>{if(this.connectionState===fr.CONNECTED)return V();const j=()=>{this.off(jt.WS_CLOSED,W),V()},W=()=>{this.off(jt.WS_CONNECTED,j),M(new Ie(K.WS_ABORT))};this.once(jt.WS_CONNECTED,j),this.once(jt.WS_CLOSED,W)});if(this.connectionState!==fr.CONNECTING&&this.connectionState!==fr.RECONNECTING||t===kt.JOIN||t===kt.REJOIN||await E(),this.websocket.sendMessage(f,!0),c)return;const v=new tt((V,M)=>{let j=!1;const W=(le,ye)=>{j=!0,V({isSuccess:le==="success",message:ye||{}}),this.off(jt.WS_CLOSED,Y),this.off(jt.WS_RECONNECTING,Y),this.emit(jt.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(u),W);const Y=()=>{M(new Ie(K.WS_ABORT,"type: ".concat(t))),this.off(jt.WS_CLOSED,Y),this.off(jt.WS_RECONNECTING,Y),this.off("res-@".concat(u),W)};this.once(jt.WS_CLOSED,Y),this.once(jt.WS_RECONNECTING,Y),cs(te("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==g||j||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(jt.REQUEST_TIMEOUT,t,r))})});let S=null;try{S=await v}catch(V){if(this.connectionState===fr.CLOSED||t===kt.LEAVE)throw new Ie(K.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?V.throw():t===kt.JOIN||t===kt.REJOIN?null:(await E(),await this.request(t,r))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),I=Bb(R),D=new Ie(K.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:I.desc});return I.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(R,", message: ").concat(I.desc,", action: ").concat(I.action)),R===Ct.ERR_TOO_MANY_BROADCASTERS?((t===kt.JOIN||t===kt.REJOIN)&&(this.initError=D,this.close()),D.throw()):I.action==="failed"?D.throw():I.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===Ct.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Es.MULTI_IP)):this.reconnect(I.action,Es.SERVER_ERROR),t===kt.JOIN||t===kt.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new tt(o=>{const c=u=>{(!r||r(u))&&(this.off(t,c),o(u))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Vb.WRTC_STATS,r)}upload(t,r){const o={_type:t,_message:r};try{this.websocket.sendMessage(o)}catch{const u=te("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==fr.CONNECTED)return;const f=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(f._type,f._message)},te("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const o={_type:t,_message:r};this.websocket.sendMessage(o)}async sendExtensionMessage(t,r,o){return await this._external_signal.send(t,r,o)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new tt((r,o)=>{this.once(jt.WS_CONNECTED,()=>r(this.joinResponse)),this.once(jt.WS_CLOSED,()=>o(this.initError||new Ie(K.WS_ABORT))),this.connectionState=fr.CONNECTING,this.websocket.init(t).catch(o)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Vn.LEAVE,this.connectionState=fr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=dr(6,""),this._external_signal.clear(),this._external_signal=new n_(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(jt.ABORT_P2P_EXECUTION);const t=await ys(this,jt.REQUEST_JOIN_INFO),r=await this.request(kt.JOIN,t);if(!r)return this.emit(jt.REPORT_JOIN_GATEWAY,K.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(jt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleDataStream(t){try{var r;const o=Lg(t.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||Ze(r=Object.values(oi)).call(r,u._type)?(u._uid=t.uid,this._external_signal.onMessage(u)):this.emit(En.ON_DATA_STREAM,t)}catch{this.emit(En.ON_DATA_STREAM,t)}}handleNotification(t){x.debug("[".concat(this.clientId,"] receive notification: "),t);const r=Bb(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Vn.UID_BANNED),void this.close()):void this.reconnect(r.action,Es.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=te("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>te("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Es.TIMEOUT):this.request(kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-r;this.rttRolling.add(o),te("REPORT_STATS")&&this.send(kt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(qt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(jt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(qt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(qt.CLOSED,()=>{this.connectionState=fr.CLOSED}),this.websocket.on(qt.FAILED,()=>{this._disconnectedReason=Vn.NETWORK_ERROR,this.connectionState=fr.CLOSED}),this.websocket.on(qt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===fr.CONNECTED?this.connectionState=fr.RECONNECTING:this.connectionState=fr.CONNECTING}),this.websocket.on(qt.WILL_RECONNECT,(t,r,o)=>{t!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(t)}),this.websocket.on(qt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(jt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Ie&&t.code===K.UNEXPECTED_RESPONSE&&t.data.code===Ct.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Es.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Es.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(qt.REQUEST_NEW_URLS,(t,r)=>{ys(this,jt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const tae={name:"P2PChannel",create:function(e){let{store:t,statsCollector:r}=e;return new Zse(t,r)},createSubmodule:function(e){let{store:t,spec:r}=e;return new eae(r,t)}};function EW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function yW(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?EW(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):EW(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class nae{constructor(t){H(this,"sessionDesc",void 0),H(this,"localCapabilities",void 0),H(this,"rtpCapabilities",void 0),H(this,"candidates",void 0),H(this,"_originCandidates",void 0),H(this,"iceParameters",void 0),H(this,"dtlsParameters",void 0),H(this,"setup",void 0),H(this,"currentMidIndex",void 0),H(this,"cname",void 0),t=Pr(t);const{iceParameters:r,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:f,localCapabilities:g,sdkCodec:E,cname:v}=t,S=no(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Pr(c),this.iceParameters=r,this.dtlsParameters=o,this.setup=f,this.localCapabilities=g,this.cname=v;for(let R=0;R<S.mediaDescriptions.length;R++){const I=S.mediaDescriptions[R];if(I.attributes.iceUfrag=r.iceUfrag,I.attributes.icePwd=r.icePwd,I.attributes.fingerprints=o.fingerprints,I.attributes.candidates=c,I.attributes.setup=f,I.media.mediaType==="video"){I.media.fmts=u.videoCodecs.map(V=>V.payloadType.toString(10));let D=u.videoCodecs.filter(V=>{var M,j;return(M=V.rtpMap)===null||M===void 0?void 0:Ze(j=M.encodingName.toLowerCase()).call(j,E)});D.length===0&&(D=u.videoCodecs),I.attributes.payloads=D,I.attributes.extmaps=u.videoExtensions}I.media.mediaType==="audio"&&(I.media.fmts=u.audioCodecs.map(D=>D.payloadType.toString(10)),I.attributes.payloads=u.audioCodecs,I.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[R]=this.mungMediaDesc(I)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Tf(this.sessionDesc)}send(t,r,o){const{ssrcs:c,ssrcGroups:u}=zg(r,this.cname),f=this.sessionDesc.mediaDescriptions.find(v=>t===lt.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),g=c[0].attributes.label,E=c[0].attributes.mslabel;return f.attributes.ssrcs=f.attributes.ssrcs.concat(c),f.attributes.ssrcGroups=f.attributes.ssrcGroups.concat(u),{id:g,mslabel:E}}batchSend(t){return t.map(r=>{let{kind:o,ssrcMsg:c}=r;return this.send(o,c,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(r=>{const o=[],c=[],u=[];r.attributes.ssrcs.forEach(f=>{Ze(t).call(t,f.attributes.label||"")?u.push(f):o.push(f)}),r.attributes.ssrcGroups.forEach(f=>{var g;Ze(g=u.map(E=>E.ssrcId)).call(g,f.ssrcIds[0])||c.push(f)}),r.attributes.ssrcs=o,r.attributes.ssrcGroups=c})}mute(t){const r=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){const r=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}receive(t,r,o){t.forEach((c,u)=>{const f=c._mediaStreamTrack,g=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===f.kind),E=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[g],c);this.sessionDesc.mediaDescriptions[g]=E})}stopReceiving(t){}updateCandidates(t){const r=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(r.forEach(c=>{o.push(yW(yW({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),r.length!==0){switch(t){case js.TCP_RELAY:this.candidates=o;break;case js.UDP_TCP_RELAY:case js.RELAY:this.candidates=[...r,...o];break;default:this.candidates=r}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(t){t=Pr(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const r=[];for(let o=0;o<t;o++)r.push((this.currentMidIndex+o+1).toString(10));return r}mungRecvMediaDsec(t,r){const o=Pr(t);return sv(o,r),_1(o,r),o}updateRecvMedia(t,r){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===t);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],r);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,r,o){const c=this.sessionDesc.mediaDescriptions.find(f=>t===lt.VIDEO?f.attributes.mid==="video":f.attributes.mid==="audio");if(c){const f=c.attributes.ssrcs.find(g=>g.attributes.label===r);var u;f&&(f.attributes.label=o,(u=f.attributes.msid)===null||u===void 0||u.replace(r,o))}}mungMediaDesc(t){const r=Pr(t);return g1(r),function(o){const c=o.attributes.extmaps.find(u=>oI(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const f=u.rtcpFeedbacks.findIndex(g=>g.type==="transport-cc");f!==-1&&u.rtcpFeedbacks.splice(f,1)})}(r),r}getSSRC(t){for(const r of this.sessionDesc.mediaDescriptions)for(const o of r.attributes.ssrcs)if(o.attributes.label===t)return[o]}}var sr;function vW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function zI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?vW(Object(r),!0).forEach(function(o){H(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vW(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let rae=(sr=class Mw extends x9{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return Ze(r=Object.keys(jA)).call(r,t)}))]}constructor(t,r){super(t,r),H(this,"store",void 0),H(this,"peerConnection",void 0),H(this,"remoteSDP",void 0),H(this,"initialOffer",void 0),H(this,"statsFilter",void 0),H(this,"useRTX",!1),H(this,"localCapabilities",void 0),H(this,"localCandidateCount",0),H(this,"allCandidatesReceived",!1),H(this,"establishPromise",void 0),H(this,"mutex",void 0),this.store=r,this.mutex=new Ls("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(Mw.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Nk(this.peerConnection,te("STATS_UPDATE_INTERVAL"),void 0,Br()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Af(t.sdp),o=Wb(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:te("FILTER_VIDEO_FEC"),filterAudioFec:te("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=t,zI(zI({},r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:t.sdp})}catch(t){throw new Ie(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new nae(zI(zI({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteRTPCapabilities(t,r){throw new Ie(K.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,r){var o=this;return Ac(function*(){const c=yield In(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=t.map(I=>o.peerConnection.addTrack(I._mediaStreamTrack)),f=yield In(o.peerConnection.createOffer()),g=no(f.sdp),E=t.map(I=>{const D=I._mediaStreamTrack,V=g.mediaDescriptions.find(M=>M.attributes.mid===D.kind);if(!V)throw new Error("Cannot extract ssrc from mediaDescription.");return function(M,j,W){const Y=M.attributes.ssrcs.filter(ye=>ye.attributes.label===j),le=M.attributes.ssrcGroups;if(Y.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(le&&Y.length>1){const ye=le.find(Ee=>Ee.ssrcIds.indexOf(Y[0].ssrcId)!==-1);return ye?[{ssrcId:ye.ssrcIds[0],rtx:W?ye.ssrcIds[1]:void 0}]:[{ssrcId:Y[0].ssrcId}]}return[{ssrcId:Y[0].ssrcId}]}(V,D.id,o.useRTX)});let v;try{v=yield E}catch(I){throw u.forEach(D=>{_s()&&D.replaceTrack(null),o.peerConnection.removeTrack(D)}),I}const S=o.mungSendOfferSDP(f.sdp,t);o.remoteSDP.receive(t,r,v);const R=o.remoteSDP.toString();return yield In(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield In(o.applySendEncodings(u,t)),yield In(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),t.map((I,D)=>{const V=I._mediaStreamTrack.id;return{localSSRC:E[D],id:V}})}catch(u){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getSenders().filter(u=>{var f;return t.indexOf(((f=u.track)===null||f===void 0?void 0:f.id)||"")!==-1});if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(u=>{_s()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}}async receive(t,r,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:u,mslabel:f}=this.remoteSDP.send(t,r,c),g=new tt((S,R)=>{const I=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),D=V=>{const M=Nn();if((M.name==="Safari"&&Number(M.version)===11||_a())&&V.track.id!==u&&V.streams[0].id===f){var j;const W=V.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(t,u,V.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(I),void S(W)}if(V.track.id===u)return this.peerConnection.removeEventListener("track",D),clearTimeout(I),void S(V.track)};this.peerConnection.addEventListener("track",D)}),E=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:E});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await g,id:u}}catch(u){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter(o=>{var c;return t.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(r.length!==t.length)throw new Error("sender' length doesn't match mids' length.");r.map(o=>{if(_s()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter(u=>{var f;return t.indexOf(((f=u.track)===null||f===void 0?void 0:f.id)||"")!==-1});if(r.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");r.map(async u=>{if(_s()&&u.track)u.track.enabled=!0;else{const f=u.getParameters();f.encodings.forEach(g=>g.active=!0),await u.setParameters(f)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return Ac(function*(){const o=yield In(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=On().supportPCSetConfiguration;if(t===js.RELAY&&!c)return;if(c){const v=r.peerConnection.getConfiguration(),S=t===js.RELAY?"relay":"all";v.iceTransportPolicy!==S&&(x.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(S,"]")),v.iceTransportPolicy=S,r.peerConnection.setConfiguration(v))}t!==js.RELAY&&r.remoteSDP.updateCandidates(t);const u=yield In(r.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const f=Af(u.sdp),{remoteIceParameters:g}=yield f.iceParameters;r.remoteSDP.restartICE(g);const E=r.remoteSDP.toString();yield In(r.peerConnection.setLocalDescription(u)),yield In(r.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(c){x.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ie(K.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,r){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===t});o.length===1&&await this.applySendEncodings(o,[r])}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});o&&await o.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,r){throw new Ie(K.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new Ie(K.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},te("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Ob(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...Mw.turnServerConfigToIceServers(t.turnServer.servers)),te("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...Mw.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach(o=>{o.security?o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),r}async updateRtpSenderEncodings(t,r){var o;if(r||(r=this.peerConnection.getSenders().find(v=>{var S;return((S=v.track)===null||S===void 0?void 0:S.id)===t._mediaStreamTrack.id})),!r)return x.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!On().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const c={},u={};if(t instanceof Er)switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(te("DSCP_TYPE")&&Vh()){var f;const v=te("DSCP_TYPE");Ze(f=["very-low","low","medium","high"]).call(f,v)&&(u.networkPriority=v)}const g=r.getParameters(),E=(o=g.encodings)===null||o===void 0?void 0:o[0];E&&Object.assign(E,u),Object.assign(g,c),x.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await r.setParameters(g)}async applySendEncodings(t,r){try{if(!On().supportSetRtpSenderParameters||t.length!==r.length)return;for(let o=0;o<t.length;o++){const c=t[o],u=r[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r){const o=no(t);return r.forEach((c,u)=>{const f=c._mediaStreamTrack,g=o.mediaDescriptions.find(E=>E.attributes.mid===f.kind);g&&sv(g,c)}),Tf(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const r=this.remoteSDP.batchSend(t).map((u,f)=>{let{id:g,mslabel:E}=u;const{kind:v}=t[f];return new tt((S,R)=>{const I=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(g)))},1e4),D=V=>{const M=Nn();if(M.name==="Safari"&&Number(M.version)===11&&V.track.id!==g&&V.streams[0].id===E){var j;const W=V.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(v,g,V.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(I),void S({track:W,id:g})}if(V.track.id===g)return this.peerConnection.removeEventListener("track",D),clearTimeout(I),void S({track:V.track,id:g})};this.peerConnection.addEventListener("track",D)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await tt.all(r)}catch(r){throw new Ie(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r==null?void 0:r[0].ssrcId}setConfiguration(t){if(On().supportPCSetConfiguration){const r=Mw.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},gt(sr.prototype,"connect",[kc],Object.getOwnPropertyDescriptor(sr.prototype,"connect"),sr.prototype),gt(sr.prototype,"stopSending",[kc],Object.getOwnPropertyDescriptor(sr.prototype,"stopSending"),sr.prototype),gt(sr.prototype,"receive",[kc],Object.getOwnPropertyDescriptor(sr.prototype,"receive"),sr.prototype),gt(sr.prototype,"stopReceiving",[kc],Object.getOwnPropertyDescriptor(sr.prototype,"stopReceiving"),sr.prototype),gt(sr.prototype,"muteRemote",[kc],Object.getOwnPropertyDescriptor(sr.prototype,"muteRemote"),sr.prototype),gt(sr.prototype,"unmuteRemote",[kc],Object.getOwnPropertyDescriptor(sr.prototype,"unmuteRemote"),sr.prototype),gt(sr.prototype,"muteLocal",[kc],Object.getOwnPropertyDescriptor(sr.prototype,"muteLocal"),sr.prototype),gt(sr.prototype,"unmuteLocal",[kc],Object.getOwnPropertyDescriptor(sr.prototype,"unmuteLocal"),sr.prototype),gt(sr.prototype,"close",[kc],Object.getOwnPropertyDescriptor(sr.prototype,"close"),sr.prototype),gt(sr.prototype,"updateEncoderConfig",[kc],Object.getOwnPropertyDescriptor(sr.prototype,"updateEncoderConfig"),sr.prototype),gt(sr.prototype,"updateSendParameters",[kc],Object.getOwnPropertyDescriptor(sr.prototype,"updateSendParameters"),sr.prototype),gt(sr.prototype,"replaceTrack",[kc],Object.getOwnPropertyDescriptor(sr.prototype,"replaceTrack"),sr.prototype),gt(sr.prototype,"getRemoteSSRC",[kc],Object.getOwnPropertyDescriptor(sr.prototype,"getRemoteSSRC"),sr.prototype),sr);function kc(e,t,r){const o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(t));try{for(var f=arguments.length,g=new Array(f),E=0;E<f;E++)g[E]=arguments[E];return await o.apply(this,g)}finally{u()}},r}const iae={name:"PlanBConnection",create:function(e){let{store:t,spec:r}=e;return new rae(r,t)}},sae={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!On().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(zA.has(e)||!e.track)return;const r={track:e.track};if(Uh()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(f){return void x.error("create audio-encoded-streams error",f&&f.message)}const u=new TransformStream({transform(f,g){r.controller||(r.controller=g),e.track&&e.track.id!==r.track.id&&(x.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o));const E=t.metadata&&t.metadata();E?function(v,S){const{chunk:R,controller:I}=S,D=te("ENABLE_AUDIO_PTS_METADATA")?Hh.AUDIO_64_BIT_PTS:Hh.METADATA;R.data=function(V,M,j){const W=j.byteLength,Y=W+Zk+_9,le=$k+Jk+Y,ye=new ArrayBuffer(V.byteLength+le),Ee=new DataView(ye);Ee.setUint8(0,g9),Ee.setUint16(1,Y),Ee.setUint8(3,M),Ee.setUint16(4,W);for(let Ae=0;Ae<W;Ae++)Ee.setUint8(6+Ae,j[Ae]);const me=new Uint8Array(Ee.buffer);return me.set(new Uint8Array(V),le),me.buffer}(R.data,D,v),I.enqueue(R)}(E,{chunk:f,controller:g}):g.enqueue(f)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(_s()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=WA(),u=new MessageChannel;await new tt(g=>c.onmessage=E=>{E.data==="registered"&&g(void 0)});const f=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=f,await new tt(g=>c.onmessage=E=>{E.data==="started"&&g(void 0)}),u.port1.onmessage=g=>{var E;if(g.data.transformed&&e.track&&((E=e.track)===null||E===void 0?void 0:E.id)!==r.track.id)x.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o);else if(g.data.getMetadata){const v=t.metadata&&t.metadata();v&&u.port1.postMessage({metadata:v})}},r.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=zA.get(e);if(c){zA.delete(e);try{var u,f;(u=c.controller)===null||u===void 0||u.terminate(),(f=c.worker)===null||f===void 0||f.terminate()}catch(g){x.warning(g&&g.message)}}}zA.set(e,r),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!On().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if($A.has(e))return;const r={track:e.track,onMetadata:t.onMetadata};if(Uh()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");dk(Mn.CHROME,87,116)||(t.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(f){return void x.error("create audio-encoded-streams error",f&&f.message)}const u=new TransformStream({transform(f,g){r.controller||(r.controller=g),e.track&&e.track.id!==r.track.id&&(x.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o)),t.enableTopn?function(E,v,S){var R;const I=E9(new DataView(v.data));if(!I)return S.enqueue(v);const D=E.track.id;Une.set(D,E.track);const V=(R=I.tlv.find(ye=>ye.tag===Hh.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let M=0;typeof V=="number"&&(M=127-V);const j=Math.round(Math.pow(10,M/60)-1),{selected:W,speaker:Y}=function(ye,Ee){let me=Jy.get(ye);if(me||(me=function(Ae){const Pe=new v9;return Jy.set(Ae,Pe),hd||(hd=new Mne(te("TOPN_SILENCE_THRESHOLD")||500),hd.on("ActiveSpeakerChanged",$e=>{$e!=null&&(KA=$e)})),hd.addSpeakers([Pe]),Pe}(ye)),Jy.size<=S9)return{selected:!0,speaker:me};if(!hd)throw new Error("no active speaker detector");return hd.levelChanged(me.id,Ee),Hg=hd.loudest.map(Ae=>Ae.id),KA&&!Ze(Hg).call(Hg,KA)&&Hg.length>=S9&&Hg.pop(),{selected:Ze(Hg).call(Hg,me.id)||me.id===KA,speaker:me}}(E,j),le=function(ye,Ee,me){const Ae=pd.get(ye)||new jne(ye,Ee);return Ae.score=me,pd.set(ye,Ae),function(Pe){if(XA.set(Pe,!0),!QA)return void(QA=Date.now());const $e=Date.now();$e-QA>1e3&&(XA.get(Pe)?XA.set(Pe,!1):(T9(Pe),XA.delete(Pe)),QA=$e)}(ye),Ae}(D,E.track,Y.energyScore);le.addSample(W),le.active&&(v.data=I.frame.buffer,S.enqueue(v))}(e,f,g):t.enableMetadata?function(E,v,S){const R=E9(new DataView(E.data));if(!R)return v.enqueue(E);const I=R.tlv.find(D=>D.tag===Hh.METADATA||D.tag===Hh.AUDIO_64_BIT_PTS);I&&S&&I.value instanceof Uint8Array&&S(I.value),E.data=R.frame.buffer,v.enqueue(E)}(f,g,t.onMetadata):g.enqueue(f)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(_s()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=WA(),u=new MessageChannel;await new tt(g=>c.onmessage=E=>{E.data==="registered"&&g(void 0)});const f=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=f,await new tt(g=>c.onmessage=E=>{E.data==="started"&&g(void 0)}),u.port1.onmessage=g=>{var E;g.data.transformed&&e.track&&((E=e.track)===null||E===void 0?void 0:E.id)!==r.track.id?(x.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o)):g.data.metadata&&r.onMetadata&&r.onMetadata(g.data.metadata)},r.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){const u=$A.get(c);if(u){(function(E){const v=Jy.get(E);v&&(Jy.delete(E),hd&&(hd.removeSpeakers([v]),Jy.size===0&&(hd.destroy(),hd=null)))})(c),T9(c.track.id),$A.delete(c);try{var f,g;(f=u.controller)===null||f===void 0||f.terminate(),(g=u.worker)===null||g===void 0||g.terminate()}catch(E){x.warning(E&&E.message)}}}(e)}$A.set(e,r),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,t){if(!On().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(JA.has(e)||!e.track)return;const r={track:e.track};if(Uh()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(g){return void x.error("create video-encoded-streams error",g&&g.message)}const u=[];t.on("sei-to-send",g=>{u.push(g)});const f=new TransformStream({transform(g,E){r.controller||(r.controller=E),e.track&&e.track.id!==r.track.id&&(x.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o));const v=u.shift();v&&(g.data=function(S,R){const I=function(Y){const le=Y.length;let ye=[],Ee=0;for(;Ee<le;)Ee+2<le&&Y[Ee]===0&&Y[Ee+1]===0&&(Y[Ee+2]===0||Y[Ee+2]===1||Y[Ee+2]===2||Y[Ee+2]===3)?(ye.push(Y[Ee],Y[Ee+1],3,Y[Ee+2]),Ee+=3):(ye.push(Y[Ee]),Ee++);return new Uint8Array(ye)}(R),D=I.length,V=Math.floor(D/255),M=D%255,j=new Uint8Array(6+V+1+D+S.byteLength);j[0]=0,j[1]=0,j[2]=0,j[3]=1,j[4]=6,j[5]=101;let W=0;for(;W<V;)j[6+W]=255,W++;return j[6+W]=M,W++,j.set(I,6+W),j.set(new Uint8Array(S),6+W+D),j.buffer}(g.data,v)),E.enqueue(g)}});c.readable.pipeThrough(f).pipeTo(c.writable)}else{if(!_s())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=WA(),u=new MessageChannel;await new tt(g=>c.onmessage=E=>{E.data==="registered"&&g(void 0)});const f=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=f,await new tt(g=>c.onmessage=E=>{E.data==="started"&&g(void 0)}),t.on("sei-to-send",g=>{u.port1.postMessage({sei:g})}),u.port1.onmessage=g=>{var E;g.data.transformed&&e.track&&((E=e.track)===null||E===void 0?void 0:E.id)!==r.track.id&&(x.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o))},r.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=JA.get(e);if(c){JA.delete(e);try{var u,f;(u=c.controller)===null||u===void 0||u.terminate(),(f=c.worker)===null||f===void 0||f.terminate()}catch(g){x.warning(g&&g.message)}}}JA.set(e,r),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!On().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!e.track)return;if(Ub.has(e)){const c=Ub.get(e);return void(c&&(c.onSei=t.onSei))}const r={track:e.track,onSei:t.onSei};if(Uh()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(f){return void x.error("create video-encoded-streams error",f&&f.message)}const u=new TransformStream({transform(f,g){r.controller||(r.controller=g),e.track&&e.track.id!==r.track.id&&(x.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o));const E=function(v){const S=new DataView(v.data);let R=0;for(;R+4<v.data.byteLength;){if(S.getUint8(R+0)===0&&S.getUint8(R+1)===0&&S.getUint8(R+2)===0&&S.getUint8(R+3)===1&&S.getUint8(R+4)===6){let I=R+6,D=0,V=0;for(;(V=S.getUint8(I++))===255;)D+=255;D+=V;const M=Vne(v.data,I,D);return new Uint8Array(M)}R++}return null}(f);E&&r.onSei&&r.onSei(E),g.enqueue(f)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(_s()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=WA(),u=new MessageChannel;await new tt(g=>c.onmessage=E=>{E.data==="registered"&&g(void 0)});const f=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=f,await new tt(g=>c.onmessage=E=>{E.data==="started"&&g(void 0)}),u.port1.onmessage=g=>{var E;g.data.transformed&&e.track&&((E=e.track)===null||E===void 0?void 0:E.id)!==r.track.id?(x.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o)):g.data.sei&&r.onSei&&r.onSei(g.data.sei)},r.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){const u=Ub.get(c);if(u){Ub.delete(c);try{var f,g;(f=u.controller)===null||f===void 0||f.terminate(),(g=u.worker)===null||g===void 0||g.terminate()}catch(E){x.warning(E&&E.message)}}})(e)}Ub.set(e,r),e.track.addEventListener("ended",o)}},aae={name:"InterceptFrame",create:()=>sae};Ok(),Kn("PROCESS_ID","process-".concat(dr(8,""),"-").concat(dr(4,""),"-").concat(dr(4,""),"-").concat(dr(4,""),"-").concat(dr(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void x.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),r=Date.now();x.debug("Loading global parameters from cache",t),Object.keys(t).forEach(o=>{if(Object.prototype.hasOwnProperty.call(Tr,o)){const{value:c,expires:u}=t[o];if(u&&u<=r)return;ud[o]=c,Tr[o]=c}})}catch(t){x.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(ud.AREAS)&&ud.AREAS.length>0&&T1(ud.AREAS,!0);const SW=(e,t,r)=>{x.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Kn(e,t,r)};If(Nse,!1),If(xse,!1),If(uie,!1),If(Gse,!1),If(Cse,!1),If(tae,!1),If(iae,!1),If(aae,!1);const Ci=function(e){const t=new xr,r=e,o={getListeners:t.getListeners.bind(t),on:(c,u)=>(function(f,g){f===_u.SECURITY_POLICY_VIOLATION&&tG(g,!0)}(c,u),t.on.bind(t)(c,u)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return eG(eG({},r),o)}({__TRACK_LIST__:Hy,VERSION:Ic,BUILD:Pk,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:SW,getParameter:te,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const r=await async function(o){let c;return On().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(t);if(!r)return e;t.close(),t=null,e=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(r)}catch(t){throw new Te(K.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=St.reportApiInvoke(null,{name:fi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Gr.TRACER});let t=!1;try{const u=window.RTCPeerConnection,f=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,g=window.WebSocket;t=!!(u&&f&&g),t&&fk()&&b3(75)&&new u().close()}catch(u){return x.error("check system requirement failed: ",u),!1}let r=!1;const o=Nn();o.name===Mn.CHROME&&Number(o.version)>=58&&(ld.engine.name!=="WebKit"||function(){const u=Nn();if(IA()){if(u.os===Fi.MAC_OS)return!0;if(u.os===Fi.IOS){const f=ld.os.version&&ld.os.version.split(".");if(f&&Number(f[0])===14&&f[1]&&Number(f[1])>=3||f&&Number(f[0])>14)return!0}}return!1}())&&(r=!0),(o.name===Mn.FIREFOX&&Number(o.version)>=56||o.name===Mn.OPERA&&Number(o.version)>=45||o.name===Mn.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(_a()||gl())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||N3()||Nn().name===Mn.QQ)&&(r=!0),x.debug("checkSystemRequirements, api:",t,"browser",r);const c=t&&r;return e.onSuccess(c),c},getDevices:function(e){return sc.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return sc.getRecordingDevices(e)},getCameras:function(e){return sc.getCamerasDevices(e)},getElectronScreenSources:b4,getPlaybackDevices:function(e){return sc.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const r=dr(5,"client-"),o=St.reportApiInvoke(null,{id:r,name:fi.CREATE_CLIENT,options:[t],tag:Gr.TRACER});try{(function(c){Mi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Mi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Mi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&os(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&j3(c.turnServer),c.httpRetryConfig!==void 0&&M3(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&M3(c.websocketRetryConfig)})(t)}catch(c){throw o.onError(c),c}return(R3(16,0)||C3(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",x.debug("browser not support vp9, force use vp8")),Kn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),o.onSuccess(),new hie(Cl(Cl({forceWaitGatewayResponse:!0},t),{},{role:Ze(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),r)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=te("CAMERA_CAPTURE_CONFIG"),r=dr(8,"track-cam-"),o=St.reportApiInvoke(null,{id:r,tag:Gr.TRACER,name:fi.CREATE_CAM_VIDEO_TRACK,options:[Or({},e),t]});t&&(e.encoderConfig=t);const c=GA(e);let u=null;x.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{u=(await ic({video:c},r)).getVideoTracks()[0]||null}catch(g){throw o.onError(g),g}if(!u){const g=new Ie(K.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(g),g.throw(x)}if(e.optimizationMode&&Qk(r,u,e,yl(e.encoderConfig)),te("USE_STANDARD_BITRATE_DEFAULT")){const g=yl(e.encoderConfig);e.encoderConfig=g,delete g.bitrateMax,delete g.bitrateMin}const f=new Xk(u,e,c,e.scalabiltyMode?VA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return o.onSuccess(f.getTrackId()),x.info("create camera video success, trackId:",r),f},createCustomVideoTrack:function(e){const t=dr(8,"track-cus-"),r=St.reportApiInvoke(null,{id:t,tag:Gr.TRACER,name:fi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});te("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const o=new Er(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?VA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[er.CUSTOM_TRACK]);return r.onSuccess(o.getTrackId()),x.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const r=typeof t=="object"?function(I){return P4(I)}(t):void 0;r&&(t="auto");const o=dr(8,"track-scr-v-"),c=St.reportApiInvoke(null,{id:o,tag:Gr.TRACER,name:fi.CREATE_SCREEN_VIDEO_TRACK,options:[Or({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(I){const D={};I.screenSourceType&&(D.mediaSource=I.screenSourceType),I.extensionId&&Uh()&&(D.extensionId=I.extensionId);const{displaySurface:V,selfBrowserSurface:M,surfaceSwitching:j,systemAudio:W,preferCurrentTab:Y}=I;(Cb(107)||uk(107)||hk(93))&&(V&&(Mi(V,"displaySurface",["browser","window","monitor"]),D.displaySurface=V),M?(Mi(M,"selfBrowserSurface",["exclude","include"]),D.selfBrowserSurface=M):D.selfBrowserSurface="include",j&&(Mi(j,"surfaceSwitching",["exclude","include"]),D.surfaceSwitching=j)),(Cb(105)||uk(105)||hk(91))&&W&&(Mi(W,"systemAudio",["exclude","include"]),D.systemAudio=W),(Cb(94)||uk(94)||hk(80))&&Y&&(D.preferCurrentTab=!0),I.electronScreenSourceId&&(D.sourceId=I.electronScreenSourceId);const le=I.encoderConfig?Uk(I.encoderConfig):null;return D.mandatory={chromeMediaSource:"desktop",maxWidth:le?le.width:void 0,maxHeight:le?le.height:void 0},le&&(le.frameRate&&(typeof le.frameRate=="number"?(D.mandatory.maxFrameRate=le.frameRate,D.mandatory.minFrameRate=le.frameRate):(D.mandatory.maxFrameRate=le.frameRate.max||le.frameRate.ideal||le.frameRate.exact||void 0,D.mandatory.minFrameRate=le.frameRate.min||le.frameRate.ideal||le.frameRate.exact||void 0),D.frameRate=le.frameRate),le.width&&(D.width=le.width),le.height&&(D.height=le.height)),D}(e);let f=null,g=null;const E=On();if(!E.supportShareAudio&&t==="enable"){const I=new Ie(K.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(I),I.throw(x)}x.info("start create screen video track with config",e,"withAudio",t,"trackId",o);const v=E.supportShareAudio&&t!=="disable";try{const I=await ic({screen:u,screenAudio:v?r||!0:void 0},o);f=I.getVideoTracks()[0]||null,g=I.getAudioTracks()[0]||null}catch(I){throw c.onError(I),I}if(!f){const I=new Ie(K.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(I),I.throw(x)}if(!g&&t==="enable"){f&&f.stop();const I=new Ie(K.SHARE_AUDIO_NOT_ALLOWED);return c.onError(I),I.throw(x)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Qk(o,f,e,e.encoderConfig&&Uk(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const S=new Er(f,e.encoderConfig?Uk(e.encoderConfig):{},e.scalabiltyMode?VA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[er.SCREEN_TRACK]);if(!g)return c.onSuccess(S.getTrackId()),x.info("create screen video track success","video:",S.getTrackId()),S;const R=new Xr(g,void 0,dr(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create screen video track success","video:",S.getTrackId(),"audio:",R.getTrackId()),[S,R]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=te("CAMERA_CAPTURE_CONFIG"),o=dr(8,"track-mic-"),c=dr(8,"track-cam-"),u=St.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:Gr.TRACER,name:fi.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,r]});r&&(t.encoderConfig=r);const f=GA(t),g=k4(e);let E=null,v=null;x.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const I=await ic({audio:g,video:f},"".concat(o,"-").concat(c));E=I.getAudioTracks()[0],v=I.getVideoTracks()[0]}catch(I){throw u.onError(I),I}if(!E||!v){const I=new Ie(K.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(I),I.throw(x)}if(t.optimizationMode&&Qk(c,v,t,yl(t.encoderConfig)),te("USE_STANDARD_BITRATE_DEFAULT")){const I=yl(t.encoderConfig);t.encoderConfig=I,delete I.bitrateMax,delete I.bitrateMin}const S=new jb(E,e,g,o),R=new Xk(v,t,f,t.scalabiltyMode?VA(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,c);return u.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,R]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=dr(8,"track-mic-"),r=St.reportApiInvoke(null,{id:t,tag:Gr.TRACER,name:fi.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=k4(e);let c=null;x.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{c=(await ic({audio:o},t)).getAudioTracks()[0]||null}catch(f){throw r.onError(f),f}if(!c){const f=new Ie(K.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(f),f.throw(x)}const u=new jb(c,e,o,t);return r.onSuccess(u.getTrackId()),x.info("create microphone audio track success, trackId:",t),u},createCustomAudioTrack:function(e){const t=dr(8,"track-cus-"),r=St.reportApiInvoke(null,{id:t,tag:Gr.TRACER,name:fi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new Xr(e.mediaStreamTrack,e.encoderConfig?FA(e.encoderConfig):{},t,!1);return x.info("create custom audio track success with config",e,"trackId",o.getTrackId()),r.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:r,encoderConfig:o}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":c,cacheOnlineFile:r,encoderConfig:o},f=dr(8,"track-buf-"),g=St.reportApiInvoke(null,{id:f,tag:Gr.TRACER,name:fi.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(te("DISABLE_WEBAUDIO"))throw new Ie(K.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",f);const E=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,I){let D=null;if(typeof R=="string"){const M=v5.get(R);if(M)return x.debug("use cached audio resource: ",R),M;try{D=(await dd(()=>ka.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new Ie(K.FETCH_AUDIO_FILE_FAILED,j.toString())}}else D=await new tt((j,W)=>{const Y=new FileReader;Y.onload=le=>{le.target?j(le.target.result):W(new Ie(K.READ_LOCAL_AUDIO_FILE_ERROR))},Y.onerror=()=>{W(new Ie(K.READ_LOCAL_AUDIO_FILE_ERROR))},Y.readAsArrayBuffer(R)});const V=await function(M){const j=Ky();return new tt((W,Y)=>{j.decodeAudioData(M,le=>{W(le)},le=>{Y(new Ie(K.DECODE_AUDIO_FILE_FAILED,le.toString()))})})}(D);return typeof R=="string"&&I&&v5.set(R,V),V}(c,r)}catch(R){return g.onError(R),R.throw(x)}const v=new Dne(c),S=new One(E,v,o?FA(o):{},f);return x.info("create buffer source audio track success, trackId:",f),g.onSuccess(S.getTrackId()),S},setAppType:function(e){if(x.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw x.debug("Invalid appType"),new Te(K.INVALID_PARAMS,"invalid app type",e);Kn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){x.setLogLevel(e)},enableLogUpload:function(){te("USE_NEW_LOG")?Kn("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){te("USE_NEW_LOG")?Kn("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new S6},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=St.reportApiInvoke(null,{tag:Gr.TRACER,name:fi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Xr||e instanceof $y)){const E=new Te(K.INVALID_TRACK,"the parameter is not a audio track");return r.onError(E),E.throw()}t&&t<1e3&&(t=1e3);const o=e instanceof Xr?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,f=c;const g=Date.now();return new tt(E=>{const v=setInterval(()=>{const S=e.getVolumeLevel();u=S>u?S:u,f=S<f?S:f;const R=u-f>1e-4,I=Date.now()-g;if(R||I>t){clearInterval(v);const D=R,V={duration:I,deviceLabel:o,maxVolumeLevel:u,result:D};x.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(V))),r.onSuccess(V),E(D)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=St.reportApiInvoke(null,{tag:Gr.TRACER,name:fi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Er||e instanceof Qy)){const R=new Te(K.INVALID_TRACK,"the parameter is not a video track");return r.onError(R),R.throw()}t&&t<1e3&&(t=1e3);const o=e instanceof Er?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(_s()||IA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const f=document.createElement("canvas");f.width=160,f.height=120;let g=0,E=0;try{const R=Date.now();g=await function(I,D,V,M){let j,W=0,Y=null;return new tt((le,ye)=>{function Ee(){W>M&&j&&(j(),le(W));const me=V.getContext("2d");if(!me){const $e=new Te(K.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error($e.toString()),void ye($e)}me.drawImage(I,0,0,160,120);const Ae=me.getImageData(0,0,V.width,V.height),Pe=Math.floor(Ae.data.length/3);if(Y){for(let $e=0;$e<Pe;$e+=3)if(Ae.data[$e]!==Y[$e])return W+=1,void(Y=Ae.data);Y=Ae.data}else Y=Ae.data}setTimeout(()=>{j&&(j(),le(W))},D),j=Gk(()=>{Ee()},30)})}(u,t,f,4),E=Date.now()-R}catch(R){throw r.onError(R),R}$re===Mn.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const v=g>4,S={duration:E,changedPicNum:g,deviceLabel:o,result:v};return x.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),r.onSuccess(S),v},setArea:T1,audioElementPlayCenter:La,resumeAudioContext:function(){La.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){fie.processExternalMediaAEC(e)},registerExtensions:function(e){const t=te("PLUGIN_INFO")||[];e.forEach(r=>{"name"in r&&!Ze(t).call(t,r.name)&&t.push(r.name);const o=r;o.__registered__=!0,o.logger.hookLog=x.extLog,o.reporter.hookApiInvoke=St.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=te(c)})}),SW("PLUGIN_INFO",t)},ChannelMediaRelayError:ev,ChannelMediaRelayEvent:Wh,ChannelMediaRelayState:ro,RemoteStreamFallbackType:bne,RemoteStreamType:Tne,ConnectionDisconnectedReason:Vn,AudienceLatencyLevelType:Zte,AREAS:jn,preload:async function(e,t,r,o){return Y6(e,t,r,o)}});return Object.defineProperties(Ci,{onAudioAutoplayFailed:{get:()=>ac.onAudioAutoplayFailed,set:e=>{ac.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>ac.onAutoplayFailed,set:e=>{ac.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ci._onSecurityPolicyViolation,set(e){Ci._onSecurityPolicyViolation=e,tG(e)}},__CLIENT_LIST__:{get:()=>te("SHOW_GLOBAL_CLIENT_LIST")?Gg:[]}}),sc.on(Vg.CAMERA_DEVICE_CHANGED,e=>{x.info("camera device changed",JSON.stringify(e)),Ci.onCameraChanged&&Ci.onCameraChanged(e),Ci.safeEmit(_u.CAMERA_CHANGED,e)}),sc.on(Vg.RECORDING_DEVICE_CHANGED,e=>{x.info("microphone device changed",JSON.stringify(e)),Ci.onMicrophoneChanged&&Ci.onMicrophoneChanged(e),Ci.safeEmit(_u.MICROPHONE_CHANGED,e)}),sc.on(Vg.PLAYOUT_DEVICE_CHANGED,e=>{x.debug("playout device changed",JSON.stringify(e)),Ci.onPlaybackDeviceChanged&&Ci.onPlaybackDeviceChanged(e),Ci.safeEmit(_u.PLAYBACK_DEVICE_CHANGED,e)}),La.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),ac.onAudioAutoplayFailed&&ac.onAudioAutoplayFailed()},Xn.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),ac.onAudioAutoplayFailed&&ac.onAudioAutoplayFailed(),Ci.safeEmit(_u.AUTOPLAY_FAILED)}),Xn.on(ds.STATE_CHANGE,(e,t)=>{x.info("audio context state changed: ".concat(t," => ").concat(e)),Ci.onAudioContextStateChanged&&Ci.onAudioContextStateChanged(e,t),Ci.safeEmit(_u.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),mi.on(My.NETWORK_STATE_CHANGE,(e,t)=>{x.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Ci),Ci})}(rO)),rO.exports}var Pve=xve();const fM=_0(Pve);function kve(s){return U_({attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{id:"Microphone_Off"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{d:"M16.5,7.046v4.72a.5.5,0,0,1-1,0V9.946H14a.5.5,0,0,1,0-1h1.5v-2H13.57a.5.5,0,0,1,0-1h1.87a3.23,3.23,0,0,0-.2-.72,3.533,3.533,0,0,0-6.16-.59c-.36.53-1.23.03-.87-.5a4.509,4.509,0,0,1,7.71.21A5.255,5.255,0,0,1,16.5,7.046Z"},child:[]},{tag:"path",attr:{d:"M20.14,19.436q-2.625-2.64-5.27-5.28Q10.685,9.986,6.51,5.8c-.65-.64-1.3-1.29-1.94-1.94a.5.5,0,0,0-.71.71Q5.69,6.381,7.5,8.206v3.92a4.591,4.591,0,0,0,3.59,4.61,4.629,4.629,0,0,0,3.9-1.04c.24.24.48.47.71.71a5.252,5.252,0,0,1-6.62.67,5.2,5.2,0,0,1-2.05-2.76,7.608,7.608,0,0,1-.24-2.33v-2.2a.5.5,0,0,0-1,0,15.463,15.463,0,0,0,.34,4.99,6.276,6.276,0,0,0,5.37,4.17v1.99H8a.5.5,0,0,0,0,1h8a.5.5,0,0,0,0-1H12.5v-2a6.118,6.118,0,0,0,3.91-1.82l1.08,1.08c.65.65,1.3,1.3,1.95,1.94A.5.5,0,0,0,20.14,19.436Zm-11.2-5.42a3.991,3.991,0,0,1-.44-2.03V9.206l5.77,5.77A3.521,3.521,0,0,1,8.94,14.016Z"},child:[]}]}]}]})(s)}function Lve(s){return U_({attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{id:"Volume_High"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{d:"M13.816,19.937a1.446,1.446,0,0,1-.717-.194L9.43,17.623a3.257,3.257,0,0,0-1.625-.434H4.439a2.379,2.379,0,0,1-2.375-2.376V9.187A2.378,2.378,0,0,1,4.439,6.812H7.805A3.257,3.257,0,0,0,9.43,6.376L13.1,4.259A1.437,1.437,0,0,1,15.255,5.5V18.5a1.424,1.424,0,0,1-.718,1.245A1.445,1.445,0,0,1,13.816,19.937ZM4.439,7.812A1.377,1.377,0,0,0,3.064,9.187v5.626a1.378,1.378,0,0,0,1.375,1.376H7.805a4.254,4.254,0,0,1,2.125.569L13.6,18.876a.439.439,0,0,0,.657-.38V5.5a.438.438,0,0,0-.657-.379L9.93,7.242a4.251,4.251,0,0,1-2.125.57Z"},child:[]},{tag:"path",attr:{d:"M18.407,6.262a7.79,7.79,0,0,1,.021,11.476c-.474.437.235,1.143.707.707a8.793,8.793,0,0,0-.021-12.89c-.474-.434-1.184.272-.707.707Z"},child:[]},{tag:"path",attr:{d:"M16.91,9.031a4.021,4.021,0,0,1,.012,5.938c-.474.438.234,1.143.707.707a5.025,5.025,0,0,0-.012-7.352c-.474-.434-1.183.272-.707.707Z"},child:[]}]}]}]})(s)}const Mve=({isCameraOn:s,isMuted:n,patientInfo:i,remoteAudioOn:a,ObjNavigate:l})=>{var be,ee;const p=es();Wi();const _=i?i.charAt(0).toUpperCase():"",{channelDetails:T}=hr(Q=>Q.info),{invitedUser:w}=hr(({info:Q})=>Q),C=(T==null?void 0:T.appId)||(w==null?void 0:w.appId)||(l==null?void 0:l.AppID),O=(T==null?void 0:T.token)||(w==null?void 0:w.token)||(l==null?void 0:l.Token),k=(T==null?void 0:T.channelName)||(w==null?void 0:w.channelName)||(l==null?void 0:l.ChName),U=(T==null?void 0:T.uid)||(w==null?void 0:w.uid)||(l==null?void 0:l.UDID),G=JSON.parse(localStorage.getItem("doctor-app")),z=(be=G==null?void 0:G.doctorData)!=null&&be.name?(ee=G==null?void 0:G.doctorData)==null?void 0:ee.name.charAt(0).toUpperCase():"",J=F.useRef(null),X=F.useRef(null),ie=F.useRef(null),oe=F.useRef(null),[ce,_e]=F.useState({}),se=F.useCallback(Q=>{const q=`Remote User ${Q}`,ae=q.charAt(0).toUpperCase();return{name:q,initial:ae}},[]);return F.useEffect(()=>(J.current||(J.current=fM.createClient({mode:"rtc",codec:"vp8"})),(async()=>{if(!C||!k||!O){console.error("Agora Error: Missing APP_ID, CHANNEL, or TOKEN. Cannot join."),p("/doctor-home");return}try{await J.current.join(C,k,O,U),X.current=await fM.createMicrophoneAudioTrack(),ie.current=await fM.createCameraVideoTrack(),oe.current?ie.current.play(oe.current):console.warn("Local video ref is not available. Cannot play local video."),await J.current.publish([X.current,ie.current]),J.current.remoteUsers.forEach(async q=>{var fe;const{name:ae,initial:re}=se(q.uid);if(_e(pe=>({...pe,[q.uid]:{...q,audioMuted:!q.hasAudio,videoMuted:!q.hasVideo,remoteDisplayName:ae,remoteDisplayInitial:re}})),q.hasAudio&&(await J.current.subscribe(q,"audio"),(fe=q.audioTrack)==null||fe.play(),!a&&q.audioTrack&&q.audioTrack.setVolume(0)),q.hasVideo){await J.current.subscribe(q,"video");const pe=`remote-player-${q.uid}`;setTimeout(()=>{var Re;if(document.getElementById(pe)){(Re=q.videoTrack)==null||Re.play(pe);const Ge=document.getElementById(pe).querySelector("video");Ge&&(Ge.style.width="100%",Ge.style.height="100%",Ge.style.objectFit="cover")}},300)}}),J.current.on("user-published",async(q,ae)=>{var pe;await J.current.subscribe(q,ae);const{name:re,initial:fe}=se(q.uid);if(_e(Re=>({...Re,[q.uid]:{...Re[q.uid],...q,audioMuted:!q.hasAudio,videoMuted:!q.hasVideo,remoteDisplayName:re,remoteDisplayInitial:fe}})),ae==="video"){const Re=`remote-player-${q.uid}`;setTimeout(()=>{var Ge;if(document.getElementById(Re)){(Ge=q.videoTrack)==null||Ge.play(Re);const ve=document.getElementById(Re).querySelector("video");ve&&(ve.style.width="100%",ve.style.height="100%",ve.style.objectFit="cover")}},300)}else ae==="audio"&&((pe=q.audioTrack)==null||pe.play(),!a&&q.audioTrack&&q.audioTrack.setVolume(0))}),J.current.on("user-updated",(q,ae)=>{_e(re=>{const fe=re[q.uid]||{},pe=fe.videoMuted&&q.hasVideo,Re={...fe,...q,audioMuted:!q.hasAudio,videoMuted:!q.hasVideo};if(ae==="video"&&q.hasVideo&&q.videoTrack&&pe){const Ge=`remote-player-${q.uid}`;setTimeout(()=>{if(document.getElementById(Ge)){q.videoTrack.play(Ge);const ve=document.getElementById(Ge).querySelector("video");ve&&(ve.style.width="100%",ve.style.height="100%",ve.style.objectFit="cover")}},300)}return{...re,[q.uid]:Re}})}),J.current.on("user-unpublished",(q,ae)=>{ae==="video"&&q.videoTrack&&q.videoTrack.stop(),_e(re=>{const fe={...re};return fe[q.uid]&&(ae==="audio"?fe[q.uid].audioMuted=!0:ae==="video"&&(fe[q.uid].videoMuted=!0)),fe})}),J.current.on("user-left",async q=>{_e(ae=>{const re={...ae};return delete re[q.uid],re})})}catch(q){console.error("Agora Operation Error:",q)}})(),()=>{(async()=>{X.current&&(X.current.close(),X.current=null),ie.current&&(ie.current.close(),ie.current=null),J.current&&J.current.connectionState==="CONNECTED"&&await J.current.leave(),J.current=null,_e({})})()}),[C,k,O,U,se]),F.useEffect(()=>{ie.current&&ie.current.setEnabled(s)},[s]),F.useEffect(()=>{X.current&&X.current.setEnabled(!n)},[n]),F.useEffect(()=>{J.current&&J.current.remoteUsers.forEach(Q=>{var ae,re;const q=Q.audioTrack;q&&(a?(ae=q.setVolume)==null||ae.call(q,100):(re=q.setVolume)==null||re.call(q,50))})},[a]),m.jsxs("div",{style:{position:"relative",width:"100%",height:"580px",backgroundColor:"#000",display:"flex",flexDirection:"column",overflow:"hidden"},children:[m.jsx("div",{id:"remote-video-grid-container",style:{flexGrow:1,backgroundColor:"#0c0d0f",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",overflowY:"auto",justifyContent:"center",alignContent:"center",width:"100%",height:"580px"},children:Object.entries(ce).map(([Q,q])=>m.jsxs("div",{id:`remote-player-${q.uid}`,style:{aspectRatio:"4/3",position:"relative",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"2em",fontWeight:"bold",textAlign:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.4)",backgroundColor:"#0c0d0f",width:"100%",height:"580px"},children:[q.videoMuted?m.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:3},children:_?m.jsx("span",{style:{fontSize:"3em"},children:_}):m.jsx("span",{children:"Video Off"})}):m.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"#0c0d0f"}}),q.audioMuted&&m.jsx("div",{style:{position:"absolute",top:"20px",right:"240px",backgroundColor:"rgba(255, 0, 0, 0.7)",color:"#fff",padding:"4px 8px",borderRadius:"4px",fontSize:"0.8em",zIndex:4},children:m.jsx(kve,{})})]},Q))}),m.jsx("div",{style:{position:"absolute",bottom:"120px",right:"20px",width:"180px",height:"240px",backgroundColor:"#0c0d0f",borderRadius:"8px",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"3em",fontWeight:"bold",zIndex:10,boxShadow:"0 4px 12px rgba(0,0,0,0.6)",border:"2px solid rgba(255,255,255,0.3)"},children:s?m.jsx("div",{ref:oe,style:{width:"100%",height:"100%",backgroundColor:"#222"}}):m.jsx("div",{style:{borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"48px",fontWeight:"bold",zIndex:2},children:z&&m.jsx("span",{style:{fontSize:"1em"},children:z})})})]})},jve=()=>{var Un,Li;const s=es(),n=localStorage.getItem("doctor-app");console.log(n,"doctorDatadoctorDatadoctorData");const[i,a]=F.useState(!1),[l,p]=F.useState(!1),[_,T]=F.useState(!1),[w,C]=F.useState(!0),O=()=>{p(vt=>!vt)},[k,U]=F.useState(!1),G=F.useRef(null),z=Wi(),{id:J,patientId:X,time_period:ie,ObjNavigate:oe,userRole:ce}=z.state||{};console.log(J,X,ie,oe,ce,"user role of this ***");const _e=F.useRef([]),se=Pi(),{patientProfileData:be}=hr(vt=>vt.patientProfile),{invitedUser:ee}=hr(({info:vt})=>vt);console.log(ee,"data comes from invited user"),F.useEffect(()=>{(!J||!X||!ie)&&s("/doctor-home")},[z]);const[Q,q]=F.useState("");F.useEffect(()=>{const vt=ie==null?void 0:ie.split(" - "),Bt=vt==null?void 0:vt[0],bt=vt==null?void 0:vt[1];if(!Bt)return;const[rn,Qn]=Bt==null?void 0:Bt.split(":");let Ar=parseInt(rn,10);const $r=parseInt(Qn,10),br=bt.slice(-2);br==="PM"&&Ar!==12?Ar+=12:br==="AM"&&Ar===12&&(Ar=0);const[ji,ts]=bt.slice(0,-2).split(":");let ns=parseInt(ji,10);const Ra=parseInt(ts,10),Cs=bt.slice(-2);Cs==="PM"&&ns!==12?ns+=12:Cs==="AM"&&ns===12&&(ns=0);let Ca=!1;const je=()=>{const cn=new Date,Yn=new Date(cn.getFullYear(),cn.getMonth(),cn.getDate(),Ar,$r,0),Ke=new Date(cn.getFullYear(),cn.getMonth(),cn.getDate(),ns,Ra,0),Yt=new Date(Ke.getTime()+5*60*1e3),un=Ke;if(!Ca&&cn.getTime()>=un.getTime()&&(ct.success("Note: This call will automatically end in 5 minutes. Please wrap up your discussion accordingly!",{duration:1e4}),Ca=!0),cn.getTime()>=Yt.getTime()){window.location.href="/doctor-home";return}let tn=cn.getTime()-Yn.getTime();if(tn<0)q("00:00:00");else{const yn=Math.floor(tn/1e3),ri=Math.floor(yn/3600),ln=Math.floor(yn%3600/60),or=yn%60,pr=String(ri).padStart(2,"0"),qr=String(ln).padStart(2,"0"),rs=String(or).padStart(2,"0");ri>0?q(`${pr}:${qr}:${rs}`):q(`${qr}:${rs}`)}};je();const sn=setInterval(je,1e3);return()=>clearInterval(sn)},[ie]),F.useEffect(()=>{X&&se(Pv({patientId:X}))},[se,X]);const ae=(be==null?void 0:be.basic_information)||((Un=ee==null?void 0:ee.data)==null?void 0:Un.basic_information)||{},{completeAssignedPrescription:re,loading:fe,loading2:pe,error:Re,medicineSearch:Ge,user:ve}=hr(vt=>vt.user),[Ne,Ce]=F.useState([]),[Ue,de]=F.useState(""),[De,xe]=F.useState(""),[Xe,ut]=F.useState(""),[Pt,It]=F.useState(!1),[zt,$t]=F.useState({}),[Tt,on]=F.useState(null),[fn,Ut]=F.useState([]),[yt,an]=F.useState([{medicineName:"",dosage:"",frequency:"",duration:"",suggestions:[],showSuggestion:!1,isValid:!1}]),[Dt,wt]=F.useState(0);F.useEffect(()=>{const vt=setInterval(()=>{wt(Bt=>Bt+1)},1e3);return()=>clearInterval(vt)},[]);const[rt,xt]=F.useState({});F.useEffect(()=>{if(Ge&&Tt!==null){const vt=[...yt];vt[Tt].suggestions=Ge,an(vt),xt(Bt=>({...Bt,[Tt]:Ge}))}},[Ge]),F.useEffect(()=>{function vt(Bt){It(!1);const bt=[...yt];let rn=!1;yt.forEach((Qn,Ar)=>{const $r=_e.current[Ar];$r&&!$r.contains(Bt.target)&&Qn.suggestions.length>0&&(bt[Ar].suggestions=[],rn=!0)}),rn&&an(bt)}return document.addEventListener("mousedown",vt),()=>{document.removeEventListener("mousedown",vt)}},[yt]);const Mt=()=>T(vt=>!vt),Bn=()=>{C(vt=>!vt)},ki=vt=>{ce==="admin"?(s("/login"),localStorage.removeItem("anyoneJoin"),se(yK(null))):s("/doctor-home",{state:{appointmentIdd:vt,modaleOpen:!0}})},zi=F.useCallback(async()=>{if(!J)return;const vt=JSON.parse(localStorage.getItem("doctor-app")),Bt=vt==null?void 0:vt.token,bt={appointment_id:J};try{const rn=await vi.get(`${li}api/doctor/prescriptions/is-completed`,{params:bt,headers:{Authorization:`Bearer ${Bt}`,"Content-Type":"application/json"}});rn.data&&rn.data.data?U(rn.data.data.is_done):(U(!1),console.warn("API response.data.data is missing or unexpected."))}catch(rn){console.error("Error checking prescription status on focus:",rn),U(!1)}},[J]);F.useEffect(()=>{zi()},[zi]),F.useEffect(()=>{const vt=()=>{zi()};return window.addEventListener("focus",vt),()=>{window.removeEventListener("focus",vt)}},[zi]);const Cr={opacity:k?.5:1,cursor:k?"not-allowed":"pointer"};return m.jsx("main",{className:"doctor-panel video-call-pg",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(za,{})}),m.jsx("div",{className:"video-call-screen",children:m.jsxs("div",{className:"vdo-call-scrn-row row",children:[m.jsx("div",{className:"vdo-call-scrn-left-wrp col-lg-6",children:m.jsx("div",{className:"vdoclscrn-left",children:m.jsxs("div",{className:"vdo-screen",children:[m.jsxs("div",{className:"vdo-screen-controls",children:[m.jsxs("div",{className:"vdoscrn-controls-head",children:[m.jsx("h1",{children:ae==null?void 0:ae.name}),m.jsxs("div",{className:"vdoscrn-status-time-wrp",children:[m.jsx("span",{className:"vdoscrn-status live",children:"LIVE"}),m.jsx("span",{className:"vdoscrnduration-time",children:Q})]})]}),m.jsx("div",{className:"vdoscrn-controls-body",children:m.jsxs("div",{className:"vdoscrn-volume-con",children:[m.jsx("img",{src:"./images/speaker-icon.svg",alt:"Icon"}),m.jsx("input",{type:"range"})]})}),m.jsxs("div",{className:"vdoscrn-controls-ftr",style:{marginLeft:100},children:[m.jsxs("div",{className:"vdoscrn-action-controls",children:[m.jsx("button",{className:"vdo-toggle-btn",onClick:Bn,style:{marginTop:-30},children:m.jsx("img",{src:w?"./images/video-cam-icon.svg":"./images/video-camera-off-icon.svg",alt:"Camera Icon",style:{filter:w?"none":"invert(100%)"}})}),m.jsx("button",{className:"vdo-call-end-btn",onClick:()=>ki(J),style:{borderRadius:"50%",padding:"10px",marginTop:-30},children:m.jsx("img",{src:"./images/call-icon.svg",alt:"Call End Icon"})}),m.jsx("button",{className:"vdo-mute-toggle-btn",onClick:Mt,style:{marginTop:-30},children:m.jsx("img",{src:_?"./images/mic-off.svg":"./images/mic-icon.svg",alt:"Mic Icon",style:{filter:_?"invert(100%)":"none"}})})]}),m.jsx("div",{className:"doc-vdo-scrn"})]})]}),m.jsx("button",{onClick:O,style:{position:"absolute",bottom:"40px",left:"20px",right:"20px",zIndex:9999999999999,color:"white",border:"none",borderRadius:"50%",width:"50px",height:"50px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:l?"0 0 10px #28a745":"0 2px 5px rgba(0,0,0,0.5)",backgroundColor:l?"#28a745":"rgba(255,255,255,0.2)",transition:"all 0.3s ease"},title:l?"Turn off Volume Boost":"Boost Volume",children:m.jsx(Lve,{size:24})}),m.jsx("div",{className:"patient-vdo-screen",children:m.jsx(Mve,{isCameraOn:w,isMuted:_,patientInfo:ae.name||((Li=ee==null?void 0:ee.basic_information)==null?void 0:Li.name),videoStreamRef:G,remoteAudioOn:l,ObjNavigate:oe})})]})})}),m.jsx("div",{className:" col-lg-6",children:fe?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsx("form",{children:m.jsx("div",{className:"vdoclscrn-patient-details-wrp-inr",children:m.jsxs("div",{className:"vdoclscrn-patient-details",children:[m.jsxs("div",{className:"vdoclscrnpd-wrp",children:[m.jsx("h2",{children:"Patient Details:"}),m.jsx("div",{className:"vdoclscrnpd",children:[{label:"Patient Name",value:ae.name||"N/A"},{label:"Age",value:ae.age||"N/A"},{label:"Gender",value:ae.gender?ae.gender.charAt(0).toUpperCase()+ae.gender.slice(1):"N/A"},{label:"Height",value:ae.height||"N/A"},{label:"Weight",value:ae.weight||"N/A"},{label:"Contact No.",value:ae.phone_no||"N/A"}].map((vt,Bt)=>m.jsxs("div",{className:"vdoclscrnpd-grp",children:[m.jsx("span",{className:"vdoclscrnpd-label",children:vt.label}),m.jsx("span",{className:"vdoclscrnpd-val",children:vt.value})]},Bt))})]}),m.jsx("div",{className:"mt-4 text-right",children:m.jsx("a",{href:`/PrescriptiveDoctor?id=${J}&patientId=${X}`,target:"_blank",rel:"noopener noreferrer",onClick:vt=>{k&&vt.preventDefault()},children:ce==="admin"?null:m.jsx("button",{type:"button",className:"orange-btn",style:Cr,disabled:k,children:"Go for Prescription"})})})]})})})})]})})]})})};function Uve(){const s=es();return F.useEffect(()=>{localStorage.getItem("doctor-app")?(ct.error("The URL you entered does not exist. Redirected to home."),s("/doctor-home",{replace:!0})):(ct.error("Please login first"),s("/",{replace:!0}))},[s]),null}const Vve=()=>{const s=Pi(),{pendingPrescription:n,loading:i,error:a}=hr(X=>X.user),[l,p]=F.useState(1),_=5;F.useEffect(()=>{s(DN())},[s]);const T=n||[],w=Math.ceil(T.length/_),C=l*_,O=C-_,k=T.slice(O,C),U=X=>{p(X)},G=()=>l<w&&p(l+1),z=()=>l>1&&p(l-1),J=X=>{if(!X)return"N/A";const ie=new Date().getFullYear(),oe=`${X} ${ie}`,ce=new Date(oe);if(isNaN(ce))return"Invalid Date";const _e=String(ce.getDate()).padStart(2,"0"),se=String(ce.getMonth()+1).padStart(2,"0"),be=ce.getFullYear();return`${_e}/${se}/${be}`};return m.jsx(m.Fragment,{children:m.jsx("main",{className:"doctor-panel",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(za,{})}),i?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"doc-panel-body",children:[m.jsx("div",{className:"docpnl-sec-head",children:m.jsx("h1",{className:"h2-title",children:"Pending Prescriptions"})}),m.jsx("div",{className:"pending-prescriptions-wrp",children:m.jsxs("div",{className:"my-appointments-inr",children:[m.jsx("div",{className:"myapintmnt-content-tab pending",children:m.jsx("div",{className:"pending-presc-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Patient Name"}),m.jsx("th",{children:"Symptom Upload Date"}),m.jsx("th",{children:"Disease"}),m.jsx("th",{children:"View Details"})]})}),m.jsxs("tbody",{children:[k.length==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center"},children:i?"Loading...":m.jsx("span",{style:{fontWeight:"400",fontSize:18},children:"No data found"})})}),k.map((X,ie)=>m.jsxs("tr",{children:[m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:String((l-1)*_+ie+1).padStart(2,"0")}),m.jsxs("td",{style:{textAlign:"left",maxWidth:"287px",paddingLeft:"165px"},children:[m.jsx(mn,{to:"/patient-profile",state:{patientId:X.patient_id},className:"no-underline-link",style:{display:"inline-block ",fontSize:20,marginLeft:10},children:X.patient_name}),(X==null?void 0:X.is_referred_patient)==!1?m.jsxs("div",{className:"time",style:{color:"#199FD9",marginLeft:10,fontWeight:"bold"},children:[m.jsxs("span",{style:{color:"black",fontWeight:"bold"},children:["(DS Code:"," "]}),X.ds_code,m.jsx("span",{children:")"})]}):m.jsxs("div",{className:"time",style:{color:"#199FD9",fontWeight:"bold"},children:[m.jsx("span",{style:{color:"black",fontWeight:"bold"},children:"(Referred by DS Code:"}),X.ds_code,m.jsx("span",{children:")"})]})]}),m.jsxs("td",{children:[m.jsx("div",{className:"date",style:{color:"#199FD9",fontSize:20},children:J(X.date)}),m.jsx("div",{className:"time",style:{color:"#199FD9"},children:X.time})]}),m.jsx("td",{style:{color:"#199FD9"},children:X.diseaseName}),m.jsx("td",{children:m.jsx(mn,{to:"/patient-details",state:{id:X.appointment_id,patientId:X.patient_id,referrerDscode:X.ds_code,referrer:X.referred_patient_name},style:{fontSize:20},children:"View"})})]},ie))]})]})})}),T.length>0&&m.jsx(Lu,{currentPage:l,totalPages:w,onPageChange:U,onPrevious:z,onNext:G})]})})]}),m.jsx(fo,{})]})})})},Fve=()=>m.jsx(m.Fragment,{children:m.jsx("main",{className:"doctor-panel",children:m.jsxs(sq,{fluid:!0,children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(za,{})}),m.jsxs("div",{className:"doc-panel-body appoint-details-pg has-texture papd-pg",children:[m.jsx("div",{className:"texture only-img",children:m.jsx("img",{src:"./images/doctor-symbol.png",alt:"Symbol"})}),m.jsxs("div",{className:"appointments",children:[m.jsxs("div",{className:"start-appointment cmn-mb",children:[m.jsxs("div",{className:"docpnl-sec-head",children:[m.jsx("h1",{className:"h2-title",children:"Symptom Upload Details"}),m.jsx("div",{className:"back-btn",children:m.jsx(mn,{to:"#",onClick:s=>{s.preventDefault(),window.history.back()},children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),m.jsxs("div",{className:"apointment-detail-card",children:[m.jsx("div",{className:"apoint-dtl-img",children:m.jsx("img",{src:"./images/client-img-5.png",alt:"Patient"})}),m.jsxs("div",{className:"appoint-dtl-content",children:[m.jsxs("div",{className:"appoint-dtl-left",children:[m.jsx("div",{className:"date h3-title",children:"21/12/2024"}),m.jsx("div",{className:"time",children:"10:40 PM"})]}),m.jsx(mn,{to:"/patient-profile",className:"cmn-btn",children:"View profile"})]})]})]}),m.jsx("div",{className:"patient-details-wrp",children:m.jsx(ot,{children:m.jsxs("div",{className:"patient-dtl-form",children:[m.jsxs("div",{className:"patient-basic-info cmn-mb2",children:[m.jsx("h2",{children:"Basic Information"}),m.jsx(Td,{children:["Name","Height","Weight","Gender","Age"].map((s,n)=>m.jsx(ea,{lg:4,md:4,sm:6,children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:s}),m.jsx(ot.Control,{type:"text",placeholder:s==="Name"?"Name":"Answer"})]})},n))})]}),m.jsxs("div",{className:"scheduled-call-consultations cmn-mb2",children:[m.jsx("h2",{children:"Uploaded Symptoms"}),m.jsx(Td,{children:[1,2,3,4].map(s=>m.jsx(ea,{lg:12,children:m.jsxs("div",{className:"formfield",children:[m.jsxs("label",{children:[s,". Lorem ipsum dolor sit amet"]}),m.jsx(ot.Control,{type:"text",placeholder:"Answer"})]})},s))})]}),m.jsxs("div",{className:"view-uploaded-images-wrp",children:[m.jsx("h2",{children:"View Uploaded Images"}),m.jsx("div",{className:"view-uploaded-img",children:[...Array(3)].map((s,n)=>m.jsx("div",{className:"img-wrp",children:m.jsx("a",{href:"./images/symptom-img.png","data-fancybox":"symptoms",children:m.jsx("img",{src:"./images/symptom-img.png",alt:"Symptom"})})},n))})]}),m.jsxs("div",{className:"view-uploaded-images-wrp uploaded-vdo-wrp",children:[m.jsx("h2",{children:"View Uploaded Videos"}),m.jsx("div",{className:"view-uploaded-img",children:[...Array(3)].map((s,n)=>m.jsx("div",{className:"img-wrp",children:m.jsx("a",{href:"https://youtu.be/EngW7tLk6R8?si=m3prZmspIQt_MGXm","data-fancybox":"symptoms",children:m.jsx("img",{src:"./images/symptom-img.png",alt:"Video"})})},n))})]}),m.jsxs("div",{className:"view-uploaded-images-wrp upload-file-wrp",children:[m.jsx("h2",{children:"View Uploaded Files"}),m.jsx("div",{className:"view-uploaded-img",children:[...Array(3)].map((s,n)=>m.jsx("div",{className:"img-wrp",children:m.jsxs("a",{href:"./images/file-icon.svg","data-fancybox":"symptoms",children:[m.jsx("img",{src:"./images/file-icon.svg",alt:"File"}),m.jsx("span",{className:"file-size",children:"5.3mb"})]})},n))})]}),m.jsx("div",{className:"btn-wrp",children:m.jsx(mn,{to:"/CompletedAssignedPrescription",children:m.jsx("button",{type:"button",className:"orange-btn",children:"Respond"})})})]})})})]})]}),m.jsx(fo,{})]})})}),Bve=({show:s,handleClose:n})=>{const i=es(),a=()=>{n(),i("/pendingprescription")};return m.jsxs(Cn,{show:s,onHide:n,centered:!0,dialogClassName:"custom-modal",children:[m.jsx("style",{children:`
            .custom-modal .modal-content {
              border-radius: 15px !important;
              // border: 12px solid red;
                max-width: 400px; 
  margin: auto;
            }
          `}),m.jsxs(Cn.Body,{className:"text-center p-4",children:[m.jsx("div",{style:{marginBottom:"20px"},children:m.jsx("img",{src:"/images/check-icon.png",alt:"Success"})}),m.jsx("h4",{style:{fontSize:"22px",fontWeight:"600",color:"#333",marginBottom:"8px"},children:"Successfully Submitted"}),m.jsx("p",{style:{fontSize:"16px",color:"#888",marginBottom:"25px"},children:"Prescription successfully submitted"}),m.jsx(Qr,{variant:"primary",onClick:a,style:{backgroundColor:"#f37021",border:"none",padding:"12px 30px",fontSize:"16px",borderRadius:"8px",width:"100%",maxWidth:"200px"},children:"Ok"})]})]})};function MX(s){return U_({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M4 8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8ZM6 10V20H18V10H6ZM9 12H11V18H9V12ZM13 12H15V18H13V12ZM7 5V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V5H22V7H2V5H7ZM9 4V5H15V4H9Z"},child:[]}]})(s)}const Hve=({id:s})=>{const n=Pi(),i=es();Wi();const[a,l]=F.useState(""),[p,_]=F.useState(!1),[T,w]=F.useState(!1),{allMedicine:C,loading:O,error:k}=hr(Tt=>Tt.userdata),{medicineSearch:U}=hr(Tt=>Tt.user);F.useEffect(()=>{n(Fw())},[n]);const[G,z]=F.useState(C);F.useEffect(()=>{C&&z(C)},[C]),F.useEffect(()=>{n(Gw({appointment_id:s}))},[n,s]);const J=F.useMemo(()=>{if(!C||!C.treatments)return[];const Tt=new Set,on=[];return C.treatments.forEach(fn=>{Tt.has(fn.medicine_name)||(Tt.add(fn.medicine_name),on.push({medicine_id:fn.medicine_id,medicine_name:fn.medicine_name}))}),on},[C]),[X,ie]=F.useState(!1),[oe,ce]=F.useState(!1),[_e,se]=F.useState(null),be=500,[ee,Q]=F.useState(""),[q,ae]=F.useState({medicine_name:"",dosage:"",duration:"",unit:"",with_water:"",dosage_frequency:"",meal_timing:"",day_time:"",remarks:""}),re=ee.length,fe=Tt=>{switch(Tt){case"morning":return"Morning";case"morning_afternoon":return"Morning + Afternoon";case"morning_evening":return"Morning + Evening";case"morning_afternoon_evening":return"Morning + Afternoon + Evening";case"morning_afternoon_evening_night":return"Morning + Afternoon + Evening + Night";case"morning_night":return"Morning + Night";case"night":return"Night";default:return Tt}},pe=Tt=>{switch(Tt){case"before":return"Before";case"after":return"After";default:return Tt}},Re=Tt=>{se({...Tt,with_water:Tt.with_water===1?"Yes":"No"}),ie(!0)},Ge=()=>{ie(!1),se(null)},ve=Tt=>{const{name:on,value:fn}=Tt.target;se(Ut=>({...Ut,[on]:fn}))},Ne=Tt=>{l(Tt.target.value)},Ce=Tt=>{ut({target:{name:"medicine_name",value:Tt}}),l("")},Ue=U?U.filter(Tt=>Tt.product_name.toLowerCase().includes(a.toLowerCase())):[],de=()=>{let Tt=!0;const on=["medicine_name","dosage","duration","unit","with_water","dosage_frequency","meal_timing","day_time"];for(const Ut of on)if(!_e[Ut]||String(_e[Ut]).trim()===""){ct.error(`Please fill in the "${Ut.replace(/_/g," ")}" field.`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),Tt=!1;break}if(!Tt)return;const fn={..._e,with_water:_e.with_water==="Yes"?1:0};z(Ut=>({...Ut,treatments:Ut.treatments.map(yt=>yt.treatment_id===fn.treatment_id?fn:yt)})),Ge(),ct.success("Medicine updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"})},De=Tt=>{z(on=>({...on,treatments:on.treatments.filter(fn=>fn.treatment_id!==Tt)})),ct.info("Medicine deleted successfully!",{position:"top-center",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})},xe=()=>{ce(!0),ae({medicine_name:"",dosage:"",duration:"",unit:"",with_water:"",dosage_frequency:"",meal_timing:"",day_time:"",remarks:""})},Xe=()=>{ce(!1)},ut=Tt=>{const{name:on,value:fn}=Tt.target;ae(Ut=>{const yt={...Ut,[on]:fn};if(on==="medicine_name"&&fn){const an=U.find(Dt=>Dt.product_name===fn);an&&an.unit&&(yt.unit=an.unit)}return yt})},Pt=()=>{let Tt=!0;const on=["medicine_name","dosage","duration","unit","with_water","dosage_frequency","meal_timing","day_time"];for(const Dt of on)if(!q[Dt]||String(q[Dt]).trim()===""){ct.error(`Please fill in the "${Dt.replace(/_/g," ")}" field.`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),Tt=!1;break}if(q.medicine_name.trim()||(ct.error("Please select a Medicine Name.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),Tt=!1),G.treatments&&G.treatments.some(Dt=>Dt.medicine_name.toLowerCase()===q.medicine_name.toLowerCase())&&(ct.error("Duplicate medicine not added. This medicine already exists in the table.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),Tt=!1),!Tt)return;const fn=G.treatments&&G.treatments.length>0?Math.max(...G.treatments.map(Dt=>Dt.treatment_id||0))+1:1,Ut=U.find(Dt=>Dt.product_name===q.medicine_name),yt=Ut?Ut.product_code:fn,an={...q,treatment_id:fn,medicine_id:yt,with_water:q.with_water==="Yes"?1:0};z(Dt=>({...Dt,treatments:[...Dt.treatments||[],an]})),Xe(),ct.success("New medicine added successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"})},It=async()=>{if(!G||!G.disease_name||!G.treatments||G.treatments.length===0){ct.warn("No data to submit! Please add at least one medicine.",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"});return}w(!0)},zt=async()=>{w(!1),_(!0);const Tt=JSON.parse(localStorage.getItem("doctor-app")),on=Tt==null?void 0:Tt.token;if(!on){ct.error("Authentication token not found. Please log in again.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),_(!1);return}const fn={appointment_id:s,diagnosis:G.disease_name,notes:ee,medicines:G.treatments.map(Ut=>({medicine_name:Ut.medicine_name,dosage:Ut.dosage,duration:Ut.duration,unit:Ut.unit,with_water:Ut.with_water,dosage_frequency:String(Ut.dosage_frequency),meal_timing:Ut.meal_timing,day_time:Ut.day_time,remarks:Ut.remarks}))};console.log("Submitting data to API:",fn);try{const Ut=await vi.post(`${li}api/doctor/prescriptions/submit_appointment_prescription`,fn,{headers:{Authorization:`Bearer ${on}`,"Content-Type":"application/json"}});Ut.data.status?(ct.success("Prescription data submitted successfully!",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark"}),_(!1),i("/doctor-home")):(ct.error(Ut.data.message||"An error occurred.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),_(!1))}catch(Ut){console.error("API Call Error:",Ut),Ut.response?(console.error("Error response data:",Ut.response.data),console.error("Error response status:",Ut.response.status),ct.error(Ut.response.data.message||"Server error. Please try again.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})):Ut.request?ct.error("No response from server. Please check your internet connection.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}):ct.error("An unexpected error occurred. Please try again.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),_(!1)}};if(p)return m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})});if(k)return m.jsxs("div",{className:"flex justify-center items-center h-screen text-red-600 font-bold text-lg",children:["Error: ",k]});const $t=G&&Array.isArray(G.treatments)&&G.treatments.length>0;return O?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"mx-auto font-sans bg-white",children:[m.jsx(rj,{}),m.jsx("div",{style:{width:"200px",border:"1px solid #ccc",padding:"8px",borderRadius:"6px",marginBottom:-40},children:m.jsx("h3",{className:"text-3xl font-bold text-gray-800 m-0",style:{fontSize:20},children:(G==null?void 0:G.disease_name)||"N/A"})}),m.jsx("div",{className:"mb-4 text-right",children:m.jsxs(Qr,{onClick:xe,style:{backgroundColor:"#F47820"},className:"border-0 px-6 py-2 rounded-lg shadow-md text-white flex items-center gap-2 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-75",children:[m.jsx(ij,{style:{marginBottom:5,marginRight:5}}),"Add New Medicine"]})}),m.jsx("div",{className:"overflow-x-auto bg-white border-[#199FD9]",children:$t?m.jsxs(bq,{hover:!0,responsive:!0,className:"min-w-full text-center table-auto rounded-lg overflow-hidden",children:[m.jsx("thead",{style:{backgroundColor:"#199FD9",color:"white"},children:m.jsxs("tr",{children:[m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"S.No."}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Medicine Name"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Dosage"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Duration (For day)"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Unit"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"With Water"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Frequency (Times per day)"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Before/After Meal"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Day Time"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Remarks"}),m.jsx("th",{className:"px-4 py-3",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Actions"})]})}),m.jsx("tbody",{children:G.treatments.map((Tt,on)=>m.jsxs("tr",{className:"hover:bg-gray-100",children:[m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:on+1}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:Tt.medicine_name}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:Tt.dosage}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:Tt.duration}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:Tt.unit}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:Tt.with_water===1?"Yes":"No"}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:Tt.dosage_frequency}),m.jsxs("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:[pe(Tt.meal_timing)," "]}),m.jsxs("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:[fe(Tt.day_time)," "]}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:Tt.remarks}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:m.jsxs("div",{style:{display:"flex",gap:"8px"},children:[m.jsx("button",{onClick:()=>Re(Tt),style:{border:"none",background:"transparent",padding:"4px"},children:m.jsx(vK,{style:{color:"#199FD9"}})}),m.jsx("button",{onClick:()=>De(Tt.treatment_id),style:{border:"none",background:"transparent",padding:"4px"},children:m.jsx(MX,{style:{color:"red"}})})]})})]},Tt.treatment_id))})]}):m.jsxs("div",{className:"text-center py-5",children:[m.jsx("p",{className:"text-xl text-gray-600 font-semibold",children:"No Data Found"}),m.jsx("p",{className:"text-gray-500 mt-2",children:'Start by adding new medicines using the "Add New Medicine" button above.'})]})}),$t&&m.jsxs("div",{style:{display:"flex",flexDirection:"column",marginTop:10,marginBottom:20,position:"relative",width:"60%"},children:[m.jsx("h3",{children:"Advice/Suggestion/Investigation."}),m.jsx("textarea",{style:{width:"100%",height:100,border:"1px solid #199FD9",backgroundColor:"white",maxHeight:"200px",overflowY:"auto",padding:"8px",boxSizing:"border-box",resize:"vertical"},value:ee,onChange:Tt=>{Tt.target.value.length<=be&&Q(Tt.target.value)},rows:4,cols:50,placeholder:"Enter your advice, suggestion, or investigation details here...",maxLength:be}),m.jsxs("div",{style:{position:"absolute",bottom:5,right:5,fontSize:"0.8em",color:re===be?"red":"#666",backgroundColor:"rgba(255, 255, 255, 0.7)",padding:"2px 5px",borderRadius:"3px",pointerEvents:"none"},children:[re,"/",be]})]}),$t&&m.jsx("div",{className:"mt-6 text-center",children:m.jsx(Qr,{className:"orange-btn",onClick:It,children:"Submit"})}),m.jsxs(Cn,{show:X,onHide:Ge,centered:!0,children:[m.jsx(Cn.Header,{closeButton:!0,style:{backgroundColor:"#199FD9",color:"white"},className:"add-new-med-close border-b-0 rounded-t-lg",children:m.jsx(Cn.Title,{className:"text-xl font-bold",children:"Update Medicine"})}),m.jsx(Cn.Body,{className:"p-6 bg-gray-50",children:_e&&m.jsxs(ot,{children:[m.jsxs(ot.Group,{className:"mb-3",controlId:"formMedicineName",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Medicine Name*"}),m.jsx(ot.Control,{type:"text",name:"medicine_name",value:_e.medicine_name,onChange:ve,list:"medicineSuggestionsList",disabled:!0,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"}),m.jsx("datalist",{id:"medicineSuggestionsList",children:J.map(Tt=>m.jsx("option",{value:Tt.medicine_name},Tt.medicine_id))})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formUnit",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Unit*"}),m.jsxs(ot.Select,{name:"unit",value:_e.unit,onChange:ve,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Unit"}),m.jsx("option",{value:"mg",children:"Milligram (mg)"}),m.jsx("option",{value:"g",children:"Gram (g)"}),m.jsx("option",{value:"tab",children:"Tablet (tab)"}),m.jsx("option",{value:"cap",children:"Capsule (cap)"}),m.jsx("option",{value:"ml",children:"Milliliter (mL)"}),m.jsx("option",{value:"drop",children:"Drop (drop)"}),m.jsx("option",{value:"tbsp",children:"Tablespoon (tbsp)"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formDosage",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Dosage*"}),m.jsx(ot.Control,{type:"text",name:"dosage",value:_e.dosage,onChange:ve,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Enter dosage like 5 or 10-20"})]}),m.jsxs(Td,{className:"mb-3",children:[m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{className:"mb-3",controlId:"formWithWater",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"With Water*"}),m.jsxs(ot.Select,{name:"with_water",value:_e.with_water,onChange:ve,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Option"}),m.jsx("option",{value:"Yes",children:"Yes"}),m.jsx("option",{value:"No",children:"No"})]})]})}),m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{className:"mb-3",controlId:"formDosageFrequency",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Frequency (Times per Day)*"}),m.jsxs(ot.Select,{name:"dosage_frequency",value:_e.dosage_frequency,onChange:ve,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Frequency"}),m.jsx("option",{value:"1",children:"1/day"}),m.jsx("option",{value:"2",children:"2/day"}),m.jsx("option",{value:"3",children:"3/day"}),m.jsx("option",{value:"4",children:"4/day"})]})]})})]}),m.jsxs(Td,{className:"mb-3",children:[m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{className:"mb-3",controlId:"formMealTiming",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Before/After Meal*"}),m.jsxs(ot.Select,{name:"meal_timing",value:_e.meal_timing,onChange:ve,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Timing"}),m.jsx("option",{value:"before",children:"Before "}),m.jsx("option",{value:"after",children:"After "})]})]})}),m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{className:"mb-3",controlId:"formDuration",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Duration*"}),m.jsx(ot.Control,{type:"text",name:"duration",value:_e.duration,onChange:ve,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Enter duration like 2 or 3"})]})})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formDayTime",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Day Time*"}),m.jsxs(ot.Select,{name:"day_time",value:_e.day_time,onChange:ve,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Time"}),m.jsx("option",{value:"morning",children:"Morning"}),m.jsx("option",{value:"morning_afternoon",children:"Morning + Afternoon"}),m.jsx("option",{value:"morning_evening",children:"Morning + Evening"}),m.jsx("option",{value:"morning_afternoon_evening",children:"Morning + Afternoon + Evening"}),m.jsx("option",{value:"morning_night",children:"Morning + Night"}),m.jsx("option",{value:"night",children:"Night"}),m.jsx("option",{value:"morning_afternoon_evening_night",children:"Morning + Afternoon + Evening + Night"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formRemarks",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Remarks (Optional)"}),m.jsx(ot.Control,{as:"textarea",rows:3,name:"remarks",value:_e.remarks,onChange:ve,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter remark if any"})]})]})}),m.jsxs(Cn.Footer,{className:"bg-gray-100 p-4 border-t-0 rounded-b-lg flex justify-end gap-3",children:[m.jsx(Qr,{variant:"secondary",onClick:Ge,className:"px-4 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400",children:"Cancel"}),m.jsx(Qr,{style:{backgroundColor:"#F47820",borderColor:"#F47820"},onClick:de,className:"px-4 py-2 rounded-md text-white hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500",children:"Update Medicine"})]})]}),m.jsxs(Cn,{show:oe,onHide:Xe,centered:!0,children:[m.jsx(Cn.Header,{closeButton:!0,style:{backgroundColor:"#199FD9",color:"white"},className:"add-new-med-close border-b-0 rounded-t-lg",children:m.jsx(Cn.Title,{className:"text-xl font-bold",children:"Add New Medicine"})}),m.jsx(Cn.Body,{className:"p-6 bg-gray-50",children:m.jsxs(ot,{children:[m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewMedicineName",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Medicine Name*"}),q.medicine_name?m.jsxs("div",{className:"mb-2 p-2 border border-blue-500 rounded-md bg-blue-50 flex justify-between items-center",children:[m.jsxs("span",{children:[" ",q.medicine_name]}),m.jsx(Qr,{variant:"link",onClick:()=>Ce(""),className:"p-0 text-red-500 text-sm",children:"(Change)"})]}):null,q.medicine_name&&a===""?null:m.jsx(ot.Control,{type:"text",placeholder:"Search for a Medicine",value:a,onChange:Ne,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"}),a&&q.medicine_name===""&&m.jsx("div",{className:"absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto mt-1",children:Ue.length>0?m.jsx("ul",{className:"list-none p-0 m-0",children:Ue.slice(0,10).map(Tt=>m.jsx("li",{onClick:()=>Ce(Tt.product_name),className:"p-2 cursor-pointer hover:bg-blue-100",children:Tt.product_name},Tt.product_code))}):m.jsx("div",{className:"p-2 text-gray-500",children:a.length>0?"No results found.":"Start typing to search..."})})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewUnit",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Unit*"}),m.jsxs(ot.Select,{name:"unit",value:q.unit,onChange:ut,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Unit"}),m.jsx("option",{value:"mg",children:"Milligram (mg)"}),m.jsx("option",{value:"g",children:"Gram (g)"}),m.jsx("option",{value:"tab",children:"Tablet (tab)"}),m.jsx("option",{value:"cap",children:"Capsule (cap)"}),m.jsx("option",{value:"ml",children:"Milliliter (mL)"}),m.jsx("option",{value:"drop",children:"Drop (drop)"}),m.jsx("option",{value:"tbsp",children:"Tablespoon (tbsp)"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewDosage",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Dosage*"}),m.jsx(ot.Control,{type:"text",name:"dosage",value:q.dosage,onChange:ut,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Enter dosage like 5 or 10-20"})]}),m.jsxs(Td,{className:"mb-4",children:[m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{controlId:"formNewWithWater",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"With Water*"}),m.jsxs(ot.Select,{name:"with_water",value:q.with_water,onChange:ut,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Option"}),m.jsx("option",{value:"Yes",children:"Yes"}),m.jsx("option",{value:"No",children:"No"})]})]})}),m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{controlId:"formDosageFrequency",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Frequency (Times per Day)*"}),m.jsxs(ot.Select,{name:"dosage_frequency",value:q==null?void 0:q.dosage_frequency,onChange:ut,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Frequency"}),m.jsx("option",{value:"1",children:"1/day"}),m.jsx("option",{value:"2",children:"2/day"}),m.jsx("option",{value:"3",children:"3/day"}),m.jsx("option",{value:"4",children:"4/day"})]})]})})]}),m.jsxs(Td,{className:"mb-4",children:[m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{controlId:"formNewMealTiming",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Before/After Meal*"}),m.jsxs(ot.Select,{name:"meal_timing",value:q.meal_timing,onChange:ut,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Timing"}),m.jsx("option",{value:"before",children:"Before"}),m.jsx("option",{value:"after",children:"After"})]})]})}),m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{controlId:"formNewDuration",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Duration*"}),m.jsx(ot.Control,{type:"text",name:"duration",value:q.duration,onChange:ut,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Enter Duration like 2 or 3"})]})})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewDayTime",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Day Time*"}),m.jsxs(ot.Select,{name:"day_time",value:q.day_time,onChange:ut,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Time"}),m.jsx("option",{value:"morning",children:"Morning"}),m.jsx("option",{value:"morning_afternoon",children:"Morning + Afternoon"}),m.jsx("option",{value:"morning_evening",children:"Morning + Evening"}),m.jsx("option",{value:"morning_afternoon_evening",children:"Morning + Afternoon + Evening"}),m.jsx("option",{value:"morning_night",children:"Morning + Night"}),m.jsx("option",{value:"night",children:"Night"}),m.jsx("option",{value:"morning_afternoon_evening_night",children:"Morning + Afternoon + Evening + Night"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewRemarks",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Remarks (Optional)"}),m.jsx(ot.Control,{as:"textarea",rows:3,name:"remarks",value:q.remarks,onChange:ut,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter remark if any"})]})]})}),m.jsxs(Cn.Footer,{className:"bg-gray-100 p-4 border-t-0 rounded-b-lg flex justify-end gap-3",children:[m.jsx(Qr,{variant:"secondary",onClick:Xe,className:"px-4 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400",children:"Cancel"}),m.jsx(Qr,{style:{backgroundColor:"#F47820",borderColor:"#F47820"},onClick:Pt,className:"px-4 py-2 rounded-md text-white hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500",children:"Add Medicine"})]})]}),m.jsx(Cn,{show:T,onHide:()=>w(!1),centered:!0,dialogClassName:"custom-modal-dialog",children:m.jsxs("div",{className:"modal-content text-center position-relative shadow",style:{width:"auto",minHeight:"280px",padding:"30px 20px",backgroundColor:"white",overflow:"hidden"},children:[m.jsx("button",{type:"button",onClick:()=>w(!1),className:"position-absolute top-0 end-0 m-3 border-0 bg-transparent","aria-label":"Close",children:m.jsx("img",{src:"./images/cross-blue.png",alt:"Close Icon",style:{width:"24px",height:"24px"}})}),m.jsx("div",{className:"modal-icon mb-3 mt-4",children:m.jsx("img",{src:"/images/logout-icon.svg",alt:"Info Icon",style:{width:"60px",height:"60px",color:"#199FD9"}})}),m.jsxs("div",{className:"modal-header border-0 flex-column align-items-center p-0",children:[" ",m.jsx("h2",{className:"fw-bold mb-2",style:{fontSize:"22px",color:"#333"},children:"Confirm Submission"}),m.jsx("p",{className:"m-0",style:{color:"black",fontSize:"16px"},children:"You cannot add more medicine after submission."}),m.jsx("p",{className:"m-0",style:{color:"black",fontSize:"16px",marginTop:"5px"},children:"Are you sure you want to submit the prescription?"})]}),m.jsxs("div",{className:"modal-body p-0 mt-5 d-flex justify-content-center gap-3",children:[" ",m.jsx(Qr,{variant:"outline-primary",onClick:()=>w(!1),className:"px-4 py-2 rounded-md font-semibold",style:{borderColor:"#199FD9",color:"#199FD9",backgroundColor:"white",minWidth:"120px",fontSize:"16px"},children:"Cancel"}),m.jsx(Qr,{variant:"primary",onClick:zt,className:"orange-btn px-4 py-2 rounded-md font-semibold",style:{backgroundColor:"#FF8C00",borderColor:"#FF8C00",color:"white",minWidth:"120px",fontSize:"16px"},children:"Confirm"})]})]})})]})},Gve=()=>{const s=Wi(),n=es(),{id:i,patientId:a}=s.state||{},{medicineSearch:l}=hr(Re=>Re.user);console.log(i,"id **********************");const p=F.useRef([]),_=Pi(),[T,w]=F.useState({});console.log(T,"choosen item get from **********"),F.useEffect(()=>{(!i||!a)&&n("/doctor-home")},[s]);const{patientProfileData:C}=hr(Re=>Re.patientProfile);F.useEffect(()=>{window.scrollTo(0,0)},[]),F.useEffect(()=>{a&&_(Pv({patientId:a}))},[_,a]);const O=(C==null?void 0:C.basic_information)||{},{loading:k,loading2:U,error:G,completeAssignedPrescription:z,medicineSearch:J}=hr(Re=>Re.user),[X,ie]=F.useState(!1),[oe,ce]=F.useState(""),[_e,se]=F.useState(""),[be,ee]=F.useState({}),[Q,q]=F.useState(null),[ae,re]=F.useState([]),[fe,pe]=F.useState([{medicineName:"",dosage:"",frequency:"",duration:"",disease:"",unit:"",withWater:"",beforeAfterMeal:"",dayTime:"",suggestions:[],showSuggestion:!1,isSelectedFromSuggestions:!1}]);return F.useEffect(()=>{J&&Q!==null&&pe(Re=>{const Ge=[...Re];return Ge[Q].suggestions=J,Ge})},[J,Q]),F.useEffect(()=>{function Re(Ge){const ve=[...fe];let Ne=!1;fe.forEach((Ce,Ue)=>{const de=p.current[Ue];de&&!de.contains(Ge.target)&&Ce.suggestions.length>0&&(ve[Ue].suggestions=[],Ne=!0)}),Ne&&pe(ve)}return document.addEventListener("mousedown",Re),()=>{document.removeEventListener("mousedown",Re)}},[fe]),m.jsx("main",{className:"doctor-panel",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(za,{})}),k?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsx("div",{className:"doc-panel-body cap-pg",children:m.jsx("div",{className:"vdoclscrn-patient-details-wrp",children:m.jsx("form",{onSubmit:Re=>Re.preventDefault(),children:m.jsx("div",{className:"vdoclscrn-patient-details-wrp-inr",children:m.jsxs("div",{className:"vdoclscrn-patient-details w-100",children:[m.jsxs("div",{className:"vdoclscrnpd-wrp",children:[m.jsx("h2",{children:"Patient Details:"}),m.jsx("div",{className:"vdoclscrnpd",children:[{label:"Patient Name",value:O.name||"N/A"},{label:"Age",value:O.age||"N/A"},{label:"Gender",value:O.gender||"N/A"},{label:"Height",value:O.height||"N/A"},{label:"Weight",value:O.weight||"N/A"},{label:"Contact No.",value:O.phone_no||"N/A"}].map((Re,Ge)=>m.jsxs("div",{className:"vdoclscrnpd-grp",children:[m.jsx("span",{className:"vdoclscrnpd-label",children:Re.label}),m.jsx("span",{className:"vdoclscrnpd-val",children:Re.value})]},Ge))})]}),m.jsx("div",{className:"vdoclscrnpd-wrp",children:m.jsxs("div",{className:"vdoclscrnpd-wrp",children:[m.jsx("h2",{children:"Prescriptions:"}),m.jsx(Hve,{id:i})]})}),m.jsx(Bve,{show:X,handleClose:()=>ie(!1)})]})})})})}),m.jsx(fo,{})]})})},Wve=()=>{const s=Pi(),{user:n,loading:i}=hr(oe=>oe.user);F.useEffect(()=>{s(T_())},[s]);const[a,l]=F.useState(""),[p,_]=F.useState(!1),[T,w]=F.useState(!1),[C,O]=F.useState({fullName:"",email:"",phone:"",experience:"",profilePic:""}),[k,U]=F.useState({date:null,timeRange:[]});F.useEffect(()=>{n&&O(oe=>({...oe,fullName:n.prefixed_name||"",email:n.email||"",phone:n.contact_no||"",experience:n.experience||"",profilePic:(jc==null?void 0:jc.BaseUrl)+n.profile_path||""}))},[n]);const G=oe=>{const{name:ce,value:_e}=oe.target;O(se=>({...se,[ce]:_e}))},z=oe=>{const ce=oe.target.files[0];if(!ce)return;const _e=URL.createObjectURL(ce);l(_e),_(!1)},J=()=>{l(""),O(oe=>({...oe,profilePic:"https://admin.awplconnect.com/public/doctorPlaceholder.jpg"})),_(!0)},X=async()=>{var ce;if(p)await s(ON());else if(a&&a!==C.profilePic){const se=await(await fetch(a)).blob(),be=new File([se],"profile.jpg",{type:se.type}),ee=new FormData;ee.append("profileImage",be),await s(NN(ee))}(ce=(await s(IN({name:C.fullName,contact_no:C.phone,experience:C.experience}))).payload)!=null&&ce.status&&(await s(T_()),w(!1))},ie=()=>{const oe=n!=null&&n.profile_path?(jc==null?void 0:jc.BaseUrl)+n.profile_path:"/images/my-profile-img.png";O(ce=>({...ce,fullName:n.name||"",email:n.email||"",phone:n.contact_no||"",experience:n.experience||"",profilePic:oe})),l(oe),_(!1),w(!1)};return i?m.jsxs("div",{className:"loader-main",children:[" ",m.jsx("span",{class:"loader"})," "]}):m.jsxs("main",{className:"doctor-panel my-profile-pg",children:[m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(za,{})}),m.jsxs("div",{className:"doc-panel-body",children:[m.jsx("div",{className:"docpnl-sec-head",children:m.jsx("h1",{className:"h2-title",children:"My Profile"})}),m.jsxs("div",{className:"my-profile-details",children:[m.jsxs("div",{className:"my-profile-img-wrp",children:[m.jsx("div",{className:"my-profile-img",children:m.jsx("img",{src:a||C.profilePic,alt:"My Profile"})}),T&&m.jsxs(m.Fragment,{children:[m.jsxs("label",{className:"orange-btn",style:{marginTop:"10px"},children:[m.jsx(ofe,{style:{marginRight:"6px"}}),"Upload New Picture",m.jsx("input",{type:"file",onChange:z,style:{display:"none"}})]}),m.jsx("button",{className:"cmn-btn",onClick:J,style:{marginTop:"10px"},children:"Remove"})]})]}),m.jsx("div",{className:"my-profile-details-inr",children:T?m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"my-profile-details-form",children:[m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Full Name"}),m.jsx("input",{type:"text",name:"fullName",value:C.fullName,onChange:G,placeholder:"Enter full name"})]}),m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Phone number"}),m.jsx("input",{type:"tel",name:"phone",value:C.phone,onChange:G,placeholder:"Enter phone number"})]}),m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Experience"}),m.jsx("input",{type:"text",name:"experience",value:C.experience,onChange:G,placeholder:"Experience"})]})]}),m.jsxs("div",{className:"btn-wrp",style:{display:"flex",gap:"15px"},children:[m.jsx("button",{className:"orange-btn",onClick:X,children:"Save Changes"}),m.jsx("button",{className:"cmn-btn",onClick:ie,children:"Cancel"})]})]}):m.jsxs(m.Fragment,{children:[m.jsx("form",{children:m.jsxs("div",{className:"my-profile-details-form",children:[m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Full Name"}),m.jsx("input",{type:"text",value:C.fullName,readOnly:!0})]}),m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Email ID"}),m.jsx("input",{type:"email",value:C.email,readOnly:!0})]}),m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Phone number"}),m.jsx("input",{type:"tel",value:C.phone,readOnly:!0})]}),m.jsxs("div",{className:"input-grp",children:[m.jsx("label",{children:"Experience"}),m.jsx("input",{type:"text",value:C.experience,readOnly:!0})]})]})}),m.jsx("div",{className:"btn-wrp",children:m.jsxs("button",{className:"orange-btn",onClick:()=>{l(C.profilePic),_(!1),w(!0)},children:[m.jsx("img",{src:"./images/pencil-icon.svg",alt:"Edit"})," Edit profile"]})})]})})]})]}),m.jsx(fo,{})]}),m.jsx("div",{className:"modal fade popup-wrp small-pop dash-pop",id:"logOut",tabIndex:"-1",role:"dialog","aria-hidden":"true",children:m.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:m.jsxs("div",{className:"modal-content",children:[m.jsx("div",{className:"modal-icon",children:m.jsx("img",{src:"./images/logout-icon.svg",alt:"Icon"})}),m.jsxs("div",{className:"modal-header",children:[m.jsx("h2",{children:"Logout"}),m.jsx("p",{children:"Are you sure you want to logout?"})]}),m.jsxs("div",{className:"modal-footer btn-wrp",children:[m.jsx("button",{type:"button",className:"cmn-btn","data-bs-dismiss":"modal",children:"Cancel"}),m.jsx("a",{href:"login.html",className:"cmn-btn orange-btn",children:"Logout"})]})]})})})]})},zve=()=>{const{pastPatients:s,loading:n,error:i,patient_id:a}=hr(Ue=>Ue.userdata),l=Pi(),p=4,[_,T]=F.useState([]),[w,C]=F.useState({name:"",age:"",dscode:"",disease:""}),[O,k]=F.useState(!1),[U,G]=F.useState(1),[z,J]=F.useState([]),[X,ie]=F.useState([]),[oe,ce]=F.useState(!1),[_e,se]=F.useState(!1);F.useEffect(()=>{l(Dv())},[l]),F.useEffect(()=>{T(s),ie(s);const Ue=[...new Set(s.map(de=>de.latestDisease).filter(de=>de&&de.trim()!==""&&de.trim()!=="-"))];J(Ue)},[s]);const be=Ue=>{const{name:de,value:De}=Ue.target;if(de==="name"){const xe=De.replace(/[^A-Za-z\s]/g,"");C(Xe=>({...Xe,[de]:xe}))}else de==="age"?(De===""||/^[0-9\b]+$/.test(De))&&C(xe=>({...xe,[de]:De})):C(de==="dscode"?xe=>({...xe,[de]:De}):xe=>({...xe,[de]:De}))},ee=Math.ceil(_.length/p),Q=Ue=>{Ue>=1&&Ue<=ee&&G(Ue)},q=()=>{U>1&&G(U-1)},ae=()=>{U<ee&&G(U+1)},re=()=>{const Ue=new FormData;w.name&&Ue.append("patient_name",w.name),w.age&&Ue.append("age",w.age),w.dscode&&Ue.append("ds_code",w.dscode),w.disease&&Ue.append("disease",w.disease),l(Dv(Ue)),k(!1)},fe=Ue=>{Ue.preventDefault(),C({name:"",age:"",dscode:"",disease:""});const de=new FormData;l(Dv(de)),k(!1)},pe=()=>{k(Ue=>!Ue)},Ge=(()=>{const Ue=[],de=new Set;return s&&s.forEach(De=>{De.patient_name&&!de.has(De.patient_name.toLowerCase())&&(de.add(De.patient_name.toLowerCase()),Ue.push({name:De.patient_name,dsCode:De.ds_code||""}))}),Ue})(),ve=w.name?Ge.filter(Ue=>Ue.name.toLowerCase().includes(w.name.toLowerCase())):Ge,Ne=Ue=>{C(de=>({...de,name:Ue.name})),ce(!1)},Ce=({patient:Ue})=>{var de,De;return m.jsx("div",{className:"col-lg-6 col-md-6",children:m.jsxs("div",{className:"past-patient-detail-card",children:[m.jsx("div",{className:"past-patient-cd-img",children:Ue.referred_by_patient_name?m.jsx("img",{src:"./images/referredProfile.png",alt:"referred patient",style:{border:"1px solid #199FD9"}}):m.jsx("img",{src:`${li}/${Ue.patient_profile}`,alt:"Client"})}),m.jsxs("div",{className:"p-patient-card-content",children:[m.jsxs("div",{className:"p-patient-cd-head",children:[m.jsx("h3",{children:Ue==null?void 0:Ue.patient_name}),Ue.referred_by_patient_name?m.jsxs("p",{children:[m.jsx("span",{style:{color:"black"},children:"Referred by "}),m.jsx("span",{style:{color:"#199FD9"},children:Ue.referred_by_patient_name})]}):m.jsxs("p",{children:[m.jsx("span",{style:{color:"black"},children:"DS Code: "}),m.jsx("span",{style:{color:"#199FD9"},children:Ue.ds_code})]})]}),m.jsxs("div",{className:"p-patient-cd-body",children:[m.jsxs("div",{className:"p-patient-dtl-wrp",children:[m.jsxs("strong",{className:"p-patient-dtl",children:["Age: ",Ue.age]}),m.jsxs("strong",{className:"p-patient-dtl",children:["Gender:"," ",((de=Ue.gender)==null?void 0:de.charAt(0).toUpperCase())+((De=Ue.gender)==null?void 0:De.slice(1).toLowerCase())]})]}),m.jsx("div",{className:"p-patient-disease",children:m.jsxs("b",{children:["Latest Disease: ",Ue.latestDisease]})}),m.jsx(mn,{to:"/patient-profile",state:{patientId:Ue.patient_id},className:"orange-btn",children:"View full details"})]})]})]})})};return m.jsx("main",{className:"doctor-panel",style:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:m.jsxs("div",{className:"container-fluid",style:{flex:1},children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(za,{})}),n?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"doc-panel-body pp-list-pg",children:[m.jsxs("div",{className:"docpnl-sec-head text-center",children:[m.jsx("h1",{className:"h2-title",children:"My Past Patients"}),m.jsx("div",{className:"back-btn",children:m.jsx(mn,{to:"#",onClick:Ue=>{Ue.preventDefault(),window.history.back()},children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})}),m.jsxs("div",{className:"past-patient-filter-wrp past-patient-pg",children:[m.jsxs("button",{type:"button",onClick:pe,children:["Filter ",m.jsx("img",{src:"./images/filter-icon.svg",alt:"Filter"})]}),m.jsx("div",{className:`filter-options-drpdn ${O?"active":""}`,children:m.jsxs("form",{children:[m.jsxs("div",{className:"filter-form",children:[m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"Patient Name"}),m.jsxs("div",{className:"suggestion-container",style:{position:"relative"},children:[m.jsx("input",{type:"text",name:"name",value:w.name,onChange:be,placeholder:"Patient Name",pattern:"[A-Za-z\\s]+",title:"Only letters and spaces allowed",autoComplete:"off",onFocus:()=>{se(!0),w.name&&ce(!0)},onBlur:()=>{setTimeout(()=>{se(!1),ce(!1)},200)}}),(oe||_e)&&ve.length>0&&m.jsx("ul",{className:"suggestions-dropdown",style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"#fff",border:"1px solid #ddd",borderRadius:"4px",maxHeight:"200px",overflowY:"auto",zIndex:1e3,marginTop:"5px",padding:0,listStyle:"none"},children:ve.map((Ue,de)=>m.jsxs("li",{onClick:()=>Ne(Ue),style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid #eee",display:"flex",flexDirection:"column",textAlign:"left"},children:[m.jsx("div",{children:Ue.name}),Ue.dsCode&&m.jsxs("div",{style:{color:"#199fd9",fontSize:"0.8em"},children:["(DS Code: ",Ue.dsCode,")"]})]},de))})]})]}),m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"Age"}),m.jsx("input",{id:"age",type:"text",name:"age",value:w.age,onChange:be,placeholder:"Age",pattern:"[0-9]*",inputMode:"numeric"})]}),m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"DS Code"}),m.jsx("input",{id:"dscode",type:"text",name:"dscode",value:w.dscode,onChange:be,placeholder:"DS Code"})]}),m.jsxs("div",{className:"filter-grp",children:[m.jsx("label",{children:"Disease"}),m.jsxs("select",{name:"disease",value:w.disease,onChange:be,children:[m.jsx("option",{value:"",disabled:!0,children:"Disease"}),z.map((Ue,de)=>m.jsx("option",{value:Ue,children:Ue},de))]})]})]}),m.jsxs("div",{className:"filter-form-btn-wrp",children:[m.jsx("button",{type:"button",className:"orange-btn",onClick:fe,style:{borderRadius:0},children:"Clear Filter"}),m.jsx("button",{type:"button",className:"orange-btn",onClick:re,style:{borderRadius:0},children:"Apply Filter"})]})]})})]})]}),m.jsx("div",{className:"past-patients-list-wrp",children:m.jsx("div",{className:"row",children:_.length==0?m.jsx("h3",{style:{textAlign:"center",padding:"25px 0",fontWeight:"bold",color:"#356598",fontSize:18},children:"No data found"}):_.slice((U-1)*p,U*p).map(Ue=>m.jsx(Ce,{patient:Ue},Ue.id))})}),_.length>0&&m.jsx(Lu,{currentPage:U,totalPages:ee,onPageChange:Q,onPrevious:q,onNext:ae})]}),m.jsx(fo,{})]})})},C2=({onSearch:s,placeholder:n="Search anything here...",value:i=""})=>{const[a,l]=F.useState(i),p=_=>{const T=_.target.value;l(T),s(T)};return m.jsx("div",{className:"formfield",children:m.jsx("input",{placeholder:n,type:"text",value:a,onChange:p})})},jX=6048e5,Yve=864e5,PD=6e4,kD=36e5,qve=1e3,Xz=Symbol.for("constructDateFrom");function Ti(s,n){return typeof s=="function"?s(n):s&&typeof s=="object"&&Xz in s?s[Xz](n):s instanceof Date?new s.constructor(n):new Date(n)}function dn(s,n){return Ti(n||s,s)}function bd(s,n,i){const a=dn(s,i==null?void 0:i.in);return isNaN(n)?Ti((i==null?void 0:i.in)||s,NaN):(n&&a.setDate(a.getDate()+n),a)}function Cd(s,n,i){const a=dn(s,i==null?void 0:i.in);if(isNaN(n))return Ti(s,NaN);if(!n)return a;const l=a.getDate(),p=Ti(s,a.getTime());p.setMonth(a.getMonth()+n+1,0);const _=p.getDate();return l>=_?p:(a.setFullYear(p.getFullYear(),p.getMonth(),l),a)}function UX(s,n,i){return Ti(s,+dn(s)+n)}function Kve(s,n,i){return UX(s,n*kD)}let Xve={};function G_(){return Xve}function gp(s,n){var T,w,C,O;const i=G_(),a=(n==null?void 0:n.weekStartsOn)??((w=(T=n==null?void 0:n.locale)==null?void 0:T.options)==null?void 0:w.weekStartsOn)??i.weekStartsOn??((O=(C=i.locale)==null?void 0:C.options)==null?void 0:O.weekStartsOn)??0,l=dn(s,n==null?void 0:n.in),p=l.getDay(),_=(p<a?7:0)+p-a;return l.setDate(l.getDate()-_),l.setHours(0,0,0,0),l}function qv(s,n){return gp(s,{...n,weekStartsOn:1})}function VX(s,n){const i=dn(s,n==null?void 0:n.in),a=i.getFullYear(),l=Ti(i,0);l.setFullYear(a+1,0,4),l.setHours(0,0,0,0);const p=qv(l),_=Ti(i,0);_.setFullYear(a,0,4),_.setHours(0,0,0,0);const T=qv(_);return i.getTime()>=p.getTime()?a+1:i.getTime()>=T.getTime()?a:a-1}function jO(s){const n=dn(s),i=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return i.setUTCFullYear(n.getFullYear()),+s-+i}function Ep(s,...n){const i=Ti.bind(null,n.find(a=>typeof a=="object"));return n.map(i)}function L_(s,n){const i=dn(s,n==null?void 0:n.in);return i.setHours(0,0,0,0),i}function Kv(s,n,i){const[a,l]=Ep(i==null?void 0:i.in,s,n),p=L_(a),_=L_(l),T=+p-jO(p),w=+_-jO(_);return Math.round((T-w)/Yve)}function Qve(s,n){const i=VX(s,n),a=Ti(s,0);return a.setFullYear(i,0,4),a.setHours(0,0,0,0),qv(a)}function A2(s,n,i){const a=dn(s,i==null?void 0:i.in);return a.setTime(a.getTime()+n*PD),a}function Kj(s,n,i){return Cd(s,n*3,i)}function $ve(s,n,i){return UX(s,n*1e3)}function UO(s,n,i){return bd(s,n*7,i)}function ip(s,n,i){return Cd(s,n*12,i)}function Qz(s,n){let i,a=n==null?void 0:n.in;return s.forEach(l=>{!a&&typeof l=="object"&&(a=Ti.bind(null,l));const p=dn(l,a);(!i||i<p||isNaN(+p))&&(i=p)}),Ti(a,i||NaN)}function $z(s,n){let i,a=n==null?void 0:n.in;return s.forEach(l=>{!a&&typeof l=="object"&&(a=Ti.bind(null,l));const p=dn(l,a);(!i||i>p||isNaN(+p))&&(i=p)}),Ti(a,i||NaN)}function Jve(s,n,i){const[a,l]=Ep(i==null?void 0:i.in,s,n);return+L_(a)==+L_(l)}function sp(s){return s instanceof Date||typeof s=="object"&&Object.prototype.toString.call(s)==="[object Date]"}function VO(s){return!(!sp(s)&&typeof s!="number"||isNaN(+dn(s)))}function FO(s,n,i){const[a,l]=Ep(i==null?void 0:i.in,s,n),p=a.getFullYear()-l.getFullYear(),_=a.getMonth()-l.getMonth();return p*12+_}function R_(s,n){const i=dn(s,n==null?void 0:n.in);return Math.trunc(i.getMonth()/3)+1}function BO(s,n,i){const[a,l]=Ep(i==null?void 0:i.in,s,n),p=a.getFullYear()-l.getFullYear(),_=R_(a)-R_(l);return p*4+_}function HO(s,n,i){const[a,l]=Ep(i==null?void 0:i.in,s,n);return a.getFullYear()-l.getFullYear()}function Zve(s,n,i){const[a,l]=Ep(i==null?void 0:i.in,s,n),p=Jz(a,l),_=Math.abs(Kv(a,l));a.setDate(a.getDate()-p*_);const T=+(Jz(a,l)===-p),w=p*(_-T);return w===0?0:w}function Jz(s,n){const i=s.getFullYear()-n.getFullYear()||s.getMonth()-n.getMonth()||s.getDate()-n.getDate()||s.getHours()-n.getHours()||s.getMinutes()-n.getMinutes()||s.getSeconds()-n.getSeconds()||s.getMilliseconds()-n.getMilliseconds();return i<0?-1:i>0?1:i}function FX(s,n){const i=dn(s,n==null?void 0:n.in);return i.setHours(23,59,59,999),i}function BX(s,n){const i=dn(s,n==null?void 0:n.in),a=i.getMonth();return i.setFullYear(i.getFullYear(),a+1,0),i.setHours(23,59,59,999),i}function I2(s,n){const i=dn(s,n==null?void 0:n.in),a=i.getMonth(),l=a-a%3;return i.setMonth(l,1),i.setHours(0,0,0,0),i}function HX(s,n){const i=dn(s,n==null?void 0:n.in);return i.setDate(1),i.setHours(0,0,0,0),i}function GX(s,n){const i=dn(s,n==null?void 0:n.in),a=i.getFullYear();return i.setFullYear(a+1,0,0),i.setHours(23,59,59,999),i}function LD(s,n){const i=dn(s,n==null?void 0:n.in);return i.setFullYear(i.getFullYear(),0,1),i.setHours(0,0,0,0),i}function eSe(s,n){var T,w;const i=G_(),a=i.weekStartsOn??((w=(T=i.locale)==null?void 0:T.options)==null?void 0:w.weekStartsOn)??0,l=dn(s,n==null?void 0:n.in),p=l.getDay(),_=(p<a?-7:0)+6-(p-a);return l.setDate(l.getDate()+_),l.setHours(23,59,59,999),l}const tSe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},nSe=(s,n,i)=>{let a;const l=tSe[s];return typeof l=="string"?a=l:n===1?a=l.one:a=l.other.replace("{{count}}",n.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+a:a+" ago":a};function mM(s){return(n={})=>{const i=n.width?String(n.width):s.defaultWidth;return s.formats[i]||s.formats[s.defaultWidth]}}const rSe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},iSe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},sSe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},aSe={date:mM({formats:rSe,defaultWidth:"full"}),time:mM({formats:iSe,defaultWidth:"full"}),dateTime:mM({formats:sSe,defaultWidth:"full"})},oSe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},cSe=(s,n,i,a)=>oSe[s];function Cw(s){return(n,i)=>{const a=i!=null&&i.context?String(i.context):"standalone";let l;if(a==="formatting"&&s.formattingValues){const _=s.defaultFormattingWidth||s.defaultWidth,T=i!=null&&i.width?String(i.width):_;l=s.formattingValues[T]||s.formattingValues[_]}else{const _=s.defaultWidth,T=i!=null&&i.width?String(i.width):s.defaultWidth;l=s.values[T]||s.values[_]}const p=s.argumentCallback?s.argumentCallback(n):n;return l[p]}}const lSe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},dSe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},uSe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},hSe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},pSe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},fSe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},mSe=(s,n)=>{const i=Number(s),a=i%100;if(a>20||a<10)switch(a%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},gSe={ordinalNumber:mSe,era:Cw({values:lSe,defaultWidth:"wide"}),quarter:Cw({values:dSe,defaultWidth:"wide",argumentCallback:s=>s-1}),month:Cw({values:uSe,defaultWidth:"wide"}),day:Cw({values:hSe,defaultWidth:"wide"}),dayPeriod:Cw({values:pSe,defaultWidth:"wide",formattingValues:fSe,defaultFormattingWidth:"wide"})};function Aw(s){return(n,i={})=>{const a=i.width,l=a&&s.matchPatterns[a]||s.matchPatterns[s.defaultMatchWidth],p=n.match(l);if(!p)return null;const _=p[0],T=a&&s.parsePatterns[a]||s.parsePatterns[s.defaultParseWidth],w=Array.isArray(T)?ESe(T,k=>k.test(_)):_Se(T,k=>k.test(_));let C;C=s.valueCallback?s.valueCallback(w):w,C=i.valueCallback?i.valueCallback(C):C;const O=n.slice(_.length);return{value:C,rest:O}}}function _Se(s,n){for(const i in s)if(Object.prototype.hasOwnProperty.call(s,i)&&n(s[i]))return i}function ESe(s,n){for(let i=0;i<s.length;i++)if(n(s[i]))return i}function ySe(s){return(n,i={})=>{const a=n.match(s.matchPattern);if(!a)return null;const l=a[0],p=n.match(s.parsePattern);if(!p)return null;let _=s.valueCallback?s.valueCallback(p[0]):p[0];_=i.valueCallback?i.valueCallback(_):_;const T=n.slice(l.length);return{value:_,rest:T}}}const vSe=/^(\d+)(th|st|nd|rd)?/i,SSe=/\d+/i,TSe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},bSe={any:[/^b/i,/^(a|c)/i]},wSe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},RSe={any:[/1/i,/2/i,/3/i,/4/i]},CSe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},ASe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},ISe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},NSe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},OSe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},DSe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},xSe={ordinalNumber:ySe({matchPattern:vSe,parsePattern:SSe,valueCallback:s=>parseInt(s,10)}),era:Aw({matchPatterns:TSe,defaultMatchWidth:"wide",parsePatterns:bSe,defaultParseWidth:"any"}),quarter:Aw({matchPatterns:wSe,defaultMatchWidth:"wide",parsePatterns:RSe,defaultParseWidth:"any",valueCallback:s=>s+1}),month:Aw({matchPatterns:CSe,defaultMatchWidth:"wide",parsePatterns:ASe,defaultParseWidth:"any"}),day:Aw({matchPatterns:ISe,defaultMatchWidth:"wide",parsePatterns:NSe,defaultParseWidth:"any"}),dayPeriod:Aw({matchPatterns:OSe,defaultMatchWidth:"any",parsePatterns:DSe,defaultParseWidth:"any"})},WX={code:"en-US",formatDistance:nSe,formatLong:aSe,formatRelative:cSe,localize:gSe,match:xSe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function PSe(s,n){const i=dn(s,n==null?void 0:n.in);return Kv(i,LD(i))+1}function Xj(s,n){const i=dn(s,n==null?void 0:n.in),a=+qv(i)-+Qve(i);return Math.round(a/jX)+1}function Qj(s,n){var O,k,U,G;const i=dn(s,n==null?void 0:n.in),a=i.getFullYear(),l=G_(),p=(n==null?void 0:n.firstWeekContainsDate)??((k=(O=n==null?void 0:n.locale)==null?void 0:O.options)==null?void 0:k.firstWeekContainsDate)??l.firstWeekContainsDate??((G=(U=l.locale)==null?void 0:U.options)==null?void 0:G.firstWeekContainsDate)??1,_=Ti((n==null?void 0:n.in)||s,0);_.setFullYear(a+1,0,p),_.setHours(0,0,0,0);const T=gp(_,n),w=Ti((n==null?void 0:n.in)||s,0);w.setFullYear(a,0,p),w.setHours(0,0,0,0);const C=gp(w,n);return+i>=+T?a+1:+i>=+C?a:a-1}function kSe(s,n){var T,w,C,O;const i=G_(),a=(n==null?void 0:n.firstWeekContainsDate)??((w=(T=n==null?void 0:n.locale)==null?void 0:T.options)==null?void 0:w.firstWeekContainsDate)??i.firstWeekContainsDate??((O=(C=i.locale)==null?void 0:C.options)==null?void 0:O.firstWeekContainsDate)??1,l=Qj(s,n),p=Ti((n==null?void 0:n.in)||s,0);return p.setFullYear(l,0,a),p.setHours(0,0,0,0),gp(p,n)}function zX(s,n){const i=dn(s,n==null?void 0:n.in),a=+gp(i,n)-+kSe(i,n);return Math.round(a/jX)+1}function yi(s,n){const i=s<0?"-":"",a=Math.abs(s).toString().padStart(n,"0");return i+a}const Vf={y(s,n){const i=s.getFullYear(),a=i>0?i:1-i;return yi(n==="yy"?a%100:a,n.length)},M(s,n){const i=s.getMonth();return n==="M"?String(i+1):yi(i+1,2)},d(s,n){return yi(s.getDate(),n.length)},a(s,n){const i=s.getHours()/12>=1?"pm":"am";switch(n){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(s,n){return yi(s.getHours()%12||12,n.length)},H(s,n){return yi(s.getHours(),n.length)},m(s,n){return yi(s.getMinutes(),n.length)},s(s,n){return yi(s.getSeconds(),n.length)},S(s,n){const i=n.length,a=s.getMilliseconds(),l=Math.trunc(a*Math.pow(10,i-3));return yi(l,n.length)}},bv={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Zz={G:function(s,n,i){const a=s.getFullYear()>0?1:0;switch(n){case"G":case"GG":case"GGG":return i.era(a,{width:"abbreviated"});case"GGGGG":return i.era(a,{width:"narrow"});case"GGGG":default:return i.era(a,{width:"wide"})}},y:function(s,n,i){if(n==="yo"){const a=s.getFullYear(),l=a>0?a:1-a;return i.ordinalNumber(l,{unit:"year"})}return Vf.y(s,n)},Y:function(s,n,i,a){const l=Qj(s,a),p=l>0?l:1-l;if(n==="YY"){const _=p%100;return yi(_,2)}return n==="Yo"?i.ordinalNumber(p,{unit:"year"}):yi(p,n.length)},R:function(s,n){const i=VX(s);return yi(i,n.length)},u:function(s,n){const i=s.getFullYear();return yi(i,n.length)},Q:function(s,n,i){const a=Math.ceil((s.getMonth()+1)/3);switch(n){case"Q":return String(a);case"QQ":return yi(a,2);case"Qo":return i.ordinalNumber(a,{unit:"quarter"});case"QQQ":return i.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(a,{width:"wide",context:"formatting"})}},q:function(s,n,i){const a=Math.ceil((s.getMonth()+1)/3);switch(n){case"q":return String(a);case"qq":return yi(a,2);case"qo":return i.ordinalNumber(a,{unit:"quarter"});case"qqq":return i.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(a,{width:"wide",context:"standalone"})}},M:function(s,n,i){const a=s.getMonth();switch(n){case"M":case"MM":return Vf.M(s,n);case"Mo":return i.ordinalNumber(a+1,{unit:"month"});case"MMM":return i.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(a,{width:"wide",context:"formatting"})}},L:function(s,n,i){const a=s.getMonth();switch(n){case"L":return String(a+1);case"LL":return yi(a+1,2);case"Lo":return i.ordinalNumber(a+1,{unit:"month"});case"LLL":return i.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(a,{width:"wide",context:"standalone"})}},w:function(s,n,i,a){const l=zX(s,a);return n==="wo"?i.ordinalNumber(l,{unit:"week"}):yi(l,n.length)},I:function(s,n,i){const a=Xj(s);return n==="Io"?i.ordinalNumber(a,{unit:"week"}):yi(a,n.length)},d:function(s,n,i){return n==="do"?i.ordinalNumber(s.getDate(),{unit:"date"}):Vf.d(s,n)},D:function(s,n,i){const a=PSe(s);return n==="Do"?i.ordinalNumber(a,{unit:"dayOfYear"}):yi(a,n.length)},E:function(s,n,i){const a=s.getDay();switch(n){case"E":case"EE":case"EEE":return i.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(a,{width:"short",context:"formatting"});case"EEEE":default:return i.day(a,{width:"wide",context:"formatting"})}},e:function(s,n,i,a){const l=s.getDay(),p=(l-a.weekStartsOn+8)%7||7;switch(n){case"e":return String(p);case"ee":return yi(p,2);case"eo":return i.ordinalNumber(p,{unit:"day"});case"eee":return i.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(l,{width:"short",context:"formatting"});case"eeee":default:return i.day(l,{width:"wide",context:"formatting"})}},c:function(s,n,i,a){const l=s.getDay(),p=(l-a.weekStartsOn+8)%7||7;switch(n){case"c":return String(p);case"cc":return yi(p,n.length);case"co":return i.ordinalNumber(p,{unit:"day"});case"ccc":return i.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(l,{width:"narrow",context:"standalone"});case"cccccc":return i.day(l,{width:"short",context:"standalone"});case"cccc":default:return i.day(l,{width:"wide",context:"standalone"})}},i:function(s,n,i){const a=s.getDay(),l=a===0?7:a;switch(n){case"i":return String(l);case"ii":return yi(l,n.length);case"io":return i.ordinalNumber(l,{unit:"day"});case"iii":return i.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(a,{width:"short",context:"formatting"});case"iiii":default:return i.day(a,{width:"wide",context:"formatting"})}},a:function(s,n,i){const l=s.getHours()/12>=1?"pm":"am";switch(n){case"a":case"aa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(s,n,i){const a=s.getHours();let l;switch(a===12?l=bv.noon:a===0?l=bv.midnight:l=a/12>=1?"pm":"am",n){case"b":case"bb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(s,n,i){const a=s.getHours();let l;switch(a>=17?l=bv.evening:a>=12?l=bv.afternoon:a>=4?l=bv.morning:l=bv.night,n){case"B":case"BB":case"BBB":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(s,n,i){if(n==="ho"){let a=s.getHours()%12;return a===0&&(a=12),i.ordinalNumber(a,{unit:"hour"})}return Vf.h(s,n)},H:function(s,n,i){return n==="Ho"?i.ordinalNumber(s.getHours(),{unit:"hour"}):Vf.H(s,n)},K:function(s,n,i){const a=s.getHours()%12;return n==="Ko"?i.ordinalNumber(a,{unit:"hour"}):yi(a,n.length)},k:function(s,n,i){let a=s.getHours();return a===0&&(a=24),n==="ko"?i.ordinalNumber(a,{unit:"hour"}):yi(a,n.length)},m:function(s,n,i){return n==="mo"?i.ordinalNumber(s.getMinutes(),{unit:"minute"}):Vf.m(s,n)},s:function(s,n,i){return n==="so"?i.ordinalNumber(s.getSeconds(),{unit:"second"}):Vf.s(s,n)},S:function(s,n){return Vf.S(s,n)},X:function(s,n,i){const a=s.getTimezoneOffset();if(a===0)return"Z";switch(n){case"X":return tY(a);case"XXXX":case"XX":return l_(a);case"XXXXX":case"XXX":default:return l_(a,":")}},x:function(s,n,i){const a=s.getTimezoneOffset();switch(n){case"x":return tY(a);case"xxxx":case"xx":return l_(a);case"xxxxx":case"xxx":default:return l_(a,":")}},O:function(s,n,i){const a=s.getTimezoneOffset();switch(n){case"O":case"OO":case"OOO":return"GMT"+eY(a,":");case"OOOO":default:return"GMT"+l_(a,":")}},z:function(s,n,i){const a=s.getTimezoneOffset();switch(n){case"z":case"zz":case"zzz":return"GMT"+eY(a,":");case"zzzz":default:return"GMT"+l_(a,":")}},t:function(s,n,i){const a=Math.trunc(+s/1e3);return yi(a,n.length)},T:function(s,n,i){return yi(+s,n.length)}};function eY(s,n=""){const i=s>0?"-":"+",a=Math.abs(s),l=Math.trunc(a/60),p=a%60;return p===0?i+String(l):i+String(l)+n+yi(p,2)}function tY(s,n){return s%60===0?(s>0?"-":"+")+yi(Math.abs(s)/60,2):l_(s,n)}function l_(s,n=""){const i=s>0?"-":"+",a=Math.abs(s),l=yi(Math.trunc(a/60),2),p=yi(a%60,2);return i+l+n+p}const nY=(s,n)=>{switch(s){case"P":return n.date({width:"short"});case"PP":return n.date({width:"medium"});case"PPP":return n.date({width:"long"});case"PPPP":default:return n.date({width:"full"})}},YX=(s,n)=>{switch(s){case"p":return n.time({width:"short"});case"pp":return n.time({width:"medium"});case"ppp":return n.time({width:"long"});case"pppp":default:return n.time({width:"full"})}},LSe=(s,n)=>{const i=s.match(/(P+)(p+)?/)||[],a=i[1],l=i[2];if(!l)return nY(s,n);let p;switch(a){case"P":p=n.dateTime({width:"short"});break;case"PP":p=n.dateTime({width:"medium"});break;case"PPP":p=n.dateTime({width:"long"});break;case"PPPP":default:p=n.dateTime({width:"full"});break}return p.replace("{{date}}",nY(a,n)).replace("{{time}}",YX(l,n))},N2={p:YX,P:LSe},MSe=/^D+$/,jSe=/^Y+$/,USe=["D","DD","YY","YYYY"];function VSe(s){return MSe.test(s)}function FSe(s){return jSe.test(s)}function BSe(s,n,i){const a=HSe(s,n,i);if(console.warn(a),USe.includes(s))throw new RangeError(a)}function HSe(s,n,i){const a=s[0]==="Y"?"years":"days of the month";return`Use \`${s.toLowerCase()}\` instead of \`${s}\` (in \`${n}\`) for formatting ${a} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const GSe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,WSe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,zSe=/^'([^]*?)'?$/,YSe=/''/g,qSe=/[a-zA-Z]/;function rY(s,n,i){var O,k,U,G,z,J,X,ie;const a=G_(),l=(i==null?void 0:i.locale)??a.locale??WX,p=(i==null?void 0:i.firstWeekContainsDate)??((k=(O=i==null?void 0:i.locale)==null?void 0:O.options)==null?void 0:k.firstWeekContainsDate)??a.firstWeekContainsDate??((G=(U=a.locale)==null?void 0:U.options)==null?void 0:G.firstWeekContainsDate)??1,_=(i==null?void 0:i.weekStartsOn)??((J=(z=i==null?void 0:i.locale)==null?void 0:z.options)==null?void 0:J.weekStartsOn)??a.weekStartsOn??((ie=(X=a.locale)==null?void 0:X.options)==null?void 0:ie.weekStartsOn)??0,T=dn(s,i==null?void 0:i.in);if(!VO(T))throw new RangeError("Invalid time value");let w=n.match(WSe).map(oe=>{const ce=oe[0];if(ce==="p"||ce==="P"){const _e=N2[ce];return _e(oe,l.formatLong)}return oe}).join("").match(GSe).map(oe=>{if(oe==="''")return{isToken:!1,value:"'"};const ce=oe[0];if(ce==="'")return{isToken:!1,value:KSe(oe)};if(Zz[ce])return{isToken:!0,value:oe};if(ce.match(qSe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ce+"`");return{isToken:!1,value:oe}});l.localize.preprocessor&&(w=l.localize.preprocessor(T,w));const C={firstWeekContainsDate:p,weekStartsOn:_,locale:l};return w.map(oe=>{if(!oe.isToken)return oe.value;const ce=oe.value;(!(i!=null&&i.useAdditionalWeekYearTokens)&&FSe(ce)||!(i!=null&&i.useAdditionalDayOfYearTokens)&&VSe(ce))&&BSe(ce,n,String(s));const _e=Zz[ce[0]];return _e(T,ce,l.localize,C)}).join("")}function KSe(s){const n=s.match(zSe);return n?n[1].replace(YSe,"'"):s}function iY(s,n){return dn(s,n==null?void 0:n.in).getDate()}function XSe(s,n){return dn(s,n==null?void 0:n.in).getDay()}function QSe(s,n){const i=dn(s,n==null?void 0:n.in),a=i.getFullYear(),l=i.getMonth(),p=Ti(i,0);return p.setFullYear(a,l+1,0),p.setHours(0,0,0,0),p.getDate()}function $Se(){return Object.assign({},G_())}function ap(s,n){return dn(s,n==null?void 0:n.in).getHours()}function JSe(s,n){const i=dn(s,n==null?void 0:n.in).getDay();return i===0?7:i}function op(s,n){return dn(s,n==null?void 0:n.in).getMinutes()}function po(s,n){return dn(s,n==null?void 0:n.in).getMonth()}function Qf(s){return dn(s).getSeconds()}function O2(s){return+dn(s)}function _r(s,n){return dn(s,n==null?void 0:n.in).getFullYear()}function sm(s,n){return+dn(s)>+dn(n)}function M_(s,n){return+dn(s)<+dn(n)}function ZSe(s,n){return+dn(s)==+dn(n)}function eTe(s,n){const i=tTe(n)?new n(0):Ti(n,0);return i.setFullYear(s.getFullYear(),s.getMonth(),s.getDate()),i.setHours(s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()),i}function tTe(s){var n;return typeof s=="function"&&((n=s.prototype)==null?void 0:n.constructor)===s}const nTe=10;class qX{constructor(){Kt(this,"subPriority",0)}validate(n,i){return!0}}class rTe extends qX{constructor(n,i,a,l,p){super(),this.value=n,this.validateValue=i,this.setValue=a,this.priority=l,p&&(this.subPriority=p)}validate(n,i){return this.validateValue(n,this.value,i)}set(n,i,a){return this.setValue(n,i,this.value,a)}}class iTe extends qX{constructor(i,a){super();Kt(this,"priority",nTe);Kt(this,"subPriority",-1);this.context=i||(l=>Ti(a,l))}set(i,a){return a.timestampIsSet?i:Ti(i,eTe(i,this.context))}}class ni{run(n,i,a,l){const p=this.parse(n,i,a,l);return p?{setter:new rTe(p.value,this.validate,this.set,this.priority,this.subPriority),rest:p.rest}:null}validate(n,i,a){return!0}}class sTe extends ni{constructor(){super(...arguments);Kt(this,"priority",140);Kt(this,"incompatibleTokens",["R","u","t","T"])}parse(i,a,l){switch(a){case"G":case"GG":case"GGG":return l.era(i,{width:"abbreviated"})||l.era(i,{width:"narrow"});case"GGGGG":return l.era(i,{width:"narrow"});case"GGGG":default:return l.era(i,{width:"wide"})||l.era(i,{width:"abbreviated"})||l.era(i,{width:"narrow"})}}set(i,a,l){return a.era=l,i.setFullYear(l,0,1),i.setHours(0,0,0,0),i}}const Fs={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},Mu={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function Bs(s,n){return s&&{value:n(s.value),rest:s.rest}}function hs(s,n){const i=n.match(s);return i?{value:parseInt(i[0],10),rest:n.slice(i[0].length)}:null}function ju(s,n){const i=n.match(s);if(!i)return null;if(i[0]==="Z")return{value:0,rest:n.slice(1)};const a=i[1]==="+"?1:-1,l=i[2]?parseInt(i[2],10):0,p=i[3]?parseInt(i[3],10):0,_=i[5]?parseInt(i[5],10):0;return{value:a*(l*kD+p*PD+_*qve),rest:n.slice(i[0].length)}}function KX(s){return hs(Fs.anyDigitsSigned,s)}function ws(s,n){switch(s){case 1:return hs(Fs.singleDigit,n);case 2:return hs(Fs.twoDigits,n);case 3:return hs(Fs.threeDigits,n);case 4:return hs(Fs.fourDigits,n);default:return hs(new RegExp("^\\d{1,"+s+"}"),n)}}function GO(s,n){switch(s){case 1:return hs(Fs.singleDigitSigned,n);case 2:return hs(Fs.twoDigitsSigned,n);case 3:return hs(Fs.threeDigitsSigned,n);case 4:return hs(Fs.fourDigitsSigned,n);default:return hs(new RegExp("^-?\\d{1,"+s+"}"),n)}}function $j(s){switch(s){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function XX(s,n){const i=n>0,a=i?n:1-n;let l;if(a<=50)l=s||100;else{const p=a+50,_=Math.trunc(p/100)*100,T=s>=p%100;l=s+_-(T?100:0)}return i?l:1-l}function QX(s){return s%400===0||s%4===0&&s%100!==0}class aTe extends ni{constructor(){super(...arguments);Kt(this,"priority",130);Kt(this,"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"])}parse(i,a,l){const p=_=>({year:_,isTwoDigitYear:a==="yy"});switch(a){case"y":return Bs(ws(4,i),p);case"yo":return Bs(l.ordinalNumber(i,{unit:"year"}),p);default:return Bs(ws(a.length,i),p)}}validate(i,a){return a.isTwoDigitYear||a.year>0}set(i,a,l){const p=i.getFullYear();if(l.isTwoDigitYear){const T=XX(l.year,p);return i.setFullYear(T,0,1),i.setHours(0,0,0,0),i}const _=!("era"in a)||a.era===1?l.year:1-l.year;return i.setFullYear(_,0,1),i.setHours(0,0,0,0),i}}class oTe extends ni{constructor(){super(...arguments);Kt(this,"priority",130);Kt(this,"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"])}parse(i,a,l){const p=_=>({year:_,isTwoDigitYear:a==="YY"});switch(a){case"Y":return Bs(ws(4,i),p);case"Yo":return Bs(l.ordinalNumber(i,{unit:"year"}),p);default:return Bs(ws(a.length,i),p)}}validate(i,a){return a.isTwoDigitYear||a.year>0}set(i,a,l,p){const _=Qj(i,p);if(l.isTwoDigitYear){const w=XX(l.year,_);return i.setFullYear(w,0,p.firstWeekContainsDate),i.setHours(0,0,0,0),gp(i,p)}const T=!("era"in a)||a.era===1?l.year:1-l.year;return i.setFullYear(T,0,p.firstWeekContainsDate),i.setHours(0,0,0,0),gp(i,p)}}class cTe extends ni{constructor(){super(...arguments);Kt(this,"priority",130);Kt(this,"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"])}parse(i,a){return GO(a==="R"?4:a.length,i)}set(i,a,l){const p=Ti(i,0);return p.setFullYear(l,0,4),p.setHours(0,0,0,0),qv(p)}}class lTe extends ni{constructor(){super(...arguments);Kt(this,"priority",130);Kt(this,"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"])}parse(i,a){return GO(a==="u"?4:a.length,i)}set(i,a,l){return i.setFullYear(l,0,1),i.setHours(0,0,0,0),i}}class dTe extends ni{constructor(){super(...arguments);Kt(this,"priority",120);Kt(this,"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"])}parse(i,a,l){switch(a){case"Q":case"QQ":return ws(a.length,i);case"Qo":return l.ordinalNumber(i,{unit:"quarter"});case"QQQ":return l.quarter(i,{width:"abbreviated",context:"formatting"})||l.quarter(i,{width:"narrow",context:"formatting"});case"QQQQQ":return l.quarter(i,{width:"narrow",context:"formatting"});case"QQQQ":default:return l.quarter(i,{width:"wide",context:"formatting"})||l.quarter(i,{width:"abbreviated",context:"formatting"})||l.quarter(i,{width:"narrow",context:"formatting"})}}validate(i,a){return a>=1&&a<=4}set(i,a,l){return i.setMonth((l-1)*3,1),i.setHours(0,0,0,0),i}}class uTe extends ni{constructor(){super(...arguments);Kt(this,"priority",120);Kt(this,"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"])}parse(i,a,l){switch(a){case"q":case"qq":return ws(a.length,i);case"qo":return l.ordinalNumber(i,{unit:"quarter"});case"qqq":return l.quarter(i,{width:"abbreviated",context:"standalone"})||l.quarter(i,{width:"narrow",context:"standalone"});case"qqqqq":return l.quarter(i,{width:"narrow",context:"standalone"});case"qqqq":default:return l.quarter(i,{width:"wide",context:"standalone"})||l.quarter(i,{width:"abbreviated",context:"standalone"})||l.quarter(i,{width:"narrow",context:"standalone"})}}validate(i,a){return a>=1&&a<=4}set(i,a,l){return i.setMonth((l-1)*3,1),i.setHours(0,0,0,0),i}}class hTe extends ni{constructor(){super(...arguments);Kt(this,"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]);Kt(this,"priority",110)}parse(i,a,l){const p=_=>_-1;switch(a){case"M":return Bs(hs(Fs.month,i),p);case"MM":return Bs(ws(2,i),p);case"Mo":return Bs(l.ordinalNumber(i,{unit:"month"}),p);case"MMM":return l.month(i,{width:"abbreviated",context:"formatting"})||l.month(i,{width:"narrow",context:"formatting"});case"MMMMM":return l.month(i,{width:"narrow",context:"formatting"});case"MMMM":default:return l.month(i,{width:"wide",context:"formatting"})||l.month(i,{width:"abbreviated",context:"formatting"})||l.month(i,{width:"narrow",context:"formatting"})}}validate(i,a){return a>=0&&a<=11}set(i,a,l){return i.setMonth(l,1),i.setHours(0,0,0,0),i}}class pTe extends ni{constructor(){super(...arguments);Kt(this,"priority",110);Kt(this,"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"])}parse(i,a,l){const p=_=>_-1;switch(a){case"L":return Bs(hs(Fs.month,i),p);case"LL":return Bs(ws(2,i),p);case"Lo":return Bs(l.ordinalNumber(i,{unit:"month"}),p);case"LLL":return l.month(i,{width:"abbreviated",context:"standalone"})||l.month(i,{width:"narrow",context:"standalone"});case"LLLLL":return l.month(i,{width:"narrow",context:"standalone"});case"LLLL":default:return l.month(i,{width:"wide",context:"standalone"})||l.month(i,{width:"abbreviated",context:"standalone"})||l.month(i,{width:"narrow",context:"standalone"})}}validate(i,a){return a>=0&&a<=11}set(i,a,l){return i.setMonth(l,1),i.setHours(0,0,0,0),i}}function fTe(s,n,i){const a=dn(s,i==null?void 0:i.in),l=zX(a,i)-n;return a.setDate(a.getDate()-l*7),dn(a,i==null?void 0:i.in)}class mTe extends ni{constructor(){super(...arguments);Kt(this,"priority",100);Kt(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"])}parse(i,a,l){switch(a){case"w":return hs(Fs.week,i);case"wo":return l.ordinalNumber(i,{unit:"week"});default:return ws(a.length,i)}}validate(i,a){return a>=1&&a<=53}set(i,a,l,p){return gp(fTe(i,l,p),p)}}function gTe(s,n,i){const a=dn(s,i==null?void 0:i.in),l=Xj(a,i)-n;return a.setDate(a.getDate()-l*7),a}class _Te extends ni{constructor(){super(...arguments);Kt(this,"priority",100);Kt(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"])}parse(i,a,l){switch(a){case"I":return hs(Fs.week,i);case"Io":return l.ordinalNumber(i,{unit:"week"});default:return ws(a.length,i)}}validate(i,a){return a>=1&&a<=53}set(i,a,l){return qv(gTe(i,l))}}const ETe=[31,28,31,30,31,30,31,31,30,31,30,31],yTe=[31,29,31,30,31,30,31,31,30,31,30,31];class vTe extends ni{constructor(){super(...arguments);Kt(this,"priority",90);Kt(this,"subPriority",1);Kt(this,"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"])}parse(i,a,l){switch(a){case"d":return hs(Fs.date,i);case"do":return l.ordinalNumber(i,{unit:"date"});default:return ws(a.length,i)}}validate(i,a){const l=i.getFullYear(),p=QX(l),_=i.getMonth();return p?a>=1&&a<=yTe[_]:a>=1&&a<=ETe[_]}set(i,a,l){return i.setDate(l),i.setHours(0,0,0,0),i}}class STe extends ni{constructor(){super(...arguments);Kt(this,"priority",90);Kt(this,"subpriority",1);Kt(this,"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"])}parse(i,a,l){switch(a){case"D":case"DD":return hs(Fs.dayOfYear,i);case"Do":return l.ordinalNumber(i,{unit:"date"});default:return ws(a.length,i)}}validate(i,a){const l=i.getFullYear();return QX(l)?a>=1&&a<=366:a>=1&&a<=365}set(i,a,l){return i.setMonth(0,l),i.setHours(0,0,0,0),i}}function Jj(s,n,i){var k,U,G,z;const a=G_(),l=(i==null?void 0:i.weekStartsOn)??((U=(k=i==null?void 0:i.locale)==null?void 0:k.options)==null?void 0:U.weekStartsOn)??a.weekStartsOn??((z=(G=a.locale)==null?void 0:G.options)==null?void 0:z.weekStartsOn)??0,p=dn(s,i==null?void 0:i.in),_=p.getDay(),w=(n%7+7)%7,C=7-l,O=n<0||n>6?n-(_+C)%7:(w+C)%7-(_+C)%7;return bd(p,O,i)}class TTe extends ni{constructor(){super(...arguments);Kt(this,"priority",90);Kt(this,"incompatibleTokens",["D","i","e","c","t","T"])}parse(i,a,l){switch(a){case"E":case"EE":case"EEE":return l.day(i,{width:"abbreviated",context:"formatting"})||l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"});case"EEEEE":return l.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"});case"EEEE":default:return l.day(i,{width:"wide",context:"formatting"})||l.day(i,{width:"abbreviated",context:"formatting"})||l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"})}}validate(i,a){return a>=0&&a<=6}set(i,a,l,p){return i=Jj(i,l,p),i.setHours(0,0,0,0),i}}class bTe extends ni{constructor(){super(...arguments);Kt(this,"priority",90);Kt(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"])}parse(i,a,l,p){const _=T=>{const w=Math.floor((T-1)/7)*7;return(T+p.weekStartsOn+6)%7+w};switch(a){case"e":case"ee":return Bs(ws(a.length,i),_);case"eo":return Bs(l.ordinalNumber(i,{unit:"day"}),_);case"eee":return l.day(i,{width:"abbreviated",context:"formatting"})||l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"});case"eeeee":return l.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"});case"eeee":default:return l.day(i,{width:"wide",context:"formatting"})||l.day(i,{width:"abbreviated",context:"formatting"})||l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"})}}validate(i,a){return a>=0&&a<=6}set(i,a,l,p){return i=Jj(i,l,p),i.setHours(0,0,0,0),i}}class wTe extends ni{constructor(){super(...arguments);Kt(this,"priority",90);Kt(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"])}parse(i,a,l,p){const _=T=>{const w=Math.floor((T-1)/7)*7;return(T+p.weekStartsOn+6)%7+w};switch(a){case"c":case"cc":return Bs(ws(a.length,i),_);case"co":return Bs(l.ordinalNumber(i,{unit:"day"}),_);case"ccc":return l.day(i,{width:"abbreviated",context:"standalone"})||l.day(i,{width:"short",context:"standalone"})||l.day(i,{width:"narrow",context:"standalone"});case"ccccc":return l.day(i,{width:"narrow",context:"standalone"});case"cccccc":return l.day(i,{width:"short",context:"standalone"})||l.day(i,{width:"narrow",context:"standalone"});case"cccc":default:return l.day(i,{width:"wide",context:"standalone"})||l.day(i,{width:"abbreviated",context:"standalone"})||l.day(i,{width:"short",context:"standalone"})||l.day(i,{width:"narrow",context:"standalone"})}}validate(i,a){return a>=0&&a<=6}set(i,a,l,p){return i=Jj(i,l,p),i.setHours(0,0,0,0),i}}function RTe(s,n,i){const a=dn(s,i==null?void 0:i.in),l=JSe(a,i),p=n-l;return bd(a,p,i)}class CTe extends ni{constructor(){super(...arguments);Kt(this,"priority",90);Kt(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"])}parse(i,a,l){const p=_=>_===0?7:_;switch(a){case"i":case"ii":return ws(a.length,i);case"io":return l.ordinalNumber(i,{unit:"day"});case"iii":return Bs(l.day(i,{width:"abbreviated",context:"formatting"})||l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"}),p);case"iiiii":return Bs(l.day(i,{width:"narrow",context:"formatting"}),p);case"iiiiii":return Bs(l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"}),p);case"iiii":default:return Bs(l.day(i,{width:"wide",context:"formatting"})||l.day(i,{width:"abbreviated",context:"formatting"})||l.day(i,{width:"short",context:"formatting"})||l.day(i,{width:"narrow",context:"formatting"}),p)}}validate(i,a){return a>=1&&a<=7}set(i,a,l){return i=RTe(i,l),i.setHours(0,0,0,0),i}}class ATe extends ni{constructor(){super(...arguments);Kt(this,"priority",80);Kt(this,"incompatibleTokens",["b","B","H","k","t","T"])}parse(i,a,l){switch(a){case"a":case"aa":case"aaa":return l.dayPeriod(i,{width:"abbreviated",context:"formatting"})||l.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaaa":return l.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return l.dayPeriod(i,{width:"wide",context:"formatting"})||l.dayPeriod(i,{width:"abbreviated",context:"formatting"})||l.dayPeriod(i,{width:"narrow",context:"formatting"})}}set(i,a,l){return i.setHours($j(l),0,0,0),i}}class ITe extends ni{constructor(){super(...arguments);Kt(this,"priority",80);Kt(this,"incompatibleTokens",["a","B","H","k","t","T"])}parse(i,a,l){switch(a){case"b":case"bb":case"bbb":return l.dayPeriod(i,{width:"abbreviated",context:"formatting"})||l.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbbb":return l.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return l.dayPeriod(i,{width:"wide",context:"formatting"})||l.dayPeriod(i,{width:"abbreviated",context:"formatting"})||l.dayPeriod(i,{width:"narrow",context:"formatting"})}}set(i,a,l){return i.setHours($j(l),0,0,0),i}}class NTe extends ni{constructor(){super(...arguments);Kt(this,"priority",80);Kt(this,"incompatibleTokens",["a","b","t","T"])}parse(i,a,l){switch(a){case"B":case"BB":case"BBB":return l.dayPeriod(i,{width:"abbreviated",context:"formatting"})||l.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBBB":return l.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return l.dayPeriod(i,{width:"wide",context:"formatting"})||l.dayPeriod(i,{width:"abbreviated",context:"formatting"})||l.dayPeriod(i,{width:"narrow",context:"formatting"})}}set(i,a,l){return i.setHours($j(l),0,0,0),i}}class OTe extends ni{constructor(){super(...arguments);Kt(this,"priority",70);Kt(this,"incompatibleTokens",["H","K","k","t","T"])}parse(i,a,l){switch(a){case"h":return hs(Fs.hour12h,i);case"ho":return l.ordinalNumber(i,{unit:"hour"});default:return ws(a.length,i)}}validate(i,a){return a>=1&&a<=12}set(i,a,l){const p=i.getHours()>=12;return p&&l<12?i.setHours(l+12,0,0,0):!p&&l===12?i.setHours(0,0,0,0):i.setHours(l,0,0,0),i}}class DTe extends ni{constructor(){super(...arguments);Kt(this,"priority",70);Kt(this,"incompatibleTokens",["a","b","h","K","k","t","T"])}parse(i,a,l){switch(a){case"H":return hs(Fs.hour23h,i);case"Ho":return l.ordinalNumber(i,{unit:"hour"});default:return ws(a.length,i)}}validate(i,a){return a>=0&&a<=23}set(i,a,l){return i.setHours(l,0,0,0),i}}class xTe extends ni{constructor(){super(...arguments);Kt(this,"priority",70);Kt(this,"incompatibleTokens",["h","H","k","t","T"])}parse(i,a,l){switch(a){case"K":return hs(Fs.hour11h,i);case"Ko":return l.ordinalNumber(i,{unit:"hour"});default:return ws(a.length,i)}}validate(i,a){return a>=0&&a<=11}set(i,a,l){return i.getHours()>=12&&l<12?i.setHours(l+12,0,0,0):i.setHours(l,0,0,0),i}}class PTe extends ni{constructor(){super(...arguments);Kt(this,"priority",70);Kt(this,"incompatibleTokens",["a","b","h","H","K","t","T"])}parse(i,a,l){switch(a){case"k":return hs(Fs.hour24h,i);case"ko":return l.ordinalNumber(i,{unit:"hour"});default:return ws(a.length,i)}}validate(i,a){return a>=1&&a<=24}set(i,a,l){const p=l<=24?l%24:l;return i.setHours(p,0,0,0),i}}class kTe extends ni{constructor(){super(...arguments);Kt(this,"priority",60);Kt(this,"incompatibleTokens",["t","T"])}parse(i,a,l){switch(a){case"m":return hs(Fs.minute,i);case"mo":return l.ordinalNumber(i,{unit:"minute"});default:return ws(a.length,i)}}validate(i,a){return a>=0&&a<=59}set(i,a,l){return i.setMinutes(l,0,0),i}}class LTe extends ni{constructor(){super(...arguments);Kt(this,"priority",50);Kt(this,"incompatibleTokens",["t","T"])}parse(i,a,l){switch(a){case"s":return hs(Fs.second,i);case"so":return l.ordinalNumber(i,{unit:"second"});default:return ws(a.length,i)}}validate(i,a){return a>=0&&a<=59}set(i,a,l){return i.setSeconds(l,0),i}}class MTe extends ni{constructor(){super(...arguments);Kt(this,"priority",30);Kt(this,"incompatibleTokens",["t","T"])}parse(i,a){const l=p=>Math.trunc(p*Math.pow(10,-a.length+3));return Bs(ws(a.length,i),l)}set(i,a,l){return i.setMilliseconds(l),i}}class jTe extends ni{constructor(){super(...arguments);Kt(this,"priority",10);Kt(this,"incompatibleTokens",["t","T","x"])}parse(i,a){switch(a){case"X":return ju(Mu.basicOptionalMinutes,i);case"XX":return ju(Mu.basic,i);case"XXXX":return ju(Mu.basicOptionalSeconds,i);case"XXXXX":return ju(Mu.extendedOptionalSeconds,i);case"XXX":default:return ju(Mu.extended,i)}}set(i,a,l){return a.timestampIsSet?i:Ti(i,i.getTime()-jO(i)-l)}}class UTe extends ni{constructor(){super(...arguments);Kt(this,"priority",10);Kt(this,"incompatibleTokens",["t","T","X"])}parse(i,a){switch(a){case"x":return ju(Mu.basicOptionalMinutes,i);case"xx":return ju(Mu.basic,i);case"xxxx":return ju(Mu.basicOptionalSeconds,i);case"xxxxx":return ju(Mu.extendedOptionalSeconds,i);case"xxx":default:return ju(Mu.extended,i)}}set(i,a,l){return a.timestampIsSet?i:Ti(i,i.getTime()-jO(i)-l)}}class VTe extends ni{constructor(){super(...arguments);Kt(this,"priority",40);Kt(this,"incompatibleTokens","*")}parse(i){return KX(i)}set(i,a,l){return[Ti(i,l*1e3),{timestampIsSet:!0}]}}class FTe extends ni{constructor(){super(...arguments);Kt(this,"priority",20);Kt(this,"incompatibleTokens","*")}parse(i){return KX(i)}set(i,a,l){return[Ti(i,l),{timestampIsSet:!0}]}}const BTe={G:new sTe,y:new aTe,Y:new oTe,R:new cTe,u:new lTe,Q:new dTe,q:new uTe,M:new hTe,L:new pTe,w:new mTe,I:new _Te,d:new vTe,D:new STe,E:new TTe,e:new bTe,c:new wTe,i:new CTe,a:new ATe,b:new ITe,B:new NTe,h:new OTe,H:new DTe,K:new xTe,k:new PTe,m:new kTe,s:new LTe,S:new MTe,X:new jTe,x:new UTe,t:new VTe,T:new FTe},HTe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,GTe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,WTe=/^'([^]*?)'?$/,zTe=/''/g,YTe=/\S/,qTe=/[a-zA-Z]/;function KTe(s,n,i,a){var X,ie,oe,ce,_e,se,be,ee;const l=()=>Ti((a==null?void 0:a.in)||i,NaN),p=$Se(),_=(a==null?void 0:a.locale)??p.locale??WX,T=(a==null?void 0:a.firstWeekContainsDate)??((ie=(X=a==null?void 0:a.locale)==null?void 0:X.options)==null?void 0:ie.firstWeekContainsDate)??p.firstWeekContainsDate??((ce=(oe=p.locale)==null?void 0:oe.options)==null?void 0:ce.firstWeekContainsDate)??1,w=(a==null?void 0:a.weekStartsOn)??((se=(_e=a==null?void 0:a.locale)==null?void 0:_e.options)==null?void 0:se.weekStartsOn)??p.weekStartsOn??((ee=(be=p.locale)==null?void 0:be.options)==null?void 0:ee.weekStartsOn)??0;if(!n)return s?l():dn(i,a==null?void 0:a.in);const C={firstWeekContainsDate:T,weekStartsOn:w,locale:_},O=[new iTe(a==null?void 0:a.in,i)],k=n.match(GTe).map(Q=>{const q=Q[0];if(q in N2){const ae=N2[q];return ae(Q,_.formatLong)}return Q}).join("").match(HTe),U=[];for(let Q of k){const q=Q[0],ae=BTe[q];if(ae){const{incompatibleTokens:re}=ae;if(Array.isArray(re)){const pe=U.find(Re=>re.includes(Re.token)||Re.token===q);if(pe)throw new RangeError(`The format string mustn't contain \`${pe.fullToken}\` and \`${Q}\` at the same time`)}else if(ae.incompatibleTokens==="*"&&U.length>0)throw new RangeError(`The format string mustn't contain \`${Q}\` and any other token at the same time`);U.push({token:q,fullToken:Q});const fe=ae.run(s,Q,_.match,C);if(!fe)return l();O.push(fe.setter),s=fe.rest}else{if(q.match(qTe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+q+"`");if(Q==="''"?Q="'":q==="'"&&(Q=XTe(Q)),s.indexOf(Q)===0)s=s.slice(Q.length);else return l()}}if(s.length>0&&YTe.test(s))return l();const G=O.map(Q=>Q.priority).sort((Q,q)=>q-Q).filter((Q,q,ae)=>ae.indexOf(Q)===q).map(Q=>O.filter(q=>q.priority===Q).sort((q,ae)=>ae.subPriority-q.subPriority)).map(Q=>Q[0]);let z=dn(i,a==null?void 0:a.in);if(isNaN(+z))return l();const J={};for(const Q of G){if(!Q.validate(z,C))return l();const q=Q.set(z,J,C);Array.isArray(q)?(z=q[0],Object.assign(J,q[1])):z=q}return z}function XTe(s){return s.match(WTe)[1].replace(zTe,"'")}function QTe(s,n,i){const[a,l]=Ep(i==null?void 0:i.in,s,n);return a.getFullYear()===l.getFullYear()&&a.getMonth()===l.getMonth()}function $Te(s,n,i){const[a,l]=Ep(i==null?void 0:i.in,s,n);return+I2(a)==+I2(l)}function JTe(s,n,i){const[a,l]=Ep(i==null?void 0:i.in,s,n);return a.getFullYear()===l.getFullYear()}function m0(s,n,i){const a=+dn(s,i==null?void 0:i.in),[l,p]=[+dn(n.start,i==null?void 0:i.in),+dn(n.end,i==null?void 0:i.in)].sort((_,T)=>_-T);return a>=l&&a<=p}function ZTe(s,n,i){return bd(s,-1,i)}function ebe(s,n){const i=()=>Ti(n==null?void 0:n.in,NaN),l=ibe(s);let p;if(l.date){const C=sbe(l.date,2);p=abe(C.restDateString,C.year)}if(!p||isNaN(+p))return i();const _=+p;let T=0,w;if(l.time&&(T=obe(l.time),isNaN(T)))return i();if(l.timezone){if(w=cbe(l.timezone),isNaN(w))return i()}else{const C=new Date(_+T),O=dn(0,n==null?void 0:n.in);return O.setFullYear(C.getUTCFullYear(),C.getUTCMonth(),C.getUTCDate()),O.setHours(C.getUTCHours(),C.getUTCMinutes(),C.getUTCSeconds(),C.getUTCMilliseconds()),O}return dn(_+T+w,n==null?void 0:n.in)}const lN={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},tbe=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,nbe=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,rbe=/^([+-])(\d{2})(?::?(\d{2}))?$/;function ibe(s){const n={},i=s.split(lN.dateTimeDelimiter);let a;if(i.length>2)return n;if(/:/.test(i[0])?a=i[0]:(n.date=i[0],a=i[1],lN.timeZoneDelimiter.test(n.date)&&(n.date=s.split(lN.timeZoneDelimiter)[0],a=s.substr(n.date.length,s.length))),a){const l=lN.timezone.exec(a);l?(n.time=a.replace(l[1],""),n.timezone=l[1]):n.time=a}return n}function sbe(s,n){const i=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+n)+"})|(\\d{2}|[+-]\\d{"+(2+n)+"})$)"),a=s.match(i);if(!a)return{year:NaN,restDateString:""};const l=a[1]?parseInt(a[1]):null,p=a[2]?parseInt(a[2]):null;return{year:p===null?l:p*100,restDateString:s.slice((a[1]||a[2]).length)}}function abe(s,n){if(n===null)return new Date(NaN);const i=s.match(tbe);if(!i)return new Date(NaN);const a=!!i[4],l=Iw(i[1]),p=Iw(i[2])-1,_=Iw(i[3]),T=Iw(i[4]),w=Iw(i[5])-1;if(a)return pbe(n,T,w)?lbe(n,T,w):new Date(NaN);{const C=new Date(0);return!ube(n,p,_)||!hbe(n,l)?new Date(NaN):(C.setUTCFullYear(n,p,Math.max(l,_)),C)}}function Iw(s){return s?parseInt(s):1}function obe(s){const n=s.match(nbe);if(!n)return NaN;const i=gM(n[1]),a=gM(n[2]),l=gM(n[3]);return fbe(i,a,l)?i*kD+a*PD+l*1e3:NaN}function gM(s){return s&&parseFloat(s.replace(",","."))||0}function cbe(s){if(s==="Z")return 0;const n=s.match(rbe);if(!n)return 0;const i=n[1]==="+"?-1:1,a=parseInt(n[2]),l=n[3]&&parseInt(n[3])||0;return mbe(a,l)?i*(a*kD+l*PD):NaN}function lbe(s,n,i){const a=new Date(0);a.setUTCFullYear(s,0,4);const l=a.getUTCDay()||7,p=(n-1)*7+i+1-l;return a.setUTCDate(a.getUTCDate()+p),a}const dbe=[31,null,31,30,31,30,31,31,30,31,30,31];function $X(s){return s%400===0||s%4===0&&s%100!==0}function ube(s,n,i){return n>=0&&n<=11&&i>=1&&i<=(dbe[n]||($X(s)?29:28))}function hbe(s,n){return n>=1&&n<=($X(s)?366:365)}function pbe(s,n,i){return n>=1&&n<=53&&i>=0&&i<=6}function fbe(s,n,i){return s===24?n===0&&i===0:i>=0&&i<60&&n>=0&&n<60&&s>=0&&s<25}function mbe(s,n){return n>=0&&n<=59}function xl(s,n,i){const a=dn(s,i==null?void 0:i.in),l=a.getFullYear(),p=a.getDate(),_=Ti(s,0);_.setFullYear(l,n,15),_.setHours(0,0,0,0);const T=QSe(_);return a.setMonth(n,Math.min(p,T)),a}function iO(s,n,i){const a=dn(s,i==null?void 0:i.in);return a.setHours(n),a}function sO(s,n,i){const a=dn(s,i==null?void 0:i.in);return a.setMinutes(n),a}function Nv(s,n,i){const a=dn(s,i==null?void 0:i.in),l=Math.trunc(a.getMonth()/3)+1,p=n-l;return xl(a,a.getMonth()+p*3)}function aO(s,n,i){const a=dn(s,i==null?void 0:i.in);return a.setSeconds(n),a}function Pu(s,n,i){const a=dn(s,i==null?void 0:i.in);return isNaN(+a)?Ti(s,NaN):(a.setFullYear(n),a)}function C_(s,n,i){return Cd(s,-n,i)}function JX(s,n,i){return Kj(s,-1,i)}function sY(s,n,i){return UO(s,-1,i)}function Xv(s,n,i){return ip(s,-n,i)}function MD(){return typeof window<"u"}function uS(s){return ZX(s)?(s.nodeName||"").toLowerCase():"#document"}function Bc(s){var n;return(s==null||(n=s.ownerDocument)==null?void 0:n.defaultView)||window}function zu(s){var n;return(n=(ZX(s)?s.ownerDocument:s.document)||window.document)==null?void 0:n.documentElement}function ZX(s){return MD()?s instanceof Node||s instanceof Bc(s).Node:!1}function jo(s){return MD()?s instanceof Element||s instanceof Bc(s).Element:!1}function Wu(s){return MD()?s instanceof HTMLElement||s instanceof Bc(s).HTMLElement:!1}function aY(s){return!MD()||typeof ShadowRoot>"u"?!1:s instanceof ShadowRoot||s instanceof Bc(s).ShadowRoot}const gbe=new Set(["inline","contents"]);function O0(s){const{overflow:n,overflowX:i,overflowY:a,display:l}=Ll(s);return/auto|scroll|overlay|hidden|clip/.test(n+a+i)&&!gbe.has(l)}const _be=new Set(["table","td","th"]);function Ebe(s){return _be.has(uS(s))}const ybe=[":popover-open",":modal"];function jD(s){return ybe.some(n=>{try{return s.matches(n)}catch{return!1}})}const vbe=["transform","translate","scale","rotate","perspective"],Sbe=["transform","translate","scale","rotate","perspective","filter"],Tbe=["paint","layout","strict","content"];function Zj(s){const n=eU(),i=jo(s)?Ll(s):s;return vbe.some(a=>i[a]?i[a]!=="none":!1)||(i.containerType?i.containerType!=="normal":!1)||!n&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!n&&(i.filter?i.filter!=="none":!1)||Sbe.some(a=>(i.willChange||"").includes(a))||Tbe.some(a=>(i.contain||"").includes(a))}function bbe(s){let n=am(s);for(;Wu(n)&&!Qv(n);){if(Zj(n))return n;if(jD(n))return null;n=am(n)}return null}function eU(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const wbe=new Set(["html","body","#document"]);function Qv(s){return wbe.has(uS(s))}function Ll(s){return Bc(s).getComputedStyle(s)}function UD(s){return jo(s)?{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}:{scrollLeft:s.scrollX,scrollTop:s.scrollY}}function am(s){if(uS(s)==="html")return s;const n=s.assignedSlot||s.parentNode||aY(s)&&s.host||zu(s);return aY(n)?n.host:n}function eQ(s){const n=am(s);return Qv(n)?s.ownerDocument?s.ownerDocument.body:s.body:Wu(n)&&O0(n)?n:eQ(n)}function g0(s,n,i){var a;n===void 0&&(n=[]),i===void 0&&(i=!0);const l=eQ(s),p=l===((a=s.ownerDocument)==null?void 0:a.body),_=Bc(l);if(p){const T=D2(_);return n.concat(_,_.visualViewport||[],O0(l)?l:[],T&&i?g0(T):[])}return n.concat(l,g0(l,[],i))}function D2(s){return s.parent&&Object.getPrototypeOf(s.parent)?s.frameElement:null}const $v=Math.min,A_=Math.max,WO=Math.round,dN=Math.floor,Hu=s=>({x:s,y:s}),Rbe={left:"right",right:"left",bottom:"top",top:"bottom"},Cbe={start:"end",end:"start"};function Abe(s,n,i){return A_(s,$v(n,i))}function VD(s,n){return typeof s=="function"?s(n):s}function Jv(s){return s.split("-")[0]}function D0(s){return s.split("-")[1]}function Ibe(s){return s==="x"?"y":"x"}function tU(s){return s==="y"?"height":"width"}const Nbe=new Set(["top","bottom"]);function E_(s){return Nbe.has(Jv(s))?"y":"x"}function nU(s){return Ibe(E_(s))}function Obe(s,n,i){i===void 0&&(i=!1);const a=D0(s),l=nU(s),p=tU(l);let _=l==="x"?a===(i?"end":"start")?"right":"left":a==="start"?"bottom":"top";return n.reference[p]>n.floating[p]&&(_=zO(_)),[_,zO(_)]}function Dbe(s){const n=zO(s);return[x2(s),n,x2(n)]}function x2(s){return s.replace(/start|end/g,n=>Cbe[n])}const oY=["left","right"],cY=["right","left"],xbe=["top","bottom"],Pbe=["bottom","top"];function kbe(s,n,i){switch(s){case"top":case"bottom":return i?n?cY:oY:n?oY:cY;case"left":case"right":return n?xbe:Pbe;default:return[]}}function Lbe(s,n,i,a){const l=D0(s);let p=kbe(Jv(s),i==="start",a);return l&&(p=p.map(_=>_+"-"+l),n&&(p=p.concat(p.map(x2)))),p}function zO(s){return s.replace(/left|right|bottom|top/g,n=>Rbe[n])}function Mbe(s){return{top:0,right:0,bottom:0,left:0,...s}}function tQ(s){return typeof s!="number"?Mbe(s):{top:s,right:s,bottom:s,left:s}}function YO(s){const{x:n,y:i,width:a,height:l}=s;return{width:a,height:l,top:i,left:n,right:n+a,bottom:i+l,x:n,y:i}}var jbe=typeof document<"u",Ube=function(){},qO=jbe?F.useLayoutEffect:Ube;const Vbe={...LY},Fbe=Vbe.useInsertionEffect,Bbe=Fbe||(s=>s());function Hbe(s){const n=F.useRef(()=>{});return Bbe(()=>{n.current=s}),F.useCallback(function(){for(var i=arguments.length,a=new Array(i),l=0;l<i;l++)a[l]=arguments[l];return n.current==null?void 0:n.current(...a)},[])}function lY(s,n,i){let{reference:a,floating:l}=s;const p=E_(n),_=nU(n),T=tU(_),w=Jv(n),C=p==="y",O=a.x+a.width/2-l.width/2,k=a.y+a.height/2-l.height/2,U=a[T]/2-l[T]/2;let G;switch(w){case"top":G={x:O,y:a.y-l.height};break;case"bottom":G={x:O,y:a.y+a.height};break;case"right":G={x:a.x+a.width,y:k};break;case"left":G={x:a.x-l.width,y:k};break;default:G={x:a.x,y:a.y}}switch(D0(n)){case"start":G[_]-=U*(i&&C?-1:1);break;case"end":G[_]+=U*(i&&C?-1:1);break}return G}const Gbe=async(s,n,i)=>{const{placement:a="bottom",strategy:l="absolute",middleware:p=[],platform:_}=i,T=p.filter(Boolean),w=await(_.isRTL==null?void 0:_.isRTL(n));let C=await _.getElementRects({reference:s,floating:n,strategy:l}),{x:O,y:k}=lY(C,a,w),U=a,G={},z=0;for(let J=0;J<T.length;J++){const{name:X,fn:ie}=T[J],{x:oe,y:ce,data:_e,reset:se}=await ie({x:O,y:k,initialPlacement:a,placement:U,strategy:l,middlewareData:G,rects:C,platform:_,elements:{reference:s,floating:n}});O=oe??O,k=ce??k,G={...G,[X]:{...G[X],..._e}},se&&z<=50&&(z++,typeof se=="object"&&(se.placement&&(U=se.placement),se.rects&&(C=se.rects===!0?await _.getElementRects({reference:s,floating:n,strategy:l}):se.rects),{x:O,y:k}=lY(C,U,w)),J=-1)}return{x:O,y:k,placement:U,strategy:l,middlewareData:G}};async function Wbe(s,n){var i;n===void 0&&(n={});const{x:a,y:l,platform:p,rects:_,elements:T,strategy:w}=s,{boundary:C="clippingAncestors",rootBoundary:O="viewport",elementContext:k="floating",altBoundary:U=!1,padding:G=0}=VD(n,s),z=tQ(G),X=T[U?k==="floating"?"reference":"floating":k],ie=YO(await p.getClippingRect({element:(i=await(p.isElement==null?void 0:p.isElement(X)))==null||i?X:X.contextElement||await(p.getDocumentElement==null?void 0:p.getDocumentElement(T.floating)),boundary:C,rootBoundary:O,strategy:w})),oe=k==="floating"?{x:a,y:l,width:_.floating.width,height:_.floating.height}:_.reference,ce=await(p.getOffsetParent==null?void 0:p.getOffsetParent(T.floating)),_e=await(p.isElement==null?void 0:p.isElement(ce))?await(p.getScale==null?void 0:p.getScale(ce))||{x:1,y:1}:{x:1,y:1},se=YO(p.convertOffsetParentRelativeRectToViewportRelativeRect?await p.convertOffsetParentRelativeRectToViewportRelativeRect({elements:T,rect:oe,offsetParent:ce,strategy:w}):oe);return{top:(ie.top-se.top+z.top)/_e.y,bottom:(se.bottom-ie.bottom+z.bottom)/_e.y,left:(ie.left-se.left+z.left)/_e.x,right:(se.right-ie.right+z.right)/_e.x}}const zbe=s=>({name:"arrow",options:s,async fn(n){const{x:i,y:a,placement:l,rects:p,platform:_,elements:T,middlewareData:w}=n,{element:C,padding:O=0}=VD(s,n)||{};if(C==null)return{};const k=tQ(O),U={x:i,y:a},G=nU(l),z=tU(G),J=await _.getDimensions(C),X=G==="y",ie=X?"top":"left",oe=X?"bottom":"right",ce=X?"clientHeight":"clientWidth",_e=p.reference[z]+p.reference[G]-U[G]-p.floating[z],se=U[G]-p.reference[G],be=await(_.getOffsetParent==null?void 0:_.getOffsetParent(C));let ee=be?be[ce]:0;(!ee||!await(_.isElement==null?void 0:_.isElement(be)))&&(ee=T.floating[ce]||p.floating[z]);const Q=_e/2-se/2,q=ee/2-J[z]/2-1,ae=$v(k[ie],q),re=$v(k[oe],q),fe=ae,pe=ee-J[z]-re,Re=ee/2-J[z]/2+Q,Ge=Abe(fe,Re,pe),ve=!w.arrow&&D0(l)!=null&&Re!==Ge&&p.reference[z]/2-(Re<fe?ae:re)-J[z]/2<0,Ne=ve?Re<fe?Re-fe:Re-pe:0;return{[G]:U[G]+Ne,data:{[G]:Ge,centerOffset:Re-Ge-Ne,...ve&&{alignmentOffset:Ne}},reset:ve}}}),Ybe=function(s){return s===void 0&&(s={}),{name:"flip",options:s,async fn(n){var i,a;const{placement:l,middlewareData:p,rects:_,initialPlacement:T,platform:w,elements:C}=n,{mainAxis:O=!0,crossAxis:k=!0,fallbackPlacements:U,fallbackStrategy:G="bestFit",fallbackAxisSideDirection:z="none",flipAlignment:J=!0,...X}=VD(s,n);if((i=p.arrow)!=null&&i.alignmentOffset)return{};const ie=Jv(l),oe=E_(T),ce=Jv(T)===T,_e=await(w.isRTL==null?void 0:w.isRTL(C.floating)),se=U||(ce||!J?[zO(T)]:Dbe(T)),be=z!=="none";!U&&be&&se.push(...Lbe(T,J,z,_e));const ee=[T,...se],Q=await Wbe(n,X),q=[];let ae=((a=p.flip)==null?void 0:a.overflows)||[];if(O&&q.push(Q[ie]),k){const Re=Obe(l,_,_e);q.push(Q[Re[0]],Q[Re[1]])}if(ae=[...ae,{placement:l,overflows:q}],!q.every(Re=>Re<=0)){var re,fe;const Re=(((re=p.flip)==null?void 0:re.index)||0)+1,Ge=ee[Re];if(Ge&&(!(k==="alignment"?oe!==E_(Ge):!1)||ae.every(Ce=>Ce.overflows[0]>0&&E_(Ce.placement)===oe)))return{data:{index:Re,overflows:ae},reset:{placement:Ge}};let ve=(fe=ae.filter(Ne=>Ne.overflows[0]<=0).sort((Ne,Ce)=>Ne.overflows[1]-Ce.overflows[1])[0])==null?void 0:fe.placement;if(!ve)switch(G){case"bestFit":{var pe;const Ne=(pe=ae.filter(Ce=>{if(be){const Ue=E_(Ce.placement);return Ue===oe||Ue==="y"}return!0}).map(Ce=>[Ce.placement,Ce.overflows.filter(Ue=>Ue>0).reduce((Ue,de)=>Ue+de,0)]).sort((Ce,Ue)=>Ce[1]-Ue[1])[0])==null?void 0:pe[0];Ne&&(ve=Ne);break}case"initialPlacement":ve=T;break}if(l!==ve)return{reset:{placement:ve}}}return{}}}},qbe=new Set(["left","top"]);async function Kbe(s,n){const{placement:i,platform:a,elements:l}=s,p=await(a.isRTL==null?void 0:a.isRTL(l.floating)),_=Jv(i),T=D0(i),w=E_(i)==="y",C=qbe.has(_)?-1:1,O=p&&w?-1:1,k=VD(n,s);let{mainAxis:U,crossAxis:G,alignmentAxis:z}=typeof k=="number"?{mainAxis:k,crossAxis:0,alignmentAxis:null}:{mainAxis:k.mainAxis||0,crossAxis:k.crossAxis||0,alignmentAxis:k.alignmentAxis};return T&&typeof z=="number"&&(G=T==="end"?z*-1:z),w?{x:G*O,y:U*C}:{x:U*C,y:G*O}}const Xbe=function(s){return s===void 0&&(s=0),{name:"offset",options:s,async fn(n){var i,a;const{x:l,y:p,placement:_,middlewareData:T}=n,w=await Kbe(n,s);return _===((i=T.offset)==null?void 0:i.placement)&&(a=T.arrow)!=null&&a.alignmentOffset?{}:{x:l+w.x,y:p+w.y,data:{...w,placement:_}}}}};function nQ(s){const n=Ll(s);let i=parseFloat(n.width)||0,a=parseFloat(n.height)||0;const l=Wu(s),p=l?s.offsetWidth:i,_=l?s.offsetHeight:a,T=WO(i)!==p||WO(a)!==_;return T&&(i=p,a=_),{width:i,height:a,$:T}}function rU(s){return jo(s)?s:s.contextElement}function Mv(s){const n=rU(s);if(!Wu(n))return Hu(1);const i=n.getBoundingClientRect(),{width:a,height:l,$:p}=nQ(n);let _=(p?WO(i.width):i.width)/a,T=(p?WO(i.height):i.height)/l;return(!_||!Number.isFinite(_))&&(_=1),(!T||!Number.isFinite(T))&&(T=1),{x:_,y:T}}const Qbe=Hu(0);function rQ(s){const n=Bc(s);return!eU()||!n.visualViewport?Qbe:{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}}function $be(s,n,i){return n===void 0&&(n=!1),!i||n&&i!==Bc(s)?!1:n}function j_(s,n,i,a){n===void 0&&(n=!1),i===void 0&&(i=!1);const l=s.getBoundingClientRect(),p=rU(s);let _=Hu(1);n&&(a?jo(a)&&(_=Mv(a)):_=Mv(s));const T=$be(p,i,a)?rQ(p):Hu(0);let w=(l.left+T.x)/_.x,C=(l.top+T.y)/_.y,O=l.width/_.x,k=l.height/_.y;if(p){const U=Bc(p),G=a&&jo(a)?Bc(a):a;let z=U,J=D2(z);for(;J&&a&&G!==z;){const X=Mv(J),ie=J.getBoundingClientRect(),oe=Ll(J),ce=ie.left+(J.clientLeft+parseFloat(oe.paddingLeft))*X.x,_e=ie.top+(J.clientTop+parseFloat(oe.paddingTop))*X.y;w*=X.x,C*=X.y,O*=X.x,k*=X.y,w+=ce,C+=_e,z=Bc(J),J=D2(z)}}return YO({width:O,height:k,x:w,y:C})}function iU(s,n){const i=UD(s).scrollLeft;return n?n.left+i:j_(zu(s)).left+i}function iQ(s,n,i){i===void 0&&(i=!1);const a=s.getBoundingClientRect(),l=a.left+n.scrollLeft-(i?0:iU(s,a)),p=a.top+n.scrollTop;return{x:l,y:p}}function Jbe(s){let{elements:n,rect:i,offsetParent:a,strategy:l}=s;const p=l==="fixed",_=zu(a),T=n?jD(n.floating):!1;if(a===_||T&&p)return i;let w={scrollLeft:0,scrollTop:0},C=Hu(1);const O=Hu(0),k=Wu(a);if((k||!k&&!p)&&((uS(a)!=="body"||O0(_))&&(w=UD(a)),Wu(a))){const G=j_(a);C=Mv(a),O.x=G.x+a.clientLeft,O.y=G.y+a.clientTop}const U=_&&!k&&!p?iQ(_,w,!0):Hu(0);return{width:i.width*C.x,height:i.height*C.y,x:i.x*C.x-w.scrollLeft*C.x+O.x+U.x,y:i.y*C.y-w.scrollTop*C.y+O.y+U.y}}function Zbe(s){return Array.from(s.getClientRects())}function ewe(s){const n=zu(s),i=UD(s),a=s.ownerDocument.body,l=A_(n.scrollWidth,n.clientWidth,a.scrollWidth,a.clientWidth),p=A_(n.scrollHeight,n.clientHeight,a.scrollHeight,a.clientHeight);let _=-i.scrollLeft+iU(s);const T=-i.scrollTop;return Ll(a).direction==="rtl"&&(_+=A_(n.clientWidth,a.clientWidth)-l),{width:l,height:p,x:_,y:T}}function twe(s,n){const i=Bc(s),a=zu(s),l=i.visualViewport;let p=a.clientWidth,_=a.clientHeight,T=0,w=0;if(l){p=l.width,_=l.height;const C=eU();(!C||C&&n==="fixed")&&(T=l.offsetLeft,w=l.offsetTop)}return{width:p,height:_,x:T,y:w}}const nwe=new Set(["absolute","fixed"]);function rwe(s,n){const i=j_(s,!0,n==="fixed"),a=i.top+s.clientTop,l=i.left+s.clientLeft,p=Wu(s)?Mv(s):Hu(1),_=s.clientWidth*p.x,T=s.clientHeight*p.y,w=l*p.x,C=a*p.y;return{width:_,height:T,x:w,y:C}}function dY(s,n,i){let a;if(n==="viewport")a=twe(s,i);else if(n==="document")a=ewe(zu(s));else if(jo(n))a=rwe(n,i);else{const l=rQ(s);a={x:n.x-l.x,y:n.y-l.y,width:n.width,height:n.height}}return YO(a)}function sQ(s,n){const i=am(s);return i===n||!jo(i)||Qv(i)?!1:Ll(i).position==="fixed"||sQ(i,n)}function iwe(s,n){const i=n.get(s);if(i)return i;let a=g0(s,[],!1).filter(T=>jo(T)&&uS(T)!=="body"),l=null;const p=Ll(s).position==="fixed";let _=p?am(s):s;for(;jo(_)&&!Qv(_);){const T=Ll(_),w=Zj(_);!w&&T.position==="fixed"&&(l=null),(p?!w&&!l:!w&&T.position==="static"&&!!l&&nwe.has(l.position)||O0(_)&&!w&&sQ(s,_))?a=a.filter(O=>O!==_):l=T,_=am(_)}return n.set(s,a),a}function swe(s){let{element:n,boundary:i,rootBoundary:a,strategy:l}=s;const _=[...i==="clippingAncestors"?jD(n)?[]:iwe(n,this._c):[].concat(i),a],T=_[0],w=_.reduce((C,O)=>{const k=dY(n,O,l);return C.top=A_(k.top,C.top),C.right=$v(k.right,C.right),C.bottom=$v(k.bottom,C.bottom),C.left=A_(k.left,C.left),C},dY(n,T,l));return{width:w.right-w.left,height:w.bottom-w.top,x:w.left,y:w.top}}function awe(s){const{width:n,height:i}=nQ(s);return{width:n,height:i}}function owe(s,n,i){const a=Wu(n),l=zu(n),p=i==="fixed",_=j_(s,!0,p,n);let T={scrollLeft:0,scrollTop:0};const w=Hu(0);function C(){w.x=iU(l)}if(a||!a&&!p)if((uS(n)!=="body"||O0(l))&&(T=UD(n)),a){const G=j_(n,!0,p,n);w.x=G.x+n.clientLeft,w.y=G.y+n.clientTop}else l&&C();p&&!a&&l&&C();const O=l&&!a&&!p?iQ(l,T):Hu(0),k=_.left+T.scrollLeft-w.x-O.x,U=_.top+T.scrollTop-w.y-O.y;return{x:k,y:U,width:_.width,height:_.height}}function _M(s){return Ll(s).position==="static"}function uY(s,n){if(!Wu(s)||Ll(s).position==="fixed")return null;if(n)return n(s);let i=s.offsetParent;return zu(s)===i&&(i=i.ownerDocument.body),i}function aQ(s,n){const i=Bc(s);if(jD(s))return i;if(!Wu(s)){let l=am(s);for(;l&&!Qv(l);){if(jo(l)&&!_M(l))return l;l=am(l)}return i}let a=uY(s,n);for(;a&&Ebe(a)&&_M(a);)a=uY(a,n);return a&&Qv(a)&&_M(a)&&!Zj(a)?i:a||bbe(s)||i}const cwe=async function(s){const n=this.getOffsetParent||aQ,i=this.getDimensions,a=await i(s.floating);return{reference:owe(s.reference,await n(s.floating),s.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}};function lwe(s){return Ll(s).direction==="rtl"}const dwe={convertOffsetParentRelativeRectToViewportRelativeRect:Jbe,getDocumentElement:zu,getClippingRect:swe,getOffsetParent:aQ,getElementRects:cwe,getClientRects:Zbe,getDimensions:awe,getScale:Mv,isElement:jo,isRTL:lwe};function oQ(s,n){return s.x===n.x&&s.y===n.y&&s.width===n.width&&s.height===n.height}function uwe(s,n){let i=null,a;const l=zu(s);function p(){var T;clearTimeout(a),(T=i)==null||T.disconnect(),i=null}function _(T,w){T===void 0&&(T=!1),w===void 0&&(w=1),p();const C=s.getBoundingClientRect(),{left:O,top:k,width:U,height:G}=C;if(T||n(),!U||!G)return;const z=dN(k),J=dN(l.clientWidth-(O+U)),X=dN(l.clientHeight-(k+G)),ie=dN(O),ce={rootMargin:-z+"px "+-J+"px "+-X+"px "+-ie+"px",threshold:A_(0,$v(1,w))||1};let _e=!0;function se(be){const ee=be[0].intersectionRatio;if(ee!==w){if(!_e)return _();ee?_(!1,ee):a=setTimeout(()=>{_(!1,1e-7)},1e3)}ee===1&&!oQ(C,s.getBoundingClientRect())&&_(),_e=!1}try{i=new IntersectionObserver(se,{...ce,root:l.ownerDocument})}catch{i=new IntersectionObserver(se,ce)}i.observe(s)}return _(!0),p}function hwe(s,n,i,a){a===void 0&&(a={});const{ancestorScroll:l=!0,ancestorResize:p=!0,elementResize:_=typeof ResizeObserver=="function",layoutShift:T=typeof IntersectionObserver=="function",animationFrame:w=!1}=a,C=rU(s),O=l||p?[...C?g0(C):[],...g0(n)]:[];O.forEach(ie=>{l&&ie.addEventListener("scroll",i,{passive:!0}),p&&ie.addEventListener("resize",i)});const k=C&&T?uwe(C,i):null;let U=-1,G=null;_&&(G=new ResizeObserver(ie=>{let[oe]=ie;oe&&oe.target===C&&G&&(G.unobserve(n),cancelAnimationFrame(U),U=requestAnimationFrame(()=>{var ce;(ce=G)==null||ce.observe(n)})),i()}),C&&!w&&G.observe(C),G.observe(n));let z,J=w?j_(s):null;w&&X();function X(){const ie=j_(s);J&&!oQ(J,ie)&&i(),J=ie,z=requestAnimationFrame(X)}return i(),()=>{var ie;O.forEach(oe=>{l&&oe.removeEventListener("scroll",i),p&&oe.removeEventListener("resize",i)}),k==null||k(),(ie=G)==null||ie.disconnect(),G=null,w&&cancelAnimationFrame(z)}}const pwe=Xbe,fwe=Ybe,hY=zbe,mwe=(s,n,i)=>{const a=new Map,l={platform:dwe,...i},p={...l.platform,_c:a};return Gbe(s,n,{...l,platform:p})};var gwe=typeof document<"u",_we=function(){},oO=gwe?F.useLayoutEffect:_we;function KO(s,n){if(s===n)return!0;if(typeof s!=typeof n)return!1;if(typeof s=="function"&&s.toString()===n.toString())return!0;let i,a,l;if(s&&n&&typeof s=="object"){if(Array.isArray(s)){if(i=s.length,i!==n.length)return!1;for(a=i;a--!==0;)if(!KO(s[a],n[a]))return!1;return!0}if(l=Object.keys(s),i=l.length,i!==Object.keys(n).length)return!1;for(a=i;a--!==0;)if(!{}.hasOwnProperty.call(n,l[a]))return!1;for(a=i;a--!==0;){const p=l[a];if(!(p==="_owner"&&s.$$typeof)&&!KO(s[p],n[p]))return!1}return!0}return s!==s&&n!==n}function cQ(s){return typeof window>"u"?1:(s.ownerDocument.defaultView||window).devicePixelRatio||1}function pY(s,n){const i=cQ(s);return Math.round(n*i)/i}function EM(s){const n=F.useRef(s);return oO(()=>{n.current=s}),n}function Ewe(s){s===void 0&&(s={});const{placement:n="bottom",strategy:i="absolute",middleware:a=[],platform:l,elements:{reference:p,floating:_}={},transform:T=!0,whileElementsMounted:w,open:C}=s,[O,k]=F.useState({x:0,y:0,strategy:i,placement:n,middlewareData:{},isPositioned:!1}),[U,G]=F.useState(a);KO(U,a)||G(a);const[z,J]=F.useState(null),[X,ie]=F.useState(null),oe=F.useCallback(Ce=>{Ce!==be.current&&(be.current=Ce,J(Ce))},[]),ce=F.useCallback(Ce=>{Ce!==ee.current&&(ee.current=Ce,ie(Ce))},[]),_e=p||z,se=_||X,be=F.useRef(null),ee=F.useRef(null),Q=F.useRef(O),q=w!=null,ae=EM(w),re=EM(l),fe=EM(C),pe=F.useCallback(()=>{if(!be.current||!ee.current)return;const Ce={placement:n,strategy:i,middleware:U};re.current&&(Ce.platform=re.current),mwe(be.current,ee.current,Ce).then(Ue=>{const de={...Ue,isPositioned:fe.current!==!1};Re.current&&!KO(Q.current,de)&&(Q.current=de,$Y.flushSync(()=>{k(de)}))})},[U,n,i,re,fe]);oO(()=>{C===!1&&Q.current.isPositioned&&(Q.current.isPositioned=!1,k(Ce=>({...Ce,isPositioned:!1})))},[C]);const Re=F.useRef(!1);oO(()=>(Re.current=!0,()=>{Re.current=!1}),[]),oO(()=>{if(_e&&(be.current=_e),se&&(ee.current=se),_e&&se){if(ae.current)return ae.current(_e,se,pe);pe()}},[_e,se,pe,ae,q]);const Ge=F.useMemo(()=>({reference:be,floating:ee,setReference:oe,setFloating:ce}),[oe,ce]),ve=F.useMemo(()=>({reference:_e,floating:se}),[_e,se]),Ne=F.useMemo(()=>{const Ce={position:i,left:0,top:0};if(!ve.floating)return Ce;const Ue=pY(ve.floating,O.x),de=pY(ve.floating,O.y);return T?{...Ce,transform:"translate("+Ue+"px, "+de+"px)",...cQ(ve.floating)>=1.5&&{willChange:"transform"}}:{position:i,left:Ue,top:de}},[i,T,ve.floating,O.x,O.y]);return F.useMemo(()=>({...O,update:pe,refs:Ge,elements:ve,floatingStyles:Ne}),[O,pe,Ge,ve,Ne])}const ywe=s=>{function n(i){return{}.hasOwnProperty.call(i,"current")}return{name:"arrow",options:s,fn(i){const{element:a,padding:l}=typeof s=="function"?s(i):s;return a&&n(a)?a.current!=null?hY({element:a.current,padding:l}).fn(i):{}:a?hY({element:a,padding:l}).fn(i):{}}}},vwe=(s,n)=>({...pwe(s),options:[s,n]}),Swe=(s,n)=>({...fwe(s),options:[s,n]}),Twe=(s,n)=>({...ywe(s),options:[s,n]}),bwe={...LY};let fY=!1,wwe=0;const mY=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+wwe++;function Rwe(){const[s,n]=F.useState(()=>fY?mY():void 0);return qO(()=>{s==null&&n(mY())},[]),F.useEffect(()=>{fY=!0},[]),s}const Cwe=bwe.useId,lQ=Cwe||Rwe,Awe=F.forwardRef(function(n,i){const{context:{placement:a,elements:{floating:l},middlewareData:{arrow:p,shift:_}},width:T=14,height:w=7,tipRadius:C=0,strokeWidth:O=0,staticOffset:k,stroke:U,d:G,style:{transform:z,...J}={},...X}=n,ie=lQ(),[oe,ce]=F.useState(!1);if(qO(()=>{if(!l)return;Ll(l).direction==="rtl"&&ce(!0)},[l]),!l)return null;const[_e,se]=a.split("-"),be=_e==="top"||_e==="bottom";let ee=k;(be&&_!=null&&_.x||!be&&_!=null&&_.y)&&(ee=null);const Q=O*2,q=Q/2,ae=T/2*(C/-8+1),re=w/2*C/4,fe=!!G,pe=ee&&se==="end"?"bottom":"top";let Re=ee&&se==="end"?"right":"left";ee&&oe&&(Re=se==="end"?"left":"right");const Ge=(p==null?void 0:p.x)!=null?ee||p.x:"",ve=(p==null?void 0:p.y)!=null?ee||p.y:"",Ne=G||"M0,0"+(" H"+T)+(" L"+(T-ae)+","+(w-re))+(" Q"+T/2+","+w+" "+ae+","+(w-re))+" Z",Ce={top:fe?"rotate(180deg)":"",left:fe?"rotate(90deg)":"rotate(-90deg)",bottom:fe?"":"rotate(180deg)",right:fe?"rotate(-90deg)":"rotate(90deg)"}[_e];return m.jsxs("svg",{...X,"aria-hidden":!0,ref:i,width:fe?T:T+Q,height:T,viewBox:"0 0 "+T+" "+(w>T?w:T),style:{position:"absolute",pointerEvents:"none",[Re]:Ge,[pe]:ve,[_e]:be||fe?"100%":"calc(100% - "+Q/2+"px)",transform:[Ce,z].filter(Ue=>!!Ue).join(" "),...J},children:[Q>0&&m.jsx("path",{clipPath:"url(#"+ie+")",fill:"none",stroke:U,strokeWidth:Q+(G?0:1),d:Ne}),m.jsx("path",{stroke:Q&&!G?X.fill:"none",d:Ne}),m.jsx("clipPath",{id:ie,children:m.jsx("rect",{x:-q,y:q*(fe?-1:1),width:T+Q,height:T})})]})});function Iwe(){const s=new Map;return{emit(n,i){var a;(a=s.get(n))==null||a.forEach(l=>l(i))},on(n,i){s.has(n)||s.set(n,new Set),s.get(n).add(i)},off(n,i){var a;(a=s.get(n))==null||a.delete(i)}}}const Nwe=F.createContext(null),Owe=F.createContext(null),Dwe=()=>{var s;return((s=F.useContext(Nwe))==null?void 0:s.id)||null},xwe=()=>F.useContext(Owe);function Pwe(s){const{open:n=!1,onOpenChange:i,elements:a}=s,l=lQ(),p=F.useRef({}),[_]=F.useState(()=>Iwe()),T=Dwe()!=null,[w,C]=F.useState(a.reference),O=Hbe((G,z,J)=>{p.current.openEvent=G?z:void 0,_.emit("openchange",{open:G,event:z,reason:J,nested:T}),i==null||i(G,z,J)}),k=F.useMemo(()=>({setPositionReference:C}),[]),U=F.useMemo(()=>({reference:w||a.reference||null,floating:a.floating||null,domReference:a.reference}),[w,a.reference,a.floating]);return F.useMemo(()=>({dataRef:p,open:n,onOpenChange:O,elements:U,events:_,floatingId:l,refs:k}),[n,O,U,_,l,k])}function kwe(s){s===void 0&&(s={});const{nodeId:n}=s,i=Pwe({...s,elements:{reference:null,floating:null,...s.elements}}),a=s.rootContext||i,l=a.elements,[p,_]=F.useState(null),[T,w]=F.useState(null),O=(l==null?void 0:l.domReference)||p,k=F.useRef(null),U=xwe();qO(()=>{O&&(k.current=O)},[O]);const G=Ewe({...s,elements:{...l,...T&&{reference:T}}}),z=F.useCallback(ce=>{const _e=jo(ce)?{getBoundingClientRect:()=>ce.getBoundingClientRect(),getClientRects:()=>ce.getClientRects(),contextElement:ce}:ce;w(_e),G.refs.setReference(_e)},[G.refs]),J=F.useCallback(ce=>{(jo(ce)||ce===null)&&(k.current=ce,_(ce)),(jo(G.refs.reference.current)||G.refs.reference.current===null||ce!==null&&!jo(ce))&&G.refs.setReference(ce)},[G.refs]),X=F.useMemo(()=>({...G.refs,setReference:J,setPositionReference:z,domReference:k}),[G.refs,J,z]),ie=F.useMemo(()=>({...G.elements,domReference:O}),[G.elements,O]),oe=F.useMemo(()=>({...G,...a,refs:X,elements:ie,nodeId:n}),[G,X,ie,n,a]);return qO(()=>{a.dataRef.current.floatingContext=oe;const ce=U==null?void 0:U.nodesRef.current.find(_e=>_e.id===n);ce&&(ce.context=oe)}),F.useMemo(()=>({...G,context:oe,refs:X,elements:ie}),[G,X,ie,oe])}/*!
  react-datepicker v8.4.0
  https://github.com/Hacker0x01/react-datepicker
  Released under the MIT License.
*/var P2=function(n,i){return P2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(a[p]=l[p])},P2(n,i)};function wa(s,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");P2(s,n);function i(){this.constructor=s}s.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}var Yr=function(){return Yr=Object.assign||function(i){for(var a,l=1,p=arguments.length;l<p;l++){a=arguments[l];for(var _ in a)Object.prototype.hasOwnProperty.call(a,_)&&(i[_]=a[_])}return i},Yr.apply(this,arguments)};function Vu(s,n,i){if(i||arguments.length===2)for(var a=0,l=n.length,p;a<l;a++)(p||!(a in n))&&(p||(p=Array.prototype.slice.call(n,0,a)),p[a]=n[a]);return s.concat(p||Array.prototype.slice.call(n))}var Lwe=function(s){var n=s.showTimeSelectOnly,i=n===void 0?!1:n,a=s.showTime,l=a===void 0?!1:a,p=s.className,_=s.children,T=i?"Choose Time":"Choose Date".concat(l?" and Time":"");return We.createElement("div",{className:p,role:"dialog","aria-label":T,"aria-modal":"true"},_)},Mwe=function(s,n){var i=F.useRef(null),a=F.useRef(s);a.current=s;var l=F.useCallback(function(p){var _,T=p.composed&&p.composedPath&&p.composedPath().find(function(w){return w instanceof Node})||p.target;i.current&&!i.current.contains(T)&&(n&&T instanceof HTMLElement&&T.classList.contains(n)||(_=a.current)===null||_===void 0||_.call(a,p))},[n]);return F.useEffect(function(){return document.addEventListener("mousedown",l),function(){document.removeEventListener("mousedown",l)}},[l]),i},FD=function(s){var n=s.children,i=s.onClickOutside,a=s.className,l=s.containerRef,p=s.style,_=s.ignoreClass,T=Mwe(i,_);return We.createElement("div",{className:a,style:p,ref:function(w){T.current=w,l&&(l.current=w)}},n)},Ht;(function(s){s.ArrowUp="ArrowUp",s.ArrowDown="ArrowDown",s.ArrowLeft="ArrowLeft",s.ArrowRight="ArrowRight",s.PageUp="PageUp",s.PageDown="PageDown",s.Home="Home",s.End="End",s.Enter="Enter",s.Space=" ",s.Tab="Tab",s.Escape="Escape",s.Backspace="Backspace",s.X="x"})(Ht||(Ht={}));function dQ(){var s=typeof window<"u"?window:globalThis;return s}var x0=12;function di(s){if(s==null)return new Date;var n=typeof s=="string"?ebe(s):dn(s);return BD(n)?n:new Date}function yM(s,n,i,a,l){l===void 0&&(l=di());for(var p=Zv(i)||Zv(sU()),_=Array.isArray(n)?n:[n],T=0,w=_;T<w.length;T++){var C=w[T],O=KTe(s,C,l,{locale:p});if(BD(O)&&(!a||s===Ji(O,C,i)))return O}return null}function BD(s,n){return VO(s)&&!M_(s,new Date("1/1/1800"))}function Ji(s,n,i){if(i==="en")return rY(s,n,{useAdditionalWeekYearTokens:!0,useAdditionalDayOfYearTokens:!0});var a=i?Zv(i):void 0;return i&&!a&&console.warn('A locale object was not found for the provided string ["'.concat(i,'"].')),a=a||Zv(sU()),rY(s,n,{locale:a,useAdditionalWeekYearTokens:!0,useAdditionalDayOfYearTokens:!0})}function Dl(s,n){var i=n.dateFormat,a=n.locale,l=Array.isArray(i)&&i.length>0?i[0]:i;return s&&Ji(s,l,a)||""}var uQ=" - ";function jwe(s,n,i){if(!s)return"";var a=Dl(s,i),l=n?Dl(n,i):"";return"".concat(a).concat(uQ).concat(l)}function Uwe(s,n){if(!(s!=null&&s.length))return"";var i=s[0]?Dl(s[0],n):"";if(s.length===1)return i;if(s.length===2&&s[1]){var a=Dl(s[1],n);return"".concat(i,", ").concat(a)}var l=s.length-1;return"".concat(i," (+").concat(l,")")}function vM(s,n){var i=n.hour,a=i===void 0?0:i,l=n.minute,p=l===void 0?0:l,_=n.second,T=_===void 0?0:_;return iO(sO(aO(s,T),p),a)}function Vwe(s){return Xj(s)}function Fwe(s,n){return Ji(s,"ddd",n)}function cO(s){return L_(s)}function $f(s,n,i){var a=Zv(n||sU());return gp(s,{locale:a,weekStartsOn:i})}function cp(s){return HX(s)}function jw(s){return LD(s)}function gY(s){return I2(s)}function _Y(){return L_(di())}function EY(s){return FX(s)}function Bwe(s){return eSe(s)}function Hwe(s){return BX(s)}function ku(s,n){return s&&n?JTe(s,n):!s&&!n}function Lo(s,n){return s&&n?QTe(s,n):!s&&!n}function XO(s,n){return s&&n?$Te(s,n):!s&&!n}function zr(s,n){return s&&n?Jve(s,n):!s&&!n}function y_(s,n){return s&&n?ZSe(s,n):!s&&!n}function Uw(s,n,i){var a,l=L_(n),p=FX(i);try{a=m0(s,{start:l,end:p})}catch{a=!1}return a}function sU(){var s=dQ();return s.__localeId__}function Zv(s){if(typeof s=="string"){var n=dQ();return n.__localeData__?n.__localeData__[s]:void 0}else return s}function Gwe(s,n,i){return n(Ji(s,"EEEE",i))}function Wwe(s,n){return Ji(s,"EEEEEE",n)}function zwe(s,n){return Ji(s,"EEE",n)}function aU(s,n){return Ji(xl(di(),s),"LLLL",n)}function hQ(s,n){return Ji(xl(di(),s),"LLL",n)}function Ywe(s,n){return Ji(Nv(di(),s),"QQQ",n)}function Pl(s,n){var i=n===void 0?{}:n,a=i.minDate,l=i.maxDate,p=i.excludeDates,_=i.excludeDateIntervals,T=i.includeDates,w=i.includeDateIntervals,C=i.filterDate;return P0(s,{minDate:a,maxDate:l})||p&&p.some(function(O){return O instanceof Date?zr(s,O):zr(s,O.date)})||_&&_.some(function(O){var k=O.start,U=O.end;return m0(s,{start:k,end:U})})||T&&!T.some(function(O){return zr(s,O)})||w&&!w.some(function(O){var k=O.start,U=O.end;return m0(s,{start:k,end:U})})||C&&!C(di(s))||!1}function oU(s,n){var i=n===void 0?{}:n,a=i.excludeDates,l=i.excludeDateIntervals;return l&&l.length>0?l.some(function(p){var _=p.start,T=p.end;return m0(s,{start:_,end:T})}):a&&a.some(function(p){var _;return p instanceof Date?zr(s,p):zr(s,(_=p.date)!==null&&_!==void 0?_:new Date)})||!1}function pQ(s,n){var i=n===void 0?{}:n,a=i.minDate,l=i.maxDate,p=i.excludeDates,_=i.includeDates,T=i.filterDate;return P0(s,{minDate:a?HX(a):void 0,maxDate:l?BX(l):void 0})||(p==null?void 0:p.some(function(w){return Lo(s,w instanceof Date?w:w.date)}))||_&&!_.some(function(w){return Lo(s,w)})||T&&!T(di(s))||!1}function uN(s,n,i,a){var l=_r(s),p=po(s),_=_r(n),T=po(n),w=_r(a);return l===_&&l===w?p<=i&&i<=T:l<_?w===l&&p<=i||w===_&&T>=i||w<_&&w>l:!1}function qwe(s,n){var i=n===void 0?{}:n,a=i.minDate,l=i.maxDate,p=i.excludeDates,_=i.includeDates;return P0(s,{minDate:a,maxDate:l})||p&&p.some(function(T){return Lo(T instanceof Date?T:T.date,s)})||_&&!_.some(function(T){return Lo(T,s)})||!1}function hN(s,n){var i=n===void 0?{}:n,a=i.minDate,l=i.maxDate,p=i.excludeDates,_=i.includeDates,T=i.filterDate;return P0(s,{minDate:a,maxDate:l})||(p==null?void 0:p.some(function(w){return XO(s,w instanceof Date?w:w.date)}))||_&&!_.some(function(w){return XO(s,w)})||T&&!T(di(s))||!1}function pN(s,n,i){if(!n||!i||!VO(n)||!VO(i))return!1;var a=_r(n),l=_r(i);return a<=s&&l>=s}function lO(s,n){var i=n===void 0?{}:n,a=i.minDate,l=i.maxDate,p=i.excludeDates,_=i.includeDates,T=i.filterDate,w=new Date(s,0,1);return P0(w,{minDate:a?LD(a):void 0,maxDate:l?GX(l):void 0})||(p==null?void 0:p.some(function(C){return ku(w,C instanceof Date?C:C.date)}))||_&&!_.some(function(C){return ku(w,C)})||T&&!T(di(w))||!1}function fN(s,n,i,a){var l=_r(s),p=R_(s),_=_r(n),T=R_(n),w=_r(a);return l===_&&l===w?p<=i&&i<=T:l<_?w===l&&p<=i||w===_&&T>=i||w<_&&w>l:!1}function P0(s,n){var i,a=n===void 0?{}:n,l=a.minDate,p=a.maxDate;return(i=l&&Kv(s,l)<0||p&&Kv(s,p)>0)!==null&&i!==void 0?i:!1}function yY(s,n){return n.some(function(i){return ap(i)===ap(s)&&op(i)===op(s)&&Qf(i)===Qf(s)})}function vY(s,n){var i=n===void 0?{}:n,a=i.excludeTimes,l=i.includeTimes,p=i.filterTime;return a&&yY(s,a)||l&&!yY(s,l)||p&&!p(s)||!1}function SY(s,n){var i=n.minTime,a=n.maxTime;if(!i||!a)throw new Error("Both minTime and maxTime props required");var l=di();l=iO(l,ap(s)),l=sO(l,op(s)),l=aO(l,Qf(s));var p=di();p=iO(p,ap(i)),p=sO(p,op(i)),p=aO(p,Qf(i));var _=di();_=iO(_,ap(a)),_=sO(_,op(a)),_=aO(_,Qf(a));var T;try{T=!m0(l,{start:p,end:_})}catch{T=!1}return T}function TY(s,n){var i=n===void 0?{}:n,a=i.minDate,l=i.includeDates,p=C_(s,1);return a&&FO(a,p)>0||l&&l.every(function(_){return FO(_,p)>0})||!1}function bY(s,n){var i=n===void 0?{}:n,a=i.maxDate,l=i.includeDates,p=Cd(s,1);return a&&FO(p,a)>0||l&&l.every(function(_){return FO(p,_)>0})||!1}function Kwe(s,n){var i=n===void 0?{}:n,a=i.minDate,l=i.includeDates,p=LD(s),_=JX(p);return a&&BO(a,_)>0||l&&l.every(function(T){return BO(T,_)>0})||!1}function Xwe(s,n){var i=n===void 0?{}:n,a=i.maxDate,l=i.includeDates,p=GX(s),_=Kj(p,1);return a&&BO(_,a)>0||l&&l.every(function(T){return BO(_,T)>0})||!1}function wY(s,n){var i=n===void 0?{}:n,a=i.minDate,l=i.includeDates,p=Xv(s,1);return a&&HO(a,p)>0||l&&l.every(function(_){return HO(_,p)>0})||!1}function Qwe(s,n){var i=n===void 0?{}:n,a=i.minDate,l=i.yearItemNumber,p=l===void 0?x0:l,_=jw(Xv(s,p)),T=Wf(_,p).endPeriod,w=a&&_r(a);return w&&w>T||!1}function RY(s,n){var i=n===void 0?{}:n,a=i.maxDate,l=i.includeDates,p=ip(s,1);return a&&HO(p,a)>0||l&&l.every(function(_){return HO(p,_)>0})||!1}function $we(s,n){var i=n===void 0?{}:n,a=i.maxDate,l=i.yearItemNumber,p=l===void 0?x0:l,_=ip(s,p),T=Wf(_,p).startPeriod,w=a&&_r(a);return w&&w<T||!1}function fQ(s){var n=s.minDate,i=s.includeDates;if(i&&n){var a=i.filter(function(l){return Kv(l,n)>=0});return $z(a)}else return i?$z(i):n}function mQ(s){var n=s.maxDate,i=s.includeDates;if(i&&n){var a=i.filter(function(l){return Kv(l,n)<=0});return Qz(a)}else return i?Qz(i):n}function CY(s,n){var i;s===void 0&&(s=[]),n===void 0&&(n="react-datepicker__day--highlighted");for(var a=new Map,l=0,p=s.length;l<p;l++){var _=s[l];if(sp(_)){var T=Ji(_,"MM.dd.yyyy"),w=a.get(T)||[];w.includes(n)||(w.push(n),a.set(T,w))}else if(typeof _=="object"){var C=Object.keys(_),O=(i=C[0])!==null&&i!==void 0?i:"",k=_[O];if(typeof O=="string"&&Array.isArray(k))for(var U=0,G=k.length;U<G;U++){var z=k[U];if(z){var T=Ji(z,"MM.dd.yyyy"),w=a.get(T)||[];w.includes(O)||(w.push(O),a.set(T,w))}}}}return a}function Jwe(s,n){return s.length!==n.length?!1:s.every(function(i,a){return i===n[a]})}function Zwe(s,n){s===void 0&&(s=[]),n===void 0&&(n="react-datepicker__day--holidays");var i=new Map;return s.forEach(function(a){var l=a.date,p=a.holidayName;if(sp(l)){var _=Ji(l,"MM.dd.yyyy"),T=i.get(_)||{className:"",holidayNames:[]};if(!("className"in T&&T.className===n&&Jwe(T.holidayNames,[p]))){T.className=n;var w=T.holidayNames;T.holidayNames=w?Vu(Vu([],w,!0),[p],!1):[p],i.set(_,T)}}}),i}function e0e(s,n,i,a,l){for(var p=l.length,_=[],T=0;T<p;T++){var w=s,C=l[T];C&&(w=Kve(w,ap(C)),w=A2(w,op(C)),w=$ve(w,Qf(C)));var O=A2(s,(i+1)*a);sm(w,n)&&M_(w,O)&&C!=null&&_.push(C)}return _}function AY(s){return s<10?"0".concat(s):"".concat(s)}function Wf(s,n){n===void 0&&(n=x0);var i=Math.ceil(_r(s)/n)*n,a=i-(n-1);return{startPeriod:a,endPeriod:i}}function t0e(s){var n=new Date(s.getFullYear(),s.getMonth(),s.getDate()),i=new Date(s.getFullYear(),s.getMonth(),s.getDate(),24);return Math.round((+i-+n)/36e5)}function IY(s){var n=s.getSeconds(),i=s.getMilliseconds();return dn(s.getTime()-n*1e3-i)}function n0e(s,n){return IY(s).getTime()===IY(n).getTime()}function NY(s){if(!sp(s))throw new Error("Invalid date");var n=new Date(s);return n.setHours(0,0,0,0),n}function OY(s,n){if(!sp(s)||!sp(n))throw new Error("Invalid date received");var i=NY(s),a=NY(n);return M_(i,a)}function gQ(s){return s.key===Ht.Space}var r0e=function(s){wa(n,s);function n(i){var a=s.call(this,i)||this;return a.inputRef=We.createRef(),a.onTimeChange=function(l){var p,_;a.setState({time:l});var T=a.props.date,w=T instanceof Date&&!isNaN(+T),C=w?T:new Date;if(l!=null&&l.includes(":")){var O=l.split(":"),k=O[0],U=O[1];C.setHours(Number(k)),C.setMinutes(Number(U))}(_=(p=a.props).onChange)===null||_===void 0||_.call(p,C)},a.renderTimeInput=function(){var l=a.state.time,p=a.props,_=p.date,T=p.timeString,w=p.customTimeInput;return w?F.cloneElement(w,{date:_,value:l,onChange:a.onTimeChange}):We.createElement("input",{type:"time",className:"react-datepicker-time__input",placeholder:"Time",name:"time-input",ref:a.inputRef,onClick:function(){var C;(C=a.inputRef.current)===null||C===void 0||C.focus()},required:!0,value:l,onChange:function(C){a.onTimeChange(C.target.value||T)}})},a.state={time:a.props.timeString},a}return n.getDerivedStateFromProps=function(i,a){return i.timeString!==a.time?{time:i.timeString}:null},n.prototype.render=function(){return We.createElement("div",{className:"react-datepicker__input-time-container"},We.createElement("div",{className:"react-datepicker-time__caption"},this.props.timeInputLabel),We.createElement("div",{className:"react-datepicker-time__input-container"},We.createElement("div",{className:"react-datepicker-time__input"},this.renderTimeInput())))},n}(F.Component),i0e=function(s){wa(n,s);function n(){var i=s!==null&&s.apply(this,arguments)||this;return i.dayEl=F.createRef(),i.handleClick=function(a){!i.isDisabled()&&i.props.onClick&&i.props.onClick(a)},i.handleMouseEnter=function(a){!i.isDisabled()&&i.props.onMouseEnter&&i.props.onMouseEnter(a)},i.handleOnKeyDown=function(a){var l,p,_=a.key;_===Ht.Space&&(a.preventDefault(),a.key=Ht.Enter),(p=(l=i.props).handleOnKeyDown)===null||p===void 0||p.call(l,a)},i.isSameDay=function(a){return zr(i.props.day,a)},i.isKeyboardSelected=function(){var a;if(i.props.disabledKeyboardNavigation)return!1;var l=i.props.selectsMultiple?(a=i.props.selectedDates)===null||a===void 0?void 0:a.some(function(_){return i.isSameDayOrWeek(_)}):i.isSameDayOrWeek(i.props.selected),p=i.props.preSelection&&i.isDisabled(i.props.preSelection);return!l&&i.isSameDayOrWeek(i.props.preSelection)&&!p},i.isDisabled=function(a){return a===void 0&&(a=i.props.day),Pl(a,{minDate:i.props.minDate,maxDate:i.props.maxDate,excludeDates:i.props.excludeDates,excludeDateIntervals:i.props.excludeDateIntervals,includeDateIntervals:i.props.includeDateIntervals,includeDates:i.props.includeDates,filterDate:i.props.filterDate})},i.isExcluded=function(){return oU(i.props.day,{excludeDates:i.props.excludeDates,excludeDateIntervals:i.props.excludeDateIntervals})},i.isStartOfWeek=function(){return zr(i.props.day,$f(i.props.day,i.props.locale,i.props.calendarStartDay))},i.isSameWeek=function(a){return i.props.showWeekPicker&&zr(a,$f(i.props.day,i.props.locale,i.props.calendarStartDay))},i.isSameDayOrWeek=function(a){return i.isSameDay(a)||i.isSameWeek(a)},i.getHighLightedClass=function(){var a=i.props,l=a.day,p=a.highlightDates;if(!p)return!1;var _=Ji(l,"MM.dd.yyyy");return p.get(_)},i.getHolidaysClass=function(){var a,l=i.props,p=l.day,_=l.holidays;if(!_)return[void 0];var T=Ji(p,"MM.dd.yyyy");return _.has(T)?[(a=_.get(T))===null||a===void 0?void 0:a.className]:[void 0]},i.isInRange=function(){var a=i.props,l=a.day,p=a.startDate,_=a.endDate;return!p||!_?!1:Uw(l,p,_)},i.isInSelectingRange=function(){var a,l=i.props,p=l.day,_=l.selectsStart,T=l.selectsEnd,w=l.selectsRange,C=l.selectsDisabledDaysInRange,O=l.startDate,k=l.endDate,U=(a=i.props.selectingDate)!==null&&a!==void 0?a:i.props.preSelection;return!(_||T||w)||!U||!C&&i.isDisabled()?!1:_&&k&&(M_(U,k)||y_(U,k))?Uw(p,U,k):T&&O&&(sm(U,O)||y_(U,O))||w&&O&&!k&&(sm(U,O)||y_(U,O))?Uw(p,O,U):!1},i.isSelectingRangeStart=function(){var a;if(!i.isInSelectingRange())return!1;var l=i.props,p=l.day,_=l.startDate,T=l.selectsStart,w=(a=i.props.selectingDate)!==null&&a!==void 0?a:i.props.preSelection;return T?zr(p,w):zr(p,_)},i.isSelectingRangeEnd=function(){var a;if(!i.isInSelectingRange())return!1;var l=i.props,p=l.day,_=l.endDate,T=l.selectsEnd,w=l.selectsRange,C=(a=i.props.selectingDate)!==null&&a!==void 0?a:i.props.preSelection;return T||w?zr(p,C):zr(p,_)},i.isRangeStart=function(){var a=i.props,l=a.day,p=a.startDate,_=a.endDate;return!p||!_?!1:zr(p,l)},i.isRangeEnd=function(){var a=i.props,l=a.day,p=a.startDate,_=a.endDate;return!p||!_?!1:zr(_,l)},i.isWeekend=function(){var a=XSe(i.props.day);return a===0||a===6},i.isAfterMonth=function(){return i.props.month!==void 0&&(i.props.month+1)%12===po(i.props.day)},i.isBeforeMonth=function(){return i.props.month!==void 0&&(po(i.props.day)+1)%12===i.props.month},i.isCurrentDay=function(){return i.isSameDay(di())},i.isSelected=function(){var a;return i.props.selectsMultiple?(a=i.props.selectedDates)===null||a===void 0?void 0:a.some(function(l){return i.isSameDayOrWeek(l)}):i.isSameDayOrWeek(i.props.selected)},i.getClassNames=function(a){var l=i.props.dayClassName?i.props.dayClassName(a):void 0;return $i("react-datepicker__day",l,"react-datepicker__day--"+Fwe(i.props.day),{"react-datepicker__day--disabled":i.isDisabled(),"react-datepicker__day--excluded":i.isExcluded(),"react-datepicker__day--selected":i.isSelected(),"react-datepicker__day--keyboard-selected":i.isKeyboardSelected(),"react-datepicker__day--range-start":i.isRangeStart(),"react-datepicker__day--range-end":i.isRangeEnd(),"react-datepicker__day--in-range":i.isInRange(),"react-datepicker__day--in-selecting-range":i.isInSelectingRange(),"react-datepicker__day--selecting-range-start":i.isSelectingRangeStart(),"react-datepicker__day--selecting-range-end":i.isSelectingRangeEnd(),"react-datepicker__day--today":i.isCurrentDay(),"react-datepicker__day--weekend":i.isWeekend(),"react-datepicker__day--outside-month":i.isAfterMonth()||i.isBeforeMonth()},i.getHighLightedClass(),i.getHolidaysClass())},i.getAriaLabel=function(){var a=i.props,l=a.day,p=a.ariaLabelPrefixWhenEnabled,_=p===void 0?"Choose":p,T=a.ariaLabelPrefixWhenDisabled,w=T===void 0?"Not available":T,C=i.isDisabled()||i.isExcluded()?w:_;return"".concat(C," ").concat(Ji(l,"PPPP",i.props.locale))},i.getTitle=function(){var a=i.props,l=a.day,p=a.holidays,_=p===void 0?new Map:p,T=a.excludeDates,w=Ji(l,"MM.dd.yyyy"),C=[];return _.has(w)&&C.push.apply(C,_.get(w).holidayNames),i.isExcluded()&&C.push(T==null?void 0:T.filter(function(O){return O instanceof Date?zr(O,l):zr(O==null?void 0:O.date,l)}).map(function(O){if(!(O instanceof Date))return O==null?void 0:O.message})),C.join(", ")},i.getTabIndex=function(){var a=i.props.selected,l=i.props.preSelection,p=!(i.props.showWeekPicker&&(i.props.showWeekNumber||!i.isStartOfWeek()))&&(i.isKeyboardSelected()||i.isSameDay(a)&&zr(l,a))?0:-1;return p},i.handleFocusDay=function(){var a;i.shouldFocusDay()&&((a=i.dayEl.current)===null||a===void 0||a.focus({preventScroll:!0}))},i.renderDayContents=function(){return i.props.monthShowsDuplicateDaysEnd&&i.isAfterMonth()||i.props.monthShowsDuplicateDaysStart&&i.isBeforeMonth()?null:i.props.renderDayContents?i.props.renderDayContents(iY(i.props.day),i.props.day):iY(i.props.day)},i.render=function(){return We.createElement("div",{ref:i.dayEl,className:i.getClassNames(i.props.day),onKeyDown:i.handleOnKeyDown,onClick:i.handleClick,onMouseEnter:i.props.usePointerEvent?void 0:i.handleMouseEnter,onPointerEnter:i.props.usePointerEvent?i.handleMouseEnter:void 0,tabIndex:i.getTabIndex(),"aria-label":i.getAriaLabel(),role:"option",title:i.getTitle(),"aria-disabled":i.isDisabled(),"aria-current":i.isCurrentDay()?"date":void 0,"aria-selected":i.isSelected()||i.isInRange()},i.renderDayContents(),i.getTitle()!==""&&We.createElement("span",{className:"overlay"},i.getTitle()))},i}return n.prototype.componentDidMount=function(){this.handleFocusDay()},n.prototype.componentDidUpdate=function(){this.handleFocusDay()},n.prototype.shouldFocusDay=function(){var i=!1;return this.getTabIndex()===0&&this.isSameDay(this.props.preSelection)&&((!document.activeElement||document.activeElement===document.body)&&(i=!0),this.props.inline&&!this.props.shouldFocusDayInline&&(i=!1),this.isDayActiveElement()&&(i=!0),this.isDuplicateDay()&&(i=!1)),i},n.prototype.isDayActiveElement=function(){var i,a,l;return((a=(i=this.props.containerRef)===null||i===void 0?void 0:i.current)===null||a===void 0?void 0:a.contains(document.activeElement))&&((l=document.activeElement)===null||l===void 0?void 0:l.classList.contains("react-datepicker__day"))},n.prototype.isDuplicateDay=function(){return this.props.monthShowsDuplicateDaysEnd&&this.isAfterMonth()||this.props.monthShowsDuplicateDaysStart&&this.isBeforeMonth()},n}(F.Component),s0e=function(s){wa(n,s);function n(){var i=s!==null&&s.apply(this,arguments)||this;return i.weekNumberEl=F.createRef(),i.handleClick=function(a){i.props.onClick&&i.props.onClick(a)},i.handleOnKeyDown=function(a){var l,p,_=a.key;_===Ht.Space&&(a.preventDefault(),a.key=Ht.Enter),(p=(l=i.props).handleOnKeyDown)===null||p===void 0||p.call(l,a)},i.isKeyboardSelected=function(){return!i.props.disabledKeyboardNavigation&&!zr(i.props.date,i.props.selected)&&zr(i.props.date,i.props.preSelection)},i.getTabIndex=function(){return i.props.showWeekPicker&&i.props.showWeekNumber&&(i.isKeyboardSelected()||zr(i.props.date,i.props.selected)&&zr(i.props.preSelection,i.props.selected))?0:-1},i.handleFocusWeekNumber=function(a){var l=!1;i.getTabIndex()===0&&!(a!=null&&a.isInputFocused)&&zr(i.props.date,i.props.preSelection)&&((!document.activeElement||document.activeElement===document.body)&&(l=!0),i.props.inline&&!i.props.shouldFocusDayInline&&(l=!1),i.props.containerRef&&i.props.containerRef.current&&i.props.containerRef.current.contains(document.activeElement)&&document.activeElement&&document.activeElement.classList.contains("react-datepicker__week-number")&&(l=!0)),l&&i.weekNumberEl.current&&i.weekNumberEl.current.focus({preventScroll:!0})},i}return Object.defineProperty(n,"defaultProps",{get:function(){return{ariaLabelPrefix:"week "}},enumerable:!1,configurable:!0}),n.prototype.componentDidMount=function(){this.handleFocusWeekNumber()},n.prototype.componentDidUpdate=function(i){this.handleFocusWeekNumber(i)},n.prototype.render=function(){var i=this.props,a=i.weekNumber,l=i.isWeekDisabled,p=i.ariaLabelPrefix,_=p===void 0?n.defaultProps.ariaLabelPrefix:p,T=i.onClick,w={"react-datepicker__week-number":!0,"react-datepicker__week-number--clickable":!!T&&!l,"react-datepicker__week-number--selected":!!T&&zr(this.props.date,this.props.selected)};return We.createElement("div",{ref:this.weekNumberEl,className:$i(w),"aria-label":"".concat(_," ").concat(this.props.weekNumber),onClick:this.handleClick,onKeyDown:this.handleOnKeyDown,tabIndex:this.getTabIndex()},a)},n}(F.Component),a0e=function(s){wa(n,s);function n(){var i=s!==null&&s.apply(this,arguments)||this;return i.isDisabled=function(a){return Pl(a,{minDate:i.props.minDate,maxDate:i.props.maxDate,excludeDates:i.props.excludeDates,excludeDateIntervals:i.props.excludeDateIntervals,includeDateIntervals:i.props.includeDateIntervals,includeDates:i.props.includeDates,filterDate:i.props.filterDate})},i.handleDayClick=function(a,l){i.props.onDayClick&&i.props.onDayClick(a,l)},i.handleDayMouseEnter=function(a){i.props.onDayMouseEnter&&i.props.onDayMouseEnter(a)},i.handleWeekClick=function(a,l,p){for(var _,T,w,C=new Date(a),O=0;O<7;O++){var k=new Date(a);k.setDate(k.getDate()+O);var U=!i.isDisabled(k);if(U){C=k;break}}typeof i.props.onWeekSelect=="function"&&i.props.onWeekSelect(C,l,p),i.props.showWeekPicker&&i.handleDayClick(C,p),((_=i.props.shouldCloseOnSelect)!==null&&_!==void 0?_:n.defaultProps.shouldCloseOnSelect)&&((w=(T=i.props).setOpen)===null||w===void 0||w.call(T,!1))},i.formatWeekNumber=function(a){return i.props.formatWeekNumber?i.props.formatWeekNumber(a):Vwe(a)},i.isWeekDisabled=function(){for(var a=i.startOfWeek(),l=bd(a,6),p=new Date(a);p<=l;){if(!i.isDisabled(p))return!1;p=bd(p,1)}return!0},i.renderDays=function(){var a=i.startOfWeek(),l=[],p=i.formatWeekNumber(a);if(i.props.showWeekNumber){var _=i.props.onWeekSelect||i.props.showWeekPicker?i.handleWeekClick.bind(i,a,p):void 0;l.push(We.createElement(s0e,Yr({key:"W"},n.defaultProps,i.props,{weekNumber:p,isWeekDisabled:i.isWeekDisabled(),date:a,onClick:_})))}return l.concat([0,1,2,3,4,5,6].map(function(T){var w=bd(a,T);return We.createElement(i0e,Yr({},n.defaultProps,i.props,{ariaLabelPrefixWhenEnabled:i.props.chooseDayAriaLabelPrefix,ariaLabelPrefixWhenDisabled:i.props.disabledDayAriaLabelPrefix,key:w.valueOf(),day:w,onClick:i.handleDayClick.bind(i,w),onMouseEnter:i.handleDayMouseEnter.bind(i,w)}))}))},i.startOfWeek=function(){return $f(i.props.day,i.props.locale,i.props.calendarStartDay)},i.isKeyboardSelected=function(){return!i.props.disabledKeyboardNavigation&&!zr(i.startOfWeek(),i.props.selected)&&zr(i.startOfWeek(),i.props.preSelection)},i}return Object.defineProperty(n,"defaultProps",{get:function(){return{shouldCloseOnSelect:!0}},enumerable:!1,configurable:!0}),n.prototype.render=function(){var i={"react-datepicker__week":!0,"react-datepicker__week--selected":zr(this.startOfWeek(),this.props.selected),"react-datepicker__week--keyboard-selected":this.isKeyboardSelected()};return We.createElement("div",{className:$i(i)},this.renderDays())},n}(F.Component),Nw,o0e=6,jv={TWO_COLUMNS:"two_columns",THREE_COLUMNS:"three_columns",FOUR_COLUMNS:"four_columns"},SM=(Nw={},Nw[jv.TWO_COLUMNS]={grid:[[0,1],[2,3],[4,5],[6,7],[8,9],[10,11]],verticalNavigationOffset:2},Nw[jv.THREE_COLUMNS]={grid:[[0,1,2],[3,4,5],[6,7,8],[9,10,11]],verticalNavigationOffset:3},Nw[jv.FOUR_COLUMNS]={grid:[[0,1,2,3],[4,5,6,7],[8,9,10,11]],verticalNavigationOffset:4},Nw),mN=1;function DY(s,n){return s?jv.FOUR_COLUMNS:n?jv.TWO_COLUMNS:jv.THREE_COLUMNS}var c0e=function(s){wa(n,s);function n(){var i=s!==null&&s.apply(this,arguments)||this;return i.MONTH_REFS=Vu([],Array(12),!0).map(function(){return F.createRef()}),i.QUARTER_REFS=Vu([],Array(4),!0).map(function(){return F.createRef()}),i.isDisabled=function(a){return Pl(a,{minDate:i.props.minDate,maxDate:i.props.maxDate,excludeDates:i.props.excludeDates,excludeDateIntervals:i.props.excludeDateIntervals,includeDateIntervals:i.props.includeDateIntervals,includeDates:i.props.includeDates,filterDate:i.props.filterDate})},i.isExcluded=function(a){return oU(a,{excludeDates:i.props.excludeDates,excludeDateIntervals:i.props.excludeDateIntervals})},i.handleDayClick=function(a,l){var p,_;(_=(p=i.props).onDayClick)===null||_===void 0||_.call(p,a,l,i.props.orderInDisplay)},i.handleDayMouseEnter=function(a){var l,p;(p=(l=i.props).onDayMouseEnter)===null||p===void 0||p.call(l,a)},i.handleMouseLeave=function(){var a,l;(l=(a=i.props).onMouseLeave)===null||l===void 0||l.call(a)},i.isRangeStartMonth=function(a){var l=i.props,p=l.day,_=l.startDate,T=l.endDate;return!_||!T?!1:Lo(xl(p,a),_)},i.isRangeStartQuarter=function(a){var l=i.props,p=l.day,_=l.startDate,T=l.endDate;return!_||!T?!1:XO(Nv(p,a),_)},i.isRangeEndMonth=function(a){var l=i.props,p=l.day,_=l.startDate,T=l.endDate;return!_||!T?!1:Lo(xl(p,a),T)},i.isRangeEndQuarter=function(a){var l=i.props,p=l.day,_=l.startDate,T=l.endDate;return!_||!T?!1:XO(Nv(p,a),T)},i.isInSelectingRangeMonth=function(a){var l,p=i.props,_=p.day,T=p.selectsStart,w=p.selectsEnd,C=p.selectsRange,O=p.startDate,k=p.endDate,U=(l=i.props.selectingDate)!==null&&l!==void 0?l:i.props.preSelection;return!(T||w||C)||!U?!1:T&&k?uN(U,k,a,_):w&&O||C&&O&&!k?uN(O,U,a,_):!1},i.isSelectingMonthRangeStart=function(a){var l;if(!i.isInSelectingRangeMonth(a))return!1;var p=i.props,_=p.day,T=p.startDate,w=p.selectsStart,C=xl(_,a),O=(l=i.props.selectingDate)!==null&&l!==void 0?l:i.props.preSelection;return w?Lo(C,O):Lo(C,T)},i.isSelectingMonthRangeEnd=function(a){var l;if(!i.isInSelectingRangeMonth(a))return!1;var p=i.props,_=p.day,T=p.endDate,w=p.selectsEnd,C=p.selectsRange,O=xl(_,a),k=(l=i.props.selectingDate)!==null&&l!==void 0?l:i.props.preSelection;return w||C?Lo(O,k):Lo(O,T)},i.isInSelectingRangeQuarter=function(a){var l,p=i.props,_=p.day,T=p.selectsStart,w=p.selectsEnd,C=p.selectsRange,O=p.startDate,k=p.endDate,U=(l=i.props.selectingDate)!==null&&l!==void 0?l:i.props.preSelection;return!(T||w||C)||!U?!1:T&&k?fN(U,k,a,_):w&&O||C&&O&&!k?fN(O,U,a,_):!1},i.isWeekInMonth=function(a){var l=i.props.day,p=bd(a,6);return Lo(a,l)||Lo(p,l)},i.isCurrentMonth=function(a,l){return _r(a)===_r(di())&&l===po(di())},i.isCurrentQuarter=function(a,l){return _r(a)===_r(di())&&l===R_(di())},i.isSelectedMonth=function(a,l,p){return po(p)===l&&_r(a)===_r(p)},i.isSelectMonthInList=function(a,l,p){return p.some(function(_){return i.isSelectedMonth(a,l,_)})},i.isSelectedQuarter=function(a,l,p){return R_(a)===l&&_r(a)===_r(p)},i.isMonthSelected=function(){var a=i.props,l=a.day,p=a.selected,_=a.selectedDates,T=a.selectsMultiple,w=po(l);return T?_==null?void 0:_.some(function(C){return i.isSelectedMonth(l,w,C)}):!!p&&i.isSelectedMonth(l,w,p)},i.renderWeeks=function(){for(var a=[],l=i.props.fixedHeight,p=0,_=!1,T=$f(cp(i.props.day),i.props.locale,i.props.calendarStartDay),w=function(z){return i.props.showWeekPicker?$f(z,i.props.locale,i.props.calendarStartDay):i.props.preSelection},C=function(z){return i.props.showWeekPicker?$f(z,i.props.locale,i.props.calendarStartDay):i.props.selected},O=i.props.selected?C(i.props.selected):void 0,k=i.props.preSelection?w(i.props.preSelection):void 0;a.push(We.createElement(a0e,Yr({},i.props,{ariaLabelPrefix:i.props.weekAriaLabelPrefix,key:p,day:T,month:po(i.props.day),onDayClick:i.handleDayClick,onDayMouseEnter:i.handleDayMouseEnter,selected:O,preSelection:k,showWeekNumber:i.props.showWeekNumbers}))),!_;){p++,T=UO(T,1);var U=l&&p>=o0e,G=!l&&!i.isWeekInMonth(T);if(U||G)if(i.props.peekNextMonth)_=!0;else break}return a},i.onMonthClick=function(a,l){var p=i.isMonthDisabledForLabelDate(l),_=p.isDisabled,T=p.labelDate;_||i.handleDayClick(cp(T),a)},i.onMonthMouseEnter=function(a){var l=i.isMonthDisabledForLabelDate(a),p=l.isDisabled,_=l.labelDate;p||i.handleDayMouseEnter(cp(_))},i.handleMonthNavigation=function(a,l){var p,_,T,w;(_=(p=i.props).setPreSelection)===null||_===void 0||_.call(p,l),(w=(T=i.MONTH_REFS[a])===null||T===void 0?void 0:T.current)===null||w===void 0||w.focus()},i.handleKeyboardNavigation=function(a,l,p){var _,T=i.props,w=T.selected,C=T.preSelection,O=T.setPreSelection,k=T.minDate,U=T.maxDate,G=T.showFourColumnMonthYearPicker,z=T.showTwoColumnMonthYearPicker;if(C){var J=DY(G,z),X=i.getVerticalOffset(J),ie=(_=SM[J])===null||_===void 0?void 0:_.grid,oe=function(ee,Q,q){var ae,re,fe=Q,pe=q;switch(ee){case Ht.ArrowRight:fe=Cd(Q,mN),pe=q===11?0:q+mN;break;case Ht.ArrowLeft:fe=C_(Q,mN),pe=q===0?11:q-mN;break;case Ht.ArrowUp:fe=C_(Q,X),pe=!((ae=ie==null?void 0:ie[0])===null||ae===void 0)&&ae.includes(q)?q+12-X:q-X;break;case Ht.ArrowDown:fe=Cd(Q,X),pe=!((re=ie==null?void 0:ie[ie.length-1])===null||re===void 0)&&re.includes(q)?q-12+X:q+X;break}return{newCalculatedDate:fe,newCalculatedMonth:pe}},ce=function(ee,Q,q){for(var ae=40,re=ee,fe=!1,pe=0,Re=oe(re,Q,q),Ge=Re.newCalculatedDate,ve=Re.newCalculatedMonth;!fe;){if(pe>=ae){Ge=Q,ve=q;break}if(k&&Ge<k){re=Ht.ArrowRight;var Ne=oe(re,Ge,ve);Ge=Ne.newCalculatedDate,ve=Ne.newCalculatedMonth}if(U&&Ge>U){re=Ht.ArrowLeft;var Ne=oe(re,Ge,ve);Ge=Ne.newCalculatedDate,ve=Ne.newCalculatedMonth}if(qwe(Ge,i.props)){var Ne=oe(re,Ge,ve);Ge=Ne.newCalculatedDate,ve=Ne.newCalculatedMonth}else fe=!0;pe++}return{newCalculatedDate:Ge,newCalculatedMonth:ve}};if(l===Ht.Enter){i.isMonthDisabled(p)||(i.onMonthClick(a,p),O==null||O(w));return}var _e=ce(l,C,p),se=_e.newCalculatedDate,be=_e.newCalculatedMonth;switch(l){case Ht.ArrowRight:case Ht.ArrowLeft:case Ht.ArrowUp:case Ht.ArrowDown:i.handleMonthNavigation(be,se);break}}},i.getVerticalOffset=function(a){var l,p;return(p=(l=SM[a])===null||l===void 0?void 0:l.verticalNavigationOffset)!==null&&p!==void 0?p:0},i.onMonthKeyDown=function(a,l){var p=i.props,_=p.disabledKeyboardNavigation,T=p.handleOnMonthKeyDown,w=a.key;w!==Ht.Tab&&a.preventDefault(),_||i.handleKeyboardNavigation(a,w,l),T&&T(a)},i.onQuarterClick=function(a,l){var p=Nv(i.props.day,l);hN(p,i.props)||i.handleDayClick(gY(p),a)},i.onQuarterMouseEnter=function(a){var l=Nv(i.props.day,a);hN(l,i.props)||i.handleDayMouseEnter(gY(l))},i.handleQuarterNavigation=function(a,l){var p,_,T,w;i.isDisabled(l)||i.isExcluded(l)||((_=(p=i.props).setPreSelection)===null||_===void 0||_.call(p,l),(w=(T=i.QUARTER_REFS[a-1])===null||T===void 0?void 0:T.current)===null||w===void 0||w.focus())},i.onQuarterKeyDown=function(a,l){var p,_,T=a.key;if(!i.props.disabledKeyboardNavigation)switch(T){case Ht.Enter:i.onQuarterClick(a,l),(_=(p=i.props).setPreSelection)===null||_===void 0||_.call(p,i.props.selected);break;case Ht.ArrowRight:if(!i.props.preSelection)break;i.handleQuarterNavigation(l===4?1:l+1,Kj(i.props.preSelection,1));break;case Ht.ArrowLeft:if(!i.props.preSelection)break;i.handleQuarterNavigation(l===1?4:l-1,JX(i.props.preSelection));break}},i.isMonthDisabledForLabelDate=function(a){var l,p=i.props,_=p.day,T=p.minDate,w=p.maxDate,C=p.excludeDates,O=p.includeDates,k=xl(_,a);return{isDisabled:(l=(T||w||C||O)&&pQ(k,i.props))!==null&&l!==void 0?l:!1,labelDate:k}},i.isMonthDisabled=function(a){var l=i.isMonthDisabledForLabelDate(a).isDisabled;return l},i.getMonthClassNames=function(a){var l=i.props,p=l.day,_=l.startDate,T=l.endDate,w=l.preSelection,C=l.monthClassName,O=C?C(xl(p,a)):void 0,k=i.getSelection();return $i("react-datepicker__month-text","react-datepicker__month-".concat(a),O,{"react-datepicker__month-text--disabled":i.isMonthDisabled(a),"react-datepicker__month-text--selected":k?i.isSelectMonthInList(p,a,k):void 0,"react-datepicker__month-text--keyboard-selected":!i.props.disabledKeyboardNavigation&&w&&i.isSelectedMonth(p,a,w)&&!i.isMonthSelected()&&!i.isMonthDisabled(a),"react-datepicker__month-text--in-selecting-range":i.isInSelectingRangeMonth(a),"react-datepicker__month-text--in-range":_&&T?uN(_,T,a,p):void 0,"react-datepicker__month-text--range-start":i.isRangeStartMonth(a),"react-datepicker__month-text--range-end":i.isRangeEndMonth(a),"react-datepicker__month-text--selecting-range-start":i.isSelectingMonthRangeStart(a),"react-datepicker__month-text--selecting-range-end":i.isSelectingMonthRangeEnd(a),"react-datepicker__month-text--today":i.isCurrentMonth(p,a)})},i.getTabIndex=function(a){if(i.props.preSelection==null)return"-1";var l=po(i.props.preSelection),p=i.isMonthDisabledForLabelDate(l).isDisabled,_=a===l&&!(p||i.props.disabledKeyboardNavigation)?"0":"-1";return _},i.getQuarterTabIndex=function(a){if(i.props.preSelection==null)return"-1";var l=R_(i.props.preSelection),p=hN(i.props.day,i.props),_=a===l&&!(p||i.props.disabledKeyboardNavigation)?"0":"-1";return _},i.getAriaLabel=function(a){var l=i.props,p=l.chooseDayAriaLabelPrefix,_=p===void 0?"Choose":p,T=l.disabledDayAriaLabelPrefix,w=T===void 0?"Not available":T,C=l.day,O=l.locale,k=xl(C,a),U=i.isDisabled(k)||i.isExcluded(k)?w:_;return"".concat(U," ").concat(Ji(k,"MMMM yyyy",O))},i.getQuarterClassNames=function(a){var l=i.props,p=l.day,_=l.startDate,T=l.endDate,w=l.selected,C=l.minDate,O=l.maxDate,k=l.excludeDates,U=l.includeDates,G=l.filterDate,z=l.preSelection,J=l.disabledKeyboardNavigation,X=(C||O||k||U||G)&&hN(Nv(p,a),i.props);return $i("react-datepicker__quarter-text","react-datepicker__quarter-".concat(a),{"react-datepicker__quarter-text--disabled":X,"react-datepicker__quarter-text--selected":w?i.isSelectedQuarter(p,a,w):void 0,"react-datepicker__quarter-text--keyboard-selected":!J&&z&&i.isSelectedQuarter(p,a,z)&&!X,"react-datepicker__quarter-text--in-selecting-range":i.isInSelectingRangeQuarter(a),"react-datepicker__quarter-text--in-range":_&&T?fN(_,T,a,p):void 0,"react-datepicker__quarter-text--range-start":i.isRangeStartQuarter(a),"react-datepicker__quarter-text--range-end":i.isRangeEndQuarter(a),"react-datepicker__quarter-text--today":i.isCurrentQuarter(p,a)})},i.getMonthContent=function(a){var l=i.props,p=l.showFullMonthYearPicker,_=l.renderMonthContent,T=l.locale,w=l.day,C=hQ(a,T),O=aU(a,T);return _?_(a,C,O,w):p?O:C},i.getQuarterContent=function(a){var l,p=i.props,_=p.renderQuarterContent,T=p.locale,w=Ywe(a,T);return(l=_==null?void 0:_(a,w))!==null&&l!==void 0?l:w},i.renderMonths=function(){var a,l=i.props,p=l.showTwoColumnMonthYearPicker,_=l.showFourColumnMonthYearPicker,T=l.day,w=l.selected,C=(a=SM[DY(_,p)])===null||a===void 0?void 0:a.grid;return C==null?void 0:C.map(function(O,k){return We.createElement("div",{className:"react-datepicker__month-wrapper",key:k},O.map(function(U,G){return We.createElement("div",{ref:i.MONTH_REFS[U],key:G,onClick:function(z){i.onMonthClick(z,U)},onKeyDown:function(z){gQ(z)&&(z.preventDefault(),z.key=Ht.Enter),i.onMonthKeyDown(z,U)},onMouseEnter:i.props.usePointerEvent?void 0:function(){return i.onMonthMouseEnter(U)},onPointerEnter:i.props.usePointerEvent?function(){return i.onMonthMouseEnter(U)}:void 0,tabIndex:Number(i.getTabIndex(U)),className:i.getMonthClassNames(U),"aria-disabled":i.isMonthDisabled(U),role:"option","aria-label":i.getAriaLabel(U),"aria-current":i.isCurrentMonth(T,U)?"date":void 0,"aria-selected":w?i.isSelectedMonth(T,U,w):void 0},i.getMonthContent(U))}))})},i.renderQuarters=function(){var a=i.props,l=a.day,p=a.selected,_=[1,2,3,4];return We.createElement("div",{className:"react-datepicker__quarter-wrapper"},_.map(function(T,w){return We.createElement("div",{key:w,ref:i.QUARTER_REFS[w],role:"option",onClick:function(C){i.onQuarterClick(C,T)},onKeyDown:function(C){i.onQuarterKeyDown(C,T)},onMouseEnter:i.props.usePointerEvent?void 0:function(){return i.onQuarterMouseEnter(T)},onPointerEnter:i.props.usePointerEvent?function(){return i.onQuarterMouseEnter(T)}:void 0,className:i.getQuarterClassNames(T),"aria-selected":p?i.isSelectedQuarter(l,T,p):void 0,tabIndex:Number(i.getQuarterTabIndex(T)),"aria-current":i.isCurrentQuarter(l,T)?"date":void 0},i.getQuarterContent(T))}))},i.getClassNames=function(){var a=i.props,l=a.selectingDate,p=a.selectsStart,_=a.selectsEnd,T=a.showMonthYearPicker,w=a.showQuarterYearPicker,C=a.showWeekPicker;return $i("react-datepicker__month",{"react-datepicker__month--selecting-range":l&&(p||_)},{"react-datepicker__monthPicker":T},{"react-datepicker__quarterPicker":w},{"react-datepicker__weekPicker":C})},i}return n.prototype.getSelection=function(){var i=this.props,a=i.selected,l=i.selectedDates,p=i.selectsMultiple;if(p)return l;if(a)return[a]},n.prototype.render=function(){var i=this.props,a=i.showMonthYearPicker,l=i.showQuarterYearPicker,p=i.day,_=i.ariaLabelPrefix,T=_===void 0?"Month ":_,w=T?T.trim()+" ":"";return We.createElement("div",{className:this.getClassNames(),onMouseLeave:this.props.usePointerEvent?void 0:this.handleMouseLeave,onPointerLeave:this.props.usePointerEvent?this.handleMouseLeave:void 0,"aria-label":"".concat(w).concat(Ji(p,"MMMM, yyyy",this.props.locale)),role:"listbox"},a?this.renderMonths():l?this.renderQuarters():this.renderWeeks())},n}(F.Component),l0e=function(s){wa(n,s);function n(){var i=s!==null&&s.apply(this,arguments)||this;return i.isSelectedMonth=function(a){return i.props.month===a},i.renderOptions=function(){return i.props.monthNames.map(function(a,l){return We.createElement("div",{className:i.isSelectedMonth(l)?"react-datepicker__month-option react-datepicker__month-option--selected_month":"react-datepicker__month-option",key:a,onClick:i.onChange.bind(i,l),"aria-selected":i.isSelectedMonth(l)?"true":void 0},i.isSelectedMonth(l)?We.createElement("span",{className:"react-datepicker__month-option--selected"},""):"",a)})},i.onChange=function(a){return i.props.onChange(a)},i.handleClickOutside=function(){return i.props.onCancel()},i}return n.prototype.render=function(){return We.createElement(FD,{className:"react-datepicker__month-dropdown",onClickOutside:this.handleClickOutside},this.renderOptions())},n}(F.Component),d0e=function(s){wa(n,s);function n(){var i=s!==null&&s.apply(this,arguments)||this;return i.state={dropdownVisible:!1},i.renderSelectOptions=function(a){return a.map(function(l,p){return We.createElement("option",{key:l,value:p},l)})},i.renderSelectMode=function(a){return We.createElement("select",{value:i.props.month,className:"react-datepicker__month-select",onChange:function(l){return i.onChange(parseInt(l.target.value))}},i.renderSelectOptions(a))},i.renderReadView=function(a,l){return We.createElement("div",{key:"read",style:{visibility:a?"visible":"hidden"},className:"react-datepicker__month-read-view",onClick:i.toggleDropdown},We.createElement("span",{className:"react-datepicker__month-read-view--down-arrow"}),We.createElement("span",{className:"react-datepicker__month-read-view--selected-month"},l[i.props.month]))},i.renderDropdown=function(a){return We.createElement(l0e,Yr({key:"dropdown"},i.props,{monthNames:a,onChange:i.onChange,onCancel:i.toggleDropdown}))},i.renderScrollMode=function(a){var l=i.state.dropdownVisible,p=[i.renderReadView(!l,a)];return l&&p.unshift(i.renderDropdown(a)),p},i.onChange=function(a){i.toggleDropdown(),a!==i.props.month&&i.props.onChange(a)},i.toggleDropdown=function(){return i.setState({dropdownVisible:!i.state.dropdownVisible})},i}return n.prototype.render=function(){var i=this,a=[0,1,2,3,4,5,6,7,8,9,10,11].map(this.props.useShortMonthInDropdown?function(p){return hQ(p,i.props.locale)}:function(p){return aU(p,i.props.locale)}),l;switch(this.props.dropdownMode){case"scroll":l=this.renderScrollMode(a);break;case"select":l=this.renderSelectMode(a);break}return We.createElement("div",{className:"react-datepicker__month-dropdown-container react-datepicker__month-dropdown-container--".concat(this.props.dropdownMode)},l)},n}(F.Component);function u0e(s,n){for(var i=[],a=cp(s),l=cp(n);!sm(a,l);)i.push(di(a)),a=Cd(a,1);return i}var h0e=function(s){wa(n,s);function n(i){var a=s.call(this,i)||this;return a.renderOptions=function(){return a.state.monthYearsList.map(function(l){var p=O2(l),_=ku(a.props.date,l)&&Lo(a.props.date,l);return We.createElement("div",{className:_?"react-datepicker__month-year-option--selected_month-year":"react-datepicker__month-year-option",key:p,onClick:a.onChange.bind(a,p),"aria-selected":_?"true":void 0},_?We.createElement("span",{className:"react-datepicker__month-year-option--selected"},""):"",Ji(l,a.props.dateFormat,a.props.locale))})},a.onChange=function(l){return a.props.onChange(l)},a.handleClickOutside=function(){a.props.onCancel()},a.state={monthYearsList:u0e(a.props.minDate,a.props.maxDate)},a}return n.prototype.render=function(){var i=$i({"react-datepicker__month-year-dropdown":!0,"react-datepicker__month-year-dropdown--scrollable":this.props.scrollableMonthYearDropdown});return We.createElement(FD,{className:i,onClickOutside:this.handleClickOutside},this.renderOptions())},n}(F.Component),p0e=function(s){wa(n,s);function n(){var i=s!==null&&s.apply(this,arguments)||this;return i.state={dropdownVisible:!1},i.renderSelectOptions=function(){for(var a=cp(i.props.minDate),l=cp(i.props.maxDate),p=[];!sm(a,l);){var _=O2(a);p.push(We.createElement("option",{key:_,value:_},Ji(a,i.props.dateFormat,i.props.locale))),a=Cd(a,1)}return p},i.onSelectChange=function(a){i.onChange(parseInt(a.target.value))},i.renderSelectMode=function(){return We.createElement("select",{value:O2(cp(i.props.date)),className:"react-datepicker__month-year-select",onChange:i.onSelectChange},i.renderSelectOptions())},i.renderReadView=function(a){var l=Ji(i.props.date,i.props.dateFormat,i.props.locale);return We.createElement("div",{key:"read",style:{visibility:a?"visible":"hidden"},className:"react-datepicker__month-year-read-view",onClick:i.toggleDropdown},We.createElement("span",{className:"react-datepicker__month-year-read-view--down-arrow"}),We.createElement("span",{className:"react-datepicker__month-year-read-view--selected-month-year"},l))},i.renderDropdown=function(){return We.createElement(h0e,Yr({key:"dropdown"},i.props,{onChange:i.onChange,onCancel:i.toggleDropdown}))},i.renderScrollMode=function(){var a=i.state.dropdownVisible,l=[i.renderReadView(!a)];return a&&l.unshift(i.renderDropdown()),l},i.onChange=function(a){i.toggleDropdown();var l=di(a);ku(i.props.date,l)&&Lo(i.props.date,l)||i.props.onChange(l)},i.toggleDropdown=function(){return i.setState({dropdownVisible:!i.state.dropdownVisible})},i}return n.prototype.render=function(){var i;switch(this.props.dropdownMode){case"scroll":i=this.renderScrollMode();break;case"select":i=this.renderSelectMode();break}return We.createElement("div",{className:"react-datepicker__month-year-dropdown-container react-datepicker__month-year-dropdown-container--".concat(this.props.dropdownMode)},i)},n}(F.Component),f0e=function(s){wa(n,s);function n(){var i=s!==null&&s.apply(this,arguments)||this;return i.state={height:null},i.scrollToTheSelectedTime=function(){requestAnimationFrame(function(){var a,l,p;i.list&&(i.list.scrollTop=(p=i.centerLi&&n.calcCenterPosition(i.props.monthRef?i.props.monthRef.clientHeight-((l=(a=i.header)===null||a===void 0?void 0:a.clientHeight)!==null&&l!==void 0?l:0):i.list.clientHeight,i.centerLi))!==null&&p!==void 0?p:0)})},i.handleClick=function(a){var l,p;(i.props.minTime||i.props.maxTime)&&SY(a,i.props)||(i.props.excludeTimes||i.props.includeTimes||i.props.filterTime)&&vY(a,i.props)||(p=(l=i.props).onChange)===null||p===void 0||p.call(l,a)},i.isSelectedTime=function(a){return i.props.selected&&n0e(i.props.selected,a)},i.isDisabledTime=function(a){return(i.props.minTime||i.props.maxTime)&&SY(a,i.props)||(i.props.excludeTimes||i.props.includeTimes||i.props.filterTime)&&vY(a,i.props)},i.liClasses=function(a){var l,p=["react-datepicker__time-list-item",i.props.timeClassName?i.props.timeClassName(a):void 0];return i.isSelectedTime(a)&&p.push("react-datepicker__time-list-item--selected"),i.isDisabledTime(a)&&p.push("react-datepicker__time-list-item--disabled"),i.props.injectTimes&&(ap(a)*3600+op(a)*60+Qf(a))%(((l=i.props.intervals)!==null&&l!==void 0?l:n.defaultProps.intervals)*60)!==0&&p.push("react-datepicker__time-list-item--injected"),p.join(" ")},i.handleOnKeyDown=function(a,l){var p,_;a.key===Ht.Space&&(a.preventDefault(),a.key=Ht.Enter),(a.key===Ht.ArrowUp||a.key===Ht.ArrowLeft)&&a.target instanceof HTMLElement&&a.target.previousSibling&&(a.preventDefault(),a.target.previousSibling instanceof HTMLElement&&a.target.previousSibling.focus()),(a.key===Ht.ArrowDown||a.key===Ht.ArrowRight)&&a.target instanceof HTMLElement&&a.target.nextSibling&&(a.preventDefault(),a.target.nextSibling instanceof HTMLElement&&a.target.nextSibling.focus()),a.key===Ht.Enter&&i.handleClick(l),(_=(p=i.props).handleOnKeyDown)===null||_===void 0||_.call(p,a)},i.renderTimes=function(){for(var a,l=[],p=typeof i.props.format=="string"?i.props.format:"p",_=(a=i.props.intervals)!==null&&a!==void 0?a:n.defaultProps.intervals,T=i.props.selected||i.props.openToDate||di(),w=cO(T),C=i.props.injectTimes&&i.props.injectTimes.sort(function(X,ie){return X.getTime()-ie.getTime()}),O=60*t0e(T),k=O/_,U=0;U<k;U++){var G=A2(w,U*_);if(l.push(G),C){var z=e0e(w,G,U,_,C);l=l.concat(z)}}var J=l.reduce(function(X,ie){return ie.getTime()<=T.getTime()?ie:X},l[0]);return l.map(function(X){return We.createElement("li",{key:X.valueOf(),onClick:i.handleClick.bind(i,X),className:i.liClasses(X),ref:function(ie){X===J&&(i.centerLi=ie)},onKeyDown:function(ie){i.handleOnKeyDown(ie,X)},tabIndex:X===J?0:-1,role:"option","aria-selected":i.isSelectedTime(X)?"true":void 0,"aria-disabled":i.isDisabledTime(X)?"true":void 0},Ji(X,p,i.props.locale))})},i.renderTimeCaption=function(){return i.props.showTimeCaption===!1?We.createElement(We.Fragment,null):We.createElement("div",{className:"react-datepicker__header react-datepicker__header--time ".concat(i.props.showTimeSelectOnly?"react-datepicker__header--time--only":""),ref:function(a){i.header=a}},We.createElement("div",{className:"react-datepicker-time__header"},i.props.timeCaption))},i}return Object.defineProperty(n,"defaultProps",{get:function(){return{intervals:30,todayButton:null,timeCaption:"Time",showTimeCaption:!0}},enumerable:!1,configurable:!0}),n.prototype.componentDidMount=function(){this.scrollToTheSelectedTime(),this.observeDatePickerHeightChanges()},n.prototype.componentWillUnmount=function(){var i;(i=this.resizeObserver)===null||i===void 0||i.disconnect()},n.prototype.observeDatePickerHeightChanges=function(){var i=this,a=this.props.monthRef;this.updateContainerHeight(),a&&(this.resizeObserver=new ResizeObserver(function(){i.updateContainerHeight()}),this.resizeObserver.observe(a))},n.prototype.updateContainerHeight=function(){this.props.monthRef&&this.header&&this.setState({height:this.props.monthRef.clientHeight-this.header.clientHeight})},n.prototype.render=function(){var i=this,a,l=this.state.height;return We.createElement("div",{className:"react-datepicker__time-container ".concat(((a=this.props.todayButton)!==null&&a!==void 0?a:n.defaultProps.todayButton)?"react-datepicker__time-container--with-today-button":"")},this.renderTimeCaption(),We.createElement("div",{className:"react-datepicker__time"},We.createElement("div",{className:"react-datepicker__time-box"},We.createElement("ul",{className:"react-datepicker__time-list",ref:function(p){i.list=p},style:l?{height:l}:{},role:"listbox","aria-label":this.props.timeCaption},this.renderTimes()))))},n.calcCenterPosition=function(i,a){return a.offsetTop-(i/2-a.clientHeight/2)},n}(F.Component),xY=3,m0e=function(s){wa(n,s);function n(i){var a=s.call(this,i)||this;return a.YEAR_REFS=Vu([],Array(a.props.yearItemNumber),!0).map(function(){return F.createRef()}),a.isDisabled=function(l){return Pl(l,{minDate:a.props.minDate,maxDate:a.props.maxDate,excludeDates:a.props.excludeDates,includeDates:a.props.includeDates,filterDate:a.props.filterDate})},a.isExcluded=function(l){return oU(l,{excludeDates:a.props.excludeDates})},a.selectingDate=function(){var l;return(l=a.props.selectingDate)!==null&&l!==void 0?l:a.props.preSelection},a.updateFocusOnPaginate=function(l){var p=function(){var _,T;(T=(_=a.YEAR_REFS[l])===null||_===void 0?void 0:_.current)===null||T===void 0||T.focus()};window.requestAnimationFrame(p)},a.handleYearClick=function(l,p){a.props.onDayClick&&a.props.onDayClick(l,p)},a.handleYearNavigation=function(l,p){var _,T,w,C,O=a.props,k=O.date,U=O.yearItemNumber;if(!(k===void 0||U===void 0)){var G=Wf(k,U).startPeriod;a.isDisabled(p)||a.isExcluded(p)||((T=(_=a.props).setPreSelection)===null||T===void 0||T.call(_,p),l-G<0?a.updateFocusOnPaginate(U-(G-l)):l-G>=U?a.updateFocusOnPaginate(Math.abs(U-(l-G))):(C=(w=a.YEAR_REFS[l-G])===null||w===void 0?void 0:w.current)===null||C===void 0||C.focus())}},a.isSameDay=function(l,p){return zr(l,p)},a.isCurrentYear=function(l){return l===_r(di())},a.isRangeStart=function(l){return a.props.startDate&&a.props.endDate&&ku(Pu(di(),l),a.props.startDate)},a.isRangeEnd=function(l){return a.props.startDate&&a.props.endDate&&ku(Pu(di(),l),a.props.endDate)},a.isInRange=function(l){return pN(l,a.props.startDate,a.props.endDate)},a.isInSelectingRange=function(l){var p=a.props,_=p.selectsStart,T=p.selectsEnd,w=p.selectsRange,C=p.startDate,O=p.endDate;return!(_||T||w)||!a.selectingDate()?!1:_&&O?pN(l,a.selectingDate(),O):T&&C||w&&C&&!O?pN(l,C,a.selectingDate()):!1},a.isSelectingRangeStart=function(l){var p;if(!a.isInSelectingRange(l))return!1;var _=a.props,T=_.startDate,w=_.selectsStart,C=Pu(di(),l);return w?ku(C,(p=a.selectingDate())!==null&&p!==void 0?p:null):ku(C,T??null)},a.isSelectingRangeEnd=function(l){var p;if(!a.isInSelectingRange(l))return!1;var _=a.props,T=_.endDate,w=_.selectsEnd,C=_.selectsRange,O=Pu(di(),l);return w||C?ku(O,(p=a.selectingDate())!==null&&p!==void 0?p:null):ku(O,T??null)},a.isKeyboardSelected=function(l){if(!(a.props.date===void 0||a.props.selected==null||a.props.preSelection==null)){var p=a.props,_=p.minDate,T=p.maxDate,w=p.excludeDates,C=p.includeDates,O=p.filterDate,k=jw(Pu(a.props.date,l)),U=(_||T||w||C||O)&&lO(l,a.props);return!a.props.disabledKeyboardNavigation&&!a.props.inline&&!zr(k,jw(a.props.selected))&&zr(k,jw(a.props.preSelection))&&!U}},a.isSelectedYear=function(l){var p=a.props,_=p.selectsMultiple,T=p.selected,w=p.selectedDates;return _?w==null?void 0:w.some(function(C){return l===_r(C)}):!!T&&l===_r(T)},a.onYearClick=function(l,p){var _=a.props.date;_!==void 0&&a.handleYearClick(jw(Pu(_,p)),l)},a.onYearKeyDown=function(l,p){var _,T,w=l.key,C=a.props,O=C.date,k=C.yearItemNumber,U=C.handleOnKeyDown;if(w!==Ht.Tab&&l.preventDefault(),!a.props.disabledKeyboardNavigation)switch(w){case Ht.Enter:if(a.props.selected==null)break;a.onYearClick(l,p),(T=(_=a.props).setPreSelection)===null||T===void 0||T.call(_,a.props.selected);break;case Ht.ArrowRight:if(a.props.preSelection==null)break;a.handleYearNavigation(p+1,ip(a.props.preSelection,1));break;case Ht.ArrowLeft:if(a.props.preSelection==null)break;a.handleYearNavigation(p-1,Xv(a.props.preSelection,1));break;case Ht.ArrowUp:{if(O===void 0||k===void 0||a.props.preSelection==null)break;var G=Wf(O,k).startPeriod,z=xY,J=p-z;if(J<G){var X=k%z;p>=G&&p<G+X?z=X:z+=X,J=p-z}a.handleYearNavigation(J,Xv(a.props.preSelection,z));break}case Ht.ArrowDown:{if(O===void 0||k===void 0||a.props.preSelection==null)break;var ie=Wf(O,k).endPeriod,z=xY,J=p+z;if(J>ie){var X=k%z;p<=ie&&p>ie-X?z=X:z+=X,J=p+z}a.handleYearNavigation(J,ip(a.props.preSelection,z));break}}U&&U(l)},a.getYearClassNames=function(l){var p=a.props,_=p.date,T=p.minDate,w=p.maxDate,C=p.excludeDates,O=p.includeDates,k=p.filterDate,U=p.yearClassName;return $i("react-datepicker__year-text","react-datepicker__year-".concat(l),_?U==null?void 0:U(Pu(_,l)):void 0,{"react-datepicker__year-text--selected":a.isSelectedYear(l),"react-datepicker__year-text--disabled":(T||w||C||O||k)&&lO(l,a.props),"react-datepicker__year-text--keyboard-selected":a.isKeyboardSelected(l),"react-datepicker__year-text--range-start":a.isRangeStart(l),"react-datepicker__year-text--range-end":a.isRangeEnd(l),"react-datepicker__year-text--in-range":a.isInRange(l),"react-datepicker__year-text--in-selecting-range":a.isInSelectingRange(l),"react-datepicker__year-text--selecting-range-start":a.isSelectingRangeStart(l),"react-datepicker__year-text--selecting-range-end":a.isSelectingRangeEnd(l),"react-datepicker__year-text--today":a.isCurrentYear(l)})},a.getYearTabIndex=function(l){if(a.props.disabledKeyboardNavigation||a.props.preSelection==null)return"-1";var p=_r(a.props.preSelection),_=lO(l,a.props);return l===p&&!_?"0":"-1"},a.getYearContent=function(l){return a.props.renderYearContent?a.props.renderYearContent(l):l},a}return n.prototype.render=function(){var i=this,a=[],l=this.props,p=l.date,_=l.yearItemNumber,T=l.onYearMouseEnter,w=l.onYearMouseLeave;if(p===void 0)return null;for(var C=Wf(p,_),O=C.startPeriod,k=C.endPeriod,U=function(J){a.push(We.createElement("div",{ref:G.YEAR_REFS[J-O],onClick:function(X){i.onYearClick(X,J)},onKeyDown:function(X){gQ(X)&&(X.preventDefault(),X.key=Ht.Enter),i.onYearKeyDown(X,J)},tabIndex:Number(G.getYearTabIndex(J)),className:G.getYearClassNames(J),onMouseEnter:G.props.usePointerEvent?void 0:function(X){return T(X,J)},onPointerEnter:G.props.usePointerEvent?function(X){return T(X,J)}:void 0,onMouseLeave:G.props.usePointerEvent?void 0:function(X){return w(X,J)},onPointerLeave:G.props.usePointerEvent?function(X){return w(X,J)}:void 0,key:J,"aria-current":G.isCurrentYear(J)?"date":void 0},G.getYearContent(J)))},G=this,z=O;z<=k;z++)U(z);return We.createElement("div",{className:"react-datepicker__year"},We.createElement("div",{className:"react-datepicker__year-wrapper",onMouseLeave:this.props.usePointerEvent?void 0:this.props.clearSelectingDate,onPointerLeave:this.props.usePointerEvent?this.props.clearSelectingDate:void 0},a))},n}(F.Component);function g0e(s,n,i,a){for(var l=[],p=0;p<2*n+1;p++){var _=s+n-p,T=!0;i&&(T=_r(i)<=_),a&&T&&(T=_r(a)>=_),T&&l.push(_)}return l}var _0e=function(s){wa(n,s);function n(i){var a=s.call(this,i)||this;a.renderOptions=function(){var T=a.props.year,w=a.state.yearsList.map(function(k){return We.createElement("div",{className:T===k?"react-datepicker__year-option react-datepicker__year-option--selected_year":"react-datepicker__year-option",key:k,onClick:a.onChange.bind(a,k),"aria-selected":T===k?"true":void 0},T===k?We.createElement("span",{className:"react-datepicker__year-option--selected"},""):"",k)}),C=a.props.minDate?_r(a.props.minDate):null,O=a.props.maxDate?_r(a.props.maxDate):null;return(!O||!a.state.yearsList.find(function(k){return k===O}))&&w.unshift(We.createElement("div",{className:"react-datepicker__year-option",key:"upcoming",onClick:a.incrementYears},We.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-upcoming"}))),(!C||!a.state.yearsList.find(function(k){return k===C}))&&w.push(We.createElement("div",{className:"react-datepicker__year-option",key:"previous",onClick:a.decrementYears},We.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-previous"}))),w},a.onChange=function(T){a.props.onChange(T)},a.handleClickOutside=function(){a.props.onCancel()},a.shiftYears=function(T){var w=a.state.yearsList.map(function(C){return C+T});a.setState({yearsList:w})},a.incrementYears=function(){return a.shiftYears(1)},a.decrementYears=function(){return a.shiftYears(-1)};var l=i.yearDropdownItemNumber,p=i.scrollableYearDropdown,_=l||(p?10:5);return a.state={yearsList:g0e(a.props.year,_,a.props.minDate,a.props.maxDate)},a.dropdownRef=F.createRef(),a}return n.prototype.componentDidMount=function(){var i=this.dropdownRef.current;if(i){var a=i.children?Array.from(i.children):null,l=a?a.find(function(p){return p.ariaSelected}):null;i.scrollTop=l&&l instanceof HTMLElement?l.offsetTop+(l.clientHeight-i.clientHeight)/2:(i.scrollHeight-i.clientHeight)/2}},n.prototype.render=function(){var i=$i({"react-datepicker__year-dropdown":!0,"react-datepicker__year-dropdown--scrollable":this.props.scrollableYearDropdown});return We.createElement(FD,{className:i,containerRef:this.dropdownRef,onClickOutside:this.handleClickOutside},this.renderOptions())},n}(F.Component),E0e=function(s){wa(n,s);function n(){var i=s!==null&&s.apply(this,arguments)||this;return i.state={dropdownVisible:!1},i.renderSelectOptions=function(){for(var a=i.props.minDate?_r(i.props.minDate):1900,l=i.props.maxDate?_r(i.props.maxDate):2100,p=[],_=a;_<=l;_++)p.push(We.createElement("option",{key:_,value:_},_));return p},i.onSelectChange=function(a){i.onChange(parseInt(a.target.value))},i.renderSelectMode=function(){return We.createElement("select",{value:i.props.year,className:"react-datepicker__year-select",onChange:i.onSelectChange},i.renderSelectOptions())},i.renderReadView=function(a){return We.createElement("div",{key:"read",style:{visibility:a?"visible":"hidden"},className:"react-datepicker__year-read-view",onClick:function(l){return i.toggleDropdown(l)}},We.createElement("span",{className:"react-datepicker__year-read-view--down-arrow"}),We.createElement("span",{className:"react-datepicker__year-read-view--selected-year"},i.props.year))},i.renderDropdown=function(){return We.createElement(_0e,Yr({key:"dropdown"},i.props,{onChange:i.onChange,onCancel:i.toggleDropdown}))},i.renderScrollMode=function(){var a=i.state.dropdownVisible,l=[i.renderReadView(!a)];return a&&l.unshift(i.renderDropdown()),l},i.onChange=function(a){i.toggleDropdown(),a!==i.props.year&&i.props.onChange(a)},i.toggleDropdown=function(a){i.setState({dropdownVisible:!i.state.dropdownVisible},function(){i.props.adjustDateOnChange&&i.handleYearChange(i.props.date,a)})},i.handleYearChange=function(a,l){var p;(p=i.onSelect)===null||p===void 0||p.call(i,a,l),i.setOpen()},i.onSelect=function(a,l){var p,_;(_=(p=i.props).onSelect)===null||_===void 0||_.call(p,a,l)},i.setOpen=function(){var a,l;(l=(a=i.props).setOpen)===null||l===void 0||l.call(a,!0)},i}return n.prototype.render=function(){var i;switch(this.props.dropdownMode){case"scroll":i=this.renderScrollMode();break;case"select":i=this.renderSelectMode();break}return We.createElement("div",{className:"react-datepicker__year-dropdown-container react-datepicker__year-dropdown-container--".concat(this.props.dropdownMode)},i)},n}(F.Component),y0e=["react-datepicker__year-select","react-datepicker__month-select","react-datepicker__month-year-select"],v0e=function(s){var n=(s.className||"").split(/\s+/);return y0e.some(function(i){return n.indexOf(i)>=0})},S0e=function(s){wa(n,s);function n(i){var a=s.call(this,i)||this;return a.monthContainer=void 0,a.handleClickOutside=function(l){a.props.onClickOutside(l)},a.setClickOutsideRef=function(){return a.containerRef.current},a.handleDropdownFocus=function(l){var p,_;v0e(l.target)&&((_=(p=a.props).onDropdownFocus)===null||_===void 0||_.call(p,l))},a.getDateInView=function(){var l=a.props,p=l.preSelection,_=l.selected,T=l.openToDate,w=fQ(a.props),C=mQ(a.props),O=di(),k=T||_||p;return k||(w&&M_(O,w)?w:C&&sm(O,C)?C:O)},a.increaseMonth=function(){a.setState(function(l){var p=l.date;return{date:Cd(p,1)}},function(){return a.handleMonthChange(a.state.date)})},a.decreaseMonth=function(){a.setState(function(l){var p=l.date;return{date:C_(p,1)}},function(){return a.handleMonthChange(a.state.date)})},a.handleDayClick=function(l,p,_){a.props.onSelect(l,p,_),a.props.setPreSelection&&a.props.setPreSelection(l)},a.handleDayMouseEnter=function(l){a.setState({selectingDate:l}),a.props.onDayMouseEnter&&a.props.onDayMouseEnter(l)},a.handleMonthMouseLeave=function(){a.setState({selectingDate:void 0}),a.props.onMonthMouseLeave&&a.props.onMonthMouseLeave()},a.handleYearMouseEnter=function(l,p){a.setState({selectingDate:Pu(di(),p)}),a.props.onYearMouseEnter&&a.props.onYearMouseEnter(l,p)},a.handleYearMouseLeave=function(l,p){a.props.onYearMouseLeave&&a.props.onYearMouseLeave(l,p)},a.handleYearChange=function(l){var p,_,T,w;(_=(p=a.props).onYearChange)===null||_===void 0||_.call(p,l),a.setState({isRenderAriaLiveMessage:!0}),a.props.adjustDateOnChange&&(a.props.onSelect(l),(w=(T=a.props).setOpen)===null||w===void 0||w.call(T,!0)),a.props.setPreSelection&&a.props.setPreSelection(l)},a.getEnabledPreSelectionDateForMonth=function(l){if(!Pl(l,a.props))return l;for(var p=cp(l),_=Hwe(l),T=Zve(_,p),w=null,C=0;C<=T;C++){var O=bd(p,C);if(!Pl(O,a.props)){w=O;break}}return w},a.handleMonthChange=function(l){var p,_,T,w=(p=a.getEnabledPreSelectionDateForMonth(l))!==null&&p!==void 0?p:l;a.handleCustomMonthChange(w),a.props.adjustDateOnChange&&(a.props.onSelect(w),(T=(_=a.props).setOpen)===null||T===void 0||T.call(_,!0)),a.props.setPreSelection&&a.props.setPreSelection(w)},a.handleCustomMonthChange=function(l){var p,_;(_=(p=a.props).onMonthChange)===null||_===void 0||_.call(p,l),a.setState({isRenderAriaLiveMessage:!0})},a.handleMonthYearChange=function(l){a.handleYearChange(l),a.handleMonthChange(l)},a.changeYear=function(l){a.setState(function(p){var _=p.date;return{date:Pu(_,Number(l))}},function(){return a.handleYearChange(a.state.date)})},a.changeMonth=function(l){a.setState(function(p){var _=p.date;return{date:xl(_,Number(l))}},function(){return a.handleMonthChange(a.state.date)})},a.changeMonthYear=function(l){a.setState(function(p){var _=p.date;return{date:Pu(xl(_,po(l)),_r(l))}},function(){return a.handleMonthYearChange(a.state.date)})},a.header=function(l){l===void 0&&(l=a.state.date);var p=$f(l,a.props.locale,a.props.calendarStartDay),_=[];return a.props.showWeekNumbers&&_.push(We.createElement("div",{key:"W",className:"react-datepicker__day-name"},a.props.weekLabel||"#")),_.concat([0,1,2,3,4,5,6].map(function(T){var w=bd(p,T),C=a.formatWeekday(w,a.props.locale),O=a.props.weekDayClassName?a.props.weekDayClassName(w):void 0;return We.createElement("div",{key:T,"aria-label":Ji(w,"EEEE",a.props.locale),className:$i("react-datepicker__day-name",O)},C)}))},a.formatWeekday=function(l,p){return a.props.formatWeekDay?Gwe(l,a.props.formatWeekDay,p):a.props.useWeekdaysShort?zwe(l,p):Wwe(l,p)},a.decreaseYear=function(){a.setState(function(l){var p,_=l.date;return{date:Xv(_,a.props.showYearPicker?(p=a.props.yearItemNumber)!==null&&p!==void 0?p:n.defaultProps.yearItemNumber:1)}},function(){return a.handleYearChange(a.state.date)})},a.clearSelectingDate=function(){a.setState({selectingDate:void 0})},a.renderPreviousButton=function(){var l,p,_;if(!a.props.renderCustomHeader){var T=(l=a.props.monthsShown)!==null&&l!==void 0?l:n.defaultProps.monthsShown,w=a.props.showPreviousMonths?T-1:0,C=(p=a.props.monthSelectedIn)!==null&&p!==void 0?p:w,O=C_(a.state.date,C),k;switch(!0){case a.props.showMonthYearPicker:k=wY(a.state.date,a.props);break;case a.props.showYearPicker:k=Qwe(a.state.date,a.props);break;case a.props.showQuarterYearPicker:k=Kwe(a.state.date,a.props);break;default:k=TY(O,a.props);break}if(!(!((_=a.props.forceShowMonthNavigation)!==null&&_!==void 0?_:n.defaultProps.forceShowMonthNavigation)&&!a.props.showDisabledMonthNavigation&&k||a.props.showTimeSelectOnly)){var U=["react-datepicker__navigation-icon","react-datepicker__navigation-icon--previous"],G=["react-datepicker__navigation","react-datepicker__navigation--previous"],z=a.decreaseMonth;(a.props.showMonthYearPicker||a.props.showQuarterYearPicker||a.props.showYearPicker)&&(z=a.decreaseYear),k&&a.props.showDisabledMonthNavigation&&(G.push("react-datepicker__navigation--previous--disabled"),z=void 0);var J=a.props.showMonthYearPicker||a.props.showQuarterYearPicker||a.props.showYearPicker,X=a.props,ie=X.previousMonthButtonLabel,oe=ie===void 0?n.defaultProps.previousMonthButtonLabel:ie,ce=X.previousYearButtonLabel,_e=ce===void 0?n.defaultProps.previousYearButtonLabel:ce,se=a.props,be=se.previousMonthAriaLabel,ee=be===void 0?typeof oe=="string"?oe:"Previous Month":be,Q=se.previousYearAriaLabel,q=Q===void 0?typeof _e=="string"?_e:"Previous Year":Q;return We.createElement("button",{type:"button",className:G.join(" "),onClick:z,onKeyDown:a.props.handleOnKeyDown,"aria-label":J?q:ee},We.createElement("span",{className:U.join(" ")},J?_e:oe))}}},a.increaseYear=function(){a.setState(function(l){var p,_=l.date;return{date:ip(_,a.props.showYearPicker?(p=a.props.yearItemNumber)!==null&&p!==void 0?p:n.defaultProps.yearItemNumber:1)}},function(){return a.handleYearChange(a.state.date)})},a.renderNextButton=function(){var l;if(!a.props.renderCustomHeader){var p;switch(!0){case a.props.showMonthYearPicker:p=RY(a.state.date,a.props);break;case a.props.showYearPicker:p=$we(a.state.date,a.props);break;case a.props.showQuarterYearPicker:p=Xwe(a.state.date,a.props);break;default:p=bY(a.state.date,a.props);break}if(!(!((l=a.props.forceShowMonthNavigation)!==null&&l!==void 0?l:n.defaultProps.forceShowMonthNavigation)&&!a.props.showDisabledMonthNavigation&&p||a.props.showTimeSelectOnly)){var _=["react-datepicker__navigation","react-datepicker__navigation--next"],T=["react-datepicker__navigation-icon","react-datepicker__navigation-icon--next"];a.props.showTimeSelect&&_.push("react-datepicker__navigation--next--with-time"),a.props.todayButton&&_.push("react-datepicker__navigation--next--with-today-button");var w=a.increaseMonth;(a.props.showMonthYearPicker||a.props.showQuarterYearPicker||a.props.showYearPicker)&&(w=a.increaseYear),p&&a.props.showDisabledMonthNavigation&&(_.push("react-datepicker__navigation--next--disabled"),w=void 0);var C=a.props.showMonthYearPicker||a.props.showQuarterYearPicker||a.props.showYearPicker,O=a.props,k=O.nextMonthButtonLabel,U=k===void 0?n.defaultProps.nextMonthButtonLabel:k,G=O.nextYearButtonLabel,z=G===void 0?n.defaultProps.nextYearButtonLabel:G,J=a.props,X=J.nextMonthAriaLabel,ie=X===void 0?typeof U=="string"?U:"Next Month":X,oe=J.nextYearAriaLabel,ce=oe===void 0?typeof z=="string"?z:"Next Year":oe;return We.createElement("button",{type:"button",className:_.join(" "),onClick:w,onKeyDown:a.props.handleOnKeyDown,"aria-label":C?ce:ie},We.createElement("span",{className:T.join(" ")},C?z:U))}}},a.renderCurrentMonth=function(l){l===void 0&&(l=a.state.date);var p=["react-datepicker__current-month"];return a.props.showYearDropdown&&p.push("react-datepicker__current-month--hasYearDropdown"),a.props.showMonthDropdown&&p.push("react-datepicker__current-month--hasMonthDropdown"),a.props.showMonthYearDropdown&&p.push("react-datepicker__current-month--hasMonthYearDropdown"),We.createElement("h2",{className:p.join(" ")},Ji(l,a.props.dateFormat,a.props.locale))},a.renderYearDropdown=function(l){if(l===void 0&&(l=!1),!(!a.props.showYearDropdown||l))return We.createElement(E0e,Yr({},n.defaultProps,a.props,{date:a.state.date,onChange:a.changeYear,year:_r(a.state.date)}))},a.renderMonthDropdown=function(l){if(l===void 0&&(l=!1),!(!a.props.showMonthDropdown||l))return We.createElement(d0e,Yr({},n.defaultProps,a.props,{month:po(a.state.date),onChange:a.changeMonth}))},a.renderMonthYearDropdown=function(l){if(l===void 0&&(l=!1),!(!a.props.showMonthYearDropdown||l))return We.createElement(p0e,Yr({},n.defaultProps,a.props,{date:a.state.date,onChange:a.changeMonthYear}))},a.handleTodayButtonClick=function(l){a.props.onSelect(_Y(),l),a.props.setPreSelection&&a.props.setPreSelection(_Y())},a.renderTodayButton=function(){if(!(!a.props.todayButton||a.props.showTimeSelectOnly))return We.createElement("div",{className:"react-datepicker__today-button",onClick:a.handleTodayButtonClick},a.props.todayButton)},a.renderDefaultHeader=function(l){var p=l.monthDate,_=l.i;return We.createElement("div",{className:"react-datepicker__header ".concat(a.props.showTimeSelect?"react-datepicker__header--has-time-select":"")},a.renderCurrentMonth(p),We.createElement("div",{className:"react-datepicker__header__dropdown react-datepicker__header__dropdown--".concat(a.props.dropdownMode),onFocus:a.handleDropdownFocus},a.renderMonthDropdown(_!==0),a.renderMonthYearDropdown(_!==0),a.renderYearDropdown(_!==0)),We.createElement("div",{className:"react-datepicker__day-names"},a.header(p)))},a.renderCustomHeader=function(l){var p,_,T=l.monthDate,w=l.i;if(a.props.showTimeSelect&&!a.state.monthContainer||a.props.showTimeSelectOnly)return null;var C=TY(a.state.date,a.props),O=bY(a.state.date,a.props),k=wY(a.state.date,a.props),U=RY(a.state.date,a.props),G=!a.props.showMonthYearPicker&&!a.props.showQuarterYearPicker&&!a.props.showYearPicker;return We.createElement("div",{className:"react-datepicker__header react-datepicker__header--custom",onFocus:a.props.onDropdownFocus},(_=(p=a.props).renderCustomHeader)===null||_===void 0?void 0:_.call(p,Yr(Yr({},a.state),{customHeaderCount:w,monthDate:T,changeMonth:a.changeMonth,changeYear:a.changeYear,decreaseMonth:a.decreaseMonth,increaseMonth:a.increaseMonth,decreaseYear:a.decreaseYear,increaseYear:a.increaseYear,prevMonthButtonDisabled:C,nextMonthButtonDisabled:O,prevYearButtonDisabled:k,nextYearButtonDisabled:U})),G&&We.createElement("div",{className:"react-datepicker__day-names"},a.header(T)))},a.renderYearHeader=function(l){var p=l.monthDate,_=a.props,T=_.showYearPicker,w=_.yearItemNumber,C=w===void 0?n.defaultProps.yearItemNumber:w,O=Wf(p,C),k=O.startPeriod,U=O.endPeriod;return We.createElement("div",{className:"react-datepicker__header react-datepicker-year-header"},T?"".concat(k," - ").concat(U):_r(p))},a.renderHeader=function(l){var p=l.monthDate,_=l.i,T=_===void 0?0:_,w={monthDate:p,i:T};switch(!0){case a.props.renderCustomHeader!==void 0:return a.renderCustomHeader(w);case(a.props.showMonthYearPicker||a.props.showQuarterYearPicker||a.props.showYearPicker):return a.renderYearHeader(w);default:return a.renderDefaultHeader(w)}},a.renderMonths=function(){var l,p;if(!(a.props.showTimeSelectOnly||a.props.showYearPicker)){for(var _=[],T=(l=a.props.monthsShown)!==null&&l!==void 0?l:n.defaultProps.monthsShown,w=a.props.showPreviousMonths?T-1:0,C=a.props.showMonthYearPicker||a.props.showQuarterYearPicker?ip(a.state.date,w):C_(a.state.date,w),O=(p=a.props.monthSelectedIn)!==null&&p!==void 0?p:w,k=0;k<T;++k){var U=k-O+w,G=a.props.showMonthYearPicker||a.props.showQuarterYearPicker?ip(C,U):Cd(C,U),z="month-".concat(k),J=k<T-1,X=k>0;_.push(We.createElement("div",{key:z,ref:function(ie){a.monthContainer=ie??void 0},className:"react-datepicker__month-container"},a.renderHeader({monthDate:G,i:k}),We.createElement(c0e,Yr({},n.defaultProps,a.props,{containerRef:a.containerRef,ariaLabelPrefix:a.props.monthAriaLabelPrefix,day:G,onDayClick:a.handleDayClick,handleOnKeyDown:a.props.handleOnDayKeyDown,handleOnMonthKeyDown:a.props.handleOnKeyDown,onDayMouseEnter:a.handleDayMouseEnter,onMouseLeave:a.handleMonthMouseLeave,orderInDisplay:k,selectingDate:a.state.selectingDate,monthShowsDuplicateDaysEnd:J,monthShowsDuplicateDaysStart:X}))))}return _}},a.renderYears=function(){if(!a.props.showTimeSelectOnly&&a.props.showYearPicker)return We.createElement("div",{className:"react-datepicker__year--container"},a.renderHeader({monthDate:a.state.date}),We.createElement(m0e,Yr({},n.defaultProps,a.props,{selectingDate:a.state.selectingDate,date:a.state.date,onDayClick:a.handleDayClick,clearSelectingDate:a.clearSelectingDate,onYearMouseEnter:a.handleYearMouseEnter,onYearMouseLeave:a.handleYearMouseLeave})))},a.renderTimeSection=function(){if(a.props.showTimeSelect&&(a.state.monthContainer||a.props.showTimeSelectOnly))return We.createElement(f0e,Yr({},n.defaultProps,a.props,{onChange:a.props.onTimeChange,format:a.props.timeFormat,intervals:a.props.timeIntervals,monthRef:a.state.monthContainer}))},a.renderInputTimeSection=function(){var l=a.props.selected?new Date(a.props.selected):void 0,p=l&&BD(l)&&!!a.props.selected,_=p?"".concat(AY(l.getHours()),":").concat(AY(l.getMinutes())):"";if(a.props.showTimeInput)return We.createElement(r0e,Yr({},n.defaultProps,a.props,{date:l,timeString:_,onChange:a.props.onTimeChange}))},a.renderAriaLiveRegion=function(){var l,p=Wf(a.state.date,(l=a.props.yearItemNumber)!==null&&l!==void 0?l:n.defaultProps.yearItemNumber),_=p.startPeriod,T=p.endPeriod,w;return a.props.showYearPicker?w="".concat(_," - ").concat(T):a.props.showMonthYearPicker||a.props.showQuarterYearPicker?w=_r(a.state.date):w="".concat(aU(po(a.state.date),a.props.locale)," ").concat(_r(a.state.date)),We.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},a.state.isRenderAriaLiveMessage&&w)},a.renderChildren=function(){if(a.props.children)return We.createElement("div",{className:"react-datepicker__children-container"},a.props.children)},a.containerRef=F.createRef(),a.state={date:a.getDateInView(),selectingDate:void 0,monthContainer:void 0,isRenderAriaLiveMessage:!1},a}return Object.defineProperty(n,"defaultProps",{get:function(){return{monthsShown:1,forceShowMonthNavigation:!1,timeCaption:"Time",previousYearButtonLabel:"Previous Year",nextYearButtonLabel:"Next Year",previousMonthButtonLabel:"Previous Month",nextMonthButtonLabel:"Next Month",yearItemNumber:x0}},enumerable:!1,configurable:!0}),n.prototype.componentDidMount=function(){var i=this;this.props.showTimeSelect&&(this.assignMonthContainer=function(){i.setState({monthContainer:i.monthContainer})}())},n.prototype.componentDidUpdate=function(i){var a=this;if(this.props.preSelection&&(!zr(this.props.preSelection,i.preSelection)||this.props.monthSelectedIn!==i.monthSelectedIn)){var l=!Lo(this.state.date,this.props.preSelection);this.setState({date:this.props.preSelection},function(){return l&&a.handleCustomMonthChange(a.state.date)})}else this.props.openToDate&&!zr(this.props.openToDate,i.openToDate)&&this.setState({date:this.props.openToDate})},n.prototype.render=function(){var i=this.props.container||Lwe;return We.createElement(FD,{onClickOutside:this.handleClickOutside,style:{display:"contents"},ignoreClass:this.props.outsideClickIgnoreClass},We.createElement("div",{style:{display:"contents"},ref:this.containerRef},We.createElement(i,{className:$i("react-datepicker",this.props.className,{"react-datepicker--time-only":this.props.showTimeSelectOnly}),showTime:this.props.showTimeSelect||this.props.showTimeInput,showTimeSelectOnly:this.props.showTimeSelectOnly},this.renderAriaLiveRegion(),this.renderPreviousButton(),this.renderNextButton(),this.renderMonths(),this.renderYears(),this.renderTodayButton(),this.renderTimeSection(),this.renderInputTimeSection(),this.renderChildren())))},n}(F.Component),T0e=function(s){var n=s.icon,i=s.className,a=i===void 0?"":i,l=s.onClick,p="react-datepicker__calendar-icon";if(typeof n=="string")return We.createElement("i",{className:"".concat(p," ").concat(n," ").concat(a),"aria-hidden":"true",onClick:l});if(We.isValidElement(n)){var _=n;return We.cloneElement(_,{className:"".concat(_.props.className||""," ").concat(p," ").concat(a),onClick:function(T){typeof _.props.onClick=="function"&&_.props.onClick(T),typeof l=="function"&&l(T)}})}return We.createElement("svg",{className:"".concat(p," ").concat(a),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",onClick:l},We.createElement("path",{d:"M96 32V64H48C21.5 64 0 85.5 0 112v48H448V112c0-26.5-21.5-48-48-48H352V32c0-17.7-14.3-32-32-32s-32 14.3-32 32V64H160V32c0-17.7-14.3-32-32-32S96 14.3 96 32zM448 192H0V464c0 26.5 21.5 48 48 48H400c26.5 0 48-21.5 48-48V192z"}))},_Q=function(s){wa(n,s);function n(i){var a=s.call(this,i)||this;return a.portalRoot=null,a.el=document.createElement("div"),a}return n.prototype.componentDidMount=function(){this.portalRoot=(this.props.portalHost||document).getElementById(this.props.portalId),this.portalRoot||(this.portalRoot=document.createElement("div"),this.portalRoot.setAttribute("id",this.props.portalId),(this.props.portalHost||document.body).appendChild(this.portalRoot)),this.portalRoot.appendChild(this.el)},n.prototype.componentWillUnmount=function(){this.portalRoot&&this.portalRoot.removeChild(this.el)},n.prototype.render=function(){return h_.createPortal(this.props.children,this.el)},n}(F.Component),b0e="[tabindex], a, button, input, select, textarea",w0e=function(s){return(s instanceof HTMLAnchorElement||!s.disabled)&&s.tabIndex!==-1},EQ=function(s){wa(n,s);function n(i){var a=s.call(this,i)||this;return a.getTabChildren=function(){var l;return Array.prototype.slice.call((l=a.tabLoopRef.current)===null||l===void 0?void 0:l.querySelectorAll(b0e),1,-1).filter(w0e)},a.handleFocusStart=function(){var l=a.getTabChildren();l&&l.length>1&&l[l.length-1].focus()},a.handleFocusEnd=function(){var l=a.getTabChildren();l&&l.length>1&&l[0].focus()},a.tabLoopRef=F.createRef(),a}return n.prototype.render=function(){var i;return((i=this.props.enableTabLoop)!==null&&i!==void 0?i:n.defaultProps.enableTabLoop)?We.createElement("div",{className:"react-datepicker__tab-loop",ref:this.tabLoopRef},We.createElement("div",{className:"react-datepicker__tab-loop__start",tabIndex:0,onFocus:this.handleFocusStart}),this.props.children,We.createElement("div",{className:"react-datepicker__tab-loop__end",tabIndex:0,onFocus:this.handleFocusEnd})):this.props.children},n.defaultProps={enableTabLoop:!0},n}(F.Component);function R0e(s){var n=function(i){var a,l=typeof i.hidePopper=="boolean"?i.hidePopper:!0,p=F.useRef(null),_=kwe(Yr({open:!l,whileElementsMounted:hwe,placement:i.popperPlacement,middleware:Vu([Swe({padding:15}),vwe(10),Twe({element:p})],(a=i.popperModifiers)!==null&&a!==void 0?a:[],!0)},i.popperProps)),T=Yr(Yr({},i),{hidePopper:l,popperProps:Yr(Yr({},_),{arrowRef:p})});return We.createElement(s,Yr({},T))};return n}var C0e=function(s){wa(n,s);function n(){return s!==null&&s.apply(this,arguments)||this}return Object.defineProperty(n,"defaultProps",{get:function(){return{hidePopper:!0}},enumerable:!1,configurable:!0}),n.prototype.render=function(){var i=this.props,a=i.className,l=i.wrapperClassName,p=i.hidePopper,_=p===void 0?n.defaultProps.hidePopper:p,T=i.popperComponent,w=i.targetComponent,C=i.enableTabLoop,O=i.popperOnKeyDown,k=i.portalId,U=i.portalHost,G=i.popperProps,z=i.showArrow,J=void 0;if(!_){var X=$i("react-datepicker-popper",a);J=We.createElement(EQ,{enableTabLoop:C},We.createElement("div",{ref:G.refs.setFloating,style:G.floatingStyles,className:X,"data-placement":G.placement,onKeyDown:O},T,z&&We.createElement(Awe,{ref:G.arrowRef,context:G.context,fill:"currentColor",strokeWidth:1,height:8,width:16,style:{transform:"translateY(-1px)"},className:"react-datepicker__triangle"})))}this.props.popperContainer&&(J=F.createElement(this.props.popperContainer,{},J)),k&&!_&&(J=We.createElement(_Q,{portalId:k,portalHost:U},J));var ie=$i("react-datepicker-wrapper",l);return We.createElement(We.Fragment,null,We.createElement("div",{ref:G.refs.setReference,className:ie},w),J)},n}(F.Component),A0e=R0e(C0e),PY="react-datepicker-ignore-onclickoutside";function I0e(s,n){return s&&n?po(s)!==po(n)||_r(s)!==_r(n):s!==n}var TM="Date input not valid.",kY=function(s){wa(n,s);function n(i){var a=s.call(this,i)||this;return a.calendar=null,a.input=null,a.getPreSelection=function(){return a.props.openToDate?a.props.openToDate:a.props.selectsEnd&&a.props.startDate?a.props.startDate:a.props.selectsStart&&a.props.endDate?a.props.endDate:di()},a.modifyHolidays=function(){var l;return(l=a.props.holidays)===null||l===void 0?void 0:l.reduce(function(p,_){var T=new Date(_.date);return BD(T)?Vu(Vu([],p,!0),[Yr(Yr({},_),{date:T})],!1):p},[])},a.calcInitialState=function(){var l,p=a.getPreSelection(),_=fQ(a.props),T=mQ(a.props),w=_&&M_(p,cO(_))?_:T&&sm(p,EY(T))?T:p;return{open:a.props.startOpen||!1,preventFocus:!1,inputValue:null,preSelection:(l=a.props.selectsRange?a.props.startDate:a.props.selected)!==null&&l!==void 0?l:w,highlightDates:CY(a.props.highlightDates),focused:!1,shouldFocusDayInline:!1,isRenderAriaLiveMessage:!1,wasHidden:!1}},a.resetHiddenStatus=function(){a.setState(Yr(Yr({},a.state),{wasHidden:!1}))},a.setHiddenStatus=function(){a.setState(Yr(Yr({},a.state),{wasHidden:!0}))},a.setHiddenStateOnVisibilityHidden=function(){document.visibilityState==="hidden"&&a.setHiddenStatus()},a.clearPreventFocusTimeout=function(){a.preventFocusTimeout&&clearTimeout(a.preventFocusTimeout)},a.setFocus=function(){var l,p;(p=(l=a.input)===null||l===void 0?void 0:l.focus)===null||p===void 0||p.call(l,{preventScroll:!0})},a.setBlur=function(){var l,p;(p=(l=a.input)===null||l===void 0?void 0:l.blur)===null||p===void 0||p.call(l),a.cancelFocusInput()},a.deferBlur=function(){requestAnimationFrame(function(){a.setBlur()})},a.setOpen=function(l,p){p===void 0&&(p=!1),a.setState({open:l,preSelection:l&&a.state.open?a.state.preSelection:a.calcInitialState().preSelection,lastPreSelectChange:bM},function(){l||a.setState(function(_){return{focused:p?_.focused:!1}},function(){!p&&a.deferBlur(),a.setState({inputValue:null})})})},a.inputOk=function(){return sp(a.state.preSelection)},a.isCalendarOpen=function(){return a.props.open===void 0?a.state.open&&!a.props.disabled&&!a.props.readOnly:a.props.open},a.handleFocus=function(l){var p,_,T=a.state.wasHidden,w=T?a.state.open:!0;T&&a.resetHiddenStatus(),a.state.preventFocus||((_=(p=a.props).onFocus)===null||_===void 0||_.call(p,l),w&&!a.props.preventOpenOnFocus&&!a.props.readOnly&&a.setOpen(!0)),a.setState({focused:!0})},a.sendFocusBackToInput=function(){a.preventFocusTimeout&&a.clearPreventFocusTimeout(),a.setState({preventFocus:!0},function(){a.preventFocusTimeout=setTimeout(function(){a.setFocus(),a.setState({preventFocus:!1})})})},a.cancelFocusInput=function(){clearTimeout(a.inputFocusTimeout),a.inputFocusTimeout=void 0},a.deferFocusInput=function(){a.cancelFocusInput(),a.inputFocusTimeout=setTimeout(function(){return a.setFocus()},1)},a.handleDropdownFocus=function(){a.cancelFocusInput()},a.handleBlur=function(l){var p,_;(!a.state.open||a.props.withPortal||a.props.showTimeInput)&&((_=(p=a.props).onBlur)===null||_===void 0||_.call(p,l)),a.state.open&&a.props.open===!1&&a.setOpen(!1),a.setState({focused:!1})},a.handleCalendarClickOutside=function(l){var p,_;a.props.inline||a.setOpen(!1),(_=(p=a.props).onClickOutside)===null||_===void 0||_.call(p,l),a.props.withPortal&&l.preventDefault()},a.handleChange=function(){for(var l,p,_,T,w,C=[],O=0;O<arguments.length;O++)C[O]=arguments[O];var k=C[0];if(!(a.props.onChangeRaw&&(a.props.onChangeRaw.apply(a,C),!k||typeof k.isDefaultPrevented!="function"||k.isDefaultPrevented()))){a.setState({inputValue:(k==null?void 0:k.target)instanceof HTMLInputElement?k.target.value:null,lastPreSelectChange:N0e});var U=a.props,G=U.selectsRange,z=U.startDate,J=U.endDate,X=(l=a.props.dateFormat)!==null&&l!==void 0?l:n.defaultProps.dateFormat,ie=(p=a.props.strictParsing)!==null&&p!==void 0?p:n.defaultProps.strictParsing,oe=(k==null?void 0:k.target)instanceof HTMLInputElement?k.target.value:"";if(G){var ce=oe.split(X.includes("-")?uQ:"-",2).map(function(re){return re.trim()}),_e=ce[0],se=ce[1],be=yM(_e??"",X,a.props.locale,ie),ee=yM(se??"",X,a.props.locale,ie),Q=(z==null?void 0:z.getTime())!==(be==null?void 0:be.getTime()),q=(J==null?void 0:J.getTime())!==(ee==null?void 0:ee.getTime());if(!Q&&!q||be&&Pl(be,a.props)||ee&&Pl(ee,a.props))return;(T=(_=a.props).onChange)===null||T===void 0||T.call(_,[be,ee],k)}else{var ae=yM(oe,X,a.props.locale,ie,(w=a.props.selected)!==null&&w!==void 0?w:void 0);(ae||!oe)&&a.setSelected(ae,k,!0)}}},a.handleSelect=function(l,p,_){if(!a.props.readOnly){if(a.props.shouldCloseOnSelect&&!a.props.showTimeSelect&&a.sendFocusBackToInput(),a.props.onChangeRaw&&a.props.onChangeRaw(p),a.setSelected(l,p,!1,_),a.props.showDateSelect&&a.setState({isRenderAriaLiveMessage:!0}),!a.props.shouldCloseOnSelect||a.props.showTimeSelect)a.setPreSelection(l);else if(!a.props.inline){a.props.selectsRange||a.setOpen(!1);var T=a.props,w=T.startDate,C=T.endDate;w&&!C&&(a.props.swapRange||!OY(l,w))&&a.setOpen(!1)}}},a.setSelected=function(l,p,_,T){var w,C,O=l;if(a.props.showYearPicker){if(O!==null&&lO(_r(O),a.props))return}else if(a.props.showMonthYearPicker){if(O!==null&&pQ(O,a.props))return}else if(O!==null&&Pl(O,a.props))return;var k=a.props,U=k.onChange,G=k.selectsRange,z=k.startDate,J=k.endDate,X=k.selectsMultiple,ie=k.selectedDates,oe=k.minTime,ce=k.swapRange;if(!y_(a.props.selected,O)||a.props.allowSameDay||G||X)if(O!==null&&(a.props.selected&&(!_||!a.props.showTimeSelect&&!a.props.showTimeSelectOnly&&!a.props.showTimeInput)&&(O=vM(O,{hour:ap(a.props.selected),minute:op(a.props.selected),second:Qf(a.props.selected)})),!_&&(a.props.showTimeSelect||a.props.showTimeSelectOnly)&&oe&&(O=vM(O,{hour:oe.getHours(),minute:oe.getMinutes(),second:oe.getSeconds()})),a.props.inline||a.setState({preSelection:O}),a.props.focusSelectedMonth||a.setState({monthSelectedIn:T})),G){var _e=!z&&!J,se=z&&!J,be=z&&J;_e?U==null||U([O,null],p):se&&(O===null?U==null||U([null,null],p):OY(O,z)?ce?U==null||U([O,z],p):U==null||U([O,null],p):U==null||U([z,O],p)),be&&(U==null||U([O,null],p))}else if(X){if(O!==null)if(!(ie!=null&&ie.length))U==null||U([O],p);else{var ee=ie.some(function(q){return zr(q,O)});if(ee){var Q=ie.filter(function(q){return!zr(q,O)});U==null||U(Q,p)}else U==null||U(Vu(Vu([],ie,!0),[O],!1),p)}}else U==null||U(O,p);_||((C=(w=a.props).onSelect)===null||C===void 0||C.call(w,O,p),a.setState({inputValue:null}))},a.setPreSelection=function(l){if(!a.props.readOnly){var p=sp(a.props.minDate),_=sp(a.props.maxDate),T=!0;if(l){var w=cO(l);if(p&&_)T=Uw(l,a.props.minDate,a.props.maxDate);else if(p){var C=cO(a.props.minDate);T=sm(l,C)||y_(w,C)}else if(_){var O=EY(a.props.maxDate);T=M_(l,O)||y_(w,O)}}T&&a.setState({preSelection:l})}},a.toggleCalendar=function(){a.setOpen(!a.state.open)},a.handleTimeChange=function(l){var p,_;if(!(a.props.selectsRange||a.props.selectsMultiple)){var T=a.props.selected?a.props.selected:a.getPreSelection(),w=a.props.selected?l:vM(T,{hour:ap(l),minute:op(l)});a.setState({preSelection:w}),(_=(p=a.props).onChange)===null||_===void 0||_.call(p,w),a.props.shouldCloseOnSelect&&!a.props.showTimeInput&&(a.sendFocusBackToInput(),a.setOpen(!1)),a.props.showTimeInput&&a.setOpen(!0),(a.props.showTimeSelectOnly||a.props.showTimeSelect)&&a.setState({isRenderAriaLiveMessage:!0}),a.setState({inputValue:null})}},a.onInputClick=function(){var l,p;!a.props.disabled&&!a.props.readOnly&&a.setOpen(!0),(p=(l=a.props).onInputClick)===null||p===void 0||p.call(l)},a.onInputKeyDown=function(l){var p,_,T,w,C,O;(_=(p=a.props).onKeyDown)===null||_===void 0||_.call(p,l);var k=l.key;if(!a.state.open&&!a.props.inline&&!a.props.preventOpenOnFocus){(k===Ht.ArrowDown||k===Ht.ArrowUp||k===Ht.Enter)&&((T=a.onInputClick)===null||T===void 0||T.call(a));return}if(a.state.open){if(k===Ht.ArrowDown||k===Ht.ArrowUp){l.preventDefault();var U=a.props.showTimeSelectOnly?".react-datepicker__time-list-item[tabindex='0']":a.props.showWeekPicker&&a.props.showWeekNumbers?'.react-datepicker__week-number[tabindex="0"]':a.props.showFullMonthYearPicker||a.props.showMonthYearPicker?'.react-datepicker__month-text[tabindex="0"]':'.react-datepicker__day[tabindex="0"]',G=((w=a.calendar)===null||w===void 0?void 0:w.containerRef.current)instanceof Element&&a.calendar.containerRef.current.querySelector(U);G instanceof HTMLElement&&G.focus({preventScroll:!0});return}var z=di(a.state.preSelection);k===Ht.Enter?(l.preventDefault(),l.target.blur(),a.inputOk()&&a.state.lastPreSelectChange===bM?(a.handleSelect(z,l),!a.props.shouldCloseOnSelect&&a.setPreSelection(z)):a.setOpen(!1)):k===Ht.Escape?(l.preventDefault(),l.target.blur(),a.sendFocusBackToInput(),a.setOpen(!1)):k===Ht.Tab&&a.setOpen(!1),a.inputOk()||(O=(C=a.props).onInputError)===null||O===void 0||O.call(C,{code:1,msg:TM})}},a.onPortalKeyDown=function(l){var p=l.key;p===Ht.Escape&&(l.preventDefault(),a.setState({preventFocus:!0},function(){a.setOpen(!1),setTimeout(function(){a.setFocus(),a.setState({preventFocus:!1})})}))},a.onDayKeyDown=function(l){var p,_,T,w,C,O,k=a.props,U=k.minDate,G=k.maxDate,z=k.disabledKeyboardNavigation,J=k.showWeekPicker,X=k.shouldCloseOnSelect,ie=k.locale,oe=k.calendarStartDay,ce=k.adjustDateOnChange,_e=k.inline;if((_=(p=a.props).onKeyDown)===null||_===void 0||_.call(p,l),!z){var se=l.key,be=l.shiftKey,ee=di(a.state.preSelection),Q=function(Ge,ve){var Ne=ve;switch(Ge){case Ht.ArrowRight:Ne=J?UO(ve,1):bd(ve,1);break;case Ht.ArrowLeft:Ne=J?sY(ve):ZTe(ve);break;case Ht.ArrowUp:Ne=sY(ve);break;case Ht.ArrowDown:Ne=UO(ve,1);break;case Ht.PageUp:Ne=be?Xv(ve,1):C_(ve,1);break;case Ht.PageDown:Ne=be?ip(ve,1):Cd(ve,1);break;case Ht.Home:Ne=$f(ve,ie,oe);break;case Ht.End:Ne=Bwe(ve);break}return Ne},q=function(Ge,ve){for(var Ne=40,Ce=Ge,Ue=!1,de=0,De=Q(Ge,ve);!Ue;){if(de>=Ne){De=ve;break}U&&De<U&&(Ce=Ht.ArrowRight,De=Pl(U,a.props)?Q(Ce,De):U),G&&De>G&&(Ce=Ht.ArrowLeft,De=Pl(G,a.props)?Q(Ce,De):G),Pl(De,a.props)?((Ce===Ht.PageUp||Ce===Ht.Home)&&(Ce=Ht.ArrowRight),(Ce===Ht.PageDown||Ce===Ht.End)&&(Ce=Ht.ArrowLeft),De=Q(Ce,De)):Ue=!0,de++}return De};if(se===Ht.Enter){l.preventDefault(),a.handleSelect(ee,l),!X&&a.setPreSelection(ee);return}else if(se===Ht.Escape){l.preventDefault(),a.setOpen(!1),a.inputOk()||(w=(T=a.props).onInputError)===null||w===void 0||w.call(T,{code:1,msg:TM});return}var ae=null;switch(se){case Ht.ArrowLeft:case Ht.ArrowRight:case Ht.ArrowUp:case Ht.ArrowDown:case Ht.PageUp:case Ht.PageDown:case Ht.Home:case Ht.End:ae=q(se,ee);break}if(!ae){(O=(C=a.props).onInputError)===null||O===void 0||O.call(C,{code:1,msg:TM});return}if(l.preventDefault(),a.setState({lastPreSelectChange:bM}),ce&&a.setSelected(ae),a.setPreSelection(ae),_e){var re=po(ee),fe=po(ae),pe=_r(ee),Re=_r(ae);re!==fe||pe!==Re?a.setState({shouldFocusDayInline:!0}):a.setState({shouldFocusDayInline:!1})}}},a.onPopperKeyDown=function(l){var p=l.key;p===Ht.Escape&&(l.preventDefault(),a.sendFocusBackToInput(),a.setOpen(!1))},a.onClearClick=function(l){l&&l.preventDefault&&l.preventDefault(),a.sendFocusBackToInput();var p=a.props,_=p.selectsRange,T=p.onChange;_?T==null||T([null,null],l):T==null||T(null,l),a.setState({inputValue:null})},a.clear=function(){a.onClearClick()},a.onScroll=function(l){typeof a.props.closeOnScroll=="boolean"&&a.props.closeOnScroll?(l.target===document||l.target===document.documentElement||l.target===document.body)&&a.setOpen(!1):typeof a.props.closeOnScroll=="function"&&a.props.closeOnScroll(l)&&a.setOpen(!1)},a.renderCalendar=function(){var l,p;return!a.props.inline&&!a.isCalendarOpen()?null:We.createElement(S0e,Yr({showMonthYearDropdown:void 0,ref:function(_){a.calendar=_}},a.props,a.state,{setOpen:a.setOpen,dateFormat:(l=a.props.dateFormatCalendar)!==null&&l!==void 0?l:n.defaultProps.dateFormatCalendar,onSelect:a.handleSelect,onClickOutside:a.handleCalendarClickOutside,holidays:Zwe(a.modifyHolidays()),outsideClickIgnoreClass:PY,onDropdownFocus:a.handleDropdownFocus,onTimeChange:a.handleTimeChange,className:a.props.calendarClassName,container:a.props.calendarContainer,handleOnKeyDown:a.props.onKeyDown,handleOnDayKeyDown:a.onDayKeyDown,setPreSelection:a.setPreSelection,dropdownMode:(p=a.props.dropdownMode)!==null&&p!==void 0?p:n.defaultProps.dropdownMode}),a.props.children)},a.renderAriaLiveRegion=function(){var l=a.props,p=l.dateFormat,_=p===void 0?n.defaultProps.dateFormat:p,T=l.locale,w=a.props.showTimeInput||a.props.showTimeSelect,C=w?"PPPPp":"PPPP",O;return a.props.selectsRange?O="Selected start date: ".concat(Dl(a.props.startDate,{dateFormat:C,locale:T}),". ").concat(a.props.endDate?"End date: "+Dl(a.props.endDate,{dateFormat:C,locale:T}):""):a.props.showTimeSelectOnly?O="Selected time: ".concat(Dl(a.props.selected,{dateFormat:_,locale:T})):a.props.showYearPicker?O="Selected year: ".concat(Dl(a.props.selected,{dateFormat:"yyyy",locale:T})):a.props.showMonthYearPicker?O="Selected month: ".concat(Dl(a.props.selected,{dateFormat:"MMMM yyyy",locale:T})):a.props.showQuarterYearPicker?O="Selected quarter: ".concat(Dl(a.props.selected,{dateFormat:"yyyy, QQQ",locale:T})):O="Selected date: ".concat(Dl(a.props.selected,{dateFormat:C,locale:T})),We.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},O)},a.renderDateInput=function(){var l,p,_,T=$i(a.props.className,(l={},l[PY]=a.state.open,l)),w=a.props.customInput||We.createElement("input",{type:"text"}),C=a.props.customInputRef||"ref",O=a.props,k=O.dateFormat,U=k===void 0?n.defaultProps.dateFormat:k,G=O.locale,z=typeof a.props.value=="string"?a.props.value:typeof a.state.inputValue=="string"?a.state.inputValue:a.props.selectsRange?jwe(a.props.startDate,a.props.endDate,{dateFormat:U,locale:G}):a.props.selectsMultiple?Uwe((_=a.props.selectedDates)!==null&&_!==void 0?_:[],{dateFormat:U,locale:G}):Dl(a.props.selected,{dateFormat:U,locale:G});return F.cloneElement(w,(p={},p[C]=function(J){a.input=J},p.value=z,p.onBlur=a.handleBlur,p.onChange=a.handleChange,p.onClick=a.onInputClick,p.onFocus=a.handleFocus,p.onKeyDown=a.onInputKeyDown,p.id=a.props.id,p.name=a.props.name,p.form=a.props.form,p.autoFocus=a.props.autoFocus,p.placeholder=a.props.placeholderText,p.disabled=a.props.disabled,p.autoComplete=a.props.autoComplete,p.className=$i(w.props.className,T),p.title=a.props.title,p.readOnly=a.props.readOnly,p.required=a.props.required,p.tabIndex=a.props.tabIndex,p["aria-describedby"]=a.props.ariaDescribedBy,p["aria-invalid"]=a.props.ariaInvalid,p["aria-labelledby"]=a.props.ariaLabelledBy,p["aria-required"]=a.props.ariaRequired,p))},a.renderClearButton=function(){var l=a.props,p=l.isClearable,_=l.disabled,T=l.selected,w=l.startDate,C=l.endDate,O=l.clearButtonTitle,k=l.clearButtonClassName,U=k===void 0?"":k,G=l.ariaLabelClose,z=G===void 0?"Close":G,J=l.selectedDates,X=l.readOnly;return p&&!X&&(T!=null||w!=null||C!=null||J!=null&&J.length)?We.createElement("button",{type:"button",className:$i("react-datepicker__close-icon",U,{"react-datepicker__close-icon--disabled":_}),disabled:_,"aria-label":z,onClick:a.onClearClick,title:O,tabIndex:-1}):null},a.state=a.calcInitialState(),a.preventFocusTimeout=void 0,a}return Object.defineProperty(n,"defaultProps",{get:function(){return{allowSameDay:!1,dateFormat:"MM/dd/yyyy",dateFormatCalendar:"LLLL yyyy",disabled:!1,disabledKeyboardNavigation:!1,dropdownMode:"scroll",preventOpenOnFocus:!1,monthsShown:1,readOnly:!1,withPortal:!1,selectsDisabledDaysInRange:!1,shouldCloseOnSelect:!0,showTimeSelect:!1,showTimeInput:!1,showPreviousMonths:!1,showMonthYearPicker:!1,showFullMonthYearPicker:!1,showTwoColumnMonthYearPicker:!1,showFourColumnMonthYearPicker:!1,showYearPicker:!1,showQuarterYearPicker:!1,showWeekPicker:!1,strictParsing:!1,swapRange:!1,timeIntervals:30,timeCaption:"Time",previousMonthAriaLabel:"Previous Month",previousMonthButtonLabel:"Previous Month",nextMonthAriaLabel:"Next Month",nextMonthButtonLabel:"Next Month",previousYearAriaLabel:"Previous Year",previousYearButtonLabel:"Previous Year",nextYearAriaLabel:"Next Year",nextYearButtonLabel:"Next Year",timeInputLabel:"Time",enableTabLoop:!0,yearItemNumber:x0,focusSelectedMonth:!1,showPopperArrow:!0,excludeScrollbar:!0,customTimeInput:null,calendarStartDay:void 0,toggleCalendarOnIconClick:!1,usePointerEvent:!1}},enumerable:!1,configurable:!0}),n.prototype.componentDidMount=function(){window.addEventListener("scroll",this.onScroll,!0),document.addEventListener("visibilitychange",this.setHiddenStateOnVisibilityHidden)},n.prototype.componentDidUpdate=function(i,a){var l,p,_,T;i.inline&&I0e(i.selected,this.props.selected)&&this.setPreSelection(this.props.selected),this.state.monthSelectedIn!==void 0&&i.monthsShown!==this.props.monthsShown&&this.setState({monthSelectedIn:0}),i.highlightDates!==this.props.highlightDates&&this.setState({highlightDates:CY(this.props.highlightDates)}),!a.focused&&!y_(i.selected,this.props.selected)&&this.setState({inputValue:null}),a.open!==this.state.open&&(a.open===!1&&this.state.open===!0&&((p=(l=this.props).onCalendarOpen)===null||p===void 0||p.call(l)),a.open===!0&&this.state.open===!1&&((T=(_=this.props).onCalendarClose)===null||T===void 0||T.call(_)))},n.prototype.componentWillUnmount=function(){this.clearPreventFocusTimeout(),window.removeEventListener("scroll",this.onScroll,!0),document.removeEventListener("visibilitychange",this.setHiddenStateOnVisibilityHidden)},n.prototype.renderInputContainer=function(){var i=this.props,a=i.showIcon,l=i.icon,p=i.calendarIconClassname,_=i.calendarIconClassName,T=i.toggleCalendarOnIconClick,w=this.state.open;return p&&console.warn("calendarIconClassname props is deprecated. should use calendarIconClassName props."),We.createElement("div",{className:"react-datepicker__input-container".concat(a?" react-datepicker__view-calendar-icon":"")},a&&We.createElement(T0e,Yr({icon:l,className:$i(_,!_&&p,w&&"react-datepicker-ignore-onclickoutside")},T?{onClick:this.toggleCalendar}:null)),this.state.isRenderAriaLiveMessage&&this.renderAriaLiveRegion(),this.renderDateInput(),this.renderClearButton())},n.prototype.render=function(){var i=this.renderCalendar();if(this.props.inline)return i;if(this.props.withPortal){var a=this.state.open?We.createElement(EQ,{enableTabLoop:this.props.enableTabLoop},We.createElement("div",{className:"react-datepicker__portal",tabIndex:-1,onKeyDown:this.onPortalKeyDown},i)):null;return this.state.open&&this.props.portalId&&(a=We.createElement(_Q,Yr({portalId:this.props.portalId},this.props),a)),We.createElement("div",null,this.renderInputContainer(),a)}return We.createElement(A0e,Yr({},this.props,{className:this.props.popperClassName,hidePopper:!this.isCalendarOpen(),targetComponent:this.renderInputContainer(),popperComponent:i,popperOnKeyDown:this.onPopperKeyDown,showArrow:this.props.showPopperArrow}))},n}(F.Component),N0e="input",bM="navigate";const O0e=()=>{const s=Pi(),{doctorUnavailabilityList:n,doctorUnavailabilityLoading:i,unavailabilityrequest:a,unavailabilityLoading:l,error:p}=hr(Ce=>Ce.patientProfile),[_,T]=F.useState(!1),[w,C]=F.useState(null),[O,k]=F.useState(null),[U,G]=F.useState(""),[z,J]=F.useState(""),[X,ie]=F.useState(""),oe=Ce=>{ie(Ce.toLowerCase()),Q(1)},ce=Ce=>{var Ue,de,De,xe,Xe,ut,Pt,It,zt;return X?((Ue=Ce.appliedOn)==null?void 0:Ue.toLowerCase().includes(X))||((de=Ce.fromDate)==null?void 0:de.toLowerCase().includes(X))||((De=Ce.fromTime)==null?void 0:De.toLowerCase().includes(X))||((xe=Ce.toDate)==null?void 0:xe.toLowerCase().includes(X))||((Xe=Ce.toTime)==null?void 0:Xe.toLowerCase().includes(X))||((ut=Ce.timePeriod)==null?void 0:ut.toLowerCase().includes(X))||((Pt=Ce.reason)==null?void 0:Pt.toLowerCase().includes(X))||((It=Ce.type)==null?void 0:It.toLowerCase().includes(X))||((zt=Ce.status)==null?void 0:zt.toLowerCase().includes(X)):!0},_e=Ce=>{if(!Ce)return null;const Ue=Ce.getFullYear(),de=String(Ce.getMonth()+1).padStart(2,"0"),De=String(Ce.getDate()).padStart(2,"0"),xe=String(Ce.getHours()).padStart(2,"0"),Xe=String(Ce.getMinutes()).padStart(2,"0"),ut=String(Ce.getSeconds()).padStart(2,"0");return`${Ue}-${de}-${De} ${xe}:${Xe}:${ut}`},se=()=>{if(!w||!O||!U||!z.trim()){ct.error("Please fill all fields!");return}const Ce={from_datetime:_e(w),to_datetime:_e(O),type:U,reason:z};T(!1),s(GN(Ce)).then(Ue=>{var de,De;(de=Ue.payload)!=null&&de.status?(ct.success(Ue.payload.message),s(Yw())):ct.error((De=Ue.payload)==null?void 0:De.message)}).catch(Ue=>{ct.error("An error occurred while Confirming for doctor's leave")}),T(!1),C(null),k(null),G(""),J("")},be=()=>{T(!1),C(null),k(null),G(""),J("")},[ee,Q]=F.useState(1),q=5;F.useEffect(()=>{s(Yw({search:X}))},[s,X]);const ae=(n==null?void 0:n.filter(ce))||[],re=Math.ceil(ae.length/q),fe=ee*q,pe=fe-q,Re=ae.slice(pe,fe),Ge=Ce=>{Q(Ce)},ve=()=>ee<re&&Q(ee+1),Ne=()=>ee>1&&Q(ee-1);return m.jsx(m.Fragment,{children:m.jsx("main",{className:"doctor-panel",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(za,{})}),l?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"doc-panel-body",children:[m.jsxs("div",{className:"docpnl-sec-head",style:{display:"flex",alignItems:"center"},children:[m.jsx("h1",{className:"h2-title",children:"Mark Unavailability"}),m.jsxs("div",{style:{display:"flex",justifyContent:"right",width:"50%",gap:"10px"},children:[m.jsx("div",{style:{width:"40%",borderRadius:"10px"},children:m.jsx(C2,{onSearch:oe,placeholder:"Search anything here..."})}),m.jsx("div",{className:"mb-4 text-right",children:m.jsxs(Qr,{onClick:()=>T(!0),style:{backgroundColor:"#F47820"},className:"border-0 px-6 py-2 rounded-lg shadow-md text-white flex items-center gap-2 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-75",children:[m.jsx(ij,{style:{marginBottom:5,marginRight:5}}),"Add Request"]})})]})]}),m.jsx("div",{className:"pending-prescriptions-wrp",children:m.jsxs("div",{className:"my-appointments-inr",children:[m.jsx("div",{className:"myapintmnt-content-tab pending",children:m.jsx("div",{className:"pending-presc-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{children:"Applied On"}),m.jsx("th",{children:"From"}),m.jsx("th",{children:"To"}),m.jsx("th",{children:"Total Time"}),m.jsx("th",{children:"Reason"}),m.jsx("th",{children:"Type"}),m.jsx("th",{children:"Status"})]})}),m.jsxs("tbody",{children:[Re.length==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center"},children:i?"Loading...":m.jsx("span",{style:{fontWeight:"400",fontSize:18},children:"No data found"})})}),Re.map((Ce,Ue)=>m.jsxs("tr",{children:[m.jsx("td",{style:{fontSize:20,color:"#199FD9"},children:String((ee-1)*q+Ue+1).padStart(2,"0")}),m.jsx("td",{style:{textAlign:"left",maxWidth:"287px",paddingLeft:"165px",color:"#199FD9"},children:Ce.appliedOn}),m.jsxs("td",{children:[m.jsx("div",{className:"date",style:{color:"#199FD9",fontSize:20},children:Ce.fromDate}),m.jsx("div",{className:"time",style:{color:"#199FD9"},children:Ce.fromTime})]}),m.jsxs("td",{children:[m.jsx("div",{className:"date",style:{color:"#199FD9",fontSize:20},children:Ce.toDate}),m.jsx("div",{className:"time",style:{color:"#199FD9"},children:Ce.toTime})]}),m.jsx("td",{style:{color:"#199FD9"},children:Ce.timePeriod}),m.jsx("td",{style:{color:"#199FD9"},children:m.jsx("span",{dangerouslySetInnerHTML:{__html:Ce.reason.replace(/(.{20})/g,"$1<br/>")}})}),m.jsx("td",{style:{color:"#199FD9"},children:Ce.type}),m.jsx("td",{style:{color:"#199FD9"},children:Ce.status})]},Ue))]})]})})}),ae.length>0&&m.jsx(Lu,{currentPage:ee,totalPages:re,onPageChange:Ge,onPrevious:Ne,onNext:ve})]})})]}),m.jsxs(Cn,{show:_,onHide:be,centered:!0,children:[m.jsx(Cn.Header,{closeButton:!0,children:m.jsx(Cn.Title,{children:"Add Unavailability Request"})}),m.jsx(Cn.Body,{children:m.jsxs(ot,{children:[m.jsxs(ot.Group,{className:"mb-3",children:[m.jsx(ot.Label,{children:"Applied For:"}),m.jsxs("div",{className:"d-flex gap-2",children:[m.jsx(kY,{selected:w,onChange:Ce=>C(Ce),showTimeSelect:!0,timeIntervals:15,timeCaption:"Time",dateFormat:"MMMM d, yyyy h:mm aa",placeholderText:"From",className:"form-control",minDate:new Date}),m.jsx(kY,{selected:O,onChange:Ce=>k(Ce),showTimeSelect:!0,timeIntervals:15,timeCaption:"Time",dateFormat:"MMMM d, yyyy h:mm aa",placeholderText:"To",className:"form-control",minDate:w||new Date})]})]}),m.jsxs(ot.Group,{className:"mb-3",children:[m.jsx(ot.Label,{children:"Request Type"}),m.jsxs(ot.Select,{value:U,onChange:Ce=>G(Ce.target.value),children:[m.jsx("option",{value:"",children:"Select Request Type"}),m.jsx("option",{value:"emergency",children:"Emergency"}),m.jsx("option",{value:"planned",children:"Planned"})]})]}),m.jsxs(ot.Group,{className:"mb-3",children:[m.jsx(ot.Label,{children:"Reason"}),m.jsx(ot.Control,{type:"text",value:z,onChange:Ce=>J(Ce.target.value),placeholder:"Reason..."})]})]})}),m.jsxs(Cn.Footer,{children:[m.jsx(Qr,{variant:"secondary",onClick:be,children:"Cancel"}),m.jsx(Qr,{variant:"primary",onClick:se,disabled:l,children:l?"Sending...":"Send"})]})]}),m.jsx(fo,{})]})})})},D0e=()=>{es();const s=Pi(),{hodScreenRequests:n,hodScreenRequestsLoading:i,hodRequestsConfirmButtonLoading:a,hodRequestsConfirm:l,hodRequestsRespondButtonLoading:p,hodRequestsRespond:_,hodScreenDoctors:T,hodScreenDoctorsListLoading:w,confirmDoctorAvailable:C,markDoctorAvailableLoading:O,doctorUnavailabilitySubmit:k,unavailabilitySubmitByHodLoading:U}=hr(Ke=>Ke.patientProfile),[G,z]=F.useState(""),[J,X]=F.useState("");F.useEffect(()=>{s(m_({search:J}))},[s,J]),F.useEffect(()=>{const Ke=setTimeout(()=>{s(g_({search:G}))},500);return()=>clearTimeout(Ke)},[s,G]),F.useEffect(()=>{const Ke=setInterval(()=>{const Yt=new Date;T==null||T.forEach(un=>{var pr;if(!un.hasUnavailability)return;const tn=(pr=un.unavailabilities)==null?void 0:pr[0];if(!tn)return;const yn=new Date(`${tn.fromDate} ${tn.fromTime}`),ri=new Date(`${tn.toDate} ${tn.toTime}`);Yt.toLocaleString("en-US",{hour12:!0}),yn.toLocaleString("en-US",{hour12:!0}),ri.toLocaleString("en-US",{hour12:!0});const ln=Math.abs(Yt-yn)<60*1e3,or=Math.abs(Yt-ri)<60*1e3;(ln||or)&&s(g_())})},6e4);return()=>clearInterval(Ke)},[T,s]);const ie=Ke=>{z(Ke.toLowerCase()),xe(1)},oe=Ke=>{X(Ke.toLowerCase()),be(1)},ce=Ke=>{var Yt,un,tn,yn,ri,ln,or,pr,qr,rs,mo,Hs,Wc,Ya,Aa;return G?((Yt=Ke.name)==null?void 0:Yt.toLowerCase().includes(G))||((un=Ke.email)==null?void 0:un.toLowerCase().includes(G))||((tn=Ke.phone)==null?void 0:tn.toLowerCase().includes(G))||((yn=Ke.experience)==null?void 0:yn.toString().includes(G))||((ri=Ke.shiftTiming)==null?void 0:ri.toLowerCase().includes(G))||((ln=Ke.signupDate)==null?void 0:ln.toLowerCase().includes(G))||Ke.hasUnavailability&&(((qr=(pr=(or=Ke.unavailabilities)==null?void 0:or[0])==null?void 0:pr.type)==null?void 0:qr.toLowerCase().includes(G))||((Hs=(mo=(rs=Ke.unavailabilities)==null?void 0:rs[0])==null?void 0:mo.status)==null?void 0:Hs.toLowerCase().includes(G))||((Aa=(Ya=(Wc=Ke.unavailabilities)==null?void 0:Wc[0])==null?void 0:Ya.reason)==null?void 0:Aa.toLowerCase().includes(G))):!0},_e=Ke=>{var Yt,un,tn,yn,ri,ln,or,pr,qr,rs;return J?((Yt=Ke.doctorName)==null?void 0:Yt.toLowerCase().includes(J))||((un=Ke.appliedOn)==null?void 0:un.toLowerCase().includes(J))||((tn=Ke.fromDate)==null?void 0:tn.toLowerCase().includes(J))||((yn=Ke.fromTime)==null?void 0:yn.toLowerCase().includes(J))||((ri=Ke.toDate)==null?void 0:ri.toLowerCase().includes(J))||((ln=Ke.toTime)==null?void 0:ln.toLowerCase().includes(J))||((or=Ke.type)==null?void 0:or.toLowerCase().includes(J))||((pr=Ke.status)==null?void 0:pr.toLowerCase().includes(J))||((qr=Ke.reason)==null?void 0:qr.toLowerCase().includes(J))||((rs=Ke.timePeriod)==null?void 0:rs.toLowerCase().includes(J)):!0},[se,be]=F.useState(1),ee=8,Q=(n==null?void 0:n.filter(_e))||[],q=Math.ceil(Q.length/ee),ae=se*ee,re=ae-ee,fe=Q.slice(re,ae),pe=Ke=>{be(Ke)},Re=()=>se<q&&be(se+1),Ge=()=>se>1&&be(se-1),ve=Ke=>{s(WN({unavailability_id:Ke})).then(Yt=>{var un,tn;(un=Yt.payload)!=null&&un.status?(ct.success(Yt.payload.message),s(m_())):ct.error((tn=Yt.payload)==null?void 0:tn.message)}).catch(Yt=>{ct.error("An error occurred while Confirming for doctor's leave")})},Ne=(Ke,Yt)=>{s(qw({unavailability_id:Ke,status:Yt})).then(un=>{var tn,yn;(tn=un.payload)!=null&&tn.status?(ct.success(un.payload.message),s(m_())):ct.error((yn=un.payload)==null?void 0:yn.message)}).catch(un=>{ct.error("An error occurred while Approving doctor's leave'")})},Ce=(Ke,Yt)=>{s(qw({unavailability_id:Ke,status:Yt})).then(un=>{var tn,yn;(tn=un.payload)!=null&&tn.status?(ct.success(un.payload.message),s(m_())):ct.error((yn=un.payload)==null?void 0:yn.message)}).catch(un=>{ct.error("An error occurred while Declining doctor's leave'")})},Ue=Ke=>{s(zN({doctor_id:Ke})).then(Yt=>{var un,tn;(un=Yt.payload)!=null&&un.status?(ct.success(Yt.payload.message||"Doctor marked as available successfully"),an(!1),s(g_())):ct.error(((tn=Yt.payload)==null?void 0:tn.message)||"Failed to mark doctor as available")}).catch(Yt=>{an(!1),ct.error("An error occurred while marking doctor as available")})},de=Ke=>{if(Ke.preventDefault(),!rt.startDate||!rt.endDate||!rt.startTime||!rt.endTime||!rt.reason){ct.error("Please fill all required fields");return}const Yt=`${rt.startDate} ${rt.startTime}:00`,un=`${rt.endDate} ${rt.endTime}:00`,tn={doctor_id:Dt,from_datetime:Yt,to_datetime:un,type:rt.type,reason:rt.reason};s(YN(tn)).then(yn=>{var ri,ln;(ri=yn.payload)!=null&&ri.status?(s(g_()),ct.success(yn.payload.message||"Unavailability set successfully"),Ut(!1),xt({startDate:"",endDate:"",startTime:"",endTime:"",type:"emergency",reason:""})):ct.error(((ln=yn.payload)==null?void 0:ln.message)||"Failed to set unavailability")}).catch(yn=>{Ut(!1),ct.error("An error occurred while setting unavailability")})},[De,xe]=F.useState(1),Xe=(T==null?void 0:T.filter(ce))||[],ut=Math.ceil(Xe.length/ee),Pt=De*ee,It=Pt-ee,zt=Xe.slice(It,Pt),$t=Ke=>{xe(Ke)},Tt=()=>De<ut&&xe(De+1),on=()=>De>1&&xe(De-1),[fn,Ut]=F.useState(!1),[yt,an]=F.useState(!1),[Dt,wt]=F.useState(null),[rt,xt]=F.useState({startDate:"",endDate:"",startTime:"",endTime:"",type:"emergency",reason:""}),[Mt,Bn]=F.useState("upcoming"),[ki,zi]=F.useState(!1),[Cr,Un]=F.useState(!1),[Li,vt]=F.useState(!1),[Bt,bt]=F.useState(null),[rn,Qn]=F.useState(""),[Ar,$r]=F.useState(new Date),br=Ke=>{const{name:Yt,value:un}=Ke.target;xt(tn=>({...tn,[Yt]:un}))},[ji,ts]=F.useState({patientName:"",age:"",dsCode:"",disease:""}),[ns,Ra]=F.useState([]),[Cs,Ca]=F.useState([]),[je,sn]=F.useState(null);F.useEffect(()=>{if(ns){const Ke=ns.find(Yt=>Yt.status===1);sn(Ke||null)}},[ns]),JSON.parse(localStorage.getItem("doctor-app")||"{}").doctorData;const Yn=Ke=>{const[Yt,un]=Ke.split(" - "),tn=yn=>{const[ri,ln]=yn.split(":"),or=new Date;return or.setHours(ri,ln),or.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})};return`${tn(Yt)} - ${tn(un)}`};return m.jsxs("div",{className:"doctor-panel",children:[m.jsxs("div",{className:"container-fluid",children:[m.jsxs("div",{className:"doc-panel-inr",children:[" ",m.jsx(za,{})," "]}),i||w?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"doc-panel-body",children:[m.jsx("div",{className:"docpnl-sec-head",children:m.jsx("h1",{className:"h2-title",children:"Unavailability Management"})}),m.jsx("div",{className:"my-appointments-wrp",children:m.jsxs("div",{className:"my-appointments-inr",children:[m.jsxs("div",{className:"my-appointments-tab-header",children:[m.jsx("div",{className:"my-appointments-tab-head",children:m.jsxs("ul",{style:{position:"relative"},children:[m.jsx("li",{className:"tab-bg"}),m.jsxs("li",{style:Mt=="upcoming"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>Bn("upcoming"),children:["Doctors"," "]}),m.jsxs("li",{style:Mt=="completed"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>Bn("completed"),children:[" ","Requests"," "]})]})}),Mt==="upcoming"&&m.jsx(C2,{onSearch:ie,placeholder:"Search anything here...",value:G}),Mt==="completed"&&m.jsx(C2,{onSearch:oe,placeholder:"Search anything here...",value:J})]}),m.jsxs("div",{className:"my-appointments-tab-content-wrp",children:[m.jsxs("div",{className:`myapintmnt-content-tab ${Mt==="upcoming"?"upcoming":""}`,style:{display:Mt==="upcoming"?"block":"none"},children:[m.jsx("div",{className:"myapintmnt-table tbl-large",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{style:{width:"200px"},children:"Doctor Name"}),m.jsx("th",{children:"Experience"}),m.jsx("th",{children:"phone Number"}),m.jsx("th",{children:"Email Address"}),m.jsx("th",{children:"Shift Timing"}),m.jsx("th",{children:"Sign Up Date"}),m.jsx("th",{children:"Availability Status"}),m.jsx("th",{children:"Upcoming Unavailability"}),m.jsx("th",{children:"Type"}),m.jsx("th",{children:"Status"}),m.jsx("th",{children:"Reason"})]})}),m.jsxs("tbody",{children:[zt.length==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center"},children:w?"Loading...":m.jsx("span",{style:{fontWeight:"400",fontSize:18},children:"No data found"})})}),zt.map((Ke,Yt)=>{var un,tn,yn,ri,ln,or,pr,qr,rs,mo,Hs,Wc,Ya,Aa,Vo,go;return m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String((De-1)*ee+Yt+1).padStart(2,"0")}),m.jsx("td",{style:{color:"#199FD9"},children:Ke.name}),m.jsx("td",{style:{color:"#199FD9"},children:Ke.experience}),m.jsx("td",{style:{color:"#199FD9"},children:Ke.phone}),m.jsx("td",{style:{color:"#199FD9"},children:Ke.email}),m.jsx("td",{style:{color:"#199FD9"},children:Yn(Ke.shiftTiming)}),m.jsx("td",{style:{color:"#199FD9"},children:Ke.signupDate}),m.jsx("td",{children:Ke.isSuspended?"--":m.jsx(m.Fragment,{children:m.jsx("div",{className:"availability-toggle1",children:m.jsxs("div",{className:"status-text1",children:[m.jsx("span",{className:"unavailable",children:"Unavailable"}),m.jsxs("label",{className:"toggle-label1",children:[m.jsx("input",{type:"checkbox",className:"availability-switch",checked:!Ke.hasUnavailability||Ke.hasUnavailability&&!((tn=(un=Ke.unavailabilities)==null?void 0:un[0])!=null&&tn.isRunning),onChange:()=>{var _o,As;wt(Ke.doctor_id),Ke.hasUnavailability&&((As=(_o=Ke.unavailabilities)==null?void 0:_o[0])==null?void 0:As.isRunning)?an(!0):Ut(!0)}}),m.jsx("span",{className:"slider1"})]}),m.jsx("span",{className:"available",children:"Available"})]})})})}),m.jsx("td",{style:{color:"#199FD9"},children:Ke.isSuspended||!Ke.hasUnavailability?"--":m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"tbl-inr-date-slot1",children:[m.jsx("p",{children:"From:"}),m.jsxs("div",{className:"tble-inr-date",children:[m.jsx("div",{className:"date h3-title",children:(ri=(yn=Ke==null?void 0:Ke.unavailabilities)==null?void 0:yn[0])==null?void 0:ri.fromDate}),m.jsx("div",{className:"time",children:(or=(ln=Ke==null?void 0:Ke.unavailabilities)==null?void 0:ln[0])==null?void 0:or.fromTime})]})]}),m.jsxs("div",{className:"tbl-inr-date-slot1",children:[m.jsx("p",{children:"To:"}),m.jsxs("div",{className:"tble-inr-date",children:[m.jsx("div",{className:"date h3-title",children:(qr=(pr=Ke==null?void 0:Ke.unavailabilities)==null?void 0:pr[0])==null?void 0:qr.toDate}),m.jsx("div",{className:"time",children:(mo=(rs=Ke==null?void 0:Ke.unavailabilities)==null?void 0:rs[0])==null?void 0:mo.toTime})]})]})]})}),m.jsx("td",{style:{color:"#199FD9"},children:Ke.isSuspended||!Ke.hasUnavailability?"--":(Wc=(Hs=Ke==null?void 0:Ke.unavailabilities)==null?void 0:Hs[0])==null?void 0:Wc.type}),m.jsx("td",{style:{color:"#199FD9"},children:Ke.isSuspended||!Ke.hasUnavailability?"--":(Aa=(Ya=Ke==null?void 0:Ke.unavailabilities)==null?void 0:Ya[0])==null?void 0:Aa.status}),m.jsx("td",{style:{color:"#199FD9"},children:Ke.isSuspended||!Ke.hasUnavailability?"--":m.jsx("span",{dangerouslySetInnerHTML:{__html:(go=(Vo=Ke==null?void 0:Ke.unavailabilities)==null?void 0:Vo[0])==null?void 0:go.reason.replace(/(.{20})/g,"$1<br/>")}})})]},Yt)})]})]})}),Xe.length>0&&m.jsx(Lu,{currentPage:De,totalPages:ut,onPageChange:$t,onPrevious:on,onNext:Tt})]}),m.jsxs("div",{className:`myapintmnt-content-tab ${Mt==="completed"?"completed":""}`,style:{display:Mt==="completed"?"block":"none"},children:[m.jsx("div",{className:"myapintmnt-table",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsxs("tr",{children:[m.jsx("th",{children:"S.no."}),m.jsx("th",{style:{width:"200px"},children:"Doctor Name"}),m.jsx("th",{children:"Applied On"}),m.jsx("th",{children:"From"}),m.jsx("th",{children:"To"}),m.jsx("th",{children:"Type"}),m.jsx("th",{children:"Status"}),m.jsx("th",{children:"Reason"}),m.jsx("th",{children:"Total Time"}),m.jsx("th",{children:"Action"})]})}),m.jsxs("tbody",{children:[fe.length==0&&m.jsx("tr",{children:m.jsx("td",{colSpan:"8",style:{textAlign:"center"},children:i?"Loading...":m.jsx("span",{style:{fontWeight:"400",fontSize:18},children:"No data found"})})}),fe.map((Ke,Yt)=>m.jsxs("tr",{children:[m.jsx("td",{style:{color:"#199FD9"},children:String((se-1)*ee+Yt+1).padStart(2,"0")}),m.jsx("td",{style:{color:"#199FD9"},children:Ke.doctorName}),m.jsx("td",{style:{textAlign:"left",maxWidth:"287px",color:"#199FD9"},children:Ke.appliedOn}),m.jsxs("td",{children:[m.jsx("div",{className:"date",style:{color:"#199FD9"},children:Ke.fromDate}),m.jsx("div",{className:"time",style:{color:"#199FD9"},children:Ke.fromTime})]}),m.jsxs("td",{children:[m.jsx("div",{className:"date",style:{color:"#199FD9"},children:Ke.toDate}),m.jsx("div",{className:"time",style:{color:"#199FD9"},children:Ke.toTime})]}),m.jsx("td",{style:{color:"#199FD9"},children:Ke.type}),m.jsx("td",{style:{color:"#199FD9"},children:Ke.status}),m.jsx("td",{style:{color:"#199FD9"},children:m.jsx("span",{dangerouslySetInnerHTML:{__html:Ke.reason.replace(/(.{20})/g,"$1<br/>")}})}),m.jsx("td",{style:{color:"#199FD9"},children:Ke.timePeriod}),m.jsx("td",{style:{color:"#199FD9"},children:Ke.status==="Approved"&&Ke.type==="Emergency"?Ke!=null&&Ke.emergency_status?"Approved":m.jsx(Qr,{style:{backgroundColor:"#199FD9"},className:"border-0 px-6 rounded-lg shadow-md text-white flex items-center gap-2",onClick:()=>ve(Ke.unavailability_id),children:a?"Confirming..":"Confirm"}):Ke.status=="Approved"&&!Ke.approvalRequired?"Approved":Ke.status=="Rejected"&&!Ke.approvalRequired?"Rejected":Ke.status==="Pending"?m.jsx(m.Fragment,{children:m.jsxs("div",{style:{display:"flex",gap:"4px"},children:[m.jsx(Qr,{style:{backgroundColor:"#28a745",marginRight:"8px"},className:"border-0 px-4 rounded-lg shadow-md text-white flex items-center gap-2",onClick:()=>Ne(Ke.unavailability_id,"approved"),children:p?"Approving..":"Approve"}),m.jsx(Qr,{style:{backgroundColor:"#dc3545"},className:"border-0 px-4 rounded-lg shadow-md text-white flex items-center gap-2",onClick:()=>Ce(Ke.unavailability_id,"rejected"),children:p?"Declining..":"Decline"})]})}):null})]},Yt))]})]})}),Q.length>0&&m.jsx(Lu,{currentPage:se,totalPages:q,onPageChange:pe,onPrevious:Ge,onNext:Re})]})]})]})})]}),m.jsx(fo,{})]}),m.jsx(Cn,{show:fn,onHide:()=>Ut(!1),className:"popup-wrp1 p-dcrse1",children:m.jsxs(Cn.Body,{children:[m.jsx("button",{type:"button",className:"close1",onClick:()=>Ut(!1),children:m.jsx("span",{"aria-hidden":"true",children:m.jsx("img",{src:"./images/cross-blue.png",alt:"Icon"})})}),m.jsx("div",{className:"modal-icon1",children:m.jsx("img",{src:"./images/suspend-icon.svg",alt:"Icon"})}),m.jsxs("div",{className:"modal-header1 mb-4",children:[m.jsx("h2",{children:"Confirm Unavailability"}),m.jsx("p",{className:"m-0",children:"Are you sure you want to mark this doctor as unavailable?"}),m.jsxs("div",{className:"note",children:[m.jsx("strong",{children:"Note:"})," All appointments scheduled till the selected end time will be canceled and reassigned to other available doctors."]})]}),m.jsx("div",{className:"modal-body",children:m.jsx("div",{className:"unavailability-form",children:m.jsxs("form",{id:"unavailabilityForm",children:[m.jsxs("div",{className:"unavailability-form-inr1",children:[m.jsxs("div",{className:"formfield",children:[m.jsx("label",{htmlFor:"unavailability-start-date",children:"From"}),m.jsx("div",{className:"cstm-input-lbl1",children:m.jsx("input",{type:"date",id:"unavailability-start-date",name:"startDate",value:rt.startDate,onChange:br,placeholder:"Start Date"})})]}),m.jsxs("div",{className:"formfield",children:[m.jsx("label",{htmlFor:"unavailability-end-date",children:"To"}),m.jsx("div",{className:"cstm-input-lbl1",children:m.jsx("input",{type:"date",id:"unavailability-end-date",name:"endDate",value:rt.endDate,onChange:br})})]}),m.jsx("div",{className:"formfield",children:m.jsx("div",{className:"cstm-input-lbl1",children:m.jsx("input",{type:"time",id:"unavailability-start-time",name:"startTime",value:rt.startTime,onChange:br})})}),m.jsx("div",{className:"formfield",children:m.jsx("div",{className:"cstm-input-lbl1",children:m.jsx("input",{type:"time",id:"unavailability-end-time",name:"endTime",value:rt.endTime,onChange:br})})}),m.jsxs("div",{className:"formfield w-100",children:[m.jsx("label",{htmlFor:"unavailability-reason",children:"Reason"}),m.jsx("div",{className:"cstm-input-lbl1",children:m.jsx("input",{type:"text",id:"unavailability-reason",name:"reason",value:rt.reason,onChange:br,placeholder:"Enter reason for unavailability",required:!0})})]})]}),m.jsxs("div",{className:"btn-wrp1",children:[m.jsx("button",{type:"submit",id:"confirmUnavailabilityBtn",className:"cmn-btn1",onClick:de,disabled:O,children:O?"Processing...":"Confirm"}),m.jsx("button",{type:"button",onClick:()=>Ut(!1),className:"cmn-btn1",disabled:O,children:"Cancel"})]})]})})})]})}),m.jsx(Cn,{show:yt,onHide:()=>an(!1),className:"popup-wrp1",children:m.jsxs(Cn.Body,{children:[m.jsx("button",{type:"button",className:"close1",onClick:()=>an(!1),children:m.jsx("span",{"aria-hidden":"true",children:m.jsx("img",{src:"./images/cross-blue.png",alt:"Icon"})})}),m.jsx("div",{className:"modal-icon1",children:m.jsx("img",{src:"./images/check-icon-blue.svg",alt:"Icon"})}),m.jsxs("div",{className:"modal-header1",children:[m.jsx("h2",{children:"Confirm Availability"}),m.jsx("p",{className:"m-0",children:"Are you sure you want to mark this doctor as available?"}),m.jsx("div",{className:"note",children:"Note: Patients can now book appointments with this doctor, and any previous restrictions will be lifted."})]}),m.jsxs("div",{className:"modal-footer1 btn-wrp1",children:[m.jsx("button",{type:"submit",id:"confirmAvailabilityBtn",className:"cmn-btn1",onClick:()=>Ue(Dt),children:"Confirm"}),m.jsx("button",{type:"button",onClick:()=>an(!1),id:"cancelAvailabilityBtn",className:"cmn-btn1",children:"Cancel"})]})]})})]})},x0e="/images/calendar-tick-success.svg",P0e="/images/calendar-cancelled.svg",k0e="/images/calendar-changes.svg",L0e="/images/login/chat_icon_2.png",M0e=()=>{var X,ie,oe,ce,_e,se,be,ee,Q;const s=Pi(),n=es(),{doctorNotifications:i,loading:a,error:l}=hr(q=>q.notification);F.useEffect(()=>{s(np())},[s]);const[p,_]=F.useState([]),[T,w]=F.useState([]);F.useEffect(()=>{var fe,pe,Re;const q=((fe=i==null?void 0:i.today)==null?void 0:fe.map(Ge=>Ge.id))??[],ae=((pe=i==null?void 0:i.yesterday)==null?void 0:pe.map(Ge=>Ge.id))??[],re=((Re=i==null?void 0:i.older)==null?void 0:Re.map(Ge=>Ge.id))??[];w([...q,...ae,...re])},[i]);const C=()=>{p.length===T.length?_([]):(console.log(T,"fff"),_(T))},O=()=>{if(p.length===0){ct.error("Please select atleast one notification");return}s(kN(p)).then(()=>{_([]),s(Ov()),s(np())})},k=q=>{_(ae=>ae.includes(q)?ae.filter(re=>re!==q):[...ae,q])},U=()=>{s(Bw({notification_ids:T})),s(np()),s(Ov())},G=async q=>{if(q)try{const ae=[String(q)];s(Bw({notification_ids:ae}))}catch(ae){console.error("Error deleting notification:",ae)}},z=q=>{const ae=i[q];return(ae==null?void 0:ae.length)==0?null:m.jsxs("div",{className:"notifications-group",children:[m.jsx("div",{className:"group-header",children:m.jsx("h2",{children:(q==null?void 0:q.charAt(0).toUpperCase())+(q==null?void 0:q.slice(1))})}),m.jsx("ul",{className:"notifications-list",children:ae==null?void 0:ae.map(re=>{var fe,pe,Re,Ge,ve,Ne,Ce,Ue,de;return m.jsxs("li",{className:"notification-item",onClick:()=>{(re==null?void 0:re.type)==="new_message"||k(re==null?void 0:re.id)},style:{backgroundColor:p.includes(re==null?void 0:re.id)?"#c0c0c0":re.is_read==="true"?"#f0f0f0":"#ffffff",borderLeft:p.includes(re==null?void 0:re.id)?"3px solid #d0d0d0":"none",color:(p.includes(re==null?void 0:re.id),"black"),cursor:"pointer"},children:[m.jsxs("div",{className:"notif-left",children:[m.jsx("div",{className:`notif-icon ${(fe=re==null?void 0:re.icon)!=null&&fe.includes("success")?"success":(pe=re==null?void 0:re.type)!=null&&pe.includes("appointment_cancelled")?"cancelled":"changed"}`,children:m.jsx("img",{src:(Re=re==null?void 0:re.type)!=null&&Re.includes("appointment_cancelled")?P0e:(Ge=re==null?void 0:re.type)!=null&&Ge.includes("appointment_success")?x0e:(ve=re==null?void 0:re.type)!=null&&ve.includes("new_message")?L0e:k0e,alt:"Icon"})}),(re==null?void 0:re.type)=="new_message"?m.jsxs("div",{className:"notif-text",children:[m.jsx("h3",{style:{fontWeight:re.is_read==="true"?"normal":"bold"},onClick:()=>{var De,xe,Xe,ut,Pt,It;n("/completed-appointment-screen",{state:{id:(De=re==null?void 0:re.notification_data)==null?void 0:De.appointment_id,patientId:(xe=re==null?void 0:re.notification_data)==null?void 0:xe.patient_id,chat_id:(Xe=re==null?void 0:re.notification_data)==null?void 0:Xe.chat_channel,ds_code:(ut=re==null?void 0:re.notification_data)==null?void 0:ut.ds_code,referred:(Pt=re==null?void 0:re.notification_data)==null?void 0:Pt.referred,prescription_id:(It=re==null?void 0:re.notification_data)==null?void 0:It.prescription_id}}),G(re==null?void 0:re.id)},children:re.title}),m.jsxs("p",{onClick:()=>{var De,xe,Xe,ut,Pt,It;n("/completed-appointment-screen",{state:{id:(De=re==null?void 0:re.notification_data)==null?void 0:De.appointment_id,patientId:(xe=re==null?void 0:re.notification_data)==null?void 0:xe.patient_id,chat_id:(Xe=re==null?void 0:re.notification_data)==null?void 0:Xe.chat_channel,ds_code:(ut=re==null?void 0:re.notification_data)==null?void 0:ut.ds_code,referred:(Pt=re==null?void 0:re.notification_data)==null?void 0:Pt.referred,prescription_id:(It=re==null?void 0:re.notification_data)==null?void 0:It.prescription_id}}),G(re==null?void 0:re.id)},children:[(Ne=re==null?void 0:re.message)==null?void 0:Ne.trim(),(Ce=re==null?void 0:re.message)!=null&&Ce.trim().endsWith(".")?"":"."]})]}):m.jsxs("div",{className:"notif-text",children:[m.jsx("h3",{style:{fontWeight:re.is_read==="true"?"normal":"bold"},children:re.title}),m.jsxs("p",{children:[(Ue=re==null?void 0:re.message)==null?void 0:Ue.trim(),(de=re==null?void 0:re.message)!=null&&de.trim().endsWith(".")?"":"."]})]})]}),m.jsxs("div",{style:{},children:[m.jsx("div",{className:"notif-time",style:J(re.created_at)==="Just now"?{width:"69px"}:{},children:J(re.created_at)}),(re==null?void 0:re.type)=="new_message"&&m.jsx("div",{style:{display:"flex",alignItems:"center",gap:"5px",marginTop:"10px"},children:m.jsx("input",{type:"checkbox",id:`delete-notification-${re.id}`,name:"delete-notification",value:re.id,onChange:()=>k(re==null?void 0:re.id),checked:p.includes(re==null?void 0:re.id),style:{transform:"scale(1.5)",marginLeft:5}})})]})]},re.id)})})]})},J=q=>{const ae=new Date,re=new Date(q),fe=Math.floor((ae-re)/1e3);if(fe<60)return"Just now";if(fe<3600)return`${Math.floor(fe/60)}m`;if(fe<86400)return`${Math.floor(fe/3600)}h`;if(fe<172800)return"1d";{const pe=Math.floor(fe/86400);return pe<7?`${pe}d`:`${Math.floor(pe/7)}w`}};return m.jsx("main",{className:"doctor-panel",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(za,{})}),a?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsx("div",{className:"doc-panel-body",style:{minHeight:"450px"},children:m.jsxs("div",{className:"notifications-section",children:[m.jsxs("div",{className:"docpnl-sec-head text-center",children:[m.jsx("h1",{className:"h2-title px-5",children:"Notifications"}),m.jsx("div",{className:"back-btn",onClick:()=>window.history.back(),children:m.jsx("a",{href:"#",onClick:q=>q.preventDefault(),children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),(((X=i==null?void 0:i.today)==null?void 0:X.length)>0||((ie=i==null?void 0:i.yesterday)==null?void 0:ie.length)>0||((oe=i==null?void 0:i.older)==null?void 0:oe.length)>0)&&m.jsxs("div",{className:"bulk-actions",children:[m.jsxs("button",{className:"select-all-btn",onClick:C,children:[m.jsx("label",{htmlFor:"selectAll",children:"Select all"}),m.jsxs("div",{className:"radio-btn-wrp",children:[m.jsx("input",{type:"radio",name:"selectAction",id:"selectAll",checked:T.length>0&&p.length===T.length,readOnly:!0}),m.jsx("span",{})]})]}),m.jsxs("button",{className:"delete-all-btn",onClick:O,children:[m.jsx("label",{htmlFor:"deleteAll",children:"Delete"}),m.jsxs("div",{className:"radio-btn-wrp",children:[m.jsx("input",{type:"radio",name:"selectAction",id:"deleteAll",disabled:p.length===0}),m.jsx("span",{})]})]})]}),(((ce=i==null?void 0:i.today)==null?void 0:ce.length)>0||((_e=i==null?void 0:i.yesterday)==null?void 0:_e.length)>0||((se=i==null?void 0:i.older)==null?void 0:se.length)>0)&&m.jsx("div",{className:"group-header",style:{display:"flex",justifyContent:"flex-end"},children:m.jsx("button",{className:"mark-all-btn",onClick:U,children:"Mark all as read"})}),((be=i==null?void 0:i.today)==null?void 0:be.length)===0&&((ee=i==null?void 0:i.yesterday)==null?void 0:ee.length)===0&&((Q=i==null?void 0:i.older)==null?void 0:Q.length)===0?m.jsx("p",{style:{fontSize:"1.5rem",fontWeight:"500",color:"#6b7280",textAlign:"center",margin:"2rem 0",padding:"1.5rem",borderRadius:"0.5rem",width:"100%",maxWidth:"600px",marginLeft:"auto",marginRight:"auto"},children:a?"Loading...":"No Notifications found"}):m.jsxs(m.Fragment,{children:[z("today"),z("yesterday"),z("older")]})]})}),m.jsx(fo,{})]})})},j0e=()=>{const[s,n]=F.useState(""),[i,a]=F.useState(""),[l,p]=F.useState(!1),[_,T]=F.useState(!1),[w,C]=F.useState(!1),O=Pi(),k=Wi(),{email:U}=k.state||{},G=async z=>{var X,ie;if(z.preventDefault(),!/^(?=.*[a-z])(?=.*[A-Z])(?=.*[\d\W]).{8,}$/.test(s)){toast.error("Password must be at least 8 characters long and include at least one uppercase letter, one lowercase letter, and one number or special character.");return}if(s!==i){toast.error("Passwords do not match");return}try{const oe=await O(AN({email:U,password:s,password_confirmation:i}));(X=oe.payload)!=null&&X.status?p(!0):toast.error(((ie=oe.payload)==null?void 0:ie.message)||"Password creation failed")}catch{toast.error("An error occurred during password creation")}};return m.jsxs("div",{className:"sign-sec set-pass pt-0",children:[m.jsx("div",{className:"container",children:m.jsxs("div",{className:"sign-sec-inr",children:[m.jsx("div",{className:"docpnl-sec-head",children:m.jsx("div",{className:"back-btn",children:m.jsx(mn,{to:"/login-password",children:m.jsx("img",{src:"/images/left-arrow.svg",alt:"Icon"})})})}),m.jsxs("div",{className:"sign-inr-row row",children:[m.jsx("div",{className:"sign-left-wrp col-lg-7",children:m.jsxs("div",{className:"sign-left has-texture",children:[m.jsx("div",{className:"texture",children:m.jsx("img",{src:"/images/doctor-symbol.png",alt:"Doctor Symbol"})}),m.jsx("div",{className:"sign-left-img",children:m.jsx("img",{src:"/images/new-pass-bnr.png",alt:"Login Left Image"})})]})}),m.jsx("div",{className:"sign-right-wrp col-lg-5",children:m.jsxs("div",{className:"sign-right",children:[m.jsx("div",{className:"logo-wrp",children:m.jsx("div",{className:"logo-inr-wrp",children:m.jsx("span",{children:m.jsx("img",{src:"/images/logo.png",alt:"Logo"})})})}),m.jsx("div",{className:"sign-form",children:m.jsx("form",{onSubmit:G,children:m.jsx("div",{className:"sign-form-steps-wrp",children:m.jsxs("div",{className:"sign-form-step",children:[m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Create Password"}),m.jsxs("div",{className:"input-pass-field",children:[m.jsx("input",{type:_?"text":"password",placeholder:"Password",required:!0,value:s,onChange:z=>{n(z.target.value)}}),m.jsx("span",{className:"eye-btn",onClick:()=>{T(!_)},style:{cursor:"pointer",position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)"},children:m.jsx("img",{src:_?"/images/eye-open.svg":"/images/eye-close.svg",alt:_?"Hide Password":"Show Password"})})]})]}),m.jsxs("div",{className:"formfield mb-0",children:[m.jsx("label",{children:"Confirm Password"}),m.jsxs("div",{className:"input-pass-field",children:[m.jsx("input",{type:w?"text":"password",placeholder:"Password",required:!0,value:i,onChange:z=>a(z.target.value)}),m.jsx("span",{className:"eye-btn",onClick:()=>{C(!w)},style:{cursor:"pointer",position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)"},children:m.jsx("img",{src:w?"/images/eye-open.svg":"/images/eye-close.svg",alt:w?"Hide Password":"Show Password"})})]})]}),m.jsx(Qr,{type:"submit",className:"orange-btn",children:"Continue"})]})})})})]})})]})]})}),m.jsxs(Cn,{show:l,onHide:()=>p(!1),centered:!0,className:"popup-wrp",id:"congratulations",dialogClassName:"custom-modal",children:[m.jsx("style",{children:`
                    .custom-modal .modal-content {
                        padding: 30px 0 50px 0;
                        margin: 0;
                    }
                `}),m.jsx("div",{className:"modal-icon text-center mt-4",children:m.jsx("img",{src:"/images/check-icon.png",alt:"Icon"})}),m.jsxs(Cn.Header,{closeButton:!1,className:"border-0 flex-column text-center",children:[m.jsx(Cn.Title,{className:"w-100",children:m.jsx("h2",{children:"Congratulations"})}),m.jsx("p",{children:"Your account is ready to use."})]}),m.jsx(Cn.Footer,{className:"d-flex justify-content-center border-0",children:m.jsx(mn,{to:"/doctor-home",className:"orange-btn",onClick:()=>p(!1),children:"Go to Dashboard"})})]})]})},U0e=()=>{var k,U;const s=localStorage.getItem("anyoneJoin"),n=JSON.parse(localStorage.getItem("doctor-app")),[i,a]=F.useState(!1),[l,p]=F.useState("");es();const _=Pi(),{reminderPopupData:T,loading:w}=hr(G=>G.notification),C=G=>G.replace(/(\.\d{3})\d*(Z)/,"$1$2");F.useEffect(()=>{(s!=="true"&&s!==null||n!==null&&typeof n!="boolean")&&_(Hw())},[_,s]),F.useEffect(()=>{var ce;if(!((ce=T==null?void 0:T[0])!=null&&ce.appointment_datetime))return;const G=C(T[0].appointment_datetime),z=new Date(G);if(isNaN(z)){console.error("Invalid appointment datetime:",T[0].appointment_datetime);return}const J=new Date,X=z.getTime()-J.getTime(),ie=[{minutesBefore:10},{minutesBefore:2}],oe=[];if(ie.forEach(({minutesBefore:_e})=>{const se=X-_e*60*1e3;if(se>0){const be=setTimeout(()=>{const ee=`Your Appointment Starts in ${_e} Minutes!`;p(ee),a(!0)},se);oe.push(be)}}),X>0){const _e=setTimeout(()=>{},X);oe.push(_e)}return()=>{oe.forEach(clearTimeout)}},[T]);const O=G=>{const z=C(G),J=new Date(z),X={weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};return J.toLocaleString("en-US",X)};return m.jsx(m.Fragment,{children:i&&m.jsx("div",{className:"modal fade show",tabIndex:"-1",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.5)"},children:m.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:m.jsxs("div",{className:"modal-content text-center position-relative shadow",style:{width:"400px",minHeight:"280px",borderRadius:"20px",padding:"30px 20px"},children:[m.jsx("button",{type:"button",onClick:()=>a(!1),className:"position-absolute top-0 end-0 m-3 border-0 bg-transparent","aria-label":"Close",children:m.jsx("img",{src:"./images/cross-blue.png",alt:"Close Icon",style:{width:"24px",height:"24px"}})}),m.jsx("div",{className:"modal-icon mb-3",children:m.jsx("img",{src:"./images/bell-icon.svg",alt:"Reminder Icon",style:{width:"40px",height:"40px"}})}),m.jsxs("div",{className:"modal-header border-0 flex-column align-items-center p-0",children:[m.jsx("h2",{className:"fw-bold mb-2",style:{fontSize:"22px",color:"#333"},children:"Reminder:"}),m.jsx("p",{className:"m-0",style:{color:"#009CDE",fontWeight:"500"},children:l})]}),m.jsxs("div",{className:"modal-body p-0 mt-4",children:[m.jsxs("div",{className:"text-muted mb-2",children:["Patient's Name:"," ",m.jsx("span",{className:"fw-medium",style:{color:"#356598"},children:((k=T==null?void 0:T[0])==null?void 0:k.patient_name)||"Sunil"})]}),m.jsxs("div",{className:"text-muted",children:["Date and Time:"," ",m.jsx("span",{className:"fw-medium",style:{color:"#356598"},children:O((U=T==null?void 0:T[0])==null?void 0:U.appointment_datetime)})]}),m.jsx("button",{style:{backgroundColor:"#F47820",color:"white",border:"none",padding:"10px 20px",borderRadius:"5px",cursor:"pointer",marginTop:20},onClick:()=>a(!1),children:"Okay"})]})]})})})})},da=({children:s})=>m.jsxs("div",{children:[m.jsx(U0e,{}),m.jsx("main",{children:s})]}),ua=({children:s})=>{const n=Wi(),i=localStorage.getItem("doctor-app"),[a,l]=F.useState(!1),_=["/invited-user-join"].some(T=>n.pathname.startsWith(T));return F.useEffect(()=>{!i&&!_&&(ct.error("Please Login First"),l(!0))},[i,_]),a?m.jsx(coe,{to:"/",state:{from:n},replace:!0}):_||i?s:null},V0e=()=>{var oe,ce,_e,se,be;const s=Wi(),{id:n,patientId:i}=s.state||{},a=Pi(),{symptomUploadDetail:l,loading:p}=hr(ee=>ee.user),[_,T]=F.useState({patient_name:"",dayDate:"",time:"",name:"",height:"",weight:"",age:"",gender:"",contactno:"",questions:"",files:[]}),[w,C]=F.useState(null),[O,k]=F.useState(!1),[U,G]=F.useState(null),[z,J]=F.useState(!1);F.useEffect(()=>{n&&a(xN({symptom_id:n}))},[a,n]),F.useEffect(()=>{l!=null&&l.basicInformation&&T({patient_name:l.patientData.patient_name||"",dayDate:l.patientData.dayDate||"",time:l.patientData.time||"",name:l.basicInformation.name||"",height:l.basicInformation.height||"",weight:l.basicInformation.weight||"",age:l.basicInformation.age||"",gender:l.basicInformation.gender||"",questions:l.symptomAnswers||"",files:l.symptomFiles||[]})},[l]);const X=(ee,Q)=>ee.some(q=>Q.some(ae=>q.file_type.toLowerCase().includes(ae))),ie=ee=>{G(ee),J(!0)};return m.jsx("main",{className:"doctor-panel",children:m.jsxs("div",{className:"container-fluid",children:[m.jsx("div",{className:"doc-panel-inr",children:m.jsx(za,{})}),p?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"doc-panel-body appoint-details-pg has-texture papd-pg",children:[m.jsx("div",{className:"texture only-img",children:m.jsx("img",{src:"./images/doctor-symbol.png",alt:"Image"})}),m.jsxs("div",{className:"appointments",children:[m.jsxs("div",{className:"start-appointment cmn-mb",children:[m.jsxs("div",{className:"docpnl-sec-head",children:[m.jsx("h1",{className:"h2-title",children:"Symptom Upload Details"}),m.jsx("div",{className:"back-btn",children:m.jsx(mn,{to:"#",onClick:ee=>{ee.preventDefault(),window.history.back()},children:m.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),m.jsxs("div",{className:"apointment-detail-card",children:[m.jsx("div",{className:"apoint-dtl-img",children:m.jsx("img",{src:`${li}/${(oe=l==null?void 0:l.patientData)==null?void 0:oe.patient_profile}`,alt:"Client Image"})}),m.jsxs("div",{className:"appoint-dtl-content",children:[m.jsxs("div",{className:"appoint-dtl-left",children:[m.jsx("div",{className:"appoint-dtl-head",children:m.jsx("h2",{className:"h4-title",children:_.patient_name})}),m.jsx("div",{className:"date h3-title",children:_.dayDate}),m.jsx("div",{className:"time",children:_.time})]}),m.jsx(mn,{to:"/patient-profile",state:{patientId:i,source:"prescription",hideSchedule:!0},className:"cmn-btn",children:"View profile"})]})]})]}),m.jsx("div",{className:"patient-details-wrp",children:m.jsx("form",{children:m.jsxs("div",{className:"patient-dtl-form",children:[m.jsxs("div",{className:"patient-basic-info cmn-mb2",children:[m.jsx("h2",{children:"Basic Information"}),m.jsxs("div",{className:"row",children:[m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Full Name"}),m.jsx("input",{type:"text",placeholder:"Name",value:_.name,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Enter Your Height"}),m.jsx("input",{type:"text",placeholder:"175",value:_.height,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Enter Your Weight"}),m.jsx("input",{type:"text",placeholder:"70kg",value:_.weight,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Gender"}),m.jsx("input",{type:"text",placeholder:"Male",value:_.gender,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{children:"Enter Age"}),m.jsx("input",{type:"text",placeholder:"32",value:_.age,readOnly:!0})]})})]})]}),m.jsxs("div",{className:"scheduled-call-consultations cmn-mb2",children:[m.jsx("h2",{children:"Uploaded Symptoms"}),m.jsxs("div",{className:"row",children:[m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{style:{fontSize:"16px"},children:"1. How long are you suffering from this disease?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(ce=_.questions)==null?void 0:ce.answer1,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{style:{fontSize:"16px"},children:"2. Any other problem which you would like to share related to your problem?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(_e=_.questions)==null?void 0:_e.answer2,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{style:{fontSize:"16px"},children:"3. Do you have any history of this disease?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(se=_.questions)==null?void 0:se.answer3,readOnly:!0})]})}),m.jsx("div",{className:"col-lg-12",children:m.jsxs("div",{className:"formfield",children:[m.jsx("label",{style:{fontSize:"16px"},children:"4. Are you taking any medicines? If yes, please share the name of medicine and since how long you are taking this medicine?"}),m.jsx("input",{type:"text",placeholder:"Answer",value:(be=_.questions)==null?void 0:be.answer4,readOnly:!0})]})})]})]}),X(_.files,["jpg","jpeg","png","gif"])&&m.jsxs("div",{className:"view-uploaded-images-wrp",children:[m.jsx("h2",{children:"View Uploaded Images"}),m.jsx("div",{className:"view-uploaded-img",children:_.files.filter(ee=>["jpg","jpeg","png","gif"].some(Q=>ee.file_type.toLowerCase().includes(Q))).map((ee,Q)=>m.jsx("div",{className:"img-wrp",children:m.jsx("a",{href:"#",onClick:q=>{q.preventDefault(),C(ee),k(!0)},children:m.jsx("img",{src:`${li}/${ee.file_path}`,alt:`Symptom Image ${Q+1}`})})},Q))}),O&&w&&m.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center"},children:[m.jsx("button",{onClick:()=>k(!1),style:{position:"fixed",right:"30px",top:"30px",zIndex:1060,background:"transparent",border:"none",cursor:"pointer",padding:0},"aria-label":"Close",children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close",style:{width:"24px",height:"24px",filter:"brightness(0) invert(1)"}})}),m.jsx("div",{style:{maxWidth:"90vw",maxHeight:"90vh",display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsx("img",{src:`${li}/${w.file_path}`,alt:"Enlarged view",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})})]})]}),X(_.files,["mp4","webm","ogg"])&&m.jsxs("div",{className:"view-uploaded-images-wrp uploaded-vdo-wrp",children:[m.jsx("h2",{children:"View Uploaded Videos"}),m.jsx("div",{className:"view-uploaded-img",children:_.files.filter(ee=>["mp4","webm","ogg"].some(Q=>ee.file_type.toLowerCase().includes(Q))).map((ee,Q)=>m.jsx("div",{className:"img-wrp",children:m.jsx("a",{href:"#",onClick:q=>{q.preventDefault(),ie(ee)},children:m.jsxs("video",{width:"100%",children:[m.jsx("source",{src:`${li}/${ee.file_path}`,type:`video/${ee.file_type.split(".").pop()}`}),"Your browser does not support the video tag."]})})},Q))}),z&&U&&m.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center"},children:[m.jsx("button",{onClick:()=>J(!1),style:{position:"fixed",right:"30px",top:"30px",zIndex:1060,background:"transparent",border:"none",cursor:"pointer",padding:0},"aria-label":"Close",children:m.jsx("img",{src:"/images/cross-blue.png",alt:"Close",style:{width:"24px",height:"24px",filter:"brightness(0) invert(1)"}})}),m.jsx("div",{style:{width:"80vw",maxWidth:"800px",maxHeight:"80vh",display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsxs("video",{controls:!0,autoPlay:!0,style:{width:"100%",maxHeight:"100%",objectFit:"contain"},children:[m.jsx("source",{src:`${li}/${U.file_path}`,type:`video/${U.file_type.split(".").pop()}`}),"Your browser does not support the video tag."]})})]})]}),X(_.files,["pdf","doc","docx"])&&m.jsxs("div",{className:"view-uploaded-images-wrp upload-file-wrp",children:[m.jsx("h2",{children:"View Uploaded Files"}),m.jsx("div",{className:"view-uploaded-img",children:_.files.filter(ee=>["pdf","doc","docx"].some(Q=>ee.file_type.toLowerCase().includes(Q))).map((ee,Q)=>m.jsx("div",{className:"img-wrp",children:m.jsxs("a",{href:`${li}/${ee.file_path}`,target:"_blank",rel:"noopener noreferrer",children:[m.jsx("img",{src:"./images/file-icon.svg",alt:"File Icon"}),m.jsx("span",{className:"file-size",children:"Click to view"})]})},Q))})]}),m.jsx("div",{className:"btn-wrp",children:m.jsx(mn,{to:"/CompletedAssignedPrescription",state:{id:n,patientId:i},children:m.jsx("button",{type:"button",className:"orange-btn",children:"Respond"})})})]})})})]})]}),m.jsx(fo,{})]})})},F0e=()=>{const s=Pi(),n=Wi(),i=500,a=es(),[l,p]=F.useState(!1),[_,T]=F.useState(""),[w,C]=F.useState(""),{medicineSearch:O,loading2:k}=hr(yt=>yt.user),U=new URLSearchParams(n.search),G=U.get("id"),z=U.get("patientId");F.useEffect(()=>{(!G||!z)&&a("/doctor-home")},[]),F.useEffect(()=>{s(Fw())},[s]);const{allMedicine:J,loading:X,error:ie}=hr(yt=>yt.userdata),oe=_.length,[ce,_e]=F.useState(J),[se,be]=F.useState(!1);F.useEffect(()=>{J&&_e(J)},[J]),F.useEffect(()=>{s(Gw({appointment_id:G}))},[s,G]);const ee=F.useMemo(()=>{if(!J||!J.treatments)return[];const yt=new Set,an=[];return J.treatments.forEach(Dt=>{yt.has(Dt.medicine_name)||(yt.add(Dt.medicine_name),an.push({medicine_id:Dt.medicine_id,medicine_name:Dt.medicine_name}))}),an},[J]),[Q,q]=F.useState(!1),[ae,re]=F.useState(!1),[fe,pe]=F.useState(null),[Re,Ge]=F.useState({medicine_name:"",dosage:"",duration:"",unit:"",with_water:"",dosage_frequency:"",meal_timing:"",day_time:"",remarks:""}),ve=yt=>{switch(yt){case"morning":return"Morning";case"morning_afternoon":return"Morning + Afternoon";case"morning_evening":return"Morning + Evening";case"morning_afternoon_evening":return"Morning + Afternoon + Evening";case"morning_afternoon_evening_night":return"Morning + Afternoon + Evening + Night";case"morning_night":return"Morning + Night";case"night":return"Night";default:return yt}},Ne=yt=>{switch(yt){case"before":return"Before";case"after":return"After";default:return yt}},Ce=yt=>{pe({...yt,with_water:yt.with_water===1?"Yes":"No"}),q(!0)},Ue=()=>{q(!1),pe(null)},de=yt=>{const{name:an,value:Dt}=yt.target;pe(wt=>({...wt,[an]:Dt}))},De=yt=>{C(yt.target.value)},xe=yt=>{$t({target:{name:"medicine_name",value:yt}}),C("")},Xe=O?O.filter(yt=>yt.product_name.toLowerCase().includes(w.toLowerCase())):[],ut=()=>{let yt=!0;const an=["medicine_name","dosage","duration","unit","with_water","dosage_frequency","meal_timing","day_time"];for(const wt of an)if(!fe[wt]||String(fe[wt]).trim()===""){ct.error(`Please fill in the "${wt.replace(/_/g," ")}" field.`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),yt=!1;break}if(!yt)return;const Dt={...fe,with_water:fe.with_water==="Yes"?1:0};_e(wt=>({...wt,treatments:wt.treatments.map(rt=>rt.treatment_id===Dt.treatment_id?Dt:rt)})),Ue(),ct.success("Medicine updated successfully!")},Pt=yt=>{_e(an=>({...an,treatments:an.treatments.filter(Dt=>Dt.treatment_id!==yt)})),ct.info("Medicine deleted successfully!",{position:"top-center",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})},It=()=>{re(!0),Ge({medicine_name:"",dosage:"",duration:"",unit:"",with_water:"",dosage_frequency:"",meal_timing:"",day_time:"",remarks:""})},zt=()=>{re(!1)},$t=yt=>{const{name:an,value:Dt}=yt.target;Ge(wt=>{const rt={...wt,[an]:Dt};if(an==="medicine_name"&&Dt){const xt=O.find(Mt=>Mt.product_name===Dt);xt&&xt.unit&&(rt.unit=xt.unit)}return rt})},Tt=()=>{let yt=!0;const an=["medicine_name","dosage","duration","unit","with_water","dosage_frequency","meal_timing","day_time"];for(const Mt of an)if(!Re[Mt]||String(Re[Mt]).trim()===""){ct.error(`Please fill in the "${Mt.replace(/_/g," ")}" field.`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),yt=!1;break}if(Re.medicine_name.trim()||(ct.error("Please select a Medicine Name.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),yt=!1),ce.treatments&&ce.treatments.some(Mt=>Mt.medicine_name.toLowerCase()===Re.medicine_name.toLowerCase())&&(ct.error("Duplicate medicine not added. This medicine already exists in the table.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),yt=!1),!yt)return;const Dt=ce.treatments&&ce.treatments.length>0?Math.max(...ce.treatments.map(Mt=>Mt.treatment_id||0))+1:1,wt=O.find(Mt=>Mt.product_name===Re.medicine_name),rt=wt?wt.product_code:Dt,xt={...Re,treatment_id:Dt,medicine_id:rt,with_water:Re.with_water==="Yes"?1:0};_e(Mt=>({...Mt,treatments:[...Mt.treatments||[],xt]})),zt(),ct.success("New medicine added successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"})},on=()=>{be(!0)},fn=async()=>{var wt;if(be(!1),p(!1),!ce||!ce.disease_name||!ce.treatments||ce.treatments.length===0){ct.warn("No data to submit! Please add at least one medicine.",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"});return}const yt=JSON.parse(localStorage.getItem("doctor-app")),an=yt==null?void 0:yt.token;if(!an){ct.error("Authentication token not found. Please log in again.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"});return}const Dt={appointment_id:G,diagnosis:ce.disease_name,notes:_,medicines:ce.treatments.map(rt=>({medicine_name:rt.medicine_name,dosage:rt.dosage,duration:rt.duration,unit:rt.unit,with_water:rt.with_water,dosage_frequency:String(rt.dosage_frequency),meal_timing:rt.meal_timing,day_time:rt.day_time,remarks:rt.remarks}))};try{p(!0);const rt=await vi.post(`${li}api/doctor/prescriptions/submit_appointment_prescription`,Dt,{headers:{Authorization:`Bearer ${an}`,"Content-Type":"application/json"}});rt.data.status?(ct.success("Prescription data submitted successfully!",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark"}),p(!1),window.opener=null,window.open("","_self"),window.close()):(ct.error(rt.data.message||"An error occurred.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),p(!1))}catch(rt){console.error("API Call Error:",rt),rt.response?(console.error("Error response data:",(wt=rt.response.data)==null?void 0:wt.message),console.error("Error response status:",rt.response.status),ct.error(rt.response.data.message||"Server error. Please try again.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})):rt.request?ct.error("No response from server. Please check your internet connection.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}):ct.error("An unexpected error occurred. Please try again.",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),p(!1)}};if(l)return m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})});if(ie)return m.jsxs("div",{className:"flex justify-center items-center h-screen text-red-600 font-bold text-lg",children:["Error: ",ie]});const Ut=ce&&Array.isArray(ce.treatments)&&ce.treatments.length>0;return m.jsx(m.Fragment,{children:k?m.jsx("div",{className:"loader-main",children:m.jsx("span",{className:"loader"})}):m.jsxs("div",{className:"container p-4 mx-auto font-sans bg-white",children:[m.jsx("div",{style:{width:"200px",border:"1px solid #ccc",padding:"8px",borderRadius:"6px",marginBottom:-40},children:m.jsx("h3",{className:"text-3xl font-bold text-gray-800 m-0",style:{fontSize:20},children:(ce==null?void 0:ce.disease_name)||"N/A"})}),m.jsx("div",{className:"mb-4 text-right",children:m.jsxs(Qr,{onClick:It,style:{backgroundColor:"#F47820"},className:"border-0 px-6 py-2 rounded-lg shadow-md text-white flex items-center gap-2 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-75",children:[m.jsx(ij,{style:{marginBottom:5,marginRight:5}}),"Add New Medicine"]})}),m.jsx("div",{className:"overflow-x-auto bg-white border-[#199FD9]",children:Ut?m.jsxs(bq,{hover:!0,responsive:!0,className:"min-w-full text-center table-auto rounded-lg overflow-hidden",children:[m.jsx("thead",{style:{backgroundColor:"#199FD9",color:"white"},children:m.jsxs("tr",{children:[m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"S.No."}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Medicine Name"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Dosage"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Duration (For day)"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Unit"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"With Water"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Frequency (Times per day)"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Before/After Meal"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Day Time"}),m.jsx("th",{className:"px-4 py-3 text-sm font-semibold tracking-wider uppercase",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Remarks"}),m.jsx("th",{className:"px-4 py-3",style:{borderBottom:"1px solid #199FD9",backgroundColor:"#199FD9",color:"white"},children:"Actions"})]})}),m.jsx("tbody",{children:ce.treatments.map((yt,an)=>m.jsxs("tr",{className:"hover:bg-gray-100",children:[m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:an+1}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:yt.medicine_name}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:yt.dosage}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:yt.duration}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:yt.unit}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:yt.with_water===1?"Yes":"No"}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:yt.dosage_frequency}),m.jsxs("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:[Ne(yt.meal_timing)," "]}),m.jsxs("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:[ve(yt.day_time)," "]}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:yt.remarks}),m.jsx("td",{className:"px-4 py-3",style:{border:"1px solid #199FD9"},children:m.jsxs("div",{style:{display:"flex",gap:"8px"},children:[m.jsx("button",{onClick:()=>Ce(yt),style:{border:"none",background:"transparent",padding:"4px"},children:m.jsx(vK,{style:{color:"#199FD9"}})}),m.jsx("button",{onClick:()=>Pt(yt.treatment_id),style:{border:"none",background:"transparent",padding:"4px"},children:m.jsx(MX,{style:{color:"red"}})})]})})]},yt.treatment_id))})]}):m.jsxs("div",{className:"text-center py-5",children:[m.jsx("p",{className:"text-xl text-gray-600 font-semibold",children:"No Data Found"}),m.jsx("p",{className:"text-gray-500 mt-2",children:'Start by adding new medicines using the "Add New Medicine" button above.'})]})}),Ut&&m.jsxs("div",{style:{display:"flex",flexDirection:"column",marginTop:10,marginBottom:20,position:"relative",width:"60%"},children:[m.jsx("h3",{children:"Advice/Suggestion/Investigation."}),m.jsx("textarea",{style:{width:"100%",height:100,border:"1px solid #199FD9",backgroundColor:"white",maxHeight:"200px",overflowY:"auto",padding:"8px",boxSizing:"border-box",resize:"vertical"},value:_,onChange:yt=>{yt.target.value.length<=i&&T(yt.target.value)},rows:4,cols:50,placeholder:"Enter your advice, suggestion, or investigation details here...",maxLength:i}),m.jsxs("div",{style:{position:"absolute",bottom:5,right:5,fontSize:"0.8em",color:oe===i?"red":"#666",backgroundColor:"rgba(255, 255, 255, 0.7)",padding:"2px 5px",borderRadius:"3px",pointerEvents:"none"},children:[oe,"/",i]})]}),Ut&&m.jsx("div",{className:"mt-6 text-center",children:m.jsxs(Qr,{className:"orange-btn",onClick:on,children:[" ","Submit"]})}),m.jsxs(Cn,{show:Q,onHide:Ue,centered:!0,children:[m.jsx(Cn.Header,{closeButton:!0,style:{backgroundColor:"#199FD9",color:"white"},className:"add-new-med-close border-b-0 rounded-t-lg",children:m.jsx(Cn.Title,{className:"text-xl font-bold",children:"Update Medicine"})}),m.jsx(Cn.Body,{className:"p-6 bg-gray-50",children:fe&&m.jsxs(ot,{children:[m.jsxs(ot.Group,{className:"mb-3",controlId:"formMedicineName",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Medicine Name*"}),m.jsx(ot.Control,{type:"text",name:"medicine_name",value:fe.medicine_name,onChange:de,list:"medicineSuggestionsList",disabled:!0,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"}),m.jsx("datalist",{id:"medicineSuggestionsList",children:ee.map(yt=>m.jsx("option",{value:yt.medicine_name},yt.medicine_id))})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formUnit",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Unit*"}),m.jsxs(ot.Select,{name:"unit",value:fe.unit,onChange:de,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Unit"}),m.jsx("option",{value:"mg",children:"Milligram (mg)"}),m.jsx("option",{value:"g",children:"Gram (g)"}),m.jsx("option",{value:"tab",children:"Tablet (tab)"}),m.jsx("option",{value:"cap",children:"Capsule (cap)"}),m.jsx("option",{value:"ml",children:"Milliliter (mL)"}),m.jsx("option",{value:"drop",children:"Drop (drop)"}),m.jsx("option",{value:"tbsp",children:"Tablespoon (tbsp)"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formDosage",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Dosage*"}),m.jsx(ot.Control,{type:"text",name:"dosage",value:fe.dosage,onChange:de,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Enter dosage like 5 or 10-20"})]}),m.jsxs(Td,{className:"mb-3",children:[m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{className:"mb-3",controlId:"formWithWater",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"With Water*"}),m.jsxs(ot.Select,{name:"with_water",value:fe.with_water,onChange:de,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Option"}),m.jsx("option",{value:"Yes",children:"Yes"}),m.jsx("option",{value:"No",children:"No"})]})]})}),m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{className:"mb-3",controlId:"formDosageFrequency",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Frequency (Times per Day)*"}),m.jsxs(ot.Select,{name:"dosage_frequency",value:fe.dosage_frequency,onChange:de,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Frequency"}),m.jsx("option",{value:"1",children:"1/day"}),m.jsx("option",{value:"2",children:"2/day"}),m.jsx("option",{value:"3",children:"3/day"}),m.jsx("option",{value:"4",children:"4/day"})]})]})})]}),m.jsxs(Td,{className:"mb-3",children:[m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{className:"mb-3",controlId:"formMealTiming",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Before/After Meal*"}),m.jsxs(ot.Select,{name:"meal_timing",value:fe.meal_timing,onChange:de,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Timing"}),m.jsx("option",{value:"before",children:"Before "}),m.jsx("option",{value:"after",children:"After "})]})]})}),m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{className:"mb-3",controlId:"formDuration",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Duration*"}),m.jsx(ot.Control,{type:"text",name:"duration",value:fe.duration,onChange:de,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Enter duration like 2 or 3"})]})})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formDayTime",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Day Time*"}),m.jsxs(ot.Select,{name:"day_time",value:fe.day_time,onChange:de,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Time"}),m.jsx("option",{value:"morning",children:"Morning"}),m.jsx("option",{value:"morning_afternoon",children:"Morning + Afternoon"}),m.jsx("option",{value:"morning_evening",children:"Morning + Evening"}),m.jsx("option",{value:"morning_afternoon_evening",children:"Morning + Afternoon + Evening"}),m.jsx("option",{value:"morning_night",children:"Morning + Night"}),m.jsx("option",{value:"night",children:"Night"}),m.jsx("option",{value:"morning_afternoon_evening_night",children:"Morning + Afternoon + Evening + Night"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formRemarks",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Remarks (Optional)"}),m.jsx(ot.Control,{as:"textarea",rows:3,name:"remarks",value:fe.remarks,onChange:de,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter remark if any"})]})]})}),m.jsxs(Cn.Footer,{className:"bg-gray-100 p-4 border-t-0 rounded-b-lg flex justify-end gap-3",children:[m.jsx(Qr,{variant:"secondary",onClick:Ue,className:"px-4 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400",children:"Cancel"}),m.jsx(Qr,{style:{backgroundColor:"#F47820",borderColor:"#F47820"},onClick:ut,className:"px-4 py-2 rounded-md text-white hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500",children:"Update Medicine"})]})]}),m.jsxs(Cn,{show:ae,onHide:zt,centered:!0,children:[m.jsx(Cn.Header,{closeButton:!0,style:{backgroundColor:"#199FD9",color:"white"},className:"add-new-med-close border-b-0 rounded-t-lg",children:m.jsx(Cn.Title,{className:"text-xl font-bold",children:"Add New Medicine"})}),m.jsx(Cn.Body,{className:"p-6 bg-gray-50",children:m.jsxs(ot,{children:[m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewMedicineName",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Medicine Name*"}),Re.medicine_name?m.jsxs("div",{className:"mb-2 p-2 border border-blue-500 rounded-md bg-blue-50 flex justify-between items-center",children:[m.jsxs("span",{children:[" ",Re.medicine_name]}),m.jsx(Qr,{variant:"link",onClick:()=>xe(""),className:"p-0 text-red-500 text-sm",children:"(Change)"})]}):null,Re.medicine_name&&w===""?null:m.jsx(ot.Control,{type:"text",placeholder:"Search for a Medicine",value:w,onChange:De,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"}),w&&Re.medicine_name===""&&m.jsx("div",{className:"absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto mt-1",children:Xe.length>0?m.jsx("ul",{className:"list-none p-0 m-0",children:Xe.slice(0,10).map(yt=>m.jsx("li",{onClick:()=>xe(yt.product_name),className:"p-2 cursor-pointer hover:bg-blue-100",children:yt.product_name},yt.product_code))}):m.jsx("div",{className:"p-2 text-gray-500",children:w.length>0?"No results found.":"Start typing to search..."})})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewUnit",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Unit*"}),m.jsxs(ot.Select,{name:"unit",value:Re.unit,onChange:$t,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Unit"}),m.jsx("option",{value:"mg",children:"Milligram (mg)"}),m.jsx("option",{value:"g",children:"Gram (g)"}),m.jsx("option",{value:"tab",children:"Tablet (tab)"}),m.jsx("option",{value:"cap",children:"Capsule (cap)"}),m.jsx("option",{value:"ml",children:"Milliliter (mL)"}),m.jsx("option",{value:"drop",children:"Drop (drop)"}),m.jsx("option",{value:"tbsp",children:"Tablespoon (tbsp)"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewDosage",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Dosage*"}),m.jsx(ot.Control,{type:"text",name:"dosage",value:Re.dosage,onChange:$t,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Enter dosage like 5 or 10-20"})]}),m.jsxs(Td,{className:"mb-4",children:[m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{controlId:"formNewWithWater",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"With Water*"}),m.jsxs(ot.Select,{name:"with_water",value:Re.with_water,onChange:$t,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Option"}),m.jsx("option",{value:"Yes",children:"Yes"}),m.jsx("option",{value:"No",children:"No"})]})]})}),m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{controlId:"formDosageFrequency",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Frequency (Times per Day)*"}),m.jsxs(ot.Select,{name:"dosage_frequency",value:Re==null?void 0:Re.dosage_frequency,onChange:$t,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Frequency"}),m.jsx("option",{value:"1",children:"1/day"}),m.jsx("option",{value:"2",children:"2/day"}),m.jsx("option",{value:"3",children:"3/day"}),m.jsx("option",{value:"4",children:"4/day"})]})]})})]}),m.jsxs(Td,{className:"mb-4",children:[m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{controlId:"formNewMealTiming",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Before/After Meal*"}),m.jsxs(ot.Select,{name:"meal_timing",value:Re.meal_timing,onChange:$t,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Timing"}),m.jsx("option",{value:"before",children:"Before"}),m.jsx("option",{value:"after",children:"After"})]})]})}),m.jsx(ea,{md:6,children:m.jsxs(ot.Group,{controlId:"formNewDuration",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Duration*"}),m.jsx(ot.Control,{type:"text",name:"duration",value:Re.duration,onChange:$t,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Enter Duration like 2 or 3"})]})})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewDayTime",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Day Time*"}),m.jsxs(ot.Select,{name:"day_time",value:Re.day_time,onChange:$t,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[m.jsx("option",{value:"",children:"Select Time"}),m.jsx("option",{value:"morning",children:"Morning"}),m.jsx("option",{value:"morning_afternoon",children:"Morning + Afternoon"}),m.jsx("option",{value:"morning_evening",children:"Morning + Evening"}),m.jsx("option",{value:"morning_afternoon_evening",children:"Morning + Afternoon + Evening"}),m.jsx("option",{value:"morning_night",children:"Morning + Night"}),m.jsx("option",{value:"night",children:"Night"}),m.jsx("option",{value:"morning_afternoon_evening_night",children:"Morning + Afternoon + Evening + Night"})]})]}),m.jsxs(ot.Group,{className:"mb-3",controlId:"formNewRemarks",children:[m.jsx(ot.Label,{className:"font-semibold text-gray-700",children:"Remarks (Optional)"}),m.jsx(ot.Control,{as:"textarea",rows:3,name:"remarks",value:Re.remarks,onChange:$t,className:"p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter remark if any"})]})]})}),m.jsxs(Cn.Footer,{className:"bg-gray-100 p-4 border-t-0 rounded-b-lg flex justify-end gap-3",children:[m.jsx(Qr,{variant:"secondary",onClick:zt,className:"px-4 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400",children:"Cancel"}),m.jsx(Qr,{style:{backgroundColor:"#F47820",borderColor:"#F47820"},onClick:Tt,className:"px-4 py-2 rounded-md text-white hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500",children:"Add Medicine"})]})]}),m.jsx(Cn,{show:se,onHide:()=>be(!1),centered:!0,dialogClassName:"custom-modal-dialog",children:m.jsxs("div",{className:"modal-content text-center position-relative shadow",style:{width:"auto",minHeight:"280px",padding:"30px 20px",backgroundColor:"white",overflow:"hidden"},children:[m.jsx("button",{type:"button",onClick:()=>be(!1),className:"position-absolute top-0 end-0 m-3 border-0 bg-transparent","aria-label":"Close",children:m.jsx("img",{src:"./images/cross-blue.png",alt:"Close Icon",style:{width:"24px",height:"24px"}})}),m.jsx("div",{className:"modal-icon mb-3 mt-4",children:m.jsx("img",{src:"/images/logout-icon.svg",alt:"Info Icon",style:{width:"60px",height:"60px",color:"#199FD9"}})}),m.jsxs("div",{className:"modal-header border-0 flex-column align-items-center p-0",children:[" ",m.jsx("h2",{className:"fw-bold mb-2",style:{fontSize:"22px",color:"#333"},children:"Confirm Submission"}),m.jsx("p",{className:"m-0",style:{color:"black",fontSize:"16px"},children:"You cannot add more medicine after submission."}),m.jsx("p",{className:"m-0",style:{color:"black",fontSize:"16px",marginTop:"5px"},children:"Are you sure you want to submit the prescription?"})]}),m.jsxs("div",{className:"modal-body p-0 mt-5 d-flex justify-content-center gap-3",children:[" ",m.jsx(Qr,{variant:"outline-primary",onClick:()=>be(!1),className:"px-4 py-2 rounded-md font-semibold",style:{borderColor:"#199FD9",color:"#199FD9",backgroundColor:"white",minWidth:"120px",fontSize:"16px"},children:"Cancel"}),m.jsx(Qr,{variant:"primary",onClick:fn,className:"orange-btn px-4 py-2 rounded-md font-semibold",style:{backgroundColor:"#FF8C00",borderColor:"#FF8C00",color:"white",minWidth:"120px",fontSize:"16px"},children:"Confirm"})]})]})})]})})};function B0e(){const s=localStorage.getItem("doctor-app");localStorage.getItem("anyoneJoin");const n=Pi(),i=es(),[a,l]=F.useState(null),[p,_]=F.useState(!1),{id:T}=Kae(),[w,C]=F.useState("Please wait, we will connect you to the video call...");F.useEffect(()=>{O()},[]),F.useEffect(()=>{if(a===!1){const k=setTimeout(()=>{_(!0)},2e3);return()=>clearTimeout(k)}},[a]);const O=async()=>{var k,U,G,z,J,X,ie,oe,ce,_e,se,be,ee,Q,q,ae,re,fe,pe,Re,Ge,ve,Ne,Ce,Ue,de;try{const De=new FormData;De.append("appointmentId",T),De.append("role","admin");const xe=await vi.post(`${li}api/call/admin-join`,De,{headers:{"Content-Type":"multipart/form-data"}});xe.data&&(l((U=(k=xe==null?void 0:xe.data)==null?void 0:k.data)==null?void 0:U.ongoing),n(yK(xe.data)),s||(localStorage.setItem("doctor-app",!0),localStorage.setItem("anyoneJoin","true")),((z=(G=xe==null?void 0:xe.data)==null?void 0:G.data)==null?void 0:z.ongoing)==!0?i("/VideoCall",{state:{id:(X=(J=xe==null?void 0:xe.data)==null?void 0:J.data)==null?void 0:X.appointmentId,patientId:(ce=(oe=(ie=xe==null?void 0:xe.data)==null?void 0:ie.data)==null?void 0:oe.basic_information)==null?void 0:ce.id,name:(be=(se=(_e=xe==null?void 0:xe.data)==null?void 0:_e.data)==null?void 0:se.basic_information)==null?void 0:be.name,time_period:(Q=(ee=xe==null?void 0:xe.data)==null?void 0:ee.data)==null?void 0:Q.slot,userRole:(ae=(q=xe==null?void 0:xe.data)==null?void 0:q.data)==null?void 0:ae.type,ObjNavigate:{ChName:(fe=(re=xe==null?void 0:xe.data)==null?void 0:re.data)==null?void 0:fe.channelName,UDID:(Re=(pe=xe==null?void 0:xe.data)==null?void 0:pe.data)==null?void 0:Re.uid,AppID:(ve=(Ge=xe==null?void 0:xe.data)==null?void 0:Ge.data)==null?void 0:ve.appId,Token:(Ce=(Ne=xe==null?void 0:xe.data)==null?void 0:Ne.data)==null?void 0:Ce.token}}}):((de=(Ue=xe==null?void 0:xe.data)==null?void 0:Ue.data)==null?void 0:de.ongoing)==!1&&ct.success("Sorry there is no ongoing call",{duration:1e4}))}catch(De){console.error("Error joining admin:",De),C("Something went wrong. Please try again.")}};return m.jsxs("div",{style:wM.container,children:[m.jsx("div",{style:wM.loader}),!p&&m.jsx("p",{style:wM.text,children:w}),p&&m.jsx(Qr,{onClick:()=>i(-1),children:"Go Back"})]})}const wM={container:{width:"100%",height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontSize:"20px",fontWeight:"500",gap:"20px"},loader:{width:"50px",height:"50px",border:"6px solid #ddd",borderTop:"6px solid #4A90E2",borderRadius:"50%",animation:"spin 1s linear infinite"},text:{textAlign:"center",color:"#333"}};function H0e(){return m.jsx(m.Fragment,{children:m.jsxs(doe,{children:[m.jsx(Ei,{path:"/",element:m.jsx(qpe,{})}),m.jsx(Ei,{path:"/login-password",element:m.jsx(Kpe,{})}),m.jsx(Ei,{path:"/forgot-password",element:m.jsx(Xpe,{})}),m.jsx(Ei,{path:"/otp-verification",element:m.jsx(Qpe,{})}),m.jsx(Ei,{path:"/set-password",element:m.jsx($pe,{})}),m.jsx(Ei,{path:"/header",element:m.jsx(za,{})}),m.jsx(Ei,{path:"/footer",element:m.jsx(fo,{})}),m.jsx(Ei,{path:"/doctor-home",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(dfe,{})})})}),m.jsx(Ei,{path:"/patient-details",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(ufe,{})})})}),m.jsx(Ei,{path:"/patient-profile",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(hfe,{})})})}),m.jsx(Ei,{path:"/my-appointments",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(C8,{})})})}),m.jsx(Ei,{path:"/schedule-appointment",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(gfe,{})})})}),m.jsx(Ei,{path:"/completed-appointment-screen",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(Ove,{})})})}),m.jsx(Ei,{path:"/videocall",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(jve,{})})})}),m.jsx(Ei,{path:"/PrescriptiveDoctor",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(F0e,{})})})}),m.jsx(Ei,{path:"/pendingprescription",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(Vve,{})})})}),m.jsx(Ei,{path:"/PendingAssignedPrescriptionDetails",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(V0e,{})})})}),m.jsx(Ei,{path:"/CompletedAssignedPrescription",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(Gve,{})})})}),m.jsx(Ei,{path:"/pendingfull",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(Fve,{})})})}),m.jsx(Ei,{path:"/UserProfile",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(Wve,{})})})}),m.jsx(Ei,{path:"/pastpatient",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(zve,{})})})}),m.jsx(Ei,{path:"/doctorUnavailibility",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(O0e,{})})})}),m.jsx(Ei,{path:"/hod",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(D0e,{})})})}),m.jsx(Ei,{path:"/create-password",element:m.jsx(j0e,{})}),m.jsx(Ei,{path:"/notifications",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(M0e,{})})})}),m.jsx(Ei,{path:"/myappointment",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(C8,{})})})}),m.jsx(Ei,{path:"/invited-user-join/:id",element:m.jsx(ua,{children:m.jsx(da,{children:m.jsx(B0e,{})})})}),m.jsx(Ei,{path:"*",element:m.jsx(Uve,{})})]})})}function Ff(){const s=localStorage.removeItem("doctor-app"),n=localStorage.getItem("anyoneJoin");!n&&!s&&ct.error("Token Expired"),localStorage.removeItem("nfc-admin"),setTimeout(()=>{n||(window.location.href="/")},1e3)}const RM=Zt("faq/getAllContacts",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),CM=Zt("faq/updateFeedback",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),AM=Zt("faq/deleteContact",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),IM=Zt("faq/getAllFaq",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)()).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),NM=Zt("faq/createFaq",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),OM=Zt("faq/editFaq",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),DM=Zt("faq/deleteFaq",async(s,{rejectWithValue:n})=>{var i;try{return(await(void 0)(s)).data}catch(a){return n(((i=a.response)==null?void 0:i.data)||a.message)}}),G0e=om({name:"faqSlice",initialState:{allContacts:[],contactLoading:!1,contactError:null,allFaq:[],loading:!1,error:null},reducers:{},extraReducers:s=>{s.addCase(RM.pending,n=>{n.loading=!0,n.error=null}).addCase(RM.fulfilled,(n,i)=>{var a;n.loading=!1,n.allContacts=(a=i.payload)==null?void 0:a.data}).addCase(RM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch Contacts",i.payload.message=="Unauthenticated."&&Ff()}).addCase(CM.pending,n=>{n.loading=!0,n.error=null}).addCase(CM.fulfilled,(n,i)=>{var a;n.loading=!1,n.allContacts=(a=i.payload)==null?void 0:a.data,ct.success("Feedback updated successfully")}).addCase(CM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to update Contacts",ct.error(i.payload.message||"Failed to update Feedback"),i.payload.message=="Unauthenticated."&&Ff()}).addCase(AM.pending,n=>{n.loading=!0,n.error=null}).addCase(AM.fulfilled,(n,i)=>{n.loading=!1,n.allContacts=i.payload.data,ct.success("Contact deleted successfully")}).addCase(AM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to delete Faq",ct.error(i.payload.message||"Failed to delete Faq"),i.payload.message=="Unauthenticated."&&Ff()}).addCase(IM.pending,n=>{n.loading=!0,n.error=null}).addCase(IM.fulfilled,(n,i)=>{var a;n.loading=!1,n.allFaq=(a=i.payload)==null?void 0:a.data}).addCase(IM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch Faq's",i.payload.message=="Unauthenticated."&&Ff()}).addCase(NM.pending,n=>{n.loading=!0,n.error=null}).addCase(NM.fulfilled,(n,i)=>{var a;n.loading=!1,n.allFaq=(a=i.payload)==null?void 0:a.data,ct.success("Faq created successfully")}).addCase(NM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to fetch Faq's",ct.error(i.payload.message||"Failed to create Faq"),i.payload.message=="Unauthenticated."&&Ff()}).addCase(OM.pending,n=>{n.loading=!0,n.error=null}).addCase(OM.fulfilled,(n,i)=>{n.loading=!1,n.allFaq=i.payload.data,n.message="Faq updated successfully",ct.success("Faq updated successfully")}).addCase(OM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to update Faq",ct.error(i.payload.message||"Failed to update Faq"),i.payload.message=="Unauthenticated."&&Ff()}).addCase(DM.pending,n=>{n.loading=!0,n.error=null}).addCase(DM.fulfilled,(n,i)=>{n.loading=!1,n.allFaq=i.payload.data,n.message="Faq deleted successfully",ct.success("Faq deleted successfully"),i.payload.message=="Unauthenticated."&&Ff()}).addCase(DM.rejected,(n,i)=>{n.loading=!1,n.error=i.payload||"Failed to delete Faq",ct.error(i.payload.message||"Failed to delete Faq"),i.payload.message=="Unauthenticated."&&Ff()})}}),W0e=G0e.reducer,z0e=ode({reducer:{user:Mpe,faqs:W0e,userdata:Zpe,appointments:tfe,prescriptions:mfe,patientProfile:rfe,notification:zpe,info:sfe},devTools:!0}),Y0e=()=>m.jsx(m.Fragment,{children:m.jsx(Poe,{children:m.jsx(H0e,{})})});function q0e(){return m.jsxs(Dle,{store:z0e,children:[m.jsx(rj,{}),m.jsx(Y0e,{})]})}Eae.createRoot(document.getElementById("root")).render(m.jsxs(m.Fragment,{children:[m.jsx(q0e,{}),m.jsx(rj,{})]}));
